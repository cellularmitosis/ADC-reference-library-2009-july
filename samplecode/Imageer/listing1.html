<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Imageer - /source/doevent.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Imageer</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Imageer</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/source/doevent.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/source/doevent.c</option>
<option value="listing2.html">/source/eventloop.c</option>
<option value="listing3.html">/source/fileCache.c</option>
<option value="listing4.html">/source/fileIO.c</option>
<option value="listing5.html">/source/gxGraphics.c</option>
<option value="listing6.html">/source/Imageer.app.h</option>
<option value="listing7.html">/source/Imageer.protos.h</option>
<option value="listing8.html">/source/Imageer.r</option>
<option value="listing9.html">/source/imageFilter.c</option>
<option value="listing10.html">/source/menu.c</option>
<option value="listing11.html">/source/offscrnGraphics.c</option>
<option value="listing12.html">/source/PreCompiledHeaders.c</option>
<option value="listing13.html">/source/start.c</option>
<option value="listing14.html">/source/windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="Imageer.zip">Download Sample</a></strong> (&#147;Imageer.zip&#148;, 161.4K)<BR>
<strong><a href="Imageer.dmg">Download Sample</a></strong> (&#147;Imageer.dmg&#148;, 243.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/****************************************************//*                          *//*  File:    doevent.c              *//*                          *//*  Program:  Imageer                *//*                          *//*  By:      Jason Hodges-Harris          *//*                          *//*  Created:  26/10/95  00:00:00 AM        *//*                          *//*  Version:  1.0.0d3                *//*                          *//*  Copyright:  &copy; 1995-96 Apple Computer, Inc.,    */ /*          all rights reserved.      */    /*                          *//****************************************************//**** Macintosh Toolbox Headers *****/#ifndef __CURSORCTL__#include &lt;CursorCtl.h&gt;#endif#ifndef __DESK__#include &lt;Desk.h&gt;#endif#ifndef __DISKINIT__#include &lt;DiskInit.h&gt;#endif#ifndef __EVENTS__#include &lt;Events.h&gt;#endif#ifndef __MENUS__#include &lt;Menus.h&gt;#endif#ifndef __QDOFFSCREEN__#include &lt;QDOffscreen.h&gt;#endif#ifndef __TOOLUTILS__#include &lt;ToolUtils.h&gt;#endif#ifndef __WINDOWS__#include &lt;Windows.h&gt;#endif/****   Application headers and prototypes   ****/#ifndef __IMAGEERAPPHEADER__#include &quot;Imageer.app.h&quot;#endif#ifndef __IMAGEERPROTOSHEADER__#include &quot;Imageer.protos.h&quot;#endif// DoEvent function processess the events posted by the application.// This includes the handling of mouse, key,// disk and operating system events.#pragma segment Mainvoid DoEvent (EventRecord *eventPtr){  char      theChar;    switch (eventPtr-&gt;what)  {    case nullEvent:    break;    case mouseDown:      HandleMouseDown(eventPtr);    break;    case mouseUp:    break;    case keyDown:    case autoKey:      theChar=eventPtr-&gt;message &amp; charCodeMask;       if ((eventPtr-&gt;modifiers &amp;cmdKey) != 0)         DoMenuCommand(MenuKey (theChar));    break;    case keyUp:    break;    case updateEvt:      DoWindowUpdate((WindowPtr)(eventPtr-&gt;message));    break;    case diskEvt:      DoDiskEvt(eventPtr);  // disk inserted event    break;    case activateEvt:      DoWindowUpdate((WindowPtr)(eventPtr-&gt;message));    break;    case osEvt:      if (eventPtr-&gt;message&gt;&gt;24==resumeFlag)        SetCursor(&amp;qd.arrow);    break;  }}// HandleMouseDown controls the further processing of mouse button down events.// This includes testing the location of the mouse pointer at the time of the event// and performing the appropriate action. e.g. if the mouse button was pressed// whilst the pointer was in the menubar, the value returned by MenuSelect()// (used to determine which menubar and item selected) is passed into DoMenuCommand()// which in turn handles the processing of the selected menu items.#pragma segment Mainvoid HandleMouseDown(EventRecord *eventPtr){  ImageDocHndl    theWindDocHndl;  MenuHandle      theMenu;  WindowPtr      theWindow,            oldPort;  long        menuChoice;  Str255        theResString;  short        thePart,            maxXsize,            maxYsize;    theMenu = GetMHandle(mModel);  thePart=FindWindow (eventPtr-&gt;where,&amp;theWindow);  switch (thePart)  {    case inMenuBar:      menuChoice = MenuSelect (eventPtr-&gt;where);      DoMenuCommand(menuChoice);    break;    case inSysWindow:      SystemClick(eventPtr,theWindow);    break;    case inDrag:      SetCurrentWindowMark(theWindow);      if (FrontWindow() != theWindow)      {        theWindDocHndl = (ImageDocHndl)GetWRefCon(theWindow);        if (!(**theWindDocHndl).isColorsWindow)        {          SetUndoItemText((*theWindDocHndl)-&gt;theUndoState);          if (ColorWindowVisible())            UpdateColorsWindPalette(theWindDocHndl, theWindow);          if ((**theWindDocHndl).isUsingQDGX)          {            GetIndString (theResString,rImageModel,iUseColorQD);            SetMenuItemText (theMenu,iUseQDGX,theResString);            SetMenuItemAvailable(true);          }          else          {            GetIndString (theResString,rImageModel,iUseQuickDrawGX);            SetMenuItemText (theMenu,iUseQDGX,theResString);            SetMenuItemAvailable(false);          }        }        else           SetUndoItemText(kCannotUndo);        SetCurrentWindowMark(theWindow);        SelectWindow(theWindow);      }      DragSelWind(theWindow,eventPtr-&gt;where);    break;    case inGrow:      HandleWindowReSize(theWindow, eventPtr-&gt;where);    break;    case inGoAway:      DoGoAwayWind(theWindow,eventPtr-&gt;where);    break;    case inContent:      if (FrontWindow() != theWindow)      {        theWindDocHndl = (ImageDocHndl)GetWRefCon(theWindow);        if (!(**theWindDocHndl).isColorsWindow)        {          SetUndoItemText((*theWindDocHndl)-&gt;theUndoState);          if (ColorWindowVisible())            UpdateColorsWindPalette(theWindDocHndl, theWindow);          if ((**theWindDocHndl).isUsingQDGX)          {            GetIndString (theResString,rImageModel,iUseColorQD);            SetMenuItemText (theMenu,iUseQDGX,theResString);            SetMenuItemAvailable(true);          }          else          {            GetIndString (theResString,rImageModel,iUseQuickDrawGX);            SetMenuItemText (theMenu,iUseQDGX,theResString);            SetMenuItemAvailable(false);          }        }        else           SetUndoItemText(kCannotUndo);        SetCurrentWindowMark(theWindow);        SelectWindow(theWindow);      }      else        ScrollBarHandler(eventPtr-&gt;where, theWindow);  // find if current window control selected    break;    case inZoomIn:    case inZoomOut:      theWindDocHndl = (ImageDocHndl)GetWRefCon((WindowPtr)theWindow);      MoveWindow((WindowPtr)theWindow,0,18+GetMBarHeight(),true);      SizeWindow((WindowPtr)theWindow,      (**theWindDocHndl).theMaxWindowSize.right - (**theWindDocHndl).theMaxWindowSize.left,      (**theWindDocHndl).theMaxWindowSize.bottom - (**theWindDocHndl).theMaxWindowSize.top,true);      MoveControl((**theWindDocHndl).theVScrollBar,            theWindow-&gt;portRect.right - kScrollBarWidth,theWindow-&gt;portRect.top - 1);      MoveControl((**theWindDocHndl).theHScrollBar,            theWindow-&gt;portRect.left - 1,theWindow-&gt;portRect.bottom - kScrollBarWidth);      SizeControl((**theWindDocHndl).theVScrollBar,16,            (theWindow-&gt;portRect.bottom - theWindow-&gt;portRect.top)-13);      SizeControl((**theWindDocHndl).theHScrollBar,            (theWindow-&gt;portRect.right - theWindow-&gt;portRect.left)-13,16);      SetControlMinimum((**theWindDocHndl).theVScrollBar,0);      SetControlMinimum((**theWindDocHndl).theHScrollBar,0);      maxXsize = (**theWindDocHndl).theImageXSize -             ((theWindow-&gt;portRect.right - kScrollBarWidth) - theWindow-&gt;portRect.left);      maxYsize = (**theWindDocHndl).theImageYSize -             ((theWindow-&gt;portRect.bottom - kScrollBarWidth) - theWindow-&gt;portRect.top);      SetControlMaximum((**theWindDocHndl).theVScrollBar,maxYsize);      SetControlMaximum((**theWindDocHndl).theHScrollBar,maxXsize);      SetControlValue((**theWindDocHndl).theVScrollBar,0);      SetControlValue((**theWindDocHndl).theHScrollBar,0);      GetPort(&amp;oldPort);      SetPort(theWindow);      InvalRect(&amp;theWindow-&gt;portRect);      SetPort(oldPort);    break;  }  DrawMenuBar();}// DoDiskEvt handles the event post by the OS when a disk is insert// and displays an error is the media cannot be mounted.#pragma segment Mainvoid DoDiskEvt(EventRecord *eventPtr){  short  ErrResult;  Point  ErrPoint;  if((HiWord(eventPtr-&gt;message)!=noErr))  {    SetPt(&amp;ErrPoint,100,100);    ErrResult=DIBadMount(ErrPoint,eventPtr-&gt;message);  }}/****  Handle image window scroll bars    ****/// Handle the actions of the scroll bars in the image windows,// using control actions to track controls when the mouse button is held down.#pragma segment MainOSErr  ScrollBarHandler(Point  Position, WindowPtr theWindow){  ImageDocHndl     theDocHndl;  ControlHandle    theScrollBar;  ControlActionUPP  theVertActionScrollUPP,            theHorizActionScrollUPP;  WindowPtr      oldPort;  short        theControlPart;  OSErr        error = noErr;    GetPort(&amp;oldPort);  SetPort(theWindow);  GlobalToLocal(&amp;Position);  theDocHndl = (ImageDocHndl)GetWRefCon(theWindow);  theControlPart = FindControl(Position, theWindow, &amp;theScrollBar);  theVertActionScrollUPP = NewControlActionProc(ImageWindVertAction);  theHorizActionScrollUPP = NewControlActionProc(ImageWindHorizAction);  switch (theControlPart)  {    case inUpButton:      if (theScrollBar == (**theDocHndl).theVScrollBar)        TrackControl(theScrollBar,Position,theVertActionScrollUPP);      else if (theScrollBar == (**theDocHndl).theHScrollBar)        TrackControl(theScrollBar,Position,theHorizActionScrollUPP);    break;    case inDownButton:      if (theScrollBar == (**theDocHndl).theVScrollBar)        TrackControl(theScrollBar,Position,theVertActionScrollUPP);      else if (theScrollBar == (**theDocHndl).theHScrollBar)        TrackControl(theScrollBar,Position,theHorizActionScrollUPP);    break;    case inPageUp:      if (theScrollBar == (**theDocHndl).theVScrollBar)        TrackControl(theScrollBar,Position,theVertActionScrollUPP);      else if (theScrollBar == (**theDocHndl).theHScrollBar)        TrackControl(theScrollBar,Position,theHorizActionScrollUPP);    break;    case inPageDown:      if (theScrollBar == (**theDocHndl).theVScrollBar)        TrackControl(theScrollBar,Position,theVertActionScrollUPP);      else if (theScrollBar == (**theDocHndl).theHScrollBar)        TrackControl(theScrollBar,Position,theHorizActionScrollUPP);    break;    case inThumb:      if (theScrollBar == (**theDocHndl).theVScrollBar)      {        theControlPart = TrackControl(theScrollBar,Position,nil);        if (theControlPart)        {          InvalRect(&amp;theWindow-&gt;portRect);        }      }      else if (theScrollBar == (**theDocHndl).theHScrollBar)      {        theControlPart = TrackControl(theScrollBar,Position,nil);        if (theControlPart)        {          InvalRect(&amp;theWindow-&gt;portRect);        }      }    break;  }  DisposeRoutineDescriptor((UniversalProcPtr)theVertActionScrollUPP);  DisposeRoutineDescriptor((UniversalProcPtr)theHorizActionScrollUPP);  SetPort(oldPort);  return error;}/****    Update image window scroll bar controls  ****/#pragma segment Mainvoid  UpdateImageWindCntrl(ControlHandle theControlHndl, WindowPtr theWindow, short stepSize){  short      theControlValue,          theControlBounds;  theControlValue = GetControlValue(theControlHndl);  theControlBounds = GetControlMaximum(theControlHndl);  theControlValue = (theControlValue + stepSize &gt; theControlBounds) ?    theControlBounds : theControlValue + stepSize;  SetControlValue(theControlHndl,theControlValue);  InvalRect(&amp;theWindow-&gt;portRect);}/****  Vertical scrolling action function  ****/#pragma segment Mainpascal void ImageWindVertAction(ControlHandle theControl, short theControlPart){  WindowPtr    theWindow;    theWindow = (*theControl)-&gt;contrlOwner;  switch (theControlPart)  {    case inUpButton:      UpdateImageWindCntrl(theControl, theWindow, -kSmallScroller);    break;    case inDownButton:      UpdateImageWindCntrl(theControl, theWindow, kSmallScroller);    break;        case inPageUp:      UpdateImageWindCntrl(theControl, theWindow, -kLargeScroller);    break;    case inPageDown:      UpdateImageWindCntrl(theControl, theWindow, kLargeScroller);    break;  }}/****  Horizontal scrolling action function  ****/#pragma segment Mainpascal void ImageWindHorizAction(ControlHandle theControl, short theControlPart){  WindowPtr    theWindow;    theWindow = (*theControl)-&gt;contrlOwner;  switch (theControlPart)  {    case inUpButton:      UpdateImageWindCntrl(theControl, theWindow, -kSmallScroller);    break;    case inDownButton:      UpdateImageWindCntrl(theControl, theWindow, kSmallScroller);    break;        case inPageUp:      UpdateImageWindCntrl(theControl, theWindow, -kLargeScroller);    break;    case inPageDown:      UpdateImageWindCntrl(theControl, theWindow, kLargeScroller);    break;  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Imageer/listing1.html%3Fid%3DDTS10000150-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Imageer/listing1.html%3Fid%3DDTS10000150-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Imageer/listing1.html%3Fid%3DDTS10000150-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>