<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TB570: Sound Manager Q&amp;As</title>                                       <meta name="categories" content="Human Interface Toolbox"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002807" title="Sound Manager Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMusicAudio-date.html">Audio</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/MusicAudio/index.html" target="_blank">Reference Library > Audio</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TB570</div>
<div id="pageheadsub">Sound Manager Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Sep 01 1993]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Sound Manager 3.0 SndPlayFromDisk support</h2><p>Will the <code>SndPlayFromDisk</code> routine in the new Sound Manager version 3.0 work onMacintosh models without the Apple Sound Chip? For the current Sound Manager,is there a good way to tell whether a machine supports <code>SndPlayFromDisk</code>?</p><p>Sound Manager 3.0 supports <code>SndPlayFromDisk</code> on all models. Playing from disk isbased on the performance of the machine's SCSI device more than the SoundManager's performance. In earlier versions of the Sound Manager,<code>SndPlayFromDisk</code> works only on Apple Sound Chip machines.</p><p>The System 7.1 interface has a play-from-disk <code>Gestalt</code> flag in the soundattributes selector. If this flag bit is set, play from disk is supported. Ifyou're not running System 7.1, you'll have to guess based on whether theversion of the system being used has an Apple Sound Chip. So first check forthe new <code>Gestalt</code> flag and the presence of Sound Manager version 3.0 or later,which supports this flag. Older versions of the Sound Manager don't reportwhether play from disk is supported, so you'll have to check for the AppleSound Chip.</p><P><A HREF="#top">Back to top</A></p><h2>How to play Macintosh sounds in a continuous sequence</h2><P>Date Written:  11/15/90</p><P>Last reviewed:  3/18/92</p><p>When I open a Macintosh sound channel under System 6.0.5, I can use <code>SndPlay</code> toplay sampled sounds, one at a time. When I'm done, I close the channel UnderSystem 6.0.7, after the first sound is played, no other sounds will play. If Iclose and reopen the channel, I can play another sound, but only one (until Iclose and reopen the channel again). Why do sound routines that functionednormally in System 6.0.5 seem to operate incorrectly in System 6.0.7?</p><p>The problem is documented in the Sound Manager chapter of <i>InsideMacintosh</i> Volume VI. If you have a <code>'snd '</code> resource that has a synth definedin it, then you cannot open your own channel with a synth and then call <code>SndPlay</code>Because your code is playing the sound once, what is happening is that you havethe channel set up correctly but you are trying to use it twice. The only wayyou can play a <code>'snd '</code> with a synth is to create and dispose of the channel eachtime, as in the following code (the resource used is just a SoundEditresource):</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#include    &lt;Sound.h&gt;#define    TRUE   0xFF#define    FALSE  0main(){      Handle        Sound;      SndChannelPtr    chan;      int        i;      OSErr        err;      Sound = GetResource ('snd ', 100);      if (ResError() != noErr || Sound == nil)            Debugger();      for (i = 0; i &lt; 3; ++i) {            chan = nil;            err = SndNewChannel (&amp;chan, 0, 0, nil);            if (err != noErr)                  Debugger();            err = SndPlay (chan, Sound, FALSE);            if (err != noErr)                  Debugger();            err = SndDisposeChannel (chan,FALSE);            if (err != noErr)                  Debugger();            }</pre>	</TD></TR></TABLE></CENTER><p>If you want to play multiple sounds one after another, you may be able to do itby using the <code>bufferCmd</code>. You can just keep pumping sounds to it and it willcontinue to play them.</p><p>The way to tell if your <code>'snd '</code> has a synth is to check the third word in the<code>'snd '</code> file. If the value is a 5 then you have the synth set to <code>sampledSynth</code>. Aformat 2 snd is assumed to be for the <code>sampledSoundSnth</code>. In the case ofSoundEdit resources, you do get a synth. If you take this route, you will needto make sure that all the <code>'snd '</code> resources have been changed and you will wantto define the synth when you create the channel.</p><p>You can avoid having to dispose of the channel after each play if you make surethat each <code>'snd '</code> does not have a synth ID and then create the channel with theproper synth ID and play the <code>'snd '</code> using <code>SndPlay</code>. The one problem with this isthat you do not know when the sound is finished playing is you do theasynchronously.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>The this problem of using <code>SndPlay</code> more than once on a channel hasbeen fixed in System 7.</P></TD></TR></TABLE></CENTER><BR><P><A HREF="#top">Back to top</A></p><h2>Sound Manager versus Sound Driver</h2><P>Date Written:  11/6/90</p><P>Last reviewed:  3/18/92</p><p>We generate sounds using the Four-Tone Synthesizer (<code>StartSound</code>, <code>StopSound</code>). Ourapplication must run on all Macintosh computers and all system softwareversions starting with System 6.0. According to an early version of <i>InsideMacintosh</i> Volume VI, the Sound Manager's Four-Tone Synthesizer does notperform as expected on some Macintosh systems. When should we use the SoundManager and when should we use the Sound Driver?</p><p>The Sound Driver is no longer supported, as of System 6.0.7. The Four-ToneSynthesizer in the Sound Manager released with 6.0.7 does not work correctlyfor non-Apple Sound Chip (ASC) machines (Macintosh Plus, Macintosh SE,Macintosh Classic, and Macintosh LC). This has been fixed in System 7. If youneed to use the Four-Tone Synthesizer for non-ASC machines running 6.0.7, youcould try the Sound Driver with 6.0.7 on the chance it'll work for yourpurpose. Use the Sound Driver for non-ASC machines running System 6.0.5 andearlier. Note that there ARE problems when mixing the use of the Sound Driverand the Sound Manager. Also note that <code>SysBeep</code> is a call to the Sound Manager!</p><P><A HREF="#top">Back to top</A></p><h2>Specifying a Macintosh Sound Manager frequency</h2><P>Date Written:  11/20/90</p><P>Last reviewed:  3/18/92</p><p>Why don't the Macintosh System 6.0.5 Sound Manager's <code>noteCmd</code> and <code>freqCmd</code> allowyou to specify the frequency by specifying a three-byte frequency value, withthe least significant byte representing the fractional part of the frequency?According to <i>Inside Macintosh</i> Volume V, page 483, you should be able tospecify frequency in this way, as well as by the selection of a musical noteenumeration from an even-tempered scale (values 1 through 127). The SoundManager chapter in Volume VI of <i>Inside Macintosh</i> does not discussfrequency specification at all. Is support for this very valuable featureforthcoming?</p><p>We are currently unsure if the second method for specifying a frequency willever be supported. The problem is that there is no clean way to do the bytesharing which was suggested in <i>Inside Macintosh.</i> If we come up with someway to support this and still have a reasonable range of frequencies which canbe played, then we will do it.</p><P><A HREF="#top">Back to top</A></p><h2>Which Macintosh systems support internal speaker stereo mixing</h2><P>Date Written:  1/2/91</p><P>Last reviewed:  3/18/92</p><p>Why do I get only the left channel of a stereo sound out of my MacintoshIIcx?</p><p>The only Macintosh models that combine the two stereo channels into one forplayback out of the internal speaker are the Macintosh SE/30 and the IIsi. Allothers use just the left channel. If you would like to check for the machine'sability to do mixing, you can use Gestalt. This is documented in <i>InsideMacintosh</i> Volume VI, page 22-70. Bit 1 of the Gestalt selector for soundwill tell you whether the machine has stereo mixing on the internal speaker.</p><P><A HREF="#top">Back to top</A></p><h2>Macintosh code and instructions for generating dial tones</h2><P>Date Written:  1/17/91</p><P>Last reviewed:  3/18/92</p><p>My program lets a user dial the phone if a modem is connected to the user'sMacintosh. How can I add the option of dialing without using the modem, justlike HyperCard does? Is generating dial tones a standard function of the SoundManager?</p><p>So, ya wanna do dial tones just like HyperCard? Well, that's not so hard (aslong as you are patient enough to read through all the Sound Manager documentsand beat your head against the wall for half an hour, like I did). Thetechnique is simple: lift the <code>'snd '</code> resources from HyperCard and use them togenerate dial tones! (Yes, that's OK, <code>dtmf</code> tones are generic sounds; just don'tlift any of the other sounds!)</p><p>Start by using ResEdit to copy <code>'snd '</code> resources #130-145 from the HyperCardprogram file (I got them out of 2.0). Next use the Sound Manager to play themand to use them as an instrument definition for the <code>samplesynth</code>. Since this canbe tricky, and since you may or may not want dive deep into the Sound Manager,I am including a generic subroutine that I wrote that will "dial" for you. AllI ask is that if you use it "as is" in your application, please remember me inyour prayers.</p><p>How to use the dial procedure:</p><p>To call the dial procedure simply pass it a string and it will do the rest. Alldigits A thru D, # and * play the proper tone for the touch tone key; any othercharacters generate a 1/2 second delay. Each tone is sounded for about 1/4second. The interface to it is simply: <code>Procedure Dial(theNum:Str255)</code>. Pleasenote that in order to keep this short, very little error checking has beenadded, please add any/all that you need.</p><p>And now for the fabulous source code:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE Dial(theNum: Str255);VAR    i                  : Integer;    theSound           : Handle;    theResNum          : Integer;    dummy              : LongInt;    err                : OSErr;    chan               : SndChannelPtr;    cmd                : SndCommand;BEGIN    IF Length(theNum) = 0 THEN        Exit(Dial);    chan := NIL;        {allocate a channel}    err := SndNewChannel(chan, sampledSynth, 0, NIL);    IF err &lt;&gt; noErr        Exit(Dial);    FOR i := 1 TO Length(theNum) DO BEGIN        CASE theNum[i] OF            '0'..'9': theResNum := ord(theNum[i]) - ord('0') + 130;            'A'..'D': theResNum := ord(theNum[i]) - ord('A') + 140;            '*': theResNum := 144;            '#': theResNum := 145;            OTHERWISE theResNum := 0;        END;        IF theResNum &lt;&gt; 0 THEN BEGIN            {Load the proper sound resource}            theSound := GetResource('snd ', theResNum);            HLock(theSound);            {See sound manager docs for resource format of}            {type 2 sounds for more info}            cmd.cmd := soundCmd;            cmd.param1 := 0;            {This next line ASSUMES it was a format 2 'snd ' resource}            {This will not work for other 'snd ' resources}            cmd.param2 := ORD4(theSound^) + 14;            err := SndDoImmediate(chan, cmd);            {Now send the freqDurationCmd to play a middle C}            {that's how the instrument was defined in HyperCard}            cmd.cmd := freqDurationCmd;            cmd.Param1 := 4000;                 {2 seconds in duration}            cmd.Param2 := $FF000000 + 60;       {Loud + Middle c}            err := SndDoImmediate(chan, cmd);        END ELSE            Delay(30, dummy);   {all nonDTMF characters produce a delay...}    END;    err := SndDisposeChannel(chan, false);    HUnlock(theSound);</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></p><h2>Macintosh sndRecord filter proc structure</h2><P>Date Written:  8/30/91</p><P>Last reviewed:  3/18/92</p><p>What is the structure of a filter proc for <code>SndRecord</code>?</p><p>The filter procs used by <code>SndRecord</code> are identical to those used by the standardmodal dialog. You can find information on writing filter procs in <i>InsideMacintosh</i> Volume I, page I-415. For sample code, take a look at theMacintosh Technical Notes <A HREF = "../fl/fl_33.html">"Customizing Standard File"</a> and <A HREF = "../fl/fl_12.html">"Standard File Tips,"</a>and Sample Code #18 called StdFile.c</p><P><A HREF="#top">Back to top</A></p><h2>SndPlayDoubleBuffer doesn't work on Macintosh Plus or Classic</h2><P>Date Written:  8/30/91</p><P>Last reviewed:  3/18/92</p><p>The call <code>SndPlayDoubleBuffer</code> doesn't produce sound on the Macintosh Plus orClassic because neither model is equipped with an Apple Sound Chip (ASC). Thefollowing is a short blurb taken from <i>Inside Macintosh</i> Volume VI, page22-3 (second paragraph): "..the continuous play-from-disk routines and theability to produce concurrent multiple channels of sampled sound are currentlyavailable only on machines equipped with the ASC."</p><p>You can fake your own double-buffering routine, replacing <code>SndPlayDoubleBuffer</code>,by issuing a string of buffering commands followed immediately by a callbackroutine. While this task takes a bit 'o coding time, the method will work onall Macintosh models.</p><p>Alternatively, you can use the <code>Gestalt</code> function to test for the Apple SoundChip (ASC), and then use <code>SndPlayDoubleBuffer</code> only with Macintosh systems thathave the ASC.</p><P><A HREF="#top">Back to top</A></p><h2>SndDoImmediate versus SndDoCommands</h2><P>Date Written:  9/16/91</p><P>Last reviewed:  3/18/92</p><p>We want to allow the user to change the sound volume while a lengthy (manyseconds or minutes) sound is playing.</p><p>If the sound that is playing belongs to your application, then you should bedoing a <code>sndDoImmediate</code> with an <code>ampCmd</code> to change the amplitude of the currentsound. (See <i>Inside Macintosh</i> Volume VI, pages 22-50 thru 22-52, forinformation.) You should not set the system wide volume to accomplish this.Only the "new" Sound Manager running on a machine with the Apple Sound Chipsupports amplitude change.</p><P><A HREF="#top">Back to top</A></p><h2>SndStartFilePlay 20,000-byte minimum buffer size</h2><P>Date Written:  10/8/91</p><P>Last reviewed:  3/18/92</p><p>What's the minimum buffer size for <code>SndStartFilePlay</code>?</p><p>Currently <code>SndStartFilePlay</code> needs a buffer of at least 20,000 bytes(approximately 20K) to output sound without problems on the slowest Macintoshmodels.</p><P><A HREF="#top">Back to top</A></p><h2>Playing 16-bit sound data from a Macintosh disk</h2><P>Date Written:  10/22/91</p><P>Last reviewed:  3/18/92</p><p>What's the preferred method for playing sound from disk: with a doublebackroutine and <code>SndPlayDoubleBack</code> or though the queue with our own routines? Doesour 16-bit audio program have to convert the audio to 8-bit before playingthrough the Macintosh speaker or does the <code>DoubleBackPlay</code> or <code>StartSoundFilePlay</code>file playing routines do this for us?</p><p>The Sound Manager is not designed at this time to handle 16-bit sound data. Youwill need to convert the 16-bit data before giving it to the Sound Manager. Thebest method for playing from disk will be to make a doubleback routine and use<code>SndPlayDoubleBack</code>. You shouldn't need to completely roll your own, but you'llneed to take care of getting the data from disk, converting it to 8-bit dataand passing the data to the Sound Manager to be played. QuickTime will allowfor the playback of 16 bit data.</p><P><A HREF="#top">Back to top</A></p><h2>SndStartFilePlay: no NIL sound channel for asynchronous plays</h2><P>Date Written:  12/19/91</p><P>Last reviewed:  3/18/92</p><p><code>SndStartFilePlay</code> always returns a -205 <code>badChannel</code> error after the followingcall:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    sndChanPtr := NIL;    sndBufferPtr := NIL;    sndSelectionPtr := NIL;    sndCompletionProc := NIL;    sndErr := SndStartFilePlay(sndChanPtr, kSndFRefNum, resID,                               kSndBufferSize, sndBufferPtr,</pre>	</TD></TR></TABLE></CENTER><p>What's wrong here?</p><p>You need to pass <code>SndStartFilePlay</code> a valid, initialized sound channel if youplan on calling it asynchronously. The feature of passing NIL in to have theroutine allocate a channel for you <i>only</i> works if the asynchronousparameter is false.</p><P><A HREF="#top">Back to top</A></p><h2>Where to get Macintosh sound compression specs</h2><P>Date Written:  2/28/92</p><P>Last reviewed:  2/28/92</p><p>Where can I get technical specifications for Macintosh 4:1 sound compression?</p><p>The 4:1 and 8:1 sound compression techniques are part of Farallon's software,not part of Apple's system software. You must contact Farallon for technicalspecifications. You can contact Farallon at:</p><P>    Farallon<br>    1321 Wakarusa Dr. #2010<br>    Lawrence, KS  66049<br>    (913) 843-8101</p><P>The 3:1 and 6:1 sound compression techniques are Apple's. Technicalspecification for both are in the MACE Specifications, available through APDA(part number M0241LL/A). You can contact APDA at:</p><p>    APDA<br>    Apple Computer, Inc.<br>    20525 Mariani Avenue, Mail Stop 33-G<br>    Cupertino, CA  95014</p><P>AppleLink: APDA<br>    Phone:<br>      U.S.            800-282-2732<br>      Canada:         800-637-0029<br>      International:  408-562-3910<br>    FAX:              408-562-3971</p><p><A HREF="#top">Back to top</A></p><h2>Playing a sound from a Macintosh interrupt</h2><P>Date Written:  4/7/92</p><P>Last reviewed:  4/7/92</p><p>I queue a deferred task (which is already loaded and locked--the VBL doesn'tmove memory) to play a sound when my vertical retrace task checks for aparticular condition and this condition is met. The VBL is installed at INITtime, the deferred task is preloaded, and the sound is preloaded and locked.This works fine once the system has completed its startup, but if the VBLdetects the condition before startup has completed, such as at INIT time, theMacintosh will freeze. Does the Deferred Task Manager need to be initializedsomehow? Is there any Deferred Task Manager documentation besides what's in<i>Inside Macintosh</i> Volume V?</p><p>There's no additional information available on the Deferred Task Manager.<i>Inside Macintosh</i> Volume V covers it completely (however briefly). TheDeferred Task Manager does very little; it's designed primarily to allow yourinterrupt routine to have interrupts re-enabled before processing information.Why is this important? Well, system services like AppleTalk require thatinterrupts not be disabled for much more than 1/1000th of a second usually.This means if you are doing something large during your interrupt routine (whenall interrupts may be turned off), you could delay the AppleTalk interrupt solong that data gets lost. The Deferred Task Manager simply allows you toschedule a routine to get run at interrupt time, but while interrupts areenabled. This deferred task has to abide by two fundamental rules: (1) it mustbe interruptable--that is, you should not have to do anything such astiming-critical hardware access that can get screwed up with interrupts on, and(2) it must adhere to all the same tool/OS rules that an interrupt routine mustfollow. This means you cannot call any routine that may move memory; if you do,you can damage the current heap zone. If you image the flow of control for aninterrupt/deferred task it looks something like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Interrupt stops application in the middle of doing something                        |       System Interrupt handler decides who gets the interrupt       (interrupts off)                        |       Your interrupt handler gets called, decides that too much time needed       You defer the task and return (interrupts still off)                        |       System interrupt handler calls the rest of the interrupt routines       that need to be called (interrupts still off)                        |       System interrupt handler turns interrupts on (interrupts on)                        |       Your deferred task gets run (interrupts on, but memory moving bad)                        |</pre>	</TD></TR></TABLE></CENTER><p>There's no way to start the Deferred Task Manager; it's always running. TheSound Manager also is always running. The reason why this is particularly badat init time for you is that when making the mistake of allocating memory atinterrupt time, you can get away with it safely if the heap you're using(system heap) is not the application's current heap zone. At init time, thesystem heap is the current heap zone for the most part until an app getslaunched. At init time your chances of harming the system by moving memory atinterrupt time increases dramatically.</p><p><i>Inside Macintosh</i> Volume VI documents both <code>SndPlay</code> and <code>SysBeep</code> as calls thatmove memory and cannot be used at interrupt time. Also, by passing a NILchannel to <code>SndPlay</code> you are forcing memory allocation every time, since thechannel record needs to get allocated; you would be a little safer bypre-allocating a sound channel. Unfortunately <code>SndPlay</code> can still move memory,and many machines (68000 based) can only have one channel allocated at all, soyou would then be robbing the system of its only sound channel bypre-allocating it.</p><p>Your best bet if you want a sound to play from an interrupt is to use theNotification Manager (Chapter 24 of <i>Inside Macintosh</i> Volume VI) TheNotification Manager is primarily designed so background applications andinterrupt tasks (like VBLs) can get the user's attention with a flashing icon,sound, dialog or any combination of the above. And you can simply pass it anysound handle you might want to use. The Notification Manager will simply delayyour sound request until the system can play it back and not hurt anything.</p><P><A HREF="#top">Back to top</A></p><h2>Correct value of Macintosh initNoInterp</h2><P>Date Written:  5/28/91</p><P>Last reviewed:  3/18/92</p><p>Is there an error in <i>Inside Macintosh</i> Volume VI where it claims thatboth initNoInterp and initChan0 have the same value of $0004?</p><p>You're right, they're the same. According to the guy who is doing timeattempting to straighten out the Sound Manager, "initChan0 is ONLY used by thewaveTableSynth, initNoInterp is ONLY used by the sampledSynth." I'm alwaysgrateful for meaningful constant names, aren't you?!</p><P><A HREF="#top">Back to top</A></p><h2>Determining Macintosh Sound Manager version</h2><P>Date Written:  8/30/91</p><P>Last reviewed:  3/18/92</p><p>The call <code>SndSoundManagerVersion</code> returns 2018000 for the System 7.0 SoundManager and 2006000 for the System 6.0.7 Sound Manager, but it crashes ifearlier Sound Manager versions are in use. <code>SndSoundManagerVersion</code> is a selectorbased trap call which calls the trap <code>_SndDispatch</code>. Before calling<code>SndSoundManagerVersion</code> you need to check if <code>_SndDispatch</code> is implemented. If so,then you can make the call. Otherwise you have the "old" version of the SoundManager.</p><P><A HREF="#top">Back to top</A></p><h2>Using the Sound Manager to produce desired frequencies</h2><P>Date Written:  3/16/92</p><P>Last reviewed:  3/18/92</p><p>To generate arbitrary frequencies using sampled sounds, start with the originalsample rate and know what frequency was sampled. For example, to play a pitchof 440 Hz sampled at 11 kHz as a 460 Hz pitch, use the ratio of 460/440 as afixed point number and multiply this ratio by the original sample rate of 11kHz. Put this product into the sound header's sample rate and use it with abufferCmd to play your sound back at 460 Hz.</p><p>Consider overflows in your equations. Fixed point numbers have an upper rangeof 65K, otherwise they become negative numbers. Therefore, some sample ratesand pitches cannot be created. You will not be able to take a 22 kHz sampledsound and play it back three octaves higher. You could use the Standard AppleNumeric Environment (SANE) to calculate the number with more precision, butwould need to be careful with overflow. Also, you cannot use SANE at interruptlevel.</p><p><i>Inside Macintosh</i> Volume VI, which documents the Sound Manager, definessupported frequency values as 0-127. Arbitrary frequencies are not supported.The freqCmd is exactly the same as the freqDurationCmd but does not have anassociated duration. The Sound Manager has no way of determining the originalfrequency of the sound. A baseNote of 56 may be a pitch of 440 Hz, but if theoriginal pitch wasn't in equal temperament (a pitch represented by notes of apiano) it's impossible to represent this in the Sound Header.</p><p>Additionally, to support other frequencies a new sound command is needed. ThefreqCmd is documented as having its high byte used for amplitude, leaving threebytes to represent a frequency, but it should be a Fixed type number. This needwas not realized, though, until after the MPW interface was frozen and anagreement had been made with developers not to change the API.</p><p>The Sound Header was changed when the original Macintosh Audio Compression andExpansion (MACE) package was released. This was done in 1989. The MPW Soundinterfaces have been incorrect since then. The former field "baseNote" whichwas a word (with the high byte always being ignored) is now two fields. Thischange causes no problems for existing applications, but applications beingcompiled against the System 7 interfaces may need to be changed.</p><P><A HREF="#top">Back to top</A></p><h2>How can I play more than one Macintosh sample at a time?</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  3/18/92</p><p>How can I play more than one Macintosh sample at a time?</p><p>Unfortunately, the Sound Manager prior to System 6.0.7 can play only one sampleat a time. A basic limitation of the Sound Manager was that it only allows asingle channel open with the sampled sound <code>'snth'</code> and the note <code>'snth'</code>. The wavetable <code>'snth'</code> allows up to four channels at a time, but doesn't provide the samecapabilities as the sampled sound <code>'snth'</code>. Using System 6.0.7 or later (whichincludes the "new" Sound Manager) you can play multiple sampled sounds at onceby opening multiple sampled sound channels.</p><P><A HREF="#top">Back to top</A></p><h2>Why Macintosh system crashes when StartSound is launched twice</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  3/18/92</p><p>My Macintosh application calls <code>StartSound</code> when it starts. The second time it islaunched the system hangs. Why?</p><p>A bug in the <code>InitApplZone</code> trap is the cause of the bomb at the second launch.To avoid the problem, simply call <code>StopSound</code> before exiting the program. It isalso a good idea to call <code>StopSound</code> before calling <code>StartSound</code>, in case anotherprogram called <code>StartSound</code> but never called <code>StopSound</code>. The "glue" in MPW 2.0.2and later versions fixes this problem.</p><p>Note that the Sound Driver is no longer supported. You should be using theSound Manager to play sounds, and not the older driver calls such as<code>StartSound</code>.</p><p>X-Ref:</p><P>Macintosh Technical Note <A HREF = "tb_03.html">"How to Produce Continuous Sound without Clicking"</a></p><P><A HREF="#top">Back to top</A></p><h2>Changing the pitch of a sample in Macintosh Sound Manager</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  3/18/92</p><p>How do I specify different pitches for the sampled sound synthesizer of theMacintosh Sound Manager?</p><p>You should be using the <code>freqDurationCmd</code> to specify a pitch. Note that thesepitches are specified as MIDI note values. If you need pitches other than thepitches on the piano keyboard, then you'll have to calculate a new sample rate.(The <code>baseNote</code> field is only used internally by the Sound Manager.) You canchange the sample rate in the sound header and play it back at any rate.</p><p>X-Ref:</p><P>Macintosh Technical Note <A HREF = "tb_03.html">"How to Produce Continuous Sound without Clicking"</a></p><P><A HREF="#top">Back to top</A></p><h2>Specifying different frequencies for the Macintosh Note Synth</h2><P>Date Written:  45/3/89</p><P>Last reviewed:  3/18/92</p><p>How do I specify different frequencies for the Macintosh Note Synth?</p><p>The Note Synth sample code on page 484 of <i>Inside Macintosh</i> Volume V isincorrect. You should follow the <code>'snd '</code> method described on page 492. The pitchvalue should be specified in decimal notation as explained on page 483. Alsonote that the interface files shipped with pre-3.0 releases of MPW may beincorrect. The following code produces a note:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>{ Warning -- no error checking done here }Procedure DoSound;VAR    myErr : osErr;    amp, pitch : LONGINT;    myChannel : sndChannelPtr;    myCmd : sndCommand;BEGIN    amp := $FF000000;    pitch := 60;    myChannel := NIL;    WITH myCmd DO BEGIN      cmd := noteCmd;      param1 := 1000;      param2 := amp + pitch;    END;    myErr := SndNewChannel(myChannel, 1, 0, NIL);    myErr := SndDoImmediate(myChannel, myCmd);    myErr := SndDisposeChannel(myChannel, TRUE);</pre>	</TD></TR></TABLE></CENTER><p>X-Ref:</p><P>Macintosh Technical Note <A HREF = "tb_03.html">"How to Produce Continuous Sound without Clicking"</a></p><P><A HREF="#top">Back to top</A></p><h2>How to minimize clicking sound when using Mac Sound Manager</h2><P>Date Written:  5/3/89</p><P>Last reviewed:  3/18/92</p><p>When I use the Sound Manager with MultiFinder, I hear clicks before and aftermy sound plays. How can I stop the clicks?</p><p>The clicking is a hardware problem. The speaker clicks whenever the sound isturned on or off. There's nothing you can do about this. The Macintosh TechNote "How To Produce Continuous Sound Without Clicking" explains a techniquethat minimizes the clicking.</p><p>Because the sound hardware can't be shared among processes, if your program isusing the Sound Driver and another process attempts to use the Sound Manager,it's likely to crash the Mac. This includes <code>SysBeep</code> (in System 6.0 and later,<code>SysBeep</code> calls the Sound Manager). For this reason, your application shouldclose its sound channel when it receives a "suspend" event and when itterminates.</p><p>In systems without an Apple Sound Chip (the Macintosh Plus and SE), the SoundManager will either skip or repeat bytes, based on the sample and playbackrates. If you use a buffer size that is a multiple of 370 bytes and the<code>bufferCmd</code>, the clicking will be minimized, because the Sound Manager keeps aninternal 370-byte buffer. You don't need to use a VBL task (as the thisTechnical Note suggests) when using the Sound Manager--simply call the<code>bufferCmd</code> for every chunk of data. The Sound Manager maintains a queue of allthe commands. If 128 commands aren't enough, you can use the <code>callBackCmd</code> tofind out when your last command was processed, or you can create your own soundchannel and increase the number of commands held in its queue.</p><p>X-Ref:</p><P>Macintosh Technical Note <A HREF = "tb_03.html">"How to Produce Continuous Sound without Clicking"</a></p><P><A HREF="#top">Back to top</A></p><h2>Macintosh Sound Manager changes in System 6.0.4</h2><P>Date Written:  5/14/90</p><P>Last reviewed:  3/18/92</p><p>What changes have been made to the Macintosh Sound Manager?</p><p>System 6.0.3 Sound Manager changes: none</p><P>System 6.0.4 Sound Manager changes:</p><ul type="disc">	<li>The current Sound Manager is in the ROM of the Portable and IIci.</li>	<li>Sound Manager will not crash if the application calls <code>ExitToShell</code> without disposing its channels.</li>	<li>Sound Manager and Sound Driver conflicts have been resolved. While the Sound Driver is in use, the Sound Manager will not be available.</li>	<li><code>SysBeep</code> will flash the menu bar when a sound is active (<code>SoundActive</code> = TRUE). This sometimes crashed on the Macintosh Plus and SE.</li>	<li><code>SndNewChannel</code> will return an error if an attempt is made to allocate a second sampled sound channel. Previously, it would return a non-functioning channel and noErr.</li>	<li>Sound is no longer available in HyperCard XCMDs due to changes made in System 6.0.4 and HyperCard 1.2.5. HyperCard users have only the Play command. This was always unsupported by XCMD, but Sound Driver calls often worked. It was a risk and often crashed, but these conflicts were resolved in the Sound Manager. Now HyperCard will have to be revised to support an XCMD using sound.</li>	<li>A new bug was created in 6.0.4. <code>SndPlay</code> will install a <code>callBackCmd</code> into the channel when a sampled sound <code>'snd '</code> resource is being used. This causes the user's call-back routine, if present, to be called unexpectedly. The call-back routine can witness this additional callBackCmd by looking at its user parameters. Here's what the bogus <code>callBackCmd</code> being received by the call back procedure looks like:</li></ul><p>     cmd    = <code>callBackCmd</code></p><P>param1 = snd handle state bits, result of <code>GetHState(sndHandle)</code></p><P>param2 = handle to <code>'snd '</code></p><P>This happens when you supply a sound channel to <code>SndPlay</code> with a format 2 <code>'snd '</code>and specify <code>aSynch</code>.  It looks like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SndNewChannel(newChan, 0, 0, myCallBackProc);SndPlay(newChan, format2Snd, aSynch);</pre>	</TD></TR></TABLE></CENTER><P>The <code>callBackCmd</code> has two parameters that are for the programmer's use. Thecall-back routine is called at interrupt time, and the routine needs to set aglobal flag. As a solution, store a unique value in <code>param1</code> before issuing the<code>callBackCmd</code>. While in the <code>callBack</code> procedure, test for this value to determineif it is the correct <code>callBackCmd</code>.</p><P><A HREF="#top">Back to top</A></p><h2>SetupAIFFHeader bug</h2><P>Date Written:  4/1/92</p><P>Last reviewed:  5/21/92</p><p>I may have found a bug in the <code>SetupAIFFHeader</code> routine. When trying to create a44.1 kHz AIFF file header, the sample rate is converted into a negativeextended value. I think <code>SetupAIFFHeader</code> calls <code>Fix2X</code> which takes a signed fixedvalue and returns a signed extended value. Please let me know if this is abug.</p><p>You are absolutely correct. The Sound Manager routine <code>SetupAIFFHeader</code> does call<code>Fix2X</code> which in turn assumes that it is being passed a signed Fixed number.Until the bug is fixed, DTS recommends that you fill in the <code>sampleRate</code> field ofthe header yourself "</p><P><A HREF="#top">Back to top</A></p><h2>How to get MACE algorithms</h2><P>Date Written:  11/9/90</p><P>Last reviewed:  3/18/92</p><p>What are the Macintosh Audio Compression &amp; Expansion (MACE) algorithms thatwill allow me to translate the compressed digitized audio from my device intocompressed <code>'snd '</code> resource format?</p><p>The MACE algorithms are proprietary, but they are licensable. Contact Apple'sSoftware Licensing department for more information. You can reach them at (408)996-1010 or at AppleLink SW.LICENSE.</p><P><A HREF="#top">Back to top</A></p><h2>Macintosh System 6.0.5/MACE problem fixed for 6.0.7</h2><P>Date Written:  2/8/91</p><P>Last reviewed:  3/18/92</p><p>After playing a MACE-compressed sound several times under System 6.0.5, myMacintosh SE eventually hangs. The same code works fine under System 6.0.4 andSystem 6.0.7. Do you have any clues as to what is causing this?</p><p>MACE was shipped originally as a strange hack to System 6.0.4. It was notrevised for System 6.0.5 and as a result, it has never worked under 6.0.5. InSystem 6.0.7, MACE became part of the Sound Manager, so it should work fine onall systems from 6.0.7 on. Unfortunately, it is not going to ever work under6.0.5.</p><P><A HREF="#top">Back to top</A></p><h2>MACE-compressed sound -201 error</h2><P>Date Written:  12/20/91</p><P>Last reviewed:  3/18/92</p><p>We get a -201 (not enough sound hardware available) when we try to get ourbacklit Macintosh Portable (not PowerBook) to play MACE-compressed sounds. Whatare we doing wrong?</p><p>You're probably either (1) incorrectly opening the sound channel or (2) tryingto open too many sound channels or (3) being honest and using the <code>InitMACE3</code> or<code>InitMACE6</code> options to SndNewChannel. Take a look at how <A HREF = "downloads/SC.024.SoundApp.sea.hqx">SoundApp</a> (on the<i>Developer CD Series</i> CD) deals with MACE sounds.</p><p>The <code>InitMACE3</code> and <code>InitMACE6</code> options are used only when the Sound Manager istrying to figure out how much of the processor time it can use; they have nobearing on the actual playing of the sounds. By not specifying theseinitialization options, the Sound Manager will give you a channel and happilyplay your compressed sound on the PowerBooks. This is a known "feature" of theSound Manager.</p><P><A HREF="#top">Back to top</A></p><h2>MPW C sound.h header file fix</h2><P>Date Written:  11/21/89</p><P>Last reviewed:  12/17/90</p><p>I'm having trouble compiling &amp; linking with the sound routines and MPW C2.0.2.</p><p>The "sound.h" header file shipped with MPW C 2.0.2 was incorrect. The correctheader file is available on AppleLink in the Developer Services Bulletin Board,and is also shipped with MPW 3.0.</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (64K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tb_570.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tb/tb_570.html%3Fid%3DDTS10002807-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tb/tb_570.html%3Fid%3DDTS10002807-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tb/tb_570.html%3Fid%3DDTS10002807-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>