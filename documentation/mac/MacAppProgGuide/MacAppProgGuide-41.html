<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Overview (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING41></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-40.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-42.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-40.html"><B>Chapter 5 - Events and Commands</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING41-0></A>
<H1><A NAME=MARKER-9-20></A>Overview</H1>
 The central activity of a MacApp application is responding to events. For example, when a user types Command-N (equivalent to choosing the New command from the File menu), the application receives a key-down event from the Macintosh Operating System. The application examines the key-down event, determines that the Command key was pressed, and finds there is a menu command choice that corresponds to Command-N. The application responds to the menu choice by creating a command object that in turn creates a new document.<P>
 Other events are not generated by direct manipulation of the application. For example, an application may receive Apple events from a script or from the operating system. MacApp provides an important service by dispatching all types of events in a predictable and reliable manner. It also provides a mechanism to process the command objects your application creates to respond to events.<P>
 This chapter provides a detailed description of MacApp's mechanism for processing events and commands. While most developers won't need to modify the basic mechanism, the information in this chapter will be useful for those who do. For others, it will make it easier to understand and build on MacApp's foundation.<P>
<A NAME=HEADING41-4></A>
<H2>Events and Commands</H2>
 A MacApp application has a single application object. The application object periodically retrieves events from the operating system and dispatches them to objects that can handle them. <A HREF=MacAppProgGuide-19.html#MARKER-9-58>Figure 1-4 on page 13</A> shows a simplified version of this process.<P>
 An object in a MacApp application typically responds to an event by performing an operation or by creating a command object to perform an operation. Command objects are posted to the application's command queue, which is described in the next section.<P>
 MacApp provides the <CODE><A NAME=MARKER-2-21></A>TEvent</CODE> class and its subclasses to represent events. One subclass, <CODE><A NAME=MARKER-10-2></A>TToolBoxEvent</CODE>, encapsulates the information from a Macintosh Toolbox event. These classes are shown in <A HREF=#MARKER-9-26>Figure 5-1</A>.<P>
 Another subclass of <CODE>TEvent</CODE>, the <CODE><A NAME=MARKER-2-23></A>TCommand</CODE> class, serves as the superclass for MacApp's command classes. The <CODE>TCommand</CODE> class provides fields and methods for doing, undoing, and redoing a command operation (see <A HREF=MacAppProgGuide-44.html#MARKER-9-142>"Performing Operations With Command Objects," beginning on page 117</A>).<P>
<B>Figure 5-1  <A NAME=MARKER-2-24></A><A NAME=MARKER-2-25></A><A NAME=MARKER-9-26></A>Event, command, and command-handling classes in MacApp</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-060.gif"><P>
<A NAME=HEADING41-11></A>
<H2><A NAME=MARKER-9-27></A>The Command Queue</H2>
 <A NAME=MARKER-2-28></A>A MacApp application object maintains a queue for storing commands. When an object in your application posts a command to perform an operation, MacApp inserts the command into the command queue. Commands are processed on a first-in, first-out basis. Most commands are processed only once, so by default a command is nonrecurring--its <CODE><A NAME=MARKER-2-29></A>fRecurring</CODE> field is initialized to <CODE>FALSE</CODE>. After performing a command, the application deletes it from the command queue, unless it is a recurring command--its <CODE>fRecurring</CODE> field has been set to <CODE>TRUE</CODE>.<P>
<DL>
<DT><B>Note</B>
<DD>For historical reasons, the <CODE>TApplication</CODE> field used to store commands is called <CODE><A NAME=MARKER-2-30></A>fEventList</CODE>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING41-14></A>
<H2><A NAME=MARKER-9-31></A>The Main Event Loop</H2>
 <A NAME=MARKER-2-32></A>The application object's <CODE><A NAME=MARKER-2-33></A>MainEventLoop</CODE> method periodically retrieves an event from the operating system or a command from the command queue. Several methods of the application object work together to retrieve and process events and commands. There are two key points to keep in mind about MacApp's main event loop processing:<P>
<UL>
<LI>The application object retrieves events from the operating system in a timely manner and dispatches them by calling methods of the objects in your application.
<LI>The application object also retrieves and executes command objects posted by your application.<P>
</UL>
<A NAME=HEADING41-18></A>
<H2>Event- and Command-Handling Classes</H2>
 <A NAME=MARKER-2-34></A><A NAME=MARKER-2-35></A>To dispatch an event or perform a command, MacApp calls methods defined in three base classes in its class library. Your objects that respond to events and commands generally descend from these classes:<P>
<DL>
<DT><CODE>TEventHandler<B></B></CODE>
<DD> The <CODE>TEventHandler</CODE> class defines a number of fields and methods for responding to events.
<DT><CODE>TCommandHandler<B></B></CODE>
<DD> The <CODE>TCommandHandler</CODE> class is a subclass of <CODE>TEventHandler</CODE>. It adds support for responding to an event with a command object. Command objects perform operations that can be done, undone, and redone.
<DT><CODE>TBehavior<B></B></CODE>
<DD> The <CODE>TBehavior</CODE> class is designed to modify the behavior of an event-handling class (subclasses of either <CODE>TEventHandler</CODE> or <CODE>TCommandHandler</CODE>). Behaviors are described in the next section.
</DL>
 MacApp classes <CODE>TApplication</CODE>, <CODE>TDocument</CODE>, <CODE>TView</CODE>, and <CODE>TWindow</CODE> (a subclass of <CODE>TView</CODE>) all descend from <CODE>TCommandHandler</CODE>. When you define a subclass of one of these classes, your subclass is capable of handling both events and commands. <A HREF=#MARKER-9-26>Figure 5-1</A> shows the class hierarchy for MacApp's important command-handling classes.<P>
<DL>
<DT><B>Note</B>
<DD>You rarely define a direct subclass of the <CODE>TEventHandler</CODE> class--more often you define a subclass of <CODE>TCommandHandler</CODE> or one of its subclasses.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING41-25></A>
<H2><A NAME=MARKER-2-39></A><A NAME=MARKER-9-40></A><A NAME=MARKER-9-41></A><A NAME=MARKER-9-42></A><A NAME=MARKER-9-43></A>Behaviors</H2>
 MacApp supplies the <CODE>TBehavior</CODE> class to provide a mechanism for altering the behavior of event-handler objects (objects based on <CODE><A NAME=MARKER-2-44></A>TEventHandler</CODE> or one of its subclasses). A <B>behavior</B> class serves as a filter that can intercept selected method calls and perform an action. You create a behavior object and attach it to an event-handler object, which becomes its owner. Each behavior can point to another behavior, allowing you to form a linked list of behaviors attached to an event-handler object. Each behavior can be enabled or disabled.<P>
 A behavior object is able to modify the actions of an event handler because its methods are called before the corresponding methods of its owner. <A HREF=MacAppProgGuide-42.html#MARKER-9-85>"Behaviors and the Target Chain," beginning on page 107</A>, describes how MacApp dispatches events to objects with attached behaviors.<P>
 Behavior classes usually have fewer fields and methods than event-handling classes, so they tend to be small, simple, and efficient. MacApp itself uses behavior classes to help support a number of application services, including Clipboard management, drag-and-drop support, dialog-box support, print handling, and tabbing between views.<P>
 The <CODE><A NAME=MARKER-2-45></A>TBehavior</CODE> class contains methods that provide a broad range of options for modifying the behavior of an event-handling class:<P>
<UL>
<LI><B>Behavior management.</B> The <CODE>TBehavior</CODE> class has methods that manage the behaviors attached to an event-handler object, including methods to add a behavior, remove a behavior, get the next behavior or the next enabled behavior, and insert a behavior before or after a particular behavior.
<LI><B>Event filtering.</B> The <CODE>TBehavior</CODE> class has many methods that modify the operation of the event-handler object the behavior is attached to, including <CODE><A NAME=MARKER-2-46></A>DoCommandKeyEvent</CODE>, <CODE>DoEvent</CODE>, <CODE>DoKeyEvent</CODE>, <CODE><A NAME=MARKER-2-47></A>DoKeyUp</CODE>, <CODE>DoMenuCommand</CODE>, <CODE>DoMouseCommand</CODE>, <CODE>DoMouseUp</CODE>, <CODE>DoScriptCommand</CODE>, <CODE>DoSetCursor</CODE>, <CODE><A NAME=MARKER-2-48></A>DoSetupMenus</CODE>, <CODE>Draw</CODE>, and <CODE>DoToolboxEvent</CODE>.
<LI><B>Idling.</B> The <CODE>TBehavior</CODE> class has methods that set the idle frequency, check idle timing, and perform idle-time operations.
<LI><B>Stream support.</B> As a descendant of the <CODE>TObject</CODE> class, the <CODE>TBehavior</CODE> class has methods that read data from a stream or write data to a stream.<P>
</UL>
 You can read more about <CODE>TBehavior</CODE> and its subclasses in the <I>MacApp Class and Method Reference</I>.<A NAME=MARKER-2-49></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-40.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-42.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
