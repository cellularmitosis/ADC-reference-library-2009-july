<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><TITLE>Technical Q&amp;A QD35: Determining The Selected Printer's Address</TITLE><meta name="keywords" content="Mac OS 8 QuickDraw determining name addrress network printer"><meta name="Description" content="Q&amp;A thoroughly explains how to determine the address or name of the currently selected printer (assuming that it is a network or shared printer)."><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001794" title="Determining The Selected Printer's Address"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QD35</div>
<div id="pageheadsub">Determining The Selected Printer's Address</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <TD align="left"><HR ALIGN="center" WIDTH="550"><p id = p2>Q:  How do I determine the network address of the currently selected printer (assuming that it is a network printer)?</p><p id=p4>A:  Usually, you can get name of the current printer from the '<code>PAPA</code>' (-8192) resource in the chosen printer's driver. Unfortunately, it can be difficult tofind the chosen printer's driver, and calling <code>PrOpen</code> to make the currentdriver's resource file the current resource file can cause problems whenPrintMonitor is printing in the background. </p><p id=p4>Attached is some <a href= "downloads/CurrentPrinter_68k.hqx">sample code</a> for you to use.</p><p id=p4>The following is the most reliable way to find the chosen printer's driver:</p><ul><li><p id=p4>If the Alias Manager is present, then load '<code>alis</code>' -8192 from the System'sresource fork. Since this alias points to the chosen printer's driver, all youhave to do is call <code>ResolveAlias</code> to obtain an <code>FSSpec</code>.</p></li><li> <p id=p4>If the Alias Manager is not present, load '<code>STR</code> ' -8192 from the System'sresource fork. This string contains only the name (not the entire path) of thechosen printer's driver, so you'll need to look for the file in either theExtensions folder or the System folder.</p></li></ul><p id=p4>Once you've located the chosen printer's driver using one of thesemethods, open its resource (using <code>HOpenResFile</code> or <code>FSpOpenResFile</code>) and loadthe '<code>PAPA</code>' resource. Be aware that not all printers (not even all sharableprinters) have '<code>PAPA</code>' resources.</p><p id=p4>Prior to the introduction of GrayShare, there were only two basic classes ofprinters: local printers (a printer connected to and usable only by thecomputer it is connected to) and network printers (a printer networked to andusable by several computers).</p><p id=p4>Local printers cannot be named, so they are identified by the port they areconnected to. For this reason, the following printer drivers do not allow namesto be attached to printers:</p><ul>  <li>Personal LaserWriter SC</li>  <li>Personal LaserWriter LS</li>  <li>StyleWriter</li>  <li>ImageWriter</li>  <li>LQ ImageWriter</li></ul><p id=p4>Network printers, by contrast, are nameable. A copy of the selected printer'sname is encoded in the driver's '<code>PAPA</code>' resource ID -8192. Drivers in thiscategory currently include:</p><ul>  <li>LaserWriter</li>  <li>AppleTalk ImageWriter</li>  <li>AppleTalk LQ ImageWriter</li></ul><p id=p4>Since the introduction of GrayShare, there are three classes of printers:local, network, and shared. Shared printers are those that are connected to onemachine but can optionally be shared by other machines on a network. Sharedprinters store a copy of the selected printer's name in the driver's '<code>PSEL</code>'resource ID -8192. Drivers in this category currently include:</p><ul>  <li>LaserWriter Select 300</li>  <li>StyleWriter II</li></ul><p id=p4>A GrayShare driver such as StyleWriter II can operate in either of two modes.If the user selects a StyleWriter that is connected to a serial port, thedriver behaves like a local printer driver. If the user selects a sharedprinter, the driver must act as a client to the printer owner's server. In thissituation the driver appears to behave as a normal networked printer, eventhough the actual mechanism used is considerably different.</p><p id=p4>Although the '<code>PSEL</code>' resource type is currently undocumented, most of theinformation it contains is identified as follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<TD BGCOLOR="#E6E6E6" align="left"><PRE>OFFSET	LENGTH	USAGE0	2	mode: if shared = 0xFFFF, if local=0x0000<br>2	34	user's name<br>36	34	printer's name:  if local, name=type<br>36	34	printer's type  e.g.  \pStyleWriterII  <br>70	34	printer's zone  e.g.  \p*  <br>104	102	other<br></PRE>	</TD></TR></TABLE></CENTER><p id=p4>Most applications can rely on finding the name of a LaserWriter being in '<code>PAPA</code>'-8192. In the future, however, you may not be able to assume that the name of ashared device will be found in '<code>PSEL</code>' -8192. The '<code>PAPA</code>' resource has beenstandardized by historical usage, but GrayShare is nearly new, and it is not asthoroughly documented. Because GrayShare drivers may encode internalinformation differently in the future, we recommend checking the version of thedevice's driver before using its '<code>PSEL</code>' to make your software more robust andto retain maximum compatibility.</p><p id=p4>There is an old undocumented technique for bypassing the chooser bymanipulating the values stored in the places mentioned above. If you arethinking of doing this, take note of the following question and answer:</p><p id=p4>Question:</p><p id=p4>We've been manually writing '<code>PAPA</code>', '<code>STR</code> ' and '<code>alis</code>' resources inthe System file and in the LaserWriter driver to change printers without usingthe Chooser. This method sometimes causes errors with LaserWriter 8.0. What dowe need to do?</p><p id=p4>Answer:</p> <p id=p4>LaserWriter 8.0 needs to know more about the printer than its AppleTalkname -- it also has to have a parsed and ready-to-use PPD file for thatprinter. Since there's so little memory available in applications such as theFinder during printing, parsing is done at Chooser time, not at print time.</p><p id=p4>Apple has always said, We can't guarantee that you can change printers behindthe Chooser's back, and with LaserWriter 8.0 this is true. If the driver hasparsed a PPD file and has it ready, this should work, but you would have tohave manually chosen that printer before and set everything up. If you set up aLaserWriter IINTX printer with the correct PPD file, then choose a LaserWriterIIf, and then another printer driver, you can probably switch back to theLaserWriter IINTX programmatically. However, the driver will use the LaserWriter IIf PPD file with it, which may or may not cause PostScript errors. Designing the driver to be switchable by other applications was not a priority of the Adobe/Apple development team.</p><p id=p4>As long as you try to switch to a printer that uses the same PPD file that thedriver last parsed (the PPD associated with the last printer selected in theChooser), there shouldn't be any more problems than there were before withearlier printer drivers.</p><p id=p4>With QuickDraw GX, many things have changed, so you may need to re-think yourapplication's objectives in this environment. QuickDraw GX includes an all-newprinting manager and API, all-new extendable printer drivers, and an all-newChooser interface with desktop printer icons. It doesn't even have a '<code>PAPA</code>'resource, but fortunately, much of what you are trying to do (pre-processingand redirecting batches of files) can be accomplished much more cleanly andsafely with the Message Override or Printing Extensions mechanisms. The following is a list of publications you can use to obtain more information:</p><ul><li><i>develop #16: Print Hints - LaserWriter 8 for Fun and Profit</i></li><li><i>Inside Macintosh: QuickDraw GX Programmers Overview</i></li><li><i>Inside Macintosh: QuickDraw GX Printing</i></li><li><i>Inside Macintosh: QuickDraw GX Printing Extensions and Drivers</i></li></ul></td></tr></table></CENTER><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[Nov 22 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qd/qd35.html%3Fid%3DDTS10001794-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qd/qd35.html%3Fid%3DDTS10001794-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qd/qd35.html%3Fid%3DDTS10001794-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --> <HR width=550 align=center> </BODY> </HTML>