<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Spotlight Importer Programming Guide: Writing a Spotlight Importer</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Writing a Spotlight Importer"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001275" title="Writing a Spotlight Importer"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../FileManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000448" target="_top">File Management</a> &gt; <a href="../index.html" target="_top">Spotlight Importer Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="SchemaRef.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Performance.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40001275-CJBEJBHH" title="Writing a Spotlight Importer"></a><hr /><H1>Writing a Spotlight Importer</H1><p>Spotlight importers should be provided by all applications that support custom document formats. A Spotlight importer parses your document format for relevant information and assigning that information to the appropriate metadata keys.</p><p>An example metadata importer that extracts metadata from a custom document is included in the <code>/Developer/Examples/Metadata/ImporterExample</code>. This example is referred to throughout this article.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-199284">Creating the Metadata Importer Project</a>
				
			<br/>
			
        
			
			
				<a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-207655">Assigning a Unique ID to the Import Function</a>
				
			<br/>
			
        
			
			
				<a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-197081">Associating an Importer with Document Types</a>
				
			<br/>
			
        
			
			
				<a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-196325">Specifying Metadata Attributes</a>
				
			<br/>
			
        
			
			
				<a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-208147">Assigning Values to Metadata Attributes</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001275-199284" title="Creating the Metadata Importer Project"></a><h2>Creating the Metadata Importer Project</h2><p>Xcode provides a project template, Metadata Importer, that provides the functionality commonly shared by importers.</p><p>This template creates a project with the required frameworks, a template for the <code>Info.plist</code>, a template for the schema file, a template for the localizable <code>schema.strings</code> file, a template for the <code>main.c</code> file that contains the necessary CFPlugin implementation and <code>GetMetadataForFile.c</code>, a skeleton implementation of the required callback function. The target creates a CFPlugin bundle with an <code>mdimporter</code> extension.</p><p>In addition to writing the extraction code, you’ll need to modify the templates to specify the document types your importer handles and list the keys your importer provides.</p><a name="//apple_ref/doc/uid/TP40001275-207655" title="Assigning a Unique ID to the Import Function"></a><h2>Assigning a Unique ID to the Import Function</h2><p>Each plug-in factory that can import metadata must have a unique identification number associated with it. Typically, there is only a single plug-in factory for each metadata importer, as a single function can handle many document types.</p><p>When you create a new metadata importer project, Xcode creates a UUID for your importer. Here is the UUID xCode generated for the sample metadata importer.</p><div class="codesample"><table><tr><td scope="row"><pre>8AED83B3-C412-11D8-85A3-000393D59866<span></span></pre></td></tr></table></div><p>This value is used in the importer’s <code>Info.plist</code>, as well as the <code>main.c</code> file. <span class="content_text">Listing 1</span> shows the Info.plist template that was generated by Xcode.</p><a name="//apple_ref/doc/uid/TP40001275-196471-BABIEDHD" title="Listing 1Metadata importer Info.plist template"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-196471" title="Listing 1Metadata importer Info.plist template"></a><strong>Listing 1&nbsp;&nbsp;</strong>Metadata importer Info.plist template</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"<span></span></pre></td></tr><tr><td scope="row"><pre> "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;plist version="1.0"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleDevelopmentRegion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>English&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleDocumentTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeRole&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>MDImporter&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>LSItemContentTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>SUPPORTED_UTI_TYPE&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleExecutable&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>MyCustomImporter&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleIconFile&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleIdentifier&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>com.apple.yourcfbundle&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleInfoDictionaryVersion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>6.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundlePackageType&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>BNDL&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleSignature&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>????&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleVersion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>1.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFPlugInDynamicRegisterFunction&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFPlugInDynamicRegistration&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>NO&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFPlugInFactories&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>8AED83B3-C412-11D8-85A3-000393D59866&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>MetadataImporterPluginFactory&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFPlugInTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>8B08C4BF-415B-11D8-B3F9-0003936726FC&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>8AED83B3-C412-11D8-85A3-000393D59866&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFPlugInUnloadFunction&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/plist><span></span></pre></td></tr></table></div><p>The <code>CFPlugInFactories</code> entry is a dictionary that associates the metadata importer host ID to the UUIDs of the plug-in factory function an importer requires. The <code>CFPluginInTypes</code> dictionary contains keys that associate the UUID of the factory function to the function. In both locations, Xcode inserted the newly generated UUID.</p><p>Here is the relevant line from the <code>main.c</code> template that Xcode created.</p><a name="//apple_ref/doc/uid/TP40001275-197053-BABFBBBD" title="Listing 2Setting the importer ID in main.c"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-197053" title="Listing 2Setting the importer ID in main.c"></a><strong>Listing 2&nbsp;&nbsp;</strong>Setting the importer ID in main.c</p><div class="codesample"><table><tr><td scope="row"><pre>#define PLUGIN_ID "8AED83B3-C412-11D8-85A3-000393D59866"<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001275-197081" title="Associating an Importer with Document Types"></a><h2>Associating an Importer with Document Types</h2><p>An importer must be associated with the document types that it can import. You do this by specifying the Uniform Type Identifiers (UTIs) that correspond to the supported documents.</p><p>The supported UTIs are specified in the <code><!--a  -->LSItemContentTypes<!--/a--></code> array in the importer’s <code>Info.plist</code>. The template in <span class="content_text"><a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-196471-BABIEDHD">Listing 1</a></span> includes a placeholder, <code>SUPPORTED_UTI_TYPE</code>, that you should replace with the UTI that your importer handles. If more than one document type is supported you can add additional string entries to the <code><!--a  -->LSItemContentTypes<!--/a--></code> array in the <code>Info.plist</code>. In the example importer, the <code>SUPPORTED_UTI_Type</code> is <code>com.apple.mycocoadocumentapp.mycustomdocument</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001275-DontLinkElementID_8" title="Note"></a><p><strong>Note:</strong>&nbsp;If an importer reads metadata from a document package you must add <code>com.apple.package</code> to the array of UTIs declared in the <code>UTTypeConformsTo</code> entry.</p></div><p>If your application does not define a UTI for its document types, you can declare one in your importer's <code>Info.plist</code> by adding the <code>UTExportedTypeDeclarations</code> key. Standalone importers that don't correspond to an application should declare the UTIs that they support by specifying a <code>UTImportedTypeDeclarations</code> key. The <code>UTImportedTypeDeclarations</code> format is the same as the <code>UTExportedDeclarations</code> format shown in <span class="content_text"><a href="WritingAnImp.html#//apple_ref/doc/uid/TP40001275-SW1">Listing 3</a></span>. See  “<span class="content_text"><!--a target="_top" -->Uniform Type Identifier Concepts<!--/a--></span>” for more information on declaring UTIs.</p><a name="//apple_ref/doc/uid/TP40001275-SW1" title="Listing 3UTExportedTypeDeclarations format"></a><p class="codesample"><strong>Listing 3&nbsp;&nbsp;</strong>UTExportedTypeDeclarations format</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key>UTExportedTypeDeclarations&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UTTypeIdentifier&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>com.yourcompany.yourUTI&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UTTypeReferenceURL&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>http://www.company.com/yourproduct&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UTTypeDescription&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;string>Your Document Kind String&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UTTypeConformsTo&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>public.data&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>public.content&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;key>UTTypeTagSpecification&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>com.apple.ostype&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>XXXX&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>public.filename-extension&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>xxxx&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/array><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001275-196325" title="Specifying Metadata Attributes"></a><h2>Specifying Metadata Attributes</h2><p>You need to specify the metadata attributes that your metadata importer returns by modifying the project’s <code>schema.xml</code> file. This is an XML Schema document that provides details on the returned attributes and allows you to specify custom metadata keys as well.</p><p><span class="content_text">Listing 4</span> shows the <code>schema.xml</code> template generated by Xcode.</p><a name="//apple_ref/doc/uid/TP40001275-209882-BABCIBBI" title="Listing 4Metadata Importer schema.xml template "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-209882" title="Listing 4Metadata Importer schema.xml template "></a><strong>Listing 4&nbsp;&nbsp;</strong>Metadata Importer schema.xml template </p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;schema version="1.0" xmlns="http://www.apple.com/metadata"<span></span></pre></td></tr><tr><td scope="row"><pre>                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<span></span></pre></td></tr><tr><td scope="row"><pre>                      xsi:schemaLocation="http://www.apple.com/metadata<span></span></pre></td></tr><tr><td scope="row"><pre>file:///System/Library/Frameworks/CoreServices.framework/Frameworks/Metadata.framework/Resources/MetadataSchema.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;note><span></span></pre></td></tr><tr><td scope="row"><pre>        Custom attributes that this metadata importer supports.  Below<span></span></pre></td></tr><tr><td scope="row"><pre>    is an example of a multivalued string attribute.  Other types<span></span></pre></td></tr><tr><td scope="row"><pre>    are CFNumber, CFDate, CFBoolean and CFData.<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/note><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;attributes><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;attribute name="com_Foo_YourAttrName" multivalued="true" type="CFString"/><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/attributes><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;types><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;type name="SUPPORTED_UTI_TYPE"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;note><span></span></pre></td></tr><tr><td scope="row"><pre>        The keys that this metadata importer handles.<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/note><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;allattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        com_Foo_YourAttrName<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/allattrs><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;displayattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        com_Foo_YourAttrName<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/displayattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/type><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/types><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/schema><span></span></pre></td></tr></table></div><p>You must edit this template to suit your metadata importer. </p><ol class="ol"><li class="li"><p>Replace the <code>SUPPORTED_UTI_TYPE</code> placeholder with the appropriate UTI type for your document.</p></li><li class="li"><p>Edit the <code>attributes</code> element, editing or removing the <code>attribute</code> elements as required. </p><p>The metadata keys are prefixed with the reverse DNS naming schema, replacing “_” with “.” for key-value coding compatibility. Each of these custom metadata values return a single CFString as specified by the <code>type</code> attribute of the <code>attribute</code> element.</p><p>Metadata importers can only return the following CF types: CFString, CFNumber, CFBoolean, and CFDate. If a key returns an array of values, the <code>type</code> attribute specifies the CF type and the <code>attribute</code> element must include a <code>multivalued</code> attribute with a value of <code>true</code>.</p><p>If your importer does not require custom metadata keys, you can remove the <code>attributes</code> element entirely.</p></li><li class="li"><p>Edit the <code>allattrs</code> element so that it contains all your metadata keys.</p></li><li class="li"><p>Edit the <code>displayattrs</code> element so that it contains a subset of your metadata keys that are recommended for previewing.</p></li><li class="li"><p>Edit the <code>schema.strings</code> file to provide display name and description strings for your custom metadata keys.</p></li></ol><p><span class="content_text">Listing 5</span> shows the <code>schema.xml</code> file that is included with the sample metadata importer project.</p><a name="//apple_ref/doc/uid/TP40001275-196660-BABDCFBD" title="Listing 5schema.xml file for the sample metadata importer"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-196660" title="Listing 5schema.xml file for the sample metadata importer"></a><strong>Listing 5&nbsp;&nbsp;</strong>schema.xml file for the sample metadata importer</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;schema version="1.0" xmlns="http://www.apple.com/metadata"<span></span></pre></td></tr><tr><td scope="row"><pre>                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<span></span></pre></td></tr><tr><td scope="row"><pre>                      xsi:schemaLocation="http://www.apple.com/metadata<span></span></pre></td></tr><tr><td scope="row"><pre>file:///System/Library/Frameworks/CoreServices.framework/Frameworks/Metadata.framework/Resources/MetadataSchema.xsd"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;note><span></span></pre></td></tr><tr><td scope="row"><pre>        Custom attributes that this metadata importer supports.  Below<span></span></pre></td></tr><tr><td scope="row"><pre>    is an example of a multivalued string attribute.  Other types<span></span></pre></td></tr><tr><td scope="row"><pre>    are CFNumber, CFDate, CFBoolean and CFData.<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/note><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;attributes><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;attribute name="com_apple_myCocoaDocumentApp_myCustomDocument_notes" multivalued="false" type="CFString"/><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/attributes><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;types><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;type name="com.apple.mycocoadocumentapp.mycustomdocument"><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;note><span></span></pre></td></tr><tr><td scope="row"><pre>        The keys that this metadata importer handles.<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/note><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;allattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        com_apple_myCocoaDocumentApp_myCustomDocument_notes<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/allattrs><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;displayattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        com_apple_myCocoaDocumentApp_myCustomDocument_notes<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/displayattrs><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/type><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/types><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/schema><span></span></pre></td></tr></table></div><p>The sample metadata importer declares one new attribute key, <code>com_apple_myCocoaDocumentApp_myCustomDocument_notes</code>. The key name is prefixed with the reverse DNS naming schema, replacing “_” with “.” for key-value coding compatibility. Each of these custom metadata values return a single CFString as specified by the <code>type</code> attribute of the <code>attribute</code> element. </p><p><span class="content_text">Listing 6</span> shows the schema.strings file for the sample metadata importer.</p><a name="//apple_ref/doc/uid/TP40001275-208178-BABFHJBG" title="Listing 6Sample importer&acirc;&#128;&#153;s schema.strings file"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-208178" title="Listing 6Sample importer&acirc;&#128;&#153;s schema.strings file"></a><strong>Listing 6&nbsp;&nbsp;</strong>Sample importer’s schema.strings file</p><div class="codesample"><table><tr><td scope="row"><pre>"com_apple_myCocoaDocumentApp_myCustomDocument_notes" = "Notes";<span></span></pre></td></tr><tr><td scope="row"><pre>"com_apple_myCocoaDocumentApp_myCustomDocument_notes.Description" = "What it is you're supposed to remember.";<span></span></pre></td></tr></table></div><p>The command-line tool <code>mdcheckschema</code> performs a simple validation on a schema and is useful when testing your own importer schema for validity.</p><a name="//apple_ref/doc/uid/TP40001275-208147" title="Assigning Values to Metadata Attributes"></a><h2>Assigning Values to Metadata Attributes</h2><p>When metadata is extracted for a file, the <code><!--a-->GetMetadataForFile<!--/a--></code> function is called. The function is passed the plug-in interface, a mutable dictionary that you’ll add the metadata attribute keys and values to, the UTI type of the target file, and the full path to the target file.</p><p><span class="content_text">Listing 7</span> shows the <code><!--a-->GetMetadataForFile<!--/a--></code> skeleton implementation provided by Xcode in <code>GetMetadataForFile.c</code>.</p><a name="//apple_ref/doc/uid/TP40001275-197514-BABIBACA" title="Listing 7GetMetadataForFile template implementation"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-197514" title="Listing 7GetMetadataForFile template implementation"></a><strong>Listing 7&nbsp;&nbsp;</strong>GetMetadataForFile template implementation</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean GetMetadataForFile(void* thisInterface,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFMutableDictionaryRef attributes,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFStringRef contentTypeUTI,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFStringRef pathToFile)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Pull any available metadata from the file at the specified path */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Return the attribute keys and attribute values in the dict */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Return true if successful, false if there was no data provided */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    #warning To complete your importer please implement the function GetMetadataForFile in GetMetadataForFile.c<span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Your implementation of this function should extract the metadata from the file and insert it into the dictionary with the appropriate keys and values. If it successfully returns metadata, the function should return with a value of <code>true</code>. If no metadata was extracted, you should return <code>false</code>. </p><p>The example’s custom document format is a simple property list containing the author, title and reminder notes.  Note that the example makes use of Objective-C and the Foundation class NSDictionary to read the dictionary from the file. In order to use Objective-C in your <code><!--a-->GetMetadataForFile<!--/a--></code> implementation you must rename <code>GetMetadataForFile.c</code> to <code>GetMetadataForFile.m</code>. <span class="content_text">Listing 8</span> shows the <code><!--a-->GetMetadataForFile<!--/a--></code> implementation of the example metadata importer.</p><a name="//apple_ref/doc/uid/TP40001275-196597-BABFFBEH" title="Listing 8Objective-C implementation of GetMetadataForFile for the sample metadata importer"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001275-196597" title="Listing 8Objective-C implementation of GetMetadataForFile for the sample metadata importer"></a><strong>Listing 8&nbsp;&nbsp;</strong>Objective-C implementation of GetMetadataForFile for the sample metadata importer</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean GetMetadataForFile(void* thisInterface,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFMutableDictionaryRef attributes,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFStringRef contentTypeUTI,<span></span></pre></td></tr><tr><td scope="row"><pre>               CFStringRef pathToFile)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Pull any available metadata from the file at the specified path */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Return the attribute keys and attribute values in the dict */<span></span></pre></td></tr><tr><td scope="row"><pre>    /* Return true if successful, false if there was no data provided */<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean success=NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDictionary *tempDict;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool *pool;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Don't assume that there is an autorelease pool around the calling of this function.<span></span></pre></td></tr><tr><td scope="row"><pre>    pool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    // load the document at the specified location<span></span></pre></td></tr><tr><td scope="row"><pre>    tempDict=[[NSDictionary alloc] initWithContentsOfFile:(NSString *)pathToFile];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (tempDict)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    // set the kMDItemTitle attribute to the Title<span></span></pre></td></tr><tr><td scope="row"><pre>    [(NSMutableDictionary *)attributes setObject:[tempDict objectForKey:@"title"]<span></span></pre></td></tr><tr><td scope="row"><pre>                          forKey:(NSString *)kMDItemTitle];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set the kMDItemAuthors attribute to an array containing the single Author<span></span></pre></td></tr><tr><td scope="row"><pre>    // value<span></span></pre></td></tr><tr><td scope="row"><pre>    [(NSMutableDictionary *)attributes setObject:[NSArray arrayWithObject:[tempDict objectForKey:@"author"]]<span></span></pre></td></tr><tr><td scope="row"><pre>                          forKey:(NSString *)kMDItemAuthors];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set our custom document notes attribute to the Notes value<span></span></pre></td></tr><tr><td scope="row"><pre>    // (in the real world, you'd likely use the kMDItemTextContent attribute, however that<span></span></pre></td></tr><tr><td scope="row"><pre>    // would make it hard to demonstrate using a custom key!)<span></span></pre></td></tr><tr><td scope="row"><pre>    [(NSMutableDictionary *)attributes setObject:[tempDict objectForKey:@"notes"]<span></span></pre></td></tr><tr><td scope="row"><pre>                          forKey:@"com_apple_myCocoaDocumentApp_myCustomDocument_notes"];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // return YES so that the attributes are imported<span></span></pre></td></tr><tr><td scope="row"><pre>    success=YES;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // release the loaded document<span></span></pre></td></tr><tr><td scope="row"><pre>    [tempDict release];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [pool release];<span></span></pre></td></tr><tr><td scope="row"><pre>    return success;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="SchemaRef.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="Performance.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-27<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/MDImporters/Concepts/WritingAnImp.html%3Fid%3DTP40001267-1.9&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/MDImporters/Concepts/WritingAnImp.html%3Fid%3DTP40001267-1.9&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/MDImporters/Concepts/WritingAnImp.html%3Fid%3DTP40001267-1.9&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
