<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using PostScript Picture Comments (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING472></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-471.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-473.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-465.html"><B>Appendix B - Using Picture Comments for Printing</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING472-0></A>
<H1><A NAME=MARKER-9-173></A>Using PostScript Picture Comments</H1>
 <A NAME=MARKER-2-174></A><A NAME=MARKER-2-175></A>You can access the PostScript language directly using the <CODE>PostScriptHandle</CODE> picture comment, and so bypass QuickDraw entirely. When you send PostScript code directly to the printer driver, it sends your code directly to the printer with no preprocessing and no error checking.<P>
<DL>
<DT><B>Note</B>
<DD>These picture comments affect the state of the PostScript drawing environment and can have such effects as printing blank pages. Also, many PostScript printer drivers do not use the same version of PostScript and produce different outputs with the same commands; you should test your code on as many PostScript printers as possible. In all cases, use the PostScript picture comments with extreme caution.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING472-3></A>
<H2><A NAME=MARKER-9-176></A>Calling PostScript Routines Directly</H2>
 Your application can tell the printer driver to disable all QuickDraw drawing routines by using the <CODE>PostScriptBegin</CODE> picture comment. The driver uses the PostScript <CODE>save</CODE> and <CODE>restore</CODE> operators to preserve the state of the PostScript interpreter. When the driver receives the <CODE>PostScriptEnd</CODE> picture comment, it reenables QuickDraw drawing routines.<P>
 You send PostScript code to the driver via the <CODE>PostScriptHandle</CODE> picture comment by including a handle to the PostScript code in the <CODE>dataHandle</CODE> parameter of the <CODE>PicComment</CODE> procedure. The driver performs no preprocessing or error checking on this code. The handle contains text with no length byte or word; use the <CODE>dataSize</CODE> parameter to convey the length of the PostScript code. (As with all picture comments, the handle you pass belongs to you, and you must dispose of it when you're finished with it.) You indicate the end of the PostScript commands with a carriage return (ASCII $0D). You must use <CODE>PostScriptBegin</CODE> and <CODE>PostScriptEnd</CODE> around any <CODE>PostScriptHandle</CODE> comments; otherwise, the PostScript driver will not properly save and restore the PostScript drawing environment. <P>
 <A HREF=#MARKER-9-177>Listing B-11</A> gives an example of an application-defined procedure called <CODE>DoPostScriptLine</CODE>. The procedure is used to transmit a string of PostScript code through the <CODE>PostScriptHandle</CODE> picture comment to the PostScript printer driver. <CODE>DoPostScriptLine</CODE> should be called only between <CODE>PostScriptBegin</CODE> and <CODE>PostScriptEnd</CODE> picture comments, as shown in the application-defined procedure <CODE>DoPostScriptComments</CODE>.<P>
<B>Listing B-11  <A NAME=MARKER-9-177></A>Sending PostScript code directly to the printer</B><P>
<PRE>
PROCEDURE DoPostScriptLine(s: Str255);
VAR
   h: Handle;
BEGIN
   h := NewHandle(256);
   IF h = NIL THEN DebugStr('NewHandle failed');
   BlockMove(@s[1], h^, Length(s));
   PicComment(PostScriptHandle, Length(s), h);
   h^^ := 13;
   PicComment(PostScriptHandle, 1, h); {add a carriage return}
   DisposeHandle(h);
END;
PROCEDURE DoPostScriptComments;
BEGIN
   {first, the simple example}
   PicComment(PostScriptBegin,0,NIL);
   DoPostScriptLine('100 100 moveto 0 100 rlineto 100 0 rlineto ');
   DoPostScriptLine('0 -100 rlineto -100 0 rlineto');
   DoPostScriptLine('stroke');
   MoveTo(30,30);
   DrawString('This text does not appear on PostScript printers.');
   PicComment(PostScriptEnd,0,NIL);
END;
</PRE>
<A NAME=HEADING472-10></A>
<H2><A NAME=MARKER-9-178></A>Optimizing PostScript Printing</H2>
 Although your printing code should be device-independent, you can optimize it for a PostScript printer. However, you cannot be sure that the current printer is a PostScript printer, so you may need to create two versions of the same drawing code: one for a PostScript printer and one for a QuickDraw printer, as described previously in this appendix. <P>
 For printing to a PostScript printer, you'll need to observe the following limitations: <P>
<UL>
<LI>Regions aren't supported; try to simulate them with polygons or bitmaps. 
<LI>Clipping regions should be limited to rectangles. PostScript clips nonsquare patterns to squares. 
<LI>The <CODE>Invert</CODE> data type, part of the QuickDraw <CODE>GrafVerb</CODE> data type, is not supported by the PostScript LaserWriter printer driver. 
<LI>The PostScript LaserWriter driver does not support all Boolean transfer modes. It supports the <CODE>srcCopy</CODE>, <CODE>srcOr</CODE>, <CODE>srcBic</CODE>, <CODE>notSrcCopy</CODE>, and <CODE>notSrcBic</CODE> modes for bitmaps and text. For all other objects drawn with QuickDraw, the PostScript LaserWriter driver supports only the <CODE>srcCopy</CODE> mode. 
<LI>There can be a small difference in glyph widths between fonts rendered on the screen and on the printer. Only the endpoints of text strings are the same. 
<LI>Only PostScript Level 2 supports color patterns that use colors other than red, green, blue, cyan, yellow, magenta, white, and black. 
<LI>The printer may print some large patterns at half size or smaller sizes, depending on its resolution. 
<LI>Polygons and smoothed polygons that result in the creation of paths larger than the limit of the PostScript printer (typically 1500 or 3000, depending on the version of PostScript) result in a PostScript error.<P>
</UL>
Although the PostScript LaserWriter printer is relatively fast, there are some techniques an application can use to ensure its maximum performance.<P>
<UL>
<LI>Printing patterns takes time, because the bitmap for the pattern has to be built. The black-and-white patterns, and some of the gray patterns, have been optimized to use the PostScript grayscales.
<LI>Use the <CODE>TextBegin</CODE> picture comment for text alignment. In the cases of flush left, flush right, or centered alignment, only the left, right, or center points are accurate, respectively; in the case of fully justified text, both the left and right endpoints are accurate.
<LI>If you want to position each glyph independently, use the <CODE>LineLayoutOff</CODE> and <CODE>StringBegin</CODE> picture comments. If you are trying to position glyphs and the driver is trying to position glyphs too, there is conflict, and printing takes much longer than necessary.<P>
</UL>
 For more information on the PostScript language, see the <I>PostScript Language Reference Manual</I>, second edition, available from Addison-Wesley. <A NAME=MARKER-2-179></A><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-471.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-473.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
