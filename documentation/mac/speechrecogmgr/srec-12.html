<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Building a Language Model</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING12></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="srec-11.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="srec-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="srec-87.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="srec-13.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="srec-2.html"><B>Speech Recognition Manager</B></A> / <BR><DD><A HREF="srec-4.html"><B>Chapter 1 - Speech Recognition Manager</B></A> / <A HREF="srec-9.html"><B>Using the Speech Recognition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING12-0></A>
<H2><A NAME=MARKER-9-116></A>Building a Language Model</H2>
 <A NAME=MARKER-2-117></A>You specify the words and phrases you want recognized by assigning a language model to a recognizer. <A HREF=#MARKER-9-118>Listing 1-5</A> illustrates one way to construct a language model. It calls the <CODE>SRNewLanguageModel</CODE> function to create a new empty language model and then calls other routines to add words and phrases to that model. The function <CODE>MyBuildLanguageModel</CODE> defined in <A HREF=#MARKER-9-118>Listing 1-5</A> constructs a language model for the BNF diagram shown on <A HREF=srec-7.html#MARKER-9-80>page 1-11</A>.<P>
<DL>
<DT><B>IMPORTANT</B>
<DD>There are many other ways to create language models. For example, you might read the basic words and phrases from resources of type <CODE>'STR#'</CODE>, or you might read language objects from a resource or data file using the functions <CODE>SRNewLanguageObjectFromHandle</CODE> or <CODE>SRNewLanguageObjectFromDataFile</CODE> (as shown later, in <A HREF=srec-18.html#MARKER-9-150>"Saving and Loading Language Objects" on page 1-35</A>). The techniques used in <A HREF=#MARKER-9-118>Listing 1-5</A> are intended only to illustrate one way of building embedded language models and a top-level language model.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 The function <CODE>MyBuildLanguageModel</CODE> takes an existing recognition system as a parameter. See <A HREF=srec-11.html#MARKER-9-108>"Opening Recognition Systems and Recognizers" on page 1-16</A> for information on opening recognition systems.<P>
<B>Listing 1-5  <A NAME=MARKER-9-118></A>Creating a language model</B><P>
<PRE>
SRLanguageModel MyBuildLanguageModel (SRRecognitionSystem mySystem);

/* creates a language model for the following BNF:
&lt;TopLM&gt;= &lt;call&gt; &lt;person&gt; | schedule meeting with &lt;person&gt; |view today's schedule;
&lt;call&gt;= call | phone | dial;
&lt;person&gt;= Arlo | Brent | Matt | my wife;
*/

const long  kTopLMRefCon = 'top ';
const long  kCallPersonRefCon = 'call';

const char  kCallLMName[] = &quot;&lt;call&gt;&quot;;
const char *kCallSynonyms[] = {&quot;call&quot;, &quot;phone&quot;, &quot;dial&quot;, NULL};

const char  kPersonLMName[] = &quot;&lt;person&gt;&quot;;
const char *kPersonNames[] = {&quot;Arlo&quot;, &quot;Brent&quot;, &quot;Matt&quot;, &quot;my wife&quot;, NULL};

const char  kTopLMName[] = &quot;&lt;TopLM&gt;&quot;;
const char  kScheduleMeetingWith[] = &quot;schedulemeeting with&quot;;
const char  kViewTodaysSchedule[] = &quot;view today's schedule&quot;;

SRLanguageModel MyBuildLanguageModel (SRRecognitionSystem mySystem)
{
   OSErr          myErr = noErr;
   SRLanguageModelmyCallLM = 0, myPersonLM = 0, myTopLM = 0;
   SRPath         myPath;
   char **        myStringArray;
   char *         myCurrString;
   
   /* create an embedded language model named &quot;&lt;call&gt;&quot; */
   myErr = SRNewLanguageModel(mySystem, &amp;myCallLM, kCallLMName, strlen(kCallLMName));
   if (!myErr) {
      SRPhrase    myPhrase;
      
      myStringArray = (char **) kCallSynonyms;
      while ((myCurrString = *myStringArray) != NULL) {
         /* note that we call SRNewPhrase instead of SRNewWord */
         /* so that we don't have to know if any of the synonyms */
         /* is more than one word */
         myErr = SRNewPhrase(mySystem, &amp;myPhrase, myCurrString, 
                                             strlen(myCurrString));
         if (!myErr) {
            myErr = SRAddLanguageObject(myCallLM, myPhrase);
            SRReleaseObject(myPhrase);       /* balances SRNewPhrase */
         }
         myStringArray++;
      }
   }

   /* create an embedded language model named &quot;&lt;person&gt;&quot; */
   /* Note that this code uses SRAddText, */
   /* a useful shortcut that calls SRNewPhrase internally. */
   if (!myErr)
      myErr = SRNewLanguageModel(mySystem, &amp;myPersonLM, kPersonLMName, 
                                             strlen(kPersonLMName));
   if (!myErr) {
      long     myRefCon = 0;
      
      myStringArray = (char **) kPersonNames;
      while ((myCurrString = *myStringArray) != NULL) {
         myErr = SRAddText(myPersonLM, myCurrString, strlen(myCurrString), 
                                                   myRefCon++);
         /* Note that by setting the refcon in the SRAddText call, */
         /* we can use it later when processing the search result. */
         
         myStringArray++;
      }
   }

   /* create a top-level language model named &quot;&lt;TopLM&gt;&quot; */
   if (!myErr)
      myErr = SRNewLanguageModel(mySystem, &amp;myTopLM, kTopLMName,strlen(kTopLMName));
   
   /* we set the refcon of the top-level language model, */
   /* so that we can identify it in the recognition result */
   if (!myErr)
      myErr = SRSetProperty(myTopLM, kRefCon, &amp;kTopLMRefCon, sizeof(kTopLMRefCon));

   /* create a path for &quot;&lt;call&gt; &lt;person&gt;&quot; and add to &quot;&lt;TopLM&gt;&quot; */
   if (!myErr) myErr = SRNewPath(mySystem, &amp;myPath);
   if (!myErr){
      if (!myErr) myErr = SRAddLanguageObject(myPath, myCallLM);
      if (!myErr) myErr = SRAddLanguageObject(myPath, myPersonLM);
      if (!myErr) myErr = SRAddLanguageObject(myTopLM, myPath);
   
      /* we set the refcon of the path, */
      /* so that we can identify it in the search result */
      if (!myErr) myErr = SRSetProperty(myPath, kSRRefCon, &amp;kCallPersonRefCon, 
                                          sizeof(kCallPersonRefCon));
      SRReleaseObject(myPath);            /* balances SRNewPath */
   }

   /* create path for &quot;schedule meeting with &lt;person&gt;&quot; and add to &quot;&lt;TopLM&gt;&quot; */
   if (!myErr) myErr = SRNewPath(mySystem, &amp;myPath);
   if (!myErr) 
      myErr = SRAddText(myPath, kScheduleMeetingWith,
                                    strlen(kScheduleMeetingWith), 0);
      if (!myErr) myErr = SRAddLanguageObject(myPath, myPersonLM);
      if (!myErr) myErr = SRAddLanguageObject(myTopLM, myPath);
      SRReleaseObject(myPath);            /* balances SRNewPath */
   }

   /* add &quot;view today's schedule&quot; to &quot;&lt;TopLM&gt;&quot; */
   if (!myErr)
      myErr = SRAddText(myTopLM, kViewTodaysSchedule, 
                                    strlen(kViewTodaysSchedule), 0);
   
   if (myCallLM)
      myErr = SRReleaseObject(myCallLM);/* balances SRNewLanguageModel */
   if (myPersonLM)
      myErr = SRReleaseObject(myPersonLM);/* balances SRNewLanguageModel */

   return myTopLM;
}
</PRE>
 The <CODE>MyBuildLanguageModel</CODE> function creates the embedded language models used in the example language model and then adds them to the top-level language model <CODE>myTopLM</CODE>. As you can see, you can add a word or a phrase to a language model in several ways. You can use the sequence of functions <CODE>SRNewPhrase</CODE>, <CODE>SRAddLanguageObject</CODE>, and <CODE>SRReleaseObject</CODE>. Alternatively, you can use the function <CODE>SRAddText</CODE>, which adds some text directly to a language model without having you explicitly create objects for that text. Also, notice that calls to <CODE>SRNew<I>Object</I></CODE> are balanced with calls to SRReleaseObject for any object reference that won't be needed outside the routine (namely, all objects except <CODE>myTopLM</CODE>, which is returned at the end of the routine).<P>
 Note particularly that the <CODE>MyBuildLanguageModel</CODE> function defined in <A HREF=#MARKER-9-118>Listing 1-5</A> sets the <CODE>kSRRefCon</CODE> property of the various language objects it creates to known values. For example, <CODE>MyBuildLanguageModel</CODE> sets the <CODE>kSRRefCon</CODE> property of a name to an index into the array of names, like this:<P>
<PRE>
myErr = SRAddText(myPersonLM, myCurrString, 
                           strlen(myCurrString), myRefCon++);
</PRE>
 Later, when interpreting recognition results, you can read a language object's <CODE>kSRRefCon</CODE> property to determine what the user said. See <A HREF=srec-17.html#MARKER-9-146>"Interpreting Recognition Results," beginning on page 1-31</A> for details.<P>
 <A NAME=MARKER-2-119></A>Often, you'll want to designate certain words or phrases as optional. For example, you might wish to let the user say "meeting with Arlo" in addition to "schedule meeting with Arlo" (that is, making the word "schedule" optional). You can designate any language object as optional by setting its optional property, as illustrated in <A HREF=#MARKER-9-120>Listing 1-6</A>.<P>
<B>Listing 1-6  <A NAME=MARKER-9-120></A>Making a word optional</B><P>
<PRE>
/* suppose that the word myWord has already been created */
Boolean  myVal = TRUE;

myErr = SRSetProperty(myWord, kSROptional, &amp;myVal, sizeof(myVal));
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="srec-11.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="srec-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="srec-87.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="srec-13.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="srec-3.html">&copy; Apple Computer, Inc.</A><br>22 JAN 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
