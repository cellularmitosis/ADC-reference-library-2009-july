<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Image Kit Programming Guide: Browsing Filters and Setting Input Parameters</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Browsing Filters and Setting Input Parameters"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004907-CH8" title="Browsing Filters and Setting Input Parameters"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004907-CH1-SW1">Image Kit Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../IKImagePicker/IKImagePicker.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004907-CH8-SW1" title="Browsing Filters and Setting Input Parameters"></a><h1>Browsing Filters and Setting Input Parameters</h1><p>When Core Image was introduced in Mac OS X v10.4, it provided developers with access to one hundred built-in image processing filters and the ability to create custom filters. Although image filters are easy to use, the Core Image programming interface does not provide a user interface for choosing filters and for setting filter input parameters. You either used Core Image to set up and apply filters programmatically or created and managed your own user interface. With the introduction of the Image Kit framework in Mac OS X v10.5, all that has changed.</p><p>The <code>IKFilterBrowserPanel</code> and <code>IKFilterBrowserView</code> classes provide a  filter browser that lets users:</p><ul class="ul"><li class="li"><p>Browse filters by category</p></li><li class="li"><p>Apply a filter and preview its effects</p></li><li class="li"><p>Choose a filter</p></li><li class="li"><p>Create filter collections</p></li><li class="li"><p>See a description of the filter</p></li></ul><p>As a developer, you can choose which filter categories the browser displays and whether or not to show a preview. After a user chooses a filter, you can use the <code>IKFilterUIView</code> class to obtain a view that contains controls for the input parameters of the filter. </p><p>This chapter:</p><ul class="ul"><li class="li"><p>Describes the filter browser and filter user interface view</p></li><li class="li"><p>Discusses the user interface options you can set</p></li><li class="li"><p>Shows how to set up and use the filter browser in an application</p></li><li class="li"><p>Provides instructions for obtaining a filter user interface view and adding it into an existing view</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW3">The Filter Browser</a>
				
			<br/>
			
        
			
			
				<a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW8">The Filter User Interface View</a>
				
			<br/>
			
        
			
			
				<a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW9">Opening the Filter Browser in an Application</a>
				
			<br/>
			
        
			
			
				<a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW14">Getting a Filter User Interface View</a>
				
			<br/>
			
        
			
			
				<a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW6">Applying Filters to an Image</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004907-CH8-SW3" title="The Filter Browser"></a><h2>The Filter Browser</h2><p>The <code>IKFilterBrowserPanel</code> and <code>IKFilterBrowserView</code> classes provides a panel that displays a list, by category, of Core Image filters available on the system, as shown in <span class="content_text">Figure 6-1</span>. The search field at the top allows users to quickly find filters.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH8-SW2" title="Figure 6-1The filter browser"></a><p><strong>Figure 6-1&nbsp;&nbsp;</strong>The filter browser</p><img src = "../Art/filter_browser.jpg" alt = "The filter browser" ></div><br/><p>The user can click the Preview button to toggle a preview the preview off and on. The preview area lets the user see the effect of applying a filter using the default settings. Your application can set the preview image by registering for the notification <code>IKFilterBrowserWillPreviewFilterNotification</code>. A short description of the filter appears below the preview.</p><p>By clicking the  plus (+) button, the user can add a custom group—referred to as a collection—as shown in <span class="content_text">Figure 6-2</span>. The user can drag filters to the collection as a convenience for accessing sets of commonly used filters. Collections always appear below the built-in categories. To remove a collection, the user clicks the minus (–) button.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH8-SW4" title="Figure 6-2A Photo Corrections collection"></a><p><strong>Figure 6-2&nbsp;&nbsp;</strong>A Photo Corrections collection</p><img src = "../Art/collections.jpg" alt = "A Photo Corrections collection" ></div><br/><p>You can control the visual appearance of the controls, including their size, in the filter browser by specifying the appropriate setting.</p><a name="//apple_ref/doc/uid/TP40004907-CH8-SW8" title="The Filter User Interface View"></a><h2>The Filter User Interface View</h2><p>The <code>IKFilterUIView</code> class provides a view that contains controls for the input parameters of a filter. You can specify the size of the controls as miniature (<code>IKUISizeMini</code>), small (<code>IKUISizeSmall</code>), or regular (<code>IKUISizeRegular</code>). </p><p>A filter can optionally define basic, intermediate, advanced, and development sets of input parameters. These sets define which input parameters can be exposed in the user interface. For example, a filter that has many input parameters could define a basic set of input parameters for the typical consumer to control, and then programmatically set the other input parameters to default values. The same filter, however, can define an advanced set of input parameters that allow professional customers to control all the input parameters. Your application can request a specific set of input parameters. If the filter defines that set, then the filter user interface view reflects your request.</p><p><span class="content_text">Figure 6-3</span> shows a window that displays a filter user interface view for the gloom filter provided by Core Image (<code>CIGloom</code>). The controls for this filter are labeled Intensity and Radius. In this example, the image that is processed by the filter is labeled Background image and appears in the image well shown in the figure.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH8-SW5" title="Figure 6-3Controls for the Gloom filter appear below the background image"></a><p><strong>Figure 6-3&nbsp;&nbsp;</strong>Controls for the Gloom filter appear below the background image</p><img src = "../Art/gloom_view.jpg" alt = "Controls for the Gloom filter appear below the background image" ></div><br/><p>The output of one Core Image filter  can be directed to the input of another Core Image filter. Typically you’ll want to write an application that allows users to apply more than one Core Image filter to an image. <span class="content_text">Figure 6-4</span> shows an application that inserts user interface views for two Core Image filters into a window—the gloom filter and the pixellate filter (<code>CIPixellate</code>). The controls for the pixellate filter are labeled Scale and Center.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH8-SW7" title="Figure 6-4Two filter views in a window"></a><p><strong>Figure 6-4&nbsp;&nbsp;</strong>Two filter views in a window</p><img src = "../Art/gloom_pixellate_view.jpg" alt = "Two filter views in a window" ></div><br/><p>So far you’ve seen the user interface views for the built-in filters provided by Core Image. Developers who write image units can provide a custom view for each of the filters defined in the image unit by implementing the <code>IKFilterCustomUIProvider</code> protocol. For information on image units, see <em><a href="../../ImageUnitTutorial/index.html#//apple_ref/doc/uid/TP40004531" target="_top">Image Unit Tutorial</a></em>.</p><a name="//apple_ref/doc/uid/TP40004907-CH8-SW9" title="Opening the Filter Browser in an Application"></a><h2>Opening the Filter Browser in an Application</h2><p>Before you display the filter browser in an application, you need to load all the filters on the system by calling the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIPlugIn_Class/Reference/Reference.html#//apple_ref/occ/clm/CIPlugIn/loadAllPlugIns" target="_top">loadAllPlugIns</a></code> method of the <code><a href="../../../Reference/QuartzCoreFramework/Classes/CIPlugIn_Class/Reference/Reference.html#//apple_ref/occ/cl/CIPlugIn" target="_top">CIPlugIn</a></code> class. Then you create a shared instance of the <code><a href="../../../Reference/IKFilterBrowserPanel_Class/IKFilterBrowserPanel_Reference.html#//apple_ref/occ/cl/IKFilterBrowserPanel" target="_top">IKFilterBrowserPanel</a></code> class by calling the <code><a href="../../../Reference/IKFilterBrowserPanel_Class/IKFilterBrowserPanel_Reference.html#//apple_ref/occ/clm/IKFilterBrowserPanel/filterBrowserPanelWithStyleMask:" target="_top">filterBrowserPanelWithStyleMask:</a></code> method. You can choose between the Aqua style (default) and the brushed metal look (<code>NSTexturedBackgroundWindowMask</code>). You show  the filter browser by calling one of several methods, depending on whether you want the browser to appear as a sheet, a separate window, or in a custom view. In this section, you’ll see how to create a filter browser that opens in a separate window.</p><p>This section shows hot to create an application that opens a filter browser in a separate window. First you’ll set up the Xcode project, the project files, and the controller interface. Next  you’ll add the necessary routines to the implementation file. Then, you’ll create the user interface in Interface Builder. Finally, you'll make a few refinements by adding an options dictionary and using a different background window.</p><a name="//apple_ref/doc/uid/TP40004907-CH8-SW10" title="Setting Up the Project, Project Files, and the Controller Interface"></a><h3>Setting Up the Project, Project Files, and the Controller Interface</h3><p>Follow these steps to set up the project:</p><ol class="ol"><li class="li"><p>In Xcode, create a Cocoa application and name it  <code>My Filter Browser</code>.</p></li><li class="li"><p>Add the Quartz and Quartz Core frameworks to the project.</p><p>For details, see <span class="content_text"><a href="../ImageKitComponents/ImageKitComponents.html#//apple_ref/doc/uid/TP40004907-CH3-SW4">“Using the Image Kit in Xcode.”</a></span></p></li><li class="li"><p>Choose File > New File.</p></li><li class="li"><p>Choose Objective-C Class and click Next.</p></li><li class="li"><p>Name the file <code>FilterBrowserController.m</code> and keep the option to create the header file. Then click Finish.</p></li><li class="li"><p>In <code>FilterBrowserController.h</code> import the Quartz Core and Quartz frameworks by adding these statements:</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Quartz/Quartz.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QuartzCore/QuartzCore.h><span></span></pre></td></tr></table></div></li><li class="li"><p>Create an instance variable for the filter browser. Your interface should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface FilterBrowserController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>     IKFilterBrowserPanel *filterBrowserPanel;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>FilterBrowserController.h</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW11" title="Adding Routines to the Implementation File"></a><h3>Adding Routines to the Implementation File</h3><p>To implement the filter browser routines, follow these steps:</p><ol class="ol"><li class="li"><p>Open the <code>FilterBrowserController.m</code> file.</p></li><li class="li"><p>In the implementation file, add an <code>awakeFromNib</code> method.</p><p>This method needs to load all Core Image plug-ins, as shown:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [CIPlugIn loadAllPlugIns];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Next you’ll write a <code>showFilterBrowserPanel:</code> method that is invoked when the user chooses the Open Filter Browser menu item. You’ll create the menu item later.</p><p>The method first defines a constant to set the mask so that the filter browser uses the brushed metal look. This is optional. The default is to use the Aqua look. Note that you must provide a selector for the method that is invoked when the user closes the browser. You’ll write the selector method next. </p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)showFilterBrowserPanel:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int myStyleMask = NSTexturedBackgroundWindowMask;<span></span></pre></td></tr><tr><td scope="row"><pre>    if(!filterBrowserPanel)<span></span></pre></td></tr><tr><td scope="row"><pre>        filterBrowserPanel = [[IKFilterBrowserPanel<span></span></pre></td></tr><tr><td scope="row"><pre>               filterBrowserPanelWithStyleMask:myStyleMask] retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [filterBrowserPanel beginWithOptions:NULL modelessDelegate:self didEndSelector:@selector(browserPanelDidEndSelector:returnCode:contextInfo:) contextInfo:nil];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the <code>browserPanelDidEndSelector:returnCode:contextInfo:</code> selector method.</p><p>This method simply takes the filter browser out of the screen list so that is it not visible. </p><div class="codesample"><table><tr><td scope="row"><pre>- (void)browserPanelDidEndSelector:(NSWindow *)sheet returnCode:(int)returnCode contextInfo:(void *)contextInfo<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [sheet orderOut:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a <code>dealloc</code> method.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>FilterBrowserController.m</code> file.</p></li><li class="li"><p>Open the <code>FilterBrowserController.h</code> file and add this method declaration, making sure that you insert it before the <code>@end</code> statement.</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)showFilterBrowserPanel:(id)sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>FilterBrowserController.h</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW12" title="Creating the User Interface"></a><h3>Creating the User Interface</h3><p>Set up the user interface in Interface Builder by following these steps:</p><ol class="ol"><li class="li"><p>Double-click the <code>MainMenu.nib</code> file to open Interface Builder.</p></li><li class="li"><p>Delete the window icon in the nib document window.</p></li><li class="li"><p>Choose File > Synchronize With Xcode.</p></li><li class="li"><p>Drag  an <code>NSObject</code> from the library to the nib document window.</p></li><li class="li"><p>In the Identity inspector for the <code>NSObject</code>, choose FilterBrowserController from the Class pop-up menu.</p></li><li class="li"><p>Double-click the MainMenu icon in the nib document window.</p></li><li class="li"><p>Drag a submenu item from the Library to the MainMenu and place it between the Format and View menu items. Name the menu Filter.</p></li><li class="li"><p>Name the item in the Filter menu Show Filter Browser.</p></li><li class="li"><p>Control-drag from the Show Filter Browser menu item to the FilterBrowserController and in the connections panel choose <code>showFilterBrowserPanel:</code>.</p></li><li class="li"><p>Save the nib file.</p></li><li class="li"><p>In Xcode, click Build and Go.</p><p>When the application launches, choose Show Filter Browser from the Filter menu. </p><p>Try the Search feature.  Click the Preview button to toggle the preview off and back on. Then click the plus (+) button and add a collection. Drag a few filters into your collection.</p></li><li class="li"><p>Quit the application.</p><p>Now that the application runs, you’ll make a few refinements by adding an options dictionary and using a different window background.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW13" title="Refining the User Interface"></a><h3>Refining the User Interface</h3><p>There are a number of options you can set to modify the filter browser user interface. Follow these steps to change the options:</p><ol class="ol"><li class="li"><p>In Xcode, open the <code>FilterBrowserController.m</code> file and add a method that creates a dictionary of options. Make sure that you place this method before the <code>showFilterBrowserPanel:</code> method . </p><p>The Image Kit provides constants that let you specify the size of controls to use in the browser. The default is to use regular size controls. You’ll change the size to miniature by using the key constant <code>IKUISizeFlavor</code> and the value <code>IKUISizeMini</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>-(NSDictionary *)createFilterBrowserUIOptions<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> NSMutableDictionary *options = [[[NSMutableDictionary alloc] init] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre> [options setObject:IKUISizeMini forKey:IKUISizeFlavor];<span></span></pre></td></tr><tr><td scope="row"><pre> return options;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When you write a more complex application, you could let the user set the control size as a preference. Then your options dictionary method could set the options based on user preferences.</p></li><li class="li"><p>Modify the <code>showFilterBrowserPanel:</code> method so that it calls the <code>createFilterBrowserUIOptions</code> method.</p><p>In addition, set the style mask to <code>0</code> to get the default look. </p><p>After modification, the method to show the filter browser should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)showFilterBrowserPanel:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  int myStyleMask = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>  NSDictionary * options = [self createFilterBrowserUIOptions];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  if(!filterBrowserPanel)<span></span></pre></td></tr><tr><td scope="row"><pre>    filterBrowserPanel = [[IKFilterBrowserPanel<span></span></pre></td></tr><tr><td scope="row"><pre>        filterBrowserPanelWithStyleMask:myStyleMask] retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>  [filterBrowserPanel beginWithOptions:options<span></span></pre></td></tr><tr><td scope="row"><pre>     modelessDelegate:self<span></span></pre></td></tr><tr><td scope="row"><pre>     didEndSelector:@selector(browserPanelDidEndSelector:returnCode:contextInfo:)<span></span></pre></td></tr><tr><td scope="row"><pre>     contextInfo:nil];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In Xcode, click Build and Go.</p><p>After these modifications, the filter browser  should look similar to the following:</p><div class="item_figure"><img src = "../Art/mod_filter_browser.jpg" alt = "A filter browser with mini controls" ></div><p>Note that if you created a collection previously, the collection appears in the filter browser. Collections are persistent across launches of an application, on a per user basis.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW14" title="Getting a Filter User Interface View"></a><h2>Getting a Filter User Interface View</h2><p>This section shows how to get a view for the input parameters of a filter and insert that filter user interface view into an existing view. You’ll build upon the code in the last section by first adding code to respond to a user event—a double click—in the filter browser. When the user double-clicks the name of a filter in the filter browser, the application requests a filter user interface view for the selected filter and displays that view, as shown in <span class="content_text"><a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW5">Figure 6-3</a></span> and <span class="content_text"><a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW7">Figure 6-4</a></span>.</p><p>You need to register for a user event notification—either <code>IKFilterBrowserFilterSelectedNotification</code> or <code>IKFilterBrowserFilterDoubleClickNotification</code> of the <code>IKFilterBrowserPanel</code> class. After the user chooses a filter, you call the <code>viewForUIConfiguration:excludedKeys:</code> method of the <code>CIFilter</code> class (an Image Kit addition) to obtain a view for the filter. You can provide a configuration dictionary to specify the size of controls to use for the filter input parameters, just as you did for the filter browser itself. You exclude keys for input parameters that you don’t want to show (such as the input image which, in most cases, will already be displayed onscreen). </p><p>The application you’ll build here doesn’t perform any image processing. It simply shows how to set up the user interface. However, it does show how to stack several filter user interface views together. <span class="content_text"><a href="IKFilterBrowser.html#//apple_ref/doc/uid/TP40004907-CH8-SW6">“Applying Filters to an Image”</a></span> discusses using the Image Kit user interface together with Core Image.</p><a name="//apple_ref/doc/uid/TP40004907-CH8-SW15" title="Creating a Filter View Controller"></a><h3>Creating a Filter View Controller</h3><p>Follow these steps to set up the filter view controller:</p><ol class="ol"><li class="li"><p>In Xcode, open the project that you created in the last section.</p></li><li class="li"><p>Choose File > New File.</p></li><li class="li"><p>Choose Objective-C Class and click Next.</p></li><li class="li"><p>Name the file <code>FilterViewController.m</code> and keep the option to create the header file. Then click Finish.</p><p>This is the controller for the  filter user interface view. It obtains the filter, gets a view that contains the controls for the input parameters of the filter, and adds the view to the user interface.</p></li><li class="li"><p>In the <code>FilterViewController.h</code> file, add statements to import the Quartz and Quartz Core frameworks. You’ll also need to add a directive for the FilterBrowserController class to allow the two controllers to communicate.</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Quartz/Quartz.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QuartzCore/QuartzCore.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@class FilterBrowserController;<span></span></pre></td></tr></table></div></li><li class="li"><p>Add two <code>IBOutlet</code> objects to the interface—one for a view that contains the filter UI view and another for the filter browser controller. You’ll set these up in Interface Builder later.</p><p>The interface should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface FilterViewController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet id    filterUIContainerBox;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet FilterBrowserController *browserController;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a method signature for an <code>addFilter:</code> method.</p><p>This is the method that adds the filter user interface view to the panel. You’ll write the method later. When the user double-clicks a filter name, the method is invoked and passed a notification object that contains the name of the selected filter.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)addFilter:(NSNotification*)notification;<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>FilterViewController.h</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW16" title="Implementing the Filter View Controller"></a><h3>Implementing the Filter View Controller</h3><p>To implement the routines necessary for the filter view controller, follow these steps:</p><ol class="ol"><li class="li"><p>In Xcode, open the <code>FilterViewController.m</code> file.</p></li><li class="li"><p>Add an  <code>awakeFromNib</code> method. This method sets the background color of the filter view and makes sure that the panel is in front.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [[filterUIContainerBox window] setBackgroundColor:[NSColor whiteColor]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[filterUIContainerBox window] orderFront:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a <code>dealloc</code> method.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>[super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write a method that creates and returns a dictionary of user interface options for the view. You’ll set the size of the filter input parameter controls. (You can set additional options if you’d like.)</p><div class="codesample"><table><tr><td scope="row"><pre>-(NSDictionary *)createFilterBrowserUIOptions<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  NSMutableDictionary *options = [[[NSMutableDictionary alloc] init] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre> [options setObject:IKUISizeMini forKey:IKUISizeFlavor];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> return options;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write an  <code>addFilter:</code> method. </p><p> This method gets the view for the selected filter and inserts it into the panel you created previously in Xcode. The embedded comments explain what the code does.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)addFilter:(NSNotification*)notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the filter name from the notification.<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString    *filterName = [notification object];<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create a CIFilter object.<span></span></pre></td></tr><tr><td scope="row"><pre>    CIFilter    *newFilter = [CIFilter filterWithName:filterName];<span></span></pre></td></tr><tr><td scope="row"><pre>    // Add a filter user interface view only if a filter object exists.<span></span></pre></td></tr><tr><td scope="row"><pre>    if(newFilter)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Get  the frame rectangle that contains the filter UI container.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSRect  windowFrame = [[filterUIContainerBox window] frame];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Set the default values for the filter.<span></span></pre></td></tr><tr><td scope="row"><pre>        [newFilter setDefaults];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Get an options dictionary, which specifies the size of the controls.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSDictionary    *options = [self createFilterBrowserUIOptions];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create  a view for the filter, exclude the input image key.<span></span></pre></td></tr><tr><td scope="row"><pre>        IKFilterUIView    *filterContentView =<span></span></pre></td></tr><tr><td scope="row"><pre>             [newFilter viewForUIConfiguration:options<span></span></pre></td></tr><tr><td scope="row"><pre>                        excludedKeys:[NSArray arrayWithObject:@"inputImage"]];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Retrieve  the bounding rectangle for the view.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSRect  contentBounds = [filterContentView bounds];<span></span></pre></td></tr><tr><td scope="row"><pre>       // Make the view width match the width of the filter UI container.<span></span></pre></td></tr><tr><td scope="row"><pre>        contentBounds.size.width = [filterUIContainerBox bounds].size.width;<span></span></pre></td></tr><tr><td scope="row"><pre>       // Set up automatic resizing to accommodate additional views.<span></span></pre></td></tr><tr><td scope="row"><pre>       [filterContentView setAutoresizingMask:NSViewMinYMargin];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Increase the window frame size to accommodate the filter UI view.<span></span></pre></td></tr><tr><td scope="row"><pre>        windowFrame.size.height += [filterContentView bounds].size.height;<span></span></pre></td></tr><tr><td scope="row"><pre>        windowFrame.origin.y -= [filterContentView bounds].size.height;<span></span></pre></td></tr><tr><td scope="row"><pre>        // Set the frame of the filter UI container  to be the window frame.<span></span></pre></td></tr><tr><td scope="row"><pre>        // Display the changes and animate for a nice effect.<span></span></pre></td></tr><tr><td scope="row"><pre>        [[filterUIContainerBox  window] setFrame:windowFrame<span></span></pre></td></tr><tr><td scope="row"><pre>                                        display:YES animate:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Add the filter UI view to the filter container.<span></span></pre></td></tr><tr><td scope="row"><pre>        [filterUIContainerBox  addSubview:filterContentView];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>FilterViewController.m</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW17" title="Modifying the Filter Browser Controller"></a><h3>Modifying the Filter Browser Controller</h3><p>Next you’ll need to make a few modifications to the filter browser controller to allow the view and browser controllers to communicate. You’ll also need to register for a notification whenever the user double-clicks a filter name. Follow these steps:</p><ol class="ol"><li class="li"><p>Open the <code>FilterBrowserController.h</code> file and add this <code>import</code> statement:</p><div class="codesample"><table><tr><td scope="row"><pre>#import "FilterViewController.h"<span></span></pre></td></tr></table></div></li><li class="li"><p>Add an <code>IBOutlet</code> for the <code>FilterViewController</code>. The modified interface should now look like this:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface FilterBrowserController : NSObject {<span></span></pre></td></tr><tr><td scope="row"><pre>    IKFilterBrowserPanel    *filterBrowserPanel;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet FilterViewController *viewController;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)showFilterBrowserPanel:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Open the <code>FilterBrowserController.m</code> file and modify the  <code>awakeFromNib</code> method to register for the double-click notification setting the observer as <code>FilterViewController</code> and the method as <code>addFilter:</code>.</p><p>The <code>awakeFromNib</code> method should now looks as follows:</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [CIPlugIn loadAllPlugIns];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSNotificationCenter defaultCenter] addObserver:viewController<span></span></pre></td></tr><tr><td scope="row"><pre>                         selector:@selector(addFilter:)<span></span></pre></td></tr><tr><td scope="row"><pre>                         name:IKFilterBrowserFilterDoubleClickNotification<span></span></pre></td></tr><tr><td scope="row"><pre>                         object:nil];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Save and close the <code>FilterBrowserController.h</code> and <code>FilterBrowserController.m</code> files.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW18" title="Creating the User Interface"></a><h3>Creating the User Interface</h3><p>Set up the user interface in Interface Builder by following these steps:</p><ol class="ol"><li class="li"><p>Double-click the <code>MainMenu.nib</code> file to open Interface Builder.</p></li><li class="li"><p>Drag a panel from the Library to the nib document  window.</p></li><li class="li"><p>Change the name of the Panel icon to FilterInputs.</p></li><li class="li"><p>In the Attributes inspector, change the title of the panel to Filter Input Parameters.</p></li><li class="li"><p>Choose File > Synchronize With Xcode.</p></li><li class="li"><p>Drag an Object (<code>NSObject</code>)  from the Library to the nib document window.</p></li><li class="li"><p>In the Identity inspector, select FilterViewController from the Class pop-up menu.</p></li><li class="li"><p>In the nib document  window, control-drag from the FilterBrowserController icon to the FilterViewController icon. Then in the connections panel, choose the <code>viewController</code> outlet.</p></li><li class="li"><p>Control-drag from the FilterViewController icon to the FilterBrowserController icon. Then connect to the <code>browserController</code> outlet.</p></li><li class="li"><p>Control-drag from the FilterInputs icon to the FilterViewController icon. Then in the connections panel choose <code>delegate</code>.</p></li><li class="li"><p>Drag a Custom View to the panel. Make sure to hold it over the panel until the panel opens, then drop it in the opened panel.</p></li><li class="li"><p>Control-drag from the FilterViewController icon to the custom view. Then in the connections panel choose <code>filterUIContainerBox</code>.</p></li><li class="li"><p>Click the custom view in the panel.</p></li><li class="li"><p>Set the size of the view to 320 by 2 and make sure that the view (which will be a thin line) is positioned at the top of the window.</p><p>This is the view to which you’ll add the filter user interface view. Unless you want to start by showing something in this view, its height can be negligible.</p></li><li class="li"><p>Set the springs and struts for the Custom View like this:</p><div class="item_figure"><img src = "../Art/struts.jpg" alt = "All springs and struts are set" ></div></li><li class="li"><p>Set the springs and struts for the <em>content view</em> of the Custom View so that only the struts—which are the outer Autosizing elements —are set.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004907-CH8-SW19" title="Note"></a><p><strong>Note:</strong>&nbsp;It’s easiest to see the content view by setting the view style to column view and then clicking the Filter Inputs icon in the nib document window.</p></div></li><li class="li"><p>Set the size of the panel to 320 by 8.</p><p>Unless you want to show something in the panel other than filter input parameters, the panel height can be as small as possible.</p></li><li class="li"><p>Save the <code>MainMenu.nib</code> file.</p></li><li class="li"><p>In Xcode, click Build and Go.</p><p>Choose Show Filter Browser from the Filter menu. Double-click one or more filters to test your code. Each time you double-click a filter name, the Filter Input Parameters panel should show the input parameters for that filter. </p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH8-SW6" title="Applying Filters to an Image"></a><h2>Applying Filters to an Image</h2><p>You’ve seen in the previous sections how to write code that presents a simple user interface for the filter browser and filter input parameters. A full-featured image processing application requires a more sophisticated user interface. For example, it would:</p><ul class="ul"><li class="li"><p>Show the filter input parameter panel only after an image is open and a filter is selected.</p></li><li class="li"><p>Add code to delineate visually the input parameters of each filter, by adding a bounding box, a filter name, varying the background color for each filter UI view, or by some other means.</p></li><li class="li"><p>Allow the user to delete a filter from the input parameters panel and possible rearrange the order.</p></li></ul><p>A fully functioning image processing application also requires code that opens and saves images and applies selected filters to an image. The IUUIDemoApplication example provided with the developer tools for Mac OS X v10.5 provides most of the functionality needed in a full-featured image processing application. Now that you know how the user interface portion of the filter browser and filters  works, you may want to take a look at IUUIDemoApplication to see how to combine the user interface code with code that applies Core Image filters.</p><p>You can find the application in:</p><p><code>/Developer/Examples/Quartz/Core Image/ </code></p><p>IUUIDemoApplication has a controller for the filter browser and another controller for the filter user interface view. It also creates an object that tracks filters and another that tracks filter user interface views. It uses the Core Image programming interface to process images.</p><p>If you are not familiar with Core Image, see:</p><ul class="ul"><li class="li"><p><em><a href="../../CoreImaging/index.html#//apple_ref/doc/uid/TP30001185" target="_top">Core Image Programming Guide</a></em></p></li><li class="li"><p><em><a href="../../../Reference/CoreImagingRef/index.html#//apple_ref/doc/uid/TP40001171" target="_top">Core Image Reference Collection</a></em></p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../IKImagePicker/IKImagePicker.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Glossary/Glossary.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/IKFilterBrowser/IKFilterBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/IKFilterBrowser/IKFilterBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/IKFilterBrowser/IKFilterBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>