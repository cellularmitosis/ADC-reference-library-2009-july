<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Responding When the User Chooses a Menu Item(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING104></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-103.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-105.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-89.html"><B>Chapter 3 - Menu Manager</B></A> / <A HREF="Toolbox-97.html"><B>Using the Menu Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING104-0></A>
<H2><A NAME=MARKER-9-418></A>Responding When the User Chooses a Menu Item</H2>
 <A NAME=MARKER-9-309></A>Your application can use the <CODE>MenuSelect</CODE> function to determine when the user chooses a menu command, and your application can use the <CODE>MenuKey</CODE> function to determine when the user presses the keyboard equivalent for a menu command. Both <CODE>MenuSelect</CODE> and <CODE>MenuKey</CODE> return a long integer value that indicates which menu and menu item the user chose.<P>
 The <CODE>MenuSelect</CODE> and <CODE>MenuKey</CODE> functions return the menu ID of the menu in the high word and the menu item number in the low word of their function result. If the user did not choose a menu command or if the user pressed a keyboard combination that does not map to any keyboard equivalent in your application's menus, the functions return 0 in the high word and the value of the low word is undefined. The <CODE>MenuSelect</CODE> function also returns 0 in the high word when the user selects an item in the Application or Keyboard menu. The <CODE>MenuSelect</CODE> function (and <CODE>MenuKey</CODE> function, if the command has a keyboard equivalent) returns the <CODE>kHMHelpMenuID</CODE> constant in the high word and the menu item in the low word when the user selects an item that your application appended to the Help menu.<P>
 <A HREF=#MARKER-9-420>Listing 3-24</A> shows an application-defined procedure, <CODE>DoMenuCommand</CODE>. This procedure takes the appropriate action based on which menu command the user chose. <P>
 The <CODE>DoMenuCommand</CODE> procedure is called by the application after the application determines that either the user pressed the mouse button while the cursor was in the menu bar (in which case the application calls <CODE>MenuSelect</CODE> to allow the user to choose <BR>a command) or the user pressed the Command key and another key (in which case the application calls the <CODE>MenuKey</CODE> function). In either case, the application passes the function result returned by <CODE>MenuSelect</CODE> or <CODE>MenuKey</CODE> as a parameter to the <CODE>DoMenuCommand</CODE> procedure. <P>
<B>Listing 3-24  <A NAME=MARKER-9-420></A>Responding to the user's choice of a menu command<A NAME=MARKER-2-421></A></B><P>
<PRE>
PROCEDURE DoMenuCommand (menuResult: LongInt);
VAR
   menuID, menuItem: Integer;
BEGIN
   menuID := HiWord(menuResult);    {get menu ID of menu}
   menuItem := LoWord(menuResult);  {get menu item number}
   CASE menuID OF
      mApple: 
         MyHandleAppleCommand(menuItem);
      mFile: 
         MyHandleFileCommand(menuItem);
      mEdit:
         MyHandleEditCommand(menuItem);
      mFont:
         MyHandleFontCommand(menuItem);
      mSize:
         MyHandleSizeCommand(menuItem);
      kHMHelpMenuID:
         MyHandleHelpCommand(menuItem);
      mOutline:
         MyHandleOutlineCommand(menuItem);
      mSubMenu: {user chose item from submenu}
         MyHandleSubLabelStyleCommand(menuItem);
   END;  {end of CASE menuID}
   HiliteMenu(0); {unhighlight what MenuSelect or MenuKey hilited}
END; 
</PRE>
 The <CODE>DoMenuCommand</CODE> procedure calls other application-defined routines to perform the requested action. After performing the action associated with the chosen menu item, your application should use the <CODE>HiliteMenu</CODE> procedure to unhighlight the menu title to indicate that the requested action is complete.<P>
<A NAME=HEADING104-8></A>
<H3>Handling the Apple Menu</H3>
 <A NAME=MARKER-2-422></A>When the user chooses an item from the Apple menu, the <CODE>MenuSelect</CODE> function returns the menu ID of your application's Apple menu in the high word and returns the chosen menu item in the low word of its function result. <P>
 <A NAME=MARKER-9-336></A>If your application provides an About command as the first menu item in the Apple menu and the user chose this item, you should display your application's About box. Otherwise your application should use the <CODE>GetMenuItemText</CODE> procedure to get the menu item text and then call the <CODE>OpenDeskAcc</CODE> function, passing the text of the chosen menu item as a parameter.<P>
 <A HREF=#MARKER-9-424>Listing 3-25</A> shows an application-defined procedure, MyHandleAppleCommand, that the application calls in response to the user's choice of an item from the Apple menu.<P>
<B>Listing 3-25  <A NAME=MARKER-9-424></A>Responding to the user's choice of an item from the Apple menu<A NAME=MARKER-9-233></A></B><P>
<PRE>
PROCEDURE MyHandleAppleCommand (menuItem: Integer);
VAR
   itemName: Str255;
   daRefNum: Integer;
BEGIN
   CASE menuItem OF
      iAbout:           {bring up alert for About}
         DisplayMyAboutBox;
      OTHERWISE
      BEGIN {all non-About items in this menu are desktop items, }
            { for example, DA's, other apps, documents, etc.}
         GetMenuItemText(GetMenuHandle(mApple), menuItem,
                         itemName);
         daRefNum := OpenDeskAcc(itemName);
      END;
    END; {of CASE}
END;
</PRE>
 When the user chooses an item other than your application's About command from <BR>the Apple menu, your application should call the <CODE>OpenDeskAcc</CODE> function. The <CODE>OpenDeskAcc</CODE> function prepares to open the desktop object chosen by the user; for example, if the user chose a document created by the TeachText application, the <CODE>OpenDeskAcc</CODE> function schedules the TeachText application for execution (or prepares to open it if it isn't already open) and returns to your application. On your application's next call to <CODE>WaitNextEvent</CODE>, your application receives a suspend event, and then <BR>the Process Manager makes TeachText the foreground application and instructs TeachText to open the chosen document. <A NAME=MARKER-2-426></A><P>
<A NAME=HEADING104-15></A>
<H3><A NAME=MARKER-9-427></A>Handling the Help Menu</H3>
 <A NAME=MARKER-2-106></A>Both the <CODE>MenuSelect</CODE> and <CODE>MenuKey</CODE> functions return the <CODE>kHMHelpMenuID</CODE> constant (-16490) in the high word when the user chooses an appended item from the Help <BR>menu. The item number of the appended menu item is returned in the low word of the function result. <P>
 The <CODE>DoMenuCommand</CODE> procedure shown in <A HREF=#MARKER-9-420>Listing 3-24</A> determines which menu command was chosen by the user. If the user chose a command from the Help menu, <BR>the <CODE>DoMenuCommand</CODE> procedure calls the application-defined procedure <CODE>MyHandleHelpCommand</CODE>. <A HREF=#MARKER-9-430>Listing 3-26</A> shows the application-defined procedure <CODE>MyHandleHelpCommand</CODE>. This procedure illustrates how the SurfWriter application responds to the user's choice of an item from the application's Help menu. Note that <BR>you should use the HMGetHelpMenuHandle function, not the <CODE>GetMenuHandle</CODE> function, to get a handle to your application's Help menu. <A NAME=MARKER-2-105></A><P>
<B>Listing 3-26  <A NAME=MARKER-9-430></A>Responding to the user's choice of a command from the Help menu<A NAME=MARKER-2-241></A></B><P>
<PRE>
PROCEDURE MyHandleHelpCommand (menuItem: Integer);
VAR
   myHelpMenuHdl:             MenuHandle;
   origHelpItems, numItems:   Integer;
   myErr:                     OSErr;
BEGIN
   {get handle to your application's Help menu}
   myErr := HMGetHelpMenuHandle(myHelpMenuHdl); 
   IF myErr &lt;&gt; noErr THEN
      EXIT(MyHandleHelpCommand);
   {count the number of items in the Help menu}
   numItems := CountMItems(myHelpMenuHdl);
   origHelpItems := numItems - kNumMyHelpItems;
   IF menuItem &gt; origHelpItems THEN
   BEGIN {user chose an item added by this application}
      {adjust this application's global variables that hold item }
      { numbers of the menu items that this application appended}
      gMyHelpItem1 := origHelpItems +1;
      gMyHelpItem2 := origHelpItems +2;
      MyHelp(menuItem);
   END;
END;
</PRE>
 Apple reserves the right to change the number of standard items in the Help menu. To determine the number of items in the Help menu, call the <CODE>CountMItems</CODE> function.<A NAME=MARKER-2-198></A><P>
<A NAME=HEADING104-21></A>
<H3><A NAME=MARKER-9-433></A>Handling a Size Menu</H3>
 <A NAME=MARKER-9-262></A>Your application can provide a Size menu to let the user choose various sizes of a font. Your Size menu should also provide the user with a method for specifying a size that isn't currently listed in the menu. For example, you can choose to provide an Other command that displays a dialog box allowing the user to choose a different font size. If the user chooses a font size not already in the menu, add a checkmark to the Other menu command and add the chosen size in parentheses to the text of the Other command. <P>
 Your application should outline font sizes to indicate which sizes are directly provided by the current font. For bitmapped fonts, outline only those sizes that actually exist in the Fonts folder. For TrueType fonts, outline all sizes that the TrueType font supports.<P>
 Your application should indicate the current font size to the user by placing a checkmark next to the text of the menu item that lists the current font size. If the current selection contains more than one font size, place a dash next to the name of each font size that the selection contains. (<A HREF=Toolbox-101.html#MARKER-9-313>"Changing the Mark of Menu Items" on page 3-63</A> explains how to add marks to and remove marks from menu items.) <A NAME=MARKER-2-62></A> <P>
 <A HREF=#MARKER-9-436>Figure 3-35</A> shows a Size menu as it appears after the user chooses a new font size of 31 by using the Other command. In <A HREF=#MARKER-9-436>Figure 3-35</A> the sizes 9, 10, 12, 18, 24, and 36 are the standard sizes provided by the application. Your application should place a checkmark next to the Other command to indicate that the current font size is a size other than a standard size. If the selection contains only one nonstandard size, include the size of the font in parentheses following the text Other. In <A HREF=#MARKER-9-436>Figure 3-35</A> the current selection contains a nonstandard size of 31, so the application places the checkmark next to the Other command and includes 31 in parentheses following the Other text. If the selection contains multiple nonstandard sizes, include the text Mixed in parentheses following <BR>the word Other. If the selection contains one or more standard sizes and only one nonstandard size, place a dash next to each standard size that the selection contains <BR>and place a dash next to the Other command with the nonstandard size included in paretheses in the text of the Other command.<P>
<B>Figure 3-35  <A NAME=MARKER-9-436></A>A Size menu with user-specified size added</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/Figure_1-35_MMS-36.jpg"><P>
 When the user chooses the Other command, you should display the current font size in a dialog box and allow the user to choose a new size.  <A HREF=Toolbox-93.html#MARKER-9-164>Figure 3-16 on page 3-33</A> shows a sample dialog box an application might display in response to the user's choice of the Other command.<P>
 You should always specify the text of the Other command in the plain font style (as shown in <A HREF=#MARKER-9-436>Figure 3-35</A>) and never outlined, regardless of whether the current font is a TrueType font that supports that size or a bitmapped font that exists at that size in the Fonts folder.<P>
 <A HREF=#MARKER-9-437>Listing 3-27</A> shows an application-defined procedure that handles the user's choice of an item in the Size menu shown in <A HREF=#MARKER-9-436>Figure 3-35</A>.<P>
<B>Listing 3-27  <A NAME=MARKER-9-437></A>Handling the Size menu<A NAME=MARKER-2-500></A></B><P>
<PRE>
PROCEDURE MyHandleSizeCommand (menuItem: Integer);
VAR
   numItems:      Integer;
   addItem:       Boolean;
   itemString:    Str255;
   itemStyle:     Style;
   sizeChosen:    LongInt;
BEGIN
   numItems := CountMItems(GetMenuHandle(mSize));
   IF menuItem = numItems THEN
   BEGIN                         {user chose Other command}
         {display a dialog box to allow the user to choose any }
         { size. If the user-specified size is not in the menu, }
         { add a checkmark to the Other command and add the }
         { new font size to the text of the Other command}
      MyDisplayOtherBox(sizeChosen);
   END
   ELSE
   BEGIN
      IF (menuItem = (numItems -2)) OR
         (menuItem = (numItems -3)) THEN
         DoMakeLargerOrSmaller(menuItem, sizeChosen)
      ELSE
      BEGIN             {user chose size displayed in the menu}
         {remove checkmark or dashes from menu items showing }
         { previous size}
         MyRemoveMarksFromSizeMenu;
         {add checkmark to menu item of new current size}
         CheckItem(GetMenuHandle(mSize), menuItem, TRUE);
         sizeChosen := MyItemToSize(menuItem);
      END;
   END;
   {update the document's state or the user's selection as needed}
   MyResizeSelection(sizeChosen);      
END;
</PRE>
 If the user chooses an item from the Size menu, the MyHandleSizeCommand procedure first counts the current number of items in the menu. If the user chooses the last item in the menu (the Other command), the procedure displays a dialog box like the one shown in <A HREF=Toolbox-93.html#MARKER-9-164>Figure 3-16 on page 3-33</A> to let the user choose a size other than the ones currently shown in the menu. The application-defined function MyDisplayOtherBox also adds a checkmark to the Other command if the user chose a new size, adds the new size to the text of the Other command, and returns the chosen size in the sizeChosen variable.<P>
 If the user chose the Larger or Smaller command from the Size menu, the code calls an application-defined routine, DoMakeLargerOrSmaller, to perform the requested action. The DoMakeLargerOrSmaller procedure also adds a checkmark and adds the new size to the text of the Other command if the new size does not match any size in <BR>the menu. The procedure returns the chosen size in the sizeChosen variable.<P>
 If the user chose any size currently displayed in the menu, the MyHandleSizeCommand procedure adjusts the marking character of the menu items appropriately. The code removes the checkmark from the previous menu item and adds a checkmark to the menu item representing the new size chosen by the user. The code uses an application-defined function, MyItemToSize, to map the item number of the chosen menu item to a given size and returns this size in the sizeChosen variable.<P>
 The code then uses the application-defined procedure <CODE>MyResizeSelection</CODE> to update the document's state and resize the user's selection, if any, to the chosen size. <A NAME=MARKER-2-228></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-103.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-105.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
