<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyVBLTask (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING103></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-102.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-104.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-74.html"><B>Chapter 4 - Vertical Retrace Manager</B></A> / <A HREF="Processes-87.html"><B>Vertical Retrace Manager Reference</B></A><BR><DL><DD><A HREF="Processes-101.html"><B>Application-Defined Routine</B></A> / <A HREF="Processes-102.html"><B>VBL Tasks</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING103-0></A>
<H3>MyVBLTask</H3>
 A VBL task has the following syntax:<P>
<PRE>
PROCEDURE MyVBLTask;
</PRE>
<A NAME=HEADING103-3></A>
<H5>DESCRIPTION</H5>
 The <CODE>vblAddr</CODE> field of a VBL task record contains the address of a VBL task that is executed after the number of interrupts specified in the <CODE>vblCount</CODE> field of the task record. The task can be set to execute at any frequency (up to once per vertical retrace interrupt). If the task uses application global variables or calls routines in another code segment, it must ensure that register A5 contains the address of the boundary between the application global variables and the application parameters. In addition, if your task calls routines in another code segment, that segment must already be loaded in memory.<A NAME=MARKER-2-179></A><P>
 Because of the optimizations performed by some compilers, the actual work of the VBL task and the setting and restoring of<DFN> the A5</DFN> register might have to be placed in separate procedures. See <A HREF=Processes-84.html#MARKER-9-109>Listing 4-9</A> and <A HREF=Processes-84.html#MARKER-9-110>Listing 4-10</A> for an example of how you can do this.<P>
 Your VBL tasks shouldn't call <CODE>VRemove</CODE> or <CODE>SlotVRemove</CODE> to remove its entry from the queue. Instead, either your application should call one of those functions at noninterrupt time or your task should simply not reset the <CODE>vblCount</CODE> of the task record.<P>
<A NAME=HEADING103-7></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 <A NAME=MARKER-2-180></A>Because a VBL task is executed at interrupt time, it should not allocate, move, or purge memory (either directly or indirectly) and should not depend on the validity of handles to unlocked blocks.<P>
 The code of the VBL task and any data accessed during its execution must be locked into physical memory if virtual memory is in operation.<P>
 Unless directed to do otherwise, some compilers insert code into your compiled application to facilitate debugging operations. This additional code can, however, cause trouble for VBL tasks and other interrupt processing. You might need to disable the generation of debugging code by enclosing the interrupt code between the appropriate compiler directives. Here's an example:<P>
<PRE>
{$PUSH}
{$D-}
{Don't generate debugging code for this procedure.}
PROCEDURE DoVBL;
BEGIN
   ...
END;
{$POP}
</PRE>
 Consult the documentation for your development system to see whether this is necessary and, if it is, how to do it.<A NAME=MARKER-2-181></A><A NAME=MARKER-2-182></A><P>
<A NAME=HEADING103-13></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 When the VBL task is called, register A0 contains a pointer to the VBL task record associated with that procedure.<P>
 A VBL task must preserve all registers other than A0-A3 and D0-D3. It must exit with an <CODE>RTS</CODE> instruction.<P>
<A NAME=HEADING103-16></A>
<H5>SEE ALSO</H5>
 See the section <A HREF=Processes-84.html#MARKER-9-98>"Accessing Application Global Variables in a VBL Task"</A> beginning on <A HREF=Processes-84.html#MARKER-9-98>page 4-13</A> for instructions on how to access your application's global variables in a VBL task.<A NAME=MARKER-2-183></A><P>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-102.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-104.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
