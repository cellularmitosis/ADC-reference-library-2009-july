<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Allocating Memory for and Disposing of Global Data(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING281></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-280.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-282.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-274.html"><B>Chapter 6 - Message Manager</B></A> / <A HREF="GXEnvironment-279.html"><B>Using the Message Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING281-0></A>
<H2><A NAME=MARKER-9-30></A>Allocating Memory for and Disposing of Global Data</H2>
 <A NAME=MARKER-2-31></A><A NAME=MARKER-2-32></A><A NAME=MARKER-9-70></A>You can use the <CODE>NewMessageGlobals</CODE> function to request and allocate memory for globals. You should only call this function while your application is performing a message override. <P>
 You should always initialize your global data from a function other than the one in which you call the <CODE>NewMessageGlobals</CODE> function. Otherwise, your development environment may generate code with bad data references.<P>
 <A HREF=#MARKER-9-34>Listing 6-1</A> gives an example of using the <CODE>NewMessageGlobals</CODE> function to create an A5 world from an MPW programming environment.<P>
<B>Listing 6-1  <A NAME=MARKER-9-34></A>Creating an A5 world for global data</B><P>
<PRE>
gxShape  gMyShape;
Handle   gMyHandle;

OSErr MyInitGlobalData()
{
   OSErr err;
   gMyShape = nil;
   gMyHandle = TempNewHandle(1024, &amp;err);
   return err;
}

OSErr MyInitialize()
{
   OSErr err;

/*
   Create an A5 world, and initialize the
   global data.
*/
   err = NewMessageGlobals(A5Size(), A5Init);

   if (!err) err = MyInitGlobalData();
   
   return err;
}
</PRE>
 The <CODE>MyInitalize</CODE> function is the override for the <CODE>GXInitialize</CODE> message. The <CODE>MyInitialize</CODE> function first sets up an A5 world, as required if an extension is going to use global data. In this case the global data is the <CODE>MyShape</CODE> structure. Once you create the A5 world by calling the <CODE>NewMessageGlobals</CODE> function, your global data will be valid whenever your printing extension or printer driver is called. Once the <CODE>NewMessageGlobals</CODE> function has been called, the extension or driver can initialize its global data. In this example, the code uses a function called <CODE>MyInitGlobalData</CODE> to do this.<P>
 If you have allocated memory for your globals using the <CODE>NewMessageGlobals</CODE> function, you must use the <CODE>DisposeMessageGlobals</CODE> function to dispose of the globals and deallocate their memory blocks when they are no longer needed. <P>
 Note that <CODE>DisposeMessageGlobals</CODE> does not dispose of data and handles. These must be disposed of by your code. First, you deallocate any memory that you have allocated and then let QuickDraw GX deallocate memory that it has allocated for your global data.<P>
 <A HREF=#MARKER-9-35>Listing 6-2</A> shows how to dispose of global data and deallocate the memory that was allocated in <A HREF=#MARKER-9-34>Listing 6-1</A>.<P>
<B>Listing 6-2  <A NAME=MARKER-9-35></A>Disposing of global data and deallocating memory</B><P>
<PRE>
OSErr MyShutDown()
{/* Dispose of our global data */
   if (gMyHandle != nil)
      DisposHandle(GMyHandle);
/* dispose of the A5 world that was created in MyInitialize */
   DisposeMessageGlobals();
   return noErr;
}
</PRE>
 The <CODE>NewMessageGlobals</CODE> function is described on <A HREF=GXEnvironment-291.html#MARKER-9-78>page 6-17</A>. The<CODE> DisposeMessageGlobals</CODE> function is described on <A HREF=GXEnvironment-292.html#MARKER-9-81>page 6-18</A>.<P>
 Global data is discussed in the section <A HREF=GXEnvironment-277.html#MARKER-9-22>"Global Data Storage for Printing Extensions and Printer Drivers" beginning on page 6-7</A>.<A NAME=MARKER-9-1></A><A NAME=MARKER-2-37></A><A NAME=MARKER-2-38></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-280.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-282.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
