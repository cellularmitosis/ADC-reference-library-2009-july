<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Notification Hacks - /PoliteNotification.&Alpha;/ShowInitIcon.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">Notification Hacks</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Notification Hacks</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/PoliteNotification.&Alpha;/ShowInitIcon.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/GestaltTalk/GestaltTalk.h</option>
<option value="listing2.html">/GestaltTalk/GestaltTalkCommands.c</option>
<option value="listing3.html">/GestaltTalk/GestaltTalkSelector.c</option>
<option value="listing4.html">/NotificationMon.ƒ/Headers/Event.h</option>
<option value="listing5.html">/NotificationMon.ƒ/Headers/Menu.h</option>
<option value="listing6.html">/NotificationMon.ƒ/Headers/NotificationMon.h</option>
<option value="listing7.html">/NotificationMon.ƒ/Source/AboutBox.c</option>
<option value="listing8.html">/NotificationMon.ƒ/Source/AEvents.c</option>
<option value="listing9.html">/NotificationMon.ƒ/Source/DialogUtil.c</option>
<option value="listing10.html">/NotificationMon.ƒ/Source/Drawing.c</option>
<option value="listing11.html">/NotificationMon.ƒ/Source/errorDebug.c</option>
<option value="listing12.html">/NotificationMon.ƒ/Source/Event.c</option>
<option value="listing13.html">/NotificationMon.ƒ/Source/InitMac.c</option>
<option value="listing14.html">/NotificationMon.ƒ/Source/main.c</option>
<option value="listing15.html">/NotificationMon.ƒ/Source/Menu.c</option>
<option value="listing16.html">/NotificationMon.ƒ/Source/NotificationMon.c</option>
<option value="listing17.html">/NotificationMon.ƒ/Source/NotificationPrefs.c</option>
<option value="listing18.html">/NotificationMon.ƒ/Source/NotificationReset.c</option>
<option value="listing19.html">/NotificationMon.ƒ/Source/NotificationUtil.c</option>
<option value="listing20.html">/NotificationMon.ƒ/Source/NotificationWindow.c</option>
<option value="listing21.html">/NotificationMon.ƒ/Source/Printing.c</option>
<option value="listing22.html">/NotificationMon.ƒ/Source/PrintLoop.c</option>
<option value="listing23.html">/NotificationMon.ƒ/Source/ScrollBar.c</option>
<option value="listing24.html">/NotificationMon.ƒ/Source/ScrollBar.h</option>
<option value="listing25.html">/NotificationTrash.ƒ/NotificationTrash.c</option>
<option value="listing26.html">/NotificationTrash.ƒ/ShowInitIcon.c</option>
<option value="listing27.html">/PoliteNotification.ƒ/NMInstallPatch.c</option>
<option value="listing28.html">/PoliteNotification.ƒ/ShowInitIcon.c</option></select>
				</p>
				</form>
				<p><strong><a href="Notification_Hacks.zip">Download Sample</a></strong> (&#147;Notification_Hacks.zip&#148;, 31.4K)<BR>
<strong><a href="Notification_Hacks.dmg">Download Sample</a></strong> (&#147;Notification_Hacks.dmg&#148;, 84.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  ShowInitIcon.c : Shows the icon during the init loading time*//*  Note: This code is roughly based on an assembly language routine by    Paul Mercer, Darin Adler, and Paul Snively from an idea by Steve Capps.    We use this method to be compatible with other Mac INITs.        It was converted to Think C by Eric Shapiro.      10/6/91    ebs    Added HNoPurge call just to be extra safe.      4/26/91    ebs    Added wrap-to-next-line support from James W. Walker      3/29/91    ebs    Changed function name, added CIconHandle typecasts      12/12/89  ebs    Called ClosePort() to release port memory*/  /* The low memory CurApName is a convenient place to store    four bytes of information so the next INIT doesn't    overwrite our ICON.  We store into my_h the horizontal    pixel location where the next INIT should go.  We checksum    the value and store the checksum in the next two bytes,    so that INITs can determine whether they're the 1st one loaded.  */  #define CurApName 0x910extern   short    my_h : CurApName+32-4;  extern  short    my_check : CurApName+32-2;#ifndef NULL#define NULL ( (void *)0 )#endif#define ICON_HEIGHT    32#define ICON_WIDTH    32#define  FIRST_X      8      /* don't change this */#define  BOTTOM_MARGIN  8#define DEF_MOVE_X_BY  40#define  CHECKSUM_CONST  0x1021#define MIN_BIT_DEPTH  4      /* if 16 colors or more, use color icon *//*  ShowInitIcon: Shows the icon specified in the correct place during startup      NOTE:      If Color QDraw is present and the main device has at least MIN_BIT_DEPTH      set, we'll look for a color icon ('cicn' resource) first. If we can't      find one, we'll look for the 'ICN#' resource.    Passed:      short  icon_num;    'ICN#' or 'cicn' resource id      short  move_x_by;    Pass -1 for default          Returns:      int    0=No error, &lt;0=Error number*/OSErr ShowInitIcon( short icon_num, short move_x_by){  short    err;  Handle    icon_h=NULL;    /* handle to 'ICN#' or 'cicn' resource */  Boolean    in_color=FALSE;    /* TRUE='cicn' resource, else 'ICN#' */  GrafPtr    oldport;  GrafPort  newport;      /* Entire GrafPort structure */  Rect     r;          /* where to put the icon */  SysEnvRec  sys_rec;  short    screen_width;    /* check for color quickdraw. If present, check bit depth of mainscreen.      if &gt;= MIN_BIT_DEPTH, then try to use color icon.    */  if ( err = SysEnvirons(1, &amp;sys_rec) )    return(err);  if ( sys_rec.hasColorQD )    /* a Mac II or later... */  {    GDHandle gdev = GetGDevice();  /* get main screen */    if ( (*(*gdev)-&gt;gdPMap)-&gt;pixelSize &gt;= MIN_BIT_DEPTH )      icon_h = (Handle)GetCIcon(icon_num);    if ( icon_h != NULL )      in_color = TRUE;  }    if ( icon_h == NULL )    /* no icon yet, try a B&amp;W one */    icon_h = Get1Resource('ICN#', icon_num);  if ( icon_h == NULL )    return(resNotFound);  /* we're SOL here */  HNoPurge( icon_h );  GetPort(&amp;oldport);    /* save old GrafPort for later restoring */    /* open a port so we can draw directly to screen. WindowMgrPort      may not be initialized at this time.    */  OpenPort(&amp;newport);  SetPort(&amp;newport);      /* do a checksum on low memory to see if we're the 1st icon */    /* if we are, then set x location. ^=XOR. */  if ( ((my_h &lt;&lt;1) ^ CHECKSUM_CONST) != my_check )    my_h = FIRST_X;#ifdef OLD_VERSION    /* now plot the icon */  r = newport.portRect;  r.top = newport.portRect.bottom - (BOTTOM_MARGIN+ICON_HEIGHT);  r.bottom = newport.portRect.bottom - BOTTOM_MARGIN;  r.left = my_h;  r.right = r.left + ICON_WIDTH;#endif    /* now plot the icon  4/26/91 updated */  screen_width = newport.portRect.right - newport.portRect.left;  screen_width -= screen_width % DEF_MOVE_X_BY;   /* in case screen isn't multiple of 40 */  r.left = my_h % screen_width;  r.right = r.left + ICON_WIDTH;  r.top = newport.portRect.bottom - ((BOTTOM_MARGIN+ICON_HEIGHT) * (1 + my_h / screen_width));  r.bottom = r.top + ICON_HEIGHT;    if ( in_color )    PlotCIcon(&amp;r, (CIconHandle)icon_h);    /* Toolbox's plot routine */  else    plot_icn(&amp;r, icon_h);          /* our routine */      /* now offset the low memory location by move_x_by pixels */  if ( move_x_by == -1 )    move_x_by = DEF_MOVE_X_BY;  my_h += move_x_by;  my_check = (my_h&lt;&lt;1) ^ CHECKSUM_CONST;    /* release the icon, restore the port */  if ( in_color )    DisposCIcon((CIconHandle)icon_h);  else    ReleaseResource(icon_h);  SetPort(oldport);  ClosePort(&amp;newport);            /* ebs 12/12/89 */  return(0);}/*  plot_icn : Plots an ICN# (ICON+mask) just the the Finder.*/plot_icn(r, icn_handle)  Rect  *r;  Handle  icn_handle;{  BitMap    bm;  char    flags;  GrafPtr    cur_port;    flags = HGetState(icn_handle);  HLock(icn_handle);  GetPort(&amp;cur_port);      /* we have to set up a BitMap structure to pass to CopyBits. We      might be able to use CopyMask() call instead, but this should      work on all Macs and CopyMask is only Mac+ or later. The 1st      BitMap we use has baseAddr pointing 128 bytes into the ICN#,      at the 1st bit of the mask. The 2nd BitMap points to the ICON.    */  bm.baseAddr = *icn_handle + ICON_WIDTH*ICON_HEIGHT/8;  /* points to mask */  bm.rowBytes = ICON_WIDTH / 8;      /* ICON_WIDTH/8 must be power of 2 */  SetRect(&amp;bm.bounds, 0, 0, ICON_WIDTH, ICON_HEIGHT);    /* punch a hole in the Desktop using bit-clear mode and the mask */  CopyBits(&amp;bm, &amp;cur_port-&gt;portBits, &amp;bm.bounds, r, srcBic, NULL);    /* now copy the icon into the punched hole */  bm.baseAddr = *icn_handle;    /* points to ICON */  CopyBits(&amp;bm, &amp;cur_port-&gt;portBits, &amp;bm.bounds, r, srcOr, NULL);    HSetState(icn_handle, flags);}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Notification_Hacks/listing28.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Notification_Hacks/listing28.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Notification_Hacks/listing28.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>