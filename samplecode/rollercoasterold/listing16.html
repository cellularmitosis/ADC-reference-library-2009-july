<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>rollercoasterold - /Sources/Win32Application.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">rollercoasterold</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">rollercoasterold</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Sources/Win32Application.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Interfaces/Document.h</option>
<option value="listing2.html">/Interfaces/MacApplication.h</option>
<option value="listing3.html">/Interfaces/QD3DSupport.h</option>
<option value="listing4.html">/Interfaces/TextureMap.h</option>
<option value="listing5.html">/Interfaces/Track.h</option>
<option value="listing6.html">/Interfaces/Utils.h</option>
<option value="listing7.html">/Interfaces/Win32Application.h</option>
<option value="listing8.html">/Interfaces/WinPrefix.h</option>
<option value="listing9.html">/READ ME.txt</option>
<option value="listing10.html">/resource.h</option>
<option value="listing11.html">/Sources/MacApplication.c</option>
<option value="listing12.html">/Sources/QD3DSupport.c</option>
<option value="listing13.html">/Sources/TextureMap.c</option>
<option value="listing14.html">/Sources/Track.c</option>
<option value="listing15.html">/Sources/Utils.c</option>
<option value="listing16.html">/Sources/Win32Application.c</option></select>
				</p>
				</form>
				<p><strong><a href="rollercoasterold.zip">Download Sample</a></strong> (&#147;rollercoasterold.zip&#148;, 102.0K)<BR>
<strong><a href="rollercoasterold.dmg">Download Sample</a></strong> (&#147;rollercoasterold.dmg&#148;, 165.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*
  File:    Win32Application.c

  Contains:  Standard Win32 event loop &amp; window creation code

  Written by:  Scott Kuechle

  Copyright:  &copy; 1998 by Apple Computer, Inc., all rights reserved.

  Change History (most recent first):

    &lt;2&gt;    9/28/98    rtm    made changes for Metrowerks compiler
    &lt;1&gt;     9/01/98    srk    first file
      
 
 NOTES:

 
 TO DO:

*/

/************************************************************
*                                                           *
*    INCLUDE FILES                                          *
*                                                           *
*************************************************************/

#include &quot;Win32Application.h&quot;

/************************************************************
*                                                           *
*    GLOBAL VARIABLES                                       *
*                                                           *
*************************************************************/

HINSTANCE      ghInst;            /* current instance */
DocumentRec      gDocument;
UINT        gTimer;
char szAppName[] = &quot;RollerCoaster&quot;;    /* The name of this application */
char szTitle[]   = &quot;RollerCoaster&quot;;    /* The title bar text */
COLORREF      customColors[16] = { 0L };      /* for use by choosecolor dialog */

/************************************************************
*                                                           *
*    CONSTANTS                                              *
*                                                           *
*************************************************************/

#define kMillsPerTick 10  /* milliseconds per timer tick */


/************************************************************
*                                                           *
*    FUNCTION PROTOTYPES                                    *
*                                                           *
*************************************************************/

static BOOL InitApplication(HINSTANCE hInstance);
static BOOL InitInstance( HINSTANCE hInstance, int nCmdShow);
static LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM uParam, LPARAM lParam);
BOOL CenterWindow (HWND hwndChild, HWND hwndParent);
static LRESULT CALLBACK About(
                HWND hDlg,           /* window handle of the dialog box */
                UINT message,        /* type of message */
                WPARAM uParam,       /* message-specific information */
                LPARAM lParam);
void    UpdateFrame(void);
TQ3Status  GetToolBarPosition(DocumentPtr theDocument, unsigned long *x, unsigned long *y);
TQ3Status  GetToolBarSize(DocumentPtr theDocument, unsigned long *width, unsigned long *height);

static void StartTimer( void );
static void StopTimer( void );
VOID CALLBACK TimerProc(
            HWND hwnd,  /* handle of window for timer messages */
            UINT uMsg,  /* WM_TIMER message */
            UINT idEvent,  /* timer identifier */
            DWORD dwTime   /* current system time */
             );

/************************************************************
*                                                           *
*    FUNCTION:  WinMain                                     *
*                                                           *
*    PURPOSE:   Standard Windows WinMain routine            *
*                                                           *
*************************************************************/

int CALLBACK WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,
          LPSTR lpCmdLine, int nCmdShow)
{
    MSG msg;
    HANDLE hAccelTable;

    if (!InitApplication(hInstance)) 
    {
      return (FALSE);    
    }

    if (!InitInstance(hInstance, nCmdShow)) 
    {
      return (FALSE);
    }

    StartTimer();

    hAccelTable = LoadAccelerators (hInstance, MAKEINTRESOURCE(IDR_GENERIC));

    while (GetMessage(&amp;msg, NULL, 0, 0))
    {
      if (!TranslateAccelerator (msg.hwnd, hAccelTable, &amp;msg))
      {
        TranslateMessage(&amp;msg);
        DispatchMessage(&amp;msg);
      }
    }

    StopTimer();

    return (msg.wParam); /* Returns the value from PostQuitMessage */
}

/************************************************************
*                                                           *
*    FUNCTION:  UpdateFrame                                 *
*                                                           *
*    PURPOSE:   Invalidates our window so it will be        *
*               redrawn                                     *
*                                                           *
*************************************************************/

void UpdateFrame(void)
{
  RECT      aWinRect;
  BOOL      aResult;

    aResult = GetClientRect(gDocument.fMainWindow, (LPRECT)&amp;aWinRect);
    aResult = InvalidateRect(gDocument.fMainWindow, &amp;aWinRect, FALSE);  
}


/************************************************************
*                                                           *
*    FUNCTION:  InitApplication                             *
*                                                           *
*    PURPOSE:   Invalidates our window so it will be        *
*               redrawn                                     *
*                                                           *
*************************************************************/

BOOL InitApplication(HINSTANCE hInstance)
{
  WNDCLASS  wc;

      /* CS_OWNDC is required to support the Win32DC Draw context */
        wc.style         = CS_HREDRAW | CS_VREDRAW | CS_OWNDC;

        wc.lpfnWndProc   = (WNDPROC)WndProc;       
        wc.cbClsExtra    = 0;                      
        wc.cbWndExtra    = 0;                     
        wc.hInstance     = hInstance;             
        wc.hIcon         = LoadIcon (hInstance, MAKEINTRESOURCE(IDI_APP)); 
        wc.hCursor       = LoadCursor(NULL, IDC_ARROW);
        wc.hbrBackground = (HBRUSH)(COLOR_WINDOW+1);
        wc.lpszMenuName  = MAKEINTRESOURCE(IDR_GENERIC); 
        wc.lpszClassName = szAppName;              

        return (RegisterClass(&amp;wc));
}

/************************************************************
*                                                           *
*    FUNCTION:  InitInstance                                *
*                                                           *
*    PURPOSE:   Creates our window                          *
*                                                           *
*                                                           *
*************************************************************/

BOOL InitInstance(
          HINSTANCE       hInstance,
          int             nCmdShow)
{
  HWND  hWnd; 

        ghInst = hInstance; 
        hWnd = CreateWindowEx(
        WS_EX_WINDOWEDGE | WS_EX_CLIENTEDGE,
                szAppName,          
                szTitle,             
                WS_OVERLAPPEDWINDOW, 
                25, 25, 640, 530,    /* fixed size windows */
                NULL,                
                NULL,                
                hInstance,           
                NULL                 
        );

        if (!hWnd) 
    {
            return (FALSE);
        }


        ShowWindow(hWnd, nCmdShow); 
        UpdateWindow(hWnd);        

        return (TRUE);             

}

/************************************************************
*                                                           *
*    FUNCTION:  WndProc                                     *
*                                                           *
*    PURPOSE:   Our window procedure                        *
*                                                           *
*                                                           *
*************************************************************/

LRESULT CALLBACK WndProc(
            HWND hWnd,        
            UINT message,      
            WPARAM uParam,     
            LPARAM lParam
            )   
{
    int wmId, wmEvent;
  PAINTSTRUCT PaintStruct;

        switch (message) 
    {
            case WM_COMMAND:

                wmId    = LOWORD(uParam);
                wmEvent = HIWORD(uParam);

                switch (wmId) 
        {
                    case IDM_ABOUT:
                        DialogBox(ghInst,          
                                MAKEINTRESOURCE(IDD_ABOUTBOX),
                                hWnd,                 
                                (DLGPROC)About);
                        break;

                    case IDM_EXIT:
                        DestroyWindow (hWnd);
                        break;

                    default:
                        return (DefWindowProc(hWnd, message, uParam, lParam));
                }
                break;

      case WM_CREATE:
        QD3DSupport_InitDoc3DData( hWnd, &amp;gDocument );
        break;

            case WM_DESTROY:  /* message: window being destroyed */
                PostQuitMessage(0);
        QD3DSupport_DisposeDoc3DData( &amp;gDocument );
                break;

      case WM_PAINT:
        BeginPaint(gDocument.fMainWindow, &amp;PaintStruct);        
        QD3DSupport_DocDraw3DData( &amp;gDocument );
        EndPaint(gDocument.fMainWindow, &amp;PaintStruct);
        break;

      case WM_SIZE:
        {
        unsigned long width = LOWORD(lParam);  /* width of client area */
        unsigned long height = HIWORD(lParam); /* height of client area */

        break;
        }

      case WM_QUERYENDSESSION:
        return (TRUE);

            default:          /* Passes it on if unproccessed */
                return (DefWindowProc(hWnd, message, uParam, lParam));
        }
        return (0);
}


/************************************************************
*                                                           *
*    FUNCTION:  CenterWindow                                *
*                                                           *
*    PURPOSE:   Place our window on the screen              *
*                                                           *
*                                                           *
*************************************************************/

BOOL CenterWindow (HWND hwndChild, HWND hwndParent)
{
  RECT    rChild, rParent;
  int     wChild, hChild, wParent, hParent;
  int     wScreen, hScreen, xNew, yNew;
  HDC     hdc;

        /* Get the Height and Width of the child window */
        GetWindowRect (hwndChild, &amp;rChild);
        wChild = rChild.right - rChild.left;
        hChild = rChild.bottom - rChild.top;

        /* Get the Height and Width of the parent window */
        GetWindowRect (hwndParent, &amp;rParent);
        wParent = rParent.right - rParent.left;
        hParent = rParent.bottom - rParent.top;

        /* Get the display limits */
        hdc = GetDC (hwndChild);
        wScreen = GetDeviceCaps (hdc, HORZRES);
        hScreen = GetDeviceCaps (hdc, VERTRES);
        ReleaseDC (hwndChild, hdc);

        /* Calculate new X position, then adjust for screen */
        xNew = rParent.left + ((wParent - wChild) /2);
        if (xNew &lt; 0)
    {
            xNew = 0;
        }
    else if ((xNew+wChild) &gt; wScreen)
    {
            xNew = wScreen - wChild;
        }

        /* Calculate new Y position, then adjust for screen */
        yNew = rParent.top  + ((hParent - hChild) /2);
        if (yNew &lt; 0)
    {
            yNew = 0;
        }
    else if ((yNew+hChild) &gt; hScreen)
    {
            yNew = hScreen - hChild;
        }

        /* Set it, and return */
        return SetWindowPos (hwndChild, NULL,
                xNew, yNew, 0, 0, SWP_NOSIZE | SWP_NOZORDER);
}

/************************************************************
*                                                           *
*    FUNCTION:  About                                       *
*                                                           *
*    PURPOSE:   About box callback                          *
*                                                           *
*                                                           *
*************************************************************/

LRESULT CALLBACK About(
          HWND hDlg,           /* window handle of the dialog box */
          UINT message,        /* type of message */
          WPARAM uParam,       /* message-specific information */
          LPARAM lParam)
{
    static  HFONT hfontDlg;
    LPSTR   lpVersion;
    DWORD   dwVerInfoSize;
    DWORD   dwVerHnd;
    UINT    uVersionLen;
    WORD    wRootLen;
    BOOL    bRetCode;
    int     i;
    char    szFullPath[256];
    char    szResult[256];
    char    szGetName[256];

        switch (message)
    {
                case WM_INITDIALOG:  /* message: initialize dialog box */
                        return (TRUE);

                case WM_COMMAND:                      /* message: received a command */
                        if (LOWORD(uParam) == IDOK        /* &quot;OK&quot; box selected? */
                        || LOWORD(uParam) == IDCANCEL) {  /* System menu close command? */
                                EndDialog(hDlg, TRUE);        /* Exit the dialog */
                                DeleteObject (hfontDlg);
                                return (TRUE);
                        }
                        break;
        }
        return (FALSE); /* Didn't process the message */
}

/************************************************************
*                                                           *
*    FUNCTION:  StartTimer                                  *
*                                                           *
*    PURPOSE:   Create a timer which will be used to        *
*               periodically call an update routine for     *
*               our window.                                 *
*                                                           *
*                                                           *
*************************************************************/

static void StartTimer( void )
{
  gTimer = SetTimer( NULL, 0, kMillsPerTick, (TIMERPROC) TimerProc );
}

/************************************************************
*                                                           *
*    FUNCTION:  StopTimer                                   *
*                                                           *
*    PURPOSE:   Stops our timer                             *
*                                                           *
*                                                           *
*************************************************************/

static void StopTimer( void )
{
  KillTimer( NULL, gTimer );
}

/************************************************************
*                                                           *
*    FUNCTION:  TimerProc                                   *
*                                                           *
*    PURPOSE:   Our timer procedure, which calls and        *
*               update routine for our window               *
*                                                           *
*                                                           *
*************************************************************/

VOID CALLBACK TimerProc(
            HWND hwnd,  /* handle of window for timer messages  */
            UINT uMsg,  /* WM_TIMER message */
            UINT idEvent,  /* timer identifier */
            DWORD dwTime   /* current system time */
             )  
{
  UpdateFrame();
}
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/rollercoasterold/listing16.html%3Fid%3DDTS10000135-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/rollercoasterold/listing16.html%3Fid%3DDTS10000135-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/rollercoasterold/listing16.html%3Fid%3DDTS10000135-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>