<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1161: Extending the Print Record for LaserWriter 8</title>     <meta name="keywords" content="Mac OS 8 LaserWriter 8 extended print record applications PrJobMerge">    <meta name="Description" content="Technical Note TN1161: This Technical Note describes whatchanges need to be made in your application to support driversthat use extended print records in LaserWriter 8. Includedare the new routines that applications should use to supportthe extended print record."><meta name="categories" content="Printing"><meta name="week-posted" content="Jun 28, 1999 - Jul 2, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003000" title="Extending the Print Record for LaserWriter 8"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxPrinting-date.html" target="_blank">Carbon > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1161</div>
<div id="pageheadsub">Extending the Print Record for LaserWriter 8</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>            <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc --><P id = "menutext">         <A HREF = "#Overview">Overview</A><BR><BR>                  <A HREF = "#Applications">Applications</A><BR><BR>                  <A HREF = "#Implementation">Driver Implementation</A><BR><BR>         <A HREF = "#PrJobMerge">PrJobMerge</A><BR><BR>                         <A HREF = "#Summary">Summary</A><BR><BR>           <A HREF = "#Changes">Change History</A> <BR><BR>        <A HREF = "#References">References</A><BR><BR>        <A HREF = "#Downloads">Downloadables</A></p>        	 <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left>            <!-- begin_intro_text --><P id = "introtext">This Technote describes what changes need to be made in your application to support drivers that use extended print records in LaserWriter 8.</p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Jul 5 1999]</h3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>      <!-- begin_content -->             <A NAME="Overview"></A>                  <H2>Overview</H2><P>With each release of LaserWriter 8, there are several new feature requests that cannot be fulfilled due to the restrictions of the 120-byte print record. These requests usually take the form of "Can't we make 'X' sticky to the document?" Due to the small number of free bits in the print record, the answer to this request has always been "no." Other features--such as custom paper sizes and even multiple paper sizes with the same physical size--have also been restricted due to the print record constraints.  </P>         <P>This method of extending the print record applies only to LaserWriter 8. You should also read the <a href="http://developer.apple.com/macosx/carbon/pdf/CarbonPrinting.pdf">Carbon Printing API</A> to learn how the print record is extended in Carbon. (It's been split into two structures, among other changes.) Using the Carbon APIs is the recommended way to support extended print records. You should use the method described in this Technote for versions of your application that do not support Carbon, since drivers which use the extended print record are available on MacOS 7.6 and later.</P><P>By supporting extended print records, applications can/may profit in many/several ways. The first benefit is that the <CODE>PrJobMerge</CODE> function  actually works. This is a significant advantage, since it allows your application to print multiple documents (in response to a <CODE>'pdoc'</CODE> Apple Event, for example) with a single print dialog, even if the documents use different Page Setups. Secondly, when you use the Extended Print Record, the driver can better support custom paper sizes, or different page sizes that use the same physical paper size. This offers a significant benefit to your users since it allows them to do things like set up a custom paper size for corporate letterhead and save it with their documents in your application.</P>            <BR><P><A HREF = "#top">Back to top</a></p><BR>         <A NAME="Applications"></A>         <H2>Applications</H2><H3>Applications Need to Change</H3>       <P>Many existing applications expect the print record (size) to be 120 bytes. To maintain compatibility with existing applications, printer drivers cannot grow the print record unless the application indicates that it can handle larger print records. As an application writer, you need to first ensure that you don't require the print record size to be exactly <CODE>sizeof(TPrint)</CODE>. Second, to allow a driver to use an extended print record, you must tell it that you are compatible. The new <CODE>PrGeneral</CODE> opcode, <CODE>'kExtendPrintRecOp' (18)</CODE> is implemented in drivers that support the extensible print record. Applications call this new <CODE>PrGeneral</CODE> routine passing in a print record that the driver will mark as extensible. If a printer driver returns the error from the new <CODE>PrGeneral</CODE> routine that it doesn't support extensible print records (<CODE>OpNotImpl</CODE>), the application must ensure that the print record is exactly 120 bytes long.</P><P>The easiest way to revise an application to work with the new extensible print record is to change calls from <CODE>PrDefault()</CODE> to <CODE>extendPrDefault()</CODE> and the calls from <CODE>PrValidate() </CODE> to <CODE>extendPrValidate()</CODE>. These new extend routines are listed below and should be linked in by the application. In order to make these extend calls, the application must meet the following conditions:</P><OL TYPE="1" START="1">    <LI>The application must make no assumptions about the size of the print record. This means that when writing a print record to a document, the application must be prepared for a print record that is larger than 120 bytes. Similarly, when reading a saved print record, the application must read the entire record, even if it is longer than 120 bytes. The application's internal handling of print records must avoid the use of the constant <CODE>sizeof(TPrint)</CODE>, except for drivers which do not support <CODE>kExtendPrintRecOp</CODE>. Applications can still access fields in the first 120 bytes of the print record, but should be aware that the data within the first 120 bytes may be replicated in an extension to the print record.</li>    <LI>The applicationcannot pass the printer driver a fake handle for a print record. To grow print records, the extensible drivers call <CODE>SetHandleSize()</CODE>. If the application is using fake handles,  <CODE>SetHandleSize()</CODE> will cause a crash.</li>    <LI>The application must call <CODE>extendPrDefault()</CODE> or <CODE>extendPrValidate()</CODE> before passing a print record to <CODE>PrStlDialog()</CODE>, <CODE>PrStlInit()</CODE>, <CODE>PrJobDialog()</CODE>, <CODE>PrJobInit()</CODE>, <CODE>PrOpenDoc()</CODE>,  or <CODE>PrGeneral()</CODE>. Applications should already be validating print records before making any of these calls. In addition, applications must call <CODE>extendPrValidate()</CODE> with both print records before calling <CODE>PrJobMerge()</CODE>.</li></OL><H3>An Application's New Extend Routines</H3><P>Here are the new routines that applications should use to support the extended print record:</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>#define kExtendPrintRecordOp 18/*Use this structure when making the 'kExtendPrintRecOp' PrGeneral call.On entry, 'hPrint' is the handle for a standard or extended printrecord. If 'hPrint' is an extended print record, then nothing isdone. If 'hPrint' is a standard print record, then it is extended.*/typedef struct{short iOpCode;short iError;long lReserved;TPrintH hPrint;}TExtendPrintRecord;TExtendPrintRecord extend;Boolean extendPrValidate(THPrint hPrint)/*The current driver is asked to extend the print record.If this fails, the print record handle is sized to the standardsize print record (120 bytes).The current printer driver's PrValidate() routine is called tovalidate the print record whether it has been successfullyextended or not.*/{/*In case 'hPrint' is extended and the current printer driver doesn'tsupport the extensible print record, we let extendPrintRecord()truncate the print record. The print record won't be truncatedif the print record is already the standard size or if the currentdriver supports the extensible print record.*/extendPrintRecord(hPrint);/*Call the real PrValidate with a correctly sized print record.*/return PrValidate(hPrint);}void extendPrDefault(THPrint hPrint){/*The default print record is the standard size for all drivers.So default the 120-byte record.*/SetHandleSize((Handle)hPrint, sizeof(TPrint));PrDefault(hPrint);/*Tell the printer driver it is okay to extend this print record.*/extendPrintRecord(hPrint);}void extendPrintRecord(THPrint hPrint){TExtendPrintRec extend;/*Call the new PrGeneral opcode to see if the current printer driversupports extended print records. If the driver does support extendedprint records, it returns noErr. It marks the print record asextensible and may also extend it at this time.If the driver does not support extended print records,it returns 'OpNotImpl'.*/extend.iOpCode = kExtendPrintRecordOp;extend.lReserved = 0;extend.hPrint = hPrint;PrGeneral(&amp;extend);/*If the driver fails to make the print record extensible,we make sure the print record is the standard 120 bytes.*/if(extend.iError) SetHandleSize((Handle)hPrint, sizeof(TPrint));}</pre></TD></TR></TABLE></CENTER><BR><BR>         <A NAME="Implementation"></A>                  <H2>Driver Implementation</H2>                  <P>In LaserWriter 8's implementation of extended print records, the standard 120 bytes of a <CODE>TPrint</CODE> structure are followed by a four-byte signature field with the value <CODE>'grow'</CODE>. This signature is then followed by a flattened Collection as described in <a href="../../documentation/macos8/Utilities/CollectionManager/collectionmanager.html"><I>Inside Macintosh</I>: Collection Manager</A>.</P>            <BR><P><A HREF = "#top">Back to top</a></p><BR>         <A NAME="PrJobMerge"></A>                  <H2>PrJobMerge</H2>                  <P>The LaserWriter 8 series of drivers has always offered users more options in the Print Dialog than can be stored in the 120 byte print record. With the introduction of the extended print record, all of the user's print features can now be stored in the larger print record. If an application uses extended print records, <CODE>PrJobMerge</CODE> can be used to copy all of a user's feature requests into a new print record. In other words, <CODE>PrJobMerge</CODE> finally works with all of the options from the Print Dialog, beginning with LaserWriter 8.6. </P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>You must extend both the source and destination print records for <CODE>PrJobMerge</CODE> to work correctly with extended print records.</p></TD></TR></TABLE></CENTER><BR><BR><BR><P><A HREF = "#top">Back to top</a></p><BR><A NAME="Summary"></A><H2>Summary</H2>         <P>There is now a mechanism for print records larger than 120 bytes. Applications need to change to take advantage of this larger print record, but the changes are small. With more extensive changes, applications can control more aspects of printing, such as page orientation, layout, error handling, etc., in a clean manner. That information will be presented in a separate document describing the extended print record data used by LaserWriter 8.</P>      <BR><p><a href="#top">Back to top</a></p>            <a name="References"></a><H2>References</H2><P><a href="../../documentation/mac/QuickDraw/QuickDraw-2.html"><I>Inside Macintosh</I>, Imaging With QuickDraw, chapter 9.</A></p> <p><a href="http://developer.apple.com/dev/techsupport/develop/issue27/printhints.html">Print Hints: The All-New LaserWriter Driver Version 8.4, <I>develop</I> 27</A>.</p> <p><A HREF = "tn1112.html">Technote 1112: "Introducing the LaserWriter Driver Version 8.5.1" </A></p> <p><a href="../../documentation/macos8/Utilities/CollectionManager/collectionmanager.html"><I>Inside Macintosh</I>, The Collection Manager</A></p>      <P><A HREF = "#top">Back to top</a></p><BR><a name="Changes"></a><H2>Change History</H2>            <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-May-1996</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-April-1999</P>               </TD>               <td align="left">                  <P>Updated to comply with Technote format, and to include the latest information available.</P>               </TD>            </TR>           <TR>               <td width=100 align=left>                  <P ALIGN=center>05-July-1999</P>               </TD>               <td align="left">                  <P>Updated to include sample code.</P>               </TD>            </TR>            </table>    <P><A HREF = "#top">Back to top</a></p><BR><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (64K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn1161.pdf">Download</A></P></TD>  </TR>   <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/bluebook.gif" width=22 height=23 align=bottom alt="Bluebook"></P></TD><td align="left">   <p>Binhexed Header Files (147K).</P></TD><td width=60 align=left>   <p><A HREF="downloads/tn1161.1.hqx">Download</A></P></TD>  </TR> </table></center><BR><p><a href="#top">Back to top</a></p></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1161.html%3Fid%3DDTS10003000-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1161.html%3Fid%3DDTS10003000-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1161.html%3Fid%3DDTS10003000-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>