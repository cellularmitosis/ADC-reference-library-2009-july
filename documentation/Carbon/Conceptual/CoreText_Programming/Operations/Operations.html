<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Core Text Programming Guide: Common Operations</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Common Operations"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005533-CH4" title="Common Operations"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40005533-CH1-SW1">Core Text Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Overview/Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005533-CH4-SW1" title="Common Operations"></a><h1>Common Operations</h1><p>This chapter describes some common text-layout and font-handling operations and shows, through portions of sample code, how they can be accomplished using Core Text. In addition to the code fragments in this chapter, see the following sample code applications that use Core Text:</p><ul class="ul"><li class="li"><p><em><a href="../../../../../samplecode/CoreTextTest/index.html#//apple_ref/doc/uid/DTS10004140" target="_top">CoreTextTest</a></em> shows how to use Core Text to typeset blocks of text with varying attributes in the context of a complete Carbon application.</p></li><li class="li"><p><em><a href="../../../../../samplecode/CoreTextArc/index.html#//apple_ref/doc/uid/DTS10004328" target="_top">CoreTextArc</a></em> illustrates the use of Core Text fonts, lines, and runs in a Carbon application that sets type along an arched path.</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_4">Simple Paragraphs</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_5">Simple Text Labels</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_6">Columnar Layout</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-SW16">Manual Line Breaking</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-SW4">Font Creation and Storage</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_7">Accessing Font Metrics</a>
				
			<br/>
			
        
			
			
				<a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_8">Creating Related Fonts</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_4" title="Simple Paragraphs"></a><h2>Simple Paragraphs</h2><p>One of the most common operations in typesetting is laying out a multiline paragraph within an arbitrarily sized rectangular area. Core Text makes this operation easy, requiring only a few lines of Core Text–specific code. To lay out the paragraph, you need a graphics context to draw into, a rectangular path to provide the area where the text is laid out, and an attributed string. Most of the code in this example is required to create and initialize the context, path, and string. After that is done, Core Text requires only three lines of code to do the layout.</p><p><span class="content_text">Listing 2-1</span> uses Cocoa to simplify initialization of the graphics context. To see how that operation is done in Carbon, see the <em><a href="../../../../../samplecode/CoreTextTest/index.html#//apple_ref/doc/uid/DTS10004140" target="_top">CoreTextTest</a></em> sample code or “<span class="content_text"><a href="../../../../GraphicsImaging/Conceptual/drawingwithquartz2d/dq_context/dq_context.html#//apple_ref/doc/uid/TP30001066-CH203" target="_top">Graphics Contexts</a></span>“ in the <em><a href="../../../../GraphicsImaging/Conceptual/drawingwithquartz2d/index.html#//apple_ref/doc/uid/TP30001066" target="_top">Quartz 2D Programming Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW2" title="Listing 2-1Typesetting a simple paragraph"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Typesetting a simple paragraph</p><div class="codesample"><table><tr><td scope="row"><pre>// Initialize a graphics context and set the text matrix to a known value.<span></span></pre></td></tr><tr><td scope="row"><pre>CGContextRef context = (CGContextRef)[[NSGraphicsContext currentContext]<span></span></pre></td></tr><tr><td scope="row"><pre>                                                             graphicsPort];<span></span></pre></td></tr><tr><td scope="row"><pre>CGContextSetTextMatrix(context, CGAffineTransformIdentity);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Initialize a rectangular path.<span></span></pre></td></tr><tr><td scope="row"><pre>CGMutablePathRef path = CGPathCreateMutable();<span></span></pre></td></tr><tr><td scope="row"><pre>CGRect bounds = CGRectMake(10.0, 10.0, 200.0, 200.0);<span></span></pre></td></tr><tr><td scope="row"><pre>CGPathAddRect(path, NULL, bounds);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Initialize an attributed string.<span></span></pre></td></tr><tr><td scope="row"><pre>CFStringRef string = CFSTR("We hold this truth to be self-evident, that<span></span></pre></td></tr><tr><td scope="row"><pre>                             everyone is created equal.");<span></span></pre></td></tr><tr><td scope="row"><pre>CFMutableAttributedStringRef attrString =<span></span></pre></td></tr><tr><td scope="row"><pre>                   CFAttributedStringCreateMutable(kCFAllocatorDefault, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>CFAttributedStringReplaceString (attrString,<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFRangeMake(0, 0), string);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create a color and add it as an attribute to the string.<span></span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRef rgbColorSpace = CGColorSpaceCreateDeviceRGB();<span></span></pre></td></tr><tr><td scope="row"><pre>CGFloat components[] = { 1.0, 0.0, 0.0, 0.8 };<span></span></pre></td></tr><tr><td scope="row"><pre>CGColorRef red = CGColorCreate(rgbColorSpace, components);<span></span></pre></td></tr><tr><td scope="row"><pre>CGColorSpaceRelease(rgbColorSpace);<span></span></pre></td></tr><tr><td scope="row"><pre>CFAttributedStringSetAttribute(attrString, CFRangeMake(0, 50),<span></span></pre></td></tr><tr><td scope="row"><pre>                                kCTForegroundColorAttributeName, red);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create the framesetter with the attributed string.<span></span></pre></td></tr><tr><td scope="row"><pre>CTFramesetterRef framesetter =<span></span></pre></td></tr><tr><td scope="row"><pre>                  CTFramesetterCreateWithAttributedString(attrString);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(attrString);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create the frame and draw it into the graphics context<span></span></pre></td></tr><tr><td scope="row"><pre>CTFrameRef frame = CTFramesetterCreateFrame(framesetter,<span></span></pre></td></tr><tr><td scope="row"><pre>                                      CFRangeMake(0, 0), path, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(framesetter);<span></span></pre></td></tr><tr><td scope="row"><pre>CTFrameDraw(frame, context);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(frame);<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_5" title="Simple Text Labels"></a><h2>Simple Text Labels</h2><p>Another very common typesetting operation is drawing a single line of text to use as a label for a user-interface element. In Core Text this requires only two lines of code, one to create the line object with an attributed string and another to draw the line into a graphic context.</p><p><span class="content_text">Listing 2-2</span> omits initialization of the plain text string, font, and graphics context, but it shows how to create an attributes dictionary and use it to create the attributed string. To see how to create a Core Text font, see <span class="content_text"><a href="Operations.html#//apple_ref/doc/uid/TP40005533-CH4-SW4">“Font Creation and Storage.”</a></span></p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW3" title="Listing 2-2Typesetting a simple text label"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Typesetting a simple text label</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef string; CTFontRef font; CGContextRef context;<span></span></pre></td></tr><tr><td scope="row"><pre>// Initialize string, font, and context<span></span></pre></td></tr><tr><td scope="row"><pre>CFStringRef keys[] = { kCTFontAttributeName };<span></span></pre></td></tr><tr><td scope="row"><pre>CFTypeRef values[] = { font };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFDictionaryRef attributes =<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDictionaryCreate(kCFAllocatorDefault, (const void**)&amp;keys,<span></span></pre></td></tr><tr><td scope="row"><pre>        (const void**)&amp;values, sizeof(keys) / sizeof(keys[0]),<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;kCFTypeDictionaryCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;kCFTypeDictionaryValueCallbacks);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CFAttributedStringRef attrString =<span></span></pre></td></tr><tr><td scope="row"><pre>    CFAttributedStringCreate(kCFAllocatorDefault, string, attributes);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(string);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(attributes);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CTLineRef line = CTLineCreateWithAttributedString(attrString);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Set text position and draw the line into the graphics context<span></span></pre></td></tr><tr><td scope="row"><pre>CGContextSetTextPosition(context, 10.0, 10.0);<span></span></pre></td></tr><tr><td scope="row"><pre>CTLineDraw(line, context);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease(line);<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_6" title="Columnar Layout"></a><h2>Columnar Layout</h2><p>Laying out text in multiple columns is another common typesetting operation. Strictly speaking, Core Text itself only performs the layout of one column at a time and does not calculate the column sizes or locations. You do those operations before calling Core Text to lay out the text within the rectangular path area you’ve calculated. In this sample, Core Text, in addition to laying out the text in each column, also provides the subrange within the text string for each column.</p><p><span class="content_text">Listing 2-3</span> mixes Cocoa method calls in Objective-C with function calls into Carbon frameworks and Core Text. It includes an implementation of the <code>drawRect:</code> method of <code>NSView</code>, which calls the local <code>createColumns</code> function, defined first in this listing. This code resides in an <code>NSView</code> subclass in a Cocoa document-based application. The <code>NSView</code> subclass includes an <code>attributedString</code> accessor method, which is not shown here but is called in this listing to return the attributed string to be laid out.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW5" title="Listing 2-3Performing columnar text layout"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Performing columnar text layout</p><div class="codesample"><table><tr><td scope="row"><pre>- (CFArrayRef)createColumns {<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect bounds = CGRectMake(0, 0, NSWidth([self bounds]),<span></span></pre></td></tr><tr><td scope="row"><pre>                                NSHeight([self bounds]));<span></span></pre></td></tr><tr><td scope="row"><pre>    int column;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGRect* columnRects = (CGRect*)calloc(_columnCount, sizeof(*columnRects));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Start by setting the first column to cover the entire view.<span></span></pre></td></tr><tr><td scope="row"><pre>    columnRects[0] = bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Divide the columns equally across the frame's width.<span></span></pre></td></tr><tr><td scope="row"><pre>    CGFloat columnWidth = CGRectGetWidth(bounds) / _columnCount;<span></span></pre></td></tr><tr><td scope="row"><pre>    for (column = 0; column &lt; _columnCount - 1; column++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CGRectDivide(columnRects[column], &amp;columnRects[column],<span></span></pre></td></tr><tr><td scope="row"><pre>                     &amp;columnRects[column + 1], columnWidth, CGRectMinXEdge);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Inset all columns by a few pixels of margin.<span></span></pre></td></tr><tr><td scope="row"><pre>    for (column = 0; column &lt; _columnCount; column++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        columnRects[column] = CGRectInset(columnRects[column], 10.0, 10.0);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create an array of layout paths, one for each column.<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableArrayRef array = CFArrayCreateMutable(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                         _columnCount, &amp;kCFTypeArrayCallBacks);<span></span></pre></td></tr><tr><td scope="row"><pre>    for (column = 0; column &lt; _columnCount; column++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CGMutablePathRef path = CGPathCreateMutable();<span></span></pre></td></tr><tr><td scope="row"><pre>        CGPathAddRect(path, NULL, columnRects[column]);<span></span></pre></td></tr><tr><td scope="row"><pre>        CFArrayInsertValueAtIndex(array, column, path);<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease(path);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    free(columnRects);<span></span></pre></td></tr><tr><td scope="row"><pre>    return array;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)drawRect:(NSRect)rect {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Draw a white background.<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSColor whiteColor] set];<span></span></pre></td></tr><tr><td scope="row"><pre>    [NSBezierPath fillRect:[self bounds]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Initialize the text matrix to a known value.<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextRef context = (CGContextRef)[[NSGraphicsContext currentContext]<span></span></pre></td></tr><tr><td scope="row"><pre>                                          graphicsPort];<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetTextMatrix(context, CGAffineTransformIdentity);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CTFramesetterRef framesetter =<span></span></pre></td></tr><tr><td scope="row"><pre>        CTFramesetterCreateWithAttributedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                            (CFAttributedStringRef)[self attributedString]);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFArrayRef columnPaths = [self createColumns];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex pathCount = CFArrayGetCount(columnPaths);<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex startIndex = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    int column;<span></span></pre></td></tr><tr><td scope="row"><pre>    for (column = 0; column &lt; pathCount; column++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CGPathRef path = (CGPathRef)CFArrayGetValueAtIndex(columnPaths, column);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create a frame for this column and draw it.<span></span></pre></td></tr><tr><td scope="row"><pre>        CTFrameRef frame = CTFramesetterCreateFrame(framesetter,<span></span></pre></td></tr><tr><td scope="row"><pre>                                      CFRangeMake(startIndex, 0), path, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        CTFrameDraw(frame, context);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Start the next frame at the first character not visible in this frame.<span></span></pre></td></tr><tr><td scope="row"><pre>        CFRange frameRange = CTFrameGetVisibleStringRange(frame);<span></span></pre></td></tr><tr><td scope="row"><pre>        startIndex += frameRange.length;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease(frame);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease(columnPaths);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-SW16" title="Manual Line Breaking"></a><h2>Manual Line Breaking</h2><p>You usually don't need to do manual line breaking unless you have a special hyphenation process or a similar requirement. A framesetter performs line breaking automatically. <span class="content_text">Listing 2-4</span> shows how to create a typesetter, an object used by the framesetter, and use it directly to find appropriate line breaks and create a typeset line manually. This sample also shows how to center the line before drawing.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW6" title="Listing 2-4Performing manual line breaking"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Performing manual line breaking</p><div class="codesample"><table><tr><td scope="row"><pre>double width; CGContextRef context; CGPoint textPosition; CFAttributedStringRef attrString;<span></span></pre></td></tr><tr><td scope="row"><pre>// Initialize those variables.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Create a typesetter using the attributed string.<span></span></pre></td></tr><tr><td scope="row"><pre>CTTypesetterRef typesetter = CTTypesetterCreateWithAttributedString(attrString);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Find a break for line from the beginning of the string to the given width.<span></span></pre></td></tr><tr><td scope="row"><pre>CFIndex start = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>CFIndex count = CTTypesetterSuggestLineBreak(typesetter, start, width);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Use the returned character count (to the break) to create the line.<span></span></pre></td></tr><tr><td scope="row"><pre>CTLineRef line = CTTypesetterCreateLine(typesetter, CFRangeMake(start, count));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Get the offset needed to center the line.<span></span></pre></td></tr><tr><td scope="row"><pre>float flush = 0.5; // centered<span></span></pre></td></tr><tr><td scope="row"><pre>double penOffset = CTLineGetPenOffsetForFlush(line, flush, width);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Move the given text drawing position by the calculated offset and draw the line.<span></span></pre></td></tr><tr><td scope="row"><pre>CGContextSetTextPosition(context, textPosition.x + penOffset, textPosition.y);<span></span></pre></td></tr><tr><td scope="row"><pre>CTLineDraw(line, context);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Move the index beyond the line break.<span></span></pre></td></tr><tr><td scope="row"><pre>start += count;<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-SW4" title="Font Creation and Storage"></a><h2>Font Creation and Storage</h2><p>The example function in <span class="content_text">Listing 2-5</span> creates a font descriptor from a PostScript font name and a float specifying the point size.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW7" title="Listing 2-5Creating a font descriptor from a name and point size"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Creating a font descriptor from a name and point size</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontDescriptorRef CreateFontDescriptorFromName(CFStringRef iPostScriptName,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                  CGFloat iSize)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    assert(iPostScriptName != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    return CTFontDescriptorCreateWithNameAndSize(iPostScriptName, iSize);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-6</span> creates a font descriptor from a font family name and font traits.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW8" title="Listing 2-6Creating a font descriptor from a family and traits"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>Creating a font descriptor from a family and traits</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontDescriptorRef CreateFontDescriptorFromFamilyAndTraits(CFStringRef iFamilyName,<span></span></pre></td></tr><tr><td scope="row"><pre>          CTFontSymbolicTraits iTraits, CGFloat iSize)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontDescriptorRef descriptor = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableDictionaryRef attributes;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    assert(iFamilyName != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create a mutable dictionary to hold our attributes.<span></span></pre></td></tr><tr><td scope="row"><pre>    attributes = CFDictionaryCreateMutable(kCFAllocatorDefault, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>              &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);<span></span></pre></td></tr><tr><td scope="row"><pre>    check(attributes != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (attributes != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFMutableDictionaryRef traits;<span></span></pre></td></tr><tr><td scope="row"><pre>        CFNumberRef symTraits;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Add a family name to our attributes.<span></span></pre></td></tr><tr><td scope="row"><pre>        CFDictionaryAddValue(attributes, kCTFontFamilyNameAttribute, iFamilyName);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create the traits dictionary.<span></span></pre></td></tr><tr><td scope="row"><pre>        symTraits = CFNumberCreate(kCFAllocatorDefault, kCFNumberSInt32Type,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;iTraits);<span></span></pre></td></tr><tr><td scope="row"><pre>        check(symTraits != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (symTraits != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create a dictionary to hold our traits values.<span></span></pre></td></tr><tr><td scope="row"><pre>            traits = CFDictionaryCreateMutable(kCFAllocatorDefault, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;kCFTypeDictionaryKeyCallBacks, &amp;kCFTypeDictionaryValueCallBacks);<span></span></pre></td></tr><tr><td scope="row"><pre>            check(traits != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if (traits != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>                // Add the symbolic traits value to the traits dictionary.<span></span></pre></td></tr><tr><td scope="row"><pre>                CFDictionaryAddValue(traits, kCTFontSymbolicTrait, symTraits);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                // Add the traits attribute to our attributes.<span></span></pre></td></tr><tr><td scope="row"><pre>                CFDictionaryAddValue(attributes, kCTFontTraitsAttribute, traits);<span></span></pre></td></tr><tr><td scope="row"><pre>                CFRelease(traits);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            CFRelease(symTraits);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create the font descriptor with our attributes and input size.<span></span></pre></td></tr><tr><td scope="row"><pre>        descriptor = CTFontDescriptorCreateWithAttributes(attributes);<span></span></pre></td></tr><tr><td scope="row"><pre>        check(descriptor != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFRelease(attributes);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    // Return our font descriptor.<span></span></pre></td></tr><tr><td scope="row"><pre>    return descriptor;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-7</span> creates a font from a provided font descriptor.  It calls <code><a href="../../../Reference/CTFontRef/Reference/reference.html#//apple_ref/c/func/CTFontCreateWithFontDescriptor" target="_top">CTFontCreateWithFontDescriptor</a></code>, passing <code>NULL</code> for the matrix parameter to specify the default (identity) matrix.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW9" title="Listing 2-7Creating a font from a font descriptor"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Creating a font from a font descriptor</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontRef CreateFont(CTFontDescriptorRef iFontDescriptor, CGFloat iSize)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    check(iFontDescriptor != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create the font from the font descriptor and input size. Pass<span></span></pre></td></tr><tr><td scope="row"><pre>    // NULL for the matrix parameter to use the default matrix (identity).<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return CTFontCreateWithFontDescriptor(iFontDescriptor, iSize, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-8</span> creates XML data to serialize a font for embedding in a document. Alternatively, and preferably, <code>NSArchiver</code> could be used. This is just one way to accomplish this task, but it preserves all data from the font needed to re-create the exact font at a later time.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW10" title="Listing 2-8Serializing a font"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Serializing a font</p><div class="codesample"><table><tr><td scope="row"><pre>CFDataRef CreateFlattenedFontData(CTFontRef iFont)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDataRef           result = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontDescriptorRef descriptor;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDictionaryRef     attributes;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    check(iFont != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the font descriptor for the font.<span></span></pre></td></tr><tr><td scope="row"><pre>    descriptor = CTFontCopyFontDescriptor(iFont);<span></span></pre></td></tr><tr><td scope="row"><pre>    check(descriptor != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (descriptor != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Get the font attributes from the descriptor. This should be enough<span></span></pre></td></tr><tr><td scope="row"><pre>        // information to recreate the descriptor and the font later.<span></span></pre></td></tr><tr><td scope="row"><pre>        attributes = CTFontDescriptorCopyAttributes(descriptor);<span></span></pre></td></tr><tr><td scope="row"><pre>        check(attributes != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (attributes != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // If attributes are a valid property list, directly flatten<span></span></pre></td></tr><tr><td scope="row"><pre>            // the property list. Otherwise we may need to analyze the attributes<span></span></pre></td></tr><tr><td scope="row"><pre>            // and remove or manually convert them to serializable forms.<span></span></pre></td></tr><tr><td scope="row"><pre>            // This is left as an exercise for the reader.<span></span></pre></td></tr><tr><td scope="row"><pre>           if (CFPropertyListIsValid(attributes, kCFPropertyListXMLFormat_v1_0)) {<span></span></pre></td></tr><tr><td scope="row"><pre>                result = CFPropertyListCreateXMLData(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                 attributes);<span></span></pre></td></tr><tr><td scope="row"><pre>                check(result != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-9</span> creates a font reference from flattened XML data. It shows how to unflatten font attributes and create a font with those attributes.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW11" title="Listing 2-9Creating a font from serialized data"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Creating a font from serialized data</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontRef CreateFontFromFlattenedFontData(CFDataRef iData)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontRef           font = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFDictionaryRef     attributes;<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontDescriptorRef descriptor;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    check(iData != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create our font attributes from the property list. We will create<span></span></pre></td></tr><tr><td scope="row"><pre>    //  an immutable object for simplicity, but if you needed to massage<span></span></pre></td></tr><tr><td scope="row"><pre>    // the attributes or convert certain attributes from their serializable<span></span></pre></td></tr><tr><td scope="row"><pre>    // form to the Core Text usable form, you could do it here.<span></span></pre></td></tr><tr><td scope="row"><pre>    attributes =<span></span></pre></td></tr><tr><td scope="row"><pre>          (CFDictionaryRef)CFPropertyListCreateFromXMLData(kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                      iData, kCFPropertyListImmutable, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    check(attributes != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (attributes != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create the font descriptor from the attributes.<span></span></pre></td></tr><tr><td scope="row"><pre>        descriptor = CTFontDescriptorCreateWithAttributes(attributes);<span></span></pre></td></tr><tr><td scope="row"><pre>        check(descriptor != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (descriptor != NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Create the font from the font descriptor. We will use<span></span></pre></td></tr><tr><td scope="row"><pre>            // 0.0 and NULL for the size and matrix parameters. This<span></span></pre></td></tr><tr><td scope="row"><pre>            // causes the font to be created with the size and/or matrix<span></span></pre></td></tr><tr><td scope="row"><pre>            // that exist in the descriptor, if present. Otherwise default<span></span></pre></td></tr><tr><td scope="row"><pre>            // values are used.<span></span></pre></td></tr><tr><td scope="row"><pre>            font = CTFontCreateWithFontDescriptor(descriptor, 0.0, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>            check(font != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return font;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_7" title="Accessing Font Metrics"></a><h2>Accessing Font Metrics</h2><p>For every font, glyph designers provide a set of measurements, called metrics, which describe the spacing around each glyph in the font. The typesetter uses these metrics to determine glyph placement. Font metrics are parameters such as ascent, descent, leading, cap height, x-height, and so on.</p><p>The sample functions in this section illustrate how to query a font for its font metric data. The example function in <span class="content_text">Listing 2-10</span> shows how to use line metrics accessors to calculate the line height for a font. In most cases you should not need to do this yourself. If you have a <code>CTLineRef</code> object for a line of text , you could call <code><a href="../../../Reference/CTLineRef/Reference/reference.html#//apple_ref/c/func/CTLineGetTypographicBounds" target="_top">CTLineGetTypographicBounds</a></code> to get the line metrics for the line.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW12" title="Listing 2-10Calculating line height"></a><p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>Calculating line height</p><div class="codesample"><table><tr><td scope="row"><pre>CGFloat GetLineHeightForFont(CTFontRef iFont)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CGFloat lineHeight = 0.0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    check(iFont != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the ascent from the font, already scaled for the font's size<span></span></pre></td></tr><tr><td scope="row"><pre>    lineHeight += CTFontGetAscent(iFont);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the descent from the font, already scaled for the font's size<span></span></pre></td></tr><tr><td scope="row"><pre>    lineHeight += CTFontGetDescent(iFont);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the leading from the font, already scaled for the font's size<span></span></pre></td></tr><tr><td scope="row"><pre>    lineHeight += CTFontGetLeading(iFont);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return lineHeight;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-11</span> demonstrates how to get glyphs for the characters in a string with a single font. Most of the time you should just use a CTLine object to get this information because one font may not encode the entire string. In addition, simple character-to-glyph mapping will not get the correct appearance for complex scripts. This simple glyph mapping may be appropriate if you are trying to display specific Unicode characters for a font.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW13" title="Listing 2-11Getting glyphs for characters"></a><p class="codesample"><strong>Listing 2-11&nbsp;&nbsp;</strong>Getting glyphs for characters</p><div class="codesample"><table><tr><td scope="row"><pre>void GetGlyphsForCharacters(CTFontRef iFont, CFStringRef iString)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UniChar *characters;<span></span></pre></td></tr><tr><td scope="row"><pre>    CGGlyph *glyphs;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex count;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    assert(iFont != NULL &amp;&amp; iString != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get our string length.<span></span></pre></td></tr><tr><td scope="row"><pre>    count = CFStringGetLength(iString);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Allocate our buffers for characters and glyphs.<span></span></pre></td></tr><tr><td scope="row"><pre>    characters = (UniChar *)malloc(sizeof(UniChar) * count);<span></span></pre></td></tr><tr><td scope="row"><pre>    assert(characters != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    glyphs = (CGGlyph *)malloc(sizeof(CGGlyph) * count);<span></span></pre></td></tr><tr><td scope="row"><pre>    assert(glyphs != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the characters from the string.<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringGetCharacters(iString, CFRangeMake(0, count), characters);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the glyphs for the characters.<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontGetGlyphsForCharacters(iFont, characters, glyphs, count);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Do something with the glyphs here, if a character is unmapped<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Free our buffers<span></span></pre></td></tr><tr><td scope="row"><pre>        free(characters);<span></span></pre></td></tr><tr><td scope="row"><pre>        free(glyphs);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40005533-CH4-DontLinkElementID_8" title="Creating Related Fonts"></a><h2>Creating Related Fonts</h2><p>The example functions in this section show how to query fonts for their attributes. The example function in <span class="content_text">Listing 2-12</span> makes a font bold or unbold based on the value of the Boolean parameter passed with the function call. If the current font family does not have the requested style, the function returns <code>NULL</code>.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW14" title="Listing 2-12Changing traits of a font"></a><p class="codesample"><strong>Listing 2-12&nbsp;&nbsp;</strong>Changing traits of a font</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontRef CreateBoldFont(CTFontRef iFont, Boolean iMakeBold)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontSymbolicTraits desiredTrait = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    CTFontSymbolicTraits traitMask;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // If we are trying to make the font bold, set the desired trait<span></span></pre></td></tr><tr><td scope="row"><pre>    // to be bold.<span></span></pre></td></tr><tr><td scope="row"><pre>    if (iMakeBold)<span></span></pre></td></tr><tr><td scope="row"><pre>        desiredTrait = kCTFontBoldTrait;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Mask off the bold trait to indicate that it is the only trait<span></span></pre></td></tr><tr><td scope="row"><pre>    // desired to be modified. As CTFontSymbolicTraits is a bit field,<span></span></pre></td></tr><tr><td scope="row"><pre>    // we could choose to change multiple traits if we desired.<span></span></pre></td></tr><tr><td scope="row"><pre>    traitMask = kCTFontBoldTrait;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create a copy of the original font with the masked trait set to the<span></span></pre></td></tr><tr><td scope="row"><pre>    // desired value. If the font family does not have the appropriate style,<span></span></pre></td></tr><tr><td scope="row"><pre>    // this will return NULL.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return CTFontCreateCopyWithSymbolicTraits(iFont, 0.0, NULL, desiredTrait, traitMask);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The example function in <span class="content_text">Listing 2-13</span> converts a given font to a similar font in another font family, preserving traits if possible. It may return <code>NULL</code>.</p><a name="//apple_ref/doc/uid/TP40005533-CH4-SW15" title="Listing 2-13Converting a font to another family"></a><p class="codesample"><strong>Listing 2-13&nbsp;&nbsp;</strong>Converting a font to another family</p><div class="codesample"><table><tr><td scope="row"><pre>CTFontRef CreateFontConvertedToFamily(CTFontRef iFont, CFStringRef iFamily)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Create a copy of the original font with the new family. This call<span></span></pre></td></tr><tr><td scope="row"><pre>    // attempts to preserve traits, and may return NULL if that is not possible.<span></span></pre></td></tr><tr><td scope="row"><pre>    // Pass in 0.0 and NULL for size and matrix to preserve the values from<span></span></pre></td></tr><tr><td scope="row"><pre>    // the original font.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return CTFontCreateCopyWithFamily(iFont, 0.0, NULL, iFamily);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Overview/Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/CoreText_Programming/Operations/Operations.html%3Fid%3DTP40005533-1.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/CoreText_Programming/Operations/Operations.html%3Fid%3DTP40005533-1.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/CoreText_Programming/Operations/Operations.html%3Fid%3DTP40005533-1.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>