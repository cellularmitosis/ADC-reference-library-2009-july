<HTML>		<HEAD>		<meta http-equiv="content-type" content="text/html;charset=iso-8859-1">		<meta name="Copyright" content="Copyright 2001 Apple Computer, Inc. All Rights Reserved.">        <title>State Discovery</title>		</HEAD>	<body bgcolor="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><a href="Types_of_Adaptors.html" target="_right"><img src="../images/previous.gif" border="0"></a><a href="The_WebObje_mation_Page.html" target="_right"><img src="../images/next.gif" border="0"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "BBCFAAIE"></a><h2><font face="Lucida Grande,Helvetica,Arial">State Discovery</font></h2><!-- apple_doc: pageHeadingEnd --><p>Your site's state is represented by</p><ul><li>a list ofapplication hosts</font></li><li>a list of running application instances on each host</font></li></ul><p>The HTTP adaptor captures your site's state at regular intervals,which you set when you configure the adaptor. You define the methodthat the adaptor uses to gather state information by configuringthe adaptor itself. For details, see  <a href="Overriding__on_Settings.html#BBCDGJGH" target = "_right">"Overriding Default Configuration Settings"</a>.</p><p>The adaptor can obtain the state of your site using one ofthree methods:</p><ul><li><b>Multicastrequest</b> The adaptor sends a multicast request to findout what application hosts are available. After the host list iscompiled, the adaptor polls each host to get its list of runningapplication instances</font></li><li><b>Host list</b> This method requires thatyou configure the host list in the adaptor itself. As with the firstmethod, the adaptor polls the hosts on the list for their listsof running application instances.</font></li><li><b>Configuration file</b> The adaptor obtainsthe site's configuration by reading an <b>XML</b> (ExtensibleMarkup Language) formatted document.</font></li></ul><p>The method that requires the least administration on yourpart is the multicast request. If an application host goes down,the adaptor automatically removes the application instances runningon it from its list of active instances. When the host is broughtback up, the adaptor adds the instances back to its list. You shoulduse this method if your site has many application hosts. See  <a href="#BBCFGHFE">"Using a Multicast Request"</a> formore information.</p><p>The second method, defining a host list for your adaptor,eliminates the multicast request. Use this method if you do notwant the adaptor to send regular multicast requests out on yournetwork or if you seldom add or remove application hosts from yoursite. This is the method that is active by default. However, thehost list contains only one host, <code>localhost</code>. Fordetails, see  <a href="#BBCIEFDB">"Using a Defined Host List"</a>.</p><p>In the third method, using a configuration file, the HTTPadaptor obtains your site's configuration by reading a file. Thisfile can be static or it can be dynamically updated as you configureyour site with Monitor. For details, see  <a href="#BBCCHAFB">"Using a Configuration File"</a>.</p><p>You can write the adaptor configuration file in one of twoways:</p><ul><li><b>Manually</b> Theinformation in the configuration file is stored in a structureddocument using the XML format. For details, see  <a href="#BBCHBGFJ">"The HTTP Adaptor Configuration File"</a>.</font></li><li><b>Using Monitor and wotaskd</b> After configuringyour site to your liking using Monitor, you can have a file createdfor you or you can copy and paste the information. See  <a href="#BBCGBGJA">"Creating the HTTP Adaptor Configuration File"</a> for more information.</font></li></ul><br><a name = "BBCFGHFE"></a><h3><font face="Lucida Grande,Helvetica,Arial">Using a Multicast Request</font></h3><p>When you configure an adaptor to obtain your site's stateusing a multicast discovery request, the adaptor obtains the listof active application hosts by broadcasting a message to which eachcomputer configured as a WebObjects application host responds. Afterthe adaptor compiles the list of available hosts, it polls eachone to obtain its state (the list of running application instances).</p><p>There are drawbacks to using the multicast method:</p><ul><li>It increasesnetwork traffic. By default, the HTTP adaptor send a multicast request every100 seconds</font></li><li>A host may become unavailable between discovery requests ifthe multicast request or a wotaskd process's response is lost(multicast is an inherently unreliable protocol).</font></li><li>Normally, multicast broadcasts are limited to a subnet. However,you can configure your routers to pass on the multicast requestto other subnets if you wish.</font></li></ul><p>By default, wotaskd does not respond to multicast requests.To be able to use the multicast request method, you must configurewotaskd processes in your application hosts to respond to multicastrequests.</p><br><a name = "BBCDGCAE"></a><h4><font face="Lucida Grande,Helvetica,Arial">Multicast Request</font></h4><p>To discover available hosts, the adaptor sends a host discoveryrequest on the multicast channel (a nonrouting IP address and aport number), which is set to IP address <code>239.128.14.2</code> andport <code>1085</code> by default.The frequency of each multicast request is ten times as long asthe adaptor's configuration refresh interval. For details on howto change the multicast channel, see  <a href="Overriding__on_Settings.html#BBCCCFFI" target = "_right">"Setting the Multicast Address and Port"</a>,  <a sector="mod" href="../Reference/iCommand_Line_Arguments.html" target="_top">"WOPort"</a>,  <a sector="mod" href="../Reference/iCommand_Line_Arguments.html" target="_top">"WOMulticastAddress"</a>, and  <a sector="mod" href="../Reference/iCommand_Line_Arguments.html" target="_top">"WORespondsToMulticastQuery"</a>.When a wotaskd process starts, it creates a UDP (User Datagram Protocol)socket that listens to the multicast channel through which it receivesmulticast requests.</p><br><table border = "0" BGCOLOR="#E6E6E6"><tr><td scope="row"><b>Note: </b>Ifyou change the address and port that adaptors use to send multicastrequests, you must also change the address and port that wotaskdprocesses use to receive multicast requests.</td></tr></table><br><p>When each wotaskd process receives the multicast request,it replies with its URL, such as <code>http://host1.site.com:1085</code>.The adaptor in turn compiles a list of these URLs.</p><p>Sending a multicast request on an entire subnet is an expensiveprocedure. If your available hosts never change, consider usinga defined host list instead.</p><br><a name = "TPXREF105"></a><h4><font face="Lucida Grande,Helvetica,Arial">Host Polling</font></h4><p>After the HTTP adaptor constructs the host list, it pollseach application host on the list for information on the activeapplication instances running on it. Each wotaskd process, in turn,sends its state information using the format in  <a href="#BBCBEBDJ">Listing 4-2</a>. Hostpolling to obtain information on active instances occurs at theinterval indicated in the configuration refresh interval settingfor the HTTP adaptor.  <a href="#BBCFBIGF">Figure 4-4</a> illustrates the process used to determine the configurationof the site in  <a href="Adaptors_Ap_s_and_Hosts.html#BBCGJGGA" target = "_right">Figure 4-3</a>.</p><br><a name = "BBCFBIGF"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure4-4 Dynamic site configuration using multicastrequest and polling</font></b></p> <img src = "../Art/configadaptor_auto.gif" alt = "[image: ../Art/configadaptor_auto.gif]"><br><a name = "BBCIEFDB"></a><h3><font face="Lucida Grande,Helvetica,Arial">Using a Defined Host List</font></h3><p>This method is similar to the one described in  <a href="#BBCFGHFE">"Using a Multicast Request"</a>.The only difference is that the HTTP adaptor skips the first part,the multicast request. The host polling process occurs at the intervalset in the adaptor's configuration refresh interval setting.</p><p>You must explicitly define a host list for each adaptor. See  <a href="Overriding__on_Settings.html#BBCCGDFA" target = "_right">"Setting the Host List"</a> for detailson defining the host list for each of the adaptors provided.</p><br><a name = "BBCCHAFB"></a><h3><font face="Lucida Grande,Helvetica,Arial">Using a Configuration File</font></h3><p>Using an HTTP adaptor configuration file is useful when youwant to have a static site configuration (one in which applicationinstances are not stopped after they are started) or if you wantto use Monitor to configure your site and have the adaptor readyour configuration changes immediately. (The adaptor reads the configurationfile every 10 seconds to determine which application instances areactive.)</p><p>This method also provides a way of having more than one configurationof your site available. You can switch among different configurationsby placing the appropriate configuration file in the configurationdirectory.</p><p> <a href="#BBCHBGFJ">"The HTTP Adaptor Configuration File"</a> explains how the fileis structured and lists the properties that it defines. For instructionson creating the configuration file and configuring the HTTP adaptorto use it, see  <a href="#BBCGBGJA">"Creating the HTTP Adaptor Configuration File"</a>.</p><br><a name = "BBCHBGFJ"></a><h4><font face="Lucida Grande,Helvetica,Arial">The HTTP Adaptor ConfigurationFile</font></h4><p>You can set up the HTTP adaptor to get your site's configurationby reading an HTTP adaptor configuration file (called <code>WOConfig.xml</code> bydefault) in the configuration directory (<tt>/Library/WebObjects/Configuration</tt> bydefault). You should have only one adaptor configuration file perWeb server so that it can perform load balancing effectively. (See  <a sector="mod" href="../Deployment/iLoad_Balancing.html" target="_top">"Load Balancing"</a> for details.)In addition, in a site with multiple Web servers, if two serversshare the configuration file, instead of deploying two sites youwould be deploying the same site twice.  <a href="#TPXREF102">Listing 4-1</a> shows a configurationfile that defines a site with two application hosts (<code>ebruce.apple.com</code> and <code>ejays.apple.com</code>),each running two application instances, one of the Payroll applicationand the other of the HR application.</p><a name = "TPXREF102"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing4-1 A WebObjects adaptor configuration file</font></b></p><pre>&lt;?xml version="1.0" encoding="ASCII"?&gt;&lt;adaptor&gt;  &lt;application name="Payroll" urlVersion="4"&gt;    &lt;instance id="1" port="2002" host="ebruce.apple.com"/&gt;    &lt;instance id="2" port="2001" host="ejays.apple.com"/&gt;  &lt;/application&gt;  &lt;application name="HR" urlVersion="4"&gt;    &lt;instance id="1" port="2001" host="ebruce.apple.com"/&gt;    &lt;instance id="2" port="2002" host="ejays.apple.com"/&gt;  &lt;/application&gt;&lt;/adaptor&gt;</pre><p>The HTTP adaptor configuration file provides the HTTP adaptorwith information about your site's registered application instances.The format of the configuration file is provided in  <a href="#BBCBEBDJ">Listing 4-2</a> (youcan also view it by opening the <code>woadaptor.dtd</code> file,located in the <tt>/Developer/Examples/WebObjects/Source/Adaptors</tt> directory).For information on the properties defined in the configuration file,consult  <a href="#TPXREF106">Table 4-2</a>.</p><a name = "BBCBEBDJ"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Listing4-2 Format of the HTTP adaptor configurationfile</font></b></p><pre>&lt;?xml version="1.0" encoding="ASCII"?&gt;&lt;!DOCTYPE WebObjectsAdaptorConfiguration SYSTEM "woadaptor.dtd"&gt;&lt;adaptor&gt;    &lt;application name=STRING            retries=NUMBER            scheduler=["RANDOM"|"ROUNDROBIN"|"LOADAVERAGE"]            dormant=NUMBER            protocol="http"            redir=URL            poolSize=NUMBER            urlVersion=["3"|"4"]            additionalArgs="unspecified"        &gt;        &lt;instance    id=NUMBER  port=NUMBER  host=STRING            sendTimeout=NUMBER            recvTimeout=NUMBER            cnctTimeout=NUMBER            sendBufSize=NUMBER            recvBufSize=NUMBER            additionalArgs="unspecified"        &gt;        &lt;/instance&gt;    &lt;/application&gt;&lt;/adaptor&gt;</pre><br><table border = "1"><a name = "TPXREF106"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Table4-2 The properties of the HTTP adaptorconfiguration file</font></b></p><br><b><font face="Geneva,Helvetica,Arial" size="1"><tr><td scope="row">Attribute</td><td>&nbsp;</td></tr></b></font><tr><td scope="row"><code>name</code></td><td>This property is used by the adaptor to implement load balancing.The adaptor can load-balance only between instances with the sameapplication name. The property can be used to create groups of instances,even when the instances share the same executable file. This argumentis set automatically for instances started by wotaskd.</td></tr><tr><td scope="row"><code>retries</code></td><td>The number of times a request is retried (trying several instances)if a communications failure occurs before an error page is returnedto the Web server.</td></tr><tr><td scope="row"><code>scheduler</code></td><td>The load-balancing scheme used by the adaptor for instances ofthe application. The options provided by WebObjects are Round-Robin,Random, and Load Average. You can also use a custom load balancerby choosing the Custom option and entering the load balancer'sname.</td></tr><tr><td scope="row"><code>dormant</code></td><td>The number of times the adaptor skips an instance ofthe application before trying again.</td></tr><tr><td scope="row"><code>redir</code></td><td>The URL that the user is redirected to when an instancefails to respond to a direct request.</td></tr><tr><td scope="row"><code>poolSize</code></td><td>The maximum number of simultaneous connections the adaptorshould keep open for each configured instance.</td></tr><tr><td scope="row"><code>urlVersion</code></td><td>The WebObjects version to use for URL parsing and formatting.All WebObjects 4, 4.5, and 5 applications use version 4 URLs bydefault.</td></tr><tr><td scope="row"><code>additionalArgs</code></td><td>Additional information to send to the instance when it's started.</td></tr><tr><td scope="row"><code>id</code></td><td>The instance's identification number. Must be uniquefor the load-balancing process to operate correctly.</td></tr><tr><td scope="row"><code>port</code></td><td>The port on which the instance runs.</td></tr><tr><td scope="row"><code>host</code></td><td>Specifies the network interface that an instance bindsto. This argument should only be used on hosts with multiple network interfaces(IP addresses).</td></tr><tr><td scope="row"><code>sendTimeout</code></td><td>The length of time, in seconds, that the adaptor attemptsto send data to an instance of the application before giving up.</td></tr><tr><td scope="row"><code>recvTimeout</code></td><td>The length of time, in seconds, that the adaptor waitsfor a response from an instance of the application before givingup.</td></tr><tr><td scope="row"><code>cnctTimeout</code></td><td>The length of time, in seconds, before the adaptor givesup connecting to an instance.</td></tr><tr><td scope="row"><code>sendBufSize</code></td><td>The size, in bytes, of the TCP/IP socket send bufferthat's used for adaptor-to-instance communication.</td></tr><tr><td scope="row"><code>recvBufSize</code></td><td>The size, in bytes, of the TCP/IP socket receive bufferthat's used for adaptor-to-instance communication.</td></tr></table><br><br><a name = "BBCGBGJA"></a><h4><font face="Lucida Grande,Helvetica,Arial">Creating the HTTP Adaptor ConfigurationFile</font></h4><p>You can define your site's configuration by writing theHTTP adaptor configuration file by hand. However, Monitor providesyou with an easy-to-use interface that facilitates that task.</p><p> <a sector="mod" href="../Deployment/iDeployment_Tasks.html" target="_top">"Deployment Tasks"</a> shows youhow to configure your site using Monitor. When you are satisfiedwith your configuration, you can save your settings into a configurationfile by copying and pasting or by telling wotaskd to write the file.</p><p>To use the copy-and-paste method, follow these steps:</p><ol><li>In Monitor,display the Hosts page.</font></li><li>Click YES for any host.<p>The host configuration page isdisplayed in a new Web browser window.</p></font></li><li>Copy the contents of the section "Adaptor Config as writtento disk&#151;All Registered Applications and Instances," as shownin  <a href="#BBCDAJFA">Figure 4-5</a>.<br><a name = "BBCDAJFA"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure4-5 Copying the information that makesup the HTTP adaptor configuration file</font></b></p> <img src = "../Art/woconfigxmlcopy.gif" alt = "[image: ../Art/woconfigxmlcopy.gif]"></font></li><li>Using a text editor, create a new file and paste the contentsof the clipboard into it.</font></li><li>Save the file as <code>WOConfig.xml</code> (orany other name you choose) in the configuration directory.<br><a name = "TPXREF107"></a><p><b><font face="Geneva,Helvetica,Arial" size="2">Figure4-6 Creating and saving the HTTP adaptorconfiguration file</font></b></p> <img src = "../Art/woconfigxmlpaste.gif" alt = "[image: ../Art/woconfigxmlpaste.gif]"></font></li></ol><p>If instead of copying and pasting you want wotaskd to createthe configuration file for you, you can start a wotaskd processspecifically to create the file or you can tell wotaskd to continuallymaintain the configuration file.</p><p>To start a wotaskd process specifically to create the file,you must first stop the process that corresponds to the site youconfigured if it's already running on the Web server computer.</p><p>To start a wotaskd process that writes the configuration fileto the default location, execute the following two commands usingyour command shell editor:</p><pre>cd /System/Library/WebObjects/JavaApplications/wotaskd.woa./wotaskd -WOPort &lt;port&gt; -WOSavesAdaptorConfiguration true</pre><p>To specify a different location for the HTTP adaptor configurationfile, follow the instructions in  <a sector="mod" href="../Reference/iCommand_Line_Arguments.html" target="_top">"WODeploymentConfigurationDirectory"</a>.If you want to give the file a different name,  <a href="Overriding__on_Settings.html#BBCCEFGD" target = "_right">"Setting the HTTP Adaptor Configuration File"</a> showsyou how.</p><p>To tell wotaskd to maintain the configuration file on a permanentbasis, add the following to the WOServices script line that startsthe wotaskd process:</p><pre>-WOSavesAdaptorConfiguration true</pre><p>When you restart your Web server, the HTTP adaptor configurationfile is updated every time you make a change to your site's configurationthrough Monitor. The changes are picked up by the HTTP adaptor thenext time it reads the configuration file.</p><p>To configure the HTTP adaptor to read the configuration fileinstead of using a multicast request or a host list, follow theinstructions in  <a href="Overriding__on_Settings.html#BBCCEFGD" target = "_right">"Setting the HTTP Adaptor Configuration File"</a>.</p><br>    <br><a href="Types_of_Adaptors.html" target="_right"><img src="../images/previous.gif" border="0"></a><a href="The_WebObje_mation_Page.html" target="_right"><img src="../images/next.gif" border="0"></a>&nbsp;<br><hr><p><font face="Geneva,Helvetica,Arial" size="2">&#169; 2001 Apple Computer, Inc. (Last Updated August 25, 2001)</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></html>