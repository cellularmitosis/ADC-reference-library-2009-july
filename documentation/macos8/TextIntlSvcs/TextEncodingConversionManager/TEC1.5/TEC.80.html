<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<script language="JavaScript" src="frametest.js"></script>
<TITLE> ConvertFromTextToUnicode</TITLE><LINK REL="stylesheet" TYPE="text/css" HREF="../../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../../Resources/JavaScript/page.js"></script>
</head>
<body bgcolor="#ffffff">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>

<DIV>
<a name="top"></a>
<!-- start of header -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of header --><A HREF="TEC.7c.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.7f.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.81.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A><br>
<font face="Geneva,Helvetica,Arial" size="1"><b><br>
		PATH<spacer type="horizontal" size="5">&nbsp;</b></font><a href="../../../mac8.html"><font face="Geneva,Helvetica,Arial" size="1">Mac OS 8 and 9 Developer Documentation</a>  <b>&gt;</b> Text Encoding Conversion Manager<br>
		<img src="images/im_smblue.gif" width="116" height="8"><img src="images/space.gif" width="6" height="11">Programming With the Text Encoding Conversion Manager</font><br>
		<br>
		<hr>

</DIV>
<H1>
<A NAME="pgfId=12405">
 </A>
<A NAME="19067">
 </A>
ConvertFromTextToUnicode</H1>
<P>
<A NAME="pgfId=3533">
 </A>
Converts a string from any encoding to Unicode. </P>
<TT>
<A NAME="pgfId=25700">
 </A>
pascal OSStatus ConvertFromTextToUnicode (<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TextToUnicodeInfo iTextToUnicodeInfo, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iSourceLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConstLogicalAddress iSourceStr, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OptionsBits iControlFlags, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount iOffsetCount, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset iOffsetArray[], <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ItemCount *oOffsetCount, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteOffset oOffsetArray[], <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount iOutputBufLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oSourceRead, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ByteCount *oUnicodeLen, <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UniCharArrayPtr oUnicodeStr);</TT>
<DL COMPACT>
<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25704">
 </A>
<TT>iTextToUnicodeInfo</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3536">
 </A>
 A Unicode converter object of type <TT>TextToUnicodeInfo</TT> containing mapping and state information used for the conversion. Your application obtains a Unicode converter object using the function <A HREF="TEC.7d.html" CLASS="XRef"><TT>CreateTextToUnicodeInfo</TT></A>. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25715">
 </A>
<TT>iSourceLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3540">
 </A>
The length in bytes of the source string to be converted. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25724">
 </A>
<TT>iSourceStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3541">
 </A>
The address of the source string to be converted. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25733">
 </A>
<TT>iControlFlags</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=15919">
 </A>
Conversion control flags.  You can use these bitmasks to set the control flags that apply to this function:</DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=18202">
 </A>
<TT>kUnicodeUseFallbacksMask kUnicodeLooseMappingsMask kUnicodeKeepInfoMask kUnicodeStringUnterminatedMask kUnicodeForceASCIIRangeMask kUnicodeNoHalfwidthCharsMask</TT></DD><P>

<DD CLASS="DD.DefinitionDefCont">
<A NAME="pgfId=18203">
 </A>
See <A HREF="TEC.6d.html" CLASS="XRef">
Conversion Control Flags</A>
.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25761">
 </A>
<TT>iOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=15926">
 </A>
The number of offsets in the <TT>iOffsetArray</TT> parameter. Your application supplies this value. The number of entries in <TT>iOffsetArray</TT> must be fewer than the number of bytes specified in <TT>iSourceLen</TT>. If you don't want offsets returned to you, specify <TT>0</TT> (zero) for this parameter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25770">
 </A>
<TT>iOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3550">
 </A>
An array of type <TT>ByteOffset.</TT> On input, you specify the array that contains an ordered list of significant byte offsets pertaining to the source string. These offsets may identify font or style changes, for example, in the source string. All array entries must be less than the length in bytes specified by the <TT>iSourceLen</TT> parameter. If you don't want offsets returned to your application, specify <TT>NULL</TT> for this parameter and <TT>0</TT> (zero) for <TT>iOffsetCount</TT>. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25779">
 </A>
<TT>oOffsetCount</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3551">
 </A>
A pointer to a value of type <TT>ItemCount</TT>. On output, this value contains the number of offsets that were mapped in the output stream.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25788">
 </A>
<TT>oOffsetArray</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3552">
 </A>
An array of type <TT>ByteOffset</TT>.<TT> </TT>On output, this array contains the corresponding new offsets for the Unicode string produced by the converter.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25797">
 </A>
<TT>iOutputBufLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3553">
 </A>
The length in bytes of the output buffer pointed to by the <TT>oUnicodeStr</TT> parameter. Your application supplies this buffer to hold the returned converted string. The <TT>oUnicodeLen</TT> parameter may return a byte count that is less than this value if the converted byte string is smaller than the buffer size you allocated. The relationship between the size of the source string and the Unicode string is complex and depends on the source encoding and the contents of the string. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25806">
 </A>
<TT>oSourceRead</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3554">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value contains the number of bytes of the source string that were converted. If the function returns a <TT>kTECUnmappableElementErr</TT> result code, this parameter returns the number of bytes that were converted before the error occurred. </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25815">
 </A>
<TT>oUnicodeLen</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3555">
 </A>
A pointer to a value of type <TT>ByteCount</TT>. On output, this value contains the length in bytes of the converted stream.</DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25824">
 </A>
<TT>oUnicodeStr</TT></DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=3556">
 </A>
A pointer to an array used to hold a Unicode string. On input, this value points to the beginning of the array for the converted string. On output, this buffer holds the converted Unicode string. (For guidelines on estimating the size of the buffer needed, see the following discussion.) For a description of the UniCharArrayPtr data type, see <A HREF="TEC.18.html" CLASS="XRef">
Basic Text Types Reference</A>
 </DD><P>

<DT CLASS="DT.DefinitionTerm">
<A NAME="pgfId=25833">
 </A>
<I CLASS="italics">
function result</I>
 </DT>
<DD CLASS="DD.DefinitionDef">
<A NAME="pgfId=14276">
 </A>
A result code. See <A HREF="TEC.20.html" CLASS="XRef">
Text Encoding Conversion Manager Result Codes</A>
 in the chapter <A HREF="TEC.18.html" CLASS="XRef">
Basic Text Types Reference</A>
</DD><P>

</DL COMPACT>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=3564">
 </A>
DISCUSSION</H5>
<P>
<A NAME="pgfId=3565">
 </A>
The <TT>ConvertFromTextToUnicode</TT> function converts a text string in a non-Unicode encoding to Unicode. You specify the source string's encoding in the Unicode mapping structure that you pass to the function <A HREF="TEC.7d.html" CLASS="XRef"><TT>CreateTextToUnicodeInfo</TT></A> to obtain a Unicode converter object for the conversion. You pass the Unicode converter object returned by <TT>CreateTextToUnicodeInfo</TT> to <TT>ConvertFromTextToUnicode</TT> as the <TT>iTextToUnicodeInfo</TT> parameter.<TT> </TT><P>


<A NAME="pgfId=3569">
 </A>
In addition to converting a text string in any encoding to Unicode, the <TT>ConvertFromTextToUnicode</TT> function can map offsets for style or font information from the source text string to the returned converted string. The converter reads the application-supplied offsets, which apply to the source string, and returns the corresponding new offsets in the converted string. If you do not want the offsets at which font or style information occurs mapped to the resulting string, you should pass <TT>NULL</TT> for <TT>iOffsetArray</TT> and <TT>0</TT> (zero) for <TT>iOffsetCount</TT>. <P>


<A NAME="pgfId=3570">
 </A>
Your application must allocate a buffer to hold the resulting converted string and pass a pointer to the buffer in the <TT>oUnicodeStr</TT> parameter. To determine the size of the output buffer to allocate, you should consider the size of the source string, its encoding type, and its content in relation to the resulting Unicode string. <P>


<A NAME="pgfId=9241">
 </A>
For example, for 1-byte encodings, such as MacRoman, the Unicode string will be at least double the size (more if it uses noncomposed Unicode); for MacArabic and MacHebrew, the corresponding Unicode string could be up to six times as big. For most 2-byte encodings, for example Shift-JIS, the Unicode string will be less than double the size. For international robustness, your application should allocate a buffer three to four times larger than the source string. If the output Unicode text is actually UTF-8--which could occur beginning with the current release of the Text Encoding Conversion Manager, version 1.2.1--the UTF-8 buffer pointer must be cast to <TT>UniCharArrayPtr</TT> before it can be passed as the <TT>oUnicodeStr</TT> parameter. Also, the output buffer length will have a wider range of variation than for UTF-16; for ASCII input, the output will be the same size; for Han input, the output will be twice as big, and so on. <P>


<A NAME="pgfId=12465">
 </A>
The function returns a <TT>noErr</TT> result code if it has completely converted the input string to Unicode without using fallback characters. If the function returns the <TT>paramErr</TT>, <TT>kTECTableFormatErr</TT>, or <TT>kTECGlobalsUnavailableErr</TT> result codes, it did not convert the string.<P>


<A NAME="pgfId=12466">
 </A>
If the function returns <TT>kTECBufferBelowMinimumSizeErr</TT>, the output buffer was too small to allow conversion of any part of the input string. You need to increase the size of the output buffer and try again.<P>


<A NAME="pgfId=12467">
 </A>
If the function returns the <TT>kTECUsedFallbacksStatus</TT> result code, the function has completely converted the string using one or more fallback characters. This can only happen if you set the Unicode-use-fallbacks control flag.<P>


<A NAME="pgfId=12468">
 </A>
If the function returns <TT>kTECOutputBufferFullErr</TT>, the output buffer was not big enough to completely convert the input; <TT>oSourceRead</TT> indicates the amount of input converted. You can call the function again with another output buffer--or with the same output buffer, after copying its contents--to convert the remainder of the input string.<P>


<A NAME="pgfId=12469">
 </A>
If the function returns <TT>kTECPartialCharErr</TT>, the input buffer ended with an incomplete multibyte character. If you have subsequent input text available, you can append the unconverted input from this call to the beginning of the subsequent input text and call the function again.<P>


<A NAME="pgfId=12470">
 </A>
If the function returns <TT>kTECUnmappableElementErr</TT> because an input text element could not be mapped to Unicode, then the function did not completely convert the input string. This can only happen if you did not set the Unicode-use-fallbacks control flag. You can set this flag and then convert the remaining unconverted input, or take some other action.</P>
</DIV>
<DIV>
<H5 CLASS="RSb.RoutineSbhd">
<A NAME="pgfId=3583">
 </A>
SPECIAL CONSIDERATIONS</H5>
<P>
<A NAME="pgfId=12471">
 </A>
This function modifies the contents of the Unicode converter object you pass in the <TT>iTextToUnicodeInfo</TT> parameter.</P>
</DIV>
<HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 13 Dec 99)<P><A HREF="TEC.7c.html"><img src="images/up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="TEC.7f.html"><img src="images/previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="TEC.81.html"><img src="images/next.gif" border="0" alt="Next"></A><nobr>&nbsp;</nobr>
<!-- insert Show/Hide frames -->
<a href="javascript:testFrame()">
<script>
<!--
document.write(frameLink);
//	-->
</script><!-- end Show/Hide frames --></A>

<!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY>
</HTML>
