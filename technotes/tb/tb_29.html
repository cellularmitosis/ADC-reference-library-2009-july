<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="WMgrPort"><meta name="Description" content="Technical Note TB29: This Technical Note talks about howyou should avoid using the WMgrPort (window manager port)at all cost!"><title>Technical Note TB29: WMgrPortability</title>                               <meta name="categories" content="Human Interface Toolbox"><meta name="week-posted" content="Mar 28, 1988 - Apr 1, 1988"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002780" title="WMgrPortability"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TB29</div>
<div id="pageheadsub">WMgrPortability</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Beware</A><BR><BR><A HREF="#Section2">WMgrPort and GrayRgn</A><BR><BR><A HREF="#Section3">Rules</A><BR><BR><A HREF="#Section4">Examples</A><BR><BR><A HREF="#Section5">How to do these effects</A><BR><BR><A HREF="#Section6">WDEFs and MDEFs</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">Where <code>WMgrPort</code> (the Window Manager's port), MultiFinder, and drawingoutside of one's windows will be reconciled.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1988]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Beware</h2><p>Drawing outside of windows from within an application is guaranteed to makethat application less compatible with future systems. In order to be asMultiFinder compatible as possible, draw only in response to an update event oras part of the feedback for a user action, i.e. while tracking the mouse.MultiFinder compatibility is just as important as HFS compatibility!</p><p>MultiFinder documentation warns against drawing in <code>WMgrPort</code> since thesystem "owns" the desktop and windows of other applications besides your ownare drawn within it. This note will tell you how and when to draw outside theconfines of your own windows if you feel that you must.</p><p>In the future the system may provide calls for drawing outside your windowssafely. When that occurs, the techniques described here may no longer be valid.Nevertheless....</p><P><A HREF="#top">Back to top</A></p><a name="Section2"></a><h2>WMgrPort and GrayRgn</h2><p><code>WMgrPort</code> has its <code>visRgn</code> set to include all active screens. Its<code>clipRgn</code> is initially set to "wide open" (the rectangle -32767, -32767,32767, 32767), although Window Manager routines like <code>ClipAbove</code>, etc.will change it. Consider this <code>GrafPort</code> read-only. The global variable<code>GrayRgn</code> is a region which is equal to the <code>WMgrPort</code>'s<code>visRgn</code> minus the menu bar area.</p><p>Note that you should use <code>GrayRgn</code>, which is the best way to find outthe shape, size, and coordinates of the screens. You will never have to use the<code>WMgrPort</code> directly, and should not call <code>GetWMgrPort</code> under anycircumstances.</p><P><A HREF="#top">Back to top</A></p><a name="Section3"></a><h2>Rules</h2><p>Only draw to the whole screen/desktop in a "modal" way. This can take the formof a brief animation across windows or the visual feedback for dragging fromone window to another. It is important to know that no other application(including the Finder) will draw until you have finished. To guarantee this,you must follow some rules:</p><p>In the case of a drag, you should only draw while the mouse button is down. Inthe case of an animation effect, the drawing should be of brief duration.  Alloperations should conclude with nothing left drawn outside your windows. UnderMultiFinder (version 1.0 and 6.0 at least) you will be OK if you don't call<code>GetNextEvent</code>, <code>EventAvail</code>, or <code>WaitNextEvent</code> whiledrawing outside your windows. Use the <code>StillDown</code> function (or the<code>WaitMouseUp</code> function) for loops that wait for the mouse button to goup. Remember, however, it is only through possible future system-provided callsthat you can be completely safe from others drawing underneath you.</p><p>Never draw something on the desktop and leave it there. There is no way to tellthe system that you have drawn on that bit of desktop, so the Finder will drawright over you.</p><P><A HREF="#top">Back to top</A></p><a name="Section4"></a><h2>Examples</h2><p>The most famous animation effect is the <code>ZoomRect</code> routine. It is usedby the Finder to draw a series of nested rectangles around an icon that isbeing opened. The rectangles form a progression (zoom) out to where the windowfor the icon will be placed.</p><p>Another, potentially more interesting, case is where you want to drag somethingfrom one window to another, perhaps to copy it. This is often done with<code>DragGrayRgn</code>, which for this purpose will do the right thing (not call<code>GetNextEvent</code>, etc.).</p><P><A HREF="#top">Back to top</A></p><a name="Section5"></a><h2>How to do these effects</h2><p>Use a <code>GrafPort</code> (not a window or the <code>WMgrPort</code>) that covers allthe screens. <code>OpenPort</code> will set up most of the fields of the<code>GrafPort</code> properly. All you have to do is change the <code>visRgn</code> ofyour port to a copy of <code>GrayRgn</code> and put the <code>GrayRgn</code>'s<code>rgnBBox</code> into your <code>portRect</code>. Directly manipulating the<code>visRgn</code> of a window is a no-no under MultiFinder.</p><p>Draw using <code>srcXor</code> mode. This will allow you to erase as you go, bydrawing each object a second time, also in <code>srcXor</code> mode. You must leaveall areas outside your windows exactly as you found them.</p><P><A HREF="#top">Back to top</A></p><a name="Section6"></a><h2>WDEFs and MDEFs</h2><p>Window and menu definition procedures draw in the current port, which is set tothe <code>WMgrPort</code> by the Window Manager and the Menu Manager. Note thatthis means that you do not ever have to call <code>GetWMgrPort</code>, as mentionedabove. We recommend that you never draw into it except from one of theseprocedures.</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P>The Window Manager</p><P>QuickDraw</p><P>MultiFinder Development Package</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tb_29.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tb/tb_29.html%3Fid%3DDTS10002780-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tb/tb_29.html%3Fid%3DDTS10002780-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tb/tb_29.html%3Fid%3DDTS10002780-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>