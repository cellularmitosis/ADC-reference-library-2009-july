<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>PBOpen(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING24></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-23.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-25.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-10.html"><B>Chapter 1 - Device Manager</B></A> / <A HREF="Devices-17.html"><B>Device Manager Reference</B></A><BR><DL><DD><A HREF="Devices-21.html"><B>Device Manager Functions</B></A> / <A HREF="Devices-22.html"><B>Opening and Closing Device Drivers</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING24-0></A>
<H3><A NAME=MARKER-9-308></A>PBOpen</H3>
 <A NAME=MARKER-11-309></A><A NAME=MARKER-2-38></A>You can use the <CODE>PBOpen</CODE> function to open a closed device driver or to determine the driver reference number of an open device driver.<P>
<PRE>
pascal OSErr PBOpen(ParmBlkPtr paramBlock, Boolean async); 
</PRE>
<DL>
<DT><CODE>paramBlock</CODE>
<DD> A pointer to an <CODE>IOParam</CODE> structure of the Device Manager parameter block.
<DT><CODE>async</CODE>
<DD> A Boolean value that indicates whether the request is asynchronous. You must set this field to <CODE>false</CODE> because device drivers cannot be opened asynchronously.
</DL>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD><--<TD>ioResult<TD>OSErr<TD>The device driver's result code.<TR>
<TD>--><TD>ioNamePtr<TD>StringPtr<TD>A pointer to the driver name.<TR>
<TD><--<TD>ioRefNum<TD>short<TD>The driver reference number.<TR>
<TD>--><TD>ioPermssn<TD>char<TD>Read/write permission.</TABLE>
</B><P>
<A NAME=HEADING24-6></A>
<H5>DESCRIPTION</H5>
 The <CODE>PBOpen</CODE> function opens the device driver specified by the <CODE>ioNamePtr</CODE> field and returns its driver reference number in the <CODE>ioRefNum</CODE> field. To avoid replacing an open driver, the Device Manager searches the drivers that are already installed in the unit table before searching driver resources. If the specified driver is already open, this function simply returns the driver reference number.<P>
 If the driver is not already open, the Device Manager calls the <CODE>GetNamedResource</CODE> function using the specified name and the resource type <CODE>'DRVR'</CODE>. If the resource is found, the resource ID defines the unit number of the driver, which determines the location in the unit table where the Device Manager stores the handle to the driver's device control entry (DCE).<P>
 After loading the driver resource into memory, the Device Manager creates a DCE for the driver, copies the flags from the driver header to the <CODE>dCtlFlags</CODE> field, and places the driver reference number in the <CODE>dCtlRefNum</CODE> field.<P>
 You specify the access permission for the device driver by placing one of the following constants in the <CODE>ioPermssn</CODE> field of the parameter block:<P>
<PRE>
enum {
   /* access permissions */
   fsCurPerm         = 0,        /* retain current permission */
   fsRdPerm          = 1,        /* allow reads only */
   fsWrPerm          = 2,        /* allow writes only */
   fsRdWrPerm        = 3         /* allow reads and writes */
};
</PRE>
 If the driver returns a negative result in register D0, the Device Manager returns the result code in the <CODE>ioResult</CODE> parameter and does not open the driver.<P>
<A NAME=HEADING24-13></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Because another driver might already be installed in the unit table at the location determined by the driver's resource ID, you should first search for an unused location in the unit table and renumber the driver resource accordingly before calling this function. See <A HREF=Devices-13.html#MARKER-9-100>Listing 1-1 on page 1-18</A> for an example.<P>
 The <CODE>PBOpen</CODE> function may move memory; you should not call it at interrupt time.<P>
<A NAME=HEADING24-16></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The trap macro for the <CODE>PBOpen</CODE> function is <CODE>_Open</CODE> (0xA000). You must set up register A0 with the address of the parameter block. When <CODE>_Open</CODE> returns, register D0 contains the result code. Register D0 is the only register affected by this function.
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT colspan=2>Registers on entry<TR>
<TD>A0<TD>Address of the parameter block</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT colspan=2>Registers on exit<TR>
<TD>D0<TD>Result code</TABLE>
<P>
<A NAME=HEADING24-18></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>badUnitErr<TD>-21<TD>Driver reference number does not match unit table<TR>
<TD>unitEmptyErr<TD>-22<TD>Driver reference number specifies a <CODE>nil</CODE> handle in unit table<TR>
<TD>openErr<TD>-23<TD>Requested read/write permission does not match driver's open permission<TR>
<TD>dInstErr<TD>-26<TD>Driver resource not found</TABLE>
</H5>
<A NAME=HEADING24-19></A>
<H5>SEE ALSO</H5>
 For information about the high-level function for opening device drivers, see the description of the <CODE>OpenDriver</CODE> function on <A HREF=Devices-23.html#MARKER-9-304>page 1-60</A>. For information about the <BR>low-level function for opening device drivers that serve devices on expansion cards, see the next section, which describes the <CODE>OpenSlot</CODE> function. For an example of opening a device driver, see <A HREF=Devices-13.html#MARKER-9-100>Listing 1-1 on page 1-18</A>.<A NAME=MARKER-2-311></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-23.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-25.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
