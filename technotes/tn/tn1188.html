<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1188: Packages in Mac OS 9</title>       <meta name="keywords" content="Mac OS 9 packages folder file">    <meta name="Description" content="Technical Note TN1188: have creator write a brief descriptionhere."><meta name="categories" content="Overview and System Releases"><meta name="week-posted" content="Sep 27, 1999 - Oct 1, 1999"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003027" title="Packages in Mac OS 9"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1188</div>
<div id="pageheadsub">Packages in Mac OS 9</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr><td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc -->   <P id ="menutext">         <A HREF = "#Section1">Overview</A><BR><BR>         <A HREF = "#Section2">The Package Flag</A><BR><BR>         <A HREF = "#Section3">The Top-Level Alias File</A><BR><BR>         <A HREF = "#Section4">The Package's Main File</A><BR><BR>         <A HREF = "#Section5">Other Support Files</A><BR><BR>         <A HREF = "#Section6">The Optional Open Document EventParameter</A><BR><BR>         <A HREF = "#Section7">Package Compatibility Notes</A><BR><BR>        <A HREF = "#Downloads">Downloadables</A></p> <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technotedescribes        how the Finder implements packages in Mac&nbsp;OS&nbsp;9.Developers        interested in creating packages for use inMac&nbsp;OS&nbsp;9 can use        this document as a guide for creating packages.Mac&nbsp;OS&nbsp;9        packages offer a simple consolidated experience for theuser when        interacting with a package in the Finder's windows, whileat the        same time preventing accidental tampering with a package'srequired        support files.</P>        <p id="introtext">For Mac&nbsp;OS&nbsp;X package compatibility, an additional        package specification for Mac&nbsp;OS&nbsp;X will be released        as an adjunct to the Mac&nbsp;OS&nbsp;9 package specification        described in this document. Upon release of this additional        specification, developers will be able to create packages        to be used in either Mac&nbsp;OS&nbsp;9 orMac&nbsp;OS&nbsp;X.</P>     <!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Oct 11 1999]</h3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><A NAME="Section1"></A><h2>Overview</h2>    <p>Packages in Mac&nbsp;OS&nbsp;9 are not complex.  Simply said,    a Package in Mac&nbsp;OS&nbsp;9 is a folder with the"package&nbsp;bit" set that    contains exactly one alias file at the topmost level.  Normally,    a package will consist of an application and a number of support    files organized into sub-directories.  There is only one requirement    governing the internal organization of packages,    and there are no restrictions on how package sub-directories can    be named, how package sub-directories must be organized, or whatpackage    sub-directories must contain. Figure&nbsp;1 provides an illustration    of a hypothetical package named SimplePlot.</P>    <BR><BR>    <P ALIGN=center><img src="images/tn1188_001.gif" alt="Figure 1" width=462 height=353><BR><BR>    <B>Figure 1.</B> Sample package directory layout. </P>    <BR><BR>    <p>Although requirements for packages in Mac&nbsp;OS&nbsp;9    are few, Figure&nbsp;1 illustrates the two main requirements for    packages:  the appropriate Finder flag must be set    for the package's folder and exactly one relative alias must be present    in the top-level of the package's directory hierarchy.</P><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Section2"></A><h2>The Package Flag</h2>    <p>The folder containing the package has bit 13 (for files, the<CODE>hasBundle</CODE> bit)    set in its Finder flags.  For files, this bit is known as the    "bundle&nbsp;bit" indicating that the file contains a    <CODE>'BNDL'</CODE> resource that is used by the Finder to determine    how the file's icon is displayed.  For more information    about how the Finder <CODE>'BNDL'</CODE> resources see the    <a href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-443.html">Finder Interface</A>    chapter of    <a href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-2.html">Inside Macintosh:Macintosh Toolbox Essentials</A>    .</P>    <p>In Mac&nbsp;OS&nbsp;9, any folder having this bit set isrecognized as    a package.  If this bit is set, and the folder contains exactly    one alias at its topmost level, then the Finder will treat    the folder as a package.</P>    <p>In some circumstances, due to a software problem or a crash, afolder may    wind up having the package bit set when in fact it is not apackage.  In this    case, the Finder will treat such a folder as a "damaged package"and its icon    will appear as a blank document with the kind string set to"package."  To correct    this problem, there is a utility called "Package First Aid"provided on the    Mac&nbsp;OS&nbsp;9 install CD.</P><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Section3"></A><h2>The Top-Level Alias File</h2>    <p>The package's folder contains exactly one alias file    at its topmost level.  This alias points to some other file    in the package's directory hierarchy; and, it should be a    relative alias so that it will remain valid if a package    is copied to another volume.  In this discussion,    the file pointed to by that alias is called the "package's mainfile."</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Compatibility Note:</B><BR>        Although the top-level alias file refers to an"application" in the        example shown in Figure 1, there is no requirement that        the main file in a package must be an application.  It ispossible to        create many types of packages including document packages,library        packages, et cetera.  However, the primary focus forMac&nbsp;OS&nbsp;9        is application packages.  </P></TD></TR></TABLE></CENTER><BR><BR>    <p>The package's main file governs the behavior of the package    in the Finder's windows.  For all intents and purposes, the Findertreats the package    as if it were a file containing the <CODE>'BNDL'</CODE>,<CODE>'FREF'</CODE>, icon resources,    et cetera found in the package's main file.  </P>    <p>For example, when a file is dragged over a package's icon, theFinder    will track the drag command exactly as if the file was beingdragged over    the package's main file.  Referring to Figure 1, say theapplication SimplePlot's    <CODE>'BNDL'</CODE> resource indicated it was capable of openingfiles of type    <CODE>'PLOT'</CODE>, then:</P>    <OL>        <LI>The Finder will allow the user to drop files of type<CODE>'PLOT'</CODE> into the        SimplePlot package and the package's icon will be hilightedappropriately        during drag operations,<BR><BR></LI>        <LI>If a user drops a file of type <CODE>'PLOT'</CODE> intothe SimplePlot package,        the Finder will Launch the SimplePlot application, if it is not        already running, and send an "open documents" Apple eventto the application        asking it to open the file.<BR><BR></LI>    </OL>    <p>There are two ways to create the relative alias file requiredfor a package.    The first is to manually create an alias file in the Finder usingthe "Make Alias"    command.  The second, is to make the appropriate calls to theResource Manager and the    Alias&nbsp;Manager in software as shown in Listing&nbsp;1.</P><BR><pre>/* MakeRelativeAliasFile creates a new alias file located at    aliasDest referring to the targetFile.  relative path    information is stored in the new file. */OSErr MakeRelativeAliasFile(<a href="http://developer.apple.com/documentation/mac/Files/Files-115.html">FSSpec</A> *targetFile, <a href="http://developer.apple.com/documentation/mac/Files/Files-115.html">FSSpec</A> *aliasDest) {    <a href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-464.html">FInfo</A> fndrInfo;    <a href="http://developer.apple.com/documentation/mac/Files/Files-342.html">AliasHandle</A> theAlias;    Boolean fileCreated;    short rsrc;    OSErr err;        /* set up locals */    theAlias = NULL;    fileCreated = false;    rsrc = -1;        /* set up our the alias' file information */    err = <a href="http://developer.apple.com/documentation/mac/Files/Files-195.html">FSpGetFInfo</A>(targetFile, &amp;fndrInfo);    if (err != noErr) goto bail;    if (fndrInfo.fdType == 'APPL')        fndrInfo.fdType = kApplicationAliasType;    fndrInfo.fdFlags = kIsAlias; /* implicitly clear the inited bit */        /* create the new file */    <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-37.html">FSpCreateResFile</A>(aliasDest, 'TEMP', 'TEMP', smSystemScript);    if ((err = <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-35.html">ResError</A>()) != noErr) goto bail;    fileCreated = true;        /* set the file information or the new file */    err = <a href="http://developer.apple.com/documentation/mac/Files/Files-196.html">FSpSetFInfo</A>(aliasDest, &amp;fndrInfo);    if (err != noErr) goto bail;        /* create the alias record, relative to the new alias file */    err = <a href="http://developer.apple.com/documentation/mac/Files/Files-355.html">NewAlias</A>(aliasDest, targetFile, &amp;theAlias);    if (err != noErr) goto bail;        /* save the resource */    rsrc = <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-41.html">FSpOpenResFile</A>(aliasDest, fsRdWrPerm);    if (rsrc == -1) { err = <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-35.html">ResError</A>(); goto bail; }    <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-47.html">UseResFile</A>(rsrc);    <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-64.html">AddResource</A>((Handle) theAlias, rAliasType, 0, aliasDest-&gt;name);    if ((err = <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-35.html">ResError</A>()) != noErr) goto bail;    theAlias = NULL;    <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-89.html">CloseResFile</A>(rsrc);    rsrc = -1;    if ((err = <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-35.html">ResError</A>()) != noErr) goto bail;        /* done */    return noErr;bail:    if (rsrc != -1) <a href="http://developer.apple.com/documentation/mac/MoreToolbox/MoreToolbox-89.html">CloseResFile</A>(rsrc);    if (fileCreated) <a href="http://developer.apple.com/documentation/mac/Files/Files-193.html">FSpDelete</A>(aliasDest);    if (theAlias != NULL) <a href="http://developer.apple.com/documentation/mac/Memory/Memory-73.html">DisposeHandle</A>((Handle) theAlias);    return err;}</pre>          <BR>    <p><B>Listing 1</B>. Sample routine for creating a relative aliasfile.</P><BR>    <p>Developers interested in creating an application for automatingthe creation of packages will want to employ some method similar to theroutine shown in Figure&nbsp;1.  Other options include using the Finder's"Make&nbsp;Alias" command or creating aliases using AppleScript.  Theadvantage of calling <CODE>NewAlias</CODE> directly is that you have morecontrol over how the alias is created and are able to specify which file isused for constructing relative aliases.</P><BR><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Compatibility Note:</B><BR>        When creating aliases using either the Finder's"Make&nbsp;Alias" command,        or the method shown in Figure&nbsp;1, be sure that FileSharing is turned        off.  If file sharing is turned on, then full pathinformation such        as the server name, etc., is stored in the alias making itunsuitable        for use in packages.  Be sure file sharing is turned off before        creating any aliases used in packages.   </P></TD></TR></TABLE></CENTER><BR><BR><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Section4"></A><h2>The Package's Main File</h2>    <p>In the context of the Finder's windows, a package will behave as if    it were a file or an application.  And, all of the properties ofthe package's icon are    determined by the package's main file.  As shown in Figure&nbsp;2,this is    the file referred to by the package's top-level alias file.  </P>    <BR><BR>    <P ALIGN=center><img src="images/tn1188_002.gif" alt="Figure 2" width=308 height=233><BR><BR>    <B>Figure 2.</B> The package's main file. </P>    <BR><BR>    <p>For example, if the package's main file is an application, then the    package will look and feel like an application; and, if the package's    main file is a document, then the package will look and feel like    a document.  The package's main file is used by the Finder to determine    the majority of the external characteristics of the package.  These    characteristics include:</P>    <UL>        <LI>The package's icon,<BR><BR></LI>        <LI>The package's kind (application, document,et&nbsp;cetera),<BR><BR></LI>        <LI>The Get Info data (Excluding the package's size: apackage's size        is the total of the sizes of all of the package's contents.Also, the        package's size is displayed in the Get Info window withoutreference        to the number of items in the package's folder.),<BR><BR></LI>        <LI>Drag-and-drop information,<BR><BR></LI>        <LI>The <CODE>kIsStationery</CODE> and<CODE>kHasCustomIcon</CODE> Finder flags from package's main file are usedwhen displaying the package.  The other Finder flags - specifically theinvisible, name locked, inited, bundle, and color flags - are taken fromthe package folder's flags instead of the main file's flags.<BR><BR></LI>    </UL>    <p>In general, a package will have all the same properties as the    package's main file.  Points where they differ include:</P>    <UL>        <LI>The package's size is the total size of package foldercontents,<BR><BR></LI>        <LI>The main file's name and the package's name may differ.This allows        the user to edit the name of the package without disturbingthe name of the package's main file.<BR><BR></LI>    </UL>    <p>Application packages (package's whose main file is anapplication) accept drag-and-drop operations in Finder windows in the sameway application files    accept drag-and-drop operations in Finder windows.  Here, theacceptance of a drag-and-drop is governed by the properties of thepackage's main file, and ifa drop is allowed, then the Finder will send the appropriate Apple event to thepackage's main file. </P><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Section5"></A><h2>Other Support Files</h2><p>One of the key features of packages is the developer's abilityto consolidate many support files together with the main application.  Bytaking advantage of this facility, developers can group the filesused in a product in a way that both simplifies the user's task of dealingwith the product in the Finder's windows and prevents tampering with thearrangement of the support files used in the product.</P><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Compatibility Note:</B><BR>        Developers currently placing support files for their        applications in the System Folder should consider consolidating        their applications and support files into packages forMac&nbsp;OS&nbsp;9.   </P></TD></TR></TABLE></CENTER><BR><BR><p>A package may contain a complex hierarchy of support files, sharedlibraries, and other types of files used by the application in itsoperation.  Also, it is not unreasonable to suppose that a packagemay contain one or more application files that in some way lendto the overall facility provided by the package.  In Figure 1,the package contains a number of support files including privateshared libraries presumably used by the main application, a numberof AppleScript scripts, and a suite of help files.</P><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Section6"></A><h2>The Optional Open Document Event Parameter</h2><p>Application packages may receive a open document <CODE>'odoc'</CODE>Apple eventscontaining an optional parameter with the key <CODE>'fpdl'</CODE> (Finderpackage document list).  This will be sent to the package when the Finderis asked to open any file inside of a package.  There are a few ways thiscan happen:</P>    <UL>        <LI>While running under a previous version of Mac&nbsp;OS,the user        created an alias referring to an item inside of the package's        folder and put the alias somewhere outside of the package's        folder.  Then, after switching to Mac&nbsp;OS&nbsp;9, theyattempted to        open the item by double clicking on the alias.        <BR><BR></LI>        <LI>An open document event targeting one or more itemsinside of the        package's folder was sent to the Finder by some otherapplication.<BR><BR></LI>        <LI>An alias to an item inside of a package is dropped ontoanother        application.  In this case, rather than launching theapplication that        the alias was dropped onto, the Finder will launch thepackage's        application and send it an open document event containing a<CODE>'fpdl'</CODE>        parameter referring to the file.<BR><BR></LI>    </UL><p>In either case, the Finder will not open the items in the way that itusually does.  Instead, the Finder will package the items into an opendocument Apple event in a <CODE>'fpdl'</CODE> parameter and send the eventto thepackage's application.  The structure of the <CODE>'fpdl'</CODE> parameteris identicalto the structure of the <CODE>keyDirectObject</CODE> open document eventparameter -it is a list of file aliases.  The only difference is, the aliases will allrefer to files or folders inside of the application's directory.</P><p>Your open document event handler should be designed to handleeach of the three different combinations of event parameters itcan receive:</P>    <UL>        <LI>Open document events without the optional<CODE>'fpdl'</CODE> parameter.        <BR><BR></LI>        <LI>Open document events where the<CODE>keyDirectObject</CODE> is an        empty list referring to no documents, but the optional<CODE>'fpdl'</CODE>        parameter contains a list referring to one or more documents.        <BR><BR></LI>        <LI>Open document events where the<CODE>keyDirectObject</CODE>        contains a list referring to one or more documents and theoptional <CODE>'fpdl'</CODE>        parameter contains a list referring to one or more documents.        <BR><BR></LI>    </UL><p>In general, the main application's open document event handler shouldalways look for the optional <CODE>'fpdl'</CODE> parameter and take appropriateactions when it is there.  At the very least, the application shouldprovide appropriate feedback to the user indicating that the requested fileis an internal part of the package and cannot be opened.  Other situationsmay call for different kinds of processing;  for example, say the<CODE>'fpdl'</CODE>parameter contains a reference to a help file inside of the package, then itwould be appropriate for the application to open that help file and displayits contents.</P><p><A HREF = "#top">Back to top</a> </p><BR><BR><BR><A NAME="Section7"></A><h2>Package Compatibility Notes</h2><p>Packages cannot be shared by way of Personal File Sharing inMac&nbsp;OS&nbsp;9. </P><p>The StandardFile dialogs are not aware of packages.  As a result,it is possible for users to use these windows to navigate into packagefolders and either attempt to open documents inside of them or savedocuments inside of packages.  Navigation Services has been updatedto recognize packages and it does not allow users to navigate intothem (unless specifically directed to do so).</P><p><A HREF = "#top">Back to top</a> </p><BR><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (244K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn1188.pdf">Download</A></P></TD>  </TR> </table></center><BR><BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1188.html%3Fid%3DDTS10003027-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1188.html%3Fid%3DDTS10003027-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1188.html%3Fid%3DDTS10003027-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>