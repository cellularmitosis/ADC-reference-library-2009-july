<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Working With Drag Data (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING77></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-76.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-78.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-72.html"><B>Chapter 9 - Drag and Drop</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING77-0></A>
<H1><A NAME=MARKER-2-101></A>Working With Drag Data</H1>
 MacApp supplies a number of classes and methods for efficient manipulation of drag data. The following sections provide additional detail on classes and topics introduced earlier in this chapter.<P>
<A NAME=HEADING77-2></A>
<H2><A NAME=MARKER-9-102></A>CDragItemIterator</H2>
 The <CODE><A NAME=MARKER-2-103></A>CDragItemIterator</CODE> class provides an iterator that traverses the <CODE>TDragItem</CODE> objects in a drag operation. A <CODE>CDragItemIterator</CODE> object is passed as a parameter to several <CODE>TView</CODE> methods during a drag session. For example, the <CODE>TView::WillAcceptDrop</CODE> method uses a passed iterator to determine whether the view can accept the data in the drag.<P>
<A NAME=HEADING77-4></A>
<H2><A NAME=MARKER-2-104></A>How Data Is Represented</H2>
 The Macintosh Drag Manager supports dragging of data in multiple representations, or <B>flavors.</B> This is similar to the concept of putting Clipboard data on the desk scrap in multiple formats, such as PICT and TEXT. A drag source should supply or promise data in as many flavors as it can support, to increase the likelihood that a drop target will be able to accept the dragged data.<P>
 MacApp supplies the <CODE>TDragItem</CODE> class <A HREF=#MARKER-9-108>(page 267)</A> to aid your application in supplying data to the Drag Manager, and the <CODE><A NAME=MARKER-2-24></A>CFlavorFlags</CODE> data structure to provide simplified access to the Drag Manager <CODE><A NAME=MARKER-2-45></A>FlavorFlags</CODE> data type.<P>
<A NAME=HEADING77-7></A>
<H2><A NAME=MARKER-9-107></A>When a View Should Accept a Drop</H2>
 A view should examine the contents of a drag and determine whether it can accept the dragged item(s). The human interface guidelines for drag and drop suggest that a drop target should accept a drop only if <I>all</I> items can be accepted. This eliminates any ambiguity that might result if a drop target only accepted a subset of items being dragged.<P>
 If a view can accept only a single item and the passed <CODE>CDragItemIterator</CODE> object represents multiple items, the view should refuse to accept the drop. For example, a <CODE>TPicture</CODE> view accepts a drag if there is exactly one item and it has the PICT flavor.<P>
<DL>
<DT><B>Note</B>
<DD>Each item in a drag can contain multiple "flavors," or representations, of the item. The drop target doesn't need to accept all flavors offered by each item, but it must accept each of the items in some supplied flavor.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING77-11></A>
<H2><A NAME=MARKER-9-108></A>TDragItem</H2>
 A view object uses objects of type <CODE><A NAME=MARKER-2-109></A>TDragItem</CODE> to supply data to be dragged. The data can be supplied in multiple representations, or flavors. For example, if a user clicks and drags a picture, the application might supply a single drag item object with flavors of PICT, GIF, JPEG, QuickTime, and any other graphic format it knows how to provide. This enables the drop target to request the item in whatever format it understands best.<P>
 The <CODE>TDragItem</CODE> class simplifies the multiflavor nature of drag items by implementing the concept of <I>focus</I>. A <CODE>TDragItem</CODE> object is always "focused" on a specific flavor. <CODE>TDragItem</CODE> methods for reading and writing data work on whatever flavor is currently focused. Adding a new flavor to a <CODE>TDragItem</CODE> object has the effect of focusing on the new flavor. An application focuses on a specific flavor by calling the <CODE><A NAME=MARKER-2-84></A>FocusOnFlavor</CODE> method.<P>
<A NAME=HEADING77-14></A>
<H2><A NAME=MARKER-2-111></A><A NAME=MARKER-9-112></A>Promising Data</H2>
 Instead of providing a drag item with actual data, a view can promise to supply data later, using the <CODE>TDragItem::<A NAME=MARKER-2-53></A>PromiseFlavor</CODE> method. Promising data requires little overhead and, except for very small data items, is more efficient than supplying all possible flavors up front--consider the memory requirements of supplying data in multiple large graphic formats, which may never even be used!<P>
<A NAME=HEADING77-16></A>
<H2>Fulfilling Promises</H2>
 When a drop target requests data that has been promised, the drag session's <CODE><A NAME=MARKER-2-54></A>DragSendDataProc</CODE> method calls the <CODE><A NAME=MARKER-2-26></A>DoFulfillPromise</CODE> method of the drag source (normally a view object), passing a pointer to a <CODE>TDragItem</CODE> object that is focused on the requested flavor.<P>
 The view object can get information about the drag item by calling the <CODE><A NAME=MARKER-2-57></A>GetFlavorType</CODE> and <CODE><A NAME=MARKER-2-117></A>GetItemReference</CODE> methods. The view provides the requested flavor data by calling one or more of the following <CODE>TDragItem</CODE> methods that write data to the focused flavor of the drag item:<P>
<UL>
<LI><B><A NAME=MARKER-2-118></A>SetData.</B> The <CODE>SetData</CODE> method sets the flavor data by copying the specified count of bytes from the specified buffer.
<LI><B><A NAME=MARKER-2-29></A>SetDataFromHandle.</B> The <CODE>SetDataFromHandle</CODE> method is similar to <CODE>SetData</CODE>, but it sets the flavor data from the specified handle.
<LI><B><A NAME=MARKER-2-31></A>GetDataStream.</B> The <CODE>GetDataStream</CODE> method returns a <CODE><A NAME=MARKER-2-37></A>TDragFlavorStream</CODE> object, which is a descendant of <CODE>TStream</CODE>. A view object can supply flavor data by writing to the stream with standard <CODE>TStream</CODE> methods.<P>
</UL>
<DL>
<DT><B>Note</B>
<DD>If a view requests a <CODE>TDragFlavorStream</CODE>, the view should free the requested stream before returning from <CODE>DoFulfillPromise</CODE>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING77-23></A>
<H2><A NAME=MARKER-9-122></A><A NAME=MARKER-2-123></A>Drag Copy Versus Drag Move</H2>
 A user-initiated drag operation can have the effect of either copying or moving the dragged data. The drag-and-drop human interface guidelines specify that data dragged within a single container should be moved. Data dragged between containers should be copied. However, the definition of <I>container</I> depends on the specific application, and the definition of <I>within</I> may vary depending on the user. To avoid confusion, the drag session object evaluates each drag individually and applies criteria established by the views involved to determine whether data should be copied or moved. Specifically, the <CODE>DragReceiveHandler</CODE> method of the drag session object calls the <CODE>WillDragMove</CODE> method of the source view.<P>
<A NAME=HEADING77-25></A>
<H3>Move Families</H3>
 The <CODE>WillDragMove</CODE> method compares the values of the <A NAME=MARKER-2-38></A><CODE>fDragMoveFamily</CODE> fields of the source and target views to determine whether the drag qualifies as a move. Views that will support a drag move should set the <CODE>fDragMoveFamily</CODE> field to the same arbitrary value. It's OK if that value is the default, <CODE>kNoIdentifier</CODE>.<P>
 If, for example, a window contains a number of text views but a move should be generated only when dragging between two specific text views, those two views can assign the same value to <CODE>fDragMoveFamily</CODE>. Consequently, dragging between those two views will generate a move. Dragging between any other text view and one of the two views in the hypothetical family will cause the data to be copied. <P>
<A NAME=HEADING77-28></A>
<H3>Move Relationships</H3>
 The source view of a drag uses its <CODE><A NAME=MARKER-2-126></A>fDragMoveDeterminer</CODE> field to specify a relationship with the target destination that must be met if data is to be moved. MacApp supplies the following values for the <CODE>fDragMoveDeterminer</CODE> field: <CODE><A NAME=MARKER-2-127></A>kNeverMove</CODE>, <CODE><A NAME=MARKER-2-64></A>kMoveWithinWindow</CODE>, <CODE><A NAME=MARKER-2-65></A>kMoveWithinContext</CODE>, <CODE><A NAME=MARKER-2-130></A>kMoveWithinView</CODE>, and <CODE><A NAME=MARKER-2-131></A>kMoveWithinApplication</CODE>. <P>
 If the <CODE>fDragMoveFamily</CODE> field values of the source and destination views match, the <CODE>WillDragMove</CODE> method looks at the value of the <CODE>fDragMoveDeterminer</CODE> field of the source view to determine whether the operation should be treated as a copy or a move. If the views are related in the manner described by the source view's <CODE>fDragMoveDeterminer</CODE> field, a move is generated. For example, if the source and target of a drag are views within the same window and the <CODE>fDragMoveDeterminer</CODE> field of the source view is <CODE>kMoveWithinWindow</CODE>, <CODE>kMoveWithinContext</CODE>, or <CODE>kMoveWithinApplication</CODE>, the drag will qualify as a move. <P>
<A NAME=HEADING77-31></A>
<H3>Forcing a Copy</H3>
 MacApp implements a mechanism to circumvent the standard conventions and force a copy. To do so, a user presses the Option key before dropping the data and keeps it down while the data is dropped. The Option keypress is handled in the <CODE>TDragDropSession::DragReceiveHandler</CODE> method.<P>
<A NAME=HEADING77-33></A>
<H3>Summary</H3>
 For MacApp to initiate a drag move operation, the source and destination views must have matching values in their <CODE>fDragMoveFamily</CODE> fields and the views must have the type of relationship specified by the source view's <CODE>fDragMoveDeterminer</CODE> field.<A NAME=MARKER-2-51></A><A NAME=MARKER-2-133></A><P>
<DL>
<DT><B>Note</B>
<DD>It's still a match if both views have their <CODE>fDragMoveFamily<A NAME=MARKER-2-46></A></CODE> fields set to <CODE><A NAME=MARKER-2-135></A>kNoIdentifier</CODE>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-76.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-78.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
