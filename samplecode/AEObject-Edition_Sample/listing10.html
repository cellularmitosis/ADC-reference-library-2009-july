<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>AEObject-Edition Sample - /main.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; <A HREF="javascript:location.replace('index.html');">AEObject-Edition Sample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxInterapplicationCommunication-date.html" target="_blank">Carbon > Interapplication Communication</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">AEObject-Edition Sample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/main.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/AEObject-Edition Sample.r</option>
<option value="listing2.html">/AEObject.c</option>
<option value="listing3.html">/AEUtilities.c</option>
<option value="listing4.html">/AppleEventCore.c</option>
<option value="listing5.html">/BuildHeaders.c</option>
<option value="listing6.html">/Files.c</option>
<option value="listing7.html">/globals.c</option>
<option value="listing8.html">/Initialize.c</option>
<option value="listing9.html">/Macros.h</option>
<option value="listing10.html">/main.c</option>
<option value="listing11.html">/Menu.c</option>
<option value="listing12.html">/Print.c</option>
<option value="listing13.html">/prototypes.h</option>
<option value="listing14.html">/Publish.c</option>
<option value="listing15.html">/SampConstants.h</option>
<option value="listing16.html">/Sampdefines.h</option>
<option value="listing17.html">/Structs.h</option>
<option value="listing18.html">/Subscribe.c</option>
<option value="listing19.html">/TextSections.c</option>
<option value="listing20.html">/Utilities.c</option>
<option value="listing21.html">/Windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="AEObject-Edition_Sample.zip">Download Sample</a></strong> (&#147;AEObject-Edition_Sample.zip&#148;, 895.6K)<BR>
<strong><a href="AEObject-Edition_Sample.dmg">Download Sample</a></strong> (&#147;AEObject-Edition_Sample.dmg&#148;, 1.22M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*------------------------------------------------------------------------------##   Apple Developer Technical Support##   AppleEvents &amp; Edition Manager Sample Application##   AEObject-Edition Sample##   main.c  -   C Source##   Copyright &copy; 1990-1992 Apple Computer, Inc.#   All rights reserved.##   Versions:   #        1.0.1        2/92     C.K. Haun &lt;TR&gt;#               1.0                11/91       C.K. Haun &lt;TR&gt;#         based on the EditionSample#   Components:#                           main.c#                           Menu.c#                           Files.c#                           Publish.c#                           Subscribe.c#                           TextSections.c#                           Windows.c#                           AppleEventCore.c#                           AEObject-Edition Sample.make                          #                           BuildHeaders.c#              AEUtilities.c#              AEObjects.c#              Utilities.c#              Initialize.c#              globals.c#              Print.c#              prototypes.h#              SampConstants.h#              Structs.h#              Macros.h#                           Sampdefines.h##  #  This sample demonstrates the Apple Event Object model and#  the Edition Manager.#  It is an expanded version of the the earlier EditionSample,#  most of the changes (besides bug fixes) have been made in the #  files AppleEventCore.c,AEUtilities.c and AEObjects.c.#  I decided to add the Object Model demonstration to the Edition Sample#  to use the objects (windows, shapes) that already existed #  instead of developing a new sample.#  I beleive that the fuctional areas are discreet enough that #  you can find what you are looking for without too much difficulty,#  the file names really do reflect the major contents of a#  specific source file.  #  #   This sample contains most of the Edition Manager calls that#   you'll need in your application.  It also contains one method#   for keeping track of the edition data for all your documents.#   It does NOT by any means demonstrate all the techniques #   you need for a large application, nor the best data handling #   methods for all cases.  #  #  This sample also implements some Apple Event Object model objects,#  specifically cWindow, cText,cWord,cGraphicLine,cRectangle and cOval.##   Use this sample as a starting point, and adapt its' routines to #   meet the specific needs of your project.  #   This sample will grow as more edition types are implemented,#   periodically check AppleLink for a later, expanded sample.#   This application is an example of the form of a Macintosh #   application; it is NOT a template. It is NOT intended to be #   used as a foundation for the next world-class, best-selling, #   600K application. A stick figure drawing of the human body may #   be a good example of the form for a painting, but that does not #   mean it should be used as the basis for the next Mona Lisa.#  This sample's focus is the Edition Manager and AppleEvents, NOT#  drawing or text editing, so those areas are implemented in#  a very minimal fashion.  This is done to prevent obscuring the#  goal of this sample.  If you are interested in those (or other)#  areas, please look for a sample that focuses on them.##------------------------------------------------------------------------------*/#define __SAMPMAIN__#pragma segment Main#include &quot;Sampdefines.h&quot;#include &lt;SegLoad.h&gt;extern void _DataInit();main(){    WindowPtr twindow;    Boolean x;    Boolean menuAction;    windowCHandle tempWCH;           PScrapStuff theScrap;    short myScrapCount = -999;                               /* intialize to a silly value */    UnloadSeg((Ptr)_DataInit);                              /* throw the bums out */    StartStuff();                                           /* initialize managers and normal startup actions */    UnloadSeg((Ptr)StartStuff);    theScrap = InfoScrap();    FlushEvents(everyEvent, 0);    mousergn = NewRgn();    gStop = false;    while (!gStop){      x = WaitNextEvent(everyEvent, &amp;gERecord, gMySleep,mousergn);        theScrap = InfoScrap();        if (theScrap-&gt;scrapCount != myScrapCount) {            myScrapCount = theScrap-&gt;scrapCount;            UpdateScrap(true);        }        if (FrontWindow() != nil) {    /* if there is a text box, idle the cursor */            TEHandle tempTE;            windowCHandle tempWCH = (windowCHandle)GetWRefCon(FrontWindow());            tempTE = (*tempWCH)-&gt;boxHandle;            if (tempTE != nil)                TEIdle(tempTE);                }        switch (gERecord.what) {short fHit;            case nullEvent:      /* marching ants as necessary */             DoAnts(nil);            break;            case updateEvt:                DrawIt((WindowPtr)gERecord.message);                                   /* draw whatever window needs an update */                break;            case mouseDown:                /* first see where the hit was */        fHit = FindWindow(gERecord.where, &amp;twindow);                switch (fHit) {Rect limitRect;                long back;                Str255 tempString;                    case inDesk:                            /* if they hit in desk, then the process manager */                        break;                              /* will switch us out, we don't need to do anything */                    case inMenuBar:                        /* If they clicked in the menu bar, we need to set up the Undo */                        /* text string for the current window, and the toggle of */                        /* Publisher or Subscriber options before we drop the */                        /* menu down. */                        /* Also change the Save string depending on the save state */                        /* Pull our aux data structure out of the current window */                        if (FrontWindow()) {                            tempWCH = (windowCHandle)GetWRefCon(FrontWindow());                            HLock((Handle)tempWCH);          /* lock it */                            AdjustMenus(tempWCH,FrontWindow());            /* in menu.c */                            HUnlock((Handle)tempWCH);                        } else {                            AdjustMenus(nil,nil);                        }                        /* Now we drop the menu down, and pass the results */                        /* to our menu handler (in Menu.c) */                        menuAction = DoSelected(MenuSelect(gERecord.where));                        break;                    case inSysWindow:                        /* pass to the system */                        SystemClick(&amp;gERecord, twindow);                        break;                    case inContent:                        /* Our major workarea.  Depending on other factors, a */                        /* user could be drawing, moving a subscriber, selecting */                        /* a publisher or subscriber, selecting an area, or nothing. */                        /* First, if they did not click in the front window, we need */                        /* to bring the window they did click in to the front, and */                        /* pull the information we need (cursor mode, undo action, etc. ) */                        /* out of the aux record and update things */                        if (twindow != FrontWindow()) {                            ChangePlane(twindow);                        } else {                            if (FrontWindow()) {           /* don't do this unless we have a window open, silly */                                windowCHandle clicker;                                clicker = (windowCHandle)GetWRefCon(twindow);                                /* jump to the content function stored for this window */                                HLock((Handle)clicker);     /* lock it down so things don't get stupid */                                (ProcPtr)((*clicker)-&gt;clickMe)(twindow);                                HUnlock((Handle)clicker);       /* all done */                            }                        }                        break;                    case inDrag:                        DragWindow(twindow, gERecord.where, &amp;qd.screenBits.bounds);                        break;          case inGrow:           SetPort(twindow);                        limitRect = qd.screenBits.bounds;                        limitRect.top = kMinHeight;            GetWTitle(twindow, tempString);            /* I'm not letting the user shrink the window so */            /* small that the title is truncated */                        limitRect.left = StringWidth(tempString) + 120;                        back = GrowWindow(twindow,gERecord.where, &amp;limitRect);                        if (back) {windowCHandle tempWCH = (windowCHandle)GetWRefCon(twindow);                            Rect sizeRect = ((WindowPtr)twindow)-&gt;portRect;                                                        sizeRect.top = sizeRect.bottom - 16;                            sizeRect.left = sizeRect.right - 16;                            EraseRect(&amp;sizeRect);                            InvalRect(&amp;sizeRect);                                                        SizeWindow(twindow, back &amp; 0xffff, back &gt;&gt; 16, true);              (ProcPtr)((*tempWCH)-&gt;sizeMe)(twindow);                                      }                                               InvalRect(&amp;twindow-&gt;portRect);                        break;                     case inGoAway:                        /* Track a click in the go away box.  If the user stays in it, */                        /* call the close proc for this window */                        if (TrackGoAway(twindow, gERecord.where))                            (ProcPtr)((*(windowCHandle)((WindowPeek)twindow)-&gt;refCon)-&gt;closeMe)(twindow);                        break;          case inZoomIn:          case inZoomOut:          if (TrackBox(twindow, gERecord.where, fHit)) {windowCHandle tempWCH = (windowCHandle)GetWRefCon(twindow);                            SetPort(twindow);                                                        ZoomWindow(twindow, fHit, true);                            InvalRect(&amp;twindow-&gt;portRect);                                    (ProcPtr)((*tempWCH)-&gt;sizeMe)(twindow);            }          break;                                                }            case mouseUp:                /* don't care */                break;                /* same action for key or auto key */            case keyDown:            case autoKey:                /* Do menu commands.  */                /* Also check the window record for a TextEdit field, if there */                /* is one pass the key to it */                if (gERecord.modifiers &amp; cmdKey) {                    if (FrontWindow()) {                        tempWCH = (windowCHandle)GetWRefCon(FrontWindow());                        HLock((Handle)tempWCH);              /* lock it */                        AdjustMenus(tempWCH,FrontWindow());                /* in menu.c */                        HUnlock((Handle)tempWCH);                    } else {                        AdjustMenus(nil,nil);                    }                    menuAction = DoSelected(MenuKey(gERecord.message &amp; charCodeMask));                } else {                    WindowPtr tempWP = FrontWindow();                    tempWCH = (windowCHandle)GetWRefCon(tempWP);                    if (((WindowPeek)tempWP)-&gt;windowKind == kDocumentWindow &amp;&amp; ((*tempWCH)-&gt;boxHandle != nil)) {                                  Boolean wasPC = false;                        tempWCH = (windowCHandle)GetWRefCon(tempWP);                                    if ((*tempWCH)-&gt;textSections != nil) {                            /* this text box has sections, and the sections may need to be */                            /* adjusted by this keystroke.  First, see if it's a pure cursor move, */                            if (wasPC= PureCursor(gERecord.message &amp; charCodeMask))                                wasPC = SkipOverSubscriber(tempWCH, gERecord.message &amp; charCodeMask);                            else                                CheckTextSections(tempWCH, kKeyStroke);                        }                        if (!wasPC) {                            /* ExcludeSubscriber shortens the current selection if it impact on any */                            /* subscribers */              ExcludeSubscriber(tempWCH);                            TEKey(gERecord.message &amp; charCodeMask, (*tempWCH)-&gt;boxHandle);              KillSelection(tempWCH);            }                             }          if(((WindowPeek)tempWP)-&gt;windowKind == kAEStatusWindow)AESKey(gERecord.message &amp; charCodeMask,tempWCH);                }                break;            case keyUp:                /* don't care */                break;            case diskEvt:                /* I don't do anything special for disk events, this just passes them */                /* to a function that checks for an error on the mount */                DoDiskEvents(gERecord.message);                break;            case activateEvt:                /* Draws on a window activate.  Other activate/deactivate stuff is */                /* handled in either the ChangePlane function (for normal shuffling ) */                /* or in the suspend/resume handler for layer swaps */                if (gERecord.modifiers &amp; activeFlag){                   ChangePlane((WindowPtr)gERecord.message);          DrawIt((WindowPtr)gERecord.message);          } else {           windowCHandle tempWCH = (windowCHandle)GetWRefCon((WindowPtr)gERecord.message);                                if ((*tempWCH)-&gt;boxHandle != nil)                                    TEDeactivate((*tempWCH)-&gt;boxHandle);          }                break;            case networkEvt:                /* don't care */                break;            case driverEvt:                /* don't care */                break;            case app4Evt:                switch ((gERecord.message &gt;&gt; 24) &amp; 0x0FF) {     /* high byte of message */                    case suspendResumeMessage:              /* suspend/resume is also an activate/deactivate */                        gInBackground = (gERecord.message &amp; kResumeMask) == 0;                        if (gInBackground) {                            SpitClip();    /* export the clipboard please */              /* If the clipboard is showing, hide it, since a clipboard */              /* is not valid when you are in another layer */                            if(((WindowPeek)FindClipWindow())-&gt;visible == true)CloseClip(FindClipWindow());              /* deactivate the current TextEdit record as necessary */                            if (FrontWindow() != nil) {                                windowCHandle tempWCH = (windowCHandle)GetWRefCon(FrontWindow());                                if ((*tempWCH)-&gt;boxHandle != nil)                                    TEDeactivate((*tempWCH)-&gt;boxHandle);              /* set sleep value very high, since I'm doing no nul processing */                  gMySleep = -1;                            }                            if (gShowSub || gShowPub) {                            /* I forget what this is here for.  Oh well */                                }                        } else {            gMySleep = 5;  /* wake up more */                            if (FrontWindow() != nil) {                                windowCHandle tempWCH = (windowCHandle)GetWRefCon(FrontWindow());                                if ((*tempWCH)-&gt;boxHandle != nil)                                    TEActivate((*tempWCH)-&gt;boxHandle);                            }                        }                        break;          case mouseMovedMessage:          AdjustCursor(gERecord.where, mousergn);          break;                }                break;                /* This dispatches high level events (AppleEvents, for example) */                /* to our dispatch routine.  This is NEW in the event loop for */                /* System 7 */            case kHighLevelEvent:                DoHighLevel(gERecord);                break;            default:                break;                        }        }  /* save current prferences on exit */  SavePrefs();  }/* DrawIt calls the drawing routine for the window that requires a refresh,* either for a update or activate */void DrawIt(WindowPtr theWindow){    WindowPtr  tempwind;    windowCHandle tempWCH;    GetPort(&amp;tempwind);                                     /* save the current port */                                                                                             BeginUpdate(theWindow);                                   /* tell window manager to do it's thing */    SetPort(theWindow);    EraseRgn(theWindow-&gt;visRgn);                              /* erase whatever needs updating, remember that                                                            BeginUpdate copies the update region into the visRgn */    /* pull our control structure out of the refCon */    tempWCH = (windowCHandle)GetWRefCon(theWindow);    HLock((Handle)tempWCH);                                 /* lock it down so things don't get stupid */    /* jump to the drawing function stored for this window */    (ProcPtr)((*tempWCH)-&gt;drawMe)(tempWCH, theWindow);    HUnlock((Handle)tempWCH);                               /* all done */    EndUpdate(theWindow);                                     /* all done */    SetPort(tempwind);                                      /* reset the port to the entry port */}/* DrawIt */void DeBorderSelection(void){    if (gShowPub) {        gShowPub = false;        gShowingSecHandle = nil;    InsetRect(&amp;gShowPubRect, kNegFour, kNegFour);        InvalRect(&amp;gShowPubRect);    InsetRect(&amp;gShowPubRect, kFour, kFour);    } else {        if (gShowSub) {            gShowSub = false;            gShowingSecHandle = nil;      InsetRect(&amp;gShowSubRect, kNegFour, kNegFour);            InvalRect(&amp;gShowSubRect);      InsetRect(&amp;gShowSubRect, kFour, kFour);        }    }}/* Just in case I need a nothing proc, here's one.  In Main so I'm not dragging in other segments */void NilProc(void){}#undef __SAMPMAIN__</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/AEObject-Edition_Sample/listing10.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/AEObject-Edition_Sample/listing10.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/AEObject-Edition_Sample/listing10.html%3Fid%3DDTS10000204-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>