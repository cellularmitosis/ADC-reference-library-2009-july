<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Compressing and Expanding Sounds (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.27.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.a.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.29.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=2941"> </A><A NAME="37653"> </A>Compressing and Expanding Sounds<A NAME="marker=331"> </A></H1><P CLASS="T0.Text0"><A NAME="pgfId=2942"> </A>Some of the capabilities provided by MACE are transparently available to your application. For example, if you pass the <TT CLASS="cv">SndPlay</TT> function a handle to an <TT CLASS="cv">'snd&nbsp;'</TT> resource that contains a compressed sampled sound, the Sound Manager automatically expands the sound data for playback in real time. Your application does not need to know whether the <TT CLASS="cv">'snd&nbsp;'</TT> resource contains compressed or noncompressed samples when it calls <TT CLASS="cv">SndPlay</TT>. This is because sufficient information is in the resource itself to allow the Sound Manager to determine whether it should expand the data samples.<A NAME="marker=332"> </A><A NAME="marker=739"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=2943"> </A>However, aside from expansion playback, all of the MACE capabilities need to be specifically requested by your application. For example, you can use the procedure <TT CLASS="cv">Comp3to1</TT> or <TT CLASS="cv">Comp6to1</TT> if you want to compress a sampled sound (for example, to create an <TT CLASS="cv">'snd&nbsp;'</TT> resource containing compressed audio data). You can use the procedures <TT CLASS="cv">Exp1to3</TT> and <TT CLASS="cv">Exp1to6</TT> to expand compressed audio data.<A NAME="marker=740"> </A><A NAME="marker=741"> </A><A NAME="marker=742"> </A><A NAME="marker=743"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=2944"> </A><A NAME="marker=744"> </A>All of these procedures require you to specify both an input and an output buffer, from&nbsp;and to which the sampled-sound data to be converted is read and written. Your application must allocate the appropriate amount of storage for each buffer. For example, if you want to expand a buffer of compressed monophonic sampled-sound data by using <TT CLASS="cv">Exp1to6</TT>, the output buffer must be at least six times the size of the input&nbsp;buffer.</P><P CLASS="T1.Text1"><A NAME="pgfId=3465"> </A>The MACE compression and expansion routines can work on only one channel of sound. The <TT CLASS="cv">numChannels</TT> parameter of all four procedures allows you to specify how many channels are in the original sample, and the <TT CLASS="cv">whichChannel</TT> parameter allows you to specify which channel you wish to compress or expand. Because the MACE routines can compress or expand only one channel of sound, you must make adjustments when allocating an output buffer for stereo sound. For example, if you are compressing two-channel sound using the <TT CLASS="cv">Comp3to1</TT> procedure, your output buffer need only be one-sixth the size of your input buffer.</P><P CLASS="T1.Text1"><A NAME="pgfId=2945"> </A>Often when compressing polyphonic sound, being able to compress only one channel is not a problem, because you lose sound quality during compression anyway. However, you might at times wish to maintain more than one channel of a multichannel sound even after compression and expansion. For example, two channels of a stereo sound might be quite different and might both be necessary to achieve a full sound after expansion. In these cases, you can compress each channel of a multichannel sound individually and then manually interleave the samples on a packet basis. When you expand polyphonic compressed sound data, you must interleave the channels of sound on a sample frame basis.<A NAME="marker=745"> </A> <A NAME="marker=1460"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=3452"> </A>The MACE routines work only with sampled-sound data in offset binary format. If you are compressing data in a sound file, you must convert that data from linear, two's complement format to binary offset format before compression.</P><P CLASS="T1.Text1"><A NAME="pgfId=2521"> </A>When calling the MACE routines, you can also specify addresses of two small buffers (128 bytes each) that the Sound Manager uses to maintain state information about the compression or expansion process. When you first call a MACE routine, the state buffers should be filled with zeros to initialize the state information. When you subsequently call another MACE routine, you can use the same state buffers. You can pass <TT CLASS="cv">NIL</TT> for both buffers if you do not want to save state information across calls to the MACE routines. <A target="doc" HREF="imsoundmgr.28.htm#18927" CLASS="XRef">Listing 1-43</A> illustrates the use of the <TT CLASS="cv">Comp3to1</TT> procedure when using state&nbsp;buffers.<A NAME="marker=1459"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=2947"> </A>Listing&nbsp;43 <A NAME="18927"> </A>Compressing audio data</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=9985"> </A>PROCEDURE MyCompressBy3 (inBuf: Ptr; outBuf: Ptr; numSamp: LongInt);<BR>CONST <BR>&nbsp;&nbsp;&nbsp;&nbsp;kStateBufferSize = 128;<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;myInState:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ptr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{input state buffer}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myOutState:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ptr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{output state buffer}<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;myInState := NewPtrClear(kStateBufferSize);<BR>&nbsp;&nbsp;&nbsp;&nbsp;myOutState := NewPtrClear(kStateBufferSize);<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF (myInState &lt;&gt; NIL) AND (myOutState &lt;&gt; NIL) THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comp3to1(inBuf, outBuf, numSamp, myInState, myOutState, 1, 1);<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=2434"> </A><A NAME="marker=9987"> </A>Because the last two parameters (<TT CLASS="cv">numChannels</TT> and <TT CLASS="cv">whichChannel</TT>) are both set to 1, <TT CLASS="cv">MyCompressBy3</TT> compresses monophonic audio data.</P><P CLASS="T1.Text1"><A NAME="pgfId=2423"> </A>In practice, compressing a sound resource or sound file is considerably more complex than calling the <TT CLASS="cv">MyCompressBy3</TT> procedure defined in <A target="doc" HREF="imsoundmgr.28.htm#18927" CLASS="XRef">Listing 1-43</A>. To compress a sound resource containing monophonic sampled-sound data, you would need to</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=2452"> </A>load the data into a handle and lock the handle</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2438"> </A>ensure that the data in the handle is not already compressed by examining the sound header</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2435"> </A>find a pointer to the sampled-sound data by examining the <TT CLASS="cv">samplePtr</TT> field of the sound header</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2437"> </A>allocate an output buffer of the appropriate size, taking into account that only one channel of the original data can be compressed</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2439"> </A>compress the sampled-sound data by calling the <TT CLASS="cv">Comp3To1</TT> procedure</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2440"> </A>determine the size that the header information (including, for example, sound commands and the sampled sound header excluding the sampled-sound data itself) will take in the resource by using the Sound Input Manager's <TT CLASS="cv">SetupSndHeader</TT> function to create a sound resource header and sampled sound header with the same&nbsp;sample rate, base frequency, and other characteristics as the original sampled-sound data</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2441"> </A>resize the handle so that it is large enough to contain both the non-sampled-sound data information and the compressed sound data</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2450"> </A>fill this handle by first calling <TT CLASS="cv">SetupSndHeader</TT> once again and by then copying the compressed sound data to the end of the header information</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=2451"> </A>update the resource file</LI></UL><P CLASS="T1.Text1"><A NAME="pgfId=2436"> </A>Techniques for compressing sound files and for expanding both sound resources and sound files are analogous to that sketched here. Remember that after compressing or expanding each channel of polyphonic sampled-sound data, you must interleave frames of sound data, on a packet basis after compression or on a sample basis after expansion.<A NAME="marker=751"> </A></P><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.27.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.a.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.29.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>