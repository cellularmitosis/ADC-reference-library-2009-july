<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> ATA_MgrInquiry</TITLE></HEAD><BODY BGCOLOR="#ffffff"><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><table border="0" cellpadding="0" cellspacing="2" width="432">		<tr>	<td scope="row"><font face="Geneva,Helvetica,Arial" size="1">	<b>PATH<img src="../../../images/space.gif" width="6" height="12"></b>	<a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a --> 	<b>&gt;</b> <a href="../../devicemgrs.html">Device Managers and Drivers</a>	<b>&gt;</b> <a href="../ata.html" target="_top">ATA Devices</a>	<b>&gt;</b> ATA Device Software Guide		</font></td>	</tr>	</table><br><!-- end of path --><DIV><!-- top navigation --><P><A HREF="ATA.2a.html"><img src="images/up.gif" border="0"></A> <A HREF="ATA.2b.html"><img src="images/previous.gif" border="0"></A> <A HREF="ATA.2d.html"><img src="images/next.gif" border="0"></A> <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></a></div><!-- end top navigation --><hr><H3 CLASS="RoH.RoutineHeading"><A NAME="pgfId=746"> </A><A NAME="15537"> </A>ATA_MgrInquiry</H3><P CLASS="T0.Text0"><A NAME="pgfId=747"> </A>The <TT CLASS="cv">ATA_MgrInquiry</TT> function gets information, such as the version number, about the ATA Manager. <A NAME="marker=748"> </A><A NAME="marker=749"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=750"> </A>The <TT CLASS="cv">ataPIOMaxMode</TT>, <TT CLASS="cv">ataSingleDMAModes</TT>, and <TT CLASS="cv">ataMultiDMAModes</TT> fields of the <TT CLASS="cv">ATA_MgrInquiry</TT> function are obsolete in ATA Manager version 4.0 and later. The services provided in these fields have been moved to the <TT CLASS="cv"><A HREF="ATA.2d.html#18362" CLASS="XRef">ATA_BusInquiry</A></TT> function. This change aligns better with the services required to support different modes (polled I/O or DMA) on multiple ATA buses, which ATA Manager 4.0 and later provide. An example of a Macintosh computer that has multiple ATA buses requiring different mode support is the PowerBook 3400. It supports PCMCIA ATA devices requiring PIO data transfer on one ATA bus and an internal ATA drive that supports DMA transfers on the other ATA bus. </P><P CLASS="T1.Text1"><A NAME="pgfId=3071"> </A>The manager function code for the <TT CLASS="cv">ATA_MgrInquiry</TT> function is $90. </P><P CLASS="T1.Text1"><A NAME="pgfId=751"> </A>The parameter block associated with this function is defined below:</P><table><tr><td colspan=2 scope="row"><tt>typedef</tt></td><td><tt>struct</tt></td><td><tt>/* ATA inquiry structure */</tt></td></tr><tr><td colspan=4 scope="row">{</td></tr><tr><td valign="top" scope="row"></td><td valign="top"><tt>ataPBHdr</tt></td><td>&nbsp;</td><td valign="top"><tt>/* ataPBHdr parameter block */</tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>NumVersion</tt></td><td width=100 valign="top"><tt>MgrVersion</tt></td><td width=200 valign="top"><tt>/* Version of ATA Manager */</tt></td></tr><tr><td valign="top" scope="row"></td><td valign="top"><tt>UInt8</tt></td><td valign="top"><tt>MGRPBVers;</tt></td><td valign="top"><tt>/* &lt;-- Manager PB version */<BR>/*number supported */<BR></tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt8</tt></td><td width=100 valign="top"><tt>Reserved1;</tt></td><td width=200 valign="top"><tt>/* Reserved */</tt></td></tr><tr><td valign="top" scope="row"></td><td valign="top"><tt>UInt16</tt></td><td valign="top"><tt>ataBusCnt;</tt></td><td valign="top"><tt>/* &lt;-- Number of ATA buses in */<br>/*system */<BR></tt></td></tr><tr><td valign="top" scope="row"></td><td valign="top"><tt>UInt16</tt></td><td valign="top"><tt>ataDevCnt;</tt></td><td valign="top"><tt>/* &lt;-- Number of ATA devices <BR>detected */<br></tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt8</tt></td><td width=100 valign="top"><tt>ataPIOMaxMode;</tt></td><td width=200 valign="top"><tt>/* &lt;-- Maximum PIO speed mode */</tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt8</tt></td><td width=100 valign="top"><tt>Reserved2;</tt></td><td width=200 valign="top"><tt>/* Reserved */</tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt16</tt></td><td width=100 valign="top"><tt>Reserved3;</tt></td><td width=200 valign="top"><tt>/* Reserved */</tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt8</tt></td><td width=100 valign="top"><tt>ataSingleDMAModes;</tt></td><td width=200 valign="top"><tt>/* &lt;-- Singleword DMA modes */<BR>/*supported */<BR></tt></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt8</tt></td><td width=100 valign="top"><tt>ataMultiDMAModes;</tt></td><td width=200 valign="top"><tt>/* &lt;-- Multiword DMA modes */</tt><BR>/*supported */<BR></td></tr><tr><td width=20 valign="top" scope="row"></td><td width=75 valign="top"><tt>UInt16</tt></td><td width=100 valign="top"><tt>Reserved[16];</tt></td><td width=200 valign="top"><tt>/* Reserved */</tt></td></tr><tr><td colspan=4 scope="row"><tt>} ataMgrInquiry;</tt></td></tr></table><h4>Field descriptions</h4><dl compact><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=13956"> </A><TT CLASS="cv">ataPBHdr</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=777"></A>See the definition of the <A HREF="ATA.26.html#20961" CLASS="XRef"><TT>ataPBHdr</TT>parameter block</A>.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=13965"> </A><TT CLASS="cv">MgrVersion</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=778"> </A>On return, this field contains the version number of the  ATA Manager present in the system. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=13977"> </A><TT CLASS="cv">MGRPBVers</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=779"> </A>This field contains the number corresponding to the latest version of the parameter block supported by the current ATA Manager. A client may use any <TT CLASS="cv">ataPBHdr</TT> parameter block definition up to this version. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=13986"> </A><TT CLASS="cv">Reserved</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=780"> </A>Reserved. All reserved fields are set to 0 for future compatibility. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=13995"> </A><TT CLASS="cv">ataBusCnt</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=781"> </A>On return, this field contains the total number of ATA buses in the system. This field contains a zero if the ATA Manager has not been initialized. Not all ATA buses reported may be active.  However clients should allocate adequate data storage to handle up to the reported number of busses/channels.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14004"> </A><TT CLASS="cv">ataDevCnt</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=782"> </A>On return, this field contains the total number of ATA devices detected on all ATA buses. The current architecture allows only one device per bus. This field contains a zero if the ATA Manager has not been initialized. With media bay and PCMCIA sockets, the value reported may change depending on the configuration at the time.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14013"> </A><TT CLASS="cv">ataPIOMaxMode</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=783"> </A>This field specifies the maximum PIO speed mode that the ATA Manager supports. Refer to the ATA-2 specification for information on mode timing. For additional information about the individual bus capabilities, see the description of the <TT CLASS="cv"><A HREF="ATA.2d.html#18362" CLASS="XRef">ATA_BusInquiry</A></TT> function.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14022"> </A><TT CLASS="cv">ataSingleDMAModes</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=784"> </A> This bit-significant field specifies the maximum DMA mode that the ATA Manager can support. The least-significant bit indicates support for Single Word DMA transfer mode 0. Refer to the ATA-2 specification for information on DMA mode timing. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14032"> </A><TT CLASS="cv">ataMultiDMAModes</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=785"> </A> This bit-significant field specifies the Multiword DMA transfer modes that the manager can support. The least-significant bit indicates support for Multiword DMA transfer mode 0. Refer to ATA-2 specification for information on DMA mode timing. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14042"> </A><TT CLASS="cv">Reserved[16]</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=786"> </A>This field is reserved. To ensure future compatibility, all reserved fields should be set to 0.</DD></DL COMPACT><P CLASS="T1.Text1"><A NAME="pgfId=3090"> </A>Some early Macintosh computer ROMs indicate that the ATA Manager is present without actually having the proper hardware to support ATA devices. When this happens it is possible to halt the system. It is always best to inquire as to whether the computer has ATA hardware before detecting the presence of the ATA Manager. The following prototype code shows how to detect the ATA Manager properly.</P><CODE CLASS="Cv.Code"><A NAME="pgfId=14053"> </A>Boolean ATAManagerPresent(void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;UInt16 configFlags;<BR>&nbsp;&nbsp;&nbsp;&nbsp;Boolean ATAIsHere = true;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;configFlags = LMGetHWCfgFlags();<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;if (!(configFlags &amp; 0x0080))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATAIsHere = false;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* see Inside Macintosh Volume VI chapter 3 for */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* defintion of TrapAvailable */<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (ATAIsHere &amp;&amp; TrapAvailable(kATATrap))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ATAIsHere = true;<BR>&nbsp;&nbsp;&nbsp;&nbsp;return ATAIsHere;<BR>}</CODE><DIV><H5 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=787"> </A>RESULT CODES</H5><P CLASS="T0.Text0"><A NAME="pgfId=791"> </A>See <A HREF="ATA.3a.html#37212" CLASS="XRef">Table&nbsp;A-1</A> for possible result codes returned by the ATA Manager.</P></DIV><HR>&#169 1999 Apple Computer, Inc. &#151; (Last Updated 9 Mar 99) <P><A HREF="ATA.2a.html"><img src="images/up.gif" border="0"></A> <A HREF="ATA.2b.html"><img src="images/previous.gif" border="0"></A> <A HREF="ATA.2d.html"><img src="images/next.gif" border="0"></A>  <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!-- document.write(frameLink);//--></script></a><!-- end Show/Hide frames --></P><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>