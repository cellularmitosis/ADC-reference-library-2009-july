<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Using Double Buffers (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.28.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.a.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.2a.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3692"> </A><A NAME="41686"> </A>Using Double Buffers<A NAME="marker=802"> </A></H1><P CLASS="T0.Text0"><A NAME="pgfId=3693"> </A>The play-from-disk routines make extensive use of the <TT CLASS="cv">SndPlayDoubleBuffer</TT> function. You can use this function in your application directly if you wish to bypass the normal play-from-disk routines. You might want to do this to maximize the efficiency of your application while maintaining compatibility with the Sound Manager. Or, you might define your own double-buffering routines so that your application can convert 16-bit sound data on disk to 8-bit data that all versions of the Sound Manager can play. By using <TT CLASS="cv">SndPlayDoubleBuffer</TT> instead of the normal play-from-disk routines, you can specify your own doubleback procedure (that is, the algorithm used to switch back and forth between buffers) and customize several other buffering parameters.<A NAME="marker=1613"> </A><A NAME="marker=334"> </A></P><P CLASS="I.Important"><A NAME="pgfId=3694"> </A><TT CLASS="cv">SndPlayDoubleBuffer</TT> is a very low-level routine and is not intended for general use. In most cases, you should use the high-level Sound Manager routines (such as <TT CLASS="cv">SndPlay</TT> or <TT CLASS="cv">SndStartFilePlay</TT>) or standard sound commands (such as <TT CLASS="cv">bufferCmd</TT>) to play sounds. You&nbsp;should use <TT CLASS="cv">SndPlayDoubleBuffer</TT> only if you require very fine&nbsp;control over double buffering. Remember also that the <TT CLASS="cv">SndPlayDoubleBuffer</TT> function is not always available. You'll need to ensure that it's available in the current operating environment before calling it. See <A target="doc" HREF="imsoundmgr.17.htm#34764" CLASS="XRef">&quot;Testing for Multichannel Sound and Play-From-Disk Capabilities&quot;</A> for details.  </P><P CLASS="T1.Text1"><A NAME="pgfId=3695"> </A>You call <TT CLASS="cv">SndPlayDoubleBuffer</TT> by passing it a pointer to a sound channel (into which the double-buffered data is to be written) and a pointer to a sound double buffer header record. Here's an example:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=9991"> </A>myErr := SndPlayDoubleBuffer(mySndChan, @myDoubleHeader);<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3697"> </A>A sound double buffer header record has the following structure:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=9995"> </A>TYPE SndDoubleBufferHeader =<BR>PACKED RECORD<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhNumChannels:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of sound channels}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhSampleSize:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{sample size, if noncompressed}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhCompressionID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ID of compression algorithm}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhPacketSize:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of bits per packet}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhSampleRate:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fixed;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{sample rate}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhBufferPtr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARRAY[0..1] OF SndDoubleBufferPtr;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pointers to SndDoubleBuffer}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbhDoubleBack:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcPtr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pointer to doubleback procedure}<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3707"> </A><A NAME="marker=9997"> </A>The values for the <TT CLASS="cv">dbhCompressionID</TT>, <TT CLASS="cv">dbhNumChannels</TT>, and <TT CLASS="cv">dbhPacketSize</TT> fields are the same as those for the <TT CLASS="cv">compressionID</TT>, <TT CLASS="cv">numChannels</TT>, and <TT CLASS="cv">packetSize</TT> fields of the compressed sound header, respectively.</P><P CLASS="T1.Text1"><A NAME="pgfId=3708"> </A>The <TT CLASS="cv">dbhBufferPtr</TT> array contains pointers to two records of type <TT CLASS="cv">SndDoubleBuffer</TT>. These are the two buffers between which the Sound Manager switches until all the&nbsp;sound data has been sent into the sound channel. When the call to <TT CLASS="cv">SndPlayDoubleBuffer</TT> is made, the two buffers should both already contain a&nbsp;nonzero number of frames of data.</P><P CLASS="I.Important"><A NAME="pgfId=3870"> </A>The Sound Manager defines the data type <TT CLASS="cv">SndDoubleBufferHeader2</TT> that is identical to the <TT CLASS="cv">SndDoubleBufferHeader</TT> data type except that it contains the <TT CLASS="cv">dbhFormat</TT> field (of type <TT CLASS="cv">OSType</TT>) that defines a custom codec to be used to decompress the sound data. The <TT CLASS="cv">dbhFormat</TT> field is used only if the <TT CLASS="cv">dbhCompressionID</TT> field contains the value <TT CLASS="cv">fixedCompression</TT>. See <A target="doc" HREF="imsoundmgr.46.htm#37630" CLASS="XRef">&quot;Sound Double Buffer Header Records&quot;</A> for details. </P><P CLASS="T1.Text1"><A NAME="pgfId=3709"> </A>Here is the structure of a sound double buffer:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=10001"> </A>TYPE SndDoubleBuffer =<BR>PACKED RECORD<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbNumFrames:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of frames in buffer}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbFlags:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{buffer status flags}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbUserInfo:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ARRAY[0..1] OF LongInt;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{for application's use}<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbSoundData:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PACKED ARRAY[0..0] OF Byte;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{array of data}<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3716"> </A><A NAME="marker=10003"> </A>The buffer status flags field for each of the two buffers might contain either of these&nbsp;values:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=10007"> </A>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbBufferReady&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $00000001;<BR>&nbsp;&nbsp;&nbsp;&nbsp;dbLastBuffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= $00000004;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=2093"> </A><A NAME="marker=10009"> </A>All other bits in the <TT CLASS="cv">dbFlags</TT> field are reserved by Apple; your application should not modify them.</P><P CLASS="T1.Text1"><A NAME="pgfId=2116"> </A>The following two sections illustrate how to fill out these data structures, create your two buffers, and define a doubleback procedure to refill the buffers when they become&nbsp;empty.</P><H2 CLASS="H3.Heading3TOC"><A target="doc" HREF="imsoundmgr.2a.htm#pgfId=3719" CLASS="Hypertext">Setting Up Double Buffers</A></H2><H2 CLASS="H3.Heading3TOC"><A target="doc" HREF="imsoundmgr.2b.htm#pgfId=3727" CLASS="Hypertext">Writing a Doubleback Procedure</A></H2><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.28.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.a.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.2a.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>