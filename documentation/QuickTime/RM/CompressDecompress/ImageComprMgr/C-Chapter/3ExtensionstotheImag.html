<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Compression and Decompression Guide: Extensions to the Image Compression Manager</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Extensions to the Image Compression Manager"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager" title="Extensions to the Image Compression Manager"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../CompressionDecompression-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000498" target="_top">Compression &amp; Decompression</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000878-IntroductiontoQuickTimeCompressionandDecompressionGuide-DontLinkElementID_145">QuickTime Compression and Decompression Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2TheImageCompression.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4ImageCompressionCha.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-SW1" title="Extensions to the Image Compression Manager"></a>
<h1>Extensions to the Image Compression Manager</h1>

<p>This chapter describes the extensions to the Image Compression Manager introduced in various releases of QuickTime, including support for ColorSync, asynchronous decompression, timecodes, and compressed fields of video data.</p>



<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_11">ColorSync Support</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_12">Asynchronous Decompression</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_13">Timecode Support</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_14">Data Source Support</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_15">Working with Alpha Channels</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_16">Working With Video Fields</a>
				
			<br/>
			
        
			
			
				<a href="3ExtensionstotheImag.html#//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_17">Packetization Information</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_11" title="ColorSync Support"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-ColorSyncSupport" title="ColorSync Support"></a>ColorSync Support</h2>
<p>ColorSync is a system extension that provides a platform for consistent color reproduction between widely varying output devices. ColorSync color matching capability was added to the Image Compression Manager picture drawing functions in QuickTime. You can accurately reproduce color images (not movies) with the <code>DrawPicture</code> functions by setting the <code>useColorMatching</code> flag in the flags parameter to these functions.</p>

<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;useColorMatching&#160;&#160;&#160;&#160;= 4<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_12" title="Asynchronous Decompression"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-AsynchronousDecompression" title="Asynchronous Decompression"></a>Asynchronous Decompression</h2>
<p>QuickTime introduced the concept of scheduled asynchronous decompression operations. Decompressor components can allow applications to queue decompression operations and specify when those operations should take place. The Image Compression Manager provides a function, <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/DecompressSequenceFrameWhen" target="_top">DecompressSequenceFrameWhen</a></code>, that allows applications to schedule an asynchronous decompression operation.</p>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_13" title="Timecode Support"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-TimecodeSupport" title="Timecode Support"></a>Timecode Support</h2>
<p>The Image Compression Manager and compressor components have been enhanced to support timecode information. The Image Compression Manager function <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetDSequenceTimeCode" target="_top">SetDSequenceTimeCode</a></code> allows you to set the timecode value for a frame that is to be decompressed.</p>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_14" title="Data Source Support"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DataSourceSupport" title="Data Source Support"></a>Data Source Support</h2>
<p>QuickTime introduced support for an arbitrary number of sources of data for an image sequence. This functionality forms the basis for dynamically modifying parameters to a decompressor. It also allows for codecs to act as special effects components, providing filtering and transition type effects. A client can attach an arbitrary number of additional inputs to the codec. It is up to the particular codec to determine whether to use each input and how to interpret the input. For example, an 8-bit gray image could be interpreted as a blend mask or as a replacement for one of the RGB data planes.</p>
<p>To create a new data source, use the function  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/CDSequenceNewDataSource" target="_top">CDSequenceNewDataSource</a></code>.</p>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_15" title="Working with Alpha Channels"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-WorkingwithAlphaChannels" title="Working with Alpha Channels"></a>Working with Alpha Channels</h2>
<p>QuickTime supports compressing and storing images with alpha channels. QuickTime&#160;supports use of the alpha channel when displaying images. Display of alpha channels is supported only for images with an uncompressed bit depth of 32 bits or greater. For 32-bit ARGB images, for example, the high byte of each pixel contains the alpha channel. For 64-bit ARGB (<code>k64ARGBCodecType</code>), there is a 16-bit alpha field for each pixel, in addition to 16-bit fields for red, green, and blue. The alpha channel can be interpreted in one of three ways:</p>
<ul class="ul">
<li class="li"><p>straight alpha</p></li>
<li class="li"><p>pre-multiplied with white</p></li>
<li class="li"><p>pre-multiplied with black</p></li>
</ul>
<p>QuickTime uses the alpha channel to define how an image is to be combined with the image that is already present at the location to which it will be drawn. This is similar to how QuickDraw&#8217;s blend mode works. To combine an image containing an alpha channel with another image, you specify how the alpha channel should be interpreted by specifying one of the new alpha channel graphics modes defined by QuickTime.</p>
<p>Straight alpha means that the color components of each pixel should be combined with the corresponding background pixel based on the value contained in the alpha channel. For example, if the alpha value is 0, only the background pixel will appear. If the alpha value is 255, only the foreground pixel will appear. If the alpha value is 127, then (127/255) of the foreground pixel will be blended with (128/255) of the background pixel to create the resulting pixel, and so on.</p>
<p>Pre-multiplied with white means that the color components of each pixel have already been blended with a white pixel, based on their alpha channel value. Effectively, this means that the image has already been combined with a white background. To combine the image with a different background color, QuickTime must first remove the white from each pixel and then blend the image with the actual background pixels. Images are often pre-multipled with white as this reduces the appearance of jagged edges around objects.</p>
<p>Pre-multipled with black is the same as pre-multipled with white, except the background color that the image has been blended with is black instead of white.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_151" title="Note"></a>
<p><strong>Note:</strong>&nbsp;
Although you pass these new alpha channel graphics modes to QuickTime in the same way as you would traditional QuickDraw transfer modes, these modes are not supported by QuickDraw and will cause unpredictable results if passed to QuickDraw routines.  </p>
</div>
<p>The Image Compression Manager defines the following constants for specifying alpha channel graphics modes:</p>

<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;graphicsModeStraightAlpha&#160;&#160;&#160;&#160;&#160;&#160;&#160;= 256,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;graphicsModePreWhiteAlpha&#160;&#160;&#160;&#160;&#160;&#160;&#160;= 257,<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;graphicsModePreBlackAlpha&#160;&#160;&#160;&#160;&#160;&#160;&#160;= 258<span></span></pre></td></tr><tr><td scope="row"><pre>&#160;&#160;&#160;&#160;graphicsModeStraightAlphaBlend&#160;&#160;= 260<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>

<p>The <code>graphicsModeStraightAlphaImage</code> Compression Manager, <code>graphicsModePreWhiteAlphaImage</code> Compression Manager, and <code>graphicsModePreBlackAlpha</code> graphics modes cause QuickTime to draw the image interpreting the alpha channel as specified. The graphics mode <code>graphicsModeStraightAlphaBlend</code> causes QuickTime to interpret the alpha channel as a straight alpha channel, but when it draws, combines the pixels together and applies the <code>opColor</code> supplied with the graphics mode to the alpha channel. This provides an easy way to combine images using both an alpha channel and a blend level. This can be useful when compositing 3D rendered images over video.</p>
<p>To draw a compressed image containing an alpha channel, that image must be compressed using an image-compression format that is capable of storing the alpha channel information. The Animation, Planar RGB and None compressors store alpha channel data in the &#8220;Millions of Colors&#8221; + (32-bit) mode.</p>
<p>You use the <code></code> <code><a href="../../../../Reference/QTRef_MediaHandlers/Reference/reference.html#//apple_ref/c/func/MediaSetGraphicsMode" target="_top">MediaSetGraphicsMode</a></code> function to set a movie track to use an alpha channel graphics mode. You use the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetDSequenceTransferMode" target="_top">SetDSequenceTransferMode</a></code> function to set an image sequence to use an alpha channel graphics mode.</p>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_16" title="Working With Video Fields"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-WorkingWithVideoFields" title="Working With Video Fields"></a>Working With Video Fields</h2>
<p>QuickTime introduced support for working directly with fields of interlaced video, such as those created by some motion JPEG compressors.</p>
<p>Because video processing applications sometimes need to perform operations on individual fields (for example, reversing them or combining one field of a frame with a field from another frame), QuickTime now provides a method for accessing the individual fields without having to decompress them first. Previously such operations required decompressing each frame, copying the appropriate fields, and then recompressing. This was a time consuming process that could result in a loss of image quality due to the decompression and recompression of the video data.</p>
<p>Three functions (<code>ImageFieldSequenceBegin</code>, <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/ImageFieldSequenceExtractCombine" target="_top">ImageFieldSequenceExtractCombine</a></code>, and <code>ImageFieldSequenceEnd)</code> allow an application to request that field operations be performed directly on the compressed data. These functions accept one or two compressed images as input and create a single compressed image on output.</p>
<p>The Apple Component Video and Motion JPEG compressors support image field functions in QuickTime. See the description of the <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/ImageFieldSequenceBegin" target="_top">ImageFieldSequenceBegin</a></code>, <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/ImageFieldSequenceExtractCombine" target="_top">ImageFieldSequenceExtractCombine</a></code>, and <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/ImageFieldSequenceEnd" target="_top">ImageFieldSequenceEnd</a></code> functions in the QuickTime API Reference for information on how to process image fields in your application.</p>

<a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-DontLinkElementID_17" title="Packetization Information"></a>
<h2><a name="//apple_ref/doc/uid/TP40000878-ExtensionstotheImageCompressionManager-PacketizationInformation" title="Packetization Information"></a>Packetization Information</h2>
<p>QuickTime video compressors are increasingly being used for videoconferencing applications. Image data from a compressor is typically split into network-packet-sized pieces, transmitted through a packet-based protocol (such as UDP or DDP), and reassembled into a frame by the receiver(s). Typically, a lost packet causes an entire frame to be dropped; without all the data for a given frame, the decompressor cannot decode the image. When the loss of one packet forces others to be unusable, the loss rate is effectively multiplied by a large factor.</p>
<p>Some compression methods, however, such as H.261, can divide a compressed image into pieces which can be decoded independently. Some videoconferencing protocols, such as the Internet&#8217;s Real Time Protocol (RTP, RFC#1889), specify that data compressed using H.261 must be packetized into independently decodable chunks. While RTP demands this packetization information from the compressor, other protocols, such as QuickTime Conferencing&#8217;s MovieTalk protocol, can optionally use this information to effectively reduce loss rates.</p>
<p>QuickTime added four functions to support packetization:  <code><a href="../../../../Reference/QTRef_CompDecomp/Reference/reference.html#//apple_ref/c/func/SetCSequencePreferredPacketSize" target="_top">SetCSequencePreferredPacketSize</a></code>, <code><a href="../../../../Reference/QTRef_SequenceGrabber/Reference/reference.html#//apple_ref/c/func/SGSetPreferredPacketSize" target="_top">SGSetPreferredPacketSize</a></code>, <code><a href="../../../../Reference/QTRef_SequenceGrabber/Reference/reference.html#//apple_ref/c/func/SGGetPreferredPacketSize" target="_top">SGGetPreferredPacketSize</a></code>, and <code><a href="../../../../Reference/QTRef_VideoComponents/Reference/reference.html#//apple_ref/c/func/VDSetPreferredPacketSize" target="_top">VDSetPreferredPacketSize</a></code>. In addition, the <code><!--a target="_top" -->CodecCompressParams<!--/a--></code> structure includes a field, <code>preferredPacketSizeInBytes</code>.</p>
<p>For application developers, the important function is <code><a href="../../../../Reference/QTRef_SequenceGrabber/Reference/reference.html#//apple_ref/c/func/SGSetPreferredPacketSize" target="_top">SGSetPreferredPacketSize</a></code>.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../B-Chapter/2TheImageCompression.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../D-Chapter/4ImageCompressionCha.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/C-Chapter/3ExtensionstotheImag.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/C-Chapter/3ExtensionstotheImag.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/CompressDecompress/ImageComprMgr/C-Chapter/3ExtensionstotheImag.html%3Fid%3DTP40000878-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>