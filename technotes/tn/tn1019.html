<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1019: Plotting Small Icons: The 'SICN' Resource</title>    <meta name="keywords" content="Mac OS 8 SICN plotting small icons">    <meta name="Description" content="Technical Note TN1019: This Technical Note addresses the'SICN' resource format and how to handle 'SICN' Resourceswith more than one indexed icon. With minor modifications,the techniques in this Technote can also be used to plota bitmap of any dimension. Included is a sample procedurethat draws one small icon of a 'SICN' resource."><meta name="categories" content="QuickDraw"><meta name="week-posted" content="Jan 29, 1996 - Feb 2, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002861" title="Plotting Small Icons: The 'SICN' Resource"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1019</div>
<div id="pageheadsub">Plotting Small Icons: The 'SICN' Resource</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc --><p id="menutext"><A HREF = "#RTFToC1">About 'SICN's</a><br><br><A HREF = "#RTFToC2">Using 'SICN's</a><br><br><A HREF = "#References">References</a><br><br><A HREF = "#Changes">Change History</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr> <tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->            <P id = "introtext">Apple first introduced the 'SICN' resource so that the Script Manager could represent which country-specific resources are installed in the system by displaying a small icon in the upper right corner of the menu bar. You can pass a 'SICN' resource to the Notification Manager or Menu Manager, and they will draw it for you automatically--you should continue to let them do so.</p><P id = "introtext">This Technote addresses the 'SICN' resource format and how to handle 'SICN' Resources with more than one indexed icon. Use PlotSICNHandle for 'SICN' Resources with single-indexed icons. With minor modifications, the techniques in this Technote can also be used to plot a bitmap of any dimension.</p><P id = "introtext">If your application has the need to store more than one icon in a 'SICN' Resource, you will have to load and plot the icons yourself.</p><P id = "introtext">We recommend the use of the Icon Utilities package for all your icon needs. This is located in the Icon Utilities chapter of<CITE>Inside Macintosh: More Macintosh Toolbox</CITE>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>&nbsp;[Feb 1 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name="RTFToC1"></a><h2>About 'SICN's</h2><P><A NAME="dogcow"></a>What does a 'SICN' look like? The following is a 'SICN' representation of a dogcow to help answer this question:</p><img src="images/tn1019_003.gif" alt="" width=136 height=75><br><P><b>Figure 1.</b> A 'SICN' Fatbits representation of a dogcow</p><P>A 'SICN' resource contains any number of small icon bit images. Each small icon in a 'SICN' list describes a 16 by 16 pixel image and requires 32 bytes of storage. Like an 'ICN#' resource, there is no count of the number of icons stored in a 'SICN'. The following 'SICN' resource, in MPW Rez format, contains two small icons:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    resource 'SICN' (1984, &quot;clarus&quot;) {        {    /* array: 2 elements */            $&quot;00 48 00 B4 00 84 40 52 C0 41 A0 81 9F 8E 8F 18&quot;            $&quot;40 18 40 18 47 88 48 48 48 48 44 44 3C 3C 00 00&quot;,            $&quot;00 48 00 FC 00 FC 40 7E C0 7F E0 FF FF FE FF F8&quot;            $&quot;7F F8 7F F8 7F F8 78 78 78 78 7C 7C 3C 3C 00 00&quot;        }    };</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="RTFToC2"></a><h2>Using 'SICN's</h2><P>The following examples describe techniques useful when using 'SICN's.</p><h3>Defining a 'SICN' as an Array</h3><P>The Macintosh Toolbox interfaces do not describe all the necessary data structures needed to work with 'SICN' resources. As shown in the following example, defining the 'SICN' type as an array of 16 short integers and the handles and pointers to this array type make life much easier.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>TYPE    SICN        = ARRAY[0 .. 15] of INTEGER;    SICNList    = ARRAY[0 .. 0] of SICN;    SICNPtr     = ^SICNList;    SICNHand    = ^SICNPtr;</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 1.</b> Pascal.</p>	</TD></TR></TABLE></CENTER><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>typedef    short       SICN[16];typedef    SICN        *SICNList;typedef    SICNList    *SICNHand;</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 2.</b> C.</p>	</TD></TR></TABLE></CENTER><h3>Counting Included Small Icons</h3><P>The 'SICN' resource does not provide a count to indicate the number of small icons contained within; however, you can easily determine this number by dividing the total size of the resource by the size of a single small icon.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>CONST    mySICN      = 1984;VAR    theSICN     : SICNHand;    theSize     : LONGINT;    theCount    : LONGINT;    theIndex    : LONGINT;theSICN := SICNHand(GetResource('SICN', mySICN));IF (theSICN &lt;&gt; NIL) THEN BEGIN    theSize := GetHandleSize(Handle(theSICN));    theCount := theSize DIV sizeof(SICN);END;</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 3.</b> Pascal.</p>	</TD></TR></TABLE></CENTER><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#define mySICN         1984SICNHand   theSICN;long       theSize;long       theCount;long       theIndex;theSICN = (SICNHand) GetResource('SICN', mySICN);if (theSICN) {    theSize = GetHandleSize((Handle)theSICN);    theCount = theSize / sizeof(SICN);}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 4.</b> C.</p>	</TD></TR></TABLE></CENTER><h3>Calling Plot SICN</h3><P>The example procedure PlotSICN draws one small icon of a 'SICN' resource.  It takes the handle from theSICN and the position in the list from theIndex within the rectangle theRect of the current GrafPort.</p><P>The following is an example call to PlotSICN which plots all the small icons in a resource into the same rectangle:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SetRect(theRect, 0, 0, 16, 16);FOR theIndex := 0 TO theCount-1 DO    PlotSICN(theRect, theSICN, theIndex);</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 5.</b> Pascal.</p>	</TD></TR></TABLE></CENTER><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SetRect(&amp;theRect, 0, 0, 16, 16);for (theIndex = 0; theIndex &lt; theCount ; ++theIndex)    PlotSICN(&amp;theRect, theSICN, theIndex);</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 6.</b> C.</p>	</TD></TR></TABLE></CENTER><h3>Locking the Handle to 'SICN'</h3><P>Because PlotSICN uses CopyBits and CopyBits can move memory, you should lock the handle to the 'SICN' once the resource is loaded. Notice that the PlotSICN procedure dereferences the 'SICN' handle, adds an offset, and copies the resulting value. If the 'SICN' list moves in memory at this time, the bitmap's baseAddr is useless.</p><P>To play it safe, PlotSICN saves a copy of the master pointer flags associated with the relocatable block, locks the block with a call to HLock, and restores the flags after calling CopyBits.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>WARNING:</B><BR>You should <b>never</b> examine, set, or clear these flags directly; you should always use the routines which are provided by the Memory Manager and Resource Manager. It is not necessary to check the value of the flag after getting it.</P></TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE PlotSICN(theRect: Rect; theSICN: SICNHand; theIndex : INTEGER);VAR    state       : SignedByte;    {we want a chance to restore original                                                        state }    srcBits     : BitMap;    {built up around 'SICN' data so we can                                                        CopyBits }BEGIN    {check the index for a valid value }    IF (GetHandleSize(Handle(theSICN)) DIV sizeof(SICN)) &gt; theIndex THEN    BEGIN    {store the resource's current locked/unlocked condition }    state := HGetState(Handle(theSICN));    {lock the resource so it won't move during the CopyBits call }    HLock(Handle(theSICN));    {set up the small icon's bitmap }    {$PUSH}    {$R-}            {turn off range checking }    srcBits.baseAddr := Ptr(@theSICN^^[theIndex]);    {$POP}    srcBits.rowBytes := 2;    SetRect(srcBits.bounds, 0, 0, 16, 16);    {draw the small icon in the current grafport }    CopyBits(srcBits,thePort^.portBits,srcBits.bounds,            theRect,srcCopy,NIL);    {restore the resource's locked/unlocked condition }    HSetState(Handle(theSICN), state);    END;END;</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 7.</b> Pascal.</p>	</TD></TR></TABLE></CENTER><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void PlotSICN(Rect *theRect, SICNHand theSICN, long theIndex) {    char    state;        /* saves original flags of 'SICN' handle */    BitMap    srcBits;    /* built up around 'SICN' data so we can CopyBits */    /* check the index for a valid value */    if ((GetHandleSize(Handle(theSICN)) / sizeof(SICN)) &gt; theIndex) {        /* store the resource's current locked/unlocked condition */        state = HGetState((Handle)theSICN);        /* lock the resource so it won't move during the CopyBits call */        HLock((Handle)theSICN);        /* set up the small icon's bitmap */        srcBits.baseAddr = (Ptr) (*theSICN)[theIndex];        srcBits.rowBytes = 2;        SetRect(&amp;srcBits.bounds, 0, 0, 16, 16);        /* draw the small icon in the current grafport */        CopyBits(&amp;srcBits,&amp;(*qd.thePort).portBits,            &amp;srcBits.bounds,theRect,srcCopy,nil);        /* restore the resource's locked/unlocked condition */        HSetState((Handle) theSICN, state);    }}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 8.</b> C.</p>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><p> <a href="http://developer.apple.com/documentation/mac/Toolbox/Toolbox-2.html"><CITE>Inside Macintosh: Macintosh ToolBox Essentials</CITE></A></p><p> <a href="http://developer.apple.com/documentation/mac/QuickDraw/QuickDraw-2.html"><CITE>Inside Macintosh: Imaging With QuickDraw</CITE></A></p><p> <a href="http://developer.apple.com/documentation/mac/Memory/Memory-2.html"><CITE>Inside Macintosh: Memory</CITE></A></p><p> Technical Note <A HREF = "../qd/qd_17.html">QD 17 -- Drawing Icons</a></P><P><A HREF="#top">Back to top</A></P><a name="Changes"></a><H2>Change History</h2>         <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-August-1989</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1996</P>               </TD>               <td align="left">                  <P>Errors in the Pascal code were corrected.</P>               </TD>            </TR></table><P><A HREF="#top">Back to top</A></P>                           <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (64K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1019.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1019.html%3Fid%3DDTS10002861-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1019.html%3Fid%3DDTS10002861-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1019.html%3Fid%3DDTS10002861-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>