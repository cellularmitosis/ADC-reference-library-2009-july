<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"        "http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd"><HTML><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note HW15: NuBus Block Transfer Mode sResource Entries</title><meta name="categories" content="Hardware"><meta name="week-posted" content="Jan 28, 1991 - Feb 1, 1991"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002484" title="NuBus Block Transfer Mode sResource Entries"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note HW15</div>
<div id="pageheadsub">NuBus Block Transfer Mode sResource Entries</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->                     <P id = "menutext">         <A HREF="#Introduction">Introduction</A><BR><BR><A HREF="#Section1">Give or Take?</A><BR><BR><A HREF="#Section2">How Do You Define Them; Where Do They Go?</A><BR><BR><A HREF="#Conclusion">Conclusion</A><BR><BR><A HREF="#References">References</A><BR><BR>          <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --> <P id= "introtext">This Technical Note describes the <code>sResource</code> entries needed in adeclaration ROM to inform NuBus masters when a boardis capable of receiving or sending block transfers.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Feb 01 1991]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>In addition to normal long word transfers, the NuBus specification defines anumber of block transfer transactions.  In block mode transfers, the systemarbitrates for the bus a single time and then performs a group of consecutivelong word transfers before releasing the bus.  The reduction in bus arbitrationtime can result in considerable gains in performance.</p><p>Currently, Macintoshes do not support block transfers to or from NuBus cards;however, in the future, this might change.  In addition, present NuBus cardscan act as bus masters and initiate card-to-card block transfers (e.g., 8*24 GCCard to 8*24 Display Card).  The problem is that the master needs to determinewhat block transfer capabilities a slave has (and future systems may want toascertain the same).  This Note describes the mechanism that is to be used forNuBus cards to register their block transfer capability.</p><p>This Note uses video boards as an example, but hardware developers should notethat the same principle applies to other types of NuBus boards (e.g., memoryexpansion, data acquisition, etc.).  Apple recommends reviewing the NuBusspecification to clarify details about master transfers, locked transfers, andblock transfer sizes.</p><P><A HREF="#top">Back to top</A></P><a name="Section1"></a><h2>Give Or Take?</h2><p>There are two long word <code>sResource</code> entries which define the blocktransfer capabilities of the board or mode.  The first describes <b>generalblock transfer information</b> and the second describes the <b>maximum numberof transactions for locked transfers</b> (if the board supports them).  If theentries specifying block transfer information are omitted, the master shouldassume that the target board does not support block transfers and should nottest for this capability when the entries are not present.  It is highlyencouraged that new boards being developed do include this information sincefuture system software will most probably only use these entries to decide if aboard supports block transfers or not since any method of directly testing theboard to identify its capability is liable to cause data loss or weirdbehavior, including system crashes.</p><p>The second word is not necessary if the board or mode does not support lockedtransfers.</p><p>The NuBus specifications establish that when a slave board that does notsupport block transfers receives such a request, it should terminate the firsttransfer with <code>/ACK</code>; boards that do not support block transfers and donot implement an early <code>/ACK</code> block termination must have the<code>sResource</code> block transfer information present with all the slavetransfer size bits set to zero.</p><p>The format of the general block transfer information is a long word whosestructure is as follows:</p><P align=center><img src="images/hw_15_001.gif" alt="General Block Transfer Information Long Word Format" width=392 height=156></p><p align=center><b>Figure 1-General Block Transfer Information Long Word Format</b></p><p>The fields have the following meaning:</p><P align=center><img src="images/hw_15_002.gif" alt="Descriptions Of General Block Information Fields" width=376 height=137></p><P align=center><B>Table 1 - Descriptions Of General Block Information Fields</b></p><p>The Maximum Locked Transfer Count is a long word.</p><P align=center><img src="images/hw_15_003.gif" alt="Maximum Number Of Transactions Long Word Format" width=352 height=32></p><P align=center><b>Figure 2 - Maximum Number Of Transactions Long Word Format</b></p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>How Do You Define Them; Where Do They Go?</h2><p>The block transfer capability long words are kept in a card's declaration ROM.You can use <code>OSLstEntry</code> (OffSet List Entry) macros to describe bothblock transfer capability long words.  The macro takes two arguments:  the IDbyte and a label designating the destination and uses them to create a longword entry.  The macro puts the first argument, the ID, as is, into the highbyte, and, with the second argument, calculates the 24-bit signed offset valueto the destination label, putting it into the next three bytes.</p><P>If the card can support <b>all</b> block transfers in <b>all</b> of theoperation modes that it supports, the block transfer capability entries arekept in one centralized place--the board <code>sResource</code> list.  For example,this is the way it is done on the Apple 8*24 GC Display Card.  When the board<code>sResource</code> is used to store the entries, use these ID values for thegeneral block transfer information and maximum locked transfer count longwords:</p><p>    <code>sBlockTransferInfo</code>        =  #20  =  $14<br>    <code>sMaxLockedTransferCount</code>    =  #21  =  $15</p><p>The following code fragment illustrates a board <code>sResource</code> caseimplementation:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    _sRsrc_Board        OSLstEntry    sRsrc_Type,_BoardType        OSLstEntry    sRsrc_Name,_BoardName        OSLstEntry    sBlockTransferInfo,_BTInfo        OSLstEntry    sMaxBlockTransferCount,_BTMaxCnt        DatLstEntry   BoardId,BoardId        OSLstEntry    PrimaryInit,_sPInitRec        OSLstEntry    VendorInfo,_VendorInfo        OSLstEntry    SecondaryInit,_sSInitRec        OSLstEntry    sRsrcVidNames,_sVidNameDir        DatLstEntry   EndOfList,0        . . .    _BTInfo        DC.L          allBlockTransfers    _BTMaxCnt        DC.L          maxLockedTransferCount</pre>	</TD></TR></TABLE></CENTER>        <p>where, for example, <code>allBlockTransfers</code> = $C00F800F and<code>maxLockedTransferCount</code> = maximum transaction size.  It is important tonote that this value depends on the capabilities of the board underconsideration as indicated in the illustrations.</p><p>If the card only supports block transfer in some modes (specifically, screendepths in the case of video boards), the information is placed in the<code>sResource</code> entries corresponding to those modes (e.g., video<code>sResource</code> parameter lists) that support block transfers.  This is theway it is done on the Apple 8*24 Display Card, since it does not support blocktransfers in the 24-bpp mode or any convoluted interlaced mode.</p><p>The Apple <code>sResource</code> ID numbers for this case are:</p><p>    <code>mBlockTransferInfo</code>        =  #5  =  $5<br>    <code>mMaxLockedTransferCount</code>    =  #6  =  $6</p><p>The following code fragment illustrates one video parameter list within one<code>sResource</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    _EZ4u        OSLstEntry    mVidParams,_Parms        DatLstEntry   mPageCnt,Pages        DatLstEntry   mDevType,ClutType        OSLstEntry    mBlockTransferInfo,_BTInfo        DatLstEntry   EndOfList,0        . . .    _BTInfo        DC.L    allSlaveBlockSizes</pre>	</TD></TR></TABLE></CENTER>        <p>where <code>allSlaveBlockSizes</code> = $0000800F.  Note that the maximum blocktransfer count does not need to be specified for slave devices, and for thisreason it is not used in the example.</p><P><A HREF="#top">Back to top</A></P><a name="Conclusion"></a><h2>Conclusion</h2><p>Cards that support block transfers must use these <code>sResource</code> entries intheir declaration ROMs to allow other NuBus boards to utilize this capabilitythus improving compatibility and performance.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P>Designing Cards and Drivers for the Macintosh Family, Second Edition</p><P>IEEE Standard for a Simple 32-Bit Backplane Bus: NuBus</p><p>NuBus is a trademark of Texas Instruments</p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (140K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/hw_15.pdf">Download</A></P>               </TD>            </TR></table><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/hw/hw_15.html%3Fid%3DDTS10002484-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/hw/hw_15.html%3Fid%3DDTS10002484-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/hw/hw_15.html%3Fid%3DDTS10002484-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>