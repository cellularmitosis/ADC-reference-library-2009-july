<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Closing a Window(IM:Tb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING211></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Toolbox-210.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-212.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Toolbox-2.html"><B>Macintosh Toolbox Essentials</B></A> / <BR><DD><A HREF="Toolbox-188.html"><B>Chapter 4 - Window Manager</B></A> / <A HREF="Toolbox-201.html"><B>Using the Window Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING211-0></A>
<H2><A NAME=MARKER-9-242></A>Closing a Window</H2>
 <A NAME=MARKER-2-243></A>The user closes a window either by clicking the close box, in the upper-left corner of the window, or by choosing Close from the File menu.<P>
 When the user presses the mouse button while the cursor is in the close box, your application calls the <CODE>TrackGoAway</CODE> function to track the mouse until the user releases the button, as illustrated in <A HREF=Toolbox-207.html#MARKER-9-200>Listing 4-9</A> on <A HREF=Toolbox-207.html#MARKER-9-200>page 4-39</A>. If the user releases the button while the cursor is outside the close box, <CODE>TrackGoAway</CODE> returns <CODE>FALSE</CODE>, and your application does nothing. If <CODE>TrackGoAway</CODE> returns <CODE>TRUE</CODE>, your application invokes its own procedure for closing a window.<P>
 The specific steps you take when closing a window depend on what kind of information the window contains and whether the contents need to be saved. The sample code in this chapter recognizes four kinds of windows: the modeless dialog box containing the Find dialog, the modeless dialog box containing the Spell Check dialog, a standard document window, and a window associated with a desk accessory that was launched in the application's partition.<P>
 <A HREF=#MARKER-9-245>Listing 4-16</A> illustrates an application-defined procedure, <CODE>DoCloseCmd</CODE>, that determines what kind of window is being closed and follows the appropriate strategy. The application calls <CODE>DoCloseCmd</CODE> when the user clicks a window's close box or chooses Close from the File menu.<A NAME=MARKER-2-295></A><P>
<B>Listing 4-16  <A NAME=MARKER-9-245></A>Handling a close command</B><P>
<PRE>
PROCEDURE DoCloseCmd;
VAR
   myWindow:   WindowPtr;     {pointer to window's record}
   myData:     MyDocRecHnd;   {handle to a document record}
   windowType: Integer;       {application-defined window type}
BEGIN
   myWindow := FrontWindow;
   windowType := MyGetWindowType(myWindow);
   CASE windowType OF
      kMyFindModelessDialog:        {for modeless dialog boxes, }
         HideWindow(myWindow);      { hide window}
      kMySpellModelessDialog:       {for modeless dialog boxes, }
         HideWindow(myWindow);      { hide window}
      kDAWindow:              {for desk accessories, close the DA}
         CloseDeskAcc(WindowPeek(myWindow)^.windowKind);
      kMyDocWindow:           {for documents, handle file first}
         BEGIN
            myData := MyDocRecHnd(GetWRefCon(myWindow));
            MyCloseDocument(myData);
         END;
   END;     {of CASE}
END;
</PRE>
 The <CODE>DoCloseCmd</CODE> procedure first determines which window is the active window <BR>and then calls the application-defined function <CODE>MyGetWindowType</CODE> to identify the window's type, as defined by the application. If the window is a modeless dialog box, <CODE>MyCloseCmd</CODE> merely hides the window, leaving the data structures in memory. For <BR>a sample routine that displays a hidden window, see <A HREF=Toolbox-212.html#MARKER-9-253>Listing 4-18</A> on <A HREF=Toolbox-212.html#MARKER-9-253>page 4-56</A><A NAME=MARKER-2-369></A>.<P>
 If the window is associated with a desk accessory, the <CODE>DoCloseCmd</CODE> procedure calls <BR>the <CODE>CloseDeskAcc</CODE> procedure to close the desk accessory. This case is included <BR>only for compatibility; in System 7 desk accessories are seldom launched in an application's partition.<P>
 <A NAME=MARKER-2-132></A>If the window is associated with a document, <CODE>DoCloseCmd</CODE> reads the document <BR>record and then calls the application-defined procedure <CODE>MyCloseDocument</CODE> to handle the closing of a document window. <A HREF=#MARKER-9-248>Listing 4-17</A> illustrates the <CODE>MyCloseDocument</CODE> procedure.<P>
<B>Listing 4-17  <A NAME=MARKER-9-248></A>Closing a document</B><P>
<PRE>
PROCEDURE MyCloseDocument (myData: MyDocRecHnd);
VAR
   title:      Str255;        {window/document title}
   item:       Integer;       {item in Save Alert dialog box}
   docWindow:  WindowPtr;     {pointer to window record}
   event:      EventRecord;   {dummy record for DoActivate}
   myErr:      OSErr;         {variable for error-checking}
BEGIN
   docWindow := FrontWindow;
   IF (myData^^.windowDirty) THEN   {changed since last save}
   BEGIN
      GetWTitle(docWindow, title);     {get window title}
      ParamText(title, '', '', '');    {set up dialog text}
      {deactivate window before displaying Save dialog}
      DoActivate(docWindow, FALSE, event);
      {put up Save dialog and retrieve user response}
      item := CautionAlert(kSaveAlertID, @MyEventFilter);
      IF item = kCancel THEN     {user clicked Cancel}
         Exit(MyCloseDocument);  {exit without closing}
      IF item = kSave THEN       {user clicked Save}
         DoSaveCmd;              {save the document}
      {otherwise user clicked Don't Save-- }
      { close document in either case}
      myErr := DoCloseFile(myData); {close document}
      {Add your own error handling.}
   END;
   {close window whether or not user saved}
   CloseWindow(docWindow);          {close window}
   DisposePtr(Ptr(docWindow));      {dispose of window record}
END;
</PRE>
 The <CODE>MyCloseDocument</CODE> procedure checks the <CODE>windowDirty</CODE> field in the document record (described in <A HREF=Toolbox-202.html#MARKER-9-133>"Managing Multiple Windows" beginning on page 4-20</A>). If the value of <CODE>windowDirty</CODE> is <CODE>TRUE</CODE>, <CODE>MyCloseDocument</CODE> displays a dialog box giving the user a chance to save the document before closing the window. The dialog box gives <BR>the user the choices of canceling the close, saving the document before closing <BR>the window, or closing the window without saving the document. If the user <BR>cancels, <CODE>MyCloseDocument</CODE> merely exits. If the user opts to save the document, <CODE>MyCloseDocument</CODE> calls the application-defined routine <CODE>DoSaveCmd</CODE>, which is <BR>not shown here. (For a description of how to save and close a file, see the chapter "Introduction to File Management" in <I><A HREF="../Files/Files-2.html">Inside Macintosh: Files</A></I>.) Whether or not the <BR>user saves the document before closing the window, <CODE>MyCloseDocument</CODE> closes the document and finally removes the window from the screen and diposes of the memory allocated to the window record.<A NAME=MARKER-2-134></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Toolbox-210.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Toolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Toolbox-490.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Toolbox-212.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Toolbox-3.html">&copy; Apple Computer, Inc.</A><br>11 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
