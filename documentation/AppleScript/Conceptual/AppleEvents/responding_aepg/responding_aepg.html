<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Apple Events Programming Guide: Responding to Apple Events</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Responding to Apple Events"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001449-CH206" title="Responding to Apple Events"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000494" target="_top">Carbon</a> &gt; <a href="../intro_aepg/intro_aepg.html#//apple_ref/doc/uid/TP40001449-CH201-DontLinkElementID_65">Apple Events Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../data_in_ae_aepg/data_in_ae_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../create_send_aepg/create_send_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001449-CH206-BABDAJGB" title="Responding to Apple Events"></a><h1>Responding to Apple Events</h1><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_314"></a>Your application must be able to respond to certain Apple events sent by the Mac OS, such as the <code>open application</code> and <code>quit</code> events. If your application has defined additional Apple events that it supports, either to supply services to other applications or to make itself scriptable, it must be ready to respond to those events as well.</p><p>This chapter describes how you write handlers to respond to the Apple events your application receives. It also provides an overview of how Carbon applications work with Apple events sent by the Mac OS.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGJIGBC">About Apple Event Handlers</a>
				
			<br/>
			
        
			
			
				<a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGCFJDD">Writing an Apple Event Handler</a>
				
			<br/>
			
        
			
			
				<a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-BEJBDEGI">Handling Apple Events Sent by the Mac OS</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001449-CH206-CEGJIGBC" title="About Apple Event Handlers"></a><h2>About Apple Event Handlers</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_315"></a>To respond to Apple events, your application registers handler functions with the Apple Event Manager for the events it can handle, as described in <span class="content_text"><a href="../dispatch_aes_aepg/dispatch_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH204-BABDAJGB">“Apple Event Dispatching.”</a></span> Your application will only receive Apple events that target it—that is, events that specify your application in their target address descriptor. These include the events described in <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-BEJBDEGI">“Handling Apple Events Sent by the Mac OS.”</a></span> Should your application receive an Apple event it is not expecting, the Apple Event Manager will not find it in your dispatch table, so the event will not be dispatched to one of your handlers, unless you have installed a wildcard handler.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_68" title="Note"></a><p><strong>Note:</strong>&nbsp;One exception is the case where an event handler is installed automatically for your application. For example, <span class="content_text"><a href="../dispatch_aes_aepg/dispatch_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH204-BABGCEBE">“Processing Apple Events With the Carbon Event Model”</a></span> describes a case in which a system <code>quit</code> event handler is installed automatically.</p></div><p>As a result, your event handlers should generally be called only for events they understand. If a problem occurs, it is most commonly due to an error in constructing the event that was sent to your application. Because of this possibility, you may want to test the error handling in your Apple event code by intentionally sending your application Apple events containing unexpected information.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_41" title="Definition of an Apple Event Handler"></a><h3>Definition of an Apple Event Handler</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_316"></a>When you declare an Apple event handler, the syntax must match the <code>AEEventHandlerProcPtr</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_317"></a> data type, which is described in detail in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>. <span class="content_text">Listing 5-1</span> shows the declaration for a function that handles the <code>open documents</code> Apple event—all your handler declarations use a similar declaration.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGJIFEC" title="Listing 5-1Definition for an Apple event handler"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Definition for an Apple event handler</p><div class="codesample"><table><tr><td scope="row"><pre>static pascal OSErr HandleOpenDocAE (<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    const AppleEvent * theAppleEvent,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    AppleEvent * reply,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    SInt32 handlerRefcon);<span>// 4</span></pre></td></tr></table></div><p>Here’s a description of this function declaration:</p><ol class="ol"><li class="li"><p>The <code>pascal</code> keyword ensures proper ordering of parameters on the stack.</p></li><li class="li"><p>The Apple event for the function to handle. You’ll often extract information from it to help you process the Apple event.</p></li><li class="li"><p>The default reply (provided by the Apple Event Manager). It contains no parameters. If no reply is requested, the reply event is a null descriptor.</p></li><li class="li"><p>The 32-bit reference constant you supplied for the handler when you first registered it by calling <code>AEInstallEventHandler</code>. You can use the reference constant to provide information about the Apple event, or for any other purpose you want.</p><p>For example, you can install, for multiple Apple events, dispatch table entries that specify the same handler but different reference constants. Your handler can then use the reference constant to distinguish between the different Apple events it receives.<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_318"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGJDIJB" title="Interacting With the User"></a><h3>Interacting With the User</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_319"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_320"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_321"></a>When your application handles an Apple event, it may need to interact with the user. For example, your handler for the <code>print documents</code> event may need to display a print dialog before printing. Your application should not just assume it is okay to interact with the user in response to an Apple event. It should always call the <code>AEInteractWithUser</code> function to make sure it is in the foreground before it interacts with the user.</p><p>If <code>AEInteractWithUser</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_322"></a> returns the value <code>noErr</code>, then your application is currently in front and is free to interact with the user. If <code>AEInteractWithUser</code> returns the value <code>errAENoUserInteraction</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_323"></a>, your application should not attempt to interact with the user.</p><p>You can specify flags to the <code>AESetInteractionAllowed</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_324"></a> function to allow the following types of interaction with your application:</p><ul class="spaceabove"><li class="li"><p>Only when your application is sending an Apple event to itself.</p></li><li class="li"><p>Only when the client application is on the same computer as your application.</p></li><li class="li"><p> For any event sent by any client application on any computer.</p></li></ul><p>Both client and server applications specify their preferences for user interaction: the client specifies whether the server should be allowed to interact with the user, and the server (your application) specifies when it allows user interaction while processing an Apple event. For interaction to take place, these two conditions must be met:</p><ul class="spaceabove"><li class="li"><p>The client application must set flags in the <code>sendMode</code> parameter of the <code>AESend</code> function indicating that user interaction is allowed.</p></li><li class="li"><p> The server application must either set no user interaction preferences, in which case it is assumed that only interaction with a client on the local computer is allowed; or it must use the <code>AESetInteractionAllowed</code> function to indicate that user interaction is allowed.</p></li></ul><p>If these two conditions are met and if <code>AEInteractWithUser</code> determines that both the client and server applications allow user interaction under the current circumstances, <code>AEInteractWithUser</code> brings your application to the foreground if it isn’t already in the foreground. Your application can then display a dialog or otherwise interact with the user. The <code>AEInteractWithUser</code> function brings your server application to the front either directly or after the user responds to a notification request.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_69" title="Important:"></a><p><strong>Important:</strong>&nbsp;Calling <code>AEInteractWithUser</code> ensures that your application will get correct notification in terms of being activated. There is no guarantee that other applications are setting an interaction level, but if they are, your application can respect it.</p><p>Interaction is not currently guaranteed to work correctly in the context of fast user switching. For example, your application could ask the user whether it should present UI, but the user might never respond because your application has been switched out.</p><p></p></div><p>To track when your Carbon or Cocoa application has been switched in or out, you can sign up for notification of the <code>kEventSystemUserSessionActivated</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_325"></a> and <code>kEventSystemUserSessionDeactivated</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_326"></a> events, as described in <span class="content_text"><a href="../../../../MacOSX/Conceptual/BPMultipleUsers/Concepts/UserSwitchNotifications.html#//apple_ref/doc/uid/20002210" target="_top">User Switch Notifications</a></span> in <em><a href="../../../../MacOSX/Conceptual/BPMultipleUsers/index.html#//apple_ref/doc/uid/10000180i" target="_top">Multiple User Environments</a></em>.</p><p>To determine whether your application is currently running in the active user session, you can use the <code>CGSessionCopyCurrentDictionary</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_327"></a> function, together with the <code>kCGSessionOnConsoleKey</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_328"></a>, as described in <span class="content_text"><a href="../../../../MacOSX/Conceptual/BPMultipleUsers/Concepts/FastUserSwitching.html#//apple_ref/doc/uid/20002209" target="_top">Supporting Fast User Switching</a></span> in <em><a href="../../../../MacOSX/Conceptual/BPMultipleUsers/index.html#//apple_ref/doc/uid/10000180i" target="_top">Multiple User Environments</a></em>.</p><p>For more information on working with user interaction, see <span class="content_text"><a href="../create_send_aepg/create_send_aepg.html#//apple_ref/doc/uid/TP40001449-CH209-BABGEAHG">“Specifying Send and Reply Options”</a></span> in this document, as well as the following in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>:</p><ul class="spaceabove"><li class="li"><p>The section "User Interaction Level Constants.“</p></li><li class="li"><p>The constants listed under “AESendMode.“</p></li><li class="li"><p>The functions <code>AEInteractWithUser</code>, <code>AESetInteractionAllowed</code>, <code>AEGetInteractionAllowed</code>, and <code>AESend</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_329"></a>.</p></li></ul><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGCFJDD" title="Writing an Apple Event Handler"></a><h2>Writing an Apple Event Handler</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_330"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_331"></a>Your Apple event handler typically performs the following operations:</p><ul class="ul"><li class="li"><p>It extracts information from the received Apple event.</p></li><li class="li"><p>It performs any requested actions, checking that interaction is allowed before attempting to interact with a user.</p></li><li class="li"><p>It adds information to the reply Apple event if appropriate.</p></li><li class="li"><p>It returns a result code. If an error occurs in extracting information from the event or if an error occurs in any other operation:</p><ul class="nested"><li class="nested li"><p>It may add error information to the reply Apple event.</p></li><li class="nested li"><p>It returns an appropriate error code.</p></li></ul></li></ul><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGIFCID" title="Extracting Information From the Apple Event"></a><h3>Extracting Information From the Apple Event</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_332"></a>For nearly all standard Apple events, your handler extracts data from the event to help determine how to process the event. The following are some kinds of information you are likely to extract:</p><ul class="spaceabove"><li class="li"><p>The event class and/or the event ID. For example, if you registered your handler with one or more wildcards, you may need to get the event class or event ID to determine which kind of event you actually received. You can obtain this information by calling a function such as <code>AEGetAttributePtr</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_333"></a>, and passing <code>keyEventClassAttr</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_334"></a> or <code>keyEventIDAttr</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_335"></a> for the parameter that specifies the keyword of the attribute to access.</p></li><li class="li"><p>The direct parameter, which usually specifies the data to be acted upon. <span class="content_text"><a href="../data_in_ae_aepg/data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABGBICJ">Listing 4-5</a></span> shows how to get a parameter that contains a list of files from an <code>open documents</code> Apple event.</p></li><li class="li"><p>Additional parameters. These can be any kind of data stored in an Apple event. They might include object specifiers, which identify objects within your application on which the Apple event operates. For information on how to work with object specifiers, see <span class="content_text"><a href="http://developer.apple.com/documentation/mac/IAC/IAC-231.html#HEADING231-0" target="_top">“Resolving and Creating Object Specifier Records”</a></span> in <span class="content_text"><a href="http://developer.apple.com/documentation/mac/IAC/IAC-2.html" target="_top">Inside Macintosh: Interapplication Communication</a></span>.</p></li></ul><p><span class="content_text"><a href="../data_in_ae_aepg/data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABDAJGB">“Working With the Data in an Apple Event”</a></span> provides additional information and examples of how you extract data from an Apple event.<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_336"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGFDDFI" title="Performing the Requested Action"></a><h3>Performing the Requested Action</h3><p>When your application responds to an Apple event, it should perform the standard action requested by that event. For example, your application should respond to the <code>print documents</code> event by printing the specified documents.</p><p>Many Apple events can ask your application to return data. For instance, if your application is a spelling checker, the client application might expect your application to return data in the form of a list of misspelled words.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_42" title="Adding Information to a Reply Apple Event"></a><h3>Adding Information to a Reply Apple Event</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_337"></a>If the application that sent the Apple event requested a reply, the Apple Event Manager passes a default reply Apple event to your handler. The reply event has event class <code>kCoreEventClass</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_338"></a> and event ID <code>kAEAnswer</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_339"></a>. If the client application does not request a reply, the Apple Event Manager passes a null descriptor instead—that is, a descriptor of type <code>typeNull</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_340"></a> whose data handle has the value <code>NULL</code>.</p><p>The default reply Apple event has no parameters, but your handler can add parameters or attributes to it. If your application is a spelling checker, for example, you can return a list of misspelled words in a parameter. However, your handler should check whether the reply Apple event exists before attempting to add to it. Attempting to add to a null descriptor generates an error.</p><p>Your handler may need to add error information to the reply event, as described in subsequent sections.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_43" title="Returning a Result Code"></a><h3>Returning a Result Code</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_341"></a>When your handler finishes processing an Apple event, it should dispose of any Apple event descriptors or other data it has acquired. It should then return a result code to the Apple Event Manager. Your handler should return <code>noErr</code> if it successfully handles the Apple event or a nonzero result code if an error occurs.</p><p>If an error occurs because your application cannot understand the event, it should return <code>errAEEventNotHandled</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_342"></a>. This allows the Apple Event Manager to look for a handler in the system dispatch table that might be able to handle the event. If the error occurs because the event is impossible to handle as specified, return the result code returned by whatever function caused the failure, or whatever other result code is appropriate.</p><p>For example, suppose your application receives a <code>get data</code> event requesting the name of the current printer, but it cannot handle such an event. In this situation, you can return <code>errAEEventNotHandled</code> in case another available handler can handle the <code>get data</code> event. However, this strategy is only useful if your application has installed such a system handler, or the event is one of the few for which a system handler may be installed automatically. (For information on handlers that are installed automatically, see <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-BEJBDEGI">“Handling Apple Events Sent by the Mac OS.”</a></span>)</p><p>However, if your application cannot handle a <code>get data</code> event that requests the fifth paragraph in a document because the document contains only four paragraphs, you should return some other nonzero error, because further attempts to handle the event are pointless.</p><p>In addition to returning a result code, your handler can also return an error string by adding a <code>keyErrorString</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_343"></a> parameter to the reply Apple event. The client can use this string in an error message to the user. For more information, see <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGFGBBG">“Returning Error Information.”</a></span></p><p>For scriptable applications, the client is often the Script Editor, or some other application, executing a script. When you return an error code that the Apple Event Manager understands, the Script Editor automatically displays an appropriate error message to the user. You can find tables of error codes documented in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em> and <em><a href="../../../../Carbon/Reference/Open_Scripti_Architecture/index.html#//apple_ref/doc/uid/TP30000083" target="_top">Open Scripting Architecture Reference</a></em>.<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_344"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGFGBBG" title="Returning Error Information"></a><h3>Returning Error Information</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_345"></a>If your handler returns a nonzero result code, the Apple Event Manager adds a <code>keyErrorNumber</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_346"></a> parameter to the reply Apple event (unless you have already added a <code>keyErrorNumber</code> parameter). This parameter contains the result code that your handler returns. This can be useful because it associates the error number directly with the return event, which the client application may pass around without the result code.</p><p>Rather than just returning an error code, your handler itself can add error information to the reply Apple event. It can add both an error number and an error string. As noted previously, in many cases returning an Apple Event Manager error code will result in an appropriate error message. You should only add your own error text in cases where you can provide information the Apple Event Manager cannot, such as information specific to the operation of your application.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_70" title="Note"></a><p><strong>Note:</strong>&nbsp;Handlers can return several additional types of error information. For details, see the <code>OSAScriptError</code> function and the constant section “OSAScriptError Selectors” in <em><a href="../../../../Carbon/Reference/Open_Scripti_Architecture/index.html#//apple_ref/doc/uid/TP30000083" target="_top">Open Scripting Architecture Reference</a></em>.</p></div><p>To directly add an error number parameter to a reply Apple event, your handler can call a function like the one in <span class="content_text">Listing 5-2</span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGBCICI" title="Listing 5-2A function to add an error number to a reply Apple event"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>A function to add an error number to a reply Apple event</p><div class="codesample"><table><tr><td scope="row"><pre>static void AddErrNumberToEvent(OSStatus err, AppleEvent* reply)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus returnVal = errAEEventFailed;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (reply->descriptorType != typeNull)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        returnVal = AESizeOfParam(reply, keyErrorNumber, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (returnVal != noErr))<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            AEPutParamPtr(reply, keyErrorNumber,<span></span></pre></td></tr><tr><td scope="row"><pre>                        typeSInt32, &amp;err, sizeof(err));<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return returnVal;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s a description of how this function works:</p><ol class="ol"><li class="li"><p>It receives an error number and a pointer to the reply Apple event to modify.</p></li><li class="li"><p>It declares a variable for the return value and sets it to the Apple Event Manager error constant for “Apple event handler failed.” If the function is successful, this value is changed.</p></li><li class="li"><p>It checks the descriptor type of the reply Apple event to make sure it is not a null event.</p></li><li class="li"><p>It verifies that the event doesn’t already contain an error number parameter (<code>AESizeOfParam</code> returns an error if it doesn’t find the parameter).</p></li><li class="li"><p>It calls <code>AEPutParamPtr</code> to add an error number parameter to the reply event:</p><ul class="ul"><li class="li"><p><code>keyErrorNumber</code> specifies the keyword for the added parameter.</p></li><li class="li"><p><code>typeSInt32</code> specifies the descriptor type for the added parameter.</p></li><li class="li"><p><code>err</code> specifies the error number to store in the added parameter.</p></li></ul></li></ol><p>In addition to returning a result code, your handler can return an error string in the <code>keyErrorString</code> parameter of the reply Apple event. Your handler should provide meaningful text in the <code>keyErrorString</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_347"></a> parameter, so that the client can display this string to the user if desired.</p><p><span class="content_text">Listing 5-3</span> shows a function that adds a parameter, from a string reference that refers to Unicode text, to a passed descriptor. You pass the desired keyword to identify the parameter to add. The <code>AEPutParamString</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_348"></a> function calls <code>AEPutParamPtr</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_349"></a>, which adds a parameter to an Apple event record or an Apple event, so those are the types of descriptors you should pass to it. (<span class="content_text"><a href="../building_aes_aepg/building_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH203-BEJJGABC">“Descriptors, Descriptor Lists, and Apple Events”</a></span> describes the inheritance relationship between common Apple event data types.)</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGDDABA" title="Listing 5-3A function that adds a string parameter to a descriptor"></a><p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>A function that adds a string parameter to a descriptor</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr AEPutParamString(AppleEvent *event,<span></span></pre></td></tr><tr><td scope="row"><pre>                    AEKeyword keyword, CFStringRef stringRef)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt8 *textBuf;<span></span></pre></td></tr><tr><td scope="row"><pre>    CFIndex length, maxBytes, actualBytes;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    length = CFStringGetLength(stringRef);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    maxBytes = CFStringGetMaximumSizeForEncoding(length,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kCFStringEncodingUTF8);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    textBuf = malloc(maxBytes);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    if (textBuf)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        CFStringGetBytes(stringRef, CFRangeMake(0, length),<span></span></pre></td></tr><tr><td scope="row"><pre>                kCFStringEncodingUTF8, 0, true,<span></span></pre></td></tr><tr><td scope="row"><pre>                (UInt8 *) textBuf, maxBytes, &amp;actualBytes);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        OSErr err = AEPutParamPtr(event, keyword,<span></span></pre></td></tr><tr><td scope="row"><pre>                typeUTF8Text, textBuf, actualBytes);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        free(textBuf);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        return err;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return memFullErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s a description of how this function works:</p><ol class="ol"><li class="li"><p>It receives a pointer to a descriptor to add a parameter to, a key word to identify the parameter, and a string reference from which to obtain the text for the parameter.</p></li><li class="li"><p>It gets the length of the string from the passed reference.</p></li><li class="li"><p>It determines the maximum number of bytes needed to store the text, based on its encoding.</p></li><li class="li"><p>It allocates a buffer of that size.</p></li><li class="li"><p>It gets the text from the string reference.</p></li><li class="li"><p>It adds the text as a parameter to the passed descriptor. (If called with the keyword <code>keyErrorString</code>, for example, it adds an error string parameter.)</p></li><li class="li"><p>It frees its local buffer.</p></li></ol><p><span class="content_text">Listing 5-4</span> shows how you could call <code>AEPutParamString</code> to add an error string to a reply Apple event.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGHEBCJ" title="Listing 5-4Adding an error string to an Apple event with AEPutParamString"></a><p class="codesample"><strong>Listing 5-4&nbsp;&nbsp;</strong>Adding an error string to an Apple event with AEPutParamString</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef errStringRef = getLocalizedErrMsgForErrNumber(err);<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr anErr = AEPutParamString(reply, keyErrorString, errStringRef);<span></span></pre></td></tr></table></div><p>Here’s a description of how this code snippet works:</p><ol class="ol"><li class="li"><p>It calls an application-defined function to obtain a localized error message as a string reference, based on a passed error number. (For information on localized strings, see <span class="content_text"><a href="../../../../CoreFoundation/Conceptual/CFBundles/Tasks/working.html#//apple_ref/doc/uid/20001126" target="_top">Working With Localized Strings</a></span> in <em><a href="../../../../CoreFoundation/Conceptual/CFBundles/index.html#//apple_ref/doc/uid/10000123i" target="_top">Bundle Programming Guide</a></em>.)</p></li><li class="li"><p>It calls <code>AEPutParamString</code>, passing the event (obtained previously) to add the error text to, the error string keyword, and the string reference for the error message text.<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_350"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGJDHBE" title="A Handler for the Open Documents Apple Event"></a><h3>A Handler for the Open Documents Apple Event</h3><p><span class="content_text">Listing 5-5</span> shows a handler that responds to the <code>open documents</code> Apple event<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_351"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_352"></a>.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGCCHDG" title="Listing 5-5An Apple event handler for the open documents event"></a><p class="codesample"><strong>Listing 5-5&nbsp;&nbsp;</strong>An Apple event handler for the open documents event</p><div class="codesample"><table><tr><td scope="row"><pre>static pascal OSErrOpenDocumentsAE(const AppleEvent *theAppleEvent, AppleEvent *reply, long handlerRefcon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    AEDescList  docList;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSRef       theFSRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        index;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        count = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       err = AEGetParamDesc(theAppleEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                            keyDirectObject, typeAEList, &amp;docList);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantGetDocList);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AECountItems(&amp;docList, &amp;count);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantGetCount);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for(index = 1; index &lt;= count; index++)<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = AEGetNthPtr(&amp;docList, index, typeFSRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL, NULL, &amp;theFSRef, sizeof(FSRef), NULL);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        require_noerr(err, CantGetDocDescPtr);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = OpenDocument(&amp;theFSRef);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    AEDisposeDesc(&amp;docList);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantGetDocList:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetCount:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetDocDescPtr:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr)<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // For handlers that expect a reply, add error information here.<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return(err);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s a description of how this <code>open documents</code> handler works:</p><ol class="ol"><li class="li"><p>It calls an Apple Event Manager function (<code>AEGetParamDesc</code>) to obtain a descriptor list from the direct object of the received Apple event. This is a list of file aliases, one for each document to open.</p></li><li class="li"><p>It uses the <code>require_noerr</code> macro (defined in <code>AssertMacros.h</code>) to jump to a labeled location as a simple form of error handling.</p></li><li class="li"><p>It calls an Apple Event Manager function (<code>AECountItems</code>) to obtain the number of items in the descriptor list.</p></li><li class="li"><p>It sets up a loop over the items in the descriptor list.</p></li><li class="li"><p>It calls an Apple Event Manager function (<code>AEGetNthPtr</code>) to get an item from the list, by index, asking for a type of <code>typeFSRef</code>. This causes the function to coerce the retrieved item (a file alias) to the requested type.</p></li><li class="li"><p>It calls a function you have written (<code>OpenDocument</code>) to open the current document from the list.</p><p>A <code>print documents</code> event handler would be very similar to this one, but in this step could call your <code>PrintDocument</code> function.</p></li><li class="li"><p>It disposes of the document list descriptor.</p></li><li class="li"><p>The <code>open documents</code> event sent by the Mac OS doesn’t expect a reply, so the <code>reply</code> parameter is a null event. For event handlers that expect a reply, this is where you can use the techniques described earlier in this chapter to add an error number or an error string. Some examples of events that expect a reply (and thus supply a non-null reply event) include <code>get data</code> events and <code>quit</code> events.</p></li><li class="li"><p>It returns an error code (<code>noErr</code> if no error has occurred).</p></li></ol><p>As an alternative to code shown in this handler, you might use an approach that extracts the document list in the event handler, then passes it to a separate function, <code>OpenDocuments</code>, to iterate over the items in the list. This has the advantage that you can also call the <code>OpenDocuments</code> function with the document list obtained from <code>NavDialogGetReply</code> when you are working with Navigation Services. The <code>selection</code> field of the returned <code>NavReplyRecord</code> is a descriptor list like the one described above<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_353"></a>.<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_354"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_355"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_356"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH206-BEJBDEGI" title="Handling Apple Events Sent by the Mac OS"></a><h2>Handling Apple Events Sent by the Mac OS</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_357"></a>Mac OS X sends Apple events to communicate with applications in certain common situations, such as when launching the application or asking it to open a list of documents. These events are sometimes referred to as the “required” events, although applications are not required to support all of them. For example, if your application isn’t document-based, it won’t support the <code>open documents</code> or <code>print documents</code> events. However, any application that presents a graphical user interface through the Human Interface Toolbox or the Cocoa application framework should respond to as many of these events as it makes sense for that application to support.</p><p>Carbon applications typically install Apple event handlers to handle these events, though in some cases a default handler may be installed automatically (as described in <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGFFJBB">“Common Apple Events Sent by the Mac OS”</a></span>).</p><p>For Cocoa applications, most of the work of responding to events sent by the Mac OS happens automatically, though in some cases applications may want to step in and modify the default behavior. For more details, including some information of general interest, see <span class="content_text"><a href="../../../../Cocoa/Conceptual/ScriptableCocoaApplications/SApps_handle_AEs/SAppsHandleAEs.html#//apple_ref/doc/uid/20001239" target="_top">How Cocoa Applications Handle Apple Events</a></span> in <em><a href="../../../../Cocoa/Conceptual/ScriptableCocoaApplications/index.html#//apple_ref/doc/uid/TP40002164" target="_top">Cocoa Scripting Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP40001449-CH206-CEGFFJBB" title="Common Apple Events Sent by the Mac OS"></a><h3>Common Apple Events Sent by the Mac OS</h3><p>The following are Apple events your application is likely to receive from the Mac OS. For information on the constants associated with these events, see <span class="content_text"><a href="../appendix2_aepg/appendix2_aepg.html#//apple_ref/doc/uid/TP40001449-CH212-CHDDDDFD">“Event ID Constants for Apple Events Sent by the Mac OS.”</a></span></p><ul class="spaceabove"><li class="li"><p><code>open application</code> (or <code>launch</code>)<a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_358"></a></p><p>Received when your application is launched. The application should perform any tasks required when a user launches it without opening or printing any existing documents, though it may of course open a new, untitled document.</p><p>Starting in Mac OS X version 10.4, an <code>open application</code> Apple event may contain information about whether the application was launched as a login item or as a service item. For details on working with this kind of information, see “Launch Apple Event Constants” in “Apple Event Manager Constants” in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p></li><li class="li"><p><code>reopen application</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_359"></a></p><p>Received when the application is reopened—for example, when the application is open but not frontmost, and the user clicks its icon in the Dock. The application should perform appropriate tasks—for example, it might create a new document if none is open.</p></li><li class="li"><p><code>open documents</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_360"></a></p><p>Received with a list of documents for the application to open. <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGCCHDG">Listing 5-5</a></span> shows a complete Apple event handler for this event.</p><p>Starting in Mac OS X version 10.4, the <code>open documents</code> Apple event may contain an optional parameter identified by the key <code>keyAESearchText</code>. If present, the parameter contains the search text from the Spotlight search that identified the documents to be opened. The application should make a reasonable effort to display an occurrence of the search text in each opened document—for example by scrolling text into view that contains all or part of the search text.</p></li><li class="li"><p><code>print documents</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_361"></a></p><p>Received with a list of documents for the application to print. You can obtain file system references to the items in the list using code like that you use when handling an <code>open documents</code> event. See <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGJDIJB">“Interacting With the User”</a></span> for information on when it is appropriate to display a dialog or perform other interaction.</p><p>Starting in Mac OS X version 10.3, the print documents event was extended to include an optional <code>print settings</code> parameter that defines the settings for the print job or jobs, and an optional <code>print dialog</code> parameter that specifies whether the application should display the Print dialog. By default, the application should not show the Print dialog if the caller doesn't specify a print dialog parameter. For details, see Technical Note TN2082, <span class="content_text"><a href="http://developer.apple.com/technotes/tn2002/tn2082.html" target="_top">The Enhanced Print Apple Event</a></span>.</p></li><li class="li"><p><code>open contents</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_362"></a></p><p>Available starting in Mac OS X version 10.4. Received when content, such as text or an image, is dropped on the application icon—for example, when a dragged image is dropped on the icon in the Dock.</p><p>The structure of this event is very similar to the <code>open documents</code> event. The direct object parameter consists of a list of content data items to be opened. The <code>descriptorType</code> for each item in the list indicates the type of the content (<code>'PICT'</code>, <code>'TIFF'</code>, <code>'utf8'</code>, and so on).</p><p>The application should use the content in an appropriate way—for example, if a document is open, it might insert the content at the current insertion point; if no document is open, it might open a new document and insert the provided text or image.</p><p>If your Carbon application provides a service that can accept the type of data in an <code>open contents</code> Apple event it receives, you can handle the event without even installing an event handler for it—a default handler will be installed, if one isn’t present, and invoked automatically. As a result, your service provider will receive a <code>{kEventClassService, kEventServicePerform}</code> Carbon event.</p><p>Because there is no way to return data from an <code>open contents</code> Apple event, the default handler only invokes a service that accepts the given data type but returns nothing.</p><p>If your application doesn’t support services, or if you want to provide special handling for the <code>open contents</code> Apple event, your application can install a handler for the event.</p><p>For information on working with services, see <em><a href="../../../../Carbon/Conceptual/appservices/index.html#//apple_ref/doc/uid/TP30000993" target="_top">Setting Up Your Carbon Application to Use the Services Menu</a></em>.</p></li><li class="li"><p><code>quit application</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_363"></a></p><p>Received when the application should quit. The application can perform any special operations required at that time.</p><p>If your application calls <code>RunApplicationEventLoop</code>, a simple <code>quit</code> handler is installed automatically. If you install your own handler, it can perform any required operations, then return <code>errAEEventNotHandled</code> so that the default handler continues quitting the application. If you return another error value, the application will not quit. However, your <code>quit</code> handler can call <code>QuitApplicationEventLoop</code>, which causes <code>RunApplicationEventLoop</code> to quit and return back to <code>main()</code>. In that case you can return <code>noErr</code> from your handler instead of <code>errAEEventNotHandled</code>.</p><p>If your application does not call <code>RunApplicationEventLoop</code>, you should supply your own <code>quit</code> handler.</p><p>You should not terminate your application from within a <code>quit</code> event handler. Instead, you should set a flag that you check outside the handler.</p></li><li class="li"><p><code>show preferences</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_364"></a></p><p>Received when the user chooses the Preferences menu item. Carbon applications that handle the Preferences command can install an Apple event handler for this event, but they more commonly install a Carbon event handler for <code>kEventCommandProcess</code> and check for the <code>kHICommandPreferences</code> command ID.</p></li><li class="li"><p><code>application died</code><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_365"></a></p><p>Received by an application that launched another application when the launched application quits or terminates. Your application can respond to the information that the other application is no longer running.</p></li></ul><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_44" title="Installing Handlers for Apple Events Sent by the Mac OS"></a><h3>Installing Handlers for Apple Events Sent by the Mac OS</h3><p><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_366"></a><span class="content_text">Listing 5-6</span> shows how your application installs handlers for various Apple events that are sent by the Mac OS. The listing assumes that you have defined the functions <code>OpenApplicationAE</code>, <code>ReopenApplicationAE</code>, <code>OpenDocumentsAE</code>, and <code>PrintDocumentsAE</code> to handle the Apple events <code>open application</code>, <code>reopen</code>, <code>open documents</code>, and <code>print documents</code>, respectively.</p><p>This function doesn’t install handlers for the <code>open contents</code> and <code>quit</code> Apple events, so the application will rely on the default handlers for those events (described previously in <span class="content_text"><a href="responding_aepg.html#//apple_ref/doc/uid/TP40001449-CH206-CEGFFJBB">“Common Apple Events Sent by the Mac OS”</a></span>).</p><a name="//apple_ref/doc/uid/TP40001449-CH206-BABGFDHC" title="Listing 5-6Installing event handlers for Apple events from the Mac OS"></a><p class="codesample"><strong>Listing 5-6&nbsp;&nbsp;</strong>Installing event handlers for Apple events from the Mac OS</p><div class="codesample"><table><tr><td scope="row"><pre>static  OSErr   InstallMacOSEventHandlers(void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err     = AEInstallEventHandler(kCoreEventClass, kAEOpenApplication,<span></span></pre></td></tr><tr><td scope="row"><pre>                NewAEEventHandlerUPP(OpenApplicationAE), 0, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantInstallAppleEventHandler);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err     = AEInstallEventHandler(kCoreEventClass, kAEReopenApplication,<span></span></pre></td></tr><tr><td scope="row"><pre>                NewAEEventHandlerUPP(ReopenApplicationAE), 0, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantInstallAppleEventHandler);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err     = AEInstallEventHandler(kCoreEventClass, kAEOpenDocuments,<span></span></pre></td></tr><tr><td scope="row"><pre>                NewAEEventHandlerUPP(OpenDocumentsAE), 0, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantInstallAppleEventHandler);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err     = AEInstallEventHandler(kCoreEventClass, kAEPrintDocuments,<span></span></pre></td></tr><tr><td scope="row"><pre>                NewAEEventHandlerUPP(PrintDocumentsAE), 0, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CantInstallAppleEventHandler);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantInstallAppleEventHandler:<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>For a description of the parameters you pass to the <code>AEInstallEventHandler</code> function, see <span class="content_text"><a href="../dispatch_aes_aepg/dispatch_aes_aepg.html#//apple_ref/doc/uid/TP40001449-CH204-BABJGCJG">“Installing Apple Event Handlers.”</a></span><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_367"></a><a name="//apple_ref/doc/uid/TP40001449-CH206-DontLinkElementID_368"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../data_in_ae_aepg/data_in_ae_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../create_send_aepg/create_send_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/AppleEvents/responding_aepg/responding_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/AppleEvents/responding_aepg/responding_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/AppleEvents/responding_aepg/responding_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>