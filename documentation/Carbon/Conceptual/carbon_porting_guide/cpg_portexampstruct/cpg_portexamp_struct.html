<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Carbon Porting Guide (Legacy): A Porting Example</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="A Porting Example"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000991-CH204" title="A Porting Example"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000494" target="_top">Carbon</a> &gt; <a href="../cpg_intro_struct/cpg_intro_struct.html#//apple_ref/doc/uid/TP30000991-CH201-TPXREF101">Carbon Porting Guide (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../cpg_buildstruct/cpg_build_struct.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../cpg_newtechstruct/cpg_newtech_struct.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF101" title="A Porting Example"></a><h1>A Porting Example</h1><p>This chapter details the process required to port a simple application to the Carbon interface. While this application is likely much simpler than your code, many of the steps are similar and you can use this example as a guideline for porting your own application. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-TPXREF120">The Sample Application</a>
				
			<br/>
			
        
			
			
				<a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-TPXREF121">Obtaining the Carbon Dater Report</a>
				
			<br/>
			
        
			
			
				<a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-TPXREF122">The Basic Port</a>
				
			<br/>
			
        
			
			
				<a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-TPXREF137">Additional Changes for Aqua</a>
				
			<br/>
			
        
			
			
				<a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-TPXREF141">The Carbon Version of Sample</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF120" title="The Sample Application"></a><h2>The Sample Application</h2><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_130"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_131"></a>The application used for this porting example is Sample (also known as TrafficLight), which is an old Mac OS demonstration program used to illustrate basic windowing and user interaction. </p><p>The original C code listing is also reproduced in <span class="content_text"><a href="../cpg_apdx_sampleapp/cpg_apdx_sample_app.html#//apple_ref/doc/uid/TP30000991-CH207-BIABHIDD">“The Sample Application.”</a></span></p><p>Sample puts up a small window containing a rudimentary traffic light which toggles between red and green when you click in the window or when you select a color from the Light menu. <span class="content_text"><a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-BBGBFDJG">Figure 3-1</a></span> shows the Sample application. </p><br/><div><a name="//apple_ref/doc/uid/TP30000991-CH204-BBGBFDJG" title="Figure 3-1The Sample application "></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>The Sample application </p><img src = "../Art/originaltrafficlit.gif" alt = "The Sample application" width="251" height="322"></div><br/><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF121" title="Obtaining the Carbon Dater Report"></a><h2>Obtaining the Carbon Dater Report</h2><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_132"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_133"></a>The first step in the porting process is to obtain a Carbon Dater report detailing what APIs will need to be changed or modified. <span class="content_text">Figure 3-2</span> shows the opening page of a Carbon Dater report on Sample. </p><br/><div><a name="//apple_ref/doc/uid/TP30000991-CH204-BBGDBJIB" title="Figure 3-2A Carbon Dater report"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong>A Carbon Dater report</p><img src = "../Art/cpg06.gif" alt = "A Carbon Dater report" width="341" height="334"></div><br/><p>Note that while the percentage of unsupported APIs seems high (33.3 %), this fraction corresponds to only 23 functions. Larger applications typically contain many more supported functions, often resulting in compatibility ratings of 90% or higher. </p><p><span class="content_text">Table 3-1</span> summarizes Carbon Dater’s comments about the incompatible functions. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-BBGDACHD" title="Table 3-1Carbon Dater output for incompatible functions "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Carbon Dater output for incompatible functions </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Manager</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Function Name </p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th></tr><tr><td  scope="row"><p>Memory Management Utilities</p></td><td ><p><code>SysEnvirons</code></p></td><td ><p>Uses working directories. Use <code>FindFolder</code> and <code>Gestalt</code> instead. </p></td></tr><tr><td  scope="row"><p>Memory Manager</p></td><td ><p><code>ApplicationZone</code></p></td><td ><p>Carbon does not support zones because they do not work in a preemptively multitasked environment. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>GetApplLimit</code></p></td><td ><p>Mac OS X applications have no size limit on their application partition. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>MaxApplZone</code></p></td><td ><p>This routine is not needed by PowerPC-based applications because they can specify a stack size in the <code>'cfrg' 0</code> resource. </p></td></tr><tr><td  scope="row"><p>Patch Manager</p></td><td ><p><code>NGetTrapAddress</code></p></td><td ><p>Patch Manager not supported in Carbon. </p></td></tr><tr><td  scope="row"><p>Disk Initialization Manager</p></td><td ><p><code>DIBadMount</code></p></td><td ><p>Carbon does not support the Disk Initialization Manager. Disk Initialization is supported by the system. Mac OS X applications that need to initialize disks can do so using new APIs in the I/OKit. </p></td></tr><tr><td  scope="row"><p>QuickDraw Manager</p></td><td ><p><code>InitGraf</code></p></td><td ><p>In Carbon, the Mac OS automatically initializes Quickdraw for every application. When the Mac OS initializes QuickDraw,  the Mac OS also automatically calls <code>InitGraf</code>. </p></td></tr><tr><td  scope="row"><p>Device Manager</p></td><td ><p><code>CloseDeskAcc</code></p></td><td ><p>Desk accessories not supported in Carbon.</p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>OpenDeskAcc</code></p></td><td ><p>Desk accessories not supported in Carbon. </p></td></tr><tr><td  scope="row"><p>Dialog Manager</p></td><td ><p><code>InitDialogs</code></p></td><td ><p><code>InitDialogs</code> is not supported in Carbon. There is no need to initialize the Dialog Manager as the shared library is loaded as needed. </p></td></tr><tr><td  scope="row"><p>Event Manager</p></td><td ><p><code>OSEventAvail</code></p></td><td ><p><code>OSEventAvail</code> is not supported in Carbon. Use the <code>EventAvail</code> function instead. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>SystemClick</code></p></td><td ><p>Desk accessories are not supported in Carbon. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>SystemTask</code></p></td><td ><p>In Carbon, the Event Manager automatically handles all task scheduling. </p></td></tr><tr><td  scope="row"><p>Menu Manager</p></td><td ><p><code>CheckItem</code></p></td><td ><p>Replaced by <code>CheckMenuItem</code>. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>DisableItem</code></p></td><td ><p>Replaced by <code>DisableMenuItem</code>. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>EnableItem</code></p></td><td ><p>Replaced by <code>EnableMenuItem</code>. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>InitMenus</code></p></td><td ><p><code>InitMenus</code> is not supported in Carbon. There is no need to initialize the Menu Manager because the shared library is loaded as needed. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>SystemEdit</code></p></td><td ><p>Carbon does not support desk accessories. </p></td></tr><tr><td  scope="row"><p>Window Manager</p></td><td ><p><code>CloseWindow</code></p></td><td ><p>The <code>CloseWindow</code> function is not supported because developers do not allocate their own memory for windows in Carbon. Use the <code>DisposeWindow</code> function to remove a window instead. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>InitWindows</code></p></td><td ><p><code>InitWindows</code> is not supported in Carbon. There is no need to initialize the Window Manager because the shared library is loaded as needed. </p></td></tr><tr><td  scope="row"><p></p></td><td ><p><code>InvalRect</code></p></td><td ><p>Calls <code>InvalWindowRect</code>, which takes a window pointer as an additional parameter. This change is necessary because invalidation works only on windows, not ports, and windows are not ports in Carbon. </p></td></tr><tr><td  scope="row"><p>Font Manager</p></td><td ><p><code>InitFonts</code></p></td><td ><p>There is no need to initialize the Font Manager because the shared library is loaded as needed.</p></td></tr><tr><td  scope="row"><p>TextEdit</p></td><td ><p><code>TEInit</code></p></td><td ><p>There is no need to initialize TextEdit because the shared library is loaded as needed. </p></td></tr></table></div><p>The Carbon Dater report indicates that many of the incompatible functions are either no longer needed or obsolete (such as those related to desk accessories), while others require just a replacement. There are only a few cases which might require some thoughtful workarounds. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF122" title="The Basic Port"></a><h2>The Basic Port</h2><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_134"></a>This section describes the initial steps of the porting process. For clarity, the subsection names parallel the porting steps described in <span class="content_text"><a href="../cpg_prepstruct/cpg_prep_struct.html#//apple_ref/doc/uid/TP30000991-CH202-TPXREF101">“Preparing Your Code for Carbon”</a></span></p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF123" title="Make Sure All of Your Code is PowerPC&acirc;&#128;&#147;Native"></a><h3>Make Sure All of Your Code is PowerPC–Native</h3><p>To qualify for this step, the Sample application should compile as a PowerPC executable, which it does. You can also make the following changes to clean up the code: </p><ul class="spaceabove"><li class="li"><p>Remove the <code>#pragma segment</code> statements. These statements indicate which segments should contain which parts of the code. PowerPC code does not use segments, so these are unnecessary. </p></li><li class="li"><p>Remove <code>UnloadSeg</code> calls in <code>Main</code> (2 instances). Again, these calls make sense only on 68K machines. </p></li><li class="li"><p>Remove the comment on segmentation strategy. </p></li><li class="li"><p>Remove the <code>TrapAvailable</code> function and all references to it. Because <code>WaitNextEvent</code> is always available on current systems, <code>TrapAvailable</code> is superfluous. Also, it relies on the <code>NGetTrapAddress</code> function, which is illegal in Carbon anyway, so you might as well get rid of it now. </p></li></ul><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF124" title="Update to the Current Universal Interfaces and Use the Carbon SDK"></a><h3>Update to the Current Universal Interfaces and Use the Carbon SDK</h3><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_135"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_136"></a>You must make sure that Sample compiles and runs using the latest version of Universal Interfaces, which should be included with the latest version of the Carbon SDK. The examples here assume you are building your code using Metrowerks CodeWarrior. The following changes are necessary to update to the latest headers:</p><ul class="spaceabove"><li class="li"><p>Remove <code>Desk.h</code> include statement and add <code>Devices.h</code> in both <code>Sample.c</code> and <code>SampleInit.c</code>. </p></li><li class="li"><p>Change name of <code>GetGlobalMouse</code> function in <code>Sample.c</code> and <code>Sample.h</code> to <code>MyGetGlobalMouse</code> (or something similar). The local function collides with the <code>GetGlobalMouse</code> function in <code>Events.h</code>. </p></li><li class="li"><p>Remove the reference to <code>_DataInit</code> in <code>main</code> and its external declaration. This function (part of the MPW runtime library) initializes global data on 68K machines. </p></li></ul><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF125" title="Target Mac OS 8 and 9 First"></a><h3>Target Mac OS 8 and 9 First</h3><p>This guideline requires you to focus on building a CFM-based Carbon application (at least initially), rather than a Mach-O–based one. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF126" title="Begin With CarbonAccessors.o"></a><h3>Begin With CarbonAccessors.o</h3><p>This step is probably the most tedious as it requires you to inspect your code for data structure access that will become illegal in Carbon. </p><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_137"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_138"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_139"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_140"></a>First, add the object file <code>CarbonAccessors.o</code> to your CodeWarrior project. </p><p>Then add <code>#define ACCESSOR_CALLS_ARE_FUNCTIONS 1</code> to the beginning of <code>Sample.c</code> and <code>SampleInit.c</code>. With this setting in place, the compiler generates errors indicating places where you need to add accessor functions.</p><p>If you don’t mind seeing additional compile errors initially, you can also add <code>#define OPAQUE_TOOLBOX_STRUCTS 1</code>. The compiler will then generate errors if it detects attempts to directly access fields of the now opaque structures. You can use this error list to identify places where you need to modify the code to use accessor functions. </p><p>For example, after setting both conditionals, CodeWarrior generates errors such as the following when attempting to compile <code>Sample.c</code>: </p><div class="codesample"><table><tr><td scope="row"><pre>Error   : cannot convert<span></span></pre></td></tr><tr><td scope="row"><pre>'struct OpaqueWindowPtr *' to<span></span></pre></td></tr><tr><td scope="row"><pre>'struct OpaqueGrafPtr *'<span></span></pre></td></tr><tr><td scope="row"><pre>Sample.c line 224   SetPort(window);    /* the window must be the current port... */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Error   : illegal use of incomplete struct/union/class 'struct OpaqueWindowPtr'<span></span></pre></td></tr><tr><td scope="row"><pre>Sample.c line 225   EraseRect(&amp;window->portRect); /* because of a bug in ZoomWindow */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Error   : illegal use of incomplete struct/union/class 'struct OpaqueWindowPtr'<span></span></pre></td></tr><tr><td scope="row"><pre>Sample.c line 227   InvalRect(&amp;window->portRect); /* to make things look better on-screen */<span></span></pre></td></tr></table></div>	<p>The code indicated by the errors (contained in the function <code>DoEvent</code>) is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre>    case inZoomIn:<span></span></pre></td></tr><tr><td scope="row"><pre>    case inZoomOut:<span></span></pre></td></tr><tr><td scope="row"><pre>        hit = TrackBox(window, event->where, part);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( hit ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            SetPort(window);/* window must be the current port */<span></span></pre></td></tr><tr><td scope="row"><pre>            EraseRect(&amp;window->portRect);   /* because of a bug in ZoomWindow */<span></span></pre></td></tr><tr><td scope="row"><pre>            ZoomWindow(window, part, true); /* note that we invalidate and erase... */<span></span></pre></td></tr><tr><td scope="row"><pre>            InvalRect(&amp;window->portRect);   /* to make things look better on-screen */<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr></table></div>	<p>You must use an accessor to obtain the contents of the <code>window.portRect</code> field, and then you must cast the window pointer to a graphics pointer (<code>GrafPtr</code>) before setting the port. For more information about available accessor functions and how to use them, see <span class="content_text"><a href="../cpg_apdx_func/cpg_apdx_funcs.html#//apple_ref/doc/uid/TP30000991-CH206-BAACHCEC">“Functions for Accessing Opaque Data Structures.”</a></span> </p><p>After the required changes, the code might look something like this: </p><div class="codesample"><table><tr><td scope="row"><pre>    …<span></span></pre></td></tr><tr><td scope="row"><pre>    case inZoomIn:<span></span></pre></td></tr><tr><td scope="row"><pre>    case inZoomOut:<span></span></pre></td></tr><tr><td scope="row"><pre>        hit = TrackBox(window, event->where, part);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( hit ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            Rect portRect;              /*•• new variable to hold the value of  */<span></span></pre></td></tr><tr><td scope="row"><pre>                                        /*•• the portRect field of window.      */<span></span></pre></td></tr><tr><td scope="row"><pre>            GetPortBounds(GetWindowPort(window), &amp;portRect); /*•• new accessor added */<span></span></pre></td></tr><tr><td scope="row"><pre>            SetPort(GetWindowPort(window));/*•• The windowPtr is now cast to */<span></span></pre></td></tr><tr><td scope="row"><pre>                                         /*•• a GrafPtr before setting */<span></span></pre></td></tr><tr><td scope="row"><pre>            EraseRect(&amp;portRect);           /* because of a bug in ZoomWindow */<span></span></pre></td></tr><tr><td scope="row"><pre>            ZoomWindow(window, part, true); /* note that we invalidate and erase... */<span></span></pre></td></tr><tr><td scope="row"><pre>            InvalRect(&amp;portRect);           /* to make things look better on-screen */<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr></table></div>	<p>Note that the event record (referenced in a parameter for <code>TrackBox</code>) is not opaque. This is one of the few Carbon structures that remains accessible without accessors. </p><p>You also need to add accessor functions to the following functions:</p><ul class="spaceabove"><li class="li"><p><code>DoEvent</code>: add an accessor to obtain the <code>screenbits</code> field of the <code>QDGlobals</code> structure. </p></li><li class="li"><p><code>AdjustCursor</code> : add accessors to obtain the port bounds, the visible region, and the arrow field of the <code>QDGlobals</code> structure. Instead of attempting to get the <code>portBits</code> field of the window port and setting the global origin from that, you can obtain the local port bounds, translate them to global coordinates, and set the origin to the upper left corner of those bounds. Also, you must allocate (and afterwards dispose of) a region handle to hold the visible region obtained by the accessor. </p></li><li class="li"><p><code>DoUpdate</code>: Add an accessor to obtain the visible region. </p></li><li class="li"><p><code>DrawWindow</code>: Convert the Window pointer to type <code>GrafPtr</code> before setting the port. </p></li><li class="li"><p><code>SetLight</code>: Add an accessor to obtain the port bounds. </p></li><li class="li"><p><code>DoCloseWindow</code>: You would normally want to use an accessor to obtain the <code>windowKind</code> field, but the function using it is <code>CloseDeskAcc</code>, which is not supported in Carbon anyway. So the simplest thing to do is to eliminate the code that handles the desk accessory case altogether. </p></li><li class="li"><p><code>IsAppWindow</code>: Add an accessor to obtain the window kind. </p></li><li class="li"><p><code>IsDAWindow</code>: Normally you would use an accessor to obtain the window kind, but because the entire function is useful only for desk accessories, it is simpler to remove it altogether. </p></li><li class="li"><p><code>AlertUser</code>: Add an accessor to obtain the arrow field of the <code>QDGlobals</code> structure. </p></li><li class="li"><p><code>Initialize</code> (in<code> SampleInit.c</code>): Instead of determining the size of a window record in order to allocate space for a new window, you can leave these lines out entirely, because the need to preallocate memory for windows has not been an issue for some time. Note that instead of calling <code>GetNewWindow</code>, you could call <code>CreateNewWindow</code>, which is the suggested replacement for window creation on Mac OS 8.5 and later. </p></li></ul><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF127" title="Use Casting Functions to Convert DialogPtrs and WindowPtrs"></a><h3>Use Casting Functions to Convert DialogPtrs and WindowPtrs</h3><p>Use the <code>GetWindowPort</code> function to convert window pointers to graphics pointers in the following functions, if you have not already done so: <code>DoEvent</code>, <code>AdjustCursor</code>, <code>DrawWindow</code>, and <code>SetLight</code>.</p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF128" title="Modify or Conditionalize Your Headers"></a><h3>Modify or Conditionalize Your Headers</h3><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_141"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_142"></a>To allow compilation on both Mac OS X and Mac OS 8 and 9, replace the usual header includes with the following:</p><div class="codesample"><table><tr><td scope="row"><pre>#define MAC_OS_X_BUILD 0<span></span></pre></td></tr><tr><td scope="row"><pre>#if MAC_OS_X_BUILD<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon/Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>#else<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr></table></div><p>To build on Mac OS X, you would set the <code>MAC_OS_X_BUILD</code> flag to <code>1</code>(true). </p><p>Note that <code>Carbon.h</code> is not required; you could have included the usual Mac OS 8 and 9 headers instead. However, by including <code>Carbon.h</code>, you set the preprocessor directive</p><div class="codesample"><table><tr><td scope="row"><pre>#define TARGET_API_MAC_CARBON 1<span></span></pre></td></tr></table></div><p>(if it wasn’t already defined) which sets the previous directives (<code>ACCESSOR_CALLS_ARE_FUNCTIONS</code> and <code>OPAQUE_TOOLBOX_STRUCTS</code> ) as well. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF129" title="Replace Macro Calls to the Mixed Mode Manager With UPP Accessor Functions"></a><h3>Replace Macro Calls to the Mixed Mode Manager With UPP Accessor Functions</h3><p>Sample does not use universal procedure pointers, so this step is unnecessary. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF143" title="Move Custom Definition Procedures Out of Resources"></a><h3>Move Custom Definition Procedures Out of Resources</h3><p>Sample uses no custom definition functions, so you can skip this step.</p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF130" title="Remove Direct Access to Low-Memory Globals"></a><h3>Remove Direct Access to Low-Memory Globals</h3><p>Sample does not access any low-memory globals, so you can skip this step as well. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF131" title="Use DebuggingCarbonLib"></a><h3>Use DebuggingCarbonLib</h3><p>During development, it’s usually useful to keep the debugging version of <code>CarbonLib</code> in your Extensions folder instead of the standard <code>CarbonLib</code>. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF132" title="Update Modified or Obsolete Functions"></a><h3>Update Modified or Obsolete Functions</h3><p>Using the information obtained from Carbon Dater, you can now add the required replacements or modifications for Carbon compatibility. First, remove <code>CarbonAccessors.o</code> and <code>InterfaceLib</code> from your link path and begin linking exclusively against <code>CarbonLibStub</code>.</p><p>Any attempts to build Sample at this stage will generate linker errors for any functions that are not available in Carbon. You can use the linker errors and the Carbon Dater report as guides for making the following changes:</p><ul class="spaceabove"><li class="li"><p>In <code>main</code>: Remove <code>MaxApplZone</code> as it’s not needed in PowerPC applications. </p></li><li class="li"><p>In <code>DoEvent</code>:</p><p>Remove <code>SystemClick</code>, which is specific to desk accessories.</p><p>Replace <code>InvalRect</code> with <code>InvalWindowRect</code>. Note that <code>InvalWindowRect</code> takes an additional window pointer as a parameter. </p><p>Remove <code>DIBadMount</code>. This function is hardware-specific. If you want to reproduce its functionality on Mac OS X, you must use the I/O Kit API to do so. Actually, because Carbon does not support the <code>diskEvt</code> event , you can remove this particular case altogether. The Carbon Event Manager will provide support for disk and volume events. </p></li><li class="li"><p>In <code>SetLight</code>: Replace <code>InvalRect</code> with <code>InvalWindowRect</code>.</p></li><li class="li"><p>In <code>DoMenuCommand</code>: </p><p>Remove <code>SystemEdit</code> because it’s specific to desk accessories. </p><p>Remove <code>OpenDeskAcc</code> because, again, Carbon doesn’t support desk accessories. </p></li><li class="li"><p>In <code>DoCloseWindow</code>: Replace <code>CloseWindow</code> with <code>DisposeWindow</code>. </p></li><li class="li"><p>In <code>AdjustMenus</code>: </p><p>Replace <code>EnableItem</code> with <code>EnableMenuItem</code>.</p><p>Replace <code>CheckItem</code> with <code>CheckMenuItem</code>. </p><p>Normally you would replace <code>DisableItem</code> with <code>DisableMenuItem</code>. Here, <code>DisableItem</code> is used only in the desk accessory case, which will never occur. Therefore, you can remove all instances of <code>DisableItem</code> as well as the conditional to distinguish between the traffic light window and desk accessories. </p></li><li class="li"><p>In <code>EventLoop</code>: Remove the <code>SystemTask</code> function as it is not needed in Carbon. Actually, because <code>WaitNextEvent</code> is guaranteed to be present, you can remove the conditional altogether. </p></li><li class="li"><p>In <code>MyGetGlobalMouse</code>: Change <code>OSEventAvail</code> to <code>EventAvail</code>.</p></li><li class="li"><p>In <code>Initialize</code>:</p><p>Remove initialization functions <code>InitGraf</code>, <code>InitFonts</code>, <code>InitWindows</code>, <code>InitMenus</code>, <code>TEInit</code>, and <code>InitDialogs</code>, as they are not needed in Carbon. </p><p>Remove the <code>SysEnvirons</code> function, which is not supported in Carbon. This function is part of a check to see if <code>WaitNextEvent</code> is available. Because <code>WaitNextEvent</code> is always available in Carbon, you can remove all of the code associated with this check, which eliminates the unsupported functions. </p><p>Remove <code>GetApplLimit</code> and <code>ApplicationZone</code> as they are not supported in Carbon. </p></li></ul><p>In addition, it turns out that the <code>WaitNextEvent</code> time <code>LONG_MAX</code> (referenced in the <code>EventLoop</code> function) is not defined in Carbon. You can replace it with 0x7FFFFFFF because there are no periodic actions that need to be taken.. </p><p>After making these changes, your version of Sample should be able to run on Mac OS 8 and 9 using the <code>CarbonLib</code> extension.</p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF133" title="Adopt Required Carbon Technologies"></a><h3>Adopt Required Carbon Technologies</h3><p>Sample does not require interfaces for printing or saving files, so this step is unnecessary. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF134" title="Add a &acirc;&#128;&#152;plst&acirc;&#128;&#153; 0 Resource"></a><h3>Add a ‘plst’ 0 Resource</h3><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_143"></a>To ensure that Sample will launch as a Carbon application on the Mac OS X and not in the Classic environment, you must add a resource of type <code>'plst'</code> with ID 0 to the resource file <code>TCSample.rsrc</code>. To add this resource, you can either modify the resource file directly using an editor such as ResEdit or Resourcerer, or you can DeRez the file, add text defining the resource, and then recompile the resource file. A minimal <code>'plst'</code> resource entry would be as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>data 'plst' (0) {<span></span></pre></td></tr><tr><td scope="row"><pre>    $"00"               /* . */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF135" title="Conditionalize Quit Menu Items"></a><h3>Conditionalize Quit Menu Items</h3><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_144"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_145"></a><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_146"></a>To make sure that Sample can quit properly in Mac OS X, you must add a Quit Apple event handler to <code>SampleInit.c</code> such as the following:</p><div class="codesample"><table><tr><td scope="row"><pre>/* Here is our Quit Apple event handler */<span></span></pre></td></tr><tr><td scope="row"><pre>static pascal OSErr QuitAppleEventHandler (const AppleEvent *appleEvt,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     AppleEvent* reply, UInt32 refcon)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Terminate(); /* close window and terminate gracefully */<span></span></pre></td></tr><tr><td scope="row"><pre>} /* QuitAppleEventHandler */<span></span></pre></td></tr></table></div><p>To install the handler, you must call <code>AEInstallEventHandler</code> in the <code>Initialize</code> function:</p><div class="codesample"><table><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>err = AEInstallEventHandler( kCoreEventClass, kAEQuitApplication,<span></span></pre></td></tr><tr><td scope="row"><pre>                 NewAEEventHandlerUPP(QuitAppleEventHandler), 0, false );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr) ExitToShell();<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr></table></div><p>Note that the Apple event installer function requires one of the new UPP accessor functions, <code>NewAEEventHandlerUPP</code>. This accessor replaces the old macro <code>NewAEEventHandlerProc</code>. </p><p>In addition, you must add a case to the <code>DoEvent</code> function to process the event properly when it occurs. </p><div class="codesample"><table><tr><td scope="row"><pre>void DoEvent (EventRecord *event)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Add a case to process the Quit Apple event */<span></span></pre></td></tr><tr><td scope="row"><pre>        case kHighLevelEvent:<span></span></pre></td></tr><tr><td scope="row"><pre>            AEProcessAppleEvent( event );<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_147"></a>After installing the handler, you must adjust the Quit menu item depending on whether Sample is running on Mac OS X or on Mac OS 8 and 9. Because the Quit item appears automatically in the application menu on Mac OS X, you should add code to the <code>Initialize</code> function to remove the Quit item from the File menu (where it normally appears for Mac OS 8 and 9) if Sample is running on Mac OS X:</p><div class="codesample"><table><tr><td scope="row"><pre>…<span></span></pre></td></tr><tr><td scope="row"><pre>    SetMenuBar(menuBar);                /* install menus */<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeHandle(menuBar);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• New code begins here */<span></span></pre></td></tr><tr><td scope="row"><pre>long result;<span></span></pre></td></tr><tr><td scope="row"><pre>MenuRef menu;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = Gestalt(gestaltMenuMgrAttr, &amp;result);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!err &amp;&amp; (result &amp; gestaltMenuMgrAquaLayoutMask)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        menu = GetMenuHandle (mFile);<span></span></pre></td></tr><tr><td scope="row"><pre>        DeleteMenuItem(menu, iQuit);<span></span></pre></td></tr><tr><td scope="row"><pre>        DeleteMenuItem(menu, iQuit-1); /* the element above the Quit */<span></span></pre></td></tr><tr><td scope="row"><pre>                                        /* item is a separator */<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• End of new code */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    DrawMenuBar();<span></span></pre></td></tr><tr><td scope="row"><pre>…<span></span></pre></td></tr></table></div><p>This snippet uses <code>Gestalt</code> to get the Menu Manager attributes and checks to see if the Aqua interface is present. If it is, then Sample running on Mac OS X. It then simply deletes the Quit item and its separator from the menu bar before it gets drawn. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF136" title="Cleanup"></a><h3>Cleanup</h3><p>At this point the Sample application should run on both Mac OS X and Mac OS 8 and 9. However, you can remove a few extraneous bits of code to clean up Sample:</p><ul class="spaceabove"><li class="li"><p>Remove all references to the variable <code>gMac</code>, which was only used in the (now nonexistent) <code>SysEnvirons</code> call. </p></li><li class="li"><p>Remove the <code>gHasWaitNextEvent</code> flag. Because <code>WaitNextEvent</code> is always available in Carbon, this flag is unnecessary. </p></li></ul><p>If desired, you can now use the same code to build a Mach-O–based version of Sample which can run only on Mac OS X.</p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF137" title="Additional Changes for Aqua"></a><h2>Additional Changes for Aqua</h2><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_148"></a>While the Carbon version of Sample now executes on Mac OS X, it is also important that the application adheres to the new Aqua interface. Here are a few additional changes you can make to adopt the Aqua look and feel.</p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF139" title="Adjust the Window Size"></a><h3>Adjust the Window Size</h3><p>Due to the placement of the three Aqua buttons in each window (the close, minimize, and zoom buttons) and the small default size of Sample’s window, the title, Traffic, is truncated. To work around this, you can increase the dimensions of the window and avoid truncation. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF140" title="Modify the About Box"></a><h3>Modify the About Box</h3><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_149"></a>About boxes in Mac OS X have a consistent appearance that is different from what you may be used to in Mac OS 8 and 9. They should be modeless dialogs that contain the application icon as well as informative text. <span class="content_text">Figure 3-3</span> shows an About box created for Sample. </p><br/><div><a name="//apple_ref/doc/uid/TP30000991-CH204-BBGIBDJH" title="Figure 3-3The About box for Sample "></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>The About box for Sample </p>&lt;IMAGE&gt;</div><br/><p>See <em>Inside Mac OS X: Aqua Human Interface Guidelines</em> for the full specifications for the About box. </p><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF141" title="The Carbon Version of Sample"></a><h2>The Carbon Version of Sample</h2><p><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_150"></a><span class="content_text"><a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-BBGCEAAG">Listing 3-1</a></span> and <span class="content_text"><a href="cpg_portexamp_struct.html#//apple_ref/doc/uid/TP30000991-CH204-BBGBCAAD">Listing 3-2</a></span> show the Sample application now ported to Carbon. Changes related to the porting process are indicated by “••” in comments <code>/*•• just like this */</code>. Some discussion comments were removed for clarity.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000991-CH204-DontLinkElementID_5" title="Note"></a><p><strong>Note:</strong>&nbsp;The section <span class="content_text"><a href="../cpg_newtechstruct/cpg_newtech_struct.html#//apple_ref/doc/uid/TP30000991-CH205-BABBFCCI">“An Example: Adding Carbon Events to Sample”</a></span> describes how to modify Sample to use the Carbon Event Manager. </p></div><br/><div><a name="//apple_ref/doc/uid/TP30000991-CH204-TPXREF142" title="Figure 3-4The Carbon version of Sample on Mac OS X"></a><p><strong>Figure 3-4&nbsp;&nbsp;</strong>The Carbon version of Sample on Mac OS X</p>&lt;IMAGE&gt;</div><br/><a name="//apple_ref/doc/uid/TP30000991-CH204-BBGCEAAG" title="Listing 3-1Carbon version of Sample.c "></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>Carbon version of Sample.c </p><div class="codesample"><table><tr><td scope="row"><pre>//#define ACCESSOR_CALLS_ARE_FUNCTIONS 1 /*•• leftovers from the porting process */<span></span></pre></td></tr><tr><td scope="row"><pre>//#define OPAQUE_TOOLBOX_STRUCTS 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define TARGET_API_MAC_CARBON 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAC_OS_X_BUILD  0<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• use only one include for all Carbon headers */<span></span></pre></td></tr><tr><td scope="row"><pre>#if MAC_OS_X_BUILD<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon/Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>    #else<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>        #endif<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include "Sample.h      "/* bring in all the #defines for Sample */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* The "g" prefix is used to emphasize that a variable is global. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• removed gMac and gHasWaitNextEvent global variables, as they are never used */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GInBackground is maintained by our osEvent handling routines. Any part of<span></span></pre></td></tr><tr><td scope="row"><pre>   the program can check it to find out if it is currently in the background. */<span></span></pre></td></tr><tr><td scope="row"><pre>Boolean     gInBackground;      /* maintained by Initialize and DoEvent */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* The following globals are the state of the window. If we supported more than<span></span></pre></td></tr><tr><td scope="row"><pre>   one window, they would be attached to each document, rather than globals. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GStopped tells whether the stop light is currently on stop or go. */<span></span></pre></td></tr><tr><td scope="row"><pre>Boolean     gStopped;           /* maintained by Initialize and SetLight */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GStopRect and gGoRect are the rectangles of the two stop lights in the window. */<span></span></pre></td></tr><tr><td scope="row"><pre>Rect        gStopRect;          /* set up by Initialize */<span></span></pre></td></tr><tr><td scope="row"><pre>Rect        gGoRect;            /* set up by Initialize */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Define TopLeft and BotRight macros for convenience. Notice the implicit<span></span></pre></td></tr><tr><td scope="row"><pre>   dependency on the ordering of fields within a Rect */<span></span></pre></td></tr><tr><td scope="row"><pre>#define TopLeft(aRect)  (* (Point *) &amp;(aRect).top)<span></span></pre></td></tr><tr><td scope="row"><pre>#define BotRight(aRect) (* (Point *) &amp;(aRect).bottom)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• Removed _DataInit, which is 68K-specific */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void main()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• Removed UnloadSeg call, which is 68K-specific */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* 1.01 - call to ForceEnvirons removed */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed MaxApplZone as it's not needed in PowerPC apps */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Initialize();                   /* initialize the program */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed UnloadSeg call, which is 68K-specific */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    EventLoop();                    /* call the main event loop */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*main*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void EventLoop()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    RgnHandle   cursorRgn;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     gotEvent;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord event;<span></span></pre></td></tr><tr><td scope="row"><pre>    Point       mouse;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    cursorRgn = NewRgn();   /* we’ll pass WNE an empty region the 1st time thru */<span></span></pre></td></tr><tr><td scope="row"><pre>    do {<span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• WNE is always available in Carbon, so the conditional was removed. */<span></span></pre></td></tr><tr><td scope="row"><pre>        MyGetGlobalMouse(&amp;mouse);<span></span></pre></td></tr><tr><td scope="row"><pre>        AdjustCursor(mouse, cursorRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Note wait period LONG_MAX not defined in Carbon. Replaced with 0x7FFFFFFF */<span></span></pre></td></tr><tr><td scope="row"><pre>        gotEvent = WaitNextEvent(everyEvent, &amp;event, 0x7FFFFFFF, cursorRgn);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ( gotEvent ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            /* make sure we have the right cursor before handling the event */<span></span></pre></td></tr><tr><td scope="row"><pre>            AdjustCursor(event.where, cursorRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>            DoEvent(&amp;event);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        /*  If you are using modeless dialogs that have editText items,<span></span></pre></td></tr><tr><td scope="row"><pre>            you will want to call IsDialogEvent to give the caret a chance<span></span></pre></td></tr><tr><td scope="row"><pre>            to blink, even if WNE/GNE returned FALSE. However, check FrontWindow<span></span></pre></td></tr><tr><td scope="row"><pre>            for a non-NIL value before calling IsDialogEvent. */<span></span></pre></td></tr><tr><td scope="row"><pre>    } while ( true );   /* loop forever; we quit via ExitToShell */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*EventLoop*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DoEvent(EventRecord *event)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       part, err;<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowPtr   window;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     hit;<span></span></pre></td></tr><tr><td scope="row"><pre>    char        key;<span></span></pre></td></tr><tr><td scope="row"><pre>    Point       aPoint;<span></span></pre></td></tr><tr><td scope="row"><pre>    BitMap screenBits;      /*•• needed to hold contents of qd.screenBits */<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect bounds, portRect;  /*•• needed to hold contents of screenbits.bounds and */<span></span></pre></td></tr><tr><td scope="row"><pre>                            /*•• the value of the portRect field of the window rec */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch ( event->what ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case mouseDown:<span></span></pre></td></tr><tr><td scope="row"><pre>            part = FindWindow(event->where, &amp;window);<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( part ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                case inMenuBar:         /* process a mouse menu command (if any) */<span></span></pre></td></tr><tr><td scope="row"><pre>                    AdjustMenus();<span></span></pre></td></tr><tr><td scope="row"><pre>                    DoMenuCommand(MenuSelect(event->where));<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case inSysWindow:   /*•• removed SystemClick (not part of Carbon) */<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case inContent:<span></span></pre></td></tr><tr><td scope="row"><pre>                    if ( window != FrontWindow() ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        SelectWindow(window);<span></span></pre></td></tr><tr><td scope="row"><pre>                        /*DoEvent(event);*/ /* use this line for "do first click" */<span></span></pre></td></tr><tr><td scope="row"><pre>                    } else<span></span></pre></td></tr><tr><td scope="row"><pre>                        DoContentClick(window);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case inDrag:        /* pass screenBits.bounds to get all gDevices */<span></span></pre></td></tr><tr><td scope="row"><pre>                    GetQDGlobalsScreenBits(&amp;screenBits); /*•• use accessor to obtain */<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        /*•• screenBits */<span></span></pre></td></tr><tr><td scope="row"><pre>                    bounds = screenBits.bounds; /*•• get bounds from screenBits.*/<span></span></pre></td></tr><tr><td scope="row"><pre>                                            /*•• Note that bitmaps are not opaque */<span></span></pre></td></tr><tr><td scope="row"><pre>                    DragWindow(window, event->where, &amp;bounds);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case inGrow:<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case inZoomIn:<span></span></pre></td></tr><tr><td scope="row"><pre>                case inZoomOut:<span></span></pre></td></tr><tr><td scope="row"><pre>                    hit = TrackBox(window, event->where, part);<span></span></pre></td></tr><tr><td scope="row"><pre>                    if ( hit ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        /*•• new accessor in place */<span></span></pre></td></tr><tr><td scope="row"><pre>                        GetPortBounds(GetWindowPort(window), &amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        /*•• The windowPtr is now cast to a GrafPtr before setting */<span></span></pre></td></tr><tr><td scope="row"><pre>                        SetPort(GetWindowPort(window));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        EraseRect(&amp;portRect);   /* because of a bug in ZoomWindow */<span></span></pre></td></tr><tr><td scope="row"><pre>                        ZoomWindow(window, part, true); /* note that we invalidate */<span></span></pre></td></tr><tr><td scope="row"><pre>                                                /* and erase...to make things look */<span></span></pre></td></tr><tr><td scope="row"><pre>                                                /* better on-screen */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                        /*•• InvalRect replaced with InvalWindowRect */<span></span></pre></td></tr><tr><td scope="row"><pre>                        InvalWindowRect(window, &amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre>                    }<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case keyDown:<span></span></pre></td></tr><tr><td scope="row"><pre>        case autoKey:                       /* check for menukey equivalents */<span></span></pre></td></tr><tr><td scope="row"><pre>            key = event->message &amp; charCodeMask;<span></span></pre></td></tr><tr><td scope="row"><pre>            if ( event->modifiers &amp; cmdKey )            /* Command key down */<span></span></pre></td></tr><tr><td scope="row"><pre>                if ( event->what == keyDown ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                    AdjustMenus();      /* enable/disable/check menu items properly */<span></span></pre></td></tr><tr><td scope="row"><pre>                    DoMenuCommand(MenuKey(key));<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case activateEvt:<span></span></pre></td></tr><tr><td scope="row"><pre>            DoActivate((WindowPtr) event->message,<span></span></pre></td></tr><tr><td scope="row"><pre>                        (event->modifiers &amp; activeFlag) != 0);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case updateEvt:<span></span></pre></td></tr><tr><td scope="row"><pre>            DoUpdate((WindowPtr) event->message);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Add a case to process the Quit Apple event */<span></span></pre></td></tr><tr><td scope="row"><pre>        case kHighLevelEvent:<span></span></pre></td></tr><tr><td scope="row"><pre>            AEProcessAppleEvent( event );<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Removed diskEvt case (and DIBadMount)--not supported in Carbon<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kOSEvent:<span></span></pre></td></tr><tr><td scope="row"><pre>        /*  1.02 - must BitAND with 0x0FF to get only low byte */<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ((event->message >> 24) &amp; 0x0FF) {   /* high byte of message */<span></span></pre></td></tr><tr><td scope="row"><pre>                case kSuspendResumeMessage: /* suspend/resume is also an activate/ */<span></span></pre></td></tr><tr><td scope="row"><pre>                                            /* deactivate */<span></span></pre></td></tr><tr><td scope="row"><pre>                    gInBackground = (event->message &amp; kResumeMask) == 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    DoActivate(FrontWindow(), !gInBackground);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoEvent*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void AdjustCursor(Point mouse, RgnHandle region)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowPtr   window;<span></span></pre></td></tr><tr><td scope="row"><pre>    RgnHandle   arrowRgn;<span></span></pre></td></tr><tr><td scope="row"><pre>    RgnHandle   plusRgn;<span></span></pre></td></tr><tr><td scope="row"><pre>    RgnHandle   visRgn; /*•• needed to hold field value obtained by accessor function */<span></span></pre></td></tr><tr><td scope="row"><pre>    Cursor      arrow; /*•• used to hold the contents of the qd.arrow field */<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect        globalPortRect, portRect;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    window = FrontWindow(); /* we only adjust the cursor when we are in front */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (! gInBackground) {  /*•• removed desk accessory case from conditional */<span></span></pre></td></tr><tr><td scope="row"><pre>        /* calculate regions for different cursor shapes */<span></span></pre></td></tr><tr><td scope="row"><pre>        arrowRgn = NewRgn();<span></span></pre></td></tr><tr><td scope="row"><pre>        plusRgn = NewRgn();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* start with a big, big rectangular region */<span></span></pre></td></tr><tr><td scope="row"><pre>        SetRectRgn(arrowRgn, kExtremeNeg, kExtremeNeg, kExtremePos, kExtremePos);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* calculate plusRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( IsAppWindow(window) ) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            Point tempPoint;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            SetPort(GetWindowPort(window)); /* make a global version of the viewRect */<span></span></pre></td></tr><tr><td scope="row"><pre>            /*•• Added accessor to cast WindowPtr to GrafPtr */<span></span></pre></td></tr><tr><td scope="row"><pre>            GetPortBounds (GetWindowPort(window), &amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre>            SetPt(&amp;tempPoint, portRect.left, portRect.top); /*•• obtain local origin */<span></span></pre></td></tr><tr><td scope="row"><pre>            LocalToGlobal(&amp;tempPoint); /*•• translate point to global coordinates */<span></span></pre></td></tr><tr><td scope="row"><pre>            SetOrigin(tempPoint.h, tempPoint.v); /*•• Set the global origin */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            /*•• Added accessor to get value for globalPortRect */<span></span></pre></td></tr><tr><td scope="row"><pre>            GetPortBounds(GetWindowPort(window), &amp;globalPortRect);<span></span></pre></td></tr><tr><td scope="row"><pre>            RectRgn(plusRgn, &amp;globalPortRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            visRgn = NewRgn();/*•• allocate a new region */<span></span></pre></td></tr><tr><td scope="row"><pre>            /*•• Added accessor to get value for visRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>            GetPortVisibleRegion(GetWindowPort(window), visRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>            SectRgn(plusRgn, visRgn, plusRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>            SetOrigin(0, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisposeRgn(visRgn);/*•• dispose of the region */<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* subtract other regions from arrowRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>            DiffRgn(arrowRgn, plusRgn, arrowRgn);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* change the cursor and the region parameter */<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( PtInRgn(mouse, plusRgn) ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                SetCursor(*GetCursor(plusCursor));<span></span></pre></td></tr><tr><td scope="row"><pre>                CopyRgn(plusRgn, region);<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>                SetCursor(GetQDGlobalsArrow(&amp;arrow)); /*•• new accessor in place */<span></span></pre></td></tr><tr><td scope="row"><pre>                CopyRgn(arrowRgn, region);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* get rid of our local regions */<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeRgn(arrowRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeRgn(plusRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*AdjustCursor*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• "My" added to GetGlobalMouse to avoid name collision with the function in Events.h */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void MyGetGlobalMouse(Point *mouse)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord event;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Changed OSEventAvail to EventAvail */<span></span></pre></td></tr><tr><td scope="row"><pre>    EventAvail(kNoEvents, &amp;event);  /* we aren't interested in any events */<span></span></pre></td></tr><tr><td scope="row"><pre>    *mouse = event.where;               /* just the mouse position */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*MyGetGlobalMouse*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DoUpdate(WindowPtr window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (IsAppWindow(window)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        RgnHandle  visRgn; /*•• needed to hold contents of window->visRgn */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        BeginUpdate(window);                /* this sets up the visRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>        visRgn = NewRgn();<span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Added accessor to obtain the visRgn */<span></span></pre></td></tr><tr><td scope="row"><pre>        GetPortVisibleRegion (GetWindowPort(window), visRgn);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( ! EmptyRgn(visRgn) )   /* draw if updating needs to be done */<span></span></pre></td></tr><tr><td scope="row"><pre>            DrawWindow(window);<span></span></pre></td></tr><tr><td scope="row"><pre>        EndUpdate(window);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoUpdate*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DoActivate(WindowPtr window, Boolean becomingActive)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (IsAppWindow(window)) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ( becomingActive )<span></span></pre></td></tr><tr><td scope="row"><pre>            /* do whatever you need to at activation */ ;<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            /* do whatever you need to at deactivation */ ;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoActivate*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DoContentClick(WindowPtr window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    SetLight(window, ! gStopped);<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoContentClick*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DrawWindow(WindowPtr window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect portRect; /*•• Needed to hold the contents of window->portRect */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetPort(GetWindowPort(window));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     /*•• Use accessor to obtain port bounds */<span></span></pre></td></tr><tr><td scope="row"><pre>    GetPortBounds(GetWindowPort(window), &amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    EraseRect(&amp;portRect);   /* clear out any garbage that may linger */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( gStopped )                 /* draw a red (or white) stop light */<span></span></pre></td></tr><tr><td scope="row"><pre>        ForeColor(redColor);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        ForeColor(whiteColor);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    PaintOval(&amp;gStopRect);<span></span></pre></td></tr><tr><td scope="row"><pre>    ForeColor(blackColor);<span></span></pre></td></tr><tr><td scope="row"><pre>    FrameOval(&amp;gStopRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( ! gStopped )               /* draw a green (or white) go light */<span></span></pre></td></tr><tr><td scope="row"><pre>        ForeColor(greenColor);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        ForeColor(whiteColor);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    PaintOval(&amp;gGoRect);<span></span></pre></td></tr><tr><td scope="row"><pre>    ForeColor(blackColor);<span></span></pre></td></tr><tr><td scope="row"><pre>    FrameOval(&amp;gGoRect);<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DrawWindow*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void AdjustMenus()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MenuHandle  menu;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed references to IsDAWindow, because desk accessories are not in Carbon*/<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• removed DisableItems and all code dealing with the desk accessory case.*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    menu = GetMenuHandle(mLight);<span></span></pre></td></tr><tr><td scope="row"><pre>    EnableMenuItem(menu, iStop); /*•• replaced EnableItem with EnableMenuItem */<span></span></pre></td></tr><tr><td scope="row"><pre>    EnableMenuItem(menu, iGo);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• replaced CheckItem with CheckMenuItem */<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckMenuItem(menu, iStop, gStopped); /* we can also determine check/uncheck */<span></span></pre></td></tr><tr><td scope="row"><pre>                                        /* state, too */<span></span></pre></td></tr><tr><td scope="row"><pre>    CheckMenuItem(menu, iGo, ! gStopped);<span></span></pre></td></tr><tr><td scope="row"><pre>} /*AdjustMenus*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void DoMenuCommand(long menuResult)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       menuID;             /* the resource ID of the selected menu */<span></span></pre></td></tr><tr><td scope="row"><pre>    short       menuItem;           /* the item number of the selected menu */<span></span></pre></td></tr><tr><td scope="row"><pre>    short       itemHit;<span></span></pre></td></tr><tr><td scope="row"><pre>    Str255      daName;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       daRefNum;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     handledByDA;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    menuID = HiWord(menuResult);    /* use macros for efficiency to... */<span></span></pre></td></tr><tr><td scope="row"><pre>    menuItem = LoWord(menuResult);  /* get menu item number and menu number */<span></span></pre></td></tr><tr><td scope="row"><pre>    switch ( menuID ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case mApple:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( menuItem ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                case iAbout:        /* bring up alert for About */<span></span></pre></td></tr><tr><td scope="row"><pre>                    itemHit = Alert(rAboutAlert, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                default:/* all non-About items in this menu are DAs */<span></span></pre></td></tr><tr><td scope="row"><pre>                        /*•• removed desk accessory code (not supported in Carbon) */<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case mFile:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( menuItem ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                case iClose:<span></span></pre></td></tr><tr><td scope="row"><pre>                    DoCloseWindow(FrontWindow());<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case iQuit:<span></span></pre></td></tr><tr><td scope="row"><pre>                    Terminate();<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case mEdit:     /* call SystemEdit for DA editing &amp; MultiFinder */<span></span></pre></td></tr><tr><td scope="row"><pre>                        /*•• removed because Carbon doesn't support desk accessories */<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case mLight:<span></span></pre></td></tr><tr><td scope="row"><pre>            switch ( menuItem ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                case iStop:<span></span></pre></td></tr><tr><td scope="row"><pre>                    SetLight(FrontWindow(), true);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case iGo:<span></span></pre></td></tr><tr><td scope="row"><pre>                    SetLight(FrontWindow(), false);<span></span></pre></td></tr><tr><td scope="row"><pre>                    break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    HiliteMenu(0);      /* unhighlight what MenuSelect (or MenuKey) hilited */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoMenuCommand*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void SetLight(WindowPtr window, Boolean newStopped)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( newStopped != gStopped ) {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Rect portRect;  /*•• Needed to hold port bounds */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        gStopped = newStopped;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Use accessor to obtain port bounds */<span></span></pre></td></tr><tr><td scope="row"><pre>        GetPortBounds(GetWindowPort(window), &amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /*•• Use accessor to cast WindowPtr to GrafPtr */<span></span></pre></td></tr><tr><td scope="row"><pre>        SetPort(GetWindowPort(window));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        InvalWindowRect(window,&amp;portRect);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*SetLight*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Boolean DoCloseWindow(WindowPtr window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Desk accessory–related code removed, because it's not supported in Carbon */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeWindow(window); /*•• replaced CloseWindow with DisposeWindow */<span></span></pre></td></tr><tr><td scope="row"><pre>    return true;<span></span></pre></td></tr><tr><td scope="row"><pre>} /*DoCloseWindow*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void Terminate()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowPtr   aWindow;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     closed;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    closed = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    do {<span></span></pre></td></tr><tr><td scope="row"><pre>        aWindow = FrontWindow();                /* get the current front window */<span></span></pre></td></tr><tr><td scope="row"><pre>        if (aWindow != nil)<span></span></pre></td></tr><tr><td scope="row"><pre>            closed = DoCloseWindow(aWindow);    /* close this window */<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    while (closed &amp;&amp; (aWindow != nil));<span></span></pre></td></tr><tr><td scope="row"><pre>    if (closed)<span></span></pre></td></tr><tr><td scope="row"><pre>        ExitToShell();                          /* exit if no cancellation */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*Terminate*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Boolean IsAppWindow(WindowPtr window)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       windowKind;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( window == nil )<span></span></pre></td></tr><tr><td scope="row"><pre>        return false;<span></span></pre></td></tr><tr><td scope="row"><pre>    else {  /* application windows have windowKinds = userKind (8) */<span></span></pre></td></tr><tr><td scope="row"><pre>        windowKind = GetWindowKind(window);<span></span></pre></td></tr><tr><td scope="row"><pre>        return ( windowKind == userKind );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>} /*IsAppWindow*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* Boolean IsDAWindow(WindowPtr window)                */<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• Carbon does not support desk accessories, so we removed this function */<span></span></pre></td></tr><tr><td scope="row"><pre>/*                                                                         */<span></span></pre></td></tr><tr><td scope="row"><pre>/*IsDAWindow*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void AlertUser()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short       itemHit;<span></span></pre></td></tr><tr><td scope="row"><pre>    Cursor      arrow; /*•• used to hold the contents of the qd.arrow field */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetCursor(GetQDGlobalsArrow(&amp;arrow)); /*•• new accessor in place */<span></span></pre></td></tr><tr><td scope="row"><pre>    itemHit = Alert(rUserAlert, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    ExitToShell();<span></span></pre></td></tr><tr><td scope="row"><pre>} /* AlertUser */<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000991-CH204-BBGBCAAD" title="Listing 3-2Carbon version of SampleInit.c"></a><p class="codesample"><strong>Listing 3-2&nbsp;&nbsp;</strong>Carbon version of SampleInit.c</p><div class="codesample"><table><tr><td scope="row"><pre>//#define ACCESSOR_CALLS_ARE_FUNCTIONS 1 /*•• leftovers from the porting process */<span></span></pre></td></tr><tr><td scope="row"><pre>//#define OPAQUE_TOOLBOX_STRUCTS 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define TARGET_API_MAC_CARBON 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#define MAC_OS_X_BUILD  0<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• use only one include for all Carbon headers */<span></span></pre></td></tr><tr><td scope="row"><pre>#if MAC_OS_X_BUILD<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon/Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>    #else<span></span></pre></td></tr><tr><td scope="row"><pre>        #include &lt;Carbon.h><span></span></pre></td></tr><tr><td scope="row"><pre>        #endif<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#include "Sample.h      "/* bring in all the #defines for Sample */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* The "g" prefix is used to emphasize that a variable is global. */<span></span></pre></td></tr><tr><td scope="row"><pre>/* All are extern since the variables are declared in the main segment. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• removed gMac and gHasWaitNextEvent global variables, as they are never used */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GInBackground is maintained by our osEvent handling routines. Any part of<span></span></pre></td></tr><tr><td scope="row"><pre>   the program can check it to find out if it is currently in the background. */<span></span></pre></td></tr><tr><td scope="row"><pre>extern Boolean      gInBackground;      /* maintained by Initialize and DoEvent */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* The following globals are the state of the window. If we supported more than<span></span></pre></td></tr><tr><td scope="row"><pre>   one window, they would be attached to each document, rather than globals. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GStopped tells whether the stop light is currently on stop or go. */<span></span></pre></td></tr><tr><td scope="row"><pre>extern Boolean      gStopped;           /* maintained by Initialize and SetLight */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* GStopRect and gGoRect are the rectangles of the two stop lights in the window. */<span></span></pre></td></tr><tr><td scope="row"><pre>extern Rect     gStopRect;          /* set up by Initialize */<span></span></pre></td></tr><tr><td scope="row"><pre>extern Rect     gGoRect;            /* set up by Initialize */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*•• Here is our Quit Apple event handler */<span></span></pre></td></tr><tr><td scope="row"><pre>static pascal OSErr QuitAppleEventHandler( const AppleEvent *appleEvt,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            AppleEvent* reply, UInt32 refcon )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Terminate(); /* close window and terminate gracefully */<span></span></pre></td></tr><tr><td scope="row"><pre>}   /*•• QuitAppleEventHandler */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void Initialize()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle      menuBar;<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowPtr   window;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        total, contig;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord event;<span></span></pre></td></tr><tr><td scope="row"><pre>    short       count;<span></span></pre></td></tr><tr><td scope="row"><pre>    MenuRef     menu;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        result;  /*•• used to hold results of Gestalt call */<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    gInBackground = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed most of the init functions (InitGraf, etc) as they */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• are not needed in Carbon */<span></span></pre></td></tr><tr><td scope="row"><pre>    InitCursor();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*  Call MPPOpen and ATPLoad at this point to initialize AppleTalk,<span></span></pre></td></tr><tr><td scope="row"><pre>        if you are using it. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*  This next bit of code is necessary to allow the default button of our<span></span></pre></td></tr><tr><td scope="row"><pre>        alert be outlined.<span></span></pre></td></tr><tr><td scope="row"><pre>        1.02 - Changed to call EventAvail so that we don't lose some important<span></span></pre></td></tr><tr><td scope="row"><pre>        events. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (count = 1; count &lt;= 3; count++)<span></span></pre></td></tr><tr><td scope="row"><pre>        EventAvail(everyEvent, &amp;event);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• WaitNextEvent is always available in Carbon, so we eliminated the code that */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• calls SysEnvirons and checks a trap for its presence. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed calls to GetApplLimit and ApplicationZone. They are not supported */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• in Carbon, and the memory problem they protect against is no longer an issue */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    PurgeSpace(&amp;total, &amp;contig);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (total &lt; kMinSpace) AlertUser();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed code to preallocate space for our window, because memory */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• requirements are no longer strict enough to make it necessary */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    window = GetNewWindow(rWindow, nil, (WindowPtr) -1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    menuBar = GetNewMBar(rMenuBar);         /* read menus into menu bar */<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( menuBar == nil ) AlertUser();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetMenuBar(menuBar);                    /* install menus */<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeHandle(menuBar);<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Removed code that added desk accessories to the Apple Menu */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Determine if we're running on Mac OS X, and if we are, remove the Quit menu */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• item and the Quit separator from the File Menu */<span></span></pre></td></tr><tr><td scope="row"><pre>    err = Gestalt(gestaltMenuMgrAttr, &amp;result);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!err &amp;&amp; (result &amp; gestaltMenuMgrAquaLayoutMask)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        menu = GetMenuHandle (mFile);<span></span></pre></td></tr><tr><td scope="row"><pre>        DeleteMenuItem(menu, iQuit);<span></span></pre></td></tr><tr><td scope="row"><pre>        DeleteMenuItem(menu, iQuit-1); /*•• the element above the Quit item */<span></span></pre></td></tr><tr><td scope="row"><pre>                                     /* •• is a separator */<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    DrawMenuBar();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• Install a Quit Apple Event handler to make sure that the application can */<span></span></pre></td></tr><tr><td scope="row"><pre>    /*•• quit properly on Mac OS X. It's also just good programming practice on 8/9 */<span></span></pre></td></tr><tr><td scope="row"><pre>    err = AEInstallEventHandler( kCoreEventClass, kAEQuitApplication,<span></span></pre></td></tr><tr><td scope="row"><pre>                             NewAEEventHandlerUPP(QuitAppleEventHandler), 0, false );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr) ExitToShell();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    gStopped = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( !GoGetRect(rStopRect, &amp;gStopRect) )<span></span></pre></td></tr><tr><td scope="row"><pre>        AlertUser();                        /* the stop light rectangle */<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( !GoGetRect(rGoRect, &amp;gGoRect) )<span></span></pre></td></tr><tr><td scope="row"><pre>        AlertUser();                        /* the go light rectangle */<span></span></pre></td></tr><tr><td scope="row"><pre>} /*Initialize*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Boolean GoGetRect(short rectID, Rect *theRect)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle      resource;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    resource = GetResource('RECT', rectID);<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( resource != nil ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        *theRect = **((Rect**) resource);<span></span></pre></td></tr><tr><td scope="row"><pre>        return true;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return false;<span></span></pre></td></tr><tr><td scope="row"><pre>} /* GoGetRect */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* TrapAvailable */<span></span></pre></td></tr><tr><td scope="row"><pre>/*•• Carbon does not support traps, so this function was removed. */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*TrapAvailable*/<span></span></pre></td></tr></table></div>	

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../cpg_buildstruct/cpg_build_struct.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../cpg_newtechstruct/cpg_newtech_struct.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-12-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/carbon_porting_guide/cpg_portexampstruct/cpg_portexamp_struct.html%3Fid%3DTP30000991-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/carbon_porting_guide/cpg_portexampstruct/cpg_portexamp_struct.html%3Fid%3DTP30000991-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/carbon_porting_guide/cpg_portexampstruct/cpg_portexamp_struct.html%3Fid%3DTP30000991-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>