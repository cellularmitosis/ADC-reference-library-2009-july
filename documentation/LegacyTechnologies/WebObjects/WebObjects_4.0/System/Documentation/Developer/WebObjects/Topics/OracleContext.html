<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN">
<HTML>
<HEAD>
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<LINK REL="STYLESHEET" HREF="OracleContext.css">
<TITLE> </TITLE></HEAD>
<BODY BGCOLOR="#ffffff">

<!--start of banner -->
<!--#include virtual="/includes/framesetheader" -->
<!-- end of banner -->
<!--start of path -->
<font face="Geneva,Helvetica,Arial" size="1">
<b>PATH<spacer type="horizontal" size="5">&nbsp;</b>
 <a href="../../../../../webobjects.html" target="_top">WebObjects 4.0 Documentation</a> <b>&gt;</b>
 <a href="TopicsTOC.html" target="_top">WebObjects Programming Topics</a>
</font>
<br><br>
<!--end of path -->


<H1 CLASS="TopictTitleTOC">
Integrating Oracle Context
</H1>
<DIV>
<H2 CLASS="Synopsis">
<A NAME="pgfId=613916">
 </A>
Synopsis<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<P CLASS="Body">
<A NAME="pgfId=613917">
 </A>
Describes how to use Oracle Context in a WebObjects application.</P>
</DIV>
<DIV>
<H2 CLASS="Heading1">
<A NAME="pgfId=613918">
 </A>
Discussion<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<P CLASS="Body">
<A NAME="pgfId=613919">
 </A>
Oracle Context is a powerful searching extension to the Oracle Database engine that adds several features including support for mixing full-text qualifiers with traditional relational qualifiers and background creation of GISTS, and THEMES. It fairly easy to integrate Context searches with EOF since EOF supports custom SQL qualifiers.</P>
<DIV>
<H4 CLASS="Heading2">
<A NAME="pgfId=606105">
 </A>
CONTAINS()</H4>
<P CLASS="Body">
<A NAME="pgfId=606107">
 </A>
Oracle Context adds a new SQL keyword called <EM CLASS="Code">
CONTAINS</EM>
 to the SQL parser inside the Oracle database. This new <EM CLASS="Code">
CONTAINS</EM>
 keyword requires three parameters: </P>
<DIV>
<pre>CONTAINS(columnName, `some text to search for', containsId) > score </pre></DIV>
<A NAME="pgfId=606108">
 </A>
<UL>
<P CLASS="Bulleted">
<A NAME="pgfId=606109">
 </A>
&#183;	<EM CLASS="Code">
ColumnName</EM>
 is a column within the selected table that has a special Context index created for it.</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606111">
 </A>
&#183;	<EM CLASS="Code">
ContainsId</EM>
 is an integer number that uniquely identifies a given <EM CLASS="Code">
CONTAINS</EM>
 clause within a <EM CLASS="Code">
Select</EM>
 statement. This identifier enables you to use logical operators to combine multiple <EM CLASS="Code">
CONTAINS</EM>
 clauses within a single <EM CLASS="Code">
Select</EM>
 statement.</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606112">
 </A>
&#183;	<EM CLASS="Code">
Score</EM>
 is the score threshold you must overcome to consider a record a hit (usually set to zero).</P>
</UL>
</DIV>
<DIV>
<H4 CLASS="Heading2">
<A NAME="pgfId=606113">
 </A>
SCORE()</H4>
<P CLASS="Body">
<A NAME="pgfId=606115">
 </A>
You can obtain the <EM CLASS="Code">
SCORE</EM>
 of each matching record by adding <EM CLASS="Code">
SCORE(containsId)</EM>
 to the SQL <EM CLASS="Code">
Select</EM>
 statement. However, this is a problem for EOF because your <EM CLASS="Code">
Select</EM>
 statements are usually autogenerated from the fixed list of attributes in an entity. If you are always searching with a fixed amount of <EM CLASS="Code">
CONTAINS</EM>
 clauses, you can make a copy of the entity and add the <EM CLASS="Code">
SCORE(containsId)</EM>
 as a derived column and fetch from this special EO that has <EM CLASS="Code">
SCORE</EM>
 attribute(s).</P>
</DIV>
<DIV>
<H4 CLASS="Heading2">
<A NAME="pgfId=606116">
 </A>
EOSQLQualifier for the CONTAINS Clause</H4>
<P CLASS="Body">
<A NAME="pgfId=606118">
 </A>
In EOF, you can create an EOSQLQualifier to represent the <EM CLASS="Code">
CONTAINS</EM>
 clause and then AND/OR that EOSQLQualifier to another other EOQualifier to obtain a complete compound qualifier.</P>
<TABLE>
<CAPTION>
<H6 CLASS="Code-Listing">
<A NAME="pgfId=607981">
 </A>
Figure 1.  Java Code</H6>
</CAPTION>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
<DIV>
<pre>EOEntity anEntity=EOModelGroup.defaultGroup().entityNamed("MyEntity");</pre></DIV>
<A NAME="pgfId=607983">
 </A>
</TD>
</TR>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
<DIV>
<pre>EOSQLQualifier (anEntity, "CONTAINS(columnName,'"+someString+", 1)>0");</pre></DIV>
<A NAME="pgfId=607985">
 </A>
</TD>
</TR>
</TABLE>
<TABLE>
<CAPTION>
<H6 CLASS="Code-Listing">
<A NAME="pgfId=608002">
 </A>
Figure 2.  Objective-C Code</H6>
</CAPTION>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
<DIV>
<pre>EOEntity *anEntity=[[EOModelGroup defaultGroup] entityNamed:@"MyEntity"];</pre></DIV>
<A NAME="pgfId=608004">
 </A>
</TD>
</TR>
<TR>
<TD ROWSPAN="1" COLSPAN="1">
<DIV>
<pre>EOSQLQualifier *qual=[[[EOSQLQualifier alloc] initWithEntity: anEntity qualifierFormat:@"CONTAINS(%A, '%@', 1)>0", @"myEnityAttribute", someString] autorelease];</pre></DIV>
<A NAME="pgfId=608006">
 </A>
</TD>
</TR>
</TABLE>
</DIV>
<DIV>
<H4 CLASS="Heading2">
<A NAME="pgfId=606127">
 </A>
Overcoming DISTINCT Problems</H4>
<P CLASS="Body">
<A NAME="pgfId=606129">
 </A>
A frequent problem when working with Context is that you might get duplicate records matching your query. The obvious way to eliminate the duplicates is to use the <EM CLASS="Code">
DISTINCT</EM>
 keyword in your Select. (see &quot;Fetching Distinct Results&quot;) The problem arises because the column that is indexed with Oracle Context usually contains a <EM CLASS="Code">
LONG</EM>
, a <EM CLASS="Code">
LONG RAW</EM>
, or a <EM CLASS="Code">
BLOB</EM>
. Oracle does not support using <EM CLASS="Code">
DISTINCT</EM>
 with these types of columns. This is one way to solve this problem:</P>
<OL>
<P CLASS="Numbered1">
<A NAME="pgfId=606231">
 </A>
1.		Put the <EM CLASS="Code">
LONG RAW</EM>
 data you are indexing on in a separate table with just the primaryKey and <EM CLASS="Code">
LONG RAW</EM>
 column (<EM CLASS="Code">
DOCUMENT_DATA</EM>
).</P>
<P CLASS="Numbered">
<A NAME="pgfId=608919">
 </A>
2.		Make an Entity to the table with all the other attributes (that is, <EM CLASS="Code">
DOCUMENT</EM>
).</P>
<P CLASS="Numbered">
<A NAME="pgfId=608920">
 </A>
3.		Make a to-one propagate primary key relationship to the table with the <EM CLASS="Code">
LONG RAW</EM>
 (that is, <EM CLASS="Code">
toDocumentData</EM>
).</P>
<P CLASS="Numbered">
<A NAME="pgfId=606133">
 </A>
4.		Make the inverse relationship from the <EM CLASS="Code">
LONG RAW</EM>
 table to the real table (<EM CLASS="Code">
toDocument</EM>
).</P>
<P CLASS="Numbered">
<A NAME="pgfId=606134">
 </A>
5.		Query with an EOFetchSpecification <EM CLASS="Code">
setUsesDisitinct:YES</EM>
 on the <EM CLASS="Code">
DOCUMENT</EM>
 table using <EM CLASS="Code">
CONTAINS(toDocumentData.data,'some string',1)&gt;0.</EM>
</P>
<P CLASS="Numbered">
<A NAME="pgfId=606135">
 </A>
6.		Then, if you really want the long raw data, you can traverse the <EM CLASS="Code">
toDocumentData.data</EM>
 keypath to get the data.</P>
</OL>
<P CLASS="Warning">
<A NAME="pgfId=606136">
 </A>
<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
Note<BR>
Breaking up the long raw data into separate tables is a good convention because many databases have restrictions on using <EM CLASS="Code">
DISTINCT</EM>
 with long raw (memo) columns.<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</P>
</DIV>
<DIV>
<H4 CLASS="Heading2">
<A NAME="pgfId=606137">
 </A>
GISTS and THEMES</H4>
<P CLASS="Body">
<A NAME="pgfId=606139">
 </A>
Oracle Context has very advanced facilities to do <EM CLASS="Code">
GISTS</EM>
 and <EM CLASS="Code">
THEMES</EM>
. <EM CLASS="Code">
GISTS</EM>
 are summaries of the documents, and <EM CLASS="Code">
THEMES</EM>
 are a small set of topics covering all of the documents. You can set up <EM CLASS="Code">
ORACLE</EM>
 to automatically update <EM CLASS="Code">
GIST</EM>
 and <EM CLASS="Code">
THEME</EM>
 tables that correspond to your full-text data. You can create Entities in EOModeler that correspond to the <EM CLASS="Code">
GISTS</EM>
 and <EM CLASS="Code">
THEME</EM>
 tables, and you can create relationships in EOModeler from the <EM CLASS="Code">
GISTS/THEMES</EM>
 entities to the actual data entity. Then, you can present the user with a list of all the themes. You can also create a to-one relationship from the data entity to the <EM CLASS="Code">
GISTS</EM>
 entity to provide an easy way to show the summary of a fetched data record.</P>
</DIV>
</DIV>
<DIV>
<H2 CLASS="Heading1">
<A NAME="pgfId=606140">
 </A>
See Also<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<UL>
<P CLASS="Bulleted">
<A NAME="pgfId=606141">
 </A>
&#183;	Fetching Distinct Results</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606142">
 </A>
&#183;	Working with Unnormalized Tables</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606143">
 </A>
&#183;	EOSQLQualifier</P>
<P CLASS="Bulleted">
<A NAME="pgfId=614798">
 </A>
&#183;	Fetching with an Editing Context</P>
<P CLASS="Bulleted">
<A NAME="pgfId=614799">
 </A>
&#183;	EOQualifier</P>
<P CLASS="Bulleted">
<A NAME="pgfId=614800">
 </A>
&#183;	EOFetchSpecification</P>
</UL>
</DIV>
<DIV>
<H2 CLASS="Heading1">
<A NAME="pgfId=606144">
 </A>
Questions<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<UL>
<P CLASS="Bulleted">
<A NAME="pgfId=606145">
 </A>
&#183;		How do I integrate Oracle Context with EOF?</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606146">
 </A>
&#183;		How do I use <EM CLASS="Code">
GISTS</EM>
 or <EM CLASS="Code">
THEMES</EM>
?</P>
</UL>
</DIV>
<DIV>
<H2 CLASS="Heading1">
<A NAME="pgfId=606148">
 </A>
Keywords<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<UL>
<P CLASS="Bulleted">
<A NAME="pgfId=606149">
 </A>
&#183;	Oracle</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606150">
 </A>
&#183;	Context</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606151">
 </A>
&#183;	<EM CLASS="Code">
CONTAINS</EM>
</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606152">
 </A>
&#183;	<EM CLASS="Code">
SCORE</EM>
</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606153">
 </A>
&#183;	<EM CLASS="Code">
GISTS</EM>
</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606154">
 </A>
&#183;	<EM CLASS="Code">
THEMES</EM>
</P>
<P CLASS="Bulleted">
<A NAME="pgfId=606155">
 </A>
&#183;	EOSQLQualifier</P>
</UL>
</DIV>
<DIV>
<H2 CLASS="Heading1">
<A NAME="pgfId=606156">
 </A>
Revision History<DIV>
<IMG SRC="OracleContext-1.gif">
</DIV>
</H2>
<P CLASS="Body">
<A NAME="pgfId=606157">
 </A>
21 July, 1998. David Scheck. First Draft.<BR>
19 November, 1998. Clif Liu. Second Draft.</P>
<DIV>
<pre></pre></DIV>
<A NAME="pgfId=602450">
 </A>
</DIV>


<!--start of footer -->
<!--#include virtual="/includes/framesetfooter" -->
<!-- end of footer -->

</body>
</HTML>
