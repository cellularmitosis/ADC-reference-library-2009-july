<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Edition Manager(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING93></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-92.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-94.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING93-0></A>
<H1><A NAME=MARKER-9-501></A>Summary of the Edition Manager</H1>
<A NAME=HEADING93-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING93-2></A>
<H3>Constants</H3>
<PRE>
CONST 
   {resource types}
   rSectionType                  = 'sect';   {resource type for a }
                                             { section}
   {section types}
   stSubscriber                  = $01;      {subscriber section type}
   stPublisher                   = $0A;      {publisher section type} 
   {update modes}
   sumAutomatic                  = 0;        {subscriber receives new } 
                                             { editions automatically}
   sumManual                     = 1;        {subscriber receives new } 
                                             { editions manually}
   pumOnSave                     = 0;        {publisher sends new } 
                                             { editions on save}
   pumManual                     = 1;        {publisher does not send } 
                                             { new editions until user }
                                             { request}
   {edition container subpart number}
   kPartsNotUsed                 = 0;        {edition is the whole file}
   kPartNumberUnknown            = -1;       {not used in version 7.0} 

   {preview size}
   kPreviewWidth                 = 120;      {preview width} 
   kPreviewHeight                = 120;      {preview height}

   {special formats}
   kPublisherDocAliasFormat      = 'alis';   {alias record from the } 
                                             { edition to publisher} 
   kPreviewFormat                = 'prvw';   {'PICT' thumbnail sketch}
   kFormatListFormat             = 'fmts';   {list of all available }
                                             { formats and their sizes}

   {bits for formatMask}
   kPICTformatMask               = 1;        {graphics format}
   kTEXTformatMask               = 2;        {text format}
   ksndFormatMask                = 4;        {sound format}

   {Finder types for edition files}
   kPICTEditionFileType          = 'edtp';   {contains 'PICT', }
   kTEXTEditionFileType          = 'edtt';   { 'TEXT', and }
   ksndEditionFileType           = 'edts';   { 'snd ' file types}
   kUnknownEditionFileType       = 'edtu';   {unknown file type}
   {miscellaneous}
   kFormatLengthUnknown          = -1;       {length of format unknown}

   {message IDs for Apple events sent by the Edition Manager}
   sectionEventMsgClass          = 'sect';   {Apple events sent by the }
                                             { Edition Manager}
   sectionReadMsgID              = 'read';   {Section Read events}
   sectionWriteMsgID             = 'writ';   {Section Write events}
   sectionScrollMsgID            = 'scrl';   {Section Scroll events}
   sectionCancelMsgID            = 'cncl';   {Section Cancel events}

   {refCon field when displaying stacked dialog boxes}
   sfMainDialogRefCon            = 'stdf';   {new publisher and }
                                             { new subscriber}
   sfNewFolderDialogRefCon       = 'nfdr';   {new folder}
   sfReplaceDialogRefCon         = 'rplc';   {replace dialog}
   sfStatWarnDialogRefCon        = 'stat';   {warning dialog}
   sfErrorDialogRefCon           = 'err ';   {error dialog}
   emOptionsDialogRefCon         = 'optn';   {options dialog}
   emCancelSectionDialogRefCon   = 'cncl';   {cancel section}
   emGotoPubErrDialogRefCon      = 'gerr';   {locate publisher}

   {pseudo-item hits for dialogHooks}
   emHookRedrawPreview           = 150;      {for NewPublisher or }
                                             { NewSubscriber dialogs}
   emHookCancelSection           = 160;      {for SectionOptions dialog}
   emHookGoToPublisher           = 161;      {for SectionOptions dialog}
   emHookGetEditionNow           = 162;      {for SectionOptions dialog}
   emHookSendEditionNow          = 162;      {for SectionOptions dialog}
   emHookManualUpdateMode        = 163;      {for SectionOptions dialog}
   emHookAutoUpdateMode          = 164;      {for SectionOptions dialog}
</PRE>
<A NAME=HEADING93-4></A>
<H3>Data Types</H3>
<PRE>
TYPE TimeStamp                   = LongInt;     {seconds since 1904}
   EditionRefNum                 = Handle;      {for use in Edition I/O}
   UpdateMode                    = Integer;     {sumAutomatic, }
                                                { sumManual, } 
                                                { pumOnSave, pumManual}
   SectionType                   = SignedByte;  {stSubscriber or }
                                                { stPublisher} 
   FormatType                    = PACKED ARRAY[1..4] OF CHAR; 
                                                {similar to ResType used } 
                                                { by the Scrap Manager}

   SectionHandle                 = ^SectionPtr;
   SectionPtr                    = ^SectionRecord;
   SectionRecord                 = 
   RECORD
      version:                   SignedByte;    {always 1 in version 7.0}
      kind:                      SectionType;   {publisher or subscriber}
      mode:                      UpdateMode;    {automatic or manual}
      mdDate:                    TimeStamp;     {last change to section}
      sectionID:                 LongInt;       {application-specific, }
                                                { unique per document}
      refCon:                    LongInt;       {application-specific}
      alias:                     AliasHandle;   {handle to alias record}

      {The following fields are private and are set up by the }
      { RegisterSection function.}

      subPart:                   LongInt;       {private}
      nextSection:               SectionHandle; {private}
      controlBlock:              Handle;        {private}
      refNum:                    EditionRefNum; {private}
   END;
   EditionContainerSpecPtr =^EditionContainerSpec;
   EditionContainerSpec =
   RECORD
      theFile:                   FSSpec;        {file containing edition } 
                                                { data}
      theFileScript:             ScriptCode;    {script code of filename}
      thePart:                   LongInt;       {which part of file, } 
                                                { always kPartsNotUsed}
      thePartName:               Str31;         {reserved}
      thePartScript:             ScriptCode;    {reserved}
   END;
   FormatsAvailable = ARRAY[0..0] OF
   RECORD
      theType:                   FormatType;    {format type for an }
                                                { edition}
      theLength:                 LongInt;       {length of edition format }
                                                { type}
   END;
   EditionInfoRecord = 
   RECORD
      crDate:                    TimeStamp;     {date edition container }
                                                { was created}
      mdDate:                    TimeStamp;     {date of last change}
      fdCreator:                 OSType;        {file creator}
      fdType:                    OSType;        {file type}
      container:                 EditionContainerSpec;
                                                {the edition}
   END;
   NewPublisherReply = 
   RECORD
      canceled:         Boolean;             {user canceled dialog box} 
      replacing:        Boolean;             {user chose existing } 
                                             { filename for an edition}
      usePart:          Boolean;             {always FALSE in version 7.0}
      preview:          Handle;              {handle to 'prvw', 'PICT',}
                                             { 'TEXT', or 'snd ' data}
      previewFormat:    FormatType;          {type of preview}
      container:        EditionContainerSpec;
                                             {edition chosen}
   END;
   NewSubscriberReply =
   RECORD
      canceled:         Boolean;             {user canceled dialog box}
      formatsMask:      SignedByte;          {formats required}
      container:        EditionContainerSpec;
                                             {edition selected}
   END;
   SectionOptionsReply =
   RECORD
      canceled:         Boolean;             {user canceled dialog box}
      changed:          Boolean;             {changed the section }
                                             { record}
      sectionH:         SectionHandle;       {handle to the specified }
                                             { section record}
      action:           ResType;             {action codes}
   END;
   EditionOpenerVerb= (eoOpen, eoClose, eoOpenNew, eoCloseNew,
                        eoCanSubscribe); 
   EditionOpenerParamBlock = 
   RECORD
      info:             EditionInfoRecord;   {edition container to }
                                             { be subscribed to}
      sectionH:         SectionHandle;       {publisher or subscriber }
                                             { requesting open}
      document:         FSSpecPtr;           {document passed}
      fdCreator:        OSType;              {Finder creator type}
      ioRefNum:         LongInt;             {reference number}
      ioProc:           FormatIOProcPtr;     {routine to read formats}
      success:          Boolean;             {reading or writing was }
                                             { successful}
      formatsMask:      SignedByte;          {formats required to }
                                             { subscribe}
   END;
   FormatIOVerb = (ioHasFormat, ioReadFormat, ioNewFormat, ioWriteFormat);
   FormatIOParamBlock = 
   RECORD
      ioRefNum:         LongInt;             {reference number}
      format:           FormatType;          {edition format type}
      formatIndex:      LongInt;             {opener-specific enumeration }
                                             { of formats}
      offset:           LongInt;             {offset into format}
      buffPtr:          Ptr;                 {data starts here}
      buffLen:          LongInt;             {length of data}
END;
</PRE>
<A NAME=HEADING93-14></A>
<H3>Edition Manager Routines</H3>
<A NAME=HEADING93-15></A>
<H4>Initializing the Edition Manager</H4>
<PRE>
FUNCTION InitEditionPack : OSErr;
</PRE>
<A NAME=HEADING93-17></A>
<H4>Creating and Registering a Section</H4>
<PRE>
FUNCTION NewSection(container: EditionContainerSpec; 
sectionDocument: FSSpecPtr; kind: SectionType; 
sectionID: LongInt; initialMode: UpdateMode; 
VAR sectionH: SectionHandle): OSErr;
FUNCTION RegisterSection(sectionDocument: FSSpec; 
sectionH: SectionHandle; 
VAR aliasWasUpdated: Boolean)
: OSErr;
FUNCTION UnRegisterSection(sectionH: SectionHandle): OSErr;
FUNCTION IsRegisteredSection
(sectionH: SectionHandle): OSErr;
FUNCTION AssociateSection(sectionH: SectionHandle; 
newSectionDocument: FSSpecPtr): OSErr;
</PRE>
<A NAME=HEADING93-24></A>
<H4>Creating and Deleting an Edition Container</H4>
<PRE>
FUNCTION CreateEditionContainerFile
(editionFile: FSSpec; fdCreator: OSType; editionFileNameScript: ScriptCode): OSErr;
FUNCTION DeleteEditionContainerFile
(editionFile: FSSpec): OSErr;
</PRE>
<A NAME=HEADING93-29></A>
<H4>Setting and Getting a Format Mark</H4>
<PRE>
FUNCTION SetEditionFormatMark
(whichEdition: EditionRefNum; 
whichFormat: FormatType; 
setMarkTo: LongInt): OSErr;
FUNCTION GetEditionFormatMark
(whichEdition: EditionRefNum; 
whichFormat: FormatType; 
VAR currentMark: LongInt): OSErr; 
</PRE>
<A NAME=HEADING93-34></A>
<H4>Reading in Edition Data</H4>
<PRE>
FUNCTION OpenEdition(subscriberSectionH: SectionHandle; 
VAR refNum: EditionRefNum): OSErr;
FUNCTION EditionHasFormat(whichEdition: EditionRefNum; 
whichFormat: FormatType; 
VAR formatSize: Size): OSErr; 
FUNCTION ReadEdition(whichEdition: EditionRefNum; 
whichFormat: FormatType; buffPtr: UNIV Ptr; 
VAR buffLen: Size): OSErr;
</PRE>
<A NAME=HEADING93-38></A>
<H4>Writing out Edition Data</H4>
<PRE>
FUNCTION OpenNewEdition(publisherSectionH: SectionHandle; 
fdCreator: OSType; 
publisherSectionDocument: FSSpecPtr; 
VAR refNum: EditionRefNum): OSErr;
FUNCTION WriteEdition(whichEdition: EditionRefNum; 
whichFormat: FormatType; buffPtr: UNIV Ptr; 
buffLen: Size): OSErr;
</PRE>
<A NAME=HEADING93-41></A>
<H4>Closing an Edition After Reading or Writing</H4>
<PRE>
FUNCTION CloseEdition(whichEdition: EditionRefNum; 
successful: Boolean): OSErr;
</PRE>
<A NAME=HEADING93-43></A>
<H4>Displaying Dialog Boxes</H4>
<PRE>
FUNCTION GetLastEditionContainerUsed
(VAR container: EditionContainerSpec): OSErr;
FUNCTION NewSubscriberDialog
(VAR reply: NewSubscriberReply): OSErr;
FUNCTION NewPublisherDialog(VAR reply: NewPublisherReply): OSErr;
FUNCTION SectionOptionsDialog
(VAR reply: SectionOptionsReply): OSErr;
FUNCTION NewSubscriberExpDialog
(VAR reply: NewSubscriberReply; where: Point; expansionDITLresID: Integer; 
dlgHook: ExpDlgHookProcPtr; 
filterProc: ExpModalFilterProcPtr; yourDataPtr: UNIV Ptr): OSErr;
FUNCTION NewPublisherExpDialog
(VAR reply: NewPublisherReply; where: Point; expansionDITLresID: Integer; 
dlgHook: ExpDlgHookProcPtr; 
filterProc: ExpModalFilterProcPtr; yourDataPtr: UNIV Ptr): OSErr;
FUNCTION SectionOptionsExpDialog
(VAR reply: SectionOptionsReply; where: Point; expansionDITLresID: Integer; 
dlgHook: ExpDlgHookProcPtr; 
filterProc: ExpModalFilterProcPtr; yourDataPtr: UNIV Ptr): OSErr;
</PRE>
<A NAME=HEADING93-57></A>
<H4>Locating a Publisher and Edition From a Subscriber</H4>
<PRE>
FUNCTION GetEditionInfo(sectionH: SectionHandle; 
VAR editionInfo: EditionInfoRecord): OSErr;
FUNCTION GoToPublisherSection
(container: EditionContainerSpec): OSErr;
</PRE>
<A NAME=HEADING93-61></A>
<H4>Edition Container Formats</H4>
<PRE>
FUNCTION GetStandardFormats(container: EditionContainerSpec; 
VAR previewFormat: FormatType; 
preview, publisherAlias, 
formats: Handle): OSErr;
</PRE>
<A NAME=HEADING93-63></A>
<H4>Reading and Writing Non-Edition files</H4>
<PRE>
FUNCTION GetEditionOpenerProc
(VAR opener: EditionOpenerProcPtr): OSErr;
FUNCTION SetEditionOpenerProc
(opener: EditionOpenerProcPtr): OSErr;
FUNCTION CallEditionOpenerProc
(selector: EditionOpenerVerb; 
VAR PB: EditionOpenerParamBlock; 
routine: EditionOpenerProcPtr): OSErr;
FUNCTION CallFormatIOProc(selector: FormatIOVerb; 
VAR PB: FormatIOParamBlock; 
routine: FormatIOProcPtr): OSErr;
</PRE>
<A NAME=HEADING93-71></A>
<H3>Application-Defined Routines</H3>
<PRE>
FUNCTION MyExpDlgHook(itemOffset: Integer; itemHit: Integer; 
theDialog: DialogPtr; 
yourDataPtr: Ptr): Integer;
FUNCTION MyExpModalFilter(theDialog: DialogPtr; 
VAR theEvent: EventRecord; 
itemOffset: Integer; VAR itemHit: Integer; 
yourDataPtr: Ptr): Boolean;
FUNCTION MyOpener(selector: EditionOpenerVerb; 
VAR PB: EditionOpenerParamBlock): OSErr;
FUNCTION MyIO(selector: FormatIOVerb; 
VAR PB: FormatIOParamBlock): OSErr;
</PRE>
<A NAME=HEADING93-76></A>
<H2>C Summary</H2>
<A NAME=HEADING93-77></A>
<H3>Constants</H3>
<PRE>
CONST 
enum {
   /*resource types*/
   #define rSectionType           'sect'     /*resource type for a */
                                             /* section*/

   /*section types*/
   stSubscriber                  = 0x01,     /*subscriber section type*/
   stPublisher                   = 0x0A,     /*publisher section type*/ 

   /*update modes*/
   sumAutomatic                  = 0,        /*subscriber receives new */ 
                                             /* editions automatically*/
   sumManual                     = 1,        /*subscriber receives new */ 
                                             /* editions manually*/
   pumOnSave                     = 0,        /*publisher sends new */ 
                                             /* editions on save*/
   pumManual                     = 1,        /*publisher does not send */ 
                                             /* new editions until user */
                                             /* request*/
   /*edition container subpart number*/
   kPartsNotUsed                 = 0,        /*edition is the whole file*/
   kPartNumberUnknown            = -1,       /*not used in version 7.0*/ 

   /*preview size*/
   kPreviewWidth                 = 120,      /*preview width*/ 
   kPreviewHeight                = 120,      /*preview height*/
   /*special formats*/
   #define kPublisherDocAliasFormat 'alis'   /*alias record from the */ 
                                             /* edition to publisher*/ 
   #define kPreviewFormat           'prvw'   /*'PICT' thumbnail sketch*/
   #define kFormatListFormat        'fmts'   /*list of all available */
                                             /* formats and their sizes*/

   /*bits for formatMask*/
   kPICTformatMask               = 1,        /*graphics format*/
   kTEXTformatMask               = 2,        /*text format*/
   ksndFormatMask                = 4,        /*sound format*/

   /*Finder types for edition files*/
   #define kPICTEditionFileType     'edtp'   /*contains 'PICT', */
   #define kTEXTEditionFileType     'edtt'   /* 'TEXT', and */
   #define ksndEditionFileType      'edts'   /* 'snd ' file types*/
   #define kUnknownEditionFileType  'edtu'   /*unknown file type*/

   /*pseudo-item hits for dialogHooks*/
   emHookRedrawPreview           = 150,      /*for NewPublisher or */
                                             /* NewSubscriber dialogs*/
   emHookCancelSection           = 160,      /*for SectionOptions dialog*/
   emHookGoToPublisher           = 161,      /*for SectionOptions dialog*/
   emHookGetEditionNow           = 162,      /*for SectionOptions dialog*/
   emHookSendEditionNow          = 162,      /*for SectionOptions dialog*/
   emHookManualUpdateMode        = 163,      /*for SectionOptions dialog*/
   emHookAutoUpdateMode          = 164       /*for SectionOptions dialog*/
};
   /*edition opener verbs*/
enum {eoOpen, eoClose, eoOpenNew, eoCloseNew, eoCanSubscribe};

enum {
   /*refCon field when displaying stacked dialog boxes*/
   #define emOptionsDialogRefCon        'optn'     /*options dialog*/
   #define emCancelSectionDialogRefCon  'cncl'     /*cancel section*/
   #define emGotoPubErrDialogRefCon     'gerr'     /*locate publisher*/

   kFormatLengthUnknown          = -1        /*length of format unknown*/
};
   /*refCon field when displaying stacked dialog boxes*/
   #define sfMainDialogRefCon     'stdf'     {new publisher and }
                                             { new subscriber}
   #define sfNewFolderDialogRefCon'nfdr'     {new folder}
   #define sfReplaceDialogRefCon  'rplc'     {replace dialog}
   #define sfStatWarnDialogRefCon 'stat'     {warning dialog}
   #define sfErrorDialogRefCon    'err '     {error dialog}

   /*message IDs for Apple events sent by the Edition Manager*/
   #define sectionEventMsgClass   'sect'     /*Apple events sent by the */
                                             /* Edition Manager*/
   #define sectionReadMsgID       'read'     /*Section Read events*/
   #define sectionWriteMsgID      'writ'     /*Section Write events*/
   #define sectionScrollMsgID     'scrl'     /*Section Scroll events*/
   #define sectionCancelMsgID     'cncl'     /*Section Cancel events*/
</PRE>
<A NAME=HEADING93-80></A>
<H3>Data Types</H3>
<PRE>
typedef unsigned long TimeStamp;             /*seconds since 1904*/
typedef Handle EditionRefNum;`               /*used in Edition I/O*/
typedef short UpdateMode;                    /*update mode: sumAutomatic, */
                                             /* sumManual, */ 
                                             /* pumOnSave, pumManual*/
typedef char SectionType;                    /*one byte, stSubscriber */
                                             /* or stPublisher*/ 
typedef unsigned long FormatType;            /*similar to ResType*/

struct SectionRecord {
   SignedByte version;                       /*always 1x01 in version 7.0*/
   SectionType kind;                         /*stPublisher or */
                                             /* stSubscriber*/
   UpdateMode mode;                          /*automatic or manual*/
   TimeStamp mdDate;                         /*last change to section*/
   long sectionID;                           /*application-specific, */
                                             /* unique per document*/
   long refCon;                              /*application-specific*/
   AliasHandle alias;                        /*handle to alias record*/
   long subPart;                             /*private*/
   struct SectionRecord **nextSection;       /*private*/
   Handle controlBlock;                      /*private*/
   EditionRefNum refNum;                     /*private*/
};

typedef struct SectionRecord SectionRecord;
typedef SectionRecord *SectionPtr, **SectionHandle;


struct EditionContainerSpec {
   FSSpec theFile;                           /*file containing */ 
                                             /* edition data*/
   ScriptCode theFileScript;                 /*script code of filename*/
   long thePart;                             /*which part of file, */ 
                                             /* always kPartsNotUsed*/
   Str31 thePartName;                        /*reserved*/
   ScriptCode thePartScript;                 /*reserved*/
};

typedef struct EditionContainerSpec EditionContainerSpec;
typedef EditionContainerSpec *EditionContainerSpecPtr;

struct EditionInfoRecord {
   TimeStamp crDate;                      /*date edition container */
                                          /* was created*/
   TimeStamp mdDate;                      /*date of last change*/
   OSType fdCreator;                      /*file creator*/
   OSType fdType;                         /*file type*/
   EditionContainerSpec container;        /*the edition*/
};

typedef struct EditionInfoRecord EditionInfoRecord;

struct NewPublisherReply {
   Boolean canceled;                      /*user canceled dialog box*/ 
   Boolean replacing;                     /*user chose existing */ 
                                          /* filename for an edition*/
   Boolean usePart;                       /*always FALSE in version */ 
                                          /* 7.0*/
   Handle preview;                        /*handle to 'prvw', 'PICT',*/
                                          /* 'TEXT', or 'snd ' data*/
   FormatType previewFormat;              /*type of preview*/
   EditionContainerSpec container;        /*edition chosen*/
};
typedef struct NewPublisherReply NewPublisherReply;

struct NewSubscriberReply {
   Boolean canceled;                      /*user canceled dialog box*/
   unsigned char formatsMask;             /*formats required*/
   EditionContainerSpec container;        /*edition selected*/
};
typedef struct NewSubscriberReply NewSubscriberReply;
struct SectionOptionsReply {
   Boolean canceled;                      /*user canceled dialog box*/
   Boolean changed;                       /*changed the section */
                                          /* record*/
   SectionHandle sectionH;                /*handle to the specified */
                                          /* section record*/
   ResType action;                        /*action codes*/
};

typedef struct SectionOptionsReply SectionOptionsReply;

typedef pascal Boolean (*ExpModalFilterProcPtr) (DialogPtr theDialog, 
                                    EventRecord *theEvent, short itemOffset, 
                                    short *itemHit, Ptr yourDataPtr);

typedef pascal short (*ExpDlgHookProcPtr) (short itemOffset, short itemHit,
                                       DialogPtr theDialog, Ptr yourDataPtr);

typedef unsigned char EditionOpenerVerb;
   
struct EditionOpenerParamBlock {
   EditionInfoRecord info;                /*edition container to */
                                          /* be subscribed to*/
   SectionHandle sectionH;                /*publisher or subscriber */
                                          /* requesting open*/
   FSSpecPtr document;                    /*document passed*/
   OSType fdCreator;                      /*Finder creator type*/
   long ioRefNum;                         /*reference number*/
   FormatIOProcPtr ioProc;                /*routine to read formats*/
   Boolean success;                       /*reading or writing was */
                                          /* successful*/
   unsigned char formatsMask;             /*formats required to */
                                          /* subscribe*/
};
typedef struct EditionOpenerParamBlock EditionOpenerParamBlock;

typedef pascal short (*EditionOpenerProcPtr) (EditionOpenerVerb selector,
                                             FormatIOParamBlock *PB);

enum {ioHasFormat, ioReadFormat, ioNewFormat, ioWriteFormat};
typedef unsigned char FormatIOVerb;


struct FormatIOParamBlock {
   long ioRefNum;                         /*reference number*/
   FormatType format;                     /*edition format type*/
   long formatIndex;                      /* opener-specific */ 
                                          /* enumeration */
                                          /* of formats*/
   unsigned long offset;                  /*offset into format*/
   Ptr buffPtr;                           /*data starts here*/
   unsigned long buffLen;                 /*length of data*/
};

typedef struct FormatIOParamBlock FormatIOParamBlock;

typedef pascal short (*FormatIOProcPtr) (FormatIOVerb selector,
                                       FormatIOParamBlock *PB);
</PRE>
<A NAME=HEADING93-82></A>
<H3>Edition Manager Routines</H3>
<A NAME=HEADING93-83></A>
<H4>Initializing the Edition Manager</H4>
<PRE>
pascal OSErr InitEditionPack(void)
</PRE>
<A NAME=HEADING93-85></A>
<H4>Creating and Registering a Section</H4>
<PRE>
pascal OSErr NewSection(const EditionContainerSpec *container,
const FSSpec *sectionDocument,
SectionType kind, long sectionID,
UpdateMode initialMode,
SectionHandle *sectionH);
pascal OSErr RegisterSection
(const FSSpec *sectionDocument,
SectionHandle sectionH,
Boolean *aliasWasUpdated);
pascal OSErr UnRegisterSection
(SectionHandle sectionH);
pascal OSErr IsRegisteredSection
(SectionHandle sectionH);
pascal OSErr AssociateSection
(SectionHandle sectionH,
const FSSpec *newSectionDocument);
</PRE>
<A NAME=HEADING93-95></A>
<H4>Creating and Deleting an Edition Container</H4>
<PRE>
pascal OSErr CreateEditionContainerFile
(const FSSpec *editionFile, OSType fdCreator, ScriptCode editionFileNameScript);
pascal OSErr DeleteEditionContainerFile
(const FSSpec *editionFile);
</PRE>
<A NAME=HEADING93-100></A>
<H4>Setting and Getting a Format Mark</H4>
<PRE>
pascal OSErr SetEditionFormatMark
(EditionRefNum whichEdition,
FormatType whichFormat,
unsigned long setMarkTo);
pascal OSErr GetEditionFormatMark
(EditionRefNum whichEdition,
FormatType whichFormat,
unsigned long *currentMark);
</PRE>
<A NAME=HEADING93-105></A>
<H4>Reading in Edition Data</H4>
<PRE>
pascal OSErr OpenEdition(SectionHandle subscriberSectionH, 
EditionRefNum *refNum);
pascal OSErr EditionHasFormat
(EditionRefNum whichEdition,
FormatType whichFormat,
Size *formatSize);
pascal OSErr ReadEdition(EditionRefNum whichEdition,
FormatType whichFormat, void *buffPtr,
Size *buffLen);
</PRE>
<A NAME=HEADING93-110></A>
<H4>Writing out Edition Data</H4>
<PRE>
pascal OSErr OpenNewEdition(SectionHandle publisherSectionH,
OSType fdCreator,
const FSSpec *publisherSectionDocument,
EditionRefNum *refNum);
pascal OSErr WriteEdition(EditionRefNum whichEdition,
FormatType whichFormat, const void *buffPtr, 
Size *buffLen);
</PRE>
<A NAME=HEADING93-113></A>
<H4>Closing an Edition After Reading or Writing</H4>
<PRE>
pascal OSErr CloseEdition(EditionRefNum whichEdition,
Boolean successful);
</PRE>
<A NAME=HEADING93-115></A>
<H4>Displaying Dialog Boxes</H4>
<PRE>
pascal OSErr GetLastEditionContainerUsed
(EditionContainerSpec *container);
pascal OSErr NewSubscriberDialog
(NewSubscriberReply *reply);
pascal OSErr NewPublisherDialog
(NewPublisherReply *reply);
pascal OSErr SectionOptionsDialog
(SectionOptionsReply *reply);
pascal OSErr NewSubscriberExpDialog
(NewSubscriberReply *reply, Point where,
short expansionDITLresID,
ExpDlgHookProcPtr dlgHook,
ExpModalFilterProcPtr filterProc,
void *yourDataPtr);
pascal OSErr NewPublisherExpDialog
(NewPublisherReply *reply, Point where,
short expansionDITLresID,
ExpDlgHookProcPtr dlgHook,
ExpModalFilterProcPtr filterProc,
void *yourDataPtr);
pascal OSErr SectionOptionsExpDialog
(SectionOptionsReply *reply, Point where, 
short expansionDITLresID,
ExpDlgHookProcPtr dlgHook,
ExpModalFilterProcPtr filterProc,
void *yourDataPtr);
</PRE>
<A NAME=HEADING93-130></A>
<H4>Locating a Publisher and Edition From a Subscriber</H4>
<PRE>
pascal OSErr GetEditionInfo(const SectionHandle sectionH,
EditionInfoRecord *editionInfo);
pascal OSErr GoToPublisherSection
(const EditionContainerSpec *container);
</PRE>
<A NAME=HEADING93-134></A>
<H4>Edition Container Formats</H4>
<PRE>
pascal OSErr GetStandardFormats
(const EditionContainerSpec *container,
FormatType *previewFormat,
Handle preview, Handle publisherAlias,
Handle formats);
</PRE>
<A NAME=HEADING93-137></A>
<H4>Reading and Writing Non-Edition files</H4>
<PRE>
pascal OSErr GetEditionOpenerProc
(EditionOpenerProcPtr *opener);
pascal OSErr SetEditionOpenerProc
(EditionOpenerProcPtr opener);
pascal OSErr CallEditionOpenerProc
(EditionOpenerVerb selector,
EditionOpenerParamBlock *PB,
EditionOpenerProcPtr routine);
pascal OSErr CallFormatIOProc
(FormatIOVerb selector,
FormatIOParamBlock *PB,
FormatIOProcPtr routine);
</PRE>
<A NAME=HEADING93-146></A>
<H3>Application-Defined Routines</H3>
<PRE>
pascal OSErr MyExpDlgHook(short itemOffset, short itemHit,
DialogPtr theDialog,
Ptr yourDataPtr);
pascal OSErr MyExpModalFilter
(DialogPtr theDialog,
EventRecord *theEvent,
short itemOffset, short *itemHit, 
Ptr yourDataPtr);
pascal OSErr MyOpener(EditionOpenerVerb selector,
EditionOpenerParamBlock *PB);
pascal OSErr MyIO(FormatIOVerb selector,
FormatIOParamBlock *PB);
</PRE>
<A NAME=HEADING93-152></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>abortErr<TD>-27<TD>Publisher has written a new edition<TR>
<TD>dskFulErr<TD>-34<TD>Disk is full<TR>
<TD>nsvErr<TD>-35<TD>No such volume<TR>
<TD>ioErr<TD>-36<TD>I/O error<TR>
<TD>bdNamErr<TD>-37<TD>Bad filename<TR>
<TD>fnOpnErr<TD>-38<TD>File not open<TR>
<TD>eofErr<TD>-39<TD>No additional data in the format<TR>
<TD>fnfErr<TD>-43<TD>Edition container not found<TR>
<TD>flLckedErr<TD>-45<TD>Publisher writing to an edition<TR>
<TD>fBsyErr<TD>-47<TD>Section doing I/O<TR>
<TD>paramErr<TD>-50<TD>Invalid parameter<TR>
<TD>rfNumErr<TD>-51<TD>Bad edition reference number<TR>
<TD>permErr<TD>-54<TD>Not a subscriber<TR>
<TD>wrPermErr<TD>-61<TD>Not a publisher<TR>
<TD>noTypeErr<TD>-102<TD>Format not available<TR>
<TD>memFullErr<TD>-108<TD>Memory full<TR>
<TD>dirNFErr<TD>-120<TD>Directory not found<TR>
<TD>userCanceledErr<TD>-128<TD>User clicked Cancel in dialog box<TR>
<TD>editionMgrInitErr<TD>-450<TD>Manager not initialized or could not load package<TR>
<TD>badSectionErr<TD>-451<TD>Not a valid section type<TR>
<TD>notRegisteredSectionErr<TD>-452<TD>Not registered<TR>
<TD>badSubPartErr<TD>-454<TD>Bad edition container spec or invalid edition container<TR>
<TD>multiplePublisherWrn<TD>-460<TD>Already is a publisher<TR>
<TD>containerNotFoundWrn<TD>-461<TD>Alias was not resolved<TR>
<TD>notThePublisherWrn<TD>-463<TD>Not the publisher</TABLE>
<A NAME=MARKER-2-188></A></H2>
 <P>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-92.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-94.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
