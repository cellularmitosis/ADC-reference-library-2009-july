<html><head><title>Mac OS X
 Manual Page For codesign(1)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/1/codesign" title="Mac OS X
 Manual Page for codesign(1)"><!-- headerDoc=man; indexgroup=Section 1; uid="//apple_ref/doc/man/1/codesign"; name=codesign(1) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
CODESIGN(1)               BSD General Commands Manual              CODESIGN(1)

<b>NAME</b>
     <b>codesign</b> -- Create and manipulate code signatures

<b>SYNOPSIS</b>
     <b>codesign</b> <u>-s</u> <u>identity</u> [-i identifier] [-r requirements] [<b>-fv</b>] [<u>path</u> <u>...</u>]
     <b>codesign</b> <u>-v</u> [-R requirement] [<b>-v</b>] [<u>path|pid</u> <u>...</u>]
     <b>codesign</b> <u>-d</u> [<b>-v</b>] [<u>path|pid</u> <u>...</u>]
     <b>codesign</b> <u>-h</u> [<b>-v</b>] [<u>pid</u> <u>...</u>]

<b>DESCRIPTION</b>
     The <b>codesign</b> command is used to create, check, and display code signatures, as well as inquire into the
     dynamic status of signed code in the system.

     <b>codesign</b> accepts single-character (classic) options, as well as GNU-style long options of the form
     --name and --name=value. Common options have both forms; less frequent and specialized options have
     only long form.

<b>OPTIONS</b>
     The options are as follows:

     <b>-d,</b> <b>--display</b>
             Display information about the code at the <!-- a -->path(s)<!-- /a --> given. Increasing levels of verbosity produce
             more output.  The format is designed to be moderately easy to parse by simple scripts while
             still making sense to human eyes.  In addition, the -r and --file-list options can be used to
             retrieve additional information.

     <b>-D,</b> <b>--detached</b> <u>filename</u>
             When signing, designates that a detached signature should be written to the specified file. The
             code being signed is not modified and need not be writable.  When verifying, designates a file
             containing a detached signature to be used for verification. Any embedded signature in the code
             is ignored.

     <b>-f,</b> <b>--force</b>
             When signing, causes <b>codesign</b> to replace any existing signature on the <!-- a -->path(s)<!-- /a --> given. Without
             this option, existing signatures will not be replaced, and the signing operation fails.

     <b>-i,</b> <b>--identifier</b> <u>identifier</u>
             During signing, explicitly specify the unique identifier string that is embedded in code signa-<font color="#ffffff" class="whiteout">tures.&nbsp;signatures.</font>
             tures. If this option is omitted, the identifier is derived from either the Info.plist (if
             present), or the filename of the executable being signed, possibly modified by the --prefix
             option.

     <b>-o,</b> <b>--options</b> <u>flag,...</u>
             During signing, specifies a set of option flag to be embedded in the code signature. The value
             takes the form of a comma-separated list of names (with no spaces). Alternatively, a numeric
             value can be used to directly specify the option mask (CodeDirectory flag word). See OPTION
             FLAGS below.

     <b>-P,</b> <b>--pagesize</b> <u>pagesize</u>
             Indicates the granularity of code signing. Pagesize must be a power of two.  Chunks of pagesize
             bytes are separately signed and can thus be independently verified as needed.  As a special
             case, a pagesize of zero indicates that the entire code should be signed and verified as a sin-<font color="#ffffff" class="whiteout">gle,&nbsp;single,</font>
             gle, possibly gigantic page. This option only applies to the main executable and has no effect
             on the sealing of associated data, including resources.

     <b>-r,</b> <b>--requirements</b> <u>requirements</u>
             During signing, indicates that internal requirements should be embedded in the code <!-- a -->path(s)<!-- /a --> as
             specified. See "specifying requirements" below.
             During display, indicates where to write the code's internal requirements. Use -r- to write
             them to standard output.

     <b>-R,</b> <b>--test-requirement</b> <u>requirement</u>
             During verification, indicates that the <!-- a -->path(s)<!-- /a --> given should be verified against the code
             requirement specified. If this option is omitted, the code is verified only for internal
             integrity and against its own designated requirement.

     <b>-s,</b> <b>--sign</b> <u>identity</u>
             Sign the code at the <!-- a -->path(s)<!-- /a --> given using this identity. See SIGNING IDENTITIES below.

     <b>-v,</b> <b>--verbose</b> <b>-[n]</b>
             Sets (with a numeric value) or increments the verbosity level of output. Without the verbose
             option, no output is produced upon success, in the classic UNIX style.  If no other options
             request a different action, the first -v encountered will be interpreted as --verify instead
             (and does not increase verbosity).

     <b>-v,</b> <b>--verify</b>
             Requests verification of code signatures.  If other actions (sign, display, etc.) are also
             requested, -v is interpreted to mean --verbose.

     <b>--continue</b>
             Instructs <b>codesign</b> to continue processing path arguments even if processing one fails.  If this
             option is given, exit due to operational errors is deferred until all path arguments have been
             considered. The exit code will then indicate the most severe failure (or, with equal severity,
             the first such failure encountered).

     <b>--dryrun</b>
             During signing, performs almost all signing operations, but does not actually write the result
             anywhere. Cryptographic signatures are still generated, actually using the given signing iden-<font color="#ffffff" class="whiteout">tity&nbsp;identity</font>
             tity and triggering any access control checks normally, though the resulting signature is then
             discarded.

     <b>--file-list</b> <u>path</u>
             When signing or displaying a signature, <b>codesign</b> writes to the given path a list of files that
             may have been modified as part of the signing process. This is useful for installer or patcher
             programs that need to know what was changed or what files are needed to make up the "signature"
             of a program. The file given is appended-to, with one line per absolute path written. An argu-<font color="#ffffff" class="whiteout">ment&nbsp;argument</font>
             ment of "-" (single dash) denotes standard output.  Note that the list may be somewhat pes-<font color="#ffffff" class="whiteout">simistic&nbsp;pessimistic</font>
             simistic - all files not listed are guaranteed to be unchanged by the signing process, but some
             of the listed files may not actually have changed.  Also note that modification may have been
             made to extended attributes of these files.

     <b>--ignore-resources</b>
             During static validation, do not validate the contents of the code's resources.  In effect,
             this will pass validation on code whose resources have been corrupted (or inappropriately
             signed). On large programs, it will also substantially speed up static validation, since all
             the resources will not be read into memory.  Obviously, the outcome of such a validation should
             be considered on its merits.

     <b>--keychain</b> <u>filename</u>
             During signing, only search for the signing identity in the keychain file specified. This can
             be used to break any matching ties if you have multiple similarly-named identities in several
             keychains on the user's search list.  Note that the standard keychain search path is still con-<font color="#ffffff" class="whiteout">sulted&nbsp;consulted</font>
             sulted while constructing the certificate chain being embedded in the signature.

     <b>--prefix</b> <u>string</u>
             If no explicit unique identifier is specified (using the -i option), and if the implicitly gen-<font color="#ffffff" class="whiteout">erated&nbsp;generated</font>
             erated identifier does not contain any dot (.) characters, then the given string is prefixed to
             the identifier before use. If the implicit identifier contains a dot, it is used as-is. Typi-<font color="#ffffff" class="whiteout">cally,&nbsp;Typically,</font>
             cally, this is used to deal with command tools without Info.plists, whose default identifier is
             simply the command's filename; the conventional prefix used is com.domain. (note that the final
             dot needs to be explicit).

     <b>--resource-rules=filename</b>
             During signing, this option overrides the default rules for collecting bundle resources to be
             sealed into the signature. The argument is the path to a property list (plist) file containing
             resource scanning instructions.

<b>OPERATION</b>
     In the first synopsis form, <b>codesign</b> attempts to sign the code objects at the <!-- a --><u>path(s)</u><!-- /a --><u></u> given, using the
     <u>identity</u> provided. Internal <u>requirements</u> are embedded if requested; if no -r option is given, there are
     no internal requirements. If an <u>identifier</u> is explicitly given, it is sealed into all <!-- a --><u>path(s)</u><!-- /a --><u></u>.  Other-<font color="#ffffff" class="whiteout">wise,&nbsp;Otherwise,</font>
     wise, each path derives its <u>identifier</u> independently from its Info.plist or pathname.  The <u>pagesize</u> can
     be used to control the granularity of the code hash table. Usually, only specific sizes are acceptable
     to the verifying agents; this option should be used only in special cases.

     In the second synopsis form, <b>codesign</b> verifies the code signatures on all the <!-- a --><u>path(s)</u><!-- /a --><u></u> given. The veri-<font color="#ffffff" class="whiteout">fication&nbsp;verification</font>
     fication confirms that the code at those <!-- a --><u>path(s)</u><!-- /a --><u></u> is signed, that the signature is valid, and that all
     sealed components are unaltered. If a <u>requirement</u> is given, each <u>path</u> is also checked against this
     requirement (but see DIAGNOSTICS below).
     If a <u>path</u> begins with a decimal digit, it is interpreted as the process id of a running process in the
     system, and dynamic validation is performed on that process instead.  This includes verifying the
     process's source on disk, but also extends to that particular process's dynamic validity state.

     In the third synopsis form, <b>codesign</b> displays the contents of the signatures on the <!-- a --><u>path(s)</u><!-- /a --><u></u> given. More
     information is displayed as the verbosity level increases.  This form may not completely verify the
     signatures on the <!-- a --><u>path(s)</u><!-- /a --><u></u>; though it may perform some verification steps in the process of obtaining
     information about the <!-- a --><u>path(s)</u><!-- /a --><u></u>.  If the <u>-r</u> <u>path</u> option is given, internal requirements will be extracted
     from the <!-- a --><u>path(s)</u><!-- /a --><u></u> and written to <u>path</u>; specify a dash "-" to write to standard output. If the code does
     not contain an explicit designated requirement, the implied one will be retrieved and written out as a
     source comment.

     In the fourth synopsis form, <b>codesign</b> constructs the hosting path for each <u>pid</u> given and writes it, one
     host per line, to standard output. The hosting path is the chain of code signing hosts starting with
     the most specific code known to be running, and ending with the root of trust (the kernel). If the
     <u>--verbose</u> option is given, the dynamic validity status of each host is also displayed, separated from
     the path by a tab character.  Note that hosting chains can at times be constructed for invalid or even
     unsigned code, and the output of this form of the <b>codesign</b> command should not be taken as a statement
     of formal code validity. Only <b>codesign</b> <u>--verify</u> can do that.

<b>SIGNING</b> <b>IDENTITIES</b>
     To be used for code signing, a digital identity must be stored in a keychain that is on the calling
     user's keychain search list. The identity is located by searching all such keychains for a certificate
     whose subject contains the <u>identity</u> string given. If there are multiple matches, the invocation fails
     and no signing is performed.
     If the --keychain argument is used, the identity is only looked-for in the specific keychain given.
     Even in that case, the keychain search list is still consulted for additional certificates needed to
     complete the signature.
     <b>codesign</b> will attempt to embed the entire certificate chain documenting the signing identity in the
     code signature it generates, including any intermediate certificates and the anchor certificate. It
     looks for those in the keychain search list of the user performing the signing operation. If it cannot
     generate the entire certificate chain, signing may still succeed, but verification may fail if the ver-<font color="#ffffff" class="whiteout">ifying&nbsp;verifying</font>
     ifying code does not have an independent source for the missing certificates.
     All keychain sources are supported if properly configured. In particular, it is possible to sign code
     with an identity stored on a supported smart card.  If your signing identity is stored in a different
     form, you need to import it into a keychain to use it with this program.

<b>SPECIFYING</b> <b>REQUIREMENTS</b>
     The <!-- a --><u>requirement(s)</u><!-- /a --><u></u> arguments (-r and -R) can be given in various forms. A plain text argument is taken
     to be a path to a file containing the <!-- a -->requirement(s)<!-- /a -->.  <b>codesign</b> will accept both binary files contain-<font color="#ffffff" class="whiteout">ing&nbsp;containing</font>
     ing properly compiled requirements code, and source files that are automatically compiled before use.
     An argument of "-" requests that the <!-- a -->requirement(s)<!-- /a --> are read from standard input.  Finally, an argument
     that begins with an equal sign "=" is taken as a literal requirements source text, and is compiled
     accordingly for use.

<b>OPTION</b> <b>FLAGS</b>
     When signing, a set of option flags can be specified to change the behavior of the system when using
     the signed code. The following flags are recognized by <b>codesign</b>; other flags may exist at the API
     level. Note that you can specify any valid flags by giving a (single) numeric value instead of a list
     of option names.

     kill     Forces the signed code's kill flag to be set when the code begins execution.  Code with the
              kill flag set will die when it loses its identity. It is therefore safe to assume that code
              marked this way will have a valid identity while alive.

     hard     Forces the signed code's hard flag to be set when the code begins execution.  The hard flag is
              a hint to the system that the code prefers to be denied access to resources if gaining such
              access would invalidate its identity.

     host     Marks the code as capable of hosting guest code. You must set this option if you want the code
              to act as a code signing host, controlling subsidiary ("guest") code.  This flag is automati-<font color="#ffffff" class="whiteout">cally&nbsp;automatically</font>
              cally set if the code's internal requirement (-r option) contains a guest requirement.

     expires  Forces any validation of the code to consider expiration of the certificates involved. Code
              signatures generated with this flag will fail to verify once any of the certificates in the
              chain has expired, regardless of the intentions of the verifier. Note that this flag does not
              affect any other checks that may cause signature validation to fail, including checks for cer-<font color="#ffffff" class="whiteout">tificate&nbsp;certificate</font>
              tificate revocation.

     Note that code can set the hard and kill flags on itself at any time. The signing options only affect
     their initial state. Once set by any means, these flags cannot be cleared for the lifetime of the code.

     If the code being signed has an Info.plist that contains a key named CSFlags, the value of that key is
     taken as the default value for the options. The value of CSFlags can be a string in the same form as
     the --options option, or an integer number specifying the absolute numeric value.

<b>EXAMPLES</b>
     To sign application Terminal.app with a signing identity named "authority":
           codesign -s authority Terminal.app

     To sign the command-line tool "helper" with the same identity, overwriting any existing signature,
     using the signing identifier "com.mycorp.helper", and embedding a custom designated requirement
           codesign -f -s authority --prefix=com.mycorp. -r="designated =&gt; anchor /tmp/foo" helper

     To verify the signature on Terminal.app and produce some verbose output:
           codesign -vv Terminal.app

     To verify the dynamic validity of process 666:
           codesign -v 666

     To display all information about Terminal.app's code signature:
           codesign -dvvvv Terminal.app

     To extract the internal requirements from Terminal.app to standard output:
           codesign -d -r- Terminal.app

<b>DIAGNOSTICS</b>
     <b>codesign</b> exits 0 if all operations succeed. This indicates that all codes were signed, or all codes
     verified properly as requested. If a signing or verification operation fails, the exit code is 1. Exit
     code 2 indicates invalid arguments or parameters. Exit code 3 indicates that during verification, all
     <!-- a -->path(s)<!-- /a --> were properly signed but at least one of them failed to satisfy the requirement specified with
     the <u>-R</u> option.

     For verification, all path arguments are always investigated before the program exits.  For all other
     operations, the program exits upon the first error encountered, and any further path arguments are
     ignored, unless the --continue option was specified, in which case <b>codesign</b> will defer the failure exit
     until after it has attempted to process all path arguments in turn.

<b>SIGNING</b> <b>ATOMICITY</b>
     When a signing operation fails for a particular code, the code may already have been modified in cer-<font color="#ffffff" class="whiteout">tain&nbsp;certain</font>
     tain ways by adding requisite signature data. Such information will not change the operation of the
     code, and the code will not be considered signed even with these pieces in place. You may repeat the
     signing operation without difficulty.  Note however that a previous valid signature may have been
     effectively destroyed if you specified the -f option.
     If you require atomicity of signing stricter than provided by <b>codesign</b> , you need to make an explicit
     copy of your code and sign that.

<b>SEE</b> <b>ALSO</b>
     <a href="csreq.1.html#//apple_ref/doc/man/1/csreq">csreq(1)</a>

<b>HISTORY</b>
     The <b>codesign</b> command first appeared in Mac OS 10.5.0 (Leopard).

<b>NOTES</b>
     <b>codesign</b> has several options that are purposely left undocumented in this manual page because they are
     either experimental (and subject to change at any time), or unadvised to the unwary.

BSD                              June 1, 2006                              BSD
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man1/codesign.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man1/codesign.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man1/codesign.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
