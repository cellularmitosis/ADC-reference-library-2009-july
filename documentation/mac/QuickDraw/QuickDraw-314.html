<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>UpdateGWorld (IM: Im)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING314></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!--end of header -->

<center>
<A HREF="QuickDraw-313.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-315.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="QuickDraw-2.html"><B>Imaging With QuickDraw</B></A> / <BR><DD><A HREF="QuickDraw-302.html"><B>Chapter 6 - Offscreen Graphics Worlds</B></A> / <A HREF="QuickDraw-305.html"><B>Offscreen Graphics Worlds Reference</B></A><BR><DL><DD><A HREF="QuickDraw-309.html"><B>Routines</B></A> / <A HREF="QuickDraw-310.html"><B>Creating, Altering, and Disposing of Offscreen Graphics Worlds</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING314-0></A>
<H3><A NAME=MARKER-9-136></A>UpdateGWorld</H3>
 <A NAME=MARKER-11-138></A><A NAME=MARKER-11-138></A><A NAME=MARKER-2-98></A><A NAME=MARKER-2-246></A>To change the pixel depth, boundary rectangle, or color table for an existing offscreen graphics world, use the <CODE>UpdateGWorld</CODE> function. You should call <CODE>UpdateGWorld</CODE> after every update event and whenever your windows move or change size.<P>
<PRE>
FUNCTION UpdateGWorld (VAR offscreenGWorld: GWorldPtr; 
                       pixelDepth: Integer; boundsRect: Rect; 
                       cTable: CTabHandle; aGDevice: GDHandle; 
                       flags: GWorldFlags): GWorldFlags;
</PRE>
<DL>
<DT><CODE>offscreenGWorld</CODE>
<DD> On input, a pointer to an existing offscreen graphics world; upon completion, the pointer to the updated offscreen graphics world.
<DT><CODE>pixelDepth</CODE>
<DD> The pixel depth of the offscreen world; possible depths are 1, 2, 4, 8, 16, and 32 bits per pixel. If you specify 0 in this parameter, <CODE>UpdateGWorld</CODE> rescans the device list and uses the depth of the screen with the greatest pixel depth among all screens whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter. If you specify 0 in this parameter, <CODE>UpdateGWorld</CODE> also copies the <CODE>GDevice</CODE> record from this device to create an offscreen <CODE>GDevice</CODE> record. The <CODE>UpdateGWorld</CODE> function ignores the value you supply for this parameter if you specify a <CODE>GDevice</CODE> record in the <CODE>aGDevice</CODE> parameter.
<DT><CODE>boundsRect</CODE>
<DD> The boundary rectangle and port rectangle for the offscreen pixel map. This also becomes the boundary rectangle for the <CODE>GDevice</CODE> record, if <CODE>NewGWorld</CODE> creates one. If you specify 0 in the <CODE>pixelDepth</CODE> parameter, <CODE>NewGWorld</CODE> interprets the boundaries in global coordinates, with which it determines which screens intersect the rectangle. (<CODE>NewGWorld</CODE> then uses the pixel depth, color table, and <CODE>GDevice</CODE> record from the screen with the greatest pixel depth from among all screens whose boundary rectangles intersect this rectangle.) Typically, your application supplies this parameter with the port rectangle for the onscreen window into which your application will copy the pixel image from this offscreen world.
<DT><CODE>cTable</CODE>
<DD> A handle to a <CODE>ColorTable</CODE> record. If you pass <CODE>NIL</CODE> in this parameter, <CODE>UpdateGWorld</CODE> uses the default color table for the pixel depth that you specify in the <CODE>pixelDepth</CODE> parameter; if you set the <CODE>pixelDepth</CODE> parameter to 0, <CODE>UpdateGWorld</CODE> copies and uses the color table of the graphics device with the greatest pixel depth among all graphics devices whose boundary rectangles intersect the rectangle that you specify in the <CODE>boundsRect</CODE> parameter. The <CODE>UpdateGWorld</CODE> function ignores the value you supply for this parameter if you specify a <CODE>GDevice</CODE> record in the <CODE>aGDevice</CODE> parameter.
<DT><CODE>aGDevice</CODE>
<DD> As an option, a handle to a <CODE>GDevice</CODE> record whose pixel depth and color table you want to use for the offscreen graphics world. To use the pixel depth and color table that you specify in the <CODE>pixelDepth</CODE> and <CODE>cTable</CODE> parameters, set this parameter to <CODE>NIL</CODE>.
<DT><CODE>flags</CODE>
<DD> Options available to your application. You can set a combination of the flags <CODE>keepLocal</CODE>, <CODE>clipPix</CODE>, <CODE>stretchPix</CODE>, and <CODE>ditherPix</CODE>. If you don't wish to use any of these flags, pass the empty set ([ ]) in this parameter for Pascal code or pass 0 here for C code. However, you should pass either <CODE>clipPix</CODE> or <CODE>stretchPix</CODE> to ensure that the pixel map is updated to reflect the new color table. The available flags are described here:
</DL>
<PRE>
           TYPE GWorldFlags = 
           SET OF (       {flags for UpdateGWorld are listed here}
            keepLocal,    {keep data structures in main memory}
            clipPix,      {update and clip pixel image to new }
                          { boundary rectangle}
            stretchPix,   {update and stretch or shrink pixel }
                          { image to the new boundary rectangle}
            ditherPix,    {include with clipPix or stretchPix }
                          { flag to dither the pixel image}
           );
</PRE>
<A NAME=HEADING314-10></A>
<H5>DESCRIPTION</H5>
 The <CODE>UpdateGWorld</CODE> function changes an offscreen graphics world to the specified pixel depth, rectangle, color table, and options that you supply in the <CODE>pixelDepth</CODE>, <CODE>boundsRect</CODE>, <CODE>cTable</CODE>, and <CODE>flags</CODE> parameters, respectively. In the <CODE>offscreenGWorld</CODE> parameter, pass the pointer returned to your application by the <CODE>NewGWorld</CODE> function when you created the offscreen graphics world. <P>
 If the <CODE>LockPixels</CODE> function (described on <A HREF=QuickDraw-323.html#MARKER-9-191>page 6-32</A>) reports that the Memory Manager has purged the base address for the offscreen pixel image, you can use <CODE>UpdateGWorld</CODE> to reallocate its memory. Your application should then reconstruct the pixel image or draw directly in a window instead of preparing the image in an offscreen graphics world.<P>
 In the <CODE>flags</CODE> parameter, you can specify the <CODE>keepLocal</CODE> flag, which keeps the offscreen pixel image in Macintosh main memory or returns the image to main memory if it had been previously cached. If you use <CODE>UpdateGWorld</CODE> without passing it the <CODE>keepLocal</CODE> flag, you allow the offscreen pixel image to be cached on a graphics accelerator card if one is present.<P>
 As its function result, <CODE>UpdateGWorld</CODE> returns the <CODE>gwFlagErr</CODE> flag if <CODE>UpdateGWorld</CODE> was unsuccessful; in this case, the offscreen graphics world is left unchanged. You can use the <CODE>QDError</CODE> function, described in the chapter "Color QuickDraw," to help you determine why <CODE>UpdateGWorld</CODE> failed. <P>
 If <CODE>UpdateGWorld</CODE> is successful, it returns a combination of the following flags, which are defined by the <CODE>GWorldFlags</CODE> data type:
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Flag<TH>Meaning<TR>
<TD>mapPix<TD>Color QuickDraw remapped the colors to a new color table.<A NAME=MARKER-2-44></A><TR>
<TD>newDepth<TD>Color QuickDraw translated the pixel values in the offscreen pixel image to those for a different pixel depth.<A NAME=MARKER-2-45></A><TR>
<TD>alignPix<TD>QuickDraw realigned the offscreen image to the window.<A NAME=MARKER-2-46></A><TR>
<TD>newRowBytes<TD>QuickDraw changed the value of the <CODE>rowBytes</CODE> field in the <CODE>PixMap</CODE> record for the offscreen graphics world.<A NAME=MARKER-9-615></A><TR>
<TD>reallocPix<TD>QuickDraw had to reallocate memory for the offscreen pixel image; your application should then reconstruct the pixel image, or draw directly in a window instead of preparing the image in an offscreen graphics world.<A NAME=MARKER-9-145></A><TR>
<TD>clipPix<TD>QuickDraw clipped the pixel image.<A NAME=MARKER-2-113></A><TR>
<TD>stretchPix<TD>QuickDraw stretched or shrank the offscreen image.<A NAME=MARKER-2-147></A><TR>
<TD>ditherPix<TD>Color QuickDraw dithered the offscreen pixel image.<A NAME=MARKER-2-103></A></TABLE>
<P>
 The <CODE>UpdateGWorld</CODE> function uses the following algorithm when updating the offscreen pixel image:<P>
<OL>
<LI>If the color table that you specify in the <CODE>cTable</CODE> parameter is different from the previous color table, or if the color table associated with the <CODE>GDevice</CODE> record that you specify in the <CODE>aGDevice</CODE> parameter is different, Color QuickDraw maps the pixel values in the offscreen pixel map to the new color table.
<LI>If the value you specify in the <CODE>pixelDepth</CODE> parameter differs from the previous pixel depth, Color QuickDraw translates the pixel values in the offscreen pixel image to those for the new pixel depth.
<LI>If the rectangle you specify in the <CODE>boundsRect</CODE> parameter differs from, but has the same size as, the previous boundary rectangle, QuickDraw realigns the pixel image to the screen for optimum performance for the <CODE>CopyBits</CODE> procedure.
<LI>If the rectangle you specify in the <CODE>boundsRect</CODE> parameter is smaller than the previous boundary rectangle and you specify the <CODE>clipPix</CODE> flag, the pixel image is clipped along the bottom and right edges.
<LI>If the rectangle you specify in the <CODE>boundsRect</CODE> parameter is bigger than the previous boundary rectangle and you specify the <CODE>clipPix</CODE> flag, the bottom and right edges of the pixel image are undefined.
<LI>If the rectangle you specify in the <CODE>boundsRect</CODE> parameter is smaller than the previous boundary rectangle and you specify the <CODE>stretchPix</CODE> flag, the pixel image is reduced to the new size.
<LI>If the rectangle you specify in the <CODE>boundsRect</CODE> parameter is bigger than the previous boundary rectangle and you specify the <CODE>stretchPix</CODE> flag, the pixel image is stretched to the new size.
<LI>If the Memory Manager purged the base address for the offscreen pixel image, <CODE>UpdateGWorld</CODE> reallocates the memory, but the pixel image is lost. You must reconstruct it. <P>
</OL>
<A NAME=HEADING314-25></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The <CODE>UpdateGWorld</CODE> function may move or purge memory blocks in the application heap. Your application should not call this function at interrupt time.<P>
<A NAME=HEADING314-27></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 The trap macro and routine selector for the <CODE>UpdateGWorld</CODE> function are
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Trap macro<TH>Selector<TR>
<TD>_QDExtensions<TD>$00160003<A NAME=MARKER-9-19></A><A NAME=MARKER-2-5></A></TABLE>
<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="QuickDraw-313.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="QuickDraw-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="QuickDraw-476.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="QuickDraw-315.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="QuickDraw-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
