<html><head><title>Mac OS X
 Manual Page For Mail::SpamAssassin::BayesStore::SQL(3pm)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3pm/Mail::SpamAssassin::BayesStore::SQL" title="Mac OS X
 Manual Page for Mail::SpamAssassin::BayesStore::SQL(3pm)"><a name="//apple_ref/doc/man/3/Mail::SpamAssassin::BayesStore::SQL" title="Mac OS X
 Manual Page for Mail::SpamAssassin::BayesStore::SQL(3pm)"><!-- headerDoc=man; indexgroup=Section 3pm; uid="//apple_ref/doc/man/3pm/Mail::SpamAssassin::BayesStore::SQL"; name=Mail::SpamAssassin::BayesStore::SQL(3pm) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
Mail::SpamAssassin::BayesStore::SQL(3ser Contributed Perl <!-- a -->Documentatiil::SpamAssassin::BayesStore::SQL(3)<!-- /a -->



<b>NAME</b>
       Mail::SpamAssassin::BayesStore::SQL - SQL Bayesian Storage Module Implementation

<b>SYNOPSIS</b>
<b>DESCRIPTION</b>
       This module implementes a SQL based bayesian storage module.

<b>METHODS</b>
       <b>new</b>

       public class (Mail::SpamAssassin::BayesStore::SQL) new (Mail::Spamassassin::Bayes $bayes)

       Description: This methods creates a new instance of the Mail::SpamAssassin::BayesStore::SQL object.
       It expects to be passed an instance of the Mail::SpamAssassin:Bayes object which is passed into the
       Mail::SpamAssassin::BayesStore parent object.

       This method sets up the database connection and determines the username to use in queries.

       <b>tie_db_readonly</b>

       public instance (Boolean) tie_db_readonly ();

       Description: This method ensures that the database connection is properly setup and working.  If
       necessary it will initialize a user's bayes variables so that they can begin using the database
       immediately.

       <b>tie_db_writable</b>

       public instance (Boolean) tie_db_writable ()

       Description: This method ensures that the database connetion is properly setup and working. If
       necessary it will initialize a users bayes variables so that they can begin using the database
       immediately.

       <b>untie_db</b>

       public instance () untie_db ()

       Description: This method is unused for the SQL based implementation.

       <b>calculate_expire_delta</b>

       public instance (%) calculate_expire_delta (Integer $newest_atime,
                                                    Integer $start,
                                                    Integer $max_expire_mult)

       Description: This method performs a calculation on the data to determine the optimum atime for token
       expiration.

       <b>token_expiration</b>

       public instance (Integer, Integer,
                        Integer, Integer) token_expiration(\% $opts,
                                                           Integer $newdelta,
                                                           @ @vars)

       Description: This method performs the database specific expiration of tokens based on the passed in
       $newdelta and @vars.

       <b>sync_due</b>

       public instance (Boolean) sync_due ()

       Description: This method determines if a database sync is currently required.

       Unused for SQL based implementation.

       <b>seen_get</b>

       public instance (String) seen_get (string $msgid)

       Description: This method retrieves the stored value, if any, for $msgid.  The return value is the
       stored string ('s' for spam and 'h' for ham) or undef if $msgid is not found.

       <b>seen_put</b>

       public (Boolean) seen_put (string $msgid, char $flag)

       Description: This method records $msgid as the type given by $flag.  $flag is one of two values 's'
       for spam and 'h' for ham.

       <b>seen_delete</b>

       public instance (Boolean) seen_delete (string $msgid)

       Description: This method removes $msgid from the database.

       <b>get_storage_variables</b>

       public instance (@) get_storage_variables ()

       Description: This method retrieves the various administrative variables used by the Bayes process and
       database.

       The values returned in the array are in the following order:

       0: scan count base

       1: number of spam

       2: number of ham

       3: number of tokens in db

       4: last expire atime

       5: oldest token in db atime

       6: db version value

       7: last journal sync

       8: last atime delta

       9: last expire reduction count

       10: newest token in db atime

       <b>dump_db_toks</b>

       public instance () dump_db_toks (String $template, String $regex, Array @vars)

       Description: This method loops over all tokens, computing the probability for the token and then
       printing it out according to the passed in token.

       <b>set_last_expire</b>

       public instance (Boolean) set_last_expire (Integer $time)

       Description: This method sets the last expire time.

       <b>get_running_expire_tok</b>

       public instance (String $time) get_running_expire_tok ()

       Description: This method determines if an expire is currently running and returns the last time set.

       There can be multiple times, so we just pull the greatest (most recent) value.

       <b>set_running_expire_tok</b>

       public instance (String $time) set_running_expire_tok ()

       Description: This method sets the time that an expire starts running.

       <b>remove_running_expire_tok</b>

       public instance (Boolean) remove_running_expire_tok ()

       Description: This method removes the row in the database that indicates that and expire is currently
       running.

       <b>tok_get</b>

       public instance (Integer, Integer, Integer) tok_get (String $token)

       Description: This method retrieves a specificed token ($token) from the database and returns it's
       spam_count, ham_count and last access time.

       <b>tok_get_all</b>

       public instance (\@) tok_get (@ $tokens)

       Description: This method retrieves the specified tokens ($tokens) from storage and returns an array
       ref of arrays spam count, ham acount and last access time.

       <b>tok_count_change</b>

       public instance (Boolean) tok_count_change (Integer $spam_count,                              Integer
       $ham_count,                              String $token,                              String $atime)

       Description: This method takes a $spam_count and $ham_count and adds it to $tok along with updating
       $toks atime with $atime.

       <b>multi_tok_count_change</b>

       public instance (Boolean) multi_tok_count_change (Integer $spam_count,
                                          Integer $ham_count,                                    \% $tokens,
                                          String $atime)

       Description: This method takes a $spam_count and $ham_count and adds it to all of the tokens in the
       $tokens hash ref along with updating each tokens atime with $atime.

       <b>nspam_nham_get</b>

       public instance ($spam_count, $ham_count) nspam_nham_get ()

       Description: This method retrieves the total number of spam and the total number of ham learned.

       <b>nspam_nham_change</b>

       public instance (Boolean) nspam_nham_change (Integer $num_spam,
                                                    Integer $num_ham)

       Description: This method updates the number of spam and the number of ham in the database.

       <b>tok_touch</b>

       public instance (Boolean) tok_touch (String $token,
                                            String $atime)

       Description: This method updates the given tokens ($token) atime.

       The assumption is that the token already exists in the database.

       <b>tok_touch_all</b>

       public instance (Boolean) tok_touch (\@ $tokens
                                            String $atime)

       Description: This method does a mass update of the given list of tokens $tokens, if the existing
       token atime is &lt; $atime.

       The assumption is that the tokens already exist in the database.

       We should never be touching more than N_SIGNIFICANT_TOKENS, so we can make some assumptions about how
       to handle the data (ie no need to batch like we do in tok_get_all)

       <b>cleanup</b>

       public instance (Boolean) cleanup ()

       Description: This method peroms any cleanup necessary before moving onto the next operation.

       <b>get_magic_re</b>

       public instance get_magic_re (String)

       Description: This method returns a regexp which indicates a magic token.

       Unused in SQL implementation.

       <b>sync</b>

       public instance (Boolean) sync (\% $opts)

       Description: This method performs a sync of the database

       <b>perform_upgrade</b>

       public instance (Boolean) perform_upgrade (\% $opts);

       Description: Performs an upgrade of the database from one version to another, not currently used in
       this implementation.

       <b>clear_database</b>

       public instance (Boolean) clear_database ()

       Description: This method deletes all records for a particular user.

       Callers should be aware that any errors returned by this method could causes the database to be
       inconsistent for the given user.

       <b>backup_database</b>

       public instance (Boolean) backup_database ()

       Description: This method will dump the users database in a marchine readable format.

       <b>restore_database</b>

       public instance (Boolean) restore_database (String $filename, Boolean $showdots)

       Description: This method restores a database from the given filename, $filename.

       Callers should be aware that any errors returned by this method could causes the database to be
       inconsistent for the given user.

       <b>db_readable</b>

       public instance (Boolean) <u>db</u><b>_</b><u>readable()</u>

       Description: This method returns a boolean value indicating if the database is in a readable state.

       <b>db_writable</b>

       public instance (Boolean) <u>db</u><b>_</b><u>writeable()</u>

       Description: This method returns a boolean value indicating if the database is in a writable state.

<b>Private</b> <b>Methods</b>
       <b>_connect_db</b>

       private instance (Boolean) _connect_db ()

       Description: This method connects to the SQL database.

       <b>_get_db_version</b>

       private instance (Integer) _get_db_version ()

       Description: Gets the current version of the database from the special global vars tables.

       <b>_initialize_db</b>

       private instance (Boolean) _initialize_db ()

       Description: This method will check to see if a user has had their bayes variables initialized. If
       not then it will perform this initialization.

       <b>_put_token</b>

       private instance (Boolean) _put_token (string $token,
                                              integer $spam_count,
                                              integer $ham_count,                            string $atime)

       Description: This method performs the work of either inserting or updating a token in the database.

       <b>_put_tokens</b>

       private instance (Boolean) _put_tokens (\% $tokens,
                                               integer $spam_count,
                                               integer $ham_count,                             string
       $atime)

       Description: This method performs the work of either inserting or updating tokens in the database.

       <b>_get_oldest_token_age</b>

       private instance (Integer) _get_oldest_token_age ()

       Description: This method finds the atime of the oldest token in the database.

       The use of min(atime) in the SQL is ugly and but really the most efficient way of getting the
       oldest_token_age after we've done a mass expire.  It should only be called at expire time.

       <b>_get_num_hapaxes</b>

       private instance (Integer) _get_num_hapaxes ()

       Description: This method gets the total number of hapaxes (spam_count + ham_count == 1) in the token
       database for a user.

       <b>_get_num_lowfreq</b>

       private instance (Integer) _get_num_lowfreq ()

       Description: This method gets the total number of lowfreq tokens (spam_count &lt; 8 and ham_count &lt; 8)
       in the token database for a user

       <b>_token_select_string</b>

       private instance (String) _token_select_string

       Description: This method returns the string to be used in SELECT statements to represent the token
       column.

       The default is to use the RPAD function to pad the token out to 5 characters.



perl v5.8.8                                      2007-04-03           Mail::SpamAssassin::BayesStore::SQL(3)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/Mail__SpamAssassin__BayesStore__SQL.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/Mail__SpamAssassin__BayesStore__SQL.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/Mail__SpamAssassin__BayesStore__SQL.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
