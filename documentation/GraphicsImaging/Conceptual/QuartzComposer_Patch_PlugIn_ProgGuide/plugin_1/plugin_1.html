<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz Composer Custom Patch Programming Guide: The Basics of Custom Patches</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="The Basics of Custom Patches"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004787-CH3" title="The Basics of Custom Patches"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004787-CH1-DontLinkElementID_14">Quartz Composer Custom Patch Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../WritingProcessorPatches/WritingProcessorPatches.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004787-CH3-SW1" title="The Basics of Custom Patches"></a><h1>The Basics of Custom Patches</h1><p>A Quartz Composer patch is similar to a routine in a traditional programming language—a <strong>patch</strong> is a base processing unit that executes and produces a result. A <strong>custom patch</strong> is one that you write by subclassing the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> class. To make a custom patch available in the Quartz Composer patch library, you need to package  it as a <strong>plug-in</strong>—an <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSBundle_Class/Reference/Reference.html#//apple_ref/occ/cl/NSBundle" target="_top">NSBundle</a></code> object—and install  in the appropriate directory. If you’d like, you can package more than one custom patch in a plug-in. You don’t need to create a user interface for a custom patch. When Quartz Composer loads your plug-in, it creates the user interface automatically for each custom patch in the plug-in so that custom patches have the same look in the workspace as the patches that are built in to Quartz Composer. </p><p>This chapter provides a discussion of custom patches and gives an overview of the tasks you need to perform to create a custom patch. You’ll see which aspects of your code give rise to the user interface for a custom patch. By the end of the chapter you should have a fairly good idea of how to get started writing your own custom patches. Then you can read <span class="content_text"><a href="../WritingProcessorPatches/WritingProcessorPatches.html#//apple_ref/doc/uid/TP40004787-CH4-SW1">“Writing Processor Patches”</a></span> and <span class="content_text"><a href="../WritingConsumerPatches/WritingConsumerPatches.html#//apple_ref/doc/uid/TP40004787-CH5-SW1">“Writing Consumer Patches”</a></span> to find out how to write specific kinds of patches.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_8">A Close Look at the Patch User Interface</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_9">From Custom Patch Code to Patch User Interface</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_10">Property and Port Data Types</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW3">Internal Settings</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_11">Custom Patch Execution</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW7">The QCPlugIn Template in Xcode</a>
				
			<br/>
			
        
			
			
				<a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_12">Packaging, Installing, and Testing Custom Patches</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_8" title="A Close Look at the Patch User Interface"></a><h2>A Close Look at the Patch User Interface</h2><p>Patches in Quartz Composer all have the same basic look and feel, as you can see in <span class="content_text">Figure 1-1</span>. The patch name is at the top of the patch, in the patch title bar. Input ports are on the left side of the patch and output ports are on the right side. Many provider patches don’t have input ports because they get data from an outside source, such as a mouse, keyboard, tablet, or MIDI controller. Consumer patches don’t have output ports because they render data to a destination. Processor patches have one or more input ports and one or more output ports. </p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW8" title="Figure 1-1A variety of Quartz Composer patches"></a><p><strong>Figure 1-1&nbsp;&nbsp;</strong>A variety of Quartz Composer patches</p><img src = "../art/patch_variety.jpg" alt = "A variety of Quartz Composer patches" ></div><br/><p>The inspector provides access to the patch parameters. The Input Parameters pane contains the same parameters represented by the input ports. It provides the option to manually adjust input values instead of supplying values through the input ports. Compare the Teapot patch shown in <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW8">Figure 1-1</a></span> with <span class="content_text">Figure 1-2</span>. You’ll see that the ports match up with the input parameters.</p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW10" title="Figure 1-2The Input Parameters pane for the Teapot patch"></a><p><strong>Figure 1-2&nbsp;&nbsp;</strong>The Input Parameters pane for the Teapot patch</p><img src = "../art/input_parameters.jpg" alt = "The Input Parameters pane for the Teapot patch" ></div><br/><p>Some patches also have a Settings pane, as shown in <span class="content_text">Figure 1-3</span>, that provides support for configuring settings whose values either can’t be represented by one of the standard port data types (see <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW2">Table 1-1</a></span>) or that control advanced options. </p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW11" title="Figure 1-3The Settings pane for the Date Formatter patch"></a><p><strong>Figure 1-3&nbsp;&nbsp;</strong>The Settings pane for the Date Formatter patch</p><img src = "../art/settings_pane.jpg" alt = "The Settings pane for the Date Formatter patch" ></div><br/><p> </p><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_9" title="From Custom Patch Code to Patch User Interface"></a><h2>From Custom Patch Code to Patch User Interface</h2><p>A custom patch is a subclass of the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> class. Quartz Composer creates the input and output ports on a custom patch from dynamic Objective-C properties of the subclass. Properties whose name begins with <code>input</code> (and are one of the supported types) will appear as an input port on the patch. Properties whose name begins with <code>output</code> (and are one of the supported types) will appear as an <code>output</code> port on the patch. <span class="content_text">Listing 1-1</span> shows code that creates a subclass of  <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> and declares one input and one output parameter. As you read this section you’ll see how that code relates to the resulting custom patch in Quartz Composer. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_24" title="Note"></a><p><strong>Note:</strong>&nbsp;Objective-C properties are represented syntactically as identifiers. Accessing declared properties is equivalent to invoking an accessor method directly and is more convenient than using key-value coding methods. If you are unfamiliar with properties, see  <em><a href="../../../../Cocoa/Conceptual/ObjectiveC/index.html#//apple_ref/doc/uid/TP30001163" target="_top">The Objective-C 2.0 Programming Language</a></em>.</p></div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW21" title="Listing 1-1The subclass and properties for a custom string-processing patch"></a><p class="codesample"><strong>Listing 1-1&nbsp;&nbsp;</strong>The subclass and properties for a custom string-processing patch</p><div class="codesample"><table><tr><td scope="row"><pre>@interface iPatchPlugIn : QCPlugIn<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@property(assign) NSString* inputString;<span></span></pre></td></tr><tr><td scope="row"><pre>@property(assign) NSString* outputString;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div><p>You can  implement the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributesForPropertyPortWithKey:" target="_top">attributesForPropertyPortWithKey:</a></code> method to map the name of each property (such as <code>inputString</code> or <code>outputString</code>)  to a key-value pair for the corresponding patch parameter. <span class="content_text">Listing 1-2</span> shows an implementation of this method for the properties declared in <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW21">Listing 1-1</a></span>. For each property, the method returns a dictionary that contains the port name and its default value, if any. This example returns the port name <code>Name</code> for the property that’s named <code>inputString</code>. It returns <code>iName</code> for the property that’s named <code>outputString</code>. </p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW14" title="Listing 1-2A routine that returns attributes for property ports"></a><p class="codesample"><strong>Listing 1-2&nbsp;&nbsp;</strong>A routine that returns attributes for property ports</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSDictionary*) attributesForPropertyPortWithKey:(NSString*)key<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"inputString"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Name", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Pod", QCPortAttributeDefaultValueKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"outputString"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                @"iName", QCPortAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return nil;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text">Figure 1-4</span> shows the patch that Quartz Composer creates as a result of the property declarations and the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributesForPropertyPortWithKey:" target="_top">attributesForPropertyPortWithKey:</a></code> method. Note that input values are read only—your custom patch code reads the input values and processes them in some way. Your custom patch code can write to output ports as well as read their current values.</p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW22" title="Figure 1-4The resulting patch"></a><p><strong>Figure 1-4&nbsp;&nbsp;</strong>The resulting patch</p><img src = "../art/iPatch_patch.jpg" alt = "The resulting patch" ></div><br/><p>If you don’t use properties, or if your custom patch needs to change the number of ports at runtime, you can use the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> methods to dynamically add and remove input and output ports, and the associated methods to set and retrieve values. These methods are described in <em><a href="../../../../Cocoa/Reference/QCPlugIn_Class/index.html#//apple_ref/doc/uid/TP40004794" target="_top">QCPlugIn Class Reference</a></em>:</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/addInputPortWithType:forKey:withAttributes:" target="_top">addInputPortWithType:forKey:withAttributes:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/addOutputPortWithType:forKey:withAttributes:" target="_top">addOutputPortWithType:forKey:withAttributes:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/removeInputPortForKey:" target="_top">removeInputPortForKey:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/removeOutputPortForKey:" target="_top">removeOutputPortForKey:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/setValue:forOutputKey:" target="_top">setValue:forOutputKey:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/valueForInputKey:" target="_top">valueForInputKey:</a></code></p></li></ul><p>You can define a string that specifies a practical name for the custom patch. This is the name that appears as the patch title. You should also define a description string that briefly tells what the custom patch does. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>#define    kQCPlugIn_Name @"iPatch"<span></span></pre></td></tr><tr><td scope="row"><pre>#define    kQCPlugIn_Description @"Converts any name to an \"iName\""<span></span></pre></td></tr></table></div><p>Then you need to implement the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributes" target="_top">attributes</a></code> method so that your custom patch returns a dictionary that contains the name and description. <span class="content_text">Listing 1-3</span> shows the <code>attributes</code> method for the iPatch custom patch.</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW17" title="Listing 1-3A routine that returns the custom patch name and description"></a><p class="codesample"><strong>Listing 1-3&nbsp;&nbsp;</strong>A routine that returns the custom patch name and description</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSDictionary*) attributes<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>                 @"Name", QCPlugInAttributeNameKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                @"Convert any name to an \"iName\"", QCPlugInAttributeDescriptionKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The description appears in the Quartz Composer  when the patch is selected in the Patch Creator and when the user hovers the pointer over the patch title bar in the workspace.</p><p>You must establish an execution mode for the custom patch by implementing the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/executionMode" target="_top">executionMode</a></code> method. The method returns the appropriate execution mode constant, which represents a Quartz Composer patch type—provider, processor, or consumer.</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInExecutionModeProvider" target="_top">kQCPlugInExecutionModeProvider</a></code> specifies to execute when the output values are needed but at most once per frame. This mode is for custom patches that pull data from an external source such as video, the mouse, a MIDI device, an RSS feed, and so on.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInExecutionModeProcessor" target="_top">kQCPlugInExecutionModeProcessor</a></code> specifies to execute when the output values are needed and when input values change.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInExecutionModeConsumer" target="_top">kQCPlugInExecutionModeConsumer</a></code> specifies to execute every frame. This type of custom patch pulls data from others and renders it to a destination.</p></li></ul><p>A custom patch must establish a time dependency by implementing the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/timeMode" target="_top">timeMode</a></code> method. The method returns one of the following time mode constants:</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInTimeModeNone" target="_top">kQCPlugInTimeModeNone</a></code>  does not depend on time.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInTimeModeIdle" target="_top">kQCPlugInTimeModeIdle</a></code> does not depend on time, but needs to give the system some time to process.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/c/econst/kQCPlugInTimeModeTimeBase" target="_top">kQCPlugInTimeModeTimeBase</a></code> has a time base defined by the system and the custom patch uses time in its computations for the result.</p></li></ul><p>If a custom patch uses the time base mode, the patch will have an option that allows the user to set the time base to parent, local, or external, as shown in <span class="content_text">Figure 1-5</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW12" title="Figure 1-5The time base setting for the Interpolation patch"></a><p><strong>Figure 1-5&nbsp;&nbsp;</strong>The time base setting for the Interpolation patch</p><img src = "../art/time_base.jpg" alt = "The time base setting for the Interpolation patch" ></div><br/><p> </p><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_10" title="Property and Port Data Types"></a><h2>Property and Port Data Types</h2><p>Objective-C 2.0 properties must be one of the data types listed in <span class="content_text">Table 1-1</span>. Quartz Composer maps the property data type to the appropriate port type. The type constants for ports that your custom patch creates at runtime are listed in the Custom Port Type column of the table, next to the Objective-C class associated with the port value. If your custom patch requires data that can’t be captured by one of the data types below, see <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW3">“Internal Settings.”</a></span></p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW2" title="Table 1-1Data type mappings"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 1-1&nbsp;&nbsp;</strong>Data type mappings</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Port</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Objective-C 2.0 property type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Custom port type</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Objective-C class</p></th></tr><tr><td  scope="row"><p>Boolean</p></td><td ><p><code>BOOL</code></p></td><td ><p><code>QCPortTypeBoolean</code></p></td><td ><p><code>NSNumber</code></p></td></tr><tr><td  scope="row"><p>Index</p></td><td ><p><code>NSUInteger</code></p></td><td ><p><code>QCPortTypeIndex</code></p></td><td ><p><code>NSNumber</code></p></td></tr><tr><td  scope="row"><p>Number</p></td><td ><p><code>double</code></p></td><td ><p><code>QCPortTypeNumber</code></p></td><td ><p><code>NSNumber</code></p></td></tr><tr><td  scope="row"><p>String</p></td><td ><p><code>NSString *</code></p></td><td ><p><code>QCPortTypeString</code></p></td><td ><p><code>NSString</code></p></td></tr><tr><td  scope="row"><p>Color</p></td><td ><p><code>CGColorRef</code></p></td><td ><p><code>QCPortTypeColor</code></p></td><td ><p><code>CGColorRef</code></p></td></tr><tr><td  scope="row"><p>Structure</p></td><td ><p><code>NSDictionary *</code></p></td><td ><p><code>QCPortTypeStructure</code></p></td><td ><p><code>NSDictionary</code></p></td></tr><tr><td  scope="row"><p>Image (input)</p></td><td ><p><code>id&lt;QCPlugInInputImageSource></code></p></td><td ><p><code>QCPortTypeImage</code></p></td><td ><p><code>(id)&lt;QCPlugInInputImageSource></code></p></td></tr><tr><td  scope="row"><p>Image (output)</p></td><td ><p><code>id &lt;QCPlugInOutputImageProvider></code> </p></td><td ><p><code>QCPortTypeImage</code></p></td><td ><p><code>(id)&lt;QCPlugInOutputImageProvider></code></p></td></tr></table></div><p>Images in Quartz Composer  are opaque objects that conform to protocols. Using protocols avoids the restrictions of a particular image type as well as type mismatches. It also gets the best performance because Quartz Composer defers pixel computation until it is needed.</p><p> The supported pixel formats for images are:</p><ul class="ul"><li class="li"><p><code>ARGB8</code>—8 bits alpha, 8 bits red, 8 bits green, 8 bits blue, unsigned integer</p></li><li class="li"><p><code>BGRA8</code>—8 bits blue, 8 bits green, 8 bits red, 8 bits alpha, unsigned integer</p></li><li class="li"><p><code>RGBAf</code>— 32 bits red, 32 bits green,  32 bits blue, 32 bits alpha, floating-point</p></li><li class="li"><p><code>l8</code>—8 bits luminance, unsigned integer</p></li><li class="li"><p><code>lf</code>—32 bits luminance, floating-point</p></li></ul><p>Input images are opaque source objects that conform to the <code><a href="../../../../Cocoa/Reference/QCPlugInInputImageSource_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInInputImageSource" target="_top">QCPlugInInputImageSource</a></code> protocol. To use an image as an input parameter to your custom patch, declare it as a property:</p><div class="codesample"><table><tr><td scope="row"><pre>@property(assign) id&lt;QCPlugInInputImageSource> inputImage;<span></span></pre></td></tr></table></div><p>Output images are opaque provider objects that conform to the <code><a href="../../../../Cocoa/Reference/QCPlugInOutputImageProvider_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInOutputImageProvider" target="_top">QCPlugInOutputImageProvider</a></code> protocol. To use an image as an output parameter for your custom patch, declare it as a property:</p><div class="codesample"><table><tr><td scope="row"><pre>@property(assign) id&lt;QCPlugInOutputImageProvider> outputImage;<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="../qc_image_proc/qc_image_proc.html#//apple_ref/doc/uid/TP40004787-CH7-SW1">“Writing Image Processing Patches”</a></span> shows how to define the methods of  the <code><a href="../../../../Cocoa/Reference/QCPlugInInputImageSource_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInInputImageSource" target="_top">QCPlugInInputImageSource</a></code> and <code><a href="../../../../Cocoa/Reference/QCPlugInOutputImageProvider_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInOutputImageProvider" target="_top">QCPlugInOutputImageProvider</a></code> protocols. See also <em><a href="../../../../Cocoa/Reference/QCPlugInInputImageSource_Protocol/index.html#//apple_ref/doc/uid/TP40004799" target="_top">QCPlugInInputImageSource Protocol Reference</a></em> and <em><a href="../../../../Cocoa/Reference/QCPlugInOutputImageProvider_Protocol/index.html#//apple_ref/doc/uid/TP40004800" target="_top">QCPlugInOutputImageProvider Protocol Reference</a></em>. </p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW3" title="Internal Settings"></a><h2>Internal Settings</h2><p>Custom patch parameters that are not suitable as input ports can be added to the Settings pane of the inspector for the patch. A few reasons why you might want to use internal settings are:</p><ul class="ul"><li class="li"><p>The parameter can’t be represented by one of the data types listed in <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW2">Table 1-1</a></span>. See, for example, the interpolation curve shown in <span class="content_text">Figure 1-6</span>.</p></li><li class="li"><p>The default value of the parameter works in most cases and should be modified only by a knowledgeable user.</p></li><li class="li"><p>It doesn’t make sense to animate the parameter.</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW13" title="Figure 1-6Two sample Settings panes"></a><p><strong>Figure 1-6&nbsp;&nbsp;</strong>Two sample Settings panes</p><img src = "../art/settings_compare.jpg" alt = "Two sample Settings panes" ></div><br/><p>For such cases, your custom patch needs to provide  a user interface for editing these values. Quartz Composer inserts your custom user interface into the Settings pane of the inspector for the patch. Internal settings are accessible through key-value coding. The simplest way to implement them are as Objective-C 2.0 properties. <span class="content_text">Listing 1-4</span> shows two typical declarations for property instance variables. </p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW5" title="Listing 1-4Code that declares property instance variables"></a><p class="codesample"><strong>Listing 1-4&nbsp;&nbsp;</strong>Code that declares property instance variables</p><div class="codesample"><table><tr><td scope="row"><pre>@property(copy) NSColor* systemColor;<span></span></pre></td></tr><tr><td scope="row"><pre>@property(copy) MyConfiguration* systemConfiguration;<span></span></pre></td></tr></table></div><p>Your <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> subclass must implement the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/plugInKeys" target="_top">plugInKeys</a></code> method so that it returns a list of  keys for the internal settings. The <code>plugInKeys</code> method for the <code>systemColor</code> and <code>systemConfiguration</code> properties is shown in <span class="content_text">Listing 1-5</span>. Make sure to terminate the list with <code>nil</code>. (See <em><a href="../../../../Cocoa/Conceptual/KeyValueCoding/index.html#//apple_ref/doc/uid/10000107i" target="_top">Key-Value Coding Programming Guide</a></em>.)</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW6" title="Listing 1-5An implementation of the plugInKeys method"></a><p class="codesample"><strong>Listing 1-5&nbsp;&nbsp;</strong>An implementation of the <code>plugInKeys</code> method</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSArray*) plugInKeys<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSArray arrayWithObjects: @“systemColor”,<span></span></pre></td></tr><tr><td scope="row"><pre>                @“systemConfiguration”,<span></span></pre></td></tr><tr><td scope="row"><pre>                nil]<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You use Interface Builder to create the user interface for editing internal settings. The interface is a view object (<code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> or <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> subclass) that is managed through an instance of <code><a href="../../../../Cocoa/Reference/QCPlugInViewController_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugInViewController" target="_top">QCPlugInViewController</a></code>. This instance acts as a controller between the custom patch instance and the view that contains the controls. In order for the nib to load properly, your plug-in class must implement  the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/createViewController" target="_top">createViewController</a></code> method of <code>QCPlugIn</code> and return an instance of <code><a href="../../../../Cocoa/Reference/QCPlugInViewController_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugInViewController" target="_top">QCPlugInViewController</a></code> initialized with the correct nib name. In this example shown in <span class="content_text">Listing 1-6</span>, the name is <code>MyPlugIn</code>.</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW4" title="Listing 1-6Code that implements a view controller"></a><p class="codesample"><strong>Listing 1-6&nbsp;&nbsp;</strong>Code that implements a view controller</p><div class="codesample"><table><tr><td scope="row"><pre>- (QCPlugInViewController*) createViewController<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  return [[QCPlugInViewController alloc] initWithPlugIn:self<span></span></pre></td></tr><tr><td scope="row"><pre>         viewNibName:@”MyPlugIn”];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Using Cocoa bindings for the controls in your custom interface requires no code.  Just use <code>plugIn.XXX</code> as the model key path, where <code>XXX</code> is the corresponding  key for the internal setting. If you prefer, you can subclass  <code><a href="../../../../Cocoa/Reference/QCPlugInViewController_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugInViewController" target="_top">QCPlugInViewController</a></code> to implement the usual target-action communication model. (You also need to make sure that you do not autorelease the controller. Then you need to connect the controls in the nib to the owner controller.)</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_25" title="Tip"></a><p><strong>Tip:</strong>&nbsp;In Xcode, use the <em>Quartz Composer Plug-in With Internal Setting And User Interface</em> template. This template includes a nib file for the Setting pane. See <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW7">“The QCPlugIn Template in Xcode.”</a></span></p></div><p>When you read or write a composition file that uses the custom patch, the internal settings are serialized. Serialization is automatic for any setting whose class conforms to the <code><a href="../../../../Cocoa/Reference/Foundation/Protocols/NSCoding_Protocol/Reference/Reference.html#//apple_ref/occ/intf/NSCoding" target="_top">NSCoding</a></code> protocol, such as <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSColor_Class/Reference/Reference.html#//apple_ref/occ/cl/NSColor" target="_top">NSColor</a></code>. For example, the <code>systemColor</code> property defined in <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW5">Listing 1-4</a></span> does not require any action on your part; the system serializes it automatically.</p><p>For settings that don’t conform to  the <code><a href="../../../../Cocoa/Reference/Foundation/Protocols/NSCoding_Protocol/Reference/Reference.html#//apple_ref/occ/intf/NSCoding" target="_top">NSCoding</a></code> protocol, you need to override the following methods:</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/serializedValueForKey:" target="_top">serializedValueForKey:</a></code> converts a value to its serialized representation.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/setSerializedValue:forKey:" target="_top">setSerializedValue:forKey:</a></code> converts from a serialized representation back to the original value.</p></li></ul><p>For example, the <code>systemConfiguration</code> property defined in <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW5">Listing 1-4</a></span> is serialized as shown in <span class="content_text">Listing 1-7</span>. A serialized value must be a property list class such as <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/cl/NSString" target="_top">NSString</a></code>, <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSNumber_Class/Reference/Reference.html#//apple_ref/occ/cl/NSNumber" target="_top">NSNumber</a></code>, <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSDate_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDate" target="_top">NSDate</a></code>, <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/cl/NSArray" target="_top">NSArray</a></code>, or <code><a href="../../../../Cocoa/Reference/Foundation/Classes/NSDictionary_Class/Reference/Reference.html#//apple_ref/occ/cl/NSDictionary" target="_top">NSDictionary</a></code> or <code>nil</code>.</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW18" title="Listing 1-7Code that overrides serialization methods for system configuration data"></a><p class="codesample"><strong>Listing 1-7&nbsp;&nbsp;</strong>Code that overrides serialization methods for system configuration data</p><div class="codesample"><table><tr><td scope="row"><pre>- (id) serializedValueForKey:(NSString*)key<span></span></pre></td></tr><tr><td scope="row"><pre> {<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"systemConfiguration"])<span></span></pre></td></tr><tr><td scope="row"><pre>        return [self.systemConfiguration data];<span></span></pre></td></tr><tr><td scope="row"><pre>    // Ensure this has a data method<span></span></pre></td></tr><tr><td scope="row"><pre>    return [super serializedValueForKey:key];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void) setSerializedValue:(id)serializedValue<span></span></pre></td></tr><tr><td scope="row"><pre>                     forKey:(NSString*)key<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // System config is subclass of NSObject.<span></span></pre></td></tr><tr><td scope="row"><pre>    // It's up to you to keep track of the version.<span></span></pre></td></tr><tr><td scope="row"><pre>    if([key isEqualToString:@"systemConfiguration"])<span></span></pre></td></tr><tr><td scope="row"><pre>        self.systemConfiguration<span></span></pre></td></tr><tr><td scope="row"><pre>           = [MyConfiguration configurationWithData:serializedValue];<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        [super setSerializedValue:serializedValue forKey:key];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div> <a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_11" title="Custom Patch Execution"></a><h2>Custom Patch Execution</h2><p>Quartz Composer assumes that the following statements are true for your <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> subclass:</p><ul class="ul"><li class="li"><p>There can be multiple instances of a custom patch. Quartz Composer creates one instance of the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> subclass each time the custom patch appears in a composition.</p></li><li class="li"><p>The custom patch works correctly even when it is not executed on the main thread.</p></li><li class="li"><p>The custom patch does not require a run loop to be present and running. (If you need a run loop, then you must set up the run loop on a secondary thread and communicate with it.)</p></li></ul><p>The <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/execute:atTime:withArguments:" target="_top">execute:atTime:withArguments:</a></code> method of <code>QCPlugIn</code> is at the heart of the custom patch. The method typically:</p><ul class="ul"><li class="li"><p>Reads the values from the input ports or gets data from a source</p></li><li class="li"><p>Performs  computations, taking into account time, if necessary</p></li><li class="li"><p>Either writes the result to the output ports or renders the content to a destination</p></li></ul><p>Your <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/execute:atTime:withArguments:" target="_top">execute:atTime:withArguments:</a></code> method should access its property ports only when necessary. When you can, cache values in loops rather than repeatedly read them from the port.</p><p>When the Quartz Composer engine renders, it calls methods related to executing the custom patch. Quartz Composer  passes an opaque object—that is, an execution context that conforms to the <code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInContext" target="_top">QCPlugInContext</a></code> protocol—to these methods. You should neither retain the context nor use it outside of the execution methods. Make sure you don’t write values to the input ports (input ports are read only).</p><p>The <code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intf/QCPlugInContext" target="_top">QCPlugInContext</a></code> protocol contains a number of useful methods for getting information about the rendering destination, including:</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/QCPlugInContext/bounds" target="_top">bounds</a></code> returns the bounds, expressed in Quartz Composer units (<code>–1.0</code> to <code>1.0</code>).</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/QCPlugInContext/colorSpace" target="_top">colorSpace</a></code> returns the output color space.</p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/Reference/Reference.html#//apple_ref/occ/intfm/QCPlugInContext/CGLContextObj" target="_top">CGLContextObj</a></code> returns the CGL context to perform rendering to.</p></li></ul><p>The protocol also provides utilities for logging messages and getting a dictionary of user information. The user information dictionary is shared with all instances of the custom patch in the same plug-in context environment. The dictionary was designed that way to allowing sharing information between custom patch instances. For more information on these methods, see <em><a href="../../../../Cocoa/Reference/QCPlugInContext_Protocol/index.html#//apple_ref/doc/uid/TP40004798" target="_top">QCPlugInContext Protocol Reference</a></em>.</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW7" title="The QCPlugIn Template in Xcode"></a><h2>The QCPlugIn Template in Xcode</h2><p>Xcode provides two templates that makes it straightforward to write and package custom patches. One template is for custom patches that do not require a Settings pane. The other template includes a nib file for a Setting pane. For each template, Xcode provides the skeletal files and methods that are needed and names the files appropriately. <span class="content_text">Figure 1-7</span> shows the files automatically created by Xcode for a Quartz Composer plug-in project named <code>iPatch</code>.</p><br/><div><a name="//apple_ref/doc/uid/TP40004787-CH3-SW20" title="Figure 1-7The files in a Quartz Composer plug-in project"></a><p><strong>Figure 1-7&nbsp;&nbsp;</strong>The files in a Quartz Composer plug-in project</p><img src = "../art/qcplugin_files_xcode.jpg" alt = "The files in a Quartz Composer plug-in project" ></div><br/><p>Xcode automatically names files using the project name that you supply. These are the default files provided by Xcode.</p><ul class="ul"><li class="li"><p><code>&lt;ProjectName>PlugIn.m</code> is the implementation file for the custom patch. You need to modify this file.</p></li><li class="li"><p><code>&lt;ProjectName>PlugIn.h</code> is the interface file for the custom patch. You need to modify this file.</p></li><li class="li"><p><code>Info.plist</code> contains properties of the plug-in, such as development region, bundle identifier, product name, and a <code>QCPlugInClasses</code> key that lists classes for each custom patch in the plug-in. You need to modify the Info.plist and make sure that the value  associated with the <code>QCPlugInClasses</code> key is correct. The default value for this key is based on the project name that you supply, so you shouldn’t need to modify it unless you plan to include more than one custom patch in the bundle.</p></li></ul><p>The interface file declares a subclass of <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code>. Xcode automatically names the subclass <code>&lt;ProjectName>PlugIn</code>. For example, if you supply <code>Number2Color</code> as the project name, the interface file uses <code>Number2ColorPlugIn</code> as the subclass name. </p><p>The implementation file contains these methods of the  <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> class that you need to modify for your purposes:</p><ul class="ul"><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCComposition_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCComposition/attributes" target="_top">attributes</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/attributesForPropertyPortWithKey:" target="_top">attributesForPropertyPortWithKey:</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/executionMode" target="_top">executionMode</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/timeMode" target="_top">timeMode</a></code></p></li><li class="li"><p><code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/instm/QCPlugIn/execute:atTime:withArguments:" target="_top">execute:atTime:withArguments:</a></code></p></li></ul><p>There are other methods of <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> provided in the template that you can implement if appropriate. (See also <em><a href="../../../../Cocoa/Reference/QCPlugIn_Class/index.html#//apple_ref/doc/uid/TP40004794" target="_top">QCPlugIn Class Reference</a></em>.)</p><p>The implementation file provided by Xcode contains two important statements that you should not modify and one that you need to modify. This statement should not be modified or deleted:</p><p><code>#import &lt;OpenGL/CGLMacro.h></code></p><p>Using <code>CGLMacro.h</code> improves performance. The inclusion of this statement allows Quartz Composer to optimize its use of OpenGL by providing a local context variable and caching the current renderer in that variable. You should keep this statement even if your custom patch does not contain OpenGL code itself. If your custom patch contains OpenGL code, you need to declare a local variable and set the current context to it. For example:</p><p><code>#import &lt;OpenGL/CGLMacro.h></code></p><p><code>CGLContext cgl_ctx = myContext;</code> </p><p>where <code>myContext</code> is the current context.</p><p>See <span class="content_text"><a href="../WritingConsumerPatches/WritingConsumerPatches.html#//apple_ref/doc/uid/TP40004787-CH5-SW2">“Using OpenGL in a Custom Patch”</a></span> and  <em><a href="../../OpenGL-MacProgGuide/index.html#//apple_ref/doc/uid/TP40001987" target="_top">OpenGL Programming Guide for Mac OS X</a></em> for more information.</p><p>The statement that defines the custom patch name is automatically filled-in by Xcode based on the project name that you supply. To help the user distinguish patches, it’s best if the patch name is unique in the context of the Quartz Composer Patch Creator. If the name isn’t unique, your patch will be difficult to use. So, change this statement. </p><p><code>#define    kQCPlugIn_Name @"&lt;ProjectName>"</code></p><p>Xcode provides a default definition for the custom patch description:</p><p><code>#define    kQCPlugIn_Description  @"Converts any name to an \"iName\""</code></p><p>You need to modify this string so that it describes the custom patch. If the patch name is not unique, it’s best to describe how your patch differs from another patch of the same name.  You’ll also want to provide localized strings. (For more information on localization, see <span class="content_text"><a href="../../../../MacOSX/Conceptual/BPInternational/Articles/StringsFiles.html#//apple_ref/doc/uid/20000005" target="_top">Strings Files</a></span>.)</p><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_12" title="Packaging, Installing, and Testing Custom Patches"></a><h2>Packaging, Installing, and Testing Custom Patches</h2><p>You need to package a Quartz Composer custom patch as a standard Cocoa bundle. You can package more than one custom patch in the bundle. The <code>QCPlugIn</code> template makes it trivial to package custom patches; see <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW7">“The QCPlugIn Template in Xcode.”</a></span></p><p>The bundle <code>Info.plist</code> file  must have an entry for each <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/cl/QCPlugIn" target="_top">QCPlugIn</a></code> subclass that’s in the bundle. <span class="content_text">Listing 1-8</span> shows a property list entry for a bundle that contains two custom patches: <code>MyColorGenerator</code> and <code>MyNumberCruncher</code>.</p><a name="//apple_ref/doc/uid/TP40004787-CH3-SW19" title="Listing 1-8Entries in the Info.plist file"></a><p class="codesample"><strong>Listing 1-8&nbsp;&nbsp;</strong>Entries in the <code>Info.plist</code> file</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;key>QCPlugInClasses&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre> &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;string>MyColorGenerator&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>  &lt;string>MyNumberCruncher&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre> &lt;/array><span></span></pre></td></tr></table></div><p>When you build the bundles, you should target 32-bit, 64-bit, PowerPC, and Intel architectures.</p><p>You can make a custom patch  available to any application that uses Quartz Composer by installing the plug-in that contains the custom patch in <code>/Library/Graphics/Quartz Composer Plug-Ins</code> or <code>~/Library/Graphics/Quartz Composer Plug-Ins</code>. When Quartz Composer launches, it automatically loads the plug-in so that all the custom patches contained in the plug-in show up in the Patch Creator.</p><p>You can choose instead to include custom patch code in an application bundle. You might want to do this either to control the use of the custom patches or because they are useful only to the application you are embedding them in. To make a custom patch available to the application,  register the subclass of the <code>QCPlugIn</code> class using the <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/registerPlugInClass:" target="_top">registerPlugInClass:</a></code> method. If you want to restrict access to a plug-in that contains one or more custom patches, you can load the plug-in from any location by calling the method <code><a href="../../../../Cocoa/Reference/QCPlugIn_Class/Introduction/Introduction.html#//apple_ref/occ/clm/QCPlugIn/loadPlugInAtPath:" target="_top">loadPlugInAtPath:</a></code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004787-CH3-DontLinkElementID_26" title="Note"></a><p><strong>Note:</strong>&nbsp;When you use a custom patch in a Quartz composition, the custom patch is not embedded in the composition. If you move the composition to another computer, you must install the plug-in that contains the custom patch on the same computer.</p></div><p>You should make sure that your custom patch works properly by using it in a Quartz Composer application. If you use the Build  &amp; Copy target, Xcode automatically copies the built plug-in to <code>~/Library/Graphics/Quartz Composer Plug-Ins</code> and then launches Quartz Composer.</p><p>If you do any of the following, the custom patches in your plug-in will not appear as patches in the Patch Creator:</p><ul class="ul"><li class="li"><p>Fail to include the class name for the <code>QCPlugInClasses</code> key or misspell the name. The class name in the <code>Info.plist</code> file must match the name of the <code>QCPlugIn</code> subclass.</p></li><li class="li"><p>Improperly declare  properties. Properties that represent ports must use one of the supported types. (See <span class="content_text"><a href="plugin_1.html#//apple_ref/doc/uid/TP40004787-CH3-SW2">Table 1-1</a></span>.)</p></li><li class="li"><p>Choose a plug-in name that conflicts with another Quartz Composer plug-in bundle. The plug-in name must be unique. However,  custom patch names are not required to be unique. But for usability, it’s a good idea to choose unique, descriptive custom patch names.</p></li></ul><p>You can check the system log in Console for error messages from Quartz Composer.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../WritingProcessorPatches/WritingProcessorPatches.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/plugin_1/plugin_1.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/plugin_1/plugin_1.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/QuartzComposer_Patch_PlugIn_ProgGuide/plugin_1/plugin_1.html%3Fid%3DTP40004787-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>