<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>AddNode(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING298></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-297.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-299.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-284.html"><B>Chapter 12 - Multinode Architecture</B></A> / <A HREF="Networking-291.html"><B>Multinode Architecture Reference</B></A><BR><DL><DD><A HREF="Networking-296.html"><B>Routines</B></A> / <A HREF="Networking-297.html"><B>Adding and Removing Multinode Addresses</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING298-0></A>
<H3><A NAME=MARKER-9-75></A>AddNode<A NAME=MARKER-2-76></A></H3>
 You use the <A NAME=MARKER-2-77></A><CODE>AddNode</CODE> routine to acquire a multinode ID that is separate from and in addition to the standard user node ID assigned to the system. You call the <CODE>AddNode</CODE> routine once for each additional multinode that you require. You use the <CODE>PBControl</CODE> function to call the <CODE>AddNode</CODE> routine. See <A HREF=Networking-296.html#MARKER-9-71>"Routines" on page 12-19</A> for a description of the <CODE>PBControl</CODE> function. You use a synchronous immediate control call to issue the <CODE>AddNode</CODE> routine. <P>
<B>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT><--<TH>ioResult<TH>OSErr<TH>The result code.<TR>
<TH>--><TH>ioRefNum<TH>Integer<TH>The .MPP driver reference number. You must fill in this value.<TR>
<TD>--><TD>csCode<TD>Integer<TD>The routine selector. Always equal to 262 for this routine. You must fill in this value.<TR>
<TD>--><TD>reqNodeAddr<TD>AddrBlock<TD>The requested multinode address.<TR>
<TD><--<TD>actNodeAddr<TD>AddrBlock<TD>The actual multinode address assigned and returned by the .MPP driver. <TR>
<TD>--><TD>recvRoutine<TD>LongInt<TD>The address of the application's <BR>receive routine.<TR>
<TD>--><TD>reqCableLo<TD>Integer <TD>The start of requested network number <BR>range for the multinode.<TR>
<TD>--><TD>reqCableHi<TD>Integer<TD>The end of the requested network number range for the multinode.<TR>
<TD>--><TD>reserved<TD>char<TD>70 reserved bytes required by the <BR>.MPP driver.</TABLE>
 </B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-78></A>reqNodeAddr</CODE>
<DD> The desired network address of the multinode to be acquired. You specify a value for this field in <CODE>AddrBlock</CODE> format. (See <A HREF=Networking-294.html#MARKER-9-55>"The Address Block Record" on page 12-17</A>.) The value of the <CODE>aSocket</CODE> field of the <CODE>AddrBlock</CODE> record must always be 0. Set the <CODE>aNet</CODE> and <CODE>aNode</CODE> fields to the desired network number and multinode ID. If the address that you specify is in use or is invalid, the .MPP driver will assign a different multinode address. To allow the .MPP driver to randomly generate the multinode address to be assigned, specify 0 for all three fields of the <CODE>AddrBlock</CODE> record. The .MPP driver returns in the <CODE>actNodeAddr</CODE> field of the parameter block either the multinode address that you request or the one that it selects. 
<DT><CODE><A NAME=MARKER-2-79></A>actNodeAddr</CODE>
<DD> The actual network address of the multinode that the .MPP driver assigned and returned to you.
<DT><CODE><A NAME=MARKER-2-80></A>recvRoutine</CODE>
<DD> The address of the routine that you provide as part of your application to receive packets addressed to this multinode. The .MPP driver calls this routine when it receives either a packet addressed to the multinode or a broadcast packet. 
<DT><CODE><A NAME=MARKER-2-81></A>reqCableLo</CODE>
<DD> The <A NAME=MARKER-2-82></A>network number that defines the low end of the range of network numbers from which you would like the .MPP driver to select a multinode ID for your use. The <CODE>reqCableHi</CODE> field contains the network number that defines the high end of this range. The .MPP driver uses the values that you specify for the cable range if all of the following conditions are true: the .MPP driver could not assign the multinode number that you specified in the <CODE>reqNodeAddr</CODE> field (if you specified one), there is no router on the network, and all the multinode addresses belonging to the network whose number is specified in the <CODE>NetHint</CODE> field are being used. The <CODE>NetHint</CODE> field contains the last used network number stored in RAM.
<DT>
<DD> The network range for the system on which your application is running is defined by the seed router on a network. 
<DT>
<DD> If your application does not require that the multinode ID that the .MPP driver assigns to it belong to a specific network cable range, you can set the <CODE>reqCableLo</CODE> and <CODE>reqCableHi</CODE> fields to 0.
<DT><CODE><A NAME=MARKER-2-83></A>reqCableHi</CODE>
<DD> The network number that defines the high end of the range of network numbers from which you would like the .MPP driver to select a multinode ID for your use. The <CODE>reqCableLo</CODE> field value delimits the low end of the range.
<DT><CODE>reserved</CODE>
<DD>  70 bytes that are reserved for internal use by the .MPP driver. 
</DL>
<A NAME=HEADING298-11></A>
<H5>DESCRIPTION</H5>
 The <CODE>AddNode</CODE> routine acquires the multinode address that you specify as the value of the <CODE>reqNodeAddr</CODE> parameter if that multinode ID is available and the .MPP driver is able to service the call. <P>
 If the requested node is already in use or is invalid, or if you do not request a specific multinode ID, the .MPP driver will randomly select a multinode ID and return it as the value of the <CODE>actNodeAddr</CODE> parameter.<P>
 If the .MPP driver is unable to service the call, it will return a result code of -1021, which indicates that you should try the <CODE>AddNode</CODE> routine again. If you receive this result code, you can retry the <CODE>AddNode</CODE> routine call repeatedly until either the .MPP driver assigns and returns a multinode ID to you or you receive a different error message. Because of this need to be able to retry this call repeatedly, you cannot issue the <CODE>AddNode</CODE> call asynchronously. <P>
 Your application must provide the address of a receive routine that it uses to receive both packets addressed to the multinode and broadcast packets. You pass the address of this routine to the .MPP driver in the <CODE>recvRoutine</CODE> parameter. For more information about the receive routine, see <A HREF=Networking-289.html#MARKER-9-31>"Receiving Packets Addressed to Your Multinode" beginning on page 12-10</A>. <P>
<A NAME=HEADING298-16></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 You must issue the <CODE>AddNode</CODE> routine as a synchronous immediate control call at system task time. <P>
<A NAME=HEADING298-18></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>AddNode</CODE> routine from assembly language, call the <CODE>_Control</CODE> trap macro with a value of 262 in the <CODE>csCode</CODE> field of the parameter block. You must issue the routine request as an immediate call.<P>
<A NAME=HEADING298-20></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error <TR>
<TD>tryAddNodeAgainErr<TD>-1021<TD>The .MPP driver was not able to add the multinode; try again<TR>
<TD>mnNotSupported<TD>-1022<TD>Multinode is not supported by the current AppleTalk connection file of type <CODE>'adev'</CODE><TR>
<TD>noMoreMultiNodes<TD>-1023<TD>No multinode addresses are available on <BR>the network</TABLE>
</H5>
<A NAME=HEADING298-21></A>
<H5>SEE ALSO</H5>
 For an example of how to issue the <CODE>AddNode</CODE> routine as a<A NAME=MARKER-2-84></A> synchronous immediate control call from the Pascal language, see <A HREF=Networking-287.html#MARKER-9-24>Listing 12-1 on page 12-8</A>.<A NAME=MARKER-2-85></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-297.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-299.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
