<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><!--Includes revisions to code listings--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1098: ATA Device Software Guide Additions and Corrections</title>       <meta name="keywords" content="Mac OS 8 ATA device software guide additions 4.0">    <meta name="Description" content="Technical Note TN1098: This Technical Note lists errors andadditions to the ATA                                    Device Software Guide. Included are both corrections to theoriginal guide, as well                                    as some minor additions for ATA Manager 4.0. ATA                                    Manager 4.0 was introducedwith the PowerBook 3400. Links to obsolete and valid resourcesare also provided."><meta name="categories" content="Devices"><meta name="week-posted" content="Jun 30, 1997 - Jul 4, 1997"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002938" title="ATA Device Software Guide Additions and Corrections"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/idxATA-date.html" target="_blank">Hardware & Drivers > ATA</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1098</div>
<div id="pageheadsub">ATA Device Software Guide Additions and Corrections</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext">					<A HREF = "#Corrections">Errors in the ATA Device Software         Guide</A><BR><BR>         <A HREF = "#ATADevConfig">Device Config Structure in ATA         4.0</A><BR><BR>       <A HREF = "#ATAPresence">Detecting the Presence of the ATA         Manager</A><BR><BR>        <A HREF = "#ATAHistory">History of the ATA Manager</A><BR><BR>        <A HREF = "#ATA4.0">ATA Manager 4.0</A><BR><BR>        <A HREF = "#Addenda">Additional Event Documentation</A><BR><BR>         <A HREF = "#Obsolete">Obsolete Resources</A><BR><BR>         <A HREF = "#Valid">Valid Resources</A><BR><BR>         <A HREF = "#Summary">Summary</A><BR><BR>          <A HREF = "#References">References</A><BR><BR>          <A HREF = "#Changes">Change History</A><BR><BR>     <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="Technote menu gif" width=300 height=16>                    </td>                </tr>            </table>        </td>		<td width=300 valign="top" align=left>	<!-- begin_intro_text --><P id = "introtext">This Technote         lists errors and additions to the <A HREF = "#ATAGuide"><I>ATA         Device Software Guide</I></A></P>         <P id = "introtext">We include both corrections to the original guide, as         well as some minor additions for ATA Manager 4.0. ATA         Manager 4.0 was introduced with the PowerBook 3400.</P>         <P id = "introtext">This Technote is directed at developers who wish to call the         ATA Manager directly. Normally, applications would never         call the ATA Manager directly; instead, they use the         appropriate driver for the device in question. The ATA         Manager is helpful for developers who are creating ATA         device drivers, and for specialized applications which         install such device drivers.</P>    <!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [May 18 1998]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content -->         <P><A NAME=Corrections></A></P>         <H2>Errors in the <A HREF = "#ATAGuide"><I>ATA         Device Software Guide</I></A></H2>         <P><B>Throughout.</B> All mentions of the ATA-2 standard         should be updated. The ATA Manager supports ATA-3 devices as         well.</P>         <P><B>Page 4: </B> <CITE>The ATA disk driver usually has a         driver reference number of -54 (decimal) but may also have a         different reference number if -54 is taken when the driver         is loaded. The driver name is <CODE>.ATDISK</CODE>. Like all         Macintosh device drivers, the ATA disk driver can be called         by using either the driver reference number or the driver         name, <CODE>.ATDISK</CODE>.</CITE></P>         <P>You should never rely on the driver reference number. Use         the <CODE>OpenDriver</CODE> call with the driver name to         retrieve the driver reference number, and use the driver         reference number returned by the <CODE>OpenDriver</CODE>         call for all subsequent driver calls. The name of the driver         is <CODE>.ATADisk</CODE>, not <CODE>.ATDisk</CODE>.</P>         <P><B>Page 6: </B> <CITE>The <CODE>open</CODE> routine should         not be called to open the ATA disk driver...</CITE></P>         <P>The <CODE>open</CODE> routine is harmless. You may call         <CODE>open</CODE> to get the driver reference number for the         ATA driver.</P>         <P><B>Page 9: </B> <CITE>The <CODE>verify</CODE> control         function...</CITE></P>         <P>The <CODE>verify</CODE> control function does nothing,         and returns <CODE>noErr</CODE> if valid parameters are         passed to it.</P>         <P><B>Page 9: </B> <CITE>The <CODE>format</CODE> control         function...</CITE></P>         <P>The <CODE>format</CODE> control function does nothing,         and returns <CODE>noErr</CODE> if valid parameters are         passed to it. If you need to do a low-level format of a         drive, you need to consult the <A HREF = "#References">ANSI</A>         specification.</P>         <P><B>Page 11: </B> <CITE>The <CODE>return drive         characteristics</CODE> function returns information about         the characteristics of the specified drive, as defined in</CITE>         Inside Macintosh, Volume V.</P>         <P>The <CODE>return drive characteristics</CODE> function         returns information about the characteristics of the         specified drive, as defined in <A HREF = "../../technotes/dv/dv_525.html">Technote         DV 525, Disk Driver Q&amp;As</A></P>         <P><B>Page 38: </B> <CITE>ATA_RegAccess</CITE></P>         <P>The <CODE>ATA_RegAccess</CODE> function does not function         properly with ATA Manager version 4.0.0 or 4.1.0. It does         function correctly in ATA Manager version 3, and in ATA         Manager version 4.1.1, which ships as part of Mac OS 8. To         get the ATA Manager version number, use the         <CODE>ATAMgrInquiry</CODE> function call (documented on page         56). The version is returned in the <CODE>MgrVersion</CODE> field.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>MgrVersion.majorRev = $04MgrVersion.minorAndBugRev = $00 or $10 are versions which do NOT work.MgrVersion.majorRev = $04MgrVersion.minorAndBugRev = $11 does work.         </pre>	</TD></TR></TABLE></CENTER>         <P><A NAME=ATADevConfig></A></P>         <P><B>Page 48: </B></P>         <H4>Device Config Structure in ATA 4.0</H4>         <P>Several of the fields of this structure are obsolete         starting with <A HREF = "#ATA4.0">ATA Manager 4.0</A>.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct ATADevConfig{     SInt32     <A HREF = "#ataConfigSetting">ataConfigSetting</A>;       //&lt;-&gt;: Configuration setting*/     UInt8      <A HREF = "#ataPIOSpeedMode">ataPIOSpeedMode</A>;        //&lt;-&gt;: Device access speed in PIO Mode     UInt8      reserved;               // padding     UInt16     <A HREF = "#atapcValid">atapcValid</A>;             //&lt;-&gt;: Obsolete with ATA 4     UInt16     <A HREF = "#ataRWMultipleCount">ataRWMultipleCount</A>;// Reserved for future (not supported yet)     UInt16     <A HREF = "#ataSectorsPerCylinder">ataSectorsPerCylinder</A>;// Reserved for future (not supported yet)     UInt16     <A HREF = "#ataHeads">ataHeads</A>;               //// Reserved for future (not supported yet)     UInt16     <A HREF = "#ataSectorsPerTrack">ataSectorsPerTrack</A>;// Reserved for future (not supported yet)     UInt16     <A HREF = "#ataSocketNumber">ataSocketNumber</A>;        //&lt;--: (No longer supported with ATA 4)     UInt8      <A HREF = "#ataSocketType">ataSocketType</A>;          //&lt;--: Specifies the socket type     UInt8      <A HREF = "#ataDeviceType">ataDeviceType</A>;          //&lt;--: Specifies the device type (get config only)     UInt8      <A HREF = "#atapcAccessMode">atapcAccessMode</A>;        //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcVcc">atapcVcc</A>;               //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcVpp1">atapcVpp1</A>;              //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcVpp2">atapcVpp2</A>;              //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcStatus">atapcStatus</A>;            //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcPin">atapcPin</A>;               //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcCopy">atapcCopy</A>;              //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#atapcConfigIndex">atapcConfigIndex</A>;       //&lt;-&gt;: Obsolete with ATA 4     UInt8      <A HREF = "#ataSingleDMASpeed">ataSingleDMASpeed</A>;      //&lt;-&gt;: Single Word DMA Timing Class     UInt8      <A HREF = "#ataMultiDMASpeed">ataMultiDMASpeed</A>;       //&lt;-&gt;: Multiple Word DMA Timing Class     UInt16     <A HREF = "#ataPIOCycleTime">ataPIOCycleTime</A>;        //&lt;-&gt;: Cycle time for PIO mode     UInt16     <A HREF = "#ataMultiCycleTime">ataMultiCycleTime</A>;      //&lt;-&gt;: Cycle time for Multiword DMA mode     UInt16     Reserved1[7];           // Reserved for future};typedef struct ATADevConfig ATADevConfig;&nbsp;</pre>	</TD></TR></TABLE></CENTER>                 <p><A NAME=ataConfigSetting></A><B><CODE>ataConfigSetting</CODE></B></p>            <p>This field is used to specify general device            configuration information. In general, <CODE>ataConfigSetting</CODE> is used for            things which might be device-configurable, but which            might only be known at the ATA driver level. Some of the            bits which were defined in previous versions of the ATA            Manager are now obsolete. In the current implementation            of ATA Manager 4.0, only one bit is used: </p>                        <TABLE BORDER=1>               <TR>                  <td width=60 align=left>            <p>Bits 5-0</p>                  </TD>                  <td width=112 align=left>                     <P>Reserved</P>                  </TD>                  <td width=225 align=left>                     <P>Should be 0.</P>                  </TD>               </TR>               <TR>                  <td align="left">           <p>Bit 6</p>	                  </TD>                  <td align="left">            <p>ATAPIPacketDRQ</p>	                  </TD>                  <td align="left">            <p>1=Check for Interrupt DRQ on ATAPI command DRQ<BR>0=Default-Check only for assertion of command packet DRQ</p>	                  </TD>               </TR>               <TR>                  <td width=60 align=left><p>Bits 31-7</p></TD>                  <td width=112 align=left>                     <P>Reserved</P>                  </TD>                  <td align="left">                     <P>Must be 0.</P>                  </TD>               </TR>            </TABLE>            <BR>            <P><A NAME=ataPIOSpeedMode></A><B><CODE>ataPIOSpeedMode</CODE></B></P>            <P>Device access speed in Polled I/O (PIO) Mode.</P>            <P><A NAME=atapcValid></A><B><CODE>atapcValid</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=ataRWMultipleCount></A><B><CODE>ataRWMultipleCount</CODE></B></P>            <P>Reserved for future (not supported yet).</P>            <P><A NAME=ataSectorsPerCylinder></A><B><CODE>ataSectorsPerCylinder</CODE></B></P>            <P>Reserved for future (not supported yet).</P>            <P><A NAME=ataHeads></A><B><CODE>ataHeads</CODE></B></P>            <P>Reserved for future (not supported yet).</P>            <P><A NAME=ataSectorsPerTrack></A><B><CODE>ataSectorsPerTrack</CODE></B></P>            <P>Reserved for future (not supported yet).</P>            <P><A NAME=ataSocketNumber></A><B><CODE>ataSocketNumber</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=ataSocketType></A><B><CODE>ataSocketType</CODE></B></P>            <P>Specifies the type of socket in which this ATA bus is            located. Current socket types are: </p>               <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>1 (<CODE>kATASocketInternal</CODE>)2 (<CODE>kATASocketMB</CODE>)3 (<CODE>kATASocketPCMCIA</CODE>)            </pre>	</TD></TR></TABLE></CENTER>            <P><A NAME=ataDeviceType></A><B><CODE>ataDeviceType</CODE></B></P>            <P>Specifies the type of device in this ATA bus.            Starting with ATA Manager 4.0, this field only returns            one of three device types: </p>   <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>0 (<CODE>kATADeviceUnknown</CODE>)1 (<CODE>kATADeviceATA</CODE>)2 (<CODE>kATADeviceATAPI</CODE>)            </pre>	</TD></TR></TABLE></CENTER>            <P>Older versions of the ATA Manager had a device type            defined for PCMCIA devices. This old device type (<CODE>0x03</CODE>)            will no longer be returned by ATA Manager 4. This value            will remain reserved in the future so that old drivers            will not get confused. If a driver or other client wants            to know if a device is a PC Card device, it should check            the <CODE>ataSocketType</CODE> field instead.</P>            <P><A NAME=atapcAccessMode></A><B><CODE>atapcAccessMode</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager to support a            different type of accessing mode for PC Card devices.            This mode was never implemented, and is not            supported.</P>            <P><A NAME=atapcVcc></A><B><CODE>atapcVcc</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcVpp1></A><B><CODE>atapcVpp1</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcVpp2></A><B><CODE>atapcVpp2</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcStatus></A><B><CODE>atapcStatus</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcPin></A><B><CODE>atapcPin</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcCopy></A><B><CODE>atapcCopy</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=atapcConfigIndex></A><B><CODE>atapcConfigIndex</CODE></B></P>            <P>This field is obsolete with ATA Manager 4.0. It was            used in previous versions of the ATA Manager when the ATA            Manager did much of the PC Card socket configuration.            This functionality is now handled by other software.</P>            <P><A NAME=ataSingleDMASpeed></A><B><CODE>ataSingleDMASpeed</CODE></B></P>            <P>This field is used to select the timing mode to be            used for Single-Word DMA accesses.</P>            <P><A NAME=ataMultiDMASpeed></A><B><CODE>ataMultiDMASpeed</CODE></B></P>            <P>This field describes the timing mode used for Multi-Word DMA accesses.</P>            <P><A NAME=ataPIOCycleTime></A><B><CODE>ataPIOCycleTime</CODE></B></P>            <P>This field describes the cycle time to be used for            Polled I/O (PIO) accesses.</P>            <P><A NAME=ataMultiCycleTime></A><B>ataMultiCycleTime</B></P>            <P>This field describes the cycle time to be used for            Multi-Word DMA accesses.</P>                  <P><B>Page 56: </B> <CITE>ATA_MgrInquiry</CITE></P>         <P>In the <CODE>ATA_MgrInquiry</CODE> call (page 56) the         fields <CODE>ataPIOMaxMode</CODE>,         <CODE>ataSingleDMAModes</CODE>, and         <CODE>ataMultiDMAModes</CODE> are obsolete. This         functionality has been moved to the         <CODE>ATA_BusInquiry</CODE> function (documented on page         38). This move was necessary because the ATA Manager can         support multiple buses, each of which can support different         mode sets. For example, PCMCIA ATA cards can only support         Polled I/O (PIO) data transfers, whereas internal drives on         a PowerBook 3400 can support DMA transfers.</P><P><A HREF="#top">Back to top</A></P>         <P><A NAME=ATAPresence></A></P>         <H2>Detecting the Presence of the ATA         Manager</H2>         <P>Some early ROMS could indicate that the ATA Manager         exists without proper hardware. This would cause a crash.         Therefore, you need to test for the presence of ATA hardware         before detecting the presence of the ATA Manager. The         following code snippet demonstrates how to detect the ATA         Manager properly.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// ----------------------------------------------// returns true if this machine has ATA Manager// ----------------------------------------------Boolean ATAManagerPresent(void){    UInt16  configFlags;    Boolean ATAIsHere = true;    configFlags = LMGetHWCfgFlags();    if (!(configFlags &amp; 0x0080))        ATAIsHere = false;    // (see Inside Mac VI 3-8 for TrapAvailable)    if (ATAIsHere &amp;&amp; TrapAvailable(kATATrap))        ATAIsHere = true;    return ATAIsHere;}         </pre>	</TD></TR></TABLE></CENTER>      <P><A HREF="#top">Back to top</A></P>         <P><A NAME=ATAHistory></A></P>         <H2>History of the ATA Manager         </H2>         <H3>ATA Manager 4.0 vs. ATA Manager 3.1</H3>         <P><A HREF = "#ATA4.0">ATA Manager 4.0</A> is PowerPC-Native.         ATA Manager 4.0 introduces the concept of the ATA Interface         Module or AIM, a plug-in hardware abstraction layer similar         to the SIM of SCSI Manager 4.3. The         <CODE>ATA_DeviceConfig</CODE> function has some fields which         are obsolete, starting with ATA Manager 4.0.</P>         <H3>ATA Manager 3.1 vs. ATA Manager 3.0</H3>         <P>The major change from version 3.0 to version 3.1 was the         addition of bus-specific transfer timing information to         function <CODE>ATA_BusInquiry</CODE>, rather than general         system timing information through         <CODE>ATA_MgrInquiry</CODE>. No new functions were added to         the interface.</P>         <P>Altered functions for ATA Manager 3.0 are: </P>         <UL>            <LI><CODE>ATA_ManagerInquiry</CODE></LI>            <LI><CODE>ATA_BusInquiry</CODE></LI>         </UL>         <P>The ATA Manager reports its overall data transfer         capabilities via the <CODE>ATA_ManagerInquiry</CODE>         function. For ATA Manager 3.1 and higher, the         <CODE>ATA_BusInquiry</CODE> function further separates and         specifies the transfer capabilities of the individual         buses.</P>         <H3>ATA Manager 3.0 vs. ATA Manager 2.0</H3>         <P>The major feature added to ATA Manager 3.0 was         the support of DMA I/O operations to the device. No new         functions were added to the interface, although several         functions now accept or report DMA-specific information.</P>         <P>Expanded functions for ATA Manager 3.0 are: </P>         <UL>            <LI><CODE>ATA_ManagerInquiry</CODE></LI>            <LI><CODE>ATA_SetConfiguration</CODE></LI>            <LI><CODE>ATA_GetGonfiguration</CODE></LI>         </UL>         <H3>ATA Manager 2.0 vs. ATA Manager 1.0</H3>         <P>The following list outlines several major features which         were added in ATA Manager 2.0: </P>         <UL>            <LI>Support ATAPI protocol</LI>            <LI>Support for PCMCIA devices</LI>            <LI>Support hot plug/removal devices through Card            Services</LI>            <LI>Dynamic device driver loading and purging</LI>            <LI>Client callback messaging/event notification            system</LI>            <LI>Support for location icon and string</LI>         </UL>         <P>New functions were added and existing functions were         expanded to support new features listed above. Consequently,         different <CODE>ataPBVers</CODE> values may result in different responses         for a given function. Refer to individual functions for         potential differences in response.</P>         <P>New functions for ATA Manager 2.0 are: </P>         <UL>            <LI><CODE>ATA_EjectDrive</CODE></LI>            <LI><CODE>ATA_GetDevConfig</CODE></LI>            <LI><CODE>ATA_SetDevConfig</CODE></LI>            <LI><CODE>ATA_DriverLoad</CODE></LI>         </UL>         <P>Expanded functions for ATA Manager 2.0 are: </P>         <UL>            <LI><CODE>ATA_RegAccess</CODE></LI>            <LI><CODE>ATA_DrvrRegister</CODE></LI>            <LI><CODE>ATA_DrvrDeregister</CODE></LI>            <LI><CODE>ATA_FindRefNum</CODE></LI>            <LI><CODE>ATA_MgrInit</CODE></LI>            <LI><CODE>ATA_MgrShutDown</CODE></LI>         </UL>         <P>In version 1.0 of the ATA manager, the         <CODE>ataPBActualTxCount</CODE> field is not updated for         <CODE>ExecIO</CODE> operations. This is also mentioned in         the <a href="../../documentation/hardware/Developer_Notes/Macintosh_CPUs-PPC_Desktop/PPC_5200_6200.pdf">Power         Macintosh 5200/75 and Power Macintosh 6200/75 Computers</A>         developer note.</P>          <P><A HREF="#top">Back to top</A></P>         <P><A NAME="ATA4.0"></A></P>         <H2>ATA Manager 4.0</H2>         <P>ATA Manager 4.0 is a redesign of the previous ATA Manager         (3.1) undertaken in conjunction with the design of the         PowerBook 3400. It is our expectation that every new CPU         that supports ATA devices will use this new ATA Manager.         The API between ATA Manager 4.0 and its clients (typically         ATA and ATAPI disk device drivers) is a superset of ATA         Manager 3.1. This allows old disk drivers to function         correctly with the new ATA Manager.</P>         <P>The ATA Manager prior to ATA 4.0 had knowledge about         specific types of ATA bus controllers. When a new CPU was         developed that had a different ATA bus controller, the ATA         Manager needed to be revised. The ATA 4.0 design contains a         hardware abstraction layer called the <I>ATA Interface         Module</I> or <I>AIM</I>. This AIM is a native driver         (<CODE>ndrv</CODE>), but it is not called using the device manager.         Instead, it has the driver option         <CODE>kDriverIsUnderExpertControl</CODE> set, meaning that         it is completely controlled by an expert (in this case the         ATA Manager). Any new CPU project needs only to create a set         of AIMs appropriate for the ATA bus controllers present in         that project, and leave the ATA Manager itself         untouched.</P>         <P>The Operating System's Name Registry is used to contain         all of the hardware-specific information related to the ATA         bus controller. The ATA Manager will use the Name Registry         to locate and load the AIM, and the AIM will use CPU         specific information stored in the Name Registry to do its         initialization. For example, the base address of the ATA         registers will be calculated by <CODE>OpenFirmware</CODE> or some other         piece of system software and will be used by the AIM to talk         to the ATA bus controller.</P>         <P>There is currently no documentation available to external         developers who wish to write an AIM. Such developers should         contact Developer Support at the          <a href="http://developer.apple.com/contact/index.html">Contact Us</a> page.         Apple may work together with such developers to help develop         appropriate documentation.</P>         <P>While ATA Manager 4.0 is PowerPC-native, it still can         be accessed using the 68K trap. If you wish to call the ATA         manager on Power PC-equipped machines, you need to supply         some Mixed Mode glue to call the <CODE>ataManager</CODE> trap. The         following code will work: </P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#include &lt;MixedMode.h&gt;#include &lt;ATA.h&gt;#define RESULT_OFFSET(type) \    ((sizeof(type) == 1) ? 3 : ((sizeof(type) == 2) ? 1 : 0))#define TBTrapTableAddress(trapNum) (((trapNum &amp; 0x03FF) &lt;&lt; 2) +0xE00)pascal SInt16 ataManager(ataPB *pb){    #ifdef applec        #if sizeof(SInt16) &gt; 4            #error "Result types larger than 4 bytes are not supported."        #endif    #endif    long    private_result;    private_result = CallUniversalProc(        *(UniversalProcPtr*)TBTrapTableAddress(0xAAF1),        kPascalStackBased         | RESULT_SIZE(SIZE_CODE(sizeof(SInt16)))         | STACK_ROUTINE_PARAMETER(1, SIZE_CODE(sizeof(pb))),        pb);    return *(((SInt16*)&amp;private_result) + RESULT_OFFSET(SInt16));}</pre>	</TD></TR></TABLE></CENTER>      <P><A HREF="#top">Back to top</A></P>               <H2><A NAME=Addenda></A>Additional Event Documentation</H2>         <P>The following events were not well-documented in         <A HREF = "#ATAGuide"><I>ATA Device Software</I>         Guide</A>.</P>                    <P><CODE>kATAOnlineEvent</CODE> (code 1)</P>            <P>This event notifies clients when an ATA or ATAPI            device becomes available for use. The event occurs either            when a new device is connected to the bus, or when a            previously unavailable device becomes available again (as            in system wakeup when power is restored to the            device).</P>            <P>If the device has a registered driver, only that            driver will be notified of the event; otherwise, each            registered default driver will be notified until a driver            responds favorably (that is, with a <CODE>noErr</CODE>             response to the event). Note that for newly connected devices a driver            loaded from the device is given priority.</P>            <P>Drivers should keep track of whether the device            coming online is a newly connected device or one that's            currently offline (that is, connected but not            unavailable). A device should be considered connected            until a <CODE>kATARemovedEvent</CODE> event for the device            occurs.</P>            <P><CODE>kATAOfflineEvent</CODE> (code 2)</P>            <P>This event notifies the registered driver of an ATA            or ATAPI device that the device is now unavailable for            use (offline). The device, however, is still connected to            the bus and the offline state is assumed to be temporary.            This event will occur at system sleep when power is            removed.</P>            <P>Currently, this event is generated only when the ATA            Manager receives a <CODE>PM_SUSPEND</CODE> event            (essentially the same as a Power Manager sleep demand            event) from the PC Card Manager. Drivers receiving            <CODE>kATAOfflineEvent</CODE> events most likely will            want to maintain control of the device but deny access to            the device to its clients. In addition, the driver            should note that the device may need to be reconfigured            when it comes online again (a            <CODE>kATAOnlineEvent</CODE> event will be generated when            this happens).</P>            <P><CODE>kATARemovedEvent</CODE> (code 3)</P>            <P>This event notifies the registered driver of an ATA            or ATAPI device that the device has been removed. The            removal may be either controlled (for example, a software            eject command to the ATA Manager) or uncontrolled (for            example, a forced removal by the user). Note that the            device may have been in either an online or an offline            state before the removal. If the state was online before            the removal, a <CODE>kATAOfflineEvent</CODE> event is not            generated, since the removal implies that an offline            condition had to occur.</P>            <P><CODE>kATAResetEvent</CODE> (code 4)</P>            <P>This event notifies the registered driver of an ATA            or ATAPI device that the device has been reset. The            device may need to be reconfigured by the driver before            it can be used again. This event was created for use with            multiple devices per bus (ATA Master/Slave mode), since            reset applies to all devices on the bus and not to a            specific device. Apple currently doesn't implement            multiple devices per bus with ATA, so this event isn't            implemented. However, drivers now support            this event to prevent problems later on when the            event is implemented.</P>            <P><CODE>kATAOfflineRequest</CODE> (code 5)</P>            <P>This event is obsolete. It was defined for the early            stages of the PC Card Manager, which would echo the Power            Manager sleep events to its clients. The ATA Manager            would in turn echo the request to its clients. This event            was like the sleep request event. The current PC Card            Manager allows only for an event akin to a sleep demand            event, which does not permit rejection by the            client.</P>            <P><CODE>kATAEjectRequest</CODE> (code 6)</P>            <P>This event notifies the registered driver of an ATA            or ATAPI device that a request has been made to eject the            device. If the response to the request is 0, the device            will be ejected and a subsequent            <CODE>kATARemovedEvent</CODE> event will be generated            when the ejection is successful. The            <CODE>kATAEjectRequest</CODE> event serves as a            protection mechanism to alert drivers of a pending            ejection. Drivers will most likely want to reject the            request unless they initiated the request, since ejection            will remove the device from the bus.</P>                  <P>Note also that the <CODE>kATAResetEvent</CODE>,         <CODE>kATAOfflineRequest</CODE>, and         <CODE>kATAEjectRequest</CODE> events are not currently         implemented in the ATA Manager.</P>            <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Obsolete></A></P>         <H2>Obsolete Resources</H2>         <P>The following are some other places where the ATA Manager         has been documented. These documents should be considered         obsolete. They are replaced by the <A HREF = "#ATAGuide"><I>ATA         Device Software Guide</I></A> and this technote: </P>         <UL>            <LI><A HREF = "http://developer.apple.com/documentation/hardware/hardware2.html">Macintosh            PowerBook 150</A></LI>            <LI><A HREF = "http://developer.apple.com/documentation/hardware/hardware2.html">Macintosh            Macintosh PowerBook 190</A></LI>            <LI><A HREF = "http://developer.apple.com/documentation/hardware/hardware2.html">Macintosh            Macintosh PowerBook 5300</A></LI>            <LI><A HREF = "http://developer.apple.com/documentation/hardware/hardware2.html">Macintosh            Macintosh PowerBook Duo 2300</A></LI>            <LI><a href="../../documentation/hardware/hardware2.html">Macintosh            Macintosh Quadra 630</A></LI>            <LI><a href="../../documentation/hardware/hardware2.html">Macintosh            Power Macintosh 5200 and 6200</A></LI>            <LI><a href="../../documentation/hardware/hardware2.html">Macintosh            Power Macintosh 5260</A></LI>            <LI><a href="../../documentation/hardware/hardware2.html">Macintosh            Power Macintosh 5400</A></LI>         </UL>         <P><a href="../../qa/dv/dv24.html">Q&amp;A DV 24, ATA Manager         Events Clarified</A> has some additional ATA events. These         events are incorporated in this document. This Q&amp;A, which is         incorporated in this document, should now be         considered obsolete.</P>         <P><a href="../../qa/dv/dv26.html">Q&amp;A DV 26, Calling         ataManager on a Power Macintosh</A> demonstrates how to call         the ATA Manager from PowerPC code. This Q&amp;A, which is         incorporated in this document, should now be         considered obsolete.</P>         <P>The <a href="http://developer.apple.com/dev/techsupport/develop/issue26/macqa.html">Q&amp;As         of develop issue 26</A> have some additional documentation         of some ATA events. These are the same events discussed in         <a href="../../qa/dv/dv24.html">Q&amp;A DV 24, ATA Manager Events         Clarified.</A> These events are incorporated in this document.         The <I>develop</I> Journal Q&amp;As should be considered         obsolete.</P>         <P><A NAME=Valid></A></P><P><A HREF="#top">Back to top</A></P>         <H2>Valid Resources</H2>                  <P>The <A HREF = "#ATAGuide">ATA Device Software                  Guide</A> and this document should be considered the                   current definitive documentation on the ATA                  Manager. All other documentation that references                  the ATA Manager should be considered suspect or                  obsolete.</P>                  <P><A HREF = "tn1094b.html#Implementation5">Technote                  1094, Virtual Memory Application Compatibility</A>                  discusses virtual memory and the ATA Manager. This                  document does <I>not</I> repeat those discussions.                  You should read Technote 1094 for a further                  understanding of the interaction of virtual memory                  and the ATA Manager.</P>                  <P><A HREF = "../dv/dv_22.html">Technote DV 22,                  CD-ROM Driver Calls</A> discusses ATA CD-ROM driver                  calls. These calls remain valid. You should read                  Technote DV 22 if you are trying to use an ATA                  CD-ROM, such as those which ship on the PowerBook                  1400 or PowerBook 3400.</P>                  <P><A HREF = "http://developer.apple.com/samplecode/Sample_Code/Devices_and_Hardware/ATA/ATADemo.htm">ATA                  Demo</A> is sample code demonstrating how to call                  the ATA Manager. You should look at this code for                  additional details of how to scan the ATA bus.</P>                        <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Summary></A></P>         <H2>Summary</H2>         <P>ATA Manager 4.0 is a superset of ATA Manager 3.0,         documented in the <A HREF = "#ATAGuide"><I>ATA Device Software         Guide</I></A>. There are some minor errors in that document.         We welcome any additions or corrections to this technote or         the <A HREF = "#ATAGuide"><I>ATA Device Software         Guide</I></A>; please use the <a href="http://developer.apple.com/contact/index.html">Contact Us</a> page.</P><P><A HREF="#top">Back to top</A></P><a name="References"></a><H2>References</H2>         <P>Some of the following documents may be available from         http://fission.dt.wdc.com/x3t13/x3t13.html         or ftp://ftp.symbios.com/pub/standards/io/</P>            <p><A HREF = "#ATAGuide"><I>ATA Device Software            Guide</I></A></p>            <p><EM>AT Attachment Interface for Disk Drives</EM>,            ANSI X3.221-1994, Approved May 12, 1994.</p>            <p><EM>AT            Attachment Interface with Extensions (ATA-2)</EM>, ANSI            ASC X3.279-1996, revision 3, proposed American National            Standard 948D.</p>            <p><EM>AT            Attachment-3 Interface (ATA-3)</EM>, ANSI ASC            X3.298-199x.</p>            <p><EM>AT Attachment-4 Interface (ATA-4)</EM>, X3T13            draft.</p>            <p><EM>ATA packet Interface for CD-ROMs</EM>, SFF-8020,            Revision 1.2, June 13 1994.</p>            <p><EM>Western Digital Enhanced IDE Implementation            Guide</EM>, by Western Digital Corporation, revision            5.0.</p>            <p><EM>Fast ATA Sourcebook</EM>, Quantum Corporation,            November 1994.</p>            <p><EM>Enhanced Disk Drive Specification</EM>, by            Phoenix Technologies Ltd., version 1.1, January 95.</p>        <A NAME=ATAGuide></A> <P><A HREF="#top">Back to top</A></P><a name="Changes"></a><H2>Change History</H2> <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-July-1997</P>               </TD>               <td align="left">                  <P>Originally written as Technote 1098 --             ATA Device Software Guide Additions and Corrections.</P>               </TD>            </TR> <TR>               <td width=100 align=left>                  <P ALIGN=center>18-May-1998</P>               </TD>               <td align="left">                  <P>Updated to reflect both             corrections to the original guide, as well as some minor additions             for ATA Manager 4.0.</P>               </TD>            </TR></table><BR>          <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (76K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1098.pdf">Download</A></P>               </TD>            </TR>             <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/bluebook.gif" width=22 height=23 align=bottom alt="Bluebook gif"></P>               </TD>               <td align="left">                  <P><I>ATA Device Software Guide</I></p>               </TD>               <td width=60 align=left>                  <P><A HREF = "http://developer.apple.com/documentation/hardware/DeviceManagers/ata/ata_ref/ATA.1.html">View</A></P>               </TD>            </TR>           </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content -->		<!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1098.html%3Fid%3DDTS10002938-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1098.html%3Fid%3DDTS10002938-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1098.html%3Fid%3DDTS10002938-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>