<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QTKit Capture Programming Guide: Creating a QTKit Stop or Still Motion Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating a QTKit Stop or Still Motion Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004574-CH6" title="Creating a QTKit Stop or Still Motion Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../Cocoa-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000495" target="_top">Cocoa</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004574-CH1-DontLinkElementID_41">QTKit Capture Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004574-CH6-SW7" title="Creating a QTKit Stop or Still Motion Application"></a><h1>Creating a QTKit Stop or Still Motion Application</h1><p>Now that you've worked through the examples in the previous chapters of this guide—building and extending the functionality of your QTKit capture player application, adding audio and DV camera support—you'll be ready to take on another coding assignment. The goal here is, once again, to extend your knowledge of the QTKit capture API. </p><p>Because the API supports frame-accurate, real-time motion capture, you'll discover a broad range of possible uses and applications. One such usage is <strong>still or stop motion animation</strong>. This is a popular animation technique first introduced in Walt Disney’s 1959 classic film <em>Noah’s Ark</em>. Basically, it involves making still objects appear as if they are in motion by adding single frames together into a movie. It’s a way of animating objects and bringing them visually to life on the screen. Stop or still motion animators have employed this technique—making static objects appear to move when played back at normal speed—in countless movies, TV commercials, and TV shows since the days of Disney. </p><p>Following the steps outlined in this chapter, you'll construct a simple still motion capture application that lets you capture a live video feed, grab frames one at a time with great accuracy, and then record the output of those frames to a QuickTime movie. You’ll be able to accomplish this with less than 100 lines of Objective-C code, constructing the sample as you’ve done in previous chapters, in Xcode 3 and Interface Builder 3. </p><p>In building your still motion capture application, you’ll work with the following three QTKit classes:</p><ul class="ul"><li class="li"><p><code>QTCaptureSession</code>. The primary interface for capturing media streams.</p></li><li class="li"><p><code>QTCaptureDecompressedVideoOutput</code>. The output destination for a <code>QTCaptureSession</code> object that you can use to process decompressed frames from the video that is being captured. Using the methods provided in this class, you can produce decompressed video frames that are suitable for high-quality video processing. </p></li><li class="li"><p><code>QTCaptureDeviceInput</code>. The input source for media devices, such as cameras and microphones. </p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_12">Set Up Your Project</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-SW1">Prototype the Still Motion Capture Application</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_13">Create the Project Using Xcode 3</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_16">Create the User Interface Using Interface Builder 3</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_17">Prepare to Capture Single Frame Video</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-SW6">Complete the Project Nib File in Xcode</a>
				
			<br/>
			
        
			
			
				<a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_18">Implement and Build Your Still Motion Capture Application</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_12" title="Set Up Your Project"></a><h2>Set Up Your Project</h2><p>If you’ve come to this chapter without working through the code examples in the previous chapters of this guide, you may want to return to the sections beginning with <span class="content_text"><a href="../BuildingCaptureApplication/BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-SW16">“First Steps.”</a></span> Those sections provide you with a background understanding of how to work with Xcode and Interface Builder. </p><p>You’ll need, as described in previous chapters, to be running Mac OS X v10.5 and have the following items installed on your system: </p><ul class="ul"><li class="li"><p>Xcode 3 and Interface Builder 3. Note that although you can use Xcode 2.2 to build your project, to take full advantage of the new programming features available, you’ll want to use Xcode 3. Also, Interface Builder 3 provides a new paradigm for working with and building the user interface for your application. Palettes are no longer provided; instead, you’ll work with a new library of controls that are designed to enable you to hook up the components of your user interface with greater ease and efficiency. In the end, you’ll be able to build applications faster and take advantage of this rich, new library of controls.</p></li><li class="li"><p>The QuickTime Kit framework, which resides in the Mac OS X v10.5 <code>System/Library/Frameworks</code> directory as <code>QTKit.framework</code>.</p></li><li class="li"><p>An iSight camera connected to your computer. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_33" title="Important:"></a><p><strong>Important:</strong>&nbsp;The complete sample code discussed in this chapter is available for download at <span class="content_text"><a href="http://developer.apple.com/samplecode/QuickTime/idxCocoa-date.html" target="_top">Sample Code: QuickTime Cocoa</a></span>, as <code>StillMotion</code>.</p><p></p></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_34" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>StillMotion</code> sample code described in this chapter will not support input from DV cameras, which are of type <code>QTMediaTypeMuxed</code>, rather than <code>QTMediaTypeVideo</code>. To add support for DV cameras, read the chapter <span class="content_text"><a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html#//apple_ref/doc/uid/TP40004574-CH5-SW1">“Adding Audio Input and DV Camera Support.”</a></span></p></div></li></ul><a name="//apple_ref/doc/uid/TP40004574-CH6-SW1" title="Prototype the Still Motion Capture Application"></a><h2>Prototype the Still Motion Capture Application</h2><p>Just as you’ve done in the section <span class="content_text"><a href="../BuildingCaptureApplication/BuildingCaptureApplication.html#//apple_ref/doc/uid/TP40004574-CH4-SW17">“Prototype the Capture Player,”</a></span> you may want to start by creating a rough sketch of your QTKit still motion capture application. Think, again, of what design elements you want to incorporate into the application. Rather than simply jumping into Interface Builder and doing your prototype there, you may want to visualize the elements first in your rough sketch, as shown in <span class="content_text">Figure 4-2</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_35" title="Figure 4-1Prototype sketch of QTKit still motion capture application"></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>Prototype sketch of QTKit still motion capture application</p><img src = "../Art/still_motion_sketch.jpg" alt = "Prototype sketch of QTKit still motion capture application" ></div><br/><p>In this design prototype, you can start with three simple objects: a capture view, a QuickTime movie view, and a single button to add frames. These will be the building blocks for your application. You can add more complexity to the design later on. After you’ve sketched out your prototype, think how you’ll be able to hook up the objects in Interface Builder and what code you need in your Xcode project to make this happen. </p><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_13" title="Create the Project Using Xcode 3"></a><h2>Create the Project Using Xcode 3</h2><p>To create the project, follow these steps:</p><ol class="ol"><li class="li"><p>Launch Xcode 3 (shown in <span class="content_text">Figure 4-2</span>) and choose File > New Project.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW2" title="Figure 4-2The Xcode 3 icon"></a><p><strong>Figure 4-2&nbsp;&nbsp;</strong>The Xcode 3 icon</p><img src = "../Art/xcode3_icon.jpg" alt = "The Xcode 3 icon" ></div></li><li class="li"><p>When the new project window appears, select Cocoa Document-based Application.</p></li><li class="li"><p>Name the project <code>StillMotion</code> and navigate to the location where you want the Xcode application to create the project folder. Now the Xcode project window appears, as shown in <span class="content_text">Figure 4-3</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW3" title="Figure 4-3The StillMotion Xcode project window"></a><p><strong>Figure 4-3&nbsp;&nbsp;</strong>The StillMotion Xcode project window</p><img src = "../Art/stillmo_proj.jpg" alt = "The StillMotion Xcode project window" ></div></li><li class="li"><p>Next, you need to add the QuickTime Kit framework to your <code>StillMotion</code> project. This framework resides in the <code>System/Library/Frameworks</code> directory. Although obvious, this step is sometimes easy to forget. Note that you don’t need to add the QuickTime framework to your project, just the QuickTime Kit framework. Choose Project > Add to Project.</p></li><li class="li"><p>Select <code>QTKit.framework</code>, and click Add when the Add To Targets window appears to add it to your project. </p></li><li class="li"><p>Now you also need to add the Quartz Core framework to your project. It resides in the <code>System/Library/Frameworks</code> directory. Choose Project > Add to Project. Select <code>QuartzCore.framework</code>, and click Add when the Add To Targets window appears.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_36" title="Important:"></a><p><strong>Important:</strong>&nbsp;This completes the first sequence of steps in your project. In the next sequence, you’ll move ahead to define actions and outlets in Xcode <em>before</em> working with Interface Builder. This may involve something of a paradigm shift in how you may be used to building and constructing an application with versions of Interface Builder prior to Interface Builder 3. Because you’ve already prototyped your QTKit still motion capture application, at least in rough form with a clearly defined data model, you can now determine which actions and outlets need to be implemented. In this case, you have a <code>QTCaptureView</code> object, which is a subclass of NSView, a <code>QTMovieView</code> object to display your captured frames and one button to record your captured media content and add each single frame to your QuickTime movie output.</p><p></p></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_14" title="Import the QTKit Headers and Set Up Your Implementation File"></a><h3>Import the QTKit Headers and Set Up Your Implementation File</h3><ol class="ol"><li class="li"><p>Double-click your <code>MyDocument.h</code> declaration file in your Xcode project and open it. In the file, delete the <code>#import &lt;Cocoa/Cocoa.h></code> statement and replace it with <code>#import &lt;QTKit/QTkit.h></code>. </p></li><li class="li"><p>Double-click your <code>MyDocument.m</code> implementation file in your project to open it. Delete the contents of the file except for the following lines of code: </p><div class="codesample"><table><tr><td scope="row"><pre>#import "MyDocument.h"<span></span></pre></td></tr><tr><td scope="row"><pre>@implementation MyDocument<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSString *)windowNibName<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return @"MyDocument";<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_15" title="Determine the Actions and Outlets You Want"></a><h3>Determine the Actions and Outlets You Want</h3><ol class="ol"><li class="li"><p>Now you can begin adding outlets and actions. In your <code>MyDocument.h</code> file, add the instance variables <code>mCaptureView</code> and <code>mMovieView</code> in the following lines of code:</p><div class="codesample"><table><tr><td scope="row"><pre>IBOutlet QTCaptureView *mCaptureView;<span></span></pre></td></tr><tr><td scope="row"><pre>IBOutlet QTMovieView   *mMovieView;<span></span></pre></td></tr></table></div></li><li class="li"><p>You also want to add this action method:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)addFrame:(id)sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>Now open your <code>MyDocument.m</code> file and add the same action method, followed by braces for the code you’ll add later to implement this action.</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)addFrame:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	</li></ol><p>This completes the second stage of your project. Now you’ll need to shift gears and work with Interface Builder 3 to construct the user interface for your project. </p><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_16" title="Create the User Interface Using Interface Builder 3"></a><h2>Create the User Interface Using Interface Builder 3</h2><p>In the next phase of your project you’ll see how seamlessly Interface Builder and Xcode work together, enabling you to construct and implement the various elements in your project more efficiently and with less overhead.</p><ol class="ol"><li class="li"><p>Open Interface Builder 3 (<span class="content_text">Figure 2-4</span>) and click the <code>MyDocument.nib</code> file in your Xcode project window. Because of the new integration between Xcode 3 and Interface Builder 3, you’ll find the actions and outlets you’ve declared in your <code>MyDocument.h</code> file are also synchronously updated in Interface Builder 3. This will become apparent once you begin to work with your MyDocument nib file and the library of controls available in Interface Builder 3. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_37" title="Figure 4-4The new Interface Builder 3 icon"></a><p><strong>Figure 4-4&nbsp;&nbsp;</strong>The new Interface Builder 3 icon</p><img src = "../Art/ib3_icon.jpg" alt = "The new Interface Builder 3 icon" ></div></li><li class="li"><p>In Interface Builder 3, you’ll find a new library of controls. Scroll down until you find the QuickTime Capture View control, as shown in <span class="content_text">Figure 4-5</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW4" title="Figure 4-5The QuickTime Capture View object in the library"></a><p><strong>Figure 4-5&nbsp;&nbsp;</strong>The QuickTime Capture View object in the library</p><img src = "../Art/ib_lib_qtcap.jpg" alt = "The QuickTime Capture View object in the library" ></div><p>The <code>QTCaptureView</code> object provides you with an instance of a view subclass to display a preview of the video output that is captured by a capture session. </p></li><li class="li"><p>Drag the <code>QTCaptureView</code> object into your window and resize the object to fit the window, allowing room at the bottom for your Add Frame button (already shown in the illustration below) and to the right for your <code>QTMovieView</code> object in your QTKit still motion capture application.</p><p>Choose Tools > Inspector. In the Identity Inspector, select the information (“i”) icon. Click in the field Class and your <code>QTCaptureView</code> object appears, as shown in <span class="content_text">Figure 4-6</span></p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW8" title="Figure 4-6The QTCaptureView window and Class Identity in the Inspector"></a><p><strong>Figure 4-6&nbsp;&nbsp;</strong>The QTCaptureView window and Class Identity in the Inspector</p><img src = "../Art/stillmo_qtcaptureview_window.jpg" alt = "The QTCaptureView window and Class identity in the Inspector" ></div></li><li class="li"><p>Set the autosizing for the object in the Capture View Size Inspector, as shown in <span class="content_text">Figure 2-7</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_38" title="Figure 4-7Setting the autosizing for your QTCaptureView object"></a><p><strong>Figure 4-7&nbsp;&nbsp;</strong>Setting the autosizing for your <code>QTCaptureView</code> object</p><img src = "../Art/stillmo_window_autosize.jpg" alt = "Setting the autosizing for your QTCaptureView object" ></div></li><li class="li"><p>Now you want to repeat the same sequence of steps to add your <code>QTMovieView</code> object to your Window (already shown above). Scroll down in the Library of controls until you find the <code>QTMovieView</code> object, shown in <span class="content_text">Figure 4-8</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW9" title="Figure 4-8The QTMovieView control in the Interface Builder library"></a><p><strong>Figure 4-8&nbsp;&nbsp;</strong>The QTMovieView control in the Interface Builder library</p><img src = "../Art/qtmovieview_lib_control.jpg" alt = "The QTMovieView control in the Interface Builder library" ></div></li><li class="li"><p>Select the <code>QTMovieView</code> object (symbolized by the blue Q) and drag it into your Window next to the <code>QTCaptureView</code> object, shown below.</p></li><li class="li"><p>Choose Tools > Inspector. In the Identity Inspector, select the information (“i”) icon. Click in the Class field and your <code>QTMovieView</code> object appears, as shown in <span class="content_text">Figure 4-9</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW10" title="Figure 4-9The QTMovieView object defined in the field Class"></a><p><strong>Figure 4-9&nbsp;&nbsp;</strong>The QTMovieView object defined in the field Class</p><img src = "../Art/stillmo_qtmovieview_window.jpg" alt = "The QTMovieView object defined in the field Class" ></div></li><li class="li"><p>Follow the procedure in step 4 above to set the autosizing for your <code>QTMovieView</code> object. </p></li><li class="li"><p>Now you want to specify the Window attributes in your <code>MyDocument.nib</code> file. Select the Window object in your nib and click the attributes icon in the Inspector, as shown in <span class="content_text">Figure 4-10</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW15" title="Figure 4-10The Window attributes in MyDocument.nib"></a><p><strong>Figure 4-10&nbsp;&nbsp;</strong>The Window attributes in <code>MyDocument.nib</code></p><img src = "../Art/stillmo_window_attrib.jpg" alt = "The Window attributes in MyDocument.nib" ></div></li><li class="li"><p>Define the Window size you want in your <code>MyDocument.nib</code> by selecting the size icon (symbolized by a ruler) in the Window Inspector, shown in <span class="content_text">Figure 4-11</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW17" title="Figure 4-11Defining the size of the Window"></a><p><strong>Figure 4-11&nbsp;&nbsp;</strong>Defining the size of the Window</p><img src = "../Art/window_size.jpg" alt = "Defining the size of the Window" ></div></li><li class="li"><p>Specify the delegate outlet connections of File’s Owner in the Window Connections Inspector, as shown in <span class="content_text">Figure 4-12</span>. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW16" title="Figure 4-12Specifying the delegate outlet connection for File&acirc;&#128;&#153;s Owner"></a><p><strong>Figure 4-12&nbsp;&nbsp;</strong>Specifying the delegate outlet connection for File’s Owner</p><img src = "../Art/stillmo_window_connections.jpg" alt = "Specifying the delegate outlet connection for File’s Owner" ></div></li><li class="li"><p>In the Library, select the Push Button control and drag it to the Window. Enter the text <strong>Add Frame</strong>. In autosizing, set the struts for the button at the center and right outside corner, leaving the inside struts untouched, as shown in <span class="content_text">Figure 4-13</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW5" title="Figure 4-13Specifying the autosizing for the Add Frame button"></a><p><strong>Figure 4-13&nbsp;&nbsp;</strong>Specifying the autosizing for the Add Frame button</p><img src = "../Art/button_autosize.jpg" alt = "Specifying the autosizing for the Add Frame button" ></div></li><li class="li"><p>Select the <code>MyDocument.nib</code> and click the Connections Inspector. Now you want to wire up the outlets and received actions, as shown in <span class="content_text">Figure 4-14</span>. Control-drag each outlet instance variable to the appropriate <code>MyDocument.nib</code> object.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW11" title="Figure 4-14Specifiying the actions and outlet connections in MyDocument.nib"></a><p><strong>Figure 4-14&nbsp;&nbsp;</strong>Specifiying the actions and outlet connections in MyDocument.nib</p><img src = "../Art/stillmo_mydocument_connections.jpg" alt = "Specifiying the actions and outlet connections in MyDocument.nib" ></div></li><li class="li"><p>Select the File’s Owner object in your <code>MyDocument.nib</code> and then click the Class Identity icon in the Interface Builder Inspector, as shown in <span class="content_text">Figure 4-15</span>. Note that the green light at the left corner of your StillMotion.xcodeproj is turned on, indicating that Xcode and Interface Builder have synchronized the actions and outlets in your project.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40004574-CH6-SW13" title="Figure 4-15The My Document Identity Inspector with File&acirc;&#128;&#153;s Owner selected"></a><p><strong>Figure 4-15&nbsp;&nbsp;</strong>The My Document Identity Inspector with File’s Owner selected</p><img src = "../Art/stillmo_mydocument_identity.jpg" alt = "The My Document Identity Inspector with File’s Owner selected" ></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_17" title="Prepare to Capture Single Frame Video"></a><h2>Prepare to Capture Single Frame Video</h2><p>In the last phase of your project, you’ve seen how seamlessly Interface Builder and Xcode work together, enabling you to construct and implement the various elements in your project more efficiently and with less overhead. After completing the code you need to add your Xcode project––described in the next section, <span class="content_text"><a href="CreatingStopMotionApplication.html#//apple_ref/doc/uid/TP40004574-CH6-SW6">“Complete the Project Nib File in Xcode”</a></span>––you’ll be ready to move ahead and capture single frame video, using your still motion capture application, as shown in <span class="content_text">Figure 4-16</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40004574-CH6-SW14" title="Figure 4-16 Preparing to capture single video frames and outputting those frames to a QuickTime movie"></a><p><strong>Figure 4-16&nbsp;&nbsp;</strong> Preparing to capture single video frames and outputting those frames to a QuickTime movie</p><img src = "../Art/stillmo_ready_to_capture.jpg" alt = "Preparing to capture single video frames and outputting those frames to a QuickTime movie" ></div><br/><a name="//apple_ref/doc/uid/TP40004574-CH6-SW6" title="Complete the Project Nib File in Xcode"></a><h2>Complete the Project Nib File in Xcode</h2><p>To complete the project nib file, you’ll need to define the instance variables that point to the capture session, as well as to the device input and decompressed video output objects. </p><ol class="ol"><li class="li"><p>In your Xcode project, you need to add the instance variables to the interface declaration. Add these lines of code in your <code>MyDocument.h</code> declaration file:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MyDocument : NSDocument<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>   QTMovie                                *mMovie;<span></span></pre></td></tr><tr><td scope="row"><pre>   QTCaptureSession                       *mCaptureSession;<span></span></pre></td></tr><tr><td scope="row"><pre>   QTCaptureDeviceInput                   *mCaptureDeviceInput;<span></span></pre></td></tr><tr><td scope="row"><pre>   QTCaptureDecompressedVideoOutput       *mCaptureDecompressedVideoOutput;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The <code>mMovie</code> instance variable points to the <code>QTMovie</code> object while the <code>mCaptureSession</code> instance variable points to the <code>QTCaptureSession</code> object. Likewise, the <code>*mCaptureDeviceInput</code> instance variable points to the <code>QTCaptureDeviceInput</code> object while the next line declares that the <code>mCaptureDecompressedVideoOutput</code> instance variable points to the <code>QTCaptureDecompressedVideoOutput</code> object. </p></li><li class="li"><p>There is one more instance variable you need to declare in this file: <code>mCurrentImageBuffer</code>. This instance variable stores the most recent frame that you’ve grabbed in a <code>CVImageBufferRef</code>. Add this line of code, following your last declaration:</p><div class="codesample"><table><tr><td scope="row"><pre> CVImageBufferRef                    mCurrentImageBuffer;<span></span></pre></td></tr></table></div></li><li class="li"><p>That completes the code you need to add to your <code>MyDocument.h</code> file. Now you want to open your <code>MyDocument.m</code> file and prepare to add the following blocks of code to your project. Note that the code is commented for better understanding and comprehension.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_39" title="Important:"></a><p><strong>Important:</strong>&nbsp;There is a specific, though not necessarily rigid, order of steps you want to follow in constructing your code. Think of these as specific tasks you want to accomplish in your project. </p><p></p></div><ol class="ol"><li class="ol ol"><p>Create an empty movie that writes to mutable data in memory, using the <code>initToWritableData:</code> method.</p></li><li class="ol ol"><p>Set up a capture session that outputs the raw frames you want to grab.</p></li><li class="ol ol"><p>Find a video device and add a device input for that device to the capture session.</p></li><li class="ol ol"><p>Add a decompressed video output that returns the raw frames you’ve grabbed to the session and then previews the video from the session in the document window.</p></li><li class="ol ol"><p>Start the session, using the <code>startRunning</code> method you’ve used previously in the <code>MyRecorder</code> sample code.</p></li><li class="ol ol"><p>Call a delegate method whenever the <code>QTCaptureDecompressedVideoOutput</code> object receives a frame.</p></li><li class="ol ol"><p>Store the latest frame. Do this in a <code>@synchronized</code> block because the delegate method is not called on the main thread.</p></li><li class="ol ol"><p>Get the most recent frame. Do this in a <code>@synchronized</code> block because the delegate method that sets the most recent frame is not called on the main thread.</p></li><li class="ol ol"><p>Create an <code>NSImage</code> and add it to the movie.</p></li></ol></li><li class="li"><p>Following the steps outlined above, add this block of code to your <code>MyDocument.m</code> file. </p><div class="codesample"><table><tr><td scope="row"><pre>- (void)windowControllerDidLoadNib:(NSWindowController *) aController<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSError *error = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    [super windowControllerDidLoadNib:aController];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[aController window] setDelegate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!mMovie) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an empty movie that writes to mutable data in memory<span></span></pre></td></tr><tr><td scope="row"><pre>        mMovie = [[QTMovie alloc] initToWritableData:[NSMutableData data] error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!mMovie) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSAlert alertWithError:error] runModal];<span></span></pre></td></tr><tr><td scope="row"><pre>            return;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovieView setMovie:mMovie];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!mCaptureSession) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Set up a capture session that outputs raw frames<span></span></pre></td></tr><tr><td scope="row"><pre>        BOOL success;<span></span></pre></td></tr><tr><td scope="row"><pre>        mCaptureSession = [[QTCaptureSession alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>        // Find a video device<span></span></pre></td></tr><tr><td scope="row"><pre>        QTCaptureDevice *device = [QTCaptureDevice defaultInputDeviceWithMediaType:QTMediaTypeVideo];<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [device open:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSAlert alertWithError:error] runModal];<span></span></pre></td></tr><tr><td scope="row"><pre>            return;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        // Add a device input for that device to the capture session<span></span></pre></td></tr><tr><td scope="row"><pre>        mCaptureDeviceInput = [[QTCaptureDeviceInput alloc] initWithDevice:device];<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [mCaptureSession addInput:mCaptureDeviceInput error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSAlert alertWithError:error] runModal];<span></span></pre></td></tr><tr><td scope="row"><pre>            return;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        // Add a decompressed video output that returns raw frames to the session<span></span></pre></td></tr><tr><td scope="row"><pre>        mCaptureDecompressedVideoOutput = [[QTCaptureDecompressedVideoOutput alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mCaptureDecompressedVideoOutput setDelegate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [mCaptureSession addOutput:mCaptureDecompressedVideoOutput error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!success) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSAlert alertWithError:error] runModal];<span></span></pre></td></tr><tr><td scope="row"><pre>            return;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        // Preview the video from the session in the document window<span></span></pre></td></tr><tr><td scope="row"><pre>        [mCaptureView setCaptureSession:mCaptureSession];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Start the session<span></span></pre></td></tr><tr><td scope="row"><pre>        [mCaptureSession startRunning];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	</li><li class="li"><p>Add these lines to handle window closing notifications for your device input and stop the capture session:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)windowWillClose:(NSNotification *)notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureSession stopRunning];<span></span></pre></td></tr><tr><td scope="row"><pre>    QTCaptureDevice *device = [mCaptureDeviceInput device];<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([device isOpen])<span></span></pre></td></tr><tr><td scope="row"><pre>        [device close];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following block of code to handle deallocation of memory for your capture objects:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovie release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureSession release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureDeviceInput release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mCaptureDecompressedVideoOutput release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the following lines of code to specify the output destination for your recorded media, in this case an editable QuickTime movie:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)readFromURL:(NSURL *)absoluteURL ofType:(NSString *)typeName error:(NSError **)outError<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTMovie *newMovie = [[QTMovie alloc] initWithURL:absoluteURL error:outError];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (newMovie) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [newMovie setAttribute:[NSNumber numberWithBool:YES] forKey:QTMovieEditableAttribute];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovie release];<span></span></pre></td></tr><tr><td scope="row"><pre>        mMovie = newMovie;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return (newMovie != nil);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)writeToURL:(NSURL *)absoluteURL ofType:(NSString *)typeName error:(NSError **)outError<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [mMovie writeToFile:[absoluteURL path] withAttributes:[NSDictionary dictionaryWithObject:[NSNumber numberWithBool:YES] forKey:QTMovieFlatten] error:outError];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)writeToURL:(NSURL *)absoluteURL ofType:(NSString *)typeName error:(NSError **)outError<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [mMovie writeToFile:[absoluteURL path] withAttributes:[NSDictionary dictionaryWithObject:[NSNumber numberWithBool:YES] forKey:QTMovieFlatten] error:outError];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add these lines of code to call a delegate method whenever the <code>QTCaptureDecompressedVideoOutput</code> object receives a frame:</p><div class="codesample"><table><tr><td scope="row"><pre> - (void)captureOutput:(QTCaptureOutput *)captureOutput didOutputVideoFrame:(CVImageBufferRef)videoFrame withSampleBuffer:(QTSampleBuffer *)sampleBuffer fromConnection:(QTCaptureConnection *)connection<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Store the latest frame<span></span></pre></td></tr><tr><td scope="row"><pre>    // This must be done in a @synchronized block because this delegate method is not called on the main thread<span></span></pre></td></tr><tr><td scope="row"><pre>    CVImageBufferRef imageBufferToRelease;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CVBufferRetain(videoFrame);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    @synchronized (self) {<span></span></pre></td></tr><tr><td scope="row"><pre>        imageBufferToRelease = mCurrentImageBuffer;<span></span></pre></td></tr><tr><td scope="row"><pre>        mCurrentImageBuffer = videoFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    CVBufferRelease(imageBufferToRelease);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Now you want to specify the <code>addFrame:</code> action method and get the most recent frame that you’ve grabbed. Do this in a <code>@synchronized</code> block because the delegate method that sets the most recent frame is not called on the main thread. Note that you’re wrapping a <code>CVImageBufferRef</code> object into an <code>NSImage</code>. After you create an <code>NSImage</code>, you can then add it to the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)addFrame:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CVImageBufferRef imageBuffer;<span></span></pre></td></tr><tr><td scope="row"><pre>    @synchronized (self) {<span></span></pre></td></tr><tr><td scope="row"><pre>        imageBuffer = CVBufferRetain(mCurrentImageBuffer);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (imageBuffer) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an NSImage and add it to the movie<span></span></pre></td></tr><tr><td scope="row"><pre>        NSCIImageRep *imageRep = [NSCIImageRep imageRepWithCIImage:[CIImage imageWithCVImageBuffer:imageBuffer]];<span></span></pre></td></tr><tr><td scope="row"><pre>        NSImage *image = [[[NSImage alloc] initWithSize:[imageRep size]] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>        [image addRepresentation:imageRep];<span></span></pre></td></tr><tr><td scope="row"><pre>        CVBufferRelease(imageBuffer);<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovie addImage:image forDuration:QTMakeTime(1, 10) withAttributes:[NSDictionary dictionaryWithObjectsAndKeys:<span></span></pre></td></tr><tr><td scope="row"><pre>@"jpeg", QTAddImageCodecType, nil]];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovie setCurrentTime:[mMovie duration]];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovieView setNeedsDisplay:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self updateChangeCount:NSChangeDone];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40004574-CH6-DontLinkElementID_18" title="Implement and Build Your Still Motion Capture Application"></a><h2>Implement and Build Your Still Motion Capture Application</h2><p>After you’ve saved your project, click Build and Go. After compiling, click the <strong>Add Frame</strong> button to record each captured frame and output that frame to a QuickTime movie. The output of your captured session is saved as a QuickTime movie .</p><p>Now you can begin capturing and recording with your QTKit still motion capture player application. Using a simple iSight camera, your output appears as a three-frame QuickTime movie, as shown in <span class="content_text">Figure 4-17</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40004574-CH6-SW12" title="Figure 4-17Still motion recorded output as a three-frame QuickTime movie"></a><p><strong>Figure 4-17&nbsp;&nbsp;</strong>Still motion recorded output as a three-frame QuickTime movie</p><img src = "../Art/qtmovie_3frame_output.jpg" alt = "Still motion recorded output as a three-frame QuickTime movie" ></div><br/>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AddingAddingAudioandDVSupport/AddingAddingAudioandDVSupport.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/CreatingStopMotionApplication/CreatingStopMotionApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/CreatingStopMotionApplication/CreatingStopMotionApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/CreatingStopMotionApplication/CreatingStopMotionApplication.html%3Fid%3DTP40004574-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>