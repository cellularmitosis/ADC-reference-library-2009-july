<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Apple Events Programming Guide: Writing and Installing Coercion Handlers</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Writing and Installing Coercion Handlers"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001449-CH208" title="Writing and Installing Coercion Handlers"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000494" target="_top">Carbon</a> &gt; <a href="../intro_aepg/intro_aepg.html#//apple_ref/doc/uid/TP40001449-CH201-DontLinkElementID_65">Apple Events Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../create_send_aepg/create_send_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../debugging_aepg/debugging_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001449-CH208-BABDAJGB" title="Writing and Installing Coercion Handlers"></a><h1>Writing and Installing Coercion Handlers</h1><p><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_154"></a><strong>Coercion</strong><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_155"></a> is the process of converting a descriptor and the data it contains from one type to another. When coercing between types, by definition the descriptor type is changed to the new type. However, if the underlying data representation is the same, data conversion is not required.</p><p>Functions that perform coercions are referred to as <strong>coercion handlers</strong><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_156"></a>. The Mac OS provides default coercion handlers to convert between many different descriptor types. Default handlers can, for example, convert aliases to file system specifications, integers to Boolean data types, and characters to numeric data types. These handlers may be implemented by the Apple Event Manager, the Open Scripting framework, or other frameworks. <span class="content_text"><a href="../appendix3_aepg/appendix3_aepg.html#//apple_ref/doc/uid/TP40001449-CH213-SW1">Table C-2</a></span> lists descriptor types and the available default coercions.</p><p>You can also provide your own coercion handlers to perform coercions that the default handlers don’t support. This chapter describes how to write coercion handlers and how to install them so that they are available to your application.</p><p>For many of the Apple Event Manager functions that your application uses to extract data from an Apple event, you can specify a desired descriptor type for the returned data. If the original data is of a different type, the Apple Event Manager attempts to coerce the data to the requested descriptor type. For more information on functions that let you specify a desired descriptor type, see <span class="content_text"><a href="../data_in_ae_aepg/data_in_ae_aepg.html#//apple_ref/doc/uid/TP40001582-BABGDHIB">“Coercing Data From an Apple Event.”</a></span></p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_19">How Coercion Handlers are Installed and Dispatched</a>
				
			<br/>
			
        
			
			
				<a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGJFIHD">Writing a Coercion Handler</a>
				
			<br/>
			
        
			
			
				<a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGHAEIH">Installing a Coercion Handler</a>
				
			<br/>
			
        
			
			
				<a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_20">Testing a Coercion Handler</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_19" title="How Coercion Handlers are Installed and Dispatched"></a><h2>How Coercion Handlers are Installed and Dispatched</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_157"></a>Coercion handling works by a process that is similar to the one described previously for dispatching Apple events to Apple event handlers:</p><ul class="ul"><li class="li"><p>You write coercion handler functions to coerce data between types that your application works with but that are not handled by a default coercion handler.</p></li><li class="li"><p>Your application registers coercion handlers with the Apple Event Manager for all the descriptor data types it can convert between. A handler may handle just one type of coercion or multiple types. To specify multiple types, you use the constant <code>typeWildCard</code>.<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_158"></a></p></li><li class="li"><p>The Apple Event Manager creates an application coercion handler dispatch table for your application. The dispatch table maps the descriptor types your application can coerce to the coercion handlers it provides.</p><p>The Apple Event Manager also creates a system coercion dispatch handler, described below, for the default coercion handlers.</p></li><li class="li"><p>When the Apple Event Manager needs to perform a coercion in your application, it goes through these steps until the coercion is handled:</p><ul class="nested"><li class="nested li"><p>It looks for a coercion handler in your application coercion dispatch table.</p></li><li class="nested li"><p>It looks for a coercion handler in your system coercion dispatch table, which includes the default coercions described in <span class="content_text"><a href="../appendix3_aepg/appendix3_aepg.html#//apple_ref/doc/uid/TP40001449-CH213-SW1">Table C-2</a></span>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_52" title="Note"></a><p><strong>Note:</strong>&nbsp;Default coercion handlers may be installed lazily, as they are needed.</p></div></li><li class="nested li"><p>If it can’t find an appropriate coercion handler, it returns the result code <code>errAECoercionFail</code>.</p></li></ul></li></ul><p>Although your application can have both a system coercion dispatch table and an application dispatch table, you should generally install all coercion handlers in the application coercion dispatch table. For Carbon applications running in Mac OS 8 or Mac OS 9, a handler in the system coercion dispatch table could reside in the system heap, where it would be available to other applications. However, your application should not install a handler in a system coercion dispatch table with the goal that the handler will get called when other applications perform coercions—this won’t necessarily work in Mac OS 8 or Mac OS 9 and will not work in Mac OS X.<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_159"></a></p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGJFIHD" title="Writing a Coercion Handler"></a><h2>Writing a Coercion Handler</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_160"></a>When you write a coercion handler, it must do the following things:</p><ul class="ul"><li class="li"><p>Validate the information passed to it so that it has a reasonable chance of success.</p></li><li class="li"><p>Gain access to the information to be coerced.</p></li><li class="li"><p>Convert the information to the specified type.</p></li><li class="li"><p>Create a new descriptor of the specified type.</p></li></ul><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_53" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;This coercion handler uses <code>typeChar</code>, which should be avoided starting in Mac OS X version 10.3, as noted in <span class="content_text"><a href="../appendix3_aepg/appendix3_aepg.html#//apple_ref/doc/uid/TP40001449-CH213-BABDAJGB">“Default Coercion Handlers.”</a></span></p><p></p><div class="clear"></div></div><p>There are two types of coercion handlers. The first, which matches the format defined for the <code>AECoerceDescProcPtr</code><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_161"></a> data type, expects the caller to pass a descriptor containing the data to be coerced. The second, which matches the format defined for the <code>AECoercePtrProcPtr</code> data type, expects the caller to pass a a pointer to the data to be coerced. These data types are described in <em><a href="../../../../Carbon/Reference/Apple_Event_Manager/index.html#//apple_ref/doc/uid/TP30000134" target="_top">Apple Event Manager Reference</a></em>.</p><p>The examples in this chapter show how to work with a coercion handler that uses descriptors. However the differences in working with the pointer-based type are fairly straight-forward.</p><p>To write a a coercion handler named <code>CoerceApplesToOranges</code>, based on the <code>AECoerceDescProcPtr</code> data type, you would declare the handler as shown in <span class="content_text">Listing 7-1</span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGGEJGJ" title="Listing 7-1Declaring a coercion handler"></a><p class="codesample"><strong>Listing 7-1&nbsp;&nbsp;</strong>Declaring a coercion handler</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr CoerceApplesToOranges (<span></span></pre></td></tr><tr><td scope="row"><pre>    const AEDesc * fromDesc,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    DescType toType,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    long handlerRefcon,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    AEDesc * toDesc<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>The following are descriptions of the numbered parameters:</p><ol class="ol"><li class="li"><p>A pointer to the descriptor to be coerced.</p></li><li class="li"><p>The type to coerce to.</p></li><li class="li"><p> A reference variable that will be passed to your handler—you can use it for any purpose.</p></li><li class="li"><p>A descriptor pointer where the handler will store the coerced descriptor.</p><p>This routine creates a new descriptor, so it is up to the calling routine to dispose of the descriptor.</p></li></ol><p>Suppose that you want to write a coercion handler to convert text strings into your internal “bar” data type. The <code>typeBar</code> type is defined as shown in <span class="content_text">Listing 7-2</span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGFFHAC" title="Listing 7-2An application-defined data type"></a><p class="codesample"><strong>Listing 7-2&nbsp;&nbsp;</strong>An application-defined data type</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>  typeBar = 'bar!'<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 7-3</span> provides a slightly simplified version of the handler you might write.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGEDFIE" title="Listing 7-3A simple coercion handler"></a><p class="codesample"><strong>Listing 7-3&nbsp;&nbsp;</strong>A simple coercion handler</p><div class="codesample"><table><tr><td scope="row"><pre>static OSErr TextToBarCoercionHandler(const AEDesc* fromDesc, DescType toType, long handlerRefcon, AEDesc* toDesc)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr((fromDesc->descriptorType != typeChar),CoercionFailed);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr((toType != typeBar), CoercionFailed);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr((handlerRefcon != 1234), CoercionFailed);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    long dataSize = AEGetDescDataSize(fromDesc);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    char dataPtr[dataSize];<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = AEGetDescData(fromDesc, dataPtr, dataSize);<span></span></pre></td></tr><tr><td scope="row"><pre>    require_noerr(err, CoercionFailed);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    long result = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    const char* pChar = (const char*) dataPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>    while (dataSize-- > 0)<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        result += *pChar++;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = AECreateDesc(typeBar, &amp;result, sizeof(result), toDesc);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr)<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        err = errAECoercionFail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CoercionFailed:<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code in <code>TextToBarCoercionHandler</code> does:</p><ol class="ol"><li class="li"><p>Checks the passed parameters to validate that it can handle the requested coercion, using the macro <code>require_noerr</code>, which jumps to the error label <code>CoercionFailed</code> if a value isn’t supported.</p><p>Coercion handlers that support multiple types will have additional work to do here.</p></li><li class="li"><p>Checks that the passed reference constant matches the expected value. You previously set the reference constant when you installed the coercion handler (shown in <span class="content_text"><a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGHAEIH">“Installing a Coercion Handler”</a></span>).</p></li><li class="li"><p>Gets the size of the data in the descriptor to be coerced and uses it to get the actual data from the descriptor.</p></li><li class="li"><p>In a while loop, converts the data from type text to type bar (by summing the bytes).</p></li><li class="li"><p>Creates a new descriptor of type bar, using the coerced data.</p></li><li class="li"><p>If it was unable to create the coerced descriptor, returns an error indicating the coercion failed.</p></li><li class="li"><p>Whether it jumped to the error label or fell through on success, returns an error code indicating whether the coercion succeeded or failed.</p></li></ol><p>These are the main differences if you want to write a coercion handler based on the <code>AECoercePtrProcPtr</code> data type, which works with a pointer to data:</p><ul class="ul"><li class="li"><p>The coercion handler has two additional parameters: one specifies the descriptor type of the data the pointer parameter points to; the other specifies the size of the data.</p></li><li class="li"><p>When obtaining the data to convert, you use the size and type information to extract the data from the pointer, rather than getting the type and the data from a passed descriptor.<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_162"></a></p></li></ul><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGHAEIH" title="Installing a Coercion Handler"></a><h2>Installing a Coercion Handler</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_163"></a>To install a coercion handler, you use the <code>AEInstallCoercionHandler</code><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_164"></a> function, which is declared as shown in <span class="content_text">Listing 7-4</span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGCCBEC" title="Listing 7-4Declaration of AEInstallCoercionHandler"></a><p class="codesample"><strong>Listing 7-4&nbsp;&nbsp;</strong>Declaration of AEInstallCoercionHandler</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr AEInstallCoercionHandler (<span></span></pre></td></tr><tr><td scope="row"><pre>    DescType fromType,<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    DescType toType,<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    AECoercionHandlerUPP handler,<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    long handlerRefcon,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    Boolean fromTypeIsDesc,<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    Boolean isSysHandler<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>You specify as parameters to this function:</p><ol class="ol"><li class="li"><p>The descriptor type of the data coerced by the handler. You can pass <code>typeWildCard</code><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_165"></a>to accept all types.</p></li><li class="li"><p>The descriptor type of the resulting data. You can pass <code>typeWildCard</code> to accept all types.</p></li><li class="li"><p>The address of the coercion handler for this descriptor type; the handler is declared as described in <span class="content_text"><a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGJFIHD">“Writing a Coercion Handler.”</a></span></p></li><li class="li"><p>A reference constant to pass to the handler when it is called. You can use the reference constant for any purpose you want.</p></li><li class="li"><p>A Boolean value that indicates whether your coercion handler expects the data to be specified as a descriptor or as a pointer to the actual data.</p></li><li class="li"><p>A Boolean value that indicates whether your coercion handler should be added to your application’s coercion dispatch table or the system coercion dispatch table.</p></li></ol><p>To call the <code>TextToBarCoercionHandler</code> handler defined in <span class="content_text"><a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGEDFIE">Listing 7-3</a></span>, you can use code like that shown in <span class="content_text">Listing 7-5</span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGCEAEH" title="Listing 7-5Installing a coercion handler"></a><p class="codesample"><strong>Listing 7-5&nbsp;&nbsp;</strong>Installing a coercion handler</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr err = AEInstallCoercionHandler(<span></span></pre></td></tr><tr><td scope="row"><pre>                typeChar, // Coerce from this type<span></span></pre></td></tr><tr><td scope="row"><pre>                typeBar, // to this type,<span></span></pre></td></tr><tr><td scope="row"><pre>                TextToBarCoercionHandler, //using this handler,<span></span></pre></td></tr><tr><td scope="row"><pre>                1234,   //  passing this reference constant.<span></span></pre></td></tr><tr><td scope="row"><pre>                true,   //  The handler operates on descriptors,<span></span></pre></td></tr><tr><td scope="row"><pre>                false); //  and resides in the application table.<span></span></pre></td></tr></table></div><p>Here’s what the parameters in this call specify:</p><ol class="ol"><li class="li"><p>Coerce from type <code>'TEXT'</code>.</p></li><li class="li"><p>Coerce to type <code>typeBar</code>.</p></li><li class="li"><p>Use the handler <code>TextToBarCoercionHandler</code> to perform the coercion.</p></li><li class="li"><p>Pass the reference constant 1234.</p></li><li class="li"><p>The handler operates on descriptors.</p></li><li class="li"><p>The handler resides in the application’s coercion dispatch table.<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_166"></a></p></li></ol><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_20" title="Testing a Coercion Handler"></a><h2>Testing a Coercion Handler</h2><p><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_167"></a>You can use code like that shown in <span class="content_text">Listing 7-6</span> to test the <code>TextToBarCoercionHandler</code> handler defined in <span class="content_text"><a href="coercions_aepg.html#//apple_ref/doc/uid/TP40001449-CH208-CEGEDFIE">Listing 7-3</a></span>.</p><a name="//apple_ref/doc/uid/TP40001449-CH208-CEGBCBAI" title="Listing 7-6Testing a coercion handler"></a><p class="codesample"><strong>Listing 7-6&nbsp;&nbsp;</strong>Testing a coercion handler</p><div class="codesample"><table><tr><td scope="row"><pre>    AEDesc textDesc;<span></span></pre></td></tr><tr><td scope="row"><pre>    const char* kText = "1234";<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = AECreateDesc(typeChar, kText, strlen(kText), &amp;textDesc);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AEDesc barDesc;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = AECoerceDesc(&amp;textDesc, typeBar, &amp;barDesc);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Use the descriptor as needed.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Dispose of the descriptor when finished with it.<span></span></pre></td></tr><tr><td scope="row"><pre>        err = AEDisposeDesc(&amp;barDesc);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    err = AEDisposeDesc(&amp;textDesc);<span>// 4</span></pre></td></tr></table></div><p>Here is what the code in this snippet does:</p><ol class="ol"><li class="li"><p>Creates a descriptor containing the text string “1234”.</p></li><li class="li"><p>Calls the Apple Event Manager function <code>AECoerceDesc</code>, passing the text descriptor, the desired type (type bar), and the address of a descriptor in which to store the coerced descriptor.</p></li><li class="li"><p>If the coercion is successful, disposes of the coerced descriptor. Because a coercion returns a new descriptor, your application must dispose of the descriptor when it is finished with it. (This code snippet does not include full error handling.)</p></li><li class="li"><p>Disposes of the text descriptor.</p></li></ol><p>If the coercion fails, you can set a breakpoint in your coercion handler to determine if it is ever called. Possible problems include:</p><ul class="ul"><li class="li"><p>You didn’t install the coercion handler.</p></li><li class="li"><p>The type you passed to <code>AECoerceDesc</code> was different than the type you registered for your coercion handler.</p></li><li class="li"><p>The text descriptor you created has a different descriptor type than you registered for your coercion handler.</p></li></ul><p>You can install a single coercion handler that specifies the constant <code>typeWildCard</code><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_168"></a> for both the to and from types. Then any time the Apple Event Manager attempts to dispatch a coercion to the application, it will invoke that handler. This provides a convenient bottleneck for debugging.</p><p>Using wildcards can also be convenient as a general way to handle coercions, with one or a small number of handlers converting between supported types and the application’s private data types.<a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_169"></a><a name="//apple_ref/doc/uid/TP40001449-CH208-DontLinkElementID_170"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../create_send_aepg/create_send_aepg.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../debugging_aepg/debugging_aepg.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-10-31<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/AppleEvents/coercions_aepg/coercions_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/AppleEvents/coercions_aepg/coercions_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/AppleEvents/coercions_aepg/coercions_aepg.html%3Fid%3DTP40001449-1.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>