<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ColorPopUpMenus - /ColorPopUpMenus.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; <A HREF="javascript:location.replace('index.html');">ColorPopUpMenus</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxUserExperience-date.html" target="_blank">Carbon > User Experience</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ColorPopUpMenus</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ColorPopUpMenus.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/ColorPopUpMenus.c</option>
<option value="listing2.html">/ColorPopUpMenus.h</option>
<option value="listing3.html">/ColorPopUpMenus.r</option></select>
				</p>
				</form>
				<p><strong><a href="ColorPopUpMenus.zip">Download Sample</a></strong> (&#147;ColorPopUpMenus.zip&#148;, 19.1K)<BR>
<strong><a href="ColorPopUpMenus.dmg">Download Sample</a></strong> (&#147;ColorPopUpMenus.dmg&#148;, 81.0K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File: ColorPopUpMenus.c  Contains:  This file contains an example illustrating how to show swatches  of color in a labels-like menu in your own application.  It also illustrates  how to add a user adjustable color item to the menu that can be changed by  way of the color picker interface.    Behind the scenes, the color swatches in the menu are implemented as color  icon resources.  The only real tricky part here is finding the correct place  to save the color in the color icon resource.  And, two routines have been  provided that do just that.   Written by: John Montbriand  Copyright:  Copyright &copy; 1999 by Apple Computer, Inc., All Rights Reserved.  You may incorporate this Apple sample source code into your program(s) without  restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the  responsibility for its operation is yours. You are not permitted to redistribute  this Apple sample source code as &quot;Apple sample source code&quot; after having made  changes. If you're going to re-distribute the source, we require that you make  it clear in the source that the code was descended from Apple sample source  code, but that you've made changes.  Change History (most recent first):  7/19/1999 Karl Groethe - Updated for Metrowerks Codewarror Pro 2.1  10/7/1999 John Montbriand - removed bad menu resource definition, rewrote the rest :)*/#include &quot;ColorPopUpMenus.h&quot;#include &lt;Dialogs.h&gt;#include &lt;Fonts.h&gt;#include &lt;Sound.h&gt;#include &lt;Resources.h&gt;#include &lt;ColorPicker.h&gt;#include &lt;Icons.h&gt;#include &lt;Errors.h&gt;#include &lt;StdDef.h&gt;#ifndef __MWERKS__QDGlobals  qd; /* QuickDraw globals */#endif  /* gUserSelectColor is our internal copy of the user adjustable  color.  The adjustable item is initially set to this value, and  it can be adjusted by the user when ever they choose the 'Other...'  item in the pop-up menu. */RGBColor gUserSelectColor = { 0xACAC, 0xACAC, 0xACAC };  /* gUserSelectColorIcon is a handle to color icon that is used  to display the user adjustable color swatch in the 'Other...'  item in the pop-up menu. */CIconHandle gUserSelectColorIcon = NULL;/* ChangeCIconIXColor changes the index'th color in the  color icon's clut to *color. if index is out of range, then  paramErr is returned.  It'll work for any size color  icon. */  static OSErr ChangeCIconIXColor(CIconHandle cicn, short index, RGBColor *color) {  unsigned char *rover;  CTabPtr clutp;  char state;  OSErr err;    /* make sure it's in memory */  LoadResource((Handle) cicn);  if ((err = ResError()) != noErr) return err;    /* lock down the handle, we're making toolbox calls while    using a pointer to some of it's contents.  We may know that    routine probably doesn't move memory, but it's always best    to take a conservative position.  */  state = HGetState((Handle) cicn);  HLock((Handle) cicn);      /* increment to the clut in the cicn resource.  see GetCIconIXColor    for the book reference for the format spec. */  rover = ((unsigned char *) (*cicn)) + offsetof(CIcon, iconMaskData);  rover += (**cicn).iconMask.rowBytes * (**cicn).iconMask.bounds.bottom;  rover += (**cicn).iconBMap.rowBytes * (**cicn).iconBMap.bounds.bottom;  clutp = (CTabPtr) rover;      /* check to make sure the index is in range */  if ((index &lt; 0) || (index &gt; clutp-&gt;ctSize)) {      /* index out of range */    err = paramErr;  } else {      /* set the clut entry */    clutp-&gt;ctTable[index].rgb = *color;            /* reset the ctSeed value so QuickDraw with identify      the color table as 'unique'. */    clutp-&gt;ctSeed = GetCTSeed();          /* no problem...*/    err = noErr;  }        /* restore the resource handle's state */  HSetState((Handle) cicn, state);      /* done */  return err;}/* GetCIconIXColor retrieves the index'th color from the  color icon's clut.  if index is out of range, then paramErr is returned.    This routine isn't used in this example, but I added it as a  symetrical counterpart to ChangeCIconIXColor incase someone might  find it useful.  Normally, the UI will only reflect the state  of your program's internal state variables so there's no need  to query the interface elements for values being displayed. */  static OSErr GetCIconIXColor(CIconHandle cicn, short index, RGBColor *color) {  unsigned char *rover;  CTabPtr clutp;  OSErr err;      /* make sure it's in memory */  LoadResource((Handle) cicn);  if ((err = ResError()) != noErr) return err;      /* find the color table inside of the cicn resource.    The resource we're using in this example has a two    element color table.  Here, we're incrementing a    pointer past the structures in the cicn resource.    This structure is defined in the Color QuickDraw    chapter of Inside Macintosh.  That page can be    found on the web at:      http://developer.apple.com/techpubs/mac/QuickDraw/QuickDraw-268.html.  */  rover = ((unsigned char *) (*cicn)) + offsetof(CIcon, iconMaskData);  rover += (**cicn).iconMask.rowBytes * (**cicn).iconMask.bounds.bottom;  rover += (**cicn).iconBMap.rowBytes * (**cicn).iconBMap.bounds.bottom;  clutp = (CTabPtr) rover;      /* check the index range */  if ((index &lt; 0) || (index &gt; clutp-&gt;ctSize)) return paramErr;      /* save the color */  *color = clutp-&gt;ctTable[index].rgb;      /* done */  return noErr;}  /* main program.  Here, we put up a modal dialog.  When ever  the user picks the configurable color item in the menu, we  put up the color picker to allow them to adjust the color. */int main (void) {  DialogPtr dialog;  short itemHit;    /* set up the managers */  MaxApplZone();  InitGraf(&amp;qd.thePort);  InitFonts();  InitWindows();  InitMenus();  TEInit();  InitDialogs(NULL);    /* set up the user adjustable color swatch.  We'll    initially set the color displayed to our own default    color setting. Note, we call 'GetResource' instead    of 'GetCIcon'.  When the control is created in the     GetNewDialog call, GetCIcon will be called. */  gUserSelectColorIcon = (CIconHandle) GetResource('cicn', kOtherIconRsrc);  if (gUserSelectColorIcon == NULL) return 1;  ChangeCIconIXColor(gUserSelectColorIcon, kOutClutColorIndex, &amp;gUserSelectColor);    /* call up the dialog containing our color choice menu. */  dialog = GetNewDialog(kMainDialog,nil,nil);  if (dialog == NULL) return 1;  SetDialogTracksCursor(dialog, true);  SetDialogDefaultItem(dialog, kMainOK);    /* loop and process dialog events */  do {        ModalDialog(NULL, &amp;itemHit);          /* check to see if it's a hit in the menu item */    if (itemHit == kMainPopUp) {      short itemt;      ControlHandle itemc;      Rect itemb;      RGBColor inColor, outColor;      Point pickerWhere = { -1, -1 };              /* it's a hit in the menu, now test to see if the        adjustable color item was selected */      GetDialogItem(dialog, kMainPopUp, &amp;itemt, (Handle *) &amp;itemc, &amp;itemb);      if (GetControlValue(itemc) == kMainPopUpOtherItem) {                  /* let the user adjust the color for this item */        inColor = outColor = gUserSelectColor;        if (GetColor(pickerWhere, &quot;\pPick a color for the menu item.&quot;, &amp;inColor, &amp;outColor)) {                      /* if they didn't cancel out of the color picker window,            then save the color back in to our global. */          gUserSelectColor = outColor;                      /* ...then save the color back into the icon's color            table. */          ChangeCIconIXColor(gUserSelectColorIcon, kOutClutColorIndex, &amp;gUserSelectColor);            /* ...and finally, redraw the control.  This will            redraw the menu in the control, which, in turn,            will redraw the color icon with it's new color setting.*/          Draw1Control(itemc);        }      }    }  } while (itemHit != kMainOK);          /* clean up and leave */  DisposeDialog (dialog);  return 0;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ColorPopUpMenus/listing1.html%3Fid%3DDTS10000564-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ColorPopUpMenus/listing1.html%3Fid%3DDTS10000564-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ColorPopUpMenus/listing1.html%3Fid%3DDTS10000564-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>