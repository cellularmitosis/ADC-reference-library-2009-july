<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Searching for Import Libraries</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING21></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-20.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-22.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-14.html"><B>Chapter 1 - CFM-Based Runtime Architecture</B></A> / <A HREF="RTArch-20.html"><B>Preparing a Closure</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING21-0></A>
<H2><A NAME=MARKER-9-55></A>Searching for Import Libraries</H2>
 <A NAME=MARKER-2-56></A>When the Code Fragment Manager is called to prepare a fragment, if the fragment requires other import libraries to complete the closure, the Code Fragment Manager goes through an ordered search process to find physical copies of those libraries. For example, the Code Fragment Manager can search folders containing the application or the root fragment as well as a common folder specially designated to hold shared libraries. <P>
 Currently the Code Fragment Manager looks for files that contain a resource of type <CODE>'cfrg'</CODE>. The <CODE>'cfrg'0</CODE> resource identifies the fragment name of the import library. There can be more than one fragment name listed in a single <CODE>'cfrg'0</CODE> resource. This might happen if there are multiple import libraries contained in a single file or if a single import library or application is to be identified by more than one name. Fragments are typically stored in the data fork, although it is possible to store a fragment in a resource. In either case, the <CODE>'cfrg'0</CODE> resource points to the location of the fragment within the file. For more information about the <CODE>'cfrg'0</CODE> resource, see <A HREF=RTArch-25.html#MARKER-9-74>"The Code Fragment Resource," beginning on page 1-25</A>.<P>
 Once the Code Fragment Manager finds a library that is compatible with the fragment it's preparing, it stops searching and resolves imports in the fragment to code or data in that library. If it reaches the end of its search without finding a compatible library, the fragment preparation fails. <P>
<DL>
<DT><B>Note</B>
<DD>Because the Code Fragment Manager is searching for the import library by name, the file containing the library must have a <CODE>'cfrg'0</CODE> resource. However, you can prepare fragments that do not contain a <CODE>'cfrg'0</CODE> resource by calling Code Fragment Manager routines from your program. See <A HREF=RTArch-36.html#MARKER-9-21>"Calling the Code Fragment Manager," beginning on page 3-3</A>, for more information.<EM></EM><EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 In System 7 through 7.5, the search process for import libraries is as follows:<P>
<OL>
<LI><B>Check connections in the same process to see if a connection for the import library already exists.</B><P>
If the connection is already in use in another closure, then the Code Fragment Manager can simply increment its reference count and use it. <P>
If the existing connection is associated with an incompatible version of the import library, the preparation fails. In all the steps that follow, however, finding an incompatible import library version merely causes the Code Fragment Manager to move to the next step in the search procedure. See <A HREF=RTArch-22.html#MARKER-9-58>"Checking for Compatible Import Libraries" (page 1-19)</A> for more information about how the Code Fragment Manager checks for compatible libraries. 
<LI><B>Check the folder containing the root fragment.</B><P>
If the root fragment folder is not the same as the application folder, the Code Fragment Manager searches here first. The Code Fragment Manager looks only in the top level of the folder, not in any subfolders contained within it.
<LI><B>Check the file containing the application.</B><P>
Since a file can contain multiple fragments, the file containing the application fragment may also contain import library fragments. 
<LI><B>Check the application subfolder.</B><P>
When you build your application, you can designate a library folder for the Code Fragment Manager to search for import libraries. For more information, see <A HREF=RTArch-25.html#MARKER-9-74>"The Code Fragment Resource," beginning on page 1-25</A>.
<LI><B>Check the folder containing the application.</B><P>
The Code Fragment Manager looks only in the top level of the application folder, not in any subfolders contained within it. 
<LI><B>Check the Extensions folder.</B><P>
The Extensions folder usually contains import libraries used by multiple applications (libraries for QuickTime, for example). The Code Fragment Manager searches the Extensions folder and one level of folders inside the Extensions folder. 
<LI><B>Check the ROM registry.</B><P>
The ROM registry keeps track of all import libraries that are stored in the ROM of a Mac OS-based computer. The Mac OS registers all ROM-based import libraries in this registry at system startup time.
<LI><B>Check the file registry.</B><P>
The final stage of the search path is a file and directory registry that the Code Fragment Manager maintains internally. This registry, which is currently reserved for system use, is a list of files and directories that, for various reasons, cannot be put into the normal search path followed by the Code Fragment Manager or would not be recognized as import libraries even if they were in that path. <P>
</OL>
 In System 7.6, the Code Fragment Manager combines steps 6, 7, and 8, searching all three locations and choosing the import library that best fits the compatibility requirements. <P>
 The Code Fragment Manager searches a folder by looking for files of type <CODE>'shlb'</CODE> that contain a resource of type <CODE>'cfrg'</CODE>. Within a folder, the Code Fragment Manager also looks for alias files of type <CODE>'shlb'</CODE> and resolves them to their targets. <P>
 At any stage, the Code Fragment Manager selects the one import library of all those available to it that best satisfies its compatibility version checking. If an import library meets the relevant criteria, the library search stops. Otherwise, the search continues to the next stage. If the final stage (the file and directory registry) is reached and no suitable library can be found, the Code Fragment Manager gives up and does not prepare the original fragment. <A NAME=MARKER-2-57></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-20.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-22.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
