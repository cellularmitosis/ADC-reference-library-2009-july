<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Streaming Server Modules Programming Guide: Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000246" title="Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../Streaming-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000577" target="_top">Streaming</a> &gt; <a href="../Preface/Preface.html#//apple_ref/doc/uid/TP30001143-CH204-DontLinkElementID_27">QuickTime Streaming Server Modules Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Concepts/QTSSConcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Reference/QTSSRef.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_32" title="Tasks"></a><h1><a name="//apple_ref/doc/uid/TP30000246-TPXREF101" title="Tasks"></a>Tasks</h1>
<p>This chapter describes common QTSS tasks: </p>
<ul class="ul"><li class="li"><p>Building the Streaming Server, described in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-180572">&#8220;Building the Streaming Server&#8221;</a></code>.</p></li>
<li class="li"><p>Compiling and installed a QTSS module, described in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-151122">&#8220;Compiling a QTSS Module into the Server&#8221;</a></code>.</p></li>
<li class="li"><p>Getting and setting attribute values, described in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150267">&#8220;Working with Attributes&#8221;</a></code>.
This section also tells you how to add your own attributes to an
object.</p></li>
<li class="li"><p>Using the server&#8217;s file module to open, read, and close
files, described in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-147396">&#8220;Using Files&#8221;</a></code>. This section also tells you how to implement your
own file system module.</p></li>
<li class="li"><p>Communicating with the server with the Admin protocol, described
in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-144385">&#8220;Using the Admin Protocol&#8221;</a></code>.</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-180572" title="Building the Streaming Server"></a><a name="//apple_ref/doc/uid/TP30000246-CJBBFIAF" title="Building the Streaming Server"></a><h2>Building the Streaming Server</h2>
<p>This section describes the Streaming Server build and install
process for Mac OS X, POSIX, and Windows platforms.</p>
<a name="//apple_ref/doc/uid/TP30000246-180585" title="Mac OS X"></a><a name="//apple_ref/doc/uid/TP30000246-CJBEEIFB" title="Mac OS X"></a><h3>Mac OS X</h3>
<p>Use the <code>Buildit</code> script
to build the Streaming Server for Mac OS X. Use the following command
line options: <code>StreamingServer.pbroj -target
DSS</code>. As they are built, the binaries are left
in the build directory.</p>
<p>The command <code>BuildOSXInstallerPkg dss</code> creates
a file named <code>DarwinStreamingServer.pkg</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-180609" title="POSIX"></a><a name="//apple_ref/doc/uid/TP30000246-CJBGEAAG" title="POSIX"></a><h3>POSIX</h3>
<p>Use the <code>Buildit</code> script
to build the Streaming Server on POSIX platforms. Binaries are left in
the source directories. To create the installer, use the <code>buildtarball</code> script,
which creates an install directory with Install script and tar file.</p>
<a name="//apple_ref/doc/uid/TP30000246-180623" title="Windows"></a><a name="//apple_ref/doc/uid/TP30000246-CJBHDGDD" title="Windows"></a><h3>Windows</h3>
<p>Use the <code>WindowsNTSupport/StreamingServer.dsw</code> script
to build the Streaming Server on Windows platforms. Batch build
all. Binaries are left in the Debug and Release directory. The <code>WindowsNTSupport/makezip.bat</code> script
creates an install directory with an Install.bat file.</p>
<a name="//apple_ref/doc/uid/TP30000246-151104" title="Building a QuickTime Streaming Server Module"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF102" title="Building a QuickTime Streaming Server Module"></a><h2>Building a QuickTime Streaming Server
Module</h2>
<p>You can add a QTSS module to the QuickTime Streaming Server
by compiling the code directly into the server itself or by building
a module as a separate code fragment that is loaded when the server
starts up.</p>
<p>Whether compiled into the server or built as a separate module,
the code for the module is the same. The only difference is the
way in which the code is compiled.</p>
<a name="//apple_ref/doc/uid/TP30000246-151122" title="Compiling a QTSS Module into the Server"></a><a name="//apple_ref/doc/uid/TP30000246-BAJJAFJG" title="Compiling a QTSS Module into the Server"></a><h3>Compiling a QTSS Module into the Server</h3>
<p>If you have the source code for the QuickTime Streaming Server,
you can compile your module into the server.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_33" title="Note"></a><p><strong>Note:</strong>&nbsp;The source code
for the server is available at <span class="content_text"><a href="http://www.publicsource.apple.com/projects/streaming" target="_blank">http://www.publicsource.apple.com/projects/streaming</a></span>.</p></div>
<p>To compile your code into the server, locate the function <code>QTSServer::LoadCompiledInModules</code> in <code>QTSServer.cpp</code> and
add to it the following lines</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTSSModule* myModule = new QTSSModule(&quot;__XYZ__&quot;);<span></span></pre></td></tr><tr><td scope="row"><pre>(void)myModule-&gt;Initialize(&amp;sCallbacks, &amp;__XYZMAIN__);<span></span></pre></td></tr><tr><td scope="row"><pre>(void)AddModule(myModule);<span></span></pre></td></tr></table></div>
<p>where <code>XYZ</code> is the
name of your module and <code>XYZMAIN</code> is
your module&#8217;s main routine.</p>
<p>Some platforms require that each module use unique function
names. To prevent name conflicts when you compile a module into
the server, make your functions static.</p>
<p>Modules that are compiled into the server are known as static
modules.</p>
<a name="//apple_ref/doc/uid/TP30000246-151219" title="Building a QTSS Module as a Code Fragment"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF103" title="Building a QTSS Module as a Code Fragment"></a><h3>Building a QTSS Module as a Code Fragment</h3>
<p>To have the server load at runtime a QTSS module that is a
code fragment, follow these steps: </p>
<ol class="ol"><li class="li"><p>Compile the source for your module as a dynamic
shared library for the platform you are targeting. For Mac OS X,
the project type must be <code>loadable bundle</code>. </p></li>
<li class="li"><p>Link the resulting file against the QTSS API stub library
for the platforms you are targeting.</p></li>
<li class="li"><p>Place the resulting file in the <code>/Library/QuickTimeStreaming/Modules</code> directory
(Mac OS X), <code>/usr/local/sbin/StreamingServerModules
(Darwin platforms)</code>, and <code>c:\Program Files\Darwin
StreamingServer\QTSSModules</code>. The server will
load your module the next time it restarts.</p></li></ol>
<p>Some platforms require that each module use unique function
names. To prevent name conflicts when the server loads your module,
strip the symbols from your module before you have the server load
it.</p>
<a name="//apple_ref/doc/uid/TP30000246-180271" title="Debugging"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF181" title="Debugging"></a><h2>Debugging</h2>
<p>Several server preferences in the streamingserver.xml file
are available for enabling the generation of debugging information,
which is printed on the terminal screen. The following sections
provide information on debugging:</p>
<a name="//apple_ref/doc/uid/TP30000246-180284" title="RTSP and RTP Debugging"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF182" title="RTSP and RTP Debugging"></a><h3>RTSP and RTP Debugging</h3>
<p>To enable the display of RTSP and RTP informati on the terminal
screen, modify the RTSP_debug_printfs preference in the streamingserver.xml
file and restart the server:</p>
<div class="codesample"><table><tr><td scope="row"><pre>&lt;PREF NAME="RTSP_debug_printfs" TYPE="BOOL16" &gt;true&lt;/PREF&gt;<span></span></pre></td></tr></table></div>
<p>To enable the display of packet header information, modify
the &#8220;enable_packet_header_printfs&#8221; preference in the streamingserver.xml
file:</p>
<div class="codesample"><table><tr><td scope="row"><pre>&lt;PREF NAME="enable_packet_header_printfs" TYPE="BOOL16" &gt;true&lt;/PREF&gt;<span></span></pre></td></tr></table></div>
<p>Then specify which packet headers to display by modifying
the &#8220;packet_header_printf_options&#8221; preference. The following
example enables the display of all packet headers: </p>
<div class="codesample"><table><tr><td scope="row"><pre>&lt;PREF NAME="packet_header_printf_options" &gt;rtp;rr;sr;app;ack;&lt;/PREF&gt;<span></span></pre></td></tr></table></div>
<p>In the previous example, <code>rtp</code> enables
the display of RTP packet headers, <code>rr</code> enables
the display of RTCP receiver reports, <code>sr</code> enables
the display of RTCP sender reports, <code>app</code> enables
the display of RTCP application packets, and <code>ack</code> enables
the display of Reliable UDP RTP acknowledgement packets.</p>
<p>After enabling RTSP and RTP debugging, restart the Streaming
Server in debug mode using this command:</p>
<div class="codesample"><table><tr><td scope="row"><pre>QuickTimeStreamingServer -d<span></span></pre></td></tr></table></div>
<p>When you connect a client, debug information is displayed
on the terminal screen.</p>
<a name="//apple_ref/doc/uid/TP30000246-180395" title="Source File Debugging Support"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF183" title="Source File Debugging Support"></a><h3>Source File Debugging Support</h3>
<p>You can enable debugging in specific source files. For example,
in the file CommonUtilitiesLib/Task.h, make the following change:</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define TASK_DEBUG 1<span></span></pre></td></tr></table></div>
<p>Rebuild and start the Streaming Server in debug mode:</p>
<div class="codesample"><table><tr><td scope="row"><pre>QuickTimeStreamingServer -d<span></span></pre></td></tr></table></div>
<p>Here is some sample output:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Task::Signal enque task TaskName=RTSPSession ...<span></span></pre></td></tr><tr><td scope="row"><pre>TaskThread::Entry run task TaskName=RTSPSession ...<span></span></pre></td></tr><tr><td scope="row"><pre>TaskThread::Entry insert task TaskName=RTSPSession ...<span></span></pre></td></tr><tr><td scope="row"><pre>TaskThread::Entry run task TaskName=RTSPSession ...<span></span></pre></td></tr><tr><td scope="row"><pre>TaskThread::WaitForTask found timer task TaskName=QTSSAccessLog ...<span></span></pre></td></tr><tr><td scope="row"><pre>TaskThread::Entry run task TaskName=QTSSAccessLog ...<span></span></pre></td></tr></table></div>
<p>You can also enable debugging in CommonUtilitiesLib/OSFileSource.cpp:</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define FILE_SOURCE_DEBUG 1<span></span></pre></td></tr></table></div>
<p>Here is some sample output:</p>
<div class="codesample"><table><tr><td scope="row"><pre>OSFileSource::SetLog=/Library/QuickTimeStreaming/Movies/sample_100kbit.mov<span></span></pre></td></tr><tr><td scope="row"><pre>FileMap::AllocateBufferMap shared buffers<span></span></pre></td></tr><tr><td scope="row"><pre>OSFileSource::ReadFromCache inPosition =272 ...<span></span></pre></td></tr><tr><td scope="row"><pre>OSFileSource::ReadFromCache inPosition =276 ...<span></span></pre></td></tr><tr><td scope="row"><pre>OSFileSource::ReadFromCache inPosition =280 ...<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>OSFileSource::ReadFromCache inPosition =80667<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-150267" title="Working with Attributes"></a><a name="//apple_ref/doc/uid/TP30000246-BBCDAJAC" title="Working with Attributes"></a><h2>Working with Attributes</h2>
<p>QTSS objects consist of attributes that are used to store
data. Every attribute has a name, an attribute ID, a data type,
and permissions for reading and writing the attribute&#8217;s value. There
are two attribute types:</p>
<ul class="ul"><li class="li"><p>static attributes. Static attributes are present
in all instances of an object type. A module can add static attributes
to objects from its Register role only. All of the server&#8217;s built-in attributes
are static attributes. For information about adding static attributes
to object types, see the section <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150838">“Adding Attributes”</a></span></p></li>
<li class="li"><p>instance attributes. Instance attributes are added to a specific
instance of any object type. A module can use any role to add an
instance attribute to an object and can also remove instance attributes
that it has added to an object. For information about adding instance
attributes to objects, see the section <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150838">“Adding Attributes.”</a></span></p></li></ul>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_34" title="Note"></a><p><strong>Note:</strong>&nbsp;Adding static
attributes is more efficient than adding instance attributes, so
adding static attributes instead of adding instance attributes is
strongly recommended.</p></div>
<a name="//apple_ref/doc/uid/TP30000246-150281" title="Getting Attribute Values"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF122" title="Getting Attribute Values"></a><h3>Getting Attribute Values</h3>
<p>Modules use attributes stored in objects to exchange information
with the server, so they frequently get attribute values. Three
callback routines get attribute values:</p>
<ul class="spaceabove"><li class="li"><p><code>QTSS_GetValue</code>,
which copies the attribute value into a buffer provided by the module. This
callback can be used to get the value of any attribute, but it is
not as efficient as <code>QTSS_GetValuePtr</code>.</p></li>
<li class="li"><p><code>QTSS_GetValueAsString</code>,
which copies the attribute value as a string into a buffer provided
by the module. This callback can be used to get the value of any
attribute. This is the least efficient way to get the value of an
attribute</p></li>
<li class="li"><p><code>QTSS_GetValuePtr</code>,
which returns a pointer to the server&#8217;s internal copy of the attribute value.
This is the most efficient way to get the value of preemptive safe
attributes. It can also be used to get the value of non-preemptive
safe attributes, but the object must first be locked and must be
unlocked after QTSS_GetValuePtr is called. When getting the value
of a single non-preemptive-safe attribute, calling QTSS_GetValue
may be more efficient than locking the object, calling QTSS_GetValuePtr
and unlocking the object.</p></li></ul>
<p>The sample code in <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150352">Listing 2-1</a></span> calls <code>QTSS_GetValue</code> to
get the value of the <code>qtssRTPSvrCurConn</code> attribute,
which is not preemptive safe, from the <code>QTSS_ServerObject</code> object.</p>
<a name="//apple_ref/doc/uid/TP30000246-150352" title="Listing 2-1Getting the value of an attribute by calling QTSS_GetValue"></a><a name="//apple_ref/doc/uid/TP30000246-BAJFIHAB" title="Listing 2-1Getting the value of an attribute by calling QTSS_GetValue"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Getting
the value of an attribute by calling QTSS_GetValue</p>
<div class="codesample"><table><tr><td scope="row"><pre>UInt32 MyGetNumCurrentConnections(QTSS_ServerObject inServerObject)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // qtssRTPSvrCurConn is a UInt32, so provide a UInt32 for the result.<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 theNumConnections = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Pass in the size of the attribute value.<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 theLength = sizeof(theNumConnections);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Retrieve the value.<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Error theErr = QTSS_GetValue(inServerObject, qtssRTPSvrCurConn, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp;theNumConnections, &amp;theLength);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Check for errors. If the length is not what was expected, return 0.<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((theErr != QTSS_NoErr) || (theLength != sizeof(theNumConnections))<span></span></pre></td></tr><tr><td scope="row"><pre>        return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    return theNumConnections;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>The sample code in <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150412">Listing 2-2</a></span> calls <code>QTSS_GetValuePtr</code>,
which is the preferred way to get the value of preemptive-safe attributes.
In this example, value of the <code>qtssRTSPReqMethod</code> attribute
is obtained from the object <code>QTSS_RTSPRequestObject</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-150412" title="Listing 2-2Getting the value of an attribute by calling QTSS_GetValuePtr"></a><a name="//apple_ref/doc/uid/TP30000246-BAJEDIEH" title="Listing 2-2Getting the value of an attribute by calling QTSS_GetValuePtr"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Getting
the value of an attribute by calling QTSS_GetValuePtr</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTSS_RTSPMethod MyGetRTSPRequestMethod(QTSS_RTSPRequestObject inRTSPRequestObject)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_RTSPMethod* theMethod = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 theLen = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_Error theErr = QTSS_GetValuePtr(inRTSPRequestObject, qtssRTSPReqMethod, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    (void**)&amp;theMethod, &amp;theLen);<span></span></pre></td></tr><tr><td scope="row"><pre>if ((theErr != QTSS_NoErr) || (theLen != sizeof(QTSS_RTSPMethod))<span></span></pre></td></tr><tr><td scope="row"><pre>    return -1;  // Return a -1 if there is an error, which is not a valid<span></span></pre></td></tr><tr><td scope="row"><pre>                // QTSS_RTSPMethod index<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>    return *theMethod;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>You can obtain the value any attribute by calling <code>QTSS_GetValueAsString</code>,
which gets the attribute&#8217;s value as a C string. Calling <code>QTSS_GetValueAsString</code> is
convenient when you don&#8217;t know the type of data the attribute
contains. In <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150468">Listing 2-3</a></span>, the value of the <code>qtssRTPSvrCurConn</code> attribute
is obtained as a string from the <code>QTSS_ServerObject</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-150468" title="Listing 2-3Getting the value of an attribute by calling QTSS_GetValueAsString"></a><a name="//apple_ref/doc/uid/TP30000246-BAJFJIDG" title="Listing 2-3Getting the value of an attribute by calling QTSS_GetValueAsString"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Getting
the value of an attribute by calling QTSS_GetValueAsString</p>
<div class="codesample"><table><tr><td scope="row"><pre>void MyPrintNumCurrentConnections(QTSS_ServerObject inServerObject)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Provide a string pointer for the result<span></span></pre></td></tr><tr><td scope="row"><pre>    char* theCurConnString = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Retrieve the value as a string.<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Error theErr = QTSS_GetValueAsString(inServerObject, qtssRTPSvrCurConn, 0,  &amp;theCurConnString);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr != QTSS_NoErr) return;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Print out the result. Because the value was returned as a string, use<span></span></pre></td></tr><tr><td scope="row"><pre>    // %s in the printf format.<span></span></pre></td></tr><tr><td scope="row"><pre>    ::printf(&quot;Number of currently connected clients: %s\n&quot;, theCurConnString);<span></span></pre></td></tr><tr><td scope="row"><pre>    // QTSS_GetValueAsString allocates memory, so reclaim the memory by calling  QTSS_Delete.<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Delete(theCurConnString);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-150539" title="Setting Attribute Values"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF123" title="Setting Attribute Values"></a><h3>Setting Attribute Values</h3>
<p>Two QTSS callback routines are available for setting the value
of an attribute: <code>QTSS_SetValue</code> and <code>QTSS_SetValuePtr</code>.</p>
<p>The sample code in <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150598">Listing 2-4</a></span> would be found handling the Route role. It calls <code>QTSS_GetValuePtr</code> to
get the value of the <code>qtssRTSPReqFilePath</code>.
If the path matches a certain string, the function sets a new request
root directory by calling <code>QTSS_SetValue</code><em></em><em></em> to
set the <code>qtssRTSPReqRootDir</code> attribute
to a new path.</p>
<a name="//apple_ref/doc/uid/TP30000246-150598" title="Listing 2-4Setting the value of an attribute by calling QTSS_SetValue"></a><a name="//apple_ref/doc/uid/TP30000246-BAJDHDGE" title="Listing 2-4Setting the value of an attribute by calling QTSS_SetValue"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Setting
the value of an attribute by calling QTSS_SetValue</p>
<div class="codesample"><table><tr><td scope="row"><pre>// First get the file path for this request using QTSS_GetValuePtr<span></span></pre></td></tr><tr><td scope="row"><pre>char* theFilePath = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>UInt32 theFilePathLen = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_Error theErr = QTSS_GetValuePtr(inParams-&gt;inRTSPRequest, qtssRTSPReqFilePath,  0, &amp;theFilePath,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;theFilePathLen);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Check for any errors<span></span></pre></td></tr><tr><td scope="row"><pre>if (theErr != QTSS_NoErr) return;<span></span></pre></td></tr><tr><td scope="row"><pre>// See if this path is a match. If it is, use QTSS_SetValue to set the root directory  for this request.<span></span></pre></td></tr><tr><td scope="row"><pre>if ((theFilePathLen == sStaticFilePathLen) &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                    (::strncmp(theFilePath, sStaticFilePath, theFilePathLen) ==  0))<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = QTS_SetValue(inParams-&gt;inRTSPRequest, qtssRTSPReqRootDir, 0,  sNewRootDirString,<span></span></pre></td></tr><tr><td scope="row"><pre>            sNewRootDirStringLen);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr != QTSS_NoErr) return;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p><span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150739">Listing 2-5</a></span> demonstrates the use of the <code>QTSS_SetValuePtr</code><code> </code>callback.
The <code>QTSS_SetValuePtr</code><code> </code>callback
associates an attribute with the value of a module&#8217;s variable.
This code sample modifies the <code>QTSS_ServerObject</code><code> </code>object
nonatomically, so it calls <code>QTSS_LockObject</code><code> </code>to prevent
other threads from accessing the attributes of the <code>QTSS_ServerObject </code>before
the value has been set.</p>
<p>Then the code sample calls <code>QTSS_CreateObjectValue </code>to
create a<code> QTSS_ConnectedUserObject</code> object
as the value of the <code>qtssSvrConnectedUsers </code>attribute
of the <code>QTSS_ServerObject </code>object. Then
the code sample calls <code>QTSS_SetValuePtr </code>to
set the value of the <code>qtssConnectionBytesSent </code>attribute
of the <code>QTSS_ConnectedUserObject </code>object
to the module&#8217;s <code>fBytesSent </code>variable.
Thereafter, when any module gets the value of the <code>qtssConnectionBytesSent </code>attribute,
it will get the current value of the module&#8217;s <code>fBytesSent</code> variable.</p>
<p>After calling <code>QTSS_SetValuePtr</code>,
the code sample calls <code>QTSS_UnlockObject</code> to
unlock the <code>QTSS_ServerObject </code>object.</p>
<a name="//apple_ref/doc/uid/TP30000246-150739" title="Listing 2-5Setting the value of an attribute by calling QTSS_SetValuePtr"></a><a name="//apple_ref/doc/uid/TP30000246-CJBIGCEJ" title="Listing 2-5Setting the value of an attribute by calling QTSS_SetValuePtr"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Setting
the value of an attribute by calling QTSS_SetValuePtr</p>
<div class="codesample"><table><tr><td scope="row"><pre>UInt32 index;<span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_LockObject(sServer);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_CreateObjectValue(sServer, qtssSvrConnectedUsers,  qtssConnectedUserTypeObject, &amp;index, &amp;fQTSSObject);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_CreateObjectValue(sServer, qtssSvrConnectedUsers,  qtssConnectedUserObjectType, &amp;index, &amp;fQTSSObject);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_SetValuePtr(fQTSSObject, qtssConnectionBytesSent, &amp;fBytesSent,  sizeof(fBytesSent));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>QTSS_UnlockObject(sServer);<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-150838" title="Adding Attributes"></a><a name="//apple_ref/doc/uid/TP30000246-BAJDDDEE" title="Adding Attributes"></a><h3>Adding Attributes</h3>
<p>Any module can add an attribute to a QTSS object type by calling
the <code>QTSS_AddStaticAttribute</code> callback
routine from its Register role. Modules can also call <code>QTSS_AddInstanceAttribute </code>from
any role to add an attribute to an instance of an object.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_35" title="Note"></a><p><strong>Note:</strong>&nbsp;Adding one or
more attributes to an object type or to an instance of an object
is the most efficient and the recommended way for modules to store
data that is specific to a particular session.</p></div>
<p>Once added, the new attribute is included in every object
of that type that the server creates and its value can be set and
obtained by calling that same callback routines that set and obtain
the value of the server&#8217;s built-in attributes: <code>QTSS_SetValue</code>, <code>QTSS_SetValuePtr, </code><code>QTSS_GetValue</code>,
and <code>QTSS_GetValuePtr</code>.</p>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_36" title="Note"></a><p><strong>Note:</strong>&nbsp;If you are adding
attributes to an object that your module created, you must first
lock the object by calling <code>QTSS_LockObject.
When </code>all of the attributes have been added,
call <code>QTSS_UnlockObject </code>to
unlock the object.</p></div>
<p>The sample code in <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-150926">Listing 2-6</a></span> calls <code>QTSS_AddStaticAttribute </code>to
add an attribute to the object <code>QTSS_ClientSessionObject</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-150926" title="Listing 2-6Adding a static attribute"></a><a name="//apple_ref/doc/uid/TP30000246-BAJDCFED" title="Listing 2-6Adding a static attribute"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>Adding
a static attribute</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTSS_Error MyRegisterRoleFunction()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Add the static attribute. The third parameter is always NULL.<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Error theErr = QTSS_AddStaticAttribute(qtssClientSessionObjectType,<span></span></pre></td></tr><tr><td scope="row"><pre>                            "MySampleAttribute", NULL, qtssAttrDataTypeUInt32);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Retrieve the ID for this attribute. This ID can be passed into QTSS_GetValue,<span></span></pre></td></tr><tr><td scope="row"><pre>    // QTSS_SetValue, and QTSS_GetValuePtr.<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_AttributeID theID;<span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = QTSS_IDForAttr(qtssClientSessionObjectType, MySampleAttribute&quot;,  &amp;theID);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Store the attribute ID in a global for later use. Attribute IDs do not<span></span></pre></td></tr><tr><td scope="row"><pre>    // change while the server is running.<span></span></pre></td></tr><tr><td scope="row"><pre>    gMyExampleAttrID = theID;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_37" title="Note"></a><p><strong>Note:</strong>&nbsp;Attribute permissions
for an added attribute (static or instance) are automatically set
to readable, writable, and preemptive safe.</p></div>
<a name="//apple_ref/doc/uid/TP30000246-147396" title="Using Files"></a><a name="//apple_ref/doc/uid/TP30000246-BBCDGHDA" title="Using Files"></a><h2>Using Files</h2>
<p>QTSS supports file system modules so that QTSS can transparently
and easily work with custom file systems. For example, a QTSS file
system module can allow a QTSS module to read a custom networked
file system or a custom database. Support for reading files consists
of the following:</p>
<ul class="ul"><li class="li"><p>QTSS file system callback routines that any module
can use to open, read, and close files. Calling the file system
callback routines is described in the section <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-147405">“Reading Files Using Callback Routines.”</a></span>
The QTSS file system callback routines allow QTSS to easily work
with many different file system types. A QTSS module that uses the
file system callbacks for reading all files can transparently use
whatever file system is deployed on a server. </p></li>
<li class="li"><p>File system roles for which modules that implement file systems
register. These roles provide a bridge between QTSS and a specific
file system. The file system roles are described in the section <span class="content_text"><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-147717">“Implementing a QTSS File System Module.”</a></span> You could, for example, write a file
system module that interfaces QTSS to a custom database or a custom
networked file system.</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-147405" title="Reading Files Using Callback Routines"></a><a name="//apple_ref/doc/uid/TP30000246-CJBJBDFD" title="Reading Files Using Callback Routines"></a><h3>Reading Files Using Callback Routines</h3>
<p>In QTSS, a file is represented by a QTSS stream, so you can
use existing QTSS stream callback routines to read files. The callback
routines that are available for working with files are:</p>
<ul class="spaceabove"><li class="li"><p><code>QTSS_OpenFileObject</code>,
which is called to open a file in the local operating system. This call
is one of two callback routines that is only used when working with
files.</p></li>
<li class="li"><p><code>QTSS_CloseFileObject</code>,
which is called to close a file that was opened by a previous call to <code>QTSS_OpenFileObject</code>.
This call is one of two callback routines that is only used when working
with files.</p></li>
<li class="li"><p><code>QTSS_Read</code>, which
is called to read data from a file object&#8217;s stream that was created
by a previous call to <code>QTSS_OpenFileObject</code>.</p></li>
<li class="li"><p><code>QTSS_Seek</code>, which
is called to set the current position of a file object&#8217;s stream.</p></li>
<li class="li"><p><code>QTSS_Advise</code>, which
is called to tell a file system module that a specified section
of one of its streams will be read soon.</p></li>
<li class="li"><p><code>QTSS_RequestEvent</code>,
which is called to tell a file system module that the calling module wants
to be notified when one of the events in the specified event mask
occurs. The events are when a stream becomes readable and when a
stream becomes writable.</p></li></ul>
<p>In QTSS, a file is <code>QTSS_Object</code> that
has its own object type, <code>QTSS_FileObject</code>,
that allows you to use standard QTSS callbacks (<code>QTSS_GetValue</code>, <code>QTSS_GetValueAsString</code>,
and <code>QTSS_GetValuePtr</code>)
to get meta information about a file, such as its length and modification date.
You can use standard QTSS callbacks to store any amount of file
system meta information with the file object. For example, a module
working with a POSIX file system would want to add an attribute
to the file object that stores the POSIX file system descriptor.
A file object also has a QTSS stream reference that can be used
when calling QTSS stream routines that work with files, such as<code> QTSS_Read</code>.</p>
<p>The sample code in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-147522">Listing 3-7</a></code> shows how to open a file, determine the file&#8217;s length,
read the entire file, close the file, and return the data it contains.</p>
<a name="//apple_ref/doc/uid/TP30000246-147522" title="Listing 2-7Reading a file"></a><a name="//apple_ref/doc/uid/TP30000246-CJBGBIJJ" title="Listing 2-7Reading a file"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Reading
a file</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTSS_Error ReadEntireFile(char* inPath, void** outData, UInt32* outDataLen)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object theFileObject = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Error theErr = QTSS_OpenFileObject(inPath, qtssOpenFileNoFlags,  &amp;theFileObject);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr != QTSS_NoErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        return theErr; // The file wasn't found or it couldn't be opened.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // The file is open. Find out how long it is.<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt64* theLength = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 theParamLen = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = QTSS_GetValuePtr(theFileObject, qtssFlObjLength, 0,  (void**)&amp;theLength, &amp;theParamLen);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr != QTSS_NoErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        return theErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theParamLen != sizeof(UInt64))<span></span></pre></td></tr><tr><td scope="row"><pre>        return QTSS_RequestFailed;;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Allocate memory for the file data.<span></span></pre></td></tr><tr><td scope="row"><pre>    *outData = new char[*theLength + 1];<span></span></pre></td></tr><tr><td scope="row"><pre>    *outDataLen = *theLength;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Read the data<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32 recvLen = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = QTSS_Read(theFileObject, *outData, *outDataLen, &amp;recvLen);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ((theErr != QTSS_NoErr) || (recvLen != *outDataLen))<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        delete *outData;<span></span></pre></td></tr><tr><td scope="row"><pre>        return theErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Close the file.<span></span></pre></td></tr><tr><td scope="row"><pre>    (void)QTSS_CloseFileObject(theFileObject);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-147717" title="Implementing a QTSS File System Module"></a><a name="//apple_ref/doc/uid/TP30000246-CJBBFHJD" title="Implementing a QTSS File System Module"></a><h3>Implementing a QTSS File System Module</h3>
<p>A file system module provides a way for QTSS modules to read
files in a specific file system regardless of that file system&#8217;s
type. Typically, a file system module handles a subset of paths
in a file system, but it may handle all paths on the system. If
a file system module handles only a certain subset of paths, it
usually handles all paths inside a certain root path. For example,
a module handling files stored in a certain database may only respond
to paths that begin with <code>/Local/database_root/</code>.</p>
<p>Implementing a QTSS file system module begins with registering
for one of the following roles:</p>
<ul class="spaceabove"><li class="li"><p>Open File Preprocess role, which the server calls
in response to a module (or the server) that calls the <code>QTSS_OpenFileObject</code> callback
routine to open a file. If the module does not handle files of the
specified type, the module immediately returns <code>QTSS_FileNotFound</code>. If
the module handles the files of the specified type, it opens the
file, updates a file object provided by the server and returns <code>QTSS_NoErr</code>.
If an error occurs during this setup period, the module returns <code>QTSS_RequestFailed</code>.
Once the module returns <code>QTSS_NoErr</code>,
it should be prepared to handle the Advise File, Read File, Request
Event File and Close File roles for the opened file. The server
calls each module registered in the Open File Preprocess role until
one of the called modules returns <code>QTSS_NoErr</code> or <code>QTSS_RequestFailed</code>.</p></li>
<li class="li"><p>Open File role, which the server calls in response to a module
(or the server) that calls the <code>QTSS_OpenFileObject</code> callback
routine for which all modules handling the Open File Preprocess
role return <code>QTSS_FileNotFound</code>.
Only one module can register for the Open File role. Like modules
called for the Open File Preprocess role, the module called for the
Open File role must determine whether it can handle the specified
file. It it can, it opens the file, updates the file object provided
by the server and returns<code> QTSS_NoErr</code>.
If an error occurs during the setup process or if the module cannot
handle the specified file, the module returns <code>QTSS_RequestFailed</code> or <code>QTSS_FileNotFound</code>,
respectively.</p></li></ul>
<p>A file system module should register in the Open File Preprocess
role if it handles a subset of files available on the system. For
instance, a file system module that serves files out of a database
may only handle files rooted at a certain path. All other paths
should fall through to other modules that handle other paths.</p>
<p>A file system module should register in the Open File role
if it implements the default file system on a system. For instance,
on a UNIX system the module handling the Open File Role would probably
provide an interface between the server and the standard POSIX file system.</p>
<p>Once a module returns <code>QTSS_NoErr</code> from
either the Open File Role or the Open File Preprocess role, it is
responsible for the newly opened file. It should be prepared to
handle the following roles on behalf of that file:</p>
<ul class="spaceabove"><li class="li"><p>Advise File role, which is called in response
to a module (or the server) calling the <code>QTSS_Advise</code> callback
for a file object. The <code>QTSS_Advise</code> callback
is made to inform the file system module that a specific region
of the file will be needed soon.</p></li>
<li class="li"><p>Read File role, which is called in response to a module (or
the server) calling the <code>QTSS_Read</code> callback
for a file object. It is the responsibility of a file system module handling
this role to make a best-effort attempt to fill the buffer provided
by the caller with the appropriate file data.</p></li>
<li class="li"><p>Request Event File role, which is called in response to a
module (or the server) calling the <code>QTSS_RequestEvent</code> callback
on a file object.</p></li>
<li class="li"><p>Close File role, which is called in response to a module (or
the server) calling the <code>QTSS_Close</code> callback
on a file object. The module should clean up any file-system and module-specific
data structures for this file. This role is always the last role
a file system module will be invoked in for a given file object.</p></li></ul>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_38" title="Note"></a><p><strong>Note:</strong>&nbsp;Modules do not
need to explicitly register for the Advise File, Read File, Request
Event File or Close File roles in order to handle them. Instead,
returning <code>QTSS_NoErr</code> or <code>QTSS_RequestFailed</code> from
one of the open file roles constitutes taking ownership for a specific
file object, and therefore means that the module has implicitly
registered for those roles.</p></div>
<a name="//apple_ref/doc/uid/TP30000246-147880" title="File System Module Roles"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF165" title="File System Module Roles"></a><h4>File System Module Roles</h4>
<p>This section describes the file system module roles. The roles
are:</p>
<ul class="spaceabove"><li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-147951">&#8220;Open File Preprocess Role&#8221;</a></code> which is called to process requests
to open files.</p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-148145">&#8220;Open File Role&#8221;</a></code> which
is the default role that is called when none of the modules registered
for the Open File Preprocess role opens the specified file.</p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-151413">&#8220;Advise File Role&#8221;</a></code> which
is called to tell a file system module about the caller&#8217;s I/O preferences.</p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-148480">&#8220;Read File Role&#8221;</a></code> which
is called to read a file.</p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-148707">&#8220;Close File Role&#8221;</a></code> which
is called to close a file.</p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-148811">&#8220;Request Event File Role&#8221;</a></code> which
is called to request notification when a file becomes available
for reading or writing.</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-147951" title="Open File Preprocess Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBBHCIB" title="Open File Preprocess Role"></a><h5>Open File Preprocess Role</h5>
<p>The server calls the Open File Preprocess role in response
to a module that calls the <code>QTSS_OpenFileObject</code> callback
routine to open a file. It is the responsibility of a module handling
this role to determine whether it handles the type of file specified
to be opened. If it does and if the file exists, the module opens
the file, updates the file object provided by the server, and returns <code>QTSS_NoErr</code>. </p>
<p>When called, an Open File Preprocess role receives a <code>QTSS_OpenFile_Params</code> structure, which
is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    char*               inPath;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_OpenFileFlags  inFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object         inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_OpenFile_Params;s<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inPath</code></dt>
<dd><p>A pointer to a null-terminated C string containing the
full path to the file that is to be opened.</p></dd>
<dt><code>inFlags</code></dt>
<dd><p>Open flags specifying whether the module that called <code>QTSS_OpenFileObject</code> can
handle asynchronous read operations (<code>qtssOpenFileAsync</code>)
or expects to read the file in order from beginning to end (<code>qtssOpenFileReadAhead</code>).</p></dd>
<dt><code>inFileObject</code></dt>
<dd><p>A QTSS object that the module updates if it can open
the file specified by <code>inPath</code>.</p></dd></dl>
<p>If the file is a file the module handles, the module should
do whatever work is necessary to open and set up the file. It can
use <code>inFileObject</code> to store
any module-specific information for that file. In addition, the
module should set the value of the file object&#8217;s <code>qtssFlObjLenth</code> and <code>qtssFlObjModDate</code> attributes.</p>
<p>If the file is a file the module handles but an error occurs
while attempting to set up the file, the module should return <code>QTSS_RequestFailed</code>.</p>
<p>If every module registered for the Open File Preprocess role
returns <code>QTSS_FileNotFound</code>,
the server calls the one module that is registered in the Open File
role.</p>
<p>A module that wants to be called in the Open File Preprocess
role must in its Register role call <code>QTSS_AddRole</code> and
specify <code>QTSS_OpenFilePreprocess_Role</code> as
the role. Modules that register for this role must also handle the
following roles, but they do not need to explicitly register for
them: Advise File, Read File, Request Event File, and Close File.</p>
<a name="//apple_ref/doc/uid/TP30000246-148145" title="Open File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBBECIG" title="Open File Role"></a><h5>Open File Role</h5>
<p>The server calls the module registered for the Open File role
when all modules registered for the Open File Preprocess role have
been called and have returned <code>QTSS_FileNotFound</code>. Only
one module can be registered for the Open File role, and that module
is the first module that registers for this role when QTSS starts
up.</p>
<p>Like modules called for the Open File Preprocess role, it
is the responsibility of a module handling the Open File role to
determine whether it handles the type of file specified to be opened.
If it does and if the file exists, the module opens the file, updates
the file object provided by the server, and returns <code>QTSS_NoErr</code>.</p>
<p>When called, the module receives a <code>QTSS_OpenFile_Params</code> structure,
which is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    char*               inPath;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_OpenFileFlags  inFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object         inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_OpenFile_Params;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inPath</code></dt>
<dd><p>A pointer to a null-terminated C string containing the
full path to the file that is to be opened.</p></dd>
<dt><code>inFlags</code></dt>
<dd><p>Open flags specifying whether the module that called <code>QTSS_OpenFileObject</code> can
handle asynchronous read operations (<code>qtssOpenFileAsyn</code>c)
or expects to read the file in order from beginning to end (<code>qtssOpenFileReadAhead</code>).</p></dd>
<dt><code>inFileObject</code></dt>
<dd><p>A QTSS object that the module updates if it can open
the file specified by <code>inPath</code>.</p></dd></dl>
<p>If the file is a file the module handles, the module should
do whatever work is necessary to open and set up the file. It can
use <code>inFileObject</code> to store
any module-specific information for that file. In addition, the
module should set the value of the file object&#8217;s <code>qtssFlObjLength</code> and <code>qtssFlObjModDate</code> attributes.</p>
<p>If the file is a file the module handles but an error occurs
while attempting to set up the file, the module should return <code>QTSS_RequestFailed</code>.</p>
<p>A module that wants to be called in the Open File role must
in its Register role call <code>QTSS_AddRole</code> and
specify <code>QTSS_OpenFile_Role</code> as
the role. Modules that register for this role must also handle the
following roles, but they do not need to explicitly register for
them: Advise File, Read File, Request Event File, and Close File.</p>
<a name="//apple_ref/doc/uid/TP30000246-151413" title="Advise File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBDAGHG" title="Advise File Role"></a><h5>Advise File Role</h5>
<p>The server calls modules for the Advise File role in response
to a module (or the server) calling the <code>QTSS_Advise</code> callback
routine for a file object in order to inform the file system module
that the calling module will soon read the specified section of
the  file.</p>
<p>When called, an Advise File role receives a <code>QTSS_AdviseFile_Params</code> structure,
which is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object         inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt64              inPosition;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32              inSize;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_AdviseFile_Params;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inFileObject</code></dt>
<dd><p>The file object for the opened file. The file system
module uses the file object to determine the file for which the<code> QTSS_Advise</code> callback
routine was called.</p></dd>
<dt><code>inPosition</code></dt>
<dd><p>The offset in bytes from the beginning of the file that
represents the beginning of the section that is soon to be read.</p></dd>
<dt><code>inSize</code></dt>
<dd><p>The number of bytes that are soon to be read.</p></dd></dl>
<p>The file system module is not required to do anything while
handling this role, but it may take this opportunity to read the
specified section of the file.</p>
<p>File system modules do not need to explicitly register for
this role.</p>
<p>Modules should always return <code>QTSS_NoErr</code> when
they finish handling this role.</p>
<a name="//apple_ref/doc/uid/TP30000246-148480" title="Read File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBIBJBF" title="Read File Role"></a><h5>Read File Role</h5>
<p>The server calls modules for the Read File role in response
to a module (or the server) calling the <code>QTSS_Read</code> callback
routine for a file object in order to read the specified file.</p>
<p>When called, a Read File role receives a <code>QTSS_ReadFile_Params</code> structure,
which is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{   QTSS_Object inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt64      inFilePosition;<span></span></pre></td></tr><tr><td scope="row"><pre>    void*       ioBuffer;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32      inBufLen;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32*     outLenRead;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_ReadFile_Params;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inFileObject</code></dt>
<dd><p>The file object for the file that is to be read. The
file system module uses the file object to determine the file for
which the <code>QTSS_Read</code> callback
routine was called.</p></dd>
<dt><code>inFilePosition</code></dt>
<dd><p>The offset in bytes from the beginning of the file that
represents the beginning of the section that is to be read. The
server maintains the file position as an attribute of the file object,
so the file system module does not have to cache the file position
internally and can obtain the position at any time.</p></dd>
<dt><code>ioBuffer</code></dt>
<dd><p>A pointer to the buffer in which the file system module
is to place the data that is read.</p></dd>
<dt><code>ioBufLen</code></dt>
<dd><p>The length of the buffer pointed to by <code>ioBuffer</code>.</p></dd>
<dt><code>outLenRead</code></dt>
<dd><p>The number of bytes actually read.</p></dd></dl>
<p>The file system module should make a best-effort attempt to
fill the buffer pointed to by <code>ioBuffer</code> with
data from the file that is being read starting with the position
specified by <code>inFilePosition</code>.</p>
<p>If the file was opened with the <code>qtssOpenFileAsync</code> flag,
the module should return <code>QTSS_WouldBlock</code> if
reading the data will cause the thread to block. Otherwise, the
module should block the thread until all of the data has become
available. When the buffer pointed to by <code>ioBuffer</code> is
full or the end of file has been reached, the file system module
should set <code>outLenRead</code> to
the number of bytes read and return <code>QTSS_NoErr</code>.</p>
<p>If the read fails for any reason, the file system module handling
this role should return <code>QTSS_RequestFailed</code>.</p>
<p>File system modules do not need to explicitly register for
this role.</p>
<a name="//apple_ref/doc/uid/TP30000246-148707" title="Close File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBFJJEH" title="Close File Role"></a><h5>Close File Role</h5>
<p>The server calls modules for the Close File role in response
to a module (or the server) calling the <code>QTSS_CloseFile</code> callback
routine for a file object in order to close a file that has been
opened.</p>
<p>When called, a Close File role receives a <code>QTSS_CloseFile_Params</code> structure,
which is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object         inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_CloseFile_Params;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inFileObject</code></dt>
<dd><p>The file object for the file that is to be closed. The
file system module uses the file object to determine the file for
which the <code>QTSS_Close</code> callback
routine was called.</p></dd></dl>
<p>A module handling this role should dispose of any data structures
that it has created for the file that is to be closed.</p>
<p>This role is always the last role for which a file system
module will be invoked for any given file object.</p>
<p>File system modules do not need to explicitly register for
this role.</p>
<p>Modules should always return QTSS_NoErr when they finish handling
this role.</p>
<a name="//apple_ref/doc/uid/TP30000246-148811" title="Request Event File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBFCGDC" title="Request Event File Role"></a><h5>Request Event File Role</h5>
<p>The server calls modules for the Request Event File role in
response to a module (or the server) calling the <code>QTSS_RequestEvent</code> callback
routine. If a module or the server calls the <code>QTSS_OpenFileObject</code> callback
routine and specifies the <code>qtssOpenFileAsync</code> flag,
the file system module handling that file object may return <code>QTSS_WouldBlock</code> from
its Read File role. When that occurs, the caller of <code>QTSS_Read</code> may
call <code>QTSS_RequestEvent</code> callback
to tell the server that the caller of <code>QTSS_Read</code> wants
to be notified when the data becomes available for reading.</p>
<p>When called, a Request Event File role receives a <code></code><code>QTSS_RequestEventFile_Params</code> structure, which
is defined as follows:</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Object     inFileObject;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_EventType  inEventMask;<span></span></pre></td></tr><tr><td scope="row"><pre>} QTSS_RequestEventFile_Params;<span></span></pre></td></tr></table></div>
<dl class="termdef">	<dt><code>inFileObject</code></dt>
<dd><p>The file object for the file for which notifications
are requested. The file system module uses the file object to determine
the file for which the <code>QTSS_RequestEvent</code> callback
routine was called.</p></dd>
<dt><code>inEventMask</code></dt>
<dd><p>A mask specifying the type of events for which notification
is requested. Possible values are <code>QTSS_ReadableEvent </code>and <code>QTSS_WriteableEvent</code>.</p></dd></dl>
<p>If the file system that the file system module is implementing
supports notification, the file system module should do whatever
setup is necessary to receive an event for the file for which the <code>QTSS_RequestEvent</code> callback
routine was called. When the file becomes readable, the file system
module should call the <code>QTSS_SignalStream</code> callback
routine and pass the stream reference for this file object (which
can be obtained through the file object&#8217;s <code>qtssFlObjStream </code>attribute).
Calling the <code>QTSS_SignalStream</code> callback
routine tells the server that the caller of<code> QTSS_RequestEvent </code>should
be notified that the file is now readable.</p>
<p>File system modules do not need to explicitly register for
this role.</p>
<p>Modules should always return <code>QTSS_NoErr</code> when
they finish handling this role.</p>
<a name="//apple_ref/doc/uid/TP30000246-148994" title="Sample Code for the Open File Role"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF166" title="Sample Code for the Open File Role"></a><h4>Sample Code for the Open File Role</h4>
<p>The sample code in <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-149011">Listing 3-8</a></code> handles the Open File role, but it could also be used
to handle the Open File Preprocess role. This code uses the POSIX
file system layer as the file system and does not support asynchronous
I/O.</p>
<a name="//apple_ref/doc/uid/TP30000246-149011" title="Listing 2-8Handling the Open File Role"></a><a name="//apple_ref/doc/uid/TP30000246-CJBHHJBB" title="Listing 2-8Handling the Open File Role"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Handling
the Open File Role</p>
<div class="codesample"><table><tr><td scope="row"><pre>QTSS_Error OpenFile(QTSS_OpenFile_Params* inParams)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Use the POSIX open call to attempt to open the specified file.<span></span></pre></td></tr><tr><td scope="row"><pre>    // If it doesn't exist, return QTSS_FileNotFound<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    int theFile = open(inParams-&gt;inPath, O_RDONLY);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theFile == -1)<span></span></pre></td></tr><tr><td scope="row"><pre>        return QTSS_FileNotFound;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Use the POSIX stat call to get the length and the modification date<span></span></pre></td></tr><tr><td scope="row"><pre>    // of the file. This information must be set in the QTSS_FileObject<span></span></pre></td></tr><tr><td scope="row"><pre>    // by every file system module.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    UInt64 theLength = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    time_t theModDate = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    struct stat theStatStruct;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (::fstat(fFile, &amp;theStatStruct) &gt;= 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        theLength = buf.st_size;<span></span></pre></td></tr><tr><td scope="row"><pre>        theModDate = buf.st_mtime;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        ::close(theFile);<span></span></pre></td></tr><tr><td scope="row"><pre>        return QTSS_RequestFailed; // Stat failed<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Set the file length and the modification date attributes of this file<span></span></pre></td></tr><tr><td scope="row"><pre>    // object before returning<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    (void)QTSS_SetValue(inParams-&gt;inFileObject, qtssFlObjLength, 0, &amp;theLength,  sizeof(theLength));<span></span></pre></td></tr><tr><td scope="row"><pre>    (void)QTSS_SetValue(inParams-&gt;inFileObject, qtssFlObjModDate, 0, &amp;theModDate,  sizeof(theModDate));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Place the file reference in a custom attribute in the QTSS_FileObject.<span></span></pre></td></tr><tr><td scope="row"><pre>    // This way, we can easily get the file reference in other role handlers,<span></span></pre></td></tr><tr><td scope="row"><pre>    // such as the QTSS_ReadFile_Role and the QTSS_CloseFile_Role.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTSS_Error theErr = QTSS_SetValue(inParams-&gt;inFileObject, sFileRefAttr, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>&amp;theFile, sizeof(theFileSource));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr != QTSS_NoErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        ::close(theFile);<span></span></pre></td></tr><tr><td scope="row"><pre>        return QTSS_RequestFailed;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return QTSS_NoErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-149260" title="Implementing Asynchronous Notifications"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF167" title="Implementing Asynchronous Notifications"></a><h4>Implementing Asynchronous Notifications</h4>
<p>If a module, or the server, calls the <code>QTSS_OpenFileObject</code> and
specifies the <code>qtssOpenFileAsync</code> flag,
the file system module handling that file object may return <code>QTSS_WouldBlock</code> from
its <code>QTSS_ReadFile_Role</code> handler.
Once that happens, the caller of <code>QTSS_Read</code> may
want to be notified when the requested data becomes available for
reading. This is possible by calling the <code>QTSS_RequestEvent</code> callback,
which tells the server that the caller would like to be notified
when data is available to be read from the file.</p>
<p>Not all file systems support notification mechanisms, and
if they do, the notification mechanisms are particular to each file
system architecture. Therefore, whether a file system module supports
notifications is at the discretion of the developer of the file
system module. In general it is better for a file system module
to support asynchronous notifications and not block in <code>QTSS_ReadFile_Role </code>because
blocking on one file operation may disrupt service for many of the
server&#8217;s clients.</p>
<p>Two facilities allow file system modules to implement notifications:</p>
<ul class="spaceabove"><li class="li"><p><code>QTSS_RequestEventFile_Role</code>,
which is called in response to a module (or the server) calling
the <code>QTSS_RequestEvent</code> callback
on a file object. Modules do not need to explicitly register for
this role. If a module doesn&#8217;t implement asynchronous notifications,
it should return <code>QTSS_RequestFailed</code> from
this role. If a module does implement asynchronous notifications,
it should do whatever setup is necessary to receive an event for
this file when the file becomes readable.</p></li>
<li class="li"><p><code>QTSS_SendEventToStream </code>callback,
called by a file system module when a file does become readable.
Calling <code>QTSS_SendEventToStream</code> tells
the server that the caller of <code>QTSS_RequestEvent</code> should
be notified that the file is now readable.</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-144385" title="Using the Admin Protocol"></a><a name="//apple_ref/doc/uid/TP30000246-BBCDHHIA" title="Using the Admin Protocol"></a><h2>Using the Admin Protocol</h2>
<p>You can use the Admin protocol to communicate with QTSS. The
Admin Protocol relies on the URI mechanism defined by RFC 2396 for
specifying a container entity using a path and on the request and
response mechanism for the Hypertext Transfer Protocol defined in RFC
1945.</p>
<p>The server&#8217;s internal data is mapped to a hierarchical tree
of element arrays. Each element is a named type including a container
type for retrieval of sub-node elements.</p>
<p>The server state machine and database can be accessed through
a regular expression. The Admin Protocol abstracts the QTSS module
API to handle data access and in some cases to provide data access
triggers for execution of server functions.</p>
<p>Server streaming threads are blocked while the Admin Protocol
accesses the server&#8217;s internal data. To minimize blocking, the
Admin Protocol allows scoped access to the server&#8217;s data structures
by allowing specific URL paths to any element.</p>
<p>The Admin Protocol uses the HTTP GET as the request and response
method. At the end of each response, the session between client
and server is closed. The Admin Protocol also supports the Authorization
request header field as described in RFC 1945, section 10.2.</p>
<a name="//apple_ref/doc/uid/TP30000246-144424" title="Access to Server Data"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF168" title="Access to Server Data"></a><h3>Access to Server Data</h3>
<p>The Admin Protocol uses URIs to specify the location of server
data. The following URI references the top level of the server&#8217;s
hierarchical data tree using a simple HTTP GET request.</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-144452" title="Request Syntax"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF169" title="Request Syntax"></a><h3>Request Syntax</h3>
<p>A valid request is an absolute reference followed by the server
URI. An absolute reference is a path beginning with a forward slash
character (<code>/</code>). A path
represents the server&#8217;s virtual hierarchical data structure of
containers and is expressed as a URL.</p>
<p>Here is the request syntax:</p>
<p>[<em>absolute URL</em>]<code>?</code>[<code>parameters</code>=&#8221;<em>values</em><code>"</code>]<code>+</code>[<code>command="</code><em>value</em><code>"</code>]<code>+</code>[<code>"option"="</code><em>value</em><em>&#8221;</em>]</p>
<p>The following rules govern URIs:</p>
<ul class="spaceabove"><li class="li"><p><em>/path</em> is an absolute reference.</p></li>
<li class="li"><p><em>path</em><code>/*</code> is
defined as all elements contained in the &#8220;path&#8221; container<em></em>.</p></li>
<li class="li"><p>An asterisk (<code>*</code>)
in the current URL location causes each element in that location
to be iterated.</p></li>
<li class="li"><p>A question mark (<code>?</code>)
indicates that options follow. Options are specified as <code>name="</code><em>value</em><code>"</code> pairs
delimited by the plus (<code>+</code>)
character.</p></li>
<li class="li"><p>Space and tab characters are treated as stop characters.</p></li>
<li class="li"><p>Values can be enclosed by the double quotation characters
(<code>"</code>). Enclosing double quotation
characters is required for values that contain spaces and tabs.</p></li>
<li class="li"><p>These characters cannot be used: period (<code>.</code>),
two periods (<code>..</code>), and
semicolon (<code>;</code>).</p></li></ul>
<p>Here is an example of a request:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions?parameters=rt+command=get<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-144651" title="Request Functionality"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF170" title="Request Functionality"></a><h3>Request Functionality</h3>
<p>Requests can contain an array iterator, a name lookup, a recursive
tree walk, and a filtered response. All functions can execute in
a single URI query.</p>
<p>Here is a request that gets the stream time scale and stream
payload name for every stream in every session:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions/*/qtssCliSesStreamObjects?<span></span></pre></td></tr><tr><td scope="row"><pre>parameters=r+command=get+filter1=qtssRTPStrTimescale+filter2=qtssRTPStrPayloadName<span></span></pre></td></tr></table></div>
<p>where</p>
<ul class="spaceabove"><li class="li"><p><code>*</code> iterates
the array of sessions</p></li>
<li class="li"><p><code>r</code> in <code>parameter=rt</code> specifies
a recursive walk and t specifies that data types are to be included
in the result</p></li>
<li class="li"><p><code>filter=qtssRTPStrTimescale</code> specifies
that the stream time scale is to be returned</p></li>
<li class="li"><p><code>filter2=qtssRTPStrPayloadName</code> specifies
that the stream payload is to be returned</p></li></ul>
<p>This request gets all server module names and their descriptions:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrModuleObjects?<span></span></pre></td></tr><tr><td scope="row"><pre>parameters=r+command=get+filter2=qtssModDesc+filter1=qtssModName<span></span></pre></td></tr></table></div>
<p>The following example does a recursive search and gets all
server attributes and their data types:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/?parameters=rt<span></span></pre></td></tr></table></div>
<div class="notebox"><a name="//apple_ref/doc/uid/TP30000246-DontLinkElementID_39" title="Note"></a><p><strong>Note:</strong>&nbsp;Repeated recursive
searches should be avoided because they impact server performance.</p></div>
<p>The following examples return server attributes and their
paths:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/*<span></span></pre></td></tr><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrPreferences/*<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-144800" title="Data References"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF171" title="Data References"></a><h3>Data References</h3>
<p>All elements are arrays. Single element arrays may be referenced
in any of the following ways:</p>
<ul class="spaceabove"><li class="li"><p><em>path</em><code>/</code><em>element</em></p></li>
<li class="li"><p><em>path</em><code>/</code><em>element</em><code>/</code></p></li>
<li class="li"><p><em>path</em><code>/</code><em>element</em><code>/</code><code>*</code></p></li>
<li class="li"><p><em>path</em><code>/</code><em>element</em><code>/</code><code>1</code></p></li></ul>
<p>The references listed above are all evaluated as the same
request.</p>
<a name="//apple_ref/doc/uid/TP30000246-144912" title="Request Options"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF172" title="Request Options"></a><h3>Request Options</h3>
<p>URIs that do not include a question mark (?) default to a
GET request option.</p>
<p>URIs that include a question mark (?) must be followed by
a <code>"command=</code><em>command-option</em><code>"</code> request
option, where <em>command-option</em> is <code>GET</code>, <code>SET</code>, <code>ADD</code>,
or <code>DEL</code>. URIs may also
be followed by a <code>"parameters=</code><em>parameter-option</em><code>"</code> that
refines the action of the command option.</p>
<p>Request options are not case-sensitive, but request option
values are case-sensitive.</p>
<p>The Admin Protocol ignores any request option that it does
not recognize as well any request options that a command does not
require.</p>
<a name="//apple_ref/doc/uid/TP30000246-144986" title="Command Options"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF173" title="Command Options"></a><h3>Command Options</h3>
<p>The Admin Protocol recognizes the following command options:</p>
<ul class="spaceabove"><li class="li"><p><code>GET</code>,
described in the section <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145093">&#8220;GET Command Option&#8221;</a></code></p></li>
<li class="li"><p><code>SET</code>, described
in the section <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145134">&#8220;SET Command Option&#8221;</a></code></p></li>
<li class="li"><p>DEL, described in the section <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145183">&#8220;DEL Command Option&#8221;</a></code></p></li>
<li class="li"><p><code>ADD</code>, described
in the section <code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145215">&#8220;ADD Command Option&#8221;</a></code></p></li></ul>
<p>Any unknown command option is reported as an error.</p>
<p>The effect of a command option may be modified by in the inclusion
of one or more of the following modifiers:</p>
<ul class="spaceabove"><li class="li"><p><code>value</code> &#8212;
used to specify a value</p></li>
<li class="li"><p><code>type</code> &#8212; used to
specify a data type</p></li>
<li class="li"><p><code>name</code> &#8212; used to
specify an element name</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-145093" title="GET Command Option"></a><a name="//apple_ref/doc/uid/TP30000246-CJBEADHG" title="GET Command Option"></a><h4>GET Command Option</h4>
<p>The <code>GET</code> command
option gets the data identified by the URI. It is the default command option.
For that reason, it does not have to be specified, as shown in the
following example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/example_count<span></span></pre></td></tr></table></div>
<p>The <code>GET</code> command
does not require any request options. If any request options were specified,
they would be ignored.</p>
<a name="//apple_ref/doc/uid/TP30000246-145134" title="SET Command Option"></a><a name="//apple_ref/doc/uid/TP30000246-CJBDDAAH" title="SET Command Option"></a><h4>SET Command Option</h4>
<p>The <code>SET</code> command
option sets the data identified by the URI. No value checking is performed.
Conversion between the text value and the actual value is type-specific.
Here are two examples of the <code>SET command option</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/example_count?command=SET+value=5<span></span></pre></td></tr><tr><td scope="row"><pre>GET /modules/admin/maxcount?command=SET+value=5+type=SInt32<span></span></pre></td></tr></table></div>
<p>If the <code>type</code> option
is included in the command, type checking of the server element
type and the set type is performed. If the types do not match, an
error is returned and the command fails.</p>
<a name="//apple_ref/doc/uid/TP30000246-145183" title="DEL Command Option"></a><a name="//apple_ref/doc/uid/TP30000246-CJBIHEBA" title="DEL Command Option"></a><h4>DEL Command Option</h4>
<p>The <code>DEL</code> command
option deletes the element referenced by the URL and any data it contains.
Here is an example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/maxcount?command=DEL<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-145215" title="ADD Command Option"></a><a name="//apple_ref/doc/uid/TP30000246-CJBDCGEF" title="ADD Command Option"></a><h4>ADD Command Option</h4>
<p>The <code>ADD</code> command
option adds the data specified by the URI to the specified element.</p>
<p>If the end of the URL is an element, the <code>ADD</code> command
performs an add to the array of elements referenced by the element
name. The following example adds 6 to <code>example_count</code> if
the data type of example_count is <code>SInt16</code>: </p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/example_count?command=ADD+value=6+type=SInt16<span></span></pre></td></tr></table></div>
<p>If the element at the end of the URL is a <code>QTSS_Object</code> container,
the <code>ADD</code> command option adds
the element to the container. The following example adds 5 to the
element whose name is <code>maxcount</code> if
the data type of <code>maxcount</code> is <code>SInt16</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/?command=ADD+value=5+name=maxcount+type=SInt16<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-145302" title="Parameter Options"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF174" title="Parameter Options"></a><h4>Parameter Options</h4>
<p>Parameter options are single characters without delimiters
that appear after the URL.</p>
<p>The Admin Protocol recognizes the following parameter options:</p>
<ul class="spaceabove"><li class="li"><p><code>r</code> &#8212;
Walk downward in the hierarchy starting at end of the URL. Recursion
should be avoided if &#8220;*&#8221; iterators or direct URL access to elements
can be used instead.</p></li>
<li class="li"><p><code>v</code> &#8212; Return the
full path in <em>name</em>.</p></li>
<li class="li"><p><code>a</code> &#8212; Return the
access type.</p></li>
<li class="li"><p><code>t</code> &#8212; Return the
data type of <em>value</em>.</p></li>
<li class="li"><p><code>d</code> &#8212; Return debugging
information if an error occurs.</p></li>
<li class="li"><p><code>c</code> &#8212; Return the
count of elements in the path.</p></li></ul>
<p>Here is an example that uses the r and t parameter options
to recursively get the data type of all <code>qtssSvrClientSessions</code><code></code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions?parameters=rt+command=get<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-145415" title="Attribute Access Types"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF175" title="Attribute Access Types"></a><h3>Attribute Access Types</h3>
<p>The following access types are used to control access to server
data:</p>
<ul class="spaceabove"><li class="li"><p><code>r</code> &#8212;
Read access type</p></li>
<li class="li"><p><code>w</code> &#8212; Write access
type</p></li>
<li class="li"><p><code>p</code> &#8212; Preemptive
safe access type</p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-145461" title="Data Types"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF176" title="Data Types"></a><h3>Data Types</h3>
<p>Data types can be any server-allowed text value. New data
types can be defined and returned by the server, so data types are
not limited to the basic set listed here:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<td  scope="row"><p><code>UInt8</code></p></td>
<td ><p><code>SInt16</code></p></td>
<td ><p><code>UInt64</code></p></td>
<td ><p><code>Float64</code></p></td>
<td ><p><code>char</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>SInt8</code></p></td>
<td ><p><code>UInt32</code></p></td>
<td ><p><code>SInt64</code></p></td>
<td ><p><code>Bool8</code></p></td>
<td ><p><code>QTSS_Object</code></p></td>
</tr>
<tr>
<td  scope="row"><p><code>UInt16</code></p></td>
<td ><p><code>SInt32</code></p></td>
<td ><p><code>Float32</code></p></td>
<td ><p><code>Bool16</code></p></td>
<td ><p><code>void_pointer</code></p></td>
</tr>

</table></div>
<p>Values of type <code>QTSS_Object</code>,
pointers, and unknown data types always converted to a host-ordered
string of hexadecimal values. Here is an example of a hexadecimal
value result:</p>
<div class="codesample"><table><tr><td scope="row"><pre>unknown_pointer=halogen; type=void_pointer<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-145609" title="Server Responses"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF177" title="Server Responses"></a><h3>Server Responses</h3>
<p>This section describes the data that is returned in response
to a request. The information on response data is organized in the
following sections:</p>
<ul class="spaceabove"><li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145689">&#8220;Unauthorized Response&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145737">&#8220;OK Response&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-145804">&#8220;Response Data&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-146258">&#8220;Array Values&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-146384">&#8220;Response Root&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-146403">&#8220;Errors in Responses&#8221;</a></code></p></li>
<li class="li"><p><code><a href="QTSSTasks.html#//apple_ref/doc/uid/TP30000246-146458">&#8220;Request and Response Examples&#8221;</a></code></p></li></ul>
<a name="//apple_ref/doc/uid/TP30000246-145689" title="Unauthorized Response"></a><a name="//apple_ref/doc/uid/TP30000246-CJBBBIJD" title="Unauthorized Response"></a><h4>Unauthorized Response</h4>
<p>Here is an example of an unauthorized response:</p>
<div class="codesample"><table><tr><td scope="row"><pre>HTTP/1.1 401 Unauthorized<span></span></pre></td></tr><tr><td scope="row"><pre>WWW-Authenticate: Basic realm=&quot;QTSS/modules/admin&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>Server: QTSS<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Close<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-145737" title="OK Response"></a><a name="//apple_ref/doc/uid/TP30000246-CJBJECIF" title="OK Response"></a><h4>OK Response</h4>
<p>Here is an example of an &#8220;OK&#8221; response:</p>
<div class="codesample"><table><tr><td scope="row"><pre>HTTP/1.0 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Server: QTSS/4.0 [v408]-MacOSX<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Close<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>admin/<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<p>All OK responses end with <code>error:(0)</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-145804" title="Response Data"></a><a name="//apple_ref/doc/uid/TP30000246-CJBHJEDB" title="Response Data"></a><h4>Response Data</h4>
<p>All entity references in response data follow this form:</p>
<p>[<em>NAME</em><code>=</code><em>VALUE</em>]<code>;</code>[<em>attribute</em><code>="</code><em>value</em><code>"</code>]<code>,</code>[<em>attribute</em><code>=</code>&#8221;<em>value</em><code>"</code>]</p>
<p>where brackets ([ ]) indicate that the enclosed response data
is optional. Therefore, the response data may take the following
forms:</p>
<p><em>NAME</em><code>=</code><em>VALUE</em></p>
<p><em>NAME</em><code>=</code><em>VALUE</em><code>;</code><em>attribute</em><code>="</code><em>value</em><code>"</code></p>
<p><em>NAME</em><code>=</code><em>VALUE</em><code>;</code><em>attribute</em><code>="</code><em>value</em><code>",</code><em>attribute</em><code>="</code><em>value</em><code>"</code></p>
<p>All container references follow this form:</p>
<p>[<em></em><em>NAME</em><code>/</code>]<code>;</code>[<em>attribute</em><code>="</code><em>value</em><code>"</code>]<code>,</code>[<em>attribute</em><code>="</code><em>value</em><code>"</code>]</p>
<p>where brackets ([ ]) indicate that the enclosed response data
is optional. Therefore, response data may take the following forms:</p>
<p><em>NAME</em><code>/</code></p>
<p><em>NAME</em><code>/;</code><em>attribute</em><code>="</code><em>value</em><code>"</code></p>
<p><em>NAME</em><code>;</code><em>attribute</em><code>="</code><em>value</em><code>",</code><em>attribute</em><code>="</code><em>value</em><code>"</code></p>
<p>The order of appearance of container references and the container&#8217;s
entity references are important. This is especially true when the
response is a recursive walk of a container hierarchy.</p>
<p>Each new level in the hierarchy must begin with a <code>Container=</code> reference.
Each container list of elements must be a complete list of the contained
elements and any containers. The appearance of a <code>Container=</code> reference
indicates the end of a previous container&#8217;s contents and the beginning
of a new container.</p>
<p>This example shows how each new container is identified with
a unique path:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/level1/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field2=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>level2a/<span></span></pre></td></tr><tr><td scope="row"><pre>level2b/<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/level2a/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>level3a/<span></span></pre></td></tr><tr><td scope="row"><pre>level3b/<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/level2a/level3a&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/level2a/level3b&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/level2b/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>level3a/<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/level2b/level3a/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-146258" title="Array Values"></a><a name="//apple_ref/doc/uid/TP30000246-CJBGAABE" title="Array Values"></a><h4>Array Values</h4>
<p>For arrays of elements, a numerical value represents the index.
Arrays are containers. Here is an example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/level1/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field2=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>array1/<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/array1/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>1=value<span></span></pre></td></tr><tr><td scope="row"><pre>2=value<span></span></pre></td></tr></table></div>
<p>Array elements may be containers, as shown in this example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/level1/array1/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>1/<span></span></pre></td></tr><tr><td scope="row"><pre>2/<span></span></pre></td></tr><tr><td scope="row"><pre>3/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/array1/1/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field2=&quot;value&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/array1/2/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/level1/array1/3/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>field1=&quot;value&quot;<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-146384" title="Response Root"></a><a name="//apple_ref/doc/uid/TP30000246-CJBHCHAF" title="Response Root"></a><h4>Response Root</h4>
<p>The root for responses is <code>/admin</code>.</p>
<a name="//apple_ref/doc/uid/TP30000246-146403" title="Errors in Responses"></a><a name="//apple_ref/doc/uid/TP30000246-CJBCGBGG" title="Errors in Responses"></a><h4>Errors in Responses</h4>
<p>For each response, the error state for the request is reported
at the end of the data. Here are some examples:</p>
<p><code>Error:(0)</code> indicates
that no error occurred</p>
<p><code>Error:(404)</code> indicates
that no data was found</p>
<p>The number enclosed by parentheses is an HTTP error code followed
by an error string when debugging is turned on using the <code>&quot;parameters=d&quot; </code>query
option. Here is an example:</p>
<div class="codesample"><table><tr><td scope="row"><pre>error:(404);reason=&quot;No data found&quot;<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-146458" title="Request and Response Examples"></a><a name="//apple_ref/doc/uid/TP30000246-CJBFIEFH" title="Request and Response Examples"></a><h4>Request and Response Examples</h4>
<p>An easy way to make requests is to use a web browser and a
URL like this:</p>
<p><code>http://</code><em>IP-address</em><code>:554/modules/admin/?parameters=a+command=get</code></p>
<p>The following example uses basic authentication and shows
the HTTP response headers:</p>
<p>Request: <code>GET /modules/admin?parameters=a+command=get</code></p>
<p>Authorization: Basic QWXtaW5pT3RXYXRvcjXkZWZhdWx0</p>
<p>Response:</p>
<div class="codesample"><table><tr><td scope="row"><pre>HTTP/1.0 200 OK<span></span></pre></td></tr><tr><td scope="row"><pre>Server: QTSS/4.0 [v408]-MacOSX<span></span></pre></td></tr><tr><td scope="row"><pre>Connection: Close<span></span></pre></td></tr><tr><td scope="row"><pre>Content-Type: text/plain<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>admin/;a=r<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<p>The following recursive request gets the value of each element
in <code>/modules/admin</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin?command=get+parameters=r<span></span></pre></td></tr></table></div>
<p>The following recursive request returns the access type and
data type for the value of each element in <code>/modules/admin</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin?command=get+parameters=rat<span></span></pre></td></tr></table></div>
<p>The following request gets the elements in <code>/modules/admin</code>.
Note that the <code>GET</code> command option
is not required because request options are not present.</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/*<span></span></pre></td></tr></table></div>
<p>A request like the following can be used to monitor the session
list:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions/*<span></span></pre></td></tr></table></div>
<p>The response is a list of unique <code>qtssSvrClientSessions</code> session
IDs. Here is an example::</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>12/<span></span></pre></td></tr><tr><td scope="row"><pre>2/<span></span></pre></td></tr><tr><td scope="row"><pre>4/<span></span></pre></td></tr><tr><td scope="row"><pre>8/<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<p>The following request gets the indexes for the <code>qtssCliSesStreamObjects </code>object,
which is an indexed array of streams:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions/*/qtssCliSesStreamObjects/*<span></span></pre></td></tr></table></div>
<p>The response might look like this:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/3/qtssCliSesStreamObjects/&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>0/<span></span></pre></td></tr><tr><td scope="row"><pre>1/<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<p>Here is another request:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions/3/qtssCliSesStreamObjects/0/*<span></span></pre></td></tr></table></div>
<p>And here is a typical response:</p>
<div class="codesample"><table><tr><td scope="row"><pre>qtssRTPStrTrackID=&quot;4&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrSSRC=&quot;683618521&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrPayloadName=&quot;X-QT/600&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrPayloadType=&quot;1&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrFirstSeqNumber=&quot;-7111&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrFirstTimestamp=&quot;433634204&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTimescale=&quot;600&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrQualityLevel=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrNumQualityLevels=&quot;3&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrBufferDelayInSecs=&quot;3.000000&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrFractionLostPackets=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTotalLostPackets=&quot;52&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrJitter=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrRecvBitRate=&quot;1526072&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrAvgLateMilliseconds=&quot;501&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrPercentPacketsLost=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrAvgBufDelayInMsec=&quot;30&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrGettingBetter=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrGettingWorse=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrNumEyes=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrNumEyesActive=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrNumEyesPaused=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTotPacketsRecv=&quot;6763&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTotPacketsDropped=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTotPacketsLost=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrClientBufFill=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrFrameRate=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrExpFrameRate=&quot;3903&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrAudioDryCount=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrIsTCP=&quot;false"<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrStreamRef=&quot;18861508&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrCurrentPacketDelay=&quot;-2&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTransportType=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrStalePacketsDropped=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrTimeFlowControlLifted=&quot;974373815109&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrCurrentAckTimeout=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrCurPacketsLostInRTCPInterval=&quot;52&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRTPStrPacketCountInRTCPInterval=&quot;689&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>QTSSReflectorModuleStreamCookie=(null)<span></span></pre></td></tr><tr><td scope="row"><pre>qtssNextSeqNum=(null)<span></span></pre></td></tr><tr><td scope="row"><pre>qtssSeqNumOffset=(null)<span></span></pre></td></tr><tr><td scope="row"><pre>QTSSSplitterModuleStreamCookie=(null)<span></span></pre></td></tr><tr><td scope="row"><pre>QTSSFlowControlModuleLossAboveTol=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>QTSSFlowControlModuleLossBelowTol=&quot;3&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>QTSSFlowControlModuleGettingWorses=&quot;0&quot;<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<p>Here is an request that returns the IP addresses of connected
clients:</p>
<div class="codesample"><table><tr><td scope="row"><pre>GET /modules/admin/server/qtssSvrClientSessions/*/qtssCliRTSPSessRemoteAddrStr<span></span></pre></td></tr></table></div>
<p>And here is a typical response:</p>
<div class="codesample"><table><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/5/ &quot;qtssCliRTSPSessRemoteAddrStr=17.221.40.1<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/6/ &quot;qtssCliRTSPSessRemoteAddrStr=17.221.40.2<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/8/ &quot;qtssCliRTSPSessRemoteAddrStr=17.221.40.3<span></span></pre></td></tr><tr><td scope="row"><pre>Container=&quot;/admin/server/qtssSvrClientSessions/14/ &quot;qtssCliRTSPSessRemoteAddrStr=17.221.40.4<span></span></pre></td></tr><tr><td scope="row"><pre>error:(0)<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-147070" title="Changing Server Settings"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF178" title="Changing Server Settings"></a><h3>Changing Server Settings</h3>
<p>To change a server setting, the entity name and the value
to be set are specified in the request body. If a match is made
on the URL base and entity name at the current container level and
if the setting is writable, the value is set.</p>
<div class="codesample"><table><tr><td scope="row"><pre>base = /base/container<span></span></pre></td></tr><tr><td scope="row"><pre>name = value<span></span></pre></td></tr><tr><td scope="row"><pre>/base/container/name=&quot;value&quot;<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP30000246-147103" title="Getting and Setting Preferences"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF179" title="Getting and Setting Preferences"></a><h3>Getting and Setting Preferences</h3>
<p>Preferences paths are useful for getting and setting a server
or module preference. Setting a preference causes the preference&#8217;s
new value to be flushed to the server&#8217;s XML preference file. The
new value takes effect immediately.</p>
<p>Server preferences are stored in <code>/modules/admin/server/qtssSvrPreferences</code>.
Module preferences are stored in <code>/modules/admin/server/qtssSvrModuleObjects/*/qtssModPrefs/</code>.</p>
<p>The elements defined in the <code>qtssSvrPreferences</code> object
can only be modified &#8212; they cannot be deleted.</p>
<p>The elements defined in <code>qtssModPrefs</code> can
be added to, deleted, and modified.</p>
<p>A module or the server can automatically restore some deleted
elements if the elements are needed by a module or the server. When
applied to a <code>qtssModPrefs</code> element,
the <code>ADD</code>, <code>DEL</code>, and <code>SET</code> commands
cause the streaming server&#8217;s XML preference file to be rewritten.</p>
<a name="//apple_ref/doc/uid/TP30000246-147171" title="Getting and Changing the Server&amp;#8217;s State"></a><a name="//apple_ref/doc/uid/TP30000246-TPXREF180" title="Getting and Changing the Server&amp;#8217;s State"></a><h3>Getting and Changing the Server&#8217;s State</h3>
<p>The <code>qtssSvrState </code>attribute
controls the server&#8217;s state. The path is 
<code>/modules/admin/server/qtssSvrState</code>.
It can be modified as a <code>UInt32</code> with
the following values.</p>
<div class="codesample"><table><tr><td scope="row"><pre>qtssStartingUpState     = 0,<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRunningState        = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>qtssRefusingConnectionsState  = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>qtssFatalErrorState     = 3,<span></span></pre></td></tr><tr><td scope="row"><pre>qtssShuttingDownState   = 4,<span></span></pre></td></tr><tr><td scope="row"><pre>qtssIdleState           = 5<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Concepts/QTSSConcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Reference/QTSSRef.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-04-29<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/QTSS/Tasks/QTSSTasks.html%3Fid%3DTP30001143-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/QTSS/Tasks/QTSSTasks.html%3Fid%3DTP30001143-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/QTSS/Tasks/QTSSTasks.html%3Fid%3DTP30001143-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>