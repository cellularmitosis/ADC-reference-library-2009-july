<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>HID Config Save - /HID Config Save-Read Me.txt</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Games/index.html">Games</a> &gt; <a href="../../samplecode/Games/idxHumanInterfaceDeviceForceFeedback-date.html">Human Interface Device & Force Feedback</a> &gt; <A HREF="javascript:location.replace('index.html');">HID Config Save</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">HID Config Save</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/HID Config Save-Read Me.txt</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/HID Config Save-Read Me.txt</option>
<option value="listing2.html">/HID Utilities/HID_Utilities.c</option>
<option value="listing3.html">/HID Utilities/HID_Utilities.h</option>
<option value="listing4.html">/HID Utilities/ImmrHIDUtilAddOn.c</option>
<option value="listing5.html">/HID Utilities/ImmrHIDUtilAddOn.h</option>
<option value="listing6.html">/HID Utilities/IOHIDDevice_.c</option>
<option value="listing7.html">/HID Utilities/IOHIDDevice_.h</option>
<option value="listing8.html">/HID Utilities/IOHIDElement_.c</option>
<option value="listing9.html">/HID Utilities/IOHIDElement_.h</option>
<option value="listing10.html">/HID Utilities/IOHIDLib_.h</option>
<option value="listing11.html">/main.c</option></select>
				</p>
				</form>
				<p><strong><a href="HID_Config_Save.zip">Download Sample</a></strong> (&#147;HID_Config_Save.zip&#148;, 99.4K)<BR>
<strong><a href="HID_Config_Save.dmg">Download Sample</a></strong> (&#147;HID_Config_Save.dmg&#148;, 156.0K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">HID Config Save
Human Interface Device Configuration Save sample

Version 1.0 18 Oct 2007 Initial release.  
----
This application is a Carbon NIB sample which demonstrate a simple game
applications.  It provides a number of menu options. Configure Input shows the
assignment of device elements to application defined actions. The Save and load
configuration allows the saving and restoring of the complete configuration to a
text file. The Go 
command shows using the configured inputs in a simple game like environment. 
Note, by using multiple Carbon event handlers and due to the HID Manager and
Utilities architecture we are able to provide easy on the fly reconfiguration of
input.

----

Requirements: Mac OS X 10.5, Xcode 2.4

Packing List
------------
The sample contains the following items:

    HID Config Save-Read Me.txt        - this file
    HID Config Save.xcodeproj        - Xcode project file
    configs                         - Xcode configuration files
    HID Config Save_Prefix.pch        - prefix header file
    main.c                            - main source file
    HID Config Save-Info.plist        - source for info.plist
    English.lproj                    - English localization files
        ⁃   main.nib            - the main nib
        ⁃   InfoPlist.strings       - strings file
    HID Utilities                    - folder of sources for HID utility files
        ⁃   IOHIDLib_.h         - single include header for HID utility files
        ⁃   HID_Utilities.c         - HID utility source
        ⁃   HID_Utilities.h         - HID utility header
        ⁃   IOHIDDevice_.c          - HID Device utilities source
        ⁃   IOHIDDevice_.h          - HID Device utilities header
        ⁃   IOHIDElement_.c         - HID Element utilities source
        ⁃   IOHIDElement_.h         - HID Element utilities source
        ⁃   English.lproj           - HID utilities localization files
            ⁃   HID_usage_strings.plist - HID usage strings (XML) file
    build                            - contains a prebuilt binary.

Building the Sample
-------------------
The sample was built using Xcode 3.0 on Mac OS X 10.5.  You should be able to
just open the project and choose Build from the Build menu.  This will build
&quot;HID Calibrator.app&quot; in the &quot;build/debug&quot; or &quot;build/release&quot; directory.

Using the Sample
----------------
Launch &quot;HID Config Save&quot;
In the &quot;File&quot; menu select the &quot;Configure Input&quot; (command-K) item; a &quot;Config
Window&quot; should appear.
Press the &quot;X Axis&quot; button and then press or move a USB HID devices element
(key, button, axis, etc).
Repeat the previous step for the &quot;Y Axis&quot;, &quot;Thrust&quot;, and &quot;Fire&quot; buttons.
Press the &quot;Ok&quot; button to close the window.
In the &quot;File&quot; menu select the &quot;Save Configuration&quot; (command-S) item.
Quit and re-launch the &quot;HID Config&quot; application.
In the &quot;File&quot; menu select the &quot;Configure Input&quot; (command-K) item; a &quot;Config
Window&quot; should appear. Note: the buttons should be assigned to the saved
configuration.
In the &quot;File&quot; menu select the &quot;Go&quot; (command-G) item; A &quot;Game&quot; window should
appear; moving the HID element associated with the X or Y axis should move the
red dot in the center of the square. Interacting with the &quot;Fire&quot; and &quot;Thrust&quot;
elements should update their associated controls.

How the code works
------------
In the &quot;main&quot; routine if all the initialization code executes successfully then
the Initialize_HID routine is called. This routine creates a IOHID Manager
reference which is then used to install device matching
(Handle_DeviceMatchingCallback) and removal (Handle_DeviceRemovalCallback)
callbacks and schedule the manager with the runloop. It then calls
HIDBuildMultiDeviceList (a routine in the HID Utilities sources) to open the
IOHID Manager reference. 

When the &quot;File&quot; menu's &quot;Configure Input&quot; (command-K) item is selected the
application event handler routine (Handle_AppEvents) is call with a
kEventCommandProcess message whose commandID is kHICommandConfig. If the
configure window (gConfigWindowRef) doesn't yet exists this routine will create
it (mapping any current configuration information to the appropriate buttons at
this time (via the Set_DeviceControlNames routine)) and installing a window
event handler (Handle_ConfigurationWindowEvents). That routine will be called
for all interactions with this windows controls.

For the &quot;X Axis&quot;, &quot;Y Axis&quot;, &quot;Thrust&quot;, and &quot;Fire&quot; buttons the HIDConfigureAction
routine will be called which waits up to ten seconds for a HID element to be
interacted with; if that happens before the timeout period then that HID device
&amp; element is mapped to that action. The &quot;Ok&quot; button dismisses the window.

When the &quot;File&quot; menus &quot;Save Configuration&quot; (command-S) item is selected the
application event handler routine (Handle_AppEvents) is call with a
kEventCommandProcess message whose commandID is kHICommandSave which will call
the Save_Config routine.

The Save_Config routine iterates over the gActionArray saving each element via
the HIDSaveElementPref routine.

When the &quot;File&quot; menus &quot;Restore Configuration&quot; (command-R) item is selected the
application event handler routine (Handle_AppEvents) is call with a
kEventCommandProcess message whose commandID is kHICommandRestore which will
call the Restore_Configs routine.

The Restore_Configs routine iterates over the gActionArray restoring each
element via the HIDRestoreElementPref routine.

When the &quot;File&quot; menus &quot;Go&quot; (command-G) item is selected the application event
handler routine (Handle_AppEvents) is call with a kEventCommandProcess message
whose commandID is kHICommandGoGo. If no game window exists it will be created
and an event handler (Handle_GameWindowEvents) installed. A event handler
(Handle_HIViewEvents) will also be installed for the custom user pane in this
window. If the USE_QUEUES macro is defined then HID queues are created and value
available callbacks (Handle_ValueAvailableCallback) are installed. If the
USE_QUEUES macro is not defined but the USE_VALUE_CALLBACK macro is then a
device input value callback (Handle_InputValueCallback) is installed. If neather
of these macro are defined then a Carbon event loop timer callback
(Handle_TimerEvents) is installed.

The Handle_GameWindowEvents routine is called when the user presses the &quot;Ok&quot;
button. When this happens the event loop timer is removed and the IOHID device
actions are unscheduled from the run loop and input value callbacks are
un-registered. Then the game window is dismissed.

The Handle_HIViewEvents routine is called to draw the user pane in the game
window (which consist of the square border and a red dot that corresponds to the
values of the X and Y axis).

The Handle_ValueAvailableCallback routine will be called when there is a queue
value available. It will loop calling IOHIDQueueCopyNextValue until there are no
more values available. When there is a value available it will iterate over the
gActionArray looking for elements that match the HID value's element; if found
the new value will be stored in the array.

The Handle_InputValueCallback routine will be called when any HID element value
changes for any HID device. It will iterate over the gActionArray looking for
elements that match the HID value's element; if found the new value will be
stored in the array

The Restore_Configs routine iterates over the gActionArray restoring each
element via the HIDRestoreElementPref routine.

Caveats
-------

This demonstration application and the set of utilities is constantly evolving
to both address any bugs and provide better support for developer requested
features. Any suggestions and/or bugs can be directed to the Apple bug reporter
at: &lt;http://developer.apple.com/bugreporter/index.html&gt;

We hope this helps people get up and running with the HID Manager APIs
introduced in 10.5 in a quick and painless manner.

Credits and Version History
---------------------------

Version 4.0    18 Oct 2007
        Update for new Leopard API's and Universal Binary. 
        Dropped MWCW, Project Builder and all CFM support.

Version 3.2    15 Oct 2004
        Fixed a bug where HIDGetNextDeviceElement wasn't
            iterating to the next sibling when returning to the top of the tree.
        Reformatted for DTS template
        Changed to using hu_device_t and hu_element_t
        Added Intro.rtf ( may be merged into generic read me )
        Added Immersion sources ( for FFB )

Version 3.1    28 Oct 2002
        General cleanup for web posting.

Version 3.0    First major release since 2.0 in Dec 2K1.
        Changed all references to &quot;Kernel/IOKit/hidsystem/&quot; to &quot;IOKit/hid/&quot;.
        Added &quot;Queue Empty&quot; callback test code ( it works! ).
        Changed HIDSaveElementConfig =&gt; HIDSaveElementPref
        Changed HIDRestoreElementConfig =&gt; HIDRestoreElementPref
        GetDeviceElementNameString now uses the &quot;New &amp; Improved!&quot;
            HIDGetElementNameFromVendorProductUsage instead of the
            HIDGetUsageName API. 
        Added menus and routines to rebuild the device list, 
            and test transaction, polling and pinging devices.
        Changed the HIDBuildDeviceList call in main to NOT limit 
            the device list to just gamepads.

Version 2.0: Update for new interface types and include files. Added
        CFM support in separate CW project.  This CFM
        application utilizes the HID.Bundle ( containing a MachO
        dylib ).  The sample is set up to look for the bundle in
        the same directory as the application ( which could be
        modified easily to suit developer needs ).  Note, this
        CFM sample application is bundled ( with the CW project
        designed to put the executable in the correct place with
        the correct name for the bundle ) but this is only to
        support the Nib interface. There is no requirement for a
        bundled application to use HID Utilities CFM support.

Version 1.1:     Update.  Updated a number of framework issues.

Version 1.0:     Initial release.  Application to demonstrate building
        device list, configuring input for simple game, save and
        retrieving configuration and handling input for the game.
        painless manner.

Share and Enjoy.
Apple Developer Technical Support
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/HID_Config_Save/listing1.html%3Fid%3DDTS10000442-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/HID_Config_Save/listing1.html%3Fid%3DDTS10000442-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/HID_Config_Save/listing1.html%3Fid%3DDTS10000442-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>