<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Controlling a Camera Position With a Pointing Device</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3212"> </A>Controlling a Camera Position With a Pointing Device</H1><P CLASS="T1.Text1"><A NAME="pgfId=3214"> </A><A NAME="marker=3213"> </A>By default, a 3D pointing device contributes to the position and orientation of the cursor. You can, however, reassign a particular pointing device so that it controls some other element in a user interface view, such as the position and orientation of the view's camera. To do this, you must first find the pointing device. Then you need to disconnect the device from the cursor and connect it to the desired user interface element.</P><P CLASS="T1.Text1"><A NAME="pgfId=3215"> </A>Suppose that the pointing box you want to reassign is a knob box, which consists of a set of 12 knobs and associated alphanumeric displays. Six of the knobs control the standard position and orientation values, and the remaining 6 knobs are device-specific. <A HREF="qd3dpointdevmgr.7.htm#41339" CLASS="XRef">Listing&nbsp;4</A> shows first how to search for the knob box.</P><P CLASS="L.Listing"><A NAME="pgfId=3220"> </A>Listing&nbsp;4<A NAME="41339"> </A>Searching for a particular 3D pointing device</P><CODE CLASS="Cv.Code"><A NAME="pgfId=7557"> </A>TQ3ControllerRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBoxController&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= NULL;<BR>TQ3TrackerObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBoxTracker&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= NULL;<BR>unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBoxSerialNumber&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<BR><BR>void MyFindKnobBox (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3ControllerRef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;controller;<BR>&nbsp;&nbsp;&nbsp;&nbsp;char &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mySig[256];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*controller signature*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;char &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*boxSig =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;Knob Systems, Inc.::Knob Box Grand&eacute;&quot;;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3Boolean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isActive;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Find the box controller.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;for (Q3Controller_Next(NULL, &amp;controller); controller != NULL;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_Next(controller, &amp;controller)) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_GetSignature(controller, mySig, 256);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_GetActivation(controller, &amp;isActive);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (isActive &amp;&amp; strncmp(mySig, boxSig, strlen(boxSig))<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== 0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBoxController = controller;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*If we found a knob box, remember it.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (gBoxController != NULL) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gBoxTracker = Q3Tracker_New(MyBoxNotifyFunc);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (gBoxTracker != NULL) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Tracker_SetNotifyThresholds(gBoxTracker, 0.05, 0.05);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_SetTracker(gBoxController, gBoxTracker);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3223"> </A><A NAME="marker=7559"> </A>Once you've found a knob box, you must connect it to the camera, but only for as long as your application's window is active. When the window is inactive, the box should revert to its previous function. <A HREF="qd3dpointdevmgr.7.htm#26719" CLASS="XRef">Listing&nbsp;5</A> defines two functions you should call when your application becomes active or inactive.</P><P CLASS="L.Listing"><A NAME="pgfId=3228"> </A>Listing&nbsp;5<A NAME="26719"> </A>Activating and deactivating a pointing device</P><CODE CLASS="Cv.Code"><A NAME="pgfId=7563"> </A>void MyOnActivation (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Any knob box data goes to your tracker.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (gBoxController != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_SetTracker(gBoxController, gBoxTracker);<BR>}<BR><BR>void MyOnDeactivation (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Any knob box data goes to the default tracker.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (gBoxController != NULL)<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Controller_SetTracker(gBoxController, NULL);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3232"> </A><A NAME="marker=7565"> </A>As long as the knob box is attached to a view's camera, your application receives notification of changes in the knob box through the notify function <TT CLASS="cv">MyBoxNotifyFunc</TT>, defined in <A HREF="qd3dpointdevmgr.7.htm#15838" CLASS="XRef">Listing&nbsp;6</A>. <TT CLASS="cv">MyBoxNotifyFunc</TT> may be called at interrupt time. On Macintosh computers, you should wake up your process so that it can poll the tracker. This ensures that the application will recover control from the <TT CLASS="cv">WaitNextEvent</TT> function.</P><P CLASS="L.Listing"><A NAME="pgfId=3237"> </A>Listing&nbsp;6<A NAME="15838"> </A>Receiving notification of changes in a pointing device</P><CODE CLASS="Cv.Code"><A NAME="pgfId=7569"> </A>TQ3Status MyBoxNotifyFunc (TQ3TrackerObject tracker, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TQ3ControllerRef controller)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyOSWakeUpMyProcess();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*wake up app; poll for data later*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;return(kQ3Success);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3244"> </A><A NAME="marker=7571"> </A>The <TT CLASS="cv">MyPollKnobBox</TT> function defined in <A HREF="qd3dpointdevmgr.7.htm#28194" CLASS="XRef">Listing&nbsp;7</A> shows how to poll for data from the device. Your application's idle procedure should call <TT CLASS="cv">MyPollKnobBox</TT>.</P><P CLASS="L.Listing"><A NAME="pgfId=3249"> </A>Listing&nbsp;7<A NAME="28194"> </A>Polling for data from a pointing device</P><CODE CLASS="Cv.Code"><A NAME="pgfId=7575"> </A>void MyPollKnobBox (void)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3Boolean&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;changed;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3Point3D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3Vector3D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delta;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Get the current knob positions.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;changed = kQ3False;<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (gBoxTracker != NULL) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Tracker_GetPosition(gBoxTracker, &amp;position, &amp;delta, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;changed, &amp;gBoxSerialNumber);<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Move camera and redraw if positions are new.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (changed) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyComputeCameraFromKnobBox(&amp;position, &amp;orientation);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyRedrawScene();<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}<BR></CODE><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>