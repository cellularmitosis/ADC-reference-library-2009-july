<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Java Client Programming Guide (Legacy): The Distribution Layer</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="The Distribution Layer"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001017-CH302" title="The Distribution Layer"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../LegacyTechnologies/Tools-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000463" target="_top">Tools</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30001017-CH297-TP1">WebObjects Java Client Programming Guide (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../InsideAssistant/InsideAssistant.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedTutorial/AdvancedTutorial.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30001017-CH302-TP1" title="The Distribution Layer"></a><h1>The Distribution Layer</h1><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_466"></a><p>The distribution layer (<code>com.webobjects.eodistribution</code> and <code>com.webobjects.eodistribution.client</code>) consists of the objects that make client-server communication in Java Client applications different from client-server communication in HTML-based WebObjects applications. Understanding its details will help you write better designed, more advanced, and more secure Java Client applications.</p><p>This chapter covers the following topics as they relate to the distribution layer:</p><ul class="ul"><li class="li"><p>business logic partitioning</p></li><li class="li"><p>distribution layer objects and intralayer communication</p></li><li class="li"><p>remote method invocations<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_467"></a></p></li><li class="li"><p>distribution channels</p></li><li class="li"><p>distribution layer delegates</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF31">Business Logic Partitioning</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF34">Remote Method Invocations</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF37">Custom Code in Business Logic</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF38">Distribution Layer Objects</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF39">Data Synchronization</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF44">Using SSL</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF41">Delegates</a>
				
			<br/>
			
        
			
			
				<a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-BABDDDAA">Setting the Delegate</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF31" title="Business Logic Partitioning"></a><h2>Business Logic Partitioning</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_468"></a><p>In HTML-based WebObjects applications, all business logic (and the business objects that use that logic) lives on the server. Business objects are never sent to the client (the Web browser). Rather, selected data from those business objects is sent along with HTML user interface data. </p><p>In Java Client, however, business objects are sent to the client application for performance reasons. Java Client applications generally access more data than do distributed HTML applications. To limit the number of round trips to the server, copies of the business objects containing the data live on the client.</p><p>While this helps performance, it also presents security issues. In Java Client, business objects are Java objects, which can be decompiled and analyzed quite easily. So you never want to send sensitive business objects (objects containing private algorithms or data) to the client. </p><p>To control which business objects are sent to the client, you use <em>business logic partitioning</em>. As well as securing business data, business logic partitioning can also improve performance. The key to business logic partitioning is to minimize the amount of data sent from server to client while simultaneously minimizing the number of round trips over the network.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF32" title="Design Recommendations"></a><h3>Design Recommendations</h3><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_469"></a><p>There are many ways to perform business logic partitioning. Often, you create a business logic class for the server and one for the client. These classes can be identical or their implementations can differ, depending on what data you want sent to the client.</p><p>Alternatively, you can create a common superclass from which the client and server subclasses inherit. In the common superclass, provide abstract declarations of the methods you want to be different in the two subclasses. In the client subclass, the methods should simply invoke remote methods of which concrete implementations exist in the server subclass.</p><p>For example, a common superclass might resemble this one:</p><div class="codesample"><table><tr><td scope="row"><pre>package example.common;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>public abstract class Foo extends EOGenericRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>    public abstract String bar();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The client class (with a remote method invocation) would then resemble this class:</p><div class="codesample"><table><tr><td scope="row"><pre>package example.client;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>public class Foo extends example.common.Foo {<span></span></pre></td></tr><tr><td scope="row"><pre>    public String bar() {<span></span></pre></td></tr><tr><td scope="row"><pre>     return (String) invokeRemoteMethod("clientSideRequestBar", null, null);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The server-side class would then resemble this class:</p><div class="codesample"><table><tr><td scope="row"><pre>package example.server;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>public class Foo extends example.common.Foo {<span></span></pre></td></tr><tr><td scope="row"><pre>    public String bar() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return "secret string";<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    public String clientSideRequestBar() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return bar();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The actual partitioning of your business logic begins in your EOModel. In EOModeler, you can assign custom classes to each entity in the model. See <span class="content_text"><a href="../AdvancedTutorial/AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF106">“Add Custom Business Logic”</a></span> in the advanced tutorial for an example.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF33" title="Performance"></a><h3>Performance</h3><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_470"></a><p>As well as providing security for your business logic, partitioning can also confer performance improvements, depending on where computations take place. For example, if a particular computation requires a lot of data, and the client does not already have the data, that computation should occur on the server, as the server is closer to the data store. </p><p>Likewise, since Java Client requires rather robust clients, nonsensitive computations can occur on the client. This relieves the server from expending more cycles.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF34" title="Remote Method Invocations"></a><h2>Remote Method Invocations</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_471"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_472"></a><p>In Java Client applications, you may want some methods to execute only on the server for both security and performance reasons, such as when the method consumes a lot of system resources. Java Client defines two categories of remote method invocations: those that apply to business logic and those that apply to application logic.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF35" title="Business Logic"></a><h3>Business Logic</h3><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_473"></a><p>If you partition your business logic in the recommended way, your client business logic classes shouldn’t include any sensitive algorithms or computations. Rather, they should simply use remote method invocations to invoke concrete implementations of custom methods on the server that perform the sensitive computations. However, since remote method invocations require a round trip to the server, you <em>should</em> put nonsensitive algorithms in client-side business logic classes to reduce network traffic. </p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_474"></a>There are many methods defined throughout the Enterprise Object technology to perform remote method invocations. Client-side business logic classes that inherit from <code>com.webobjects.eocontrol.EOCustomObject</code> can use <code>invokeRemoteMethod<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_475"></a></code> to invoke a method in the corresponding enterprise object on the server. The method takes three arguments: the method to invoke in the server-side class, a <code>java.lang.Class</code> object representing the argument types, and an object containing the arguments. Here’s an example:</p><div class="codesample"><table><tr><td scope="row"><pre>public void calculateRating() {<span></span></pre></td></tr><tr><td scope="row"><pre>    invokeRemoteMethod("clientSideRequestCalculateRating", new Class[]          {NSArray.class}, new Object[] {globalIDs});<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This code invokes a method called <code>clientSideRequestCalculateRating</code> on the server, which takes an NSArray as an argument. You can pass <code>null</code> for both the second and third arguments if the remote method takes no arguments.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_476"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_477"></a>When you invoke a remote method on an enterprise object, the state of the client-side editing context is pushed to the server side. This guarantees that the business objects in the server-side computations are up to date with their client-side counterparts. Keep in mind that if you nest editing contexts on the client, all the editing contexts are pushed to the server side upon remote method invocation.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_478"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_479"></a>Note that <code>com.webobjects.eodistribution.client.EODistributedObjectStore</code> has remote method invocation methods (<code>invokeRemoteMethod<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_480"></a></code> and <code>invokeRemoteMethodWithKeyPath<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_481"></a></code>) that include a Boolean flag to control the pushing of the client-side editing context to the server. Setting this flag to <code>false</code> prevents the client from pushing its editing context state to the server. Since these methods are defined in EODistributedObjectStore, you must call them on an object store object if you invoke them from business logic classes. </p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_482"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_483"></a>Remote method invocations raise some security concerns since the client is assumed to be trusted. However WebObjects Java Client is well-prepared to handle these concerns. It includes built-in security features that prevent unauthorized remote method invocations. By default, remote method names must be prefixed with <code>clientSideRequest</code>, otherwise the EODistributionContext object on the server does not allow the remote method invocation. You can use delegates on the distribution context to implement your own security mechanisms for remote method invocations, as described in <span class="content_text"><a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF41">“Delegates.”</a></span></p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_145" title="Note"></a><p><strong>Note:</strong>&nbsp;This security<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_484"></a> contract applies only when the default distribution context delegate is used. That is, while the distribution context delegate is the Session object (which it is by default), remote method invocations that comply with the prefixing rule described in the above paragraph are allowed to execute. </p>However, if you set the distribution context delegate to an object other than Session, the prefixing contract does not apply and you must authorize each remote invocation explicitly by overriding these methods in the custom delegate class: <code>distributionContextShouldFollowKeyPath</code><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_485"></a> (to authorize the distribution layer to follow the key path that references the custom delegate) and <code>distributionContextShouldAllowInvocation<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_486"></a></code> (to allow the invocation of a method or methods in the custom delegate class).</p></div><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF36" title="Application Logic"></a><h3>Application Logic</h3><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_487"></a><p>Not all remote method invocations relate directly to business logic. Sometimes, you’d like to get information from the server that is specific to your application, but not particular to your application’s business logic. This may include knowing what resources are available and how to handle user defaults.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_488"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_489"></a>Application-level remote methods are called with <code>invokeRemoteMethodWithKeyPath<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_490"></a></code> and <code>invokeStatelessRemoteMethodWithKeyPath</code><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_491"></a>, which are defined in EODistributedObjectStore. These methods are similar to <code>invokeRemoteMethod<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_492"></a></code> except for two things. The receiver of the invocation can be any object (not just an enterprise object) that can be specified with a key path. The <code>keyPath</code> argument has special semantics:</p><ul class="spaceabove"><li class="li"><p>If <code>keyPath</code> is a fully qualified key path (for example, <code>session.editingContext</code>) the key path is followed starting from the invocation target of the EODistributionContext, which by default is the WOJavaClientComponent object.</p></li><li class="li"><p>If <code>keyPath</code> is an empty string, the method is invoked on the WOComponent that is the invocation target of the EODistributionContext (typically a WOJavaClientComponent).</p></li><li class="li"><p>If <code>keyPath</code> is <code>null</code>, the method is invoked on the server-side EODistributionContext.</p></li></ul><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_493"></a>The same security mechanism applies to these types of remote method invocations as to remote method invocations that occur on business logic classes (but only if the default distribution context delegate is used). That is, if the key path is <code>session</code>, the EODistributionContext on the server blocks all invocations sent with this method unless the <code>methodName</code> argument is prefixed with <code>clientSideRequest</code>.</p><p>If the key path specified is other than <code>session</code>, the EODistributionContext’s delegate (on the server) must implement <code>distributionContextShouldAllowInvocation<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_494"></a></code> and <code>distributionContextShouldFollowKeyPath</code><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_495"></a> to allow the target method of the remote method invocation to be executed.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_496"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_497"></a>You can also invoke application-specific remote methods with <code>invokeStatelessRemoteMethodWithKeyPath</code><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_498"></a>. Unlike <code>invokeRemoteMethodWithKeyPath<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_499"></a></code>, it does not synchronize the client and server editing contexts. It is useful if you want to do something that has nothing to do with business logic, such as loading resources, running checks in background threads, and so on. It is much faster than <code>invokeRemoteMethodWithKeyPath<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_500"></a></code> since it doesn’t affect the object graph or editing contexts and avoids synchronization issues with client-side editing contexts in multithreaded applications.</p><p>In short, application-logic remote method invocations usually originate in custom Java Client controller classes, while business-logic remote method invocations usually originate from enterprise object classes (classes implementing the <code>com.webobjects.eocontrol.EOEnterpriseObject</code> interface).</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF43" title="Distributed Object Store"></a><h3>Distributed Object Store</h3><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_501"></a><p>To perform remote method invocation on application logic, you invoke the methods on the client’s distributed object store. The WebObjects API reference describes the distributed object store as follows:</p><p>“An EODistributedObjectStore functions as the parent object store on the client side of Java Client applications. It handles interaction with the distribution layer’s channel (an EODistributionChannel object), incorporating knowledge of that channel so it can forward messages it receives from the server to its editing contexts and forward messages from its editing contexts to the server.”</p><p>You can get the distributed object store object with this code (assuming you haven’t done anything special in the distribution layer with regard to the <code>EODistributedObjectStore</code>):</p><div class="codesample"><table><tr><td scope="row"><pre>private EODistributedObjectStore _distributedObjectStore() {<span></span></pre></td></tr><tr><td scope="row"><pre>    EOObjectStore objectStore = EOEditingContext.defaultParentObjectStore();<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((objectStore == null) || (!(objectStore instanceof EODistributedObjectStore))) {<span></span></pre></td></tr><tr><td scope="row"><pre>        throw new IllegalStateException("Default parent object store needs to be an<span></span></pre></td></tr><tr><td scope="row"><pre>          EODistributedObjectStore");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return (EODistributedObjectStore)objectStore;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Then you invoke the remote method on the object returned by the above method:</p><div class="codesample"><table><tr><td scope="row"><pre>_distributedObjectStore().invokeRemoteMethodWithKeyPath(&lt;arguments>);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF37" title="Custom Code in Business Logic "></a><h2>Custom Code in Business Logic </h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_502"></a><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_503"></a>There are a few things you need to know about using custom code in business logic classes. If you write methods that perform computations that require values in the enterprise object, two methods are provided to help you know when to invoke the custom computations: <code>awakeFromClientUpdate</code> and <code>prepareValuesForClient</code>. </p><p>The <a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_504"></a><code>awakeFromClientUpdate</code> method is invoked after the EOGenericRecord subclass on the server receives a notification<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_505"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_506"></a> that all the business objects have been received from the client. If you try to invoke a method from one of the class’s <code>set</code> methods that performs a computation using values of attributes in your business logic, there is no guarantee that the server-side object has received all the values from the client you use in that calculation. However, if you invoke the method with said calculation in <code>awakeFromClientUpdate</code>, you are guaranteed to have all the business data from the client.</p><p>The <a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_507"></a><code>prepareValuesForClient</code> method is invoked in the EOGenericRecord subclass right before the business objects are sent back to the client (it is actually invoked right before the objects are encoded). You can override it to set a value before it is sent to the client if the value is only a client-side class property. </p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF38" title="Distribution Layer Objects"></a><h2>Distribution Layer Objects</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_508"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_509"></a><p>The distribution layer’s client-server communication mechanism relies on four objects: <code>com.webobjects.eodistribution.WOJavaClientComponent</code>, <code>com.webobjects.eodistribution.EODistributionContext</code>, <code>com.webobjects.eodistribution.client.EODistributedObjectStore</code>, and <code>com.webobjects.eodistribution.client.EODistributionChannel</code>.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_510"></a>The flow of information works like this: The client editing contexts talk to the EODistributedObjectStore (client side), which uses an EODistributionChannel to transfer objects across the network to the WOJavaClientComponent object, which uses an EODistributionContext to talk to the server-side editing context and to take care of generating responses to client requests. This flow is illustrated in <span class="content_text"><a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF42">Figure 5-1</a></span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF42" title="Figure 5-1Objects in the distribution layer"></a><p><strong>Figure 5-1&nbsp;&nbsp;</strong>Objects in the distribution layer</p><img src = "../Art/distributionlayerobjects2.gif" alt = "Objects in the distribution layer" width="212" height="322"></div><br/><p>Let’s examine each of these objects.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_511"></a>EODistributedObjectStore is the parent object store for all the editing contexts on the client. It makes the client editing contexts behave like a nested editing context to the server-side editing context. Its function is similar to that of the EODatabaseContext object, which lives on the server.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_512"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_513"></a>EODistributionChannel is responsible for sending data from the client to the server (it actually encodes the data).</p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_514"></a>The WOJavaClientComponent object is the target of the data sent by EODistributionChannel. It forwards data from the client’s EODistributionChannel to the server’s EODistributionContext. It is provided to isolate the application from different deployment environments and also plays a large role in application startup. It is also the object that embeds Java Client in a WebObjects application.You can learn more about application startup by reading the API reference documentation for the distribution layer classes and the application-level classes in the application layer. </p><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_515"></a>EODistributionContext has many functions: It keeps track of the state of the enterprise objects graph; it tracks which objects the client has fetched; and perhaps most importantly, it synchronizes business objects on the client and server applications.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF39" title="Data Synchronization"></a><h2>Data Synchronization</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_516"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_517"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_518"></a><p>The distribution layer is responsible for synchronizing the client and server object stores. The data flow in a Java Client application occurs like this: </p><ol class="ol"><li class="li"><p>The user makes a query and the fetch specification is forwarded by the client’s EODistribution layer to the server’s EODistribution layer.</p></li><li class="li"><p>The normal WebObjects mechanisms take over, and a SQL call is eventually made to the database server.</p></li><li class="li"><p>The database server returns rows of requested data; these rows are mapped to enterprise object instances.</p></li><li class="li"><p>The server’s EODistribution layer sends copies of the requested data to the client.</p></li><li class="li"><p>The client’s EODistribution layer receives the objects and registers them with the client’s editing context (the data is cached in the client’s object graph).</p></li><li class="li"><p>Through the client’s display group and association mechanisms, the user interface is populated.</p></li></ol><p>As users modify the data (or delete or add rows of data), the client’s object graph is updated to reflect the new state. When users request that this data be saved, the changed object graph is pushed to the server. If the business logic on the server validates these changes, the changes are committed to the database.</p><p>Synchronization of the client and server’s object graphs occurs automatically: Java Client automatically pushes updates from the server to the client. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_146" title="Note"></a><p><strong>Note:</strong>&nbsp;Although requested objects are copied from the server to the client and these objects exist in parallel object graphs on both server and client, the object graphs on the client are usually a subset of those on the server. You can partition your application’s enterprise objects so that the objects that exist on the client (or the server) have a restricted set of data and behaviors.</p></div><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF44" title="Using SSL"></a><h2>Using SSL</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_519"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_520"></a><p>The distribution<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_521"></a> channel in Java Client (EODistributionChannel) distributes data between the client and server applications. By default, Java Client uses HTTP as the transport mechanism (EOHTTPChannel), but you can subclass EOHTTPChannel to provide a custom mechanism such as SSL. Assuming that you’re using Sun’s JSSE SSL classes, you can use the class in <span class="content_text">Listing 5-1</span>.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-BABCHFDJ" title="Listing 5-1Subclass EOHTTPChannel to use SSL"></a><p class="codesample"><strong>Listing 5-1&nbsp;&nbsp;</strong>Subclass EOHTTPChannel to use SSL</p><div class="codesample"><table><tr><td scope="row"><pre>package com.mycompany.client;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.net.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.security.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class SSLChannel extends com.webobjects.eodistribution.client.EOHTTPChannel {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    static {<span></span></pre></td></tr><tr><td scope="row"><pre>        System.setProperty("java.protocol.handler.pkgs",<span></span></pre></td></tr><tr><td scope="row"><pre>          "com.sun.net.ssl.internal.www.protocol");<span></span></pre></td></tr><tr><td scope="row"><pre>        Security.addProvider(new com.sun.net.ssl.internal.ssl.Provider());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Socket createSocket(String protocol, String hostName, int portNumber) throws          IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!"https".equals(protocol)) {<span></span></pre></td></tr><tr><td scope="row"><pre>            return super.createSocket(protocol, hostName, portNumber);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Socket socket =<span></span></pre></td></tr><tr><td scope="row"><pre>           javax.net.ssl.SSLSocketFactory.getDefault().createSocket(hostName, 443);<span></span></pre></td></tr><tr><td scope="row"><pre>        socket.setTcpNoDelay(true);<span></span></pre></td></tr><tr><td scope="row"><pre>        return(socket);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Make sure to add this subclass to the Web Server (client application) target in your project. </p><p>After you add this class, you need to add a binding on the server-side distribution layer component to tell the application to use the custom subclass. Add a binding to the <code>JavaClient.wo</code> component called <code>distributionChannelClassName</code>. Its value is the fully qualified name of the distribution layer subclass that uses SSL. Using the subclass in <span class="content_text">Listing 5-1</span>, this is <code>com.mycompany.client.SSLChannel</code>.</p><p>If you’ve already configured your Web server to use SSL, there are no more steps to perform to use SSL in Java Client applications. Unfortunately, configuring a Web server to use SSL, obtaining SSL certificates, and other tasks necessary to implement a secure protocol are rather complicated tasks and are beyond the scope of this document. </p><p>However<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_522"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_523"></a>, if you’re deploying on Mac OS X, the included Apache Web server includes the mod_ssl module and documentation for configuring SSL. See <code>file:///Library/Documentation/Services/apache_mod_ssl/ssl_overview.html</code> on a Mac OS X system.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF41" title="Delegates"></a><h2>Delegates</h2><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_524"></a><p>Since the Java Client distribution layer is rather complex, it provides a number of delegates you can use to customize its behavior, which saves you from subclassing. You can set delegates for EODistributionContext and EODistributionChannel to</p><ul class="ul"><li class="li"><p>change the security mechanism for validating remote method invocations</p></li><li class="li"><p>implement a custom encryption and decryption scheme for data transfer over the network</p></li><li class="li"><p>control access to business objects</p></li><li class="li"><p>handle client-side I/O exceptions</p></li><li class="li"><p>handle server-side exceptions such as validation, null pointer exceptions, and session timeouts</p></li></ul><p><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_525"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_526"></a>The default delegate of the distribution layer is the application’s Session object. This is set in the EODistributionContext’s constructor and you set custom delegates with the <code>setDelegate</code> method in EODistributionChannel and EODistributionContext, as described in <span class="content_text"><a href="DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-BABDDDAA">“Setting the Delegate.”</a></span> Because the Session object is the default delegate, you can override the methods that are defined in the EODistributionContext.Delegate class in the Session class and they will be found and invoked by the distribution layer automatically.</p><p>To secure access to the data sources with which the server-side application communicates, you override methods defined in the class EODistributionContext.Delegate. A common design pattern is to override all the methods in the delegate class to return <code>true</code> only if a user has authenticated. The easiest and most common way to do this is to store the state of a user’s login in the Session object, as is described in <span class="content_text"><a href="../T13LoginWindow/T13LoginWindow.html#//apple_ref/doc/uid/TP30001017-CH321-TP1">“Building a Login Window”</a></span> and as shown in the JCDiscussionBoard example project.</p><p>Assuming that you store a user’s authenticated state in an instance variable (<code>isAuthenticated</code>) in the Session class, you can use the code in <span class="content_text">Listing 5-2</span> to prevent unauthenticated access to the data store. By restricting access to the class description of entities in the application, you restrict access to and editing of all entities in the application.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-TPXREF45" title="Listing 5-2Use a delegate to restrict access to data"></a><p class="codesample"><strong>Listing 5-2&nbsp;&nbsp;</strong>Use a delegate to restrict access to data</p><div class="codesample"><table><tr><td scope="row"><pre>public boolean distributionContextShouldAllowAccessToClassDescription(<span></span></pre></td></tr><tr><td scope="row"><pre>     EODistributionContext context, EOClassDescription classDescription) {<span></span></pre></td></tr><tr><td scope="row"><pre>     return (isAuthenticated());}<span></span></pre></td></tr></table></div>	<p>Other delegates defined in EODistributionContext.Delegate allow you to control whether editing contexts are allowed to save, whether particular fetch specifications are allowed to be invoked, and whether the target methods of remote method invocations are allowed to be invoked. There are also two methods you can use to encrypt and decrypt data across the wire, though using SSL as the EODistributionChannel protocol is probably a better idea to secure client-server communications. See the API reference for EODistributionContext.Delegate for more details.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-BABDDDAA" title="Setting the Delegate"></a><h2>Setting the Delegate</h2><p>To set the distribution context’s delegate, you need to know when the distribution context has been instantiated. You can use the code in <span class="content_text">Listing 5-3</span> to listen for the notification<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_527"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_528"></a> that is sent immediately after the distribution context is instantiated and to invoke custom behavior after that event has occurred.</p><a name="//apple_ref/doc/uid/TP30001017-CH302-BABHIJGB" title="Listing 5-3Set the distribution context&acirc;&#128;&#153;s delegate"></a><p class="codesample"><strong>Listing 5-3&nbsp;&nbsp;</strong>Set the distribution context’s delegate</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.appserver.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eodistribution.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class Session extends WOSession {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public EODistributionContext dContext = null;<span></span></pre></td></tr><tr><td scope="row"><pre>    public MyDistributionDelegate myDelegate = null;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public Session() {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        myDelegate = new MyDistributionDelegate();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        NSNotificationCenter.defaultCenter().addObserver(this,<span></span></pre></td></tr><tr><td scope="row"><pre>            new NSSelector("listenForContext", new Class[] { NSNotification.class } ),<span></span></pre></td></tr><tr><td scope="row"><pre>            EODistributionContext.DistributionContextInstantiatedNotification, null);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void listenForContext(NSNotification notification) {<span></span></pre></td></tr><tr><td scope="row"><pre>        dContext = (EODistributionContext)notification.object();<span></span></pre></td></tr><tr><td scope="row"><pre>        dContext.setDelegate(myDelegate);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>In Session’s constructor in <span class="content_text">Listing 5-3</span>, the class registers with the default notification<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_529"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_530"></a><a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_531"></a> center to listen for the <code>EODistributionContext.DistributionContextInstantiatedNotification<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_532"></a></code> notification. When that notification is received from the notification center, the method specified with the NSSelector argument (the method named <code>listenForContext</code>, which takes a single NSNotification object as an argument) is invoked. The <code>listenForContext</code> method is passed a reference to the distribution context object on which it invokes <code>setDelegate</code>. It sets the delegate to a custom class called MyDistributionDelegate, which is instantiated in Session’s constructor.</p><p>To set the delegate for the distribution channel object, simply replace EODistributionContext in <span class="content_text">Listing 5-3</span> with EODistributionChannel<a name="//apple_ref/doc/uid/TP30001017-CH302-DontLinkElementID_533"></a>.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../InsideAssistant/InsideAssistant.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedTutorial/AdvancedTutorial.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/DesktopApplications/DistributionLayer/DistributionLayer.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/DesktopApplications/DistributionLayer/DistributionLayer.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/DesktopApplications/DistributionLayer/DistributionLayer.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>