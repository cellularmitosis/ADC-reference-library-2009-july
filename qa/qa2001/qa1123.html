<HTML><HEAD><title>Technical Q&amp;A QA1123: Getting List of All Processes on Mac OS X</title><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="sysctl ps GetNextProcess list processes applications"><meta name="Description" content="Technical Q&amp;A QA1123: This Q&amp;A describes how, on Mac OS X,to get a list of all applications, using Carbon APIs, andall processes, using BSD APIs."><meta name="categories" content="Processes"><meta name="week-posted" content="Mar 4, 2002 - Mar 8, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001671" title="Getting List of All Processes on Mac OS X"></a><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/Darwin/index.html">Darwin</a> &gt; <a href="../../technicalqas/Darwin/idxPorting-date.html">Porting</a> &gt; </p><!-- end_header_information --> <!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1123</div>
<div id="pageheadsub">Getting List of All Processes on Mac OS X</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <!-- begin_content -->                  <hr width=500 align=center>                  <P id=p2>Q: How do I get a list of all processes on Mac OS         X?</P>                  <P id=p4>A: Well, that depends on how you define "process".         If you want to list all of the running applications you         should use the Carbon Process Manager routine <A HREF="http://developer.apple.com/documentation/mac/Processes/Processes-41.html"><CODE>GetNextProcess</CODE></A>.         This will return a list of all application processes,         including those running in the Carbon, Cocoa, and Classic         environments. However, this doesn't return a list of         non-application (daemon) processes.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=3 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <P><B>Note:</B><BR>                  Another caveat with <A HREF="http://developer.apple.com/documentation/mac/Processes/Processes-41.html"><CODE>GetNextProcess</CODE></A>                  is that it requires you to link with Carbon, which                  is not an option for some programs (for example,                  BSD daemon processes).</P>               </TD>            </TR>         </TABLE>         </CENTER>                  <P id=p4>You can get a list of all BSD processes, which         includes daemon processes, using the BSD <CODE>sysctl</CODE>         routine. Code for doing this is shown in Listing 1. When         using this code you should note the following.</P>                  <UL id=p4>            <LI>The returned <CODE>kinfo_proc</CODE> structures            contain a huge amount of information about the process,            including the process ID (in <CODE>kp_proc.p_pid</CODE>)            and the process name (in            <CODE>kp_proc.p_comm</CODE>).</LI>                        <LI>As far as BSD is concerned all Classic applications            run within a single process.</LI>                        <LI>You do not need any special privileges to make this            <CODE>sysctl</CODE>; any user can get a list of all            processes on the system.</LI>                        <LI>The <A HREF="http://www.erlenstar.demon.co.uk/unix/faq_toc.html">UNIX            Programming FAQ</A> lists a number of <A HREF="http://www.erlenstar.demon.co.uk/unix/faq_2.html#SEC17">alternative            ways to do this</A>. Of these, the only approach that            works on Mac OS X is exec'ing the <CODE>ps</CODE> command            line tool.  exec'ing ps will require parsing the tool's output and             will not use system resources as efficiently as Listing 1.</LI>                                 </UL>                  <P id=p4>You can map between BSD process IDs and Process         Serial Numbers using the routines <CODE>GetProcessPID</CODE>         and <CODE>GetProcessForPID</CODE> routines declared in         "Processes.h".<BR>         <BR>         </P>                  <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left><pre>#include &lt;assert.h&gt;#include &lt;errno.h&gt;#include &lt;stdbool.h&gt;#include &lt;stdlib.h&gt;#include &lt;stdio.h&gt;#include &lt;sys/sysctl.h&gt;typedef struct kinfo_proc kinfo_proc;static int GetBSDProcessList(kinfo_proc **procList, size_t *procCount)    // Returns a list of all BSD processes on the system.  This routine    // allocates the list and puts it in *procList and a count of the    // number of entries in *procCount.  You are responsible for freeing    // this list (use "free" from System framework).    // On success, the function returns 0.    // On error, the function returns a BSD errno value.{    int                 err;    kinfo_proc *        result;    bool                done;    static const int    name[] = { CTL_KERN, KERN_PROC, KERN_PROC_ALL, 0 };    // Declaring name as const requires us to cast it when passing it to    // sysctl because the prototype doesn't include the const modifier.    size_t              length;    assert( procList != NULL);    assert(*procList == NULL);    assert(procCount != NULL);    *procCount = 0;    // We start by calling sysctl with result == NULL and length == 0.    // That will succeed, and set length to the appropriate length.    // We then allocate a buffer of that size and call sysctl again    // with that buffer.  If that succeeds, we're done.  If that fails    // with ENOMEM, we have to throw away our buffer and loop.  Note    // that the loop causes use to call sysctl with NULL again; this    // is necessary because the ENOMEM failure case sets length to    // the amount of data returned, not the amount of data that    // could have been returned.    result = NULL;    done = false;    do {        assert(result == NULL);        // Call sysctl with a NULL buffer.        length = 0;        err = sysctl( (int *) name, (sizeof(name) / sizeof(*name)) - 1,                      NULL, &amp;length,                      NULL, 0);        if (err == -1) {            err = errno;        }        // Allocate an appropriately sized buffer based on the results        // from the previous call.        if (err == 0) {            result = malloc(length);            if (result == NULL) {                err = ENOMEM;            }        }        // Call sysctl again with the new buffer.  If we get an ENOMEM        // error, toss away our buffer and start again.        if (err == 0) {            err = sysctl( (int *) name, (sizeof(name) / sizeof(*name)) - 1,                          result, &amp;length,                          NULL, 0);            if (err == -1) {                err = errno;            }            if (err == 0) {                done = true;            } else if (err == ENOMEM) {                assert(result != NULL);                free(result);                result = NULL;                err = 0;            }        }    } while (err == 0 &amp;&amp; ! done);    // Clean up and establish post conditions.    if (err != 0 &amp;&amp; result != NULL) {        free(result);        result = NULL;    }    *procList = result;    if (err == 0) {        *procCount = length / sizeof(kinfo_proc);    }    assert( (err == 0) == (*procList != NULL) );    return err;}</pre>               </TD>            </TR>            <TR>               <td align="left">                  <P><B>Listing 1</B>. Code to list all BSD                  processes.</P>               </TD>            </TR>         </TABLE>         </CENTER>                           <hr width=500 align=center>         <!-- begin_date -->         <H4><CENTER>[Mar 5 2002]</CENTER></H4><!-- end_date -->               </TD>   </TR></TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1123.html%3Fid%3DDTS10001671-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1123.html%3Fid%3DDTS10001671-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1123.html%3Fid%3DDTS10001671-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>