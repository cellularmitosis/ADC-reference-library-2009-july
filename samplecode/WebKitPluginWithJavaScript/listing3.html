<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>WebKitPluginWithJavaScript - /ReadMe.txt</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/AppleApplications/index.html">Apple Applications</a> &gt; <a href="../../samplecode/AppleApplications/idxSafari-date.html">Safari</a> &gt; <A HREF="javascript:location.replace('index.html');">WebKitPluginWithJavaScript</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">WebKitPluginWithJavaScript</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ReadMe.txt</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/PluginWithJavaScript.h</option>
<option value="listing2.html">/PluginWithJavaScript.m</option>
<option value="listing3.html">/ReadMe.txt</option>
<option value="listing4.html">/SpeedometerView.h</option>
<option value="listing5.html">/SpeedometerView.m</option>
<option value="listing6.html">/SpeedyCategories.h</option>
<option value="listing7.html">/SpeedyCategories.m</option>
<option value="listing8.html">/test.html</option></select>
				</p>
				</form>
				<p><strong><a href="WebKitPluginWithJavaScript.zip">Download Sample</a></strong> (&#147;WebKitPluginWithJavaScript.zip&#148;, 62.5K)<BR>
<strong><a href="WebKitPluginWithJavaScript.dmg">Download Sample</a></strong> (&#147;WebKitPluginWithJavaScript.dmg&#148;, 111.9K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">File: ReadMe.txt

Abstract: readme file for the PluginWithJavaScript sample.

Version: 1.0

Disclaimer: IMPORTANT:  This Apple software is supplied to you by 
Apple Inc. (&quot;Apple&quot;) in consideration of your agreement to the
following terms, and your use, installation, modification or
redistribution of this Apple software constitutes acceptance of these
terms.  If you do not agree with these terms, please do not use,
install, modify or redistribute this Apple software.

In consideration of your agreement to abide by the following terms, and
subject to these terms, Apple grants you a personal, non-exclusive
license, under Apple's copyrights in this original Apple software (the
&quot;Apple Software&quot;), to use, reproduce, modify and redistribute the Apple
Software, with or without modifications, in source and/or binary forms;
provided that if you redistribute the Apple Software in its entirety and
without modifications, you must retain this notice and the following
text and disclaimers in all such redistributions of the Apple Software. 
Neither the name, trademarks, service marks or logos of Apple Inc. 
may be used to endorse or promote products derived from the Apple
Software without specific prior written permission from Apple.  Except
as expressly stated in this notice, no other rights or licenses, express
or implied, are granted by Apple herein, including but not limited to
any patent rights that may be infringed by your derivative works or by
other works in which the Apple Software may be incorporated.

The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE
MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION
THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS
FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND
OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS.

IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL
OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION,
MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED
AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE),
STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.

Copyright (C) 2007 Apple Inc. All Rights Reserved.


This file details the steps involved in making this simple WebKit plug-in.  If
you're just getting started with a webkit plug-in sample, these steps should be
sufficient to get your project on the road.  



1. Create a new project.
Create a new project in Xcode using the &quot;Cocoa Bundle&quot; template.




2. Add the WebKit framework to your project.
Turn down the &quot;Frameworks and Libraries&quot; group in the Groups &amp; Files area, and
then control-click (or right click) on the &quot;Linked Frameworks&quot; sub-group. 
Select &quot;Add &gt; Existing Frameworks...&quot; from the pop-up menu and add the
&quot;WebKit.framework&quot; (/System/Library/Frameworks/WebKit.framework) to the project.
 

NOTE: Be sure to add &quot;#import &lt;WebKit/WebKit.h&gt;&quot; to the beginning of any files
where you use the webkit apis.




3. Add your plug-in's class files to the project.
Add your plug-in class files to the project.  control-click (or right click) on
the classes group in the Groups &amp; Files area and select &quot;Add &gt; New File...&quot; from
the pop-up menu.  Select the 'Objective-C class template and name the file
&quot;PluginWithJavaScript&quot; (or whatever you would like to call your principle
class).




4. Identify your bundle as a WebKit plug-in.
To do that, change the CFBundlePackageType entry in your Info.plist file to the
value 'WBPL': 

  &lt;key&gt;CFBundlePackageType&lt;/key&gt;
  &lt;string&gt;WBPL&lt;/string&gt; 




5. Identify your plug-in's class for the bundle.
Identify the principal class used to define the functionality of your plug-in
by setting the NSPrincipalClass entry in your Info.plist to the name of the
class where you have implemented your plugInViewWithArguments:
WebPlugInViewFactory factory method.  In this sample, that will be our
&quot;PluginWithJavaScript&quot; class.

  &lt;key&gt;NSPrincipalClass&lt;/key&gt;
  &lt;string&gt;PluginWithJavaScript&lt;/string&gt;




6. Provide descriptive information about your plug-in.
Add a name and description for your plug-in by providing values for the
WebPluginName and WebPluginDescription keys in your Info.plist file.  These
names are used for displaying information about your plug-in to users.  In this
sample we have added the following entries:

  &lt;key&gt;WebPluginName&lt;/key&gt;
  &lt;string&gt;Simple WebKit Plug-In&lt;/string&gt;
  &lt;key&gt;WebPluginDescription&lt;/key&gt;
  &lt;string&gt;A simple WebKit plug-in example.&lt;/string&gt;




7. identify the mime types your plug-in is capable of displaying:
You can provide any number of mime types or file name extensions.  In this
sample, we only provide one.


  &lt;key&gt;WebPluginMIMETypes&lt;/key&gt;
  &lt;dict&gt;
    &lt;key&gt;application/x-javascriptplugin&lt;/key&gt;
    &lt;dict&gt;
      &lt;key&gt;WebPluginExtensions&lt;/key&gt;
      &lt;array&gt;
        &lt;string&gt;swkp&lt;/string&gt;
      &lt;/array&gt;
      &lt;key&gt;WebPluginTypeDescription&lt;/key&gt;
      &lt;string&gt;Simple WebKit Plug-In Data&lt;/string&gt;
    &lt;/dict&gt;
  &lt;/dict&gt;




8. Create the plug-in class.
Make PluginWithJavaScript a subclass of NSView and then add the allocation and
factory methods to the new PluginWithJavaScript class.  Here is the adjusted
interface declaration for the PluginWithJavaScript class:

  @interface PluginWithJavaScript : SpeedometerView &lt;WebPlugInViewFactory&gt; {
    NSDictionary *pluginArguments;
    NSString *title;
    NSNumber *counter;
  }
  
    /* WebPlugInViewFactory message handler for vending plug-in instances */
  + (NSView *)plugInViewWithArguments:(NSDictionary *)arguments;
  
    /* storage management message handlers */
  -(id) initWithArguments:(NSDictionary *)arguments;
  - (void) dealloc;
  
    /* accessors for pluginArguments */
  - (NSDictionary *)pluginArguments;
  - (void)setPluginArguments:(NSDictionary *)value;
  
  - (NSString *)title;
  - (void)setTitle:(NSString *)value;
  
  - (NSNumber *)counter;
  - (void)setCounter:(NSNumber *)value;
  
  
  @end
  
Items to note are:
- PluginWithJavaScript is a subclass of NSView.  You can make your special
plug-in class a subclass of any SubClass of NSView.  
- In the declaration of WebPlugInViewFactory, we have explicitly called out
that PluginWithSimpleGUI conforms to the WebPlugInViewFactory protocol.  This
will give us an extra level of compiler error checking to make sure we have
implemented the requirements of that protocol correctly. 
- The method -plugInViewWithArguments: is a class method required by the
WebPlugInViewFactory formal protocol for all WebKit plug-ins.
- We have added an instance variable 'pluginArguments' where we can save away a
copy of the arguments we receive when our -plugInViewWithArguments: method is
called.




9. Add code for calling JavaScript from the plug-in.

In this sample we install a key-value observer on three of the properties
maintained by our superclass, the SpeedometerView.  What this means is that
whenever one of the setter methods for one of those properties is called, our
observer method will be called to let us know that the value is changing and
what the new value will be.   We use this opportunity to send notifications
about the changing values to the JavaScript in the html page containing the
WebKit plug-in.  

  
In our -initWithArguments: method, we set ourself as the key value observer for
the keys @&quot;speed&quot;, @&quot;curvature&quot;, @&quot;ticks&quot;, and KVC accessors are defined for
those keys on our SpeedometerView superclass.  Inside of the observer, we
intercept calls to the accessors and call through to the JavaScript in the
containing page to provide notifications about the changing values.
  
The names of the JavaScript functions called is based on the name of the key. 
For the keys @&quot;speed&quot;, @&quot;curvature&quot;, and @&quot;ticks&quot; we call JavaScript methods
named @&quot;speedValueChangedTo&quot;, @&quot;curvatureValueChangedTo&quot;, and
@&quot;ticksValueChangedTo&quot;.

The file test.html includes definitions for these methods so you can try them
out directly.  The most visible one is the speed value.  It will change as you
drag the speedometer pointer around.  





10. Add code for calling our plug-in from JavaScript in the containing page.
Essentially, there are three parts involved in allowing JavaScripts in the
containing page call through to your plug-in.  These are discussed in the
following three sections.



(a) Identify the object that contains the methods and properties (instance
variables) being made available to JavaScript.
In this sample, we use the plug-in object itself, but you can use another
defined in a separate file if that would be a more convenient way to factor your
code.  To identify the object implementing the following method in our plug-in's
class:


- (id)objectForWebScript {
    return self;
}

This identifies the plug-in object as the object implementing all of the
methods and properties that will be shared with JavaScript in the containing
page.



(b) Identify the methods that will be shared with JavaScript.  
We do this by providing a method that participates in a filtering mechanism
where WebKit calls our +isSelectorExcludedFromWebScript: class method with the
selectors it considers eligible (methods implemented in our plug-in subclass)
for calling from JavaScript and our method should return a YES/NO result
indicating our preference.  In this sample we have implemented some methods for
getting and setting the speed, curvature, ant ticks values by simply calling
through to the accessors in the superclass.

The comments above the definition of +webScriptNameForSelector: in the WebKit
header file WebScriptObject.h describe the default name translations that occur
when the selectors for Objective-C method names are converted into method names
that can be used from JavaScript.  But, if you would like to provide your own
special name conversions you can do so by implementing
+webScriptNameForSelector: class method.  In this sample, we implement this
method to provide translations for method names such as 'setCurrentCurvature:'
to 'SetCurvature', and so forth.

Once a method has been made available to JavaScript, the JavaScripts on the
containing page will be able to call it as if it were a JavaScript method
defined on the plug-in object in the page.  For example, if our plug-in object
were stored in the variable jsPlugin, we could call the SetCurvature method as
follows:

   jsPlugin.SetCurvature(22);



(c) Identify the instance variables that will be shared with JavaScript.
Here, again, we notify WebKit about what instance variables should be shared
with JavaScript by providing methods that participate in a filtering mechanism. 
WebKit will call our +isKeyExcludedFromWebScript: for every instance variable it
considers eligible for sharing with JavaScript (provided in our plug-in
subclass), and our class method should return a YES/NO result indicating our
preference.

As with method names, you can provide your own name translation for property
values by implementing a +webScriptNameForKey: method.  In this sample, we have
implemtned one name translation so that the 'counter' instance variable is made
available in JavaScript using the name 'total'

Once a property has been made available to JavaScript, the JavaScripts on the
containing page will be able to access the property as if it were a JavaScript
property defined on the plug-in object in the page.  For example, if our plug-in
object were stored in the variable jsPlugin, we could access the the total
property as follows:

   jsPlugin.total = 22;

NOTE:  only instance variables defined in your subclass can be made available
in this way.  Instance variabled defined in superclasses are not eligible for
sharing with JavaScript in this way.





11. Follow the steps in Technical Q&amp;A QA1500, &quot;Debugging a WebKit Plug-in in
Xcode&quot; (http://developer.apple.com/qa/qa2006/qa1500.html) to set up your plug-in
project for debugging with Xcode.





12. Build and run the sample.
If you have followed the steps in QA1500, then when you click 'Build and Run'
in Xcode, a new copy of Safari will be launched with the plug-in loaded.  A test
heml page for the plug-in named test.html has been included in the project
directory.  You can try out the plug-in by dragging and dropping test.html into
window displayed by the copy of Safari that was launched as a result of the
'Build and Run' command.





Additional Information


Resources

This sample didn't call for it, but if for some reason your custom plug-in
would like to obtain a reference to its bundle so it can access, say, the
Resources folder inside of its bundle, then you could use the following code to
do that:

    /* get a reference to your bundle */
  NSBundle *plugInBundle = [NSBundle bundleForClass:[self class]];



Install Locations

Internet Plug-ins can be installed in the following locations:

To make the plug-in available to the current user only, install it here:

  ~/Library/Internet Plug-Ins/

To make the plug-in available to all users, install it here:

  /Library/Internet Plug-Ins/











</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/WebKitPluginWithJavaScript/listing3.html%3Fid%3DDTS10004348-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/WebKitPluginWithJavaScript/listing3.html%3Fid%3DDTS10004348-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/WebKitPluginWithJavaScript/listing3.html%3Fid%3DDTS10004348-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>