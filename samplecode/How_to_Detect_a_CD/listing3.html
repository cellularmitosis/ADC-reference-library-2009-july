<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>How to Detect a CD - /Not used in this example/Determine Devices using SCSI/cscsi.cp</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">How to Detect a CD</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">How to Detect a CD</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Not used in this example/Determine Devices using SCSI/cscsi.cp</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/main.c</option>
<option value="listing2.html">/Not used in this example/CheckEjectability.c</option>
<option value="listing3.html">/Not used in this example/Determine Devices using SCSI/cscsi.cp</option>
<option value="listing4.html">/Not used in this example/Determine Devices using SCSI/cscsi.h</option>
<option value="listing5.html">/Not used in this example/Determine Devices using SCSI/main.cp</option>
<option value="listing6.html">/Not used in this example/GetDriveType.c</option>
<option value="listing7.html">/Not used in this example/GetDriveType.h</option>
<option value="listing8.html">/Not used in this example/identifyCD.c</option>
<option value="listing9.html">/Not used in this example/identifyCD.h</option>
<option value="listing10.html">/Not used in this example/IsDriverOpen.c</option>
<option value="listing11.html">/Not used in this example/IsDriverOpen.h</option>
<option value="listing12.html">/WhereCDs.c</option>
<option value="listing13.html">/WhereCDs.h</option></select>
				</p>
				</form>
				<p><strong><a href="How_to_Detect_a_CD.zip">Download Sample</a></strong> (&#147;How_to_Detect_a_CD.zip&#148;, 14.5K)<BR>
<strong><a href="How_to_Detect_a_CD.dmg">Download Sample</a></strong> (&#147;How_to_Detect_a_CD.dmg&#148;, 70.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">#include    &quot;CSCSI.h&quot;CSCSIOp::CSCSIOp( void ){  haveInfo = 0;  timeout = 60L;}CSCSIOp::~CSCSIOp( void ){}void  CSCSIOp::keep( short what ){  haveInfo = what;}void  CSCSIOp::setID( short ID ){  targetID = ID;  haveInfo |= USE_ID;}void  CSCSIOp::setCDB( short len, Byte * cdbPtr ){  short  i;  cdbLen = len;  for ( i = 0; i &lt; len; i++ )      cdb[i] = *cdbPtr++;  haveInfo |= USE_CDB;}void  CSCSIOp::set6( Byte a, Byte b, Byte c, Byte d, Byte e, Byte f ){  cdbLen = 6;  cdb[0] = a; cdb[1] = b; cdb[2] = c; cdb[3] = d; cdb[4] = e; cdb[5] = f;  haveInfo |= USE_CDB;}void  CSCSIOp::set10( Byte a, Byte b, Byte c, Byte d, Byte e, Byte f,                Byte g, Byte h, Byte i, Byte j ){  cdbLen = 10;  cdb[0] = a; cdb[1] = b; cdb[2] = c; cdb[3] = d; cdb[4] = e; cdb[5] = f;  cdb[6] = g; cdb[7] = h; cdb[8] = i; cdb[9] = j;  haveInfo |= USE_CDB;}void  CSCSIOp::set12( Byte a, Byte b, Byte c, Byte d, Byte e, Byte f,                Byte g, Byte h, Byte i, Byte j, Byte k, Byte l ){  cdbLen = 12;  cdb[0] = a; cdb[1] = b; cdb[2] = c; cdb[3] = d; cdb[4] = e; cdb[5] = f;  cdb[6] = g; cdb[7] = h; cdb[8] = i; cdb[9] = j; cdb[10] = k; cdb[11] = l;  haveInfo |= USE_CDB;}void  CSCSIOp::setLen( long len ){  dataLen = len;  haveInfo |= USE_LEN;}void  CSCSIOp::setBuf( void * buf ){  dataPtr = (Byte *)buf;  haveInfo |= USE_BUF;}void  CSCSIOp::setDir( XferDir direction ){  dir = direction;  haveInfo |= USE_DIR;}short  CSCSIOp::execute( void ){  SCSIInstr  xfer[3];  short    info = haveInfo;    haveInfo = 0;    if ( info &amp; USE_DIR )  {    if ( dir == noData )    {      if ( (info &amp; CAN_NO_DATA) != CAN_NO_DATA )      {          return err = SCSI_NEED_INFO;      }    }    else if ( (info &amp; CAN_DATA) != CAN_DATA )    {      return err = SCSI_NEED_INFO;    }  }  else      return err = SCSI_NEED_INFO;        if ( dir != noData )  {    //    // SCSIManager seems to update scParam1 on scInc only if the scInc did    // not fail.  Thus, if we need to know the exact data count, we need    // to use a loop, doing on scInc for each byte.    //    // If the dataLen is not a multiple of 0x200, we assume the user needs    // to know the exact amount, and so we loop.  If the dataLen is a multiple    // of 0x200, we assume it is a read or write to a blocked device, and the    // user wants efficiency more than an exact byte count.    //    if ( dataLen &amp; 0x1ff )    {      xfer[0].scOpcode = scInc;      xfer[0].scParam1 = (unsigned long)dataPtr;      xfer[0].scParam2 = 1;      xfer[1].scOpcode = scLoop;      xfer[1].scParam1 = -10;      xfer[1].scParam2 = dataLen;      xfer[2].scOpcode = scStop;    }    else    {      xfer[0].scOpcode = scInc;      xfer[0].scParam1 = (unsigned long)dataPtr;      xfer[0].scParam2 = dataLen;      xfer[1].scOpcode = scStop;    }  }    moved = 0;    err = SCSIGet();  if ( err )    return err;        err = SCSISelect( targetID );  if ( err )    return err;        err = SCSICmd( (Ptr)cdb, cdbLen );  if ( err )  {    SCSIComplete( &amp;status, &amp;message, 60L );    return err;  }    if ( dir == dataIn )    err = SCSIRead( (Ptr)xfer );  else if ( dir == dataOut )    err = SCSIWrite( (Ptr)xfer );        moved = xfer[0].scParam1 - (unsigned long)dataPtr;    if ( err &amp;&amp; err != scPhaseErr )  {    SCSIComplete( &amp;status, &amp;message, 60L );    return err;  }    err = SCSIComplete( &amp;status, &amp;message, timeout );    return err;}short  CSCSIOp::getStatus( void ){  return status;}short  CSCSIOp::getMessage( void ){  return message;}void  CSCSIOp::setTimeout( long newTime ){  timeout = newTime;}OSErr  CSCSIOp::getErr( void ){  return err;}long  CSCSIOp::getMoved( void ){  return moved;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/How_to_Detect_a_CD/listing3.html%3Fid%3DDTS10000012-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/How_to_Detect_a_CD/listing3.html%3Fid%3DDTS10000012-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/How_to_Detect_a_CD/listing3.html%3Fid%3DDTS10000012-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>