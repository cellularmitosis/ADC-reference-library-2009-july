<html><head><title>Mac OS X Developer Tools
 Manual Page For SSL_has_matching_session_id(3ssl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3ssl/SSL_has_matching_session_id" title="Mac OS X Developer Tools
 Manual Page for SSL_has_matching_session_id(3ssl)"><a name="//apple_ref/doc/man/3/SSL_has_matching_session_id" title="Mac OS X Developer Tools
 Manual Page for SSL_has_matching_session_id(3ssl)"><!-- headerDoc=man; indexgroup=Section 3ssl; uid="//apple_ref/doc/man/3ssl/SSL_has_matching_session_id"; name=SSL_has_matching_session_id(3ssl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
SSL_CTX_set_generate_session_id(3)                 OpenSSL                <a href="SSL_CTX_set_generate_session_id.3ssl.html#//apple_ref/doc/man/3/SSL_CTX_set_generate_session_id">SSL_CTX_set_generate_session_id(3)</a>



<b>NAME</b>
       SSL_CTX_set_generate_session_id, SSL_set_generate_session_id, SSL_has_matching_session_id -<font color="#ffffff" class="whiteout">manipulate&nbsp;SSL_has_matching_session_idmanipulate</font>
       manipulate generation of SSL session IDs (server only)

<b>SYNOPSIS</b>
        #include &lt;openssl/ssl.h&gt;

        typedef int (*GEN_SESSION_CB)(const SSL *ssl, unsigned char *id,
                                      unsigned int *id_len);

        int SSL_CTX_set_generate_session_id(SSL_CTX *ctx, GEN_SESSION_CB cb);
        int SSL_set_generate_session_id(SSL *ssl, GEN_SESSION_CB, cb);
        int SSL_has_matching_session_id(const SSL *ssl, const unsigned char *id,
                                        unsigned int id_len);

<b>DESCRIPTION</b>
       <u>SSL</u><b>_</b><u>CTX</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u> sets the callback function for generating new session ids for
       SSL/TLS sessions for <b>ctx</b> to be <b>cb</b>.

       <u>SSL</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u> sets the callback function for generating new session ids for SSL/TLS
       sessions for <b>ssl</b> to be <b>cb</b>.

       <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> checks, whether a session with id <b>id</b> (of length <b>id_len</b>) is already
       contained in the internal session cache of the parent context of <b>ssl</b>.

<b>NOTES</b>
       When a new session is established between client and server, the server generates a session id. The
       session id is an arbitrary sequence of bytes.  The length of the session id is 16 bytes for SSLv2
       sessions and between 1 and 32 bytes for SSLv3/TLSv1. The session id is not security critical but must
       be unique for the server. Additionally, the session id is transmitted in the clear when reusing the
       session so it must not contain sensitive information.

       Without a callback being set, an OpenSSL server will generate a unique session id from pseudo random
       numbers of the maximum possible length.  Using the callback function, the session id can be changed
       to contain additional information like e.g. a host id in order to improve load balancing or external
       caching techniques.

       The callback function receives a pointer to the memory location to put <b>id</b> into and a pointer to the
       maximum allowed length <b>id_len</b>. The buffer at location <b>id</b> is only guaranteed to have the size <b>id_len</b>.
       The callback is only allowed to generate a shorter id and reduce <b>id_len</b>; the callback <b>must</b> <b>never</b>
       increase <b>id_len</b> or write to the location <b>id</b> exceeding the given limit.

       If a SSLv2 session id is generated and <b>id_len</b> is reduced, it will be restored after the callback has
       finished and the session id will be padded with 0x00. It is not recommended to change the <b>id_len</b> for
       SSLv2 sessions.  The callback can use the <a href="SSL_get_version.3ssl.html#//apple_ref/doc/man/3/SSL_get_version"><u>SSL</u><b>_</b><u>get</u><b>_</b><u>version</u>(3)</a> function to check, whether the session
       is of type SSLv2.

       The location <b>id</b> is filled with 0x00 before the callback is called, so the callback may only fill part
       of the possible length and leave <b>id_len</b> untouched while maintaining reproducibility.

       Since the sessions must be distinguished, session ids must be unique.  Without the callback a random
       number is used, so that the probability of generating the same session id is extremely small (2^128
       possible ids for an SSLv2 session, 2^256 for SSLv3/TLSv1). In order to assure the uniqueness of the
       generated session id, the callback must call <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> and generate another id if
       a conflict occurs.  If an id conflict is not resolved, the handshake will fail.  If the application
       codes e.g. a unique host id, a unique process number, and a unique sequence number into the session
       id, uniqueness could easily be achieved without randomness added (it should however be taken care
       that no confidential information is leaked this way). If the application can not guarantee
       uniqueness, it is recommended to use the maximum <b>id_len</b> and fill in the bytes not used to code
       special information with random data to avoid collisions.

       <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> will only query the internal session cache, not the external one. Since
       the session id is generated before the handshake is completed, it is not immediately added to the
       cache. If another thread is using the same internal session cache, a race condition can occur in that
       another thread generates the same session id.  Collisions can also occur when using an external
       session cache, since the external cache is not tested with <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> and the same
       race condition applies.

       When calling <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> for an SSLv2 session with reduced <b>id_len</b>, the match
       operation will be performed using the fixed length required and with a 0x00 padded id.

       The callback must return 0 if it cannot generate a session id for whatever reason and return 1 on
       success.

<b>EXAMPLES</b>
       The callback function listed will generate a session id with the server id given, and will fill the
       rest with pseudo random bytes:

        const char session_id_prefix = "www-18";

        #define MAX_SESSION_ID_ATTEMPTS 10
        static int generate_session_id(const SSL *ssl, unsigned char *id,
                                     unsigned int *id_len)
             {
             unsigned int count = 0;
             const char *version;

             version = SSL_get_version(ssl);
             if (!strcmp(version, "SSLv2"))
                 /* we must not change id_len */;

             do      {
                     RAND_pseudo_bytes(id, *id_len);
                     /* Prefix the session_id with the required prefix. NB: If our
                      * prefix is too long, clip it - but there will be worse effects
                      * anyway, eg. the server could only possibly create 1 session
                      * ID (ie. the prefix!) so all future session negotiations will
                      * fail due to conflicts. */
                     memcpy(id, session_id_prefix,
                             (strlen(session_id_prefix) &lt; *id_len) ?
                             strlen(session_id_prefix) : *id_len);
                     }
             while(SSL_has_matching_session_id(ssl, id, *id_len) &amp;&amp;
                     (++count &lt; MAX_SESSION_ID_ATTEMPTS));
             if(count &gt;= MAX_SESSION_ID_ATTEMPTS)
                     return 0;
             return 1;
             }

<b>RETURN</b> <b>VALUES</b>
       <u>SSL</u><b>_</b><u>CTX</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u> and <u>SSL</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u> always return 1.

       <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u> returns 1 if another session with the same id is already in the cache.

<b>SEE</b> <b>ALSO</b>
       <a href="ssl.3ssl.html#//apple_ref/doc/man/3/ssl"><u>ssl</u>(3)</a>, <a href="SSL_get_version.3ssl.html#//apple_ref/doc/man/3/SSL_get_version"><u>SSL</u><b>_</b><u>get</u><b>_</b><u>version</u>(3)</a>

<b>HISTORY</b>
       <u>SSL</u><b>_</b><u>CTX</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u>, <u>SSL</u><b>_</b><u>set</u><b>_</b><u>generate</u><b>_</b><u>session</u><b>_</b><u>id()</u> and <u>SSL</u><b>_</b><u>has</u><b>_</b><u>matching</u><b>_</b><u>session</u><b>_</b><u>id()</u>
       have been introduced in OpenSSL 0.9.7.



0.9.7l                                           2001-02-23               <a href="SSL_CTX_set_generate_session_id.3ssl.html#//apple_ref/doc/man/3/SSL_CTX_set_generate_session_id">SSL_CTX_set_generate_session_id(3)</a>
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/SSL_has_matching_session_id.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/SSL_has_matching_session_id.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/SSL_has_matching_session_id.3ssl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
