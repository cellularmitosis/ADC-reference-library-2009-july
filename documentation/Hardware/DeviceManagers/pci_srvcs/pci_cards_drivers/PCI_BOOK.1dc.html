<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> SetGamma (csCode = 4)13</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.1d7.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1db.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1dd.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="RoH.RoutineHeading"><A NAME="pgfId=3339"> </A>SetGamma (csCode = 4)</H1><P CLASS="T1.Text1"><A NAME="pgfId=3340"> </A>The optional <TT CLASS="cv">SetGamma</TT> control routine sets the gamma table in the driver that corrects RGB color values.</P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=15480"> </A>OSErr = Control(theDeviceRefNum, cscSetGamma, &amp;theVDGammaRecord );</CODE><DL COMPACT><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=15482"> </A><TT CLASS="cv">--&gt; csGTable</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=4420"> </A><EM CLASS="BodyText">Pointer to gamma table</EM></DD></DL COMPACT><P CLASS="T1.Text1"><A NAME="pgfId=3342"> </A>The gamma table compensates for nonlinearities in a display's color response by providing either a function or a lookup value that associates each displayed color with an absolute RGB value.</P><P CLASS="T1.Text1"><A NAME="pgfId=3343"> </A>To reduce visible flashes resulting from color table changes, the <TT CLASS="cv">SetGamma</TT> routine works in conjunction with the <TT CLASS="cv">SetEntries</TT> control routine on indexed devices. The <TT CLASS="cv">SetGamma</TT> routine first loads new gamma correction data into the driver's private storage; the next <TT CLASS="cv">SetEntries</TT> control call applies the gamma correction as it changes the CLUT. <TT CLASS="cv">SetGamma</TT> calls are always followed by <TT CLASS="cv">SetEntries</TT> control calls on indexed devices.</P><P CLASS="T1.Text1"><A NAME="pgfId=3344"> </A>For direct devices, the <TT CLASS="cv">SetGamma</TT> routine first sets up the gamma correction data table. Next, it synthesizes a black-to-white linear ramp color table. Finally, it applies the new gamma correction to the color table and sets the data directly in the hardware. Proper correction is particularly important to image-processing applications running on direct devices.</P><P CLASS="T1.Text1"><A NAME="pgfId=3345"> </A>Displays that do not use gamma table correction tend to look oversaturated and dark. Although determining the correct values for a gamma table can be difficult without special tools, the table's contribution to image quality can be striking.</P><P CLASS="T1.Text1"><A NAME="pgfId=3346"> </A>If <TT CLASS="cv">NIL</TT> is passed for the <TT CLASS="cv">csGTable</TT> value, the driver should build a linear ramp in the gamma table to allow for an uncorrected display. </P><P CLASS="T1.Text1"><A NAME="pgfId=3347"> </A>On a cathode ray tube, phosphors luminesce when they are struck by an electron beam. Unfortunately, there is not a direct correspondence between the luminance of the phosphors and the strength of the electron beam. To create a linear relationship, the actual response is measured and the inverse of its deviation from linearity is applied as a correction factor. <A HREF="PCI_BOOK.1dc.html#22480" CLASS="XRef">Figure&nbsp;13-1</A> illustrates this process.</P><P CLASS="Fg.Figure"><B><A NAME="pgfId=3355"> </A>Figure&nbsp;13-1	<A NAME="22480"> </A>Luminosity and electron beam strength</B></P><DIV><IMG SRC="PCI_BOOK-30.gif"></DIV><P CLASS="T1.Text1"><A NAME="pgfId=3356"> </A>Although this example is described in terms of electron beams and phosphors of a cathode ray tube, similar relationships exist between diode current and LED brightness in active matrix displays.</P><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.1d7.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1db.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1dd.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>