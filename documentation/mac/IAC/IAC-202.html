<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Writing an Idle Function(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING202></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-201.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-203.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-195.html"><B>Chapter 5 - Creating and Sending Apple Events</B></A> / <A HREF="IAC-200.html"><B>Sending an Apple Event</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING202-0></A>
<H2><A NAME=MARKER-9-123></A><A NAME=MARKER-21-124></A>Writing an Idle Function</H2>
 <A NAME=MARKER-2-370></A><A NAME=MARKER-2-259></A>This section describes how to write an idle function for use with the <CODE>AESend</CODE> or <CODE>AEInteractWithUser</CODE> function.<P>
 When your application sends an Apple event, you can set one of three flags in the <CODE>sendMode</CODE> parameter to <CODE>AESend</CODE> that specify how you want to deal with the reply: <CODE>kAENoReply</CODE> if you don't want your application to receive a reply, <CODE>kAEQueueReply</CODE> if you want it to receive the reply in its event queue, or <CODE>kAEWaitReply</CODE> if you want the reply returned in the <CODE>reply</CODE> parameter of <CODE>AESend</CODE> and you are willing to give up the processor while your application is waiting for the reply.<P>
 If you specify <CODE>kAENoReply</CODE> or <CODE>kAEQueueReply</CODE>, the <CODE>AESend</CODE> function returns immediately after using the Event Manager to send the event. If you specify <CODE>kAEWaitReply</CODE>, the <CODE>AESend</CODE> function does not return until either the server application finishes handling the Apple event or a specified amount of time expires. In this case the <CODE>AESend</CODE> function calls <CODE>WaitNextEvent</CODE> on behalf of your application. This yields the processor to other processes, so that the server has an opportunity to receive and process the Apple event sent by your application. While your application is waiting for a reply, it cannot receive events unless it provides an idle function.<P>
 If you provide a pointer to an idle function as a parameter to the <CODE>AESend</CODE> function, <CODE>AESend</CODE> calls your idle function whenever an update event, null event, operating-system event, or activate event is received for your application. To allow your application to process high-level events that it receives while waiting for a reply, provide a reply filter function. See the next section, <A HREF=IAC-203.html#MARKER-9-130>"Writing a Reply Filter Function,"</A> for more information.<P>
 Your application can yield the processor in a similar manner when it calls the <CODE>AEInteractWithUser</CODE> function. If <CODE>AEInteractWithUser</CODE> needs to post a notification request to bring your application to the front, your application yields the processor until the user brings your application to the front. To receive events while waiting for the user to bring your application to the front, you must provide an idle function.<P>
 If you provide a pointer to an idle function as a parameter to the <CODE>AEInteractWithUser</CODE> function, <CODE>AEInteractWithUser</CODE> calls your idle function whenever an update event, null event, operating-system event, or activate event is received for your application.<P>
 An idle function must use this syntax:<P>
<PRE>
FUNCTION MyIdleFunction (VAR event: EventRecord;
                         VAR sleepTime: LongInt;
                         VAR mouseRgn: RgnHandle): Boolean;
</PRE>
 The <CODE>event</CODE> parameter is the event record of the event to process. The <CODE>sleepTime</CODE> parameter and <CODE>mouseRgn</CODE> parameter are values that your idle function sets the first time it is called; thereafter they contain the values your function set. Your idle function should return a Boolean value that indicates whether your application wishes to continue waiting. Set the function result to <CODE>TRUE</CODE> if your application is no longer willing to wait for a reply from the server or for the user to bring the application to the front. Set the function result to <CODE>FALSE</CODE> if your application is still willing to wait.<P>
 You use the <CODE>sleepTime</CODE> and <CODE>mouseRgn</CODE> parameters in the same way as the <CODE>sleep</CODE> and <CODE>mouseRgn</CODE> parameters of the <CODE>WaitNextEvent</CODE> function. Specify in the <CODE>sleepTime</CODE> parameter the amount of time (in ticks) during which your application agrees to relinquish the processor if no events are pending for it. <P>
 In the <CODE>mouseRgn</CODE> parameter, you specify a screen region that determines the conditions under which your application is to receive notice of mouse-moved events. Your idle function receives mouse-moved events only if your application is the front application and the cursor strays outside the region you specify.<P>
 Your idle function receives only update events, null events, operating-system events, and activate events. When your idle function receives a null event, it can use the idle time to update a status dialog box, animate cursors, or perform similar tasks. If your idle function receives any of the other events, it should handle the event as it normally would if received in its event loop.<P>
 <A HREF=#MARKER-9-127>Listing 5-5</A> shows an example of an idle function for use with <CODE>AESend</CODE> or <CODE>AEInteractWithUser</CODE>. The idle function processes update events, null events, operating-system events, and activate events. The first time the function is called it receives a null event. At this time, it sets the <CODE>sleepTime</CODE> and <CODE>mouseRgn</CODE> parameters. The function continues to process events until the server finishes handling the Apple event or the user brings the application to the front.<P>
 Your application should implement a method of checking whether the user wants to cancel. The <CODE>MyCancelInQueue</CODE> function in <A HREF=#MARKER-9-127>Listing 5-5</A> checks the event queue for any instances of Command-period and immediately returns <CODE>TRUE</CODE> as its function result if it finds a request to cancel in the event queue.<P>
<B>Listing 5-5  <A NAME=MARKER-9-127></A><A NAME=MARKER-21-128></A>An idle function<A NAME=MARKER-2-129></A></B><P>
<PRE>
FUNCTION MyIdleFunction (VAR event: EventRecord;
                         VAR sleeptime: LongInt;
                         VAR mouseRgn: RgnHandle): Boolean;
BEGIN
   MyIdleFunction := FALSE;
   {the MyCancelInQueue function checks for Command-period}
   IF MyCancelInQueue THEN
      BEGIN                
         MyIdleFunction := TRUE;
         Exit(MyIdleFunction);
      END;
   CASE event.what OF
      updateEvt,
      activateEvt,   {every idle function should handle }
      osEvt:         { these kinds of events}
         BEGIN
            MyAdjustCursor(event.where, gCursorRgn);
            DoEvent(event);
         END;
      nullEvent:
         BEGIN
            {set the sleepTime and mouseRgn parameters}
            mouseRgn := gCursorRgn;
            sleeptime := 10;  {use the correct value for your }
                              { app}               
            DoIdle;           {the application's idle handling}
         END;
   END; {of CASE}
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-201.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-203.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
