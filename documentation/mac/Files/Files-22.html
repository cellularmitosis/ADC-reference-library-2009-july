<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating a New File (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING22></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-12.html"><B>Chapter 1 - Introduction to File Management</B></A> / <A HREF="Files-19.html"><B>Using Files</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING22-0></A>
<H2><A NAME=MARKER-2-58></A>Creating a New File</H2>
 The user expects to be able to create a new document using the New command in the File menu. <A HREF=#MARKER-9-132>Listing 1-4</A> illustrates one way to handle the New menu command.<A NAME=MARKER-2-128></A><A NAME=MARKER-2-53></A><A NAME=MARKER-2-130></A><A NAME=MARKER-2-131></A><P>
<B>Listing 1-4  <A NAME=MARKER-9-132></A>Handling the New menu command</B><P>
<PRE>
FUNCTION DoNewCmd: OSErr;
VAR
   myWindow:   WindowPtr;  {the new document window; ignored here}
BEGIN
   {Create a new window and make it visible.}
   DoNewCmd := DoNewDocWindow(TRUE, myWindow);
END;
</PRE>
 The <CODE>DoNewCmd</CODE> function simply calls the application-defined function <CODE>DoNewDocWindow</CODE> (shown in <A HREF=#MARKER-9-87>Listing 1-5</A>). The first parameter to <CODE>DoNewDocWindow</CODE> determines whether the new window should be visible or not; the value <CODE>TRUE</CODE> indicates that the new window should be visible. If <CODE>DoNewDocWindow</CODE> completes successfully, it returns a window pointer to the calling routine in the second parameter. The <CODE>DoNewCmd</CODE> function ignores that returned window pointer.<P>
<B>Listing 1-5  <A NAME=MARKER-9-87></A>Creating a new document window</B><P>
<PRE>
FUNCTION DoNewDocWindow (newDocument: Boolean; var myWindow: WindowPtr):
                                  OSErr;
VAR
   myData:     MyDocRecHnd;   {the window's data record}
CONST
   rDocWindow = 1000;         {resource ID of window template}
BEGIN
   {Allocate a new window; see Window Mgr chapter for details.}
   myWindow := GetNewWindow(rDocWindow, NIL, WindowPtr(-1));
   IF myWindow = NIL THEN
      BEGIN
         DoNewDocWindow := MemError;
         Exit(DoNewDocWindow);
      END;

   {Allocate space for the window's data record.}
   myData := MyDocRecHnd(NewHandle(SizeOf(MyDocRec)));
   IF myData = NIL THEN
      BEGIN
         DoNewDocWindow := MemError;
         DisposeWindow(myWindow);
         Exit(DoNewDocWindow);
      END;
      
   MoveHHi(Handle(myData));               {move the handle high}
   HLock(Handle(myData));                 {lock the handle}
   WITH myData^^ DO                       {fill in window data}
      BEGIN
         editRec := TENew(gDestRect, gViewRect);
         vScroll := GetNewControl(rVScroll, myWindow);
         hScroll := GetNewControl(rHScroll, myWindow);
         fileRefNum := 0;                 {no file yet!}
         windowDirty := FALSE;
         IF (editRec = NIL) OR (vScroll = NIL) OR (hScroll = NIL) THEN
            BEGIN
               DoNewDocWindow := memFullErr;
               DisposeWindow(myWindow);
               DisposeControl(vScroll);
               DisposeControl(hScroll);
               TEDispose(editRec);
               DisposeHandle(myData);
               Exit(DoNewDocWindow);
            END;
      END;

   IF newDocument THEN                    {if new document, show it}
      ShowWindow(myWindow);

   SetWRefCon(myWindow, LongInt(myData)); {link record to window}
   HUnlock(Handle(myData));               {unlock the handle}
   DoNewDocWindow := noErr;
END;
</PRE>
 Note that the <CODE>DoNewDocWindow</CODE> function does not actually create a new file. The reason for this is that it is usually better to wait until the user actually saves a new document before creating a file (mainly because the user might decide not to save the document). The <CODE>DoNewDocWindow</CODE> function creates a window, allocates a new document record, and fills out the fields of that record. However, it sets the <CODE>fileRefNum</CODE> field of the document record to 0 to indicate that no file is currently associated with this window.<A NAME=MARKER-2-134></A><A NAME=MARKER-9-371></A><A NAME=MARKER-2-71></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-21.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-23.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
