<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Custom Class Metahandlers</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=16525"> </A>Custom Class Metahandlers</H1><P CLASS="T1.Text1"><A NAME="pgfId=16530"> </A>Any plug-in class that you define must have a metahandler. The metahandler is the method that the system uses to associate user-supplied routines with the required methods that a class needs to implement.</P><P CLASS="T1.Text1"><A NAME="pgfId=16531"> </A>When you give a metahandler to QuickDraw&nbsp;3D, it is called multiple times to build method tables and then is thrown away. You are guaranteed that your metahandler will never be called again after a call that was passed a metahandler returns.</P><P CLASS="T1.Text1"><A NAME="pgfId=16532"> </A>Your metahandler should contain a switch on the <TT CLASS="cv">methodType</TT> passed to it and should return the corresponding method as a <TT CLASS="cv">TQ3XFunctionPointer</TT>. All return values from the metahandler are cast to this type.</P><P CLASS="T1.Text1"><A NAME="pgfId=16534"> </A><TT CLASS="cv">typedef void (*TQ3FunctionPointer)(void);</TT></P><P CLASS="I.Important"><A NAME="pgfId=16570"> </A>A metahandler must always return a value. If it is passed a <TT CLASS="cv">methodType</TT> that it does not understand, it must return <TT CLASS="cv">NULL</TT>. </P><P CLASS="T1.Text1"><A NAME="pgfId=16536"> </A>Generally a metahandler is implemented as one case statement. Certain types of classes, such as renderers, may have multiple levels of metahandlers.</P><DIV><H3 CLASS="RoH.RoutineHeading"><A NAME="pgfId=15105"> </A>TQ3MetaHandler</H3><P CLASS="T1.Text1"><A NAME="pgfId=15108"> </A><A NAME="marker=15106"> </A>You must define an object metahandler to specify methods for custom object types or custom element types.</P><CODE CLASS="Cv.Code"><A NAME="pgfId=21503"> </A>typedef unsigned long TQ3XMethodType;<BR></CODE><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=21507"> </A>typedef TQ3FunctionPointer (*TQ3MetaHandler) (<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TQ3MethodType&nbsp;&nbsp;&nbsp;&nbsp;methodType);<BR></CODE><DL COMPACT><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=21509"> </A><TT CLASS="cv">methodType</TT></DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=15110"> </A>A method type.</DD></DL COMPACT><DIV><H4 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=15111"> </A>DESCRIPTION</H4><P CLASS="T1.Text1"><A NAME="pgfId=15112"> </A>Your <TT CLASS="cv">TQ3MetaHandler</TT> function should return a function pointer (a value of type <TT CLASS="cv">TQ3FunctionPointer</TT>) to the custom method whose type is specified by the <TT CLASS="cv">methodType</TT> parameter. If you do not define a method of the specified type, your metahandler should return the value <TT CLASS="cv">NULL</TT>.</P><P CLASS="T1.Text1"><A NAME="pgfId=15113"> </A>In general, your metahandler should contain a <TT CLASS="cv">switch</TT> statement that branches on the <TT CLASS="cv">methodType</TT> parameter. QuickDraw&nbsp;3D calls your metahandler repeatedly to build a method table when you first pass it to a QuickDraw&nbsp;3D routine. Once QuickDraw&nbsp;3D has finished building the method table, your metahandler is never called again.</P><P CLASS="T1.Text1"><A NAME="pgfId=16559"> </A>When any one of your custom methods is called, you can be certain that your metahandler will not be called again.</P></DIV><DIV><H4 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=16618"> </A>EXAMPLE</H4><P CLASS="T1.Text1"><A NAME="pgfId=16657"> </A>This example of a metahandler is edited from the <TT CLASS="cv">NameAttribute</TT> sample on the QuickDraw&nbsp;3D SDK. It is essentially a big switch statement that maps a method type selector onto a function call for each implementation method. The default return value is <TT CLASS="cv">NULL</TT>, so if the metahandler is called with a method type that is not recognised it returns <TT CLASS="cv">NULL</TT>.  All of the values are cast to type <TT CLASS="cv">TQ3XFunctionPointer</TT>, even when they are not function pointers. For example, the return value for <TT CLASS="cv">kQ3XMethodTypeObjectClassVersion</TT> is a <TT CLASS="cv">long</TT> that has the version of the plug-in packed into it.</P><CODE CLASS="Cv.Code"><A NAME="pgfId=21520"> </A>TQ3XFunctionPointer NameAttribute_MetaHandler(<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3XMethodType&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;methodType)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;switch (methodType) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeObjectClassVersion:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer)Q3_OBJECT_CLASS_VERSION(<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;majorVersion, minorVersion);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeObjectTraverse:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NameAttribute_Traverse;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeObjectReadData:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NameAttribute_ReadData;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeElementCopyAdd:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeElementCopyGet:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeElementCopyDuplicate:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NameAttribute_CopyAdd;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeElementCopyReplace:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NameAttribute_CopyReplace;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case kQ3XMethodTypeElementDelete:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NameAttribute_Delete;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (TQ3XFunctionPointer) NULL;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>}<BR></CODE></DIV></DIV><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>