<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Quartz 2D Programming Guide: Text</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Text"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001066-CH213" title="Text"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../dq_intro/dq_intro.html#//apple_ref/doc/uid/TP30001066-CH201-TPXREF101">Quartz 2D Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_python/dq_python.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_revisions/dq_revisions.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001066-CH213-TPXREF101" title="Text"></a><h1>Text</h1><p>This chapter describes the basic text support provided by Quartz and shows how to use Quartz 2D text in your application. Quartz 2D provides a limited, low-level interface for drawing text encoded in the MacRoman text encoding and for drawing glyphs. (See <em><a href="../../../Reference/CGFont/index.html#//apple_ref/doc/uid/TP30000953" target="_top">CGFont Reference</a></em>.) If basic text support is all your application needs, then read this chapter. If you want to support user input of text, text editing, or you need precise control over text layout or access to font features, you may want to skip this chapter and instead read <em><!--a target="_top" -->Getting Started with Text and Fonts<!--/a--></em> and then investigate using one of the following:</p><ul class="ul"><li class="li"><p>Core Text, introduced in Mac OS X v10.5, is an advanced, low-level technology for laying out text and handling fonts that is designed for high performance and ease of use. Its layout engine is up to twice as fast as ATSUI (Apple Type Services Unicode Imaging). Like ATSUI, you can use Core Text to draw Unicode text directly to a graphics context. If possible, you should use Core Text.</p></li><li class="li"><p>ATSUI lays out and draw text. If your application needs to perform a task that’s not supported by Core Text, consider ATSUI. If your application runs in versions of Mac OS X earlier that v10.5, you’ll need to use ATSUI for layout service.</p></li><li class="li"><p>The text facilities provided through the Carbon and Cocoa frameworks. </p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-TPXREF103">How Quartz 2D Draws Text</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-TPXREF102">Controlling How Text Looks</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BBCHIIIF">Drawing Text</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-DontLinkElementID_44">Measuring Text Before Drawing</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BAJEBJHI">Copying Font Variations</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BAJGDAHE">PostScript Fonts</a>
				
			<br/>
			
        
			
			
				<a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-SW1">See Also</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001066-CH213-TPXREF103" title="How Quartz 2D Draws Text"></a><h2>How Quartz 2D Draws Text</h2><p>Quartz 2D uses fonts, which are sets of shapes that are associated with characters, to draw text. A character abstractly represents the concept of, for example, a lowercase “b”, the number “2”, or the arithmetic operation “+”. You do not ever see a character on a display device. What you see on a display device is a glyph, the path that serves as the visual representation of the character. One glyph can represent one character, such as a lowercase “b”; more than one character, such as the “ﬁ” ligature, which is a single glyph representing two characters; or a non printing character, such as the space character.</p><p>The mapping from a byte code (sometimes called a character code) to a specific character is specified by a text encoding. For example, you use the numeric byte code value 65 to specify an uppercase “A” from a font encoded using the ASCII text encoding.</p><p>When you want to print or display text, you generally refer to characters rather than glyphs. Quartz renders glyphs using font data provided by the Apple Type Services (ATS) framework.</p><p>You specify the location of text  in user space coordinates. The text matrix specifies the transform from text space to user space. The text position is stored in the <em>tx</em> and <em>ty</em> variables of the text matrix. When you first create a graphics context, it initializes the text matrix to the identity matrix, thus text space coordinates are initially the same as user space coordinates.</p><p>Quartz conceptually concatenates the text matrix with the current transformation matrix and other parameters from the graphics state to produce the final text rendering matrix, the matrix actually used to draw the text on the page. The text matrix does not include the font size, which is always expressed in text space.</p><p>When Quartz draws the text, it retrieves the relevant glyphs from the ATS font server and paints them using the current parameters in the graphics state, such as fill color (if the text is filled) and stroke color. After a drawing operation, the text position remains at the last point used to image the text.</p><a name="//apple_ref/doc/uid/TP30001066-CH213-TPXREF102" title="Controlling How Text Looks"></a><h2>Controlling How Text Looks</h2><p>Some of the settings in the graphics state that apply to painting paths also apply to text drawing. Stroke color and fill color are two such attributes. (See <span class="content_text"><a href="../dq_paths/dq_paths.html#//apple_ref/doc/uid/TP30001066-CH211-TPXREF101">“Paths”</a></span>) for other attributes and operations that affect text rendering.) </p><p>Several text drawing attributes apply only to text. You can set the values of these attributes using the Quartz functions  listed in <span class="content_text">Table 17-1</span>. Notice that the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> sets both the font and the font size. It also sets the text encoding. <span class="content_text"><a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BBCHIIIF">“Drawing Text”</a></span> discusses the difference between using <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> and <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code>.</p><a name="//apple_ref/doc/uid/TP30001066-CH213-BBCIIAAF" title="Table 17-1Text attributes and the functions that control them"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 17-1&nbsp;&nbsp;</strong>Text attributes and the functions that control them</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Attribute</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Function</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Specifies</p></th></tr><tr><td  scope="row"><p>Font</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code></p><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code></p></td><td ><p>Typeface.</p></td></tr><tr><td  scope="row"><p>Font size</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFontSize" target="_top">CGContextSetFontSize</a></code></p><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code></p></td><td ><p>Size in text space units.</p></td></tr><tr><td  scope="row"><p>Character spacing</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetCharacterSpacing" target="_top">CGContextSetCharacterSpacing</a></code></p></td><td ><p>The amount of extra space (in text space units) between character glyphs.</p></td></tr><tr><td  scope="row"><p>Text drawing mode</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetTextDrawingMode" target="_top">CGContextSetTextDrawingMode</a></code></p></td><td ><p>How Quartz renders the individual glyphs onscreen. See <span class="content_text"><a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BAJHGHFI">Table 17-2</a></span> for a list of text drawing modes.</p></td></tr><tr><td  scope="row"><p>Text matrix</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetTextMatrix" target="_top">CGContextSetTextMatrix</a></code></p></td><td ><p>The transform from text space to user space.</p></td></tr><tr><td  scope="row"><p>Text position</p></td><td ><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetTextPosition" target="_top">CGContextSetTextPosition</a></code></p></td><td ><p>The location at which text is drawn.</p></td></tr></table></div><p>The text matrix is a transform that operates similarly to the current transformation matrix (CTM), but only on text. You can apply transforms to the text matrix, using any of the affine transform functions to build as complex a transform as you’d like. When you draw the text, Quartz uses the text matrix you supply along with the CTM. When you draw anything other than text, Quartz uses the CTM and not the text matrix.</p><a name="//apple_ref/doc/uid/TP30001066-CH213-BAJHGHFI" title="Table 17-2Text drawing modes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 17-2&nbsp;&nbsp;</strong>Text drawing modes</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use this mode</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>When you want to . . .</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Example</p></th></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextFill" target="_top">kCGTextFill</a></code></p></td><td ><p>Perform a fill operation on the text.</p></td><td ><p><img src = "../Art/kcgtextfill.gif" alt = "Filled text" width="51" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextStroke" target="_top">kCGTextStroke</a></code></p></td><td ><p>Perform a stroke operation on the text.</p></td><td ><p><img src = "../Art/kcgtextstroke.gif" alt = "Stroked text." width="50" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextFillStroke" target="_top">kCGTextFillStroke</a></code></p></td><td ><p>Perform both fill and stroke operations on the text.</p></td><td ><p><img src = "../Art/kcgtextfillstroke.gif" alt = "Filled and stroked test." width="51" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextInvisible" target="_top">kCGTextInvisible</a></code></p></td><td ><p>Get text positions for the purpose of measuring text but not display the text. Note that the text position (<em>x</em>, <em>y</em>) is updated, as with all of the drawing modes.</p></td><td ><p><img src = "../Art/kcgtextinvisible.gif" alt = "Invisible text." width="50" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextFillClip" target="_top">kCGTextFillClip</a></code></p></td><td ><p>Perform a fill operation, then add the text to the clipping area.</p></td><td ><p><img src = "../Art/kcgtextfillclip.gif" alt = "Filled text added to the clipping area." width="55" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextStrokeClip" target="_top">kCGTextStrokeClip</a></code></p></td><td ><p>Perform a stroke operation, then add the text to the clipping area.</p></td><td ><p><img src = "../Art/kcgtextstrokeclip.gif" alt = "Stroked text, added to the clipping area" width="55" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextFillStrokeClip" target="_top">kCGTextFillStrokeClip</a></code></p></td><td ><p>Perform both fill and stroke operations, then add the text to the clipping area.</p></td><td ><p><img src = "../Art/kcgtextfillstrokeclip.gif" alt = "Filled and stroked text, aded to the clipping area" width="55" height="45"></p></td></tr><tr><td  scope="row"><p><code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/doc/c_ref/kCGTextClip" target="_top">kCGTextClip</a></code></p></td><td ><p>Add the text to the clipping area, but do not draw the text.</p></td><td ><p><img src = "../Art/kcgtextclip.gif" alt = "Test added to the clipping area, but not drawn" width="55" height="45"></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001066-CH213-BBCHIIIF" title="Drawing Text"></a><h2>Drawing Text</h2><p>When you use Quartz 2D to draw text, you need to perform these tasks:</p><ul class="ul"><li class="li"><p>Set the font and font size.</p></li><li class="li"><p>Set the text drawing mode.</p></li><li class="li"><p>Set other items as needed—stroke color, fill color, clipping area.</p></li><li class="li"><p>Set up a text matrix if you want to translate, rotate, or scale the text space.</p></li><li class="li"><p>Draw the text.</p></li></ul><p>Quartz 2D provides two ways to set the font and font size. You can call either the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> or the functions <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code> and <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFontSize" target="_top">CGContextSetFontSize</a></code>. If your requirements are simple, you’ll probably want to use <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code>. If your requirements are more complex, you can use the alternative functions, <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code> and <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFontSize" target="_top">CGContextSetFontSize</a></code>. But instead of using <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code> and <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFontSize" target="_top">CGContextSetFontSize</a></code>, you may instead want to use ATSUI or Cocoa to set the font and perform text drawing. That’s because Quartz has some limitations for drawing text. Here’s a closer look at the two Quartz 2D alternatives.</p><p>If setting the font to a MacRoman text encoding is sufficient for your application, use the <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> function. Then, when you are ready to draw the text, you call the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowTextAtPoint" target="_top">CGContextShowTextAtPoint</a></code>. The function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> takes as parameters a graphics context, the PostScript name of the font to set, the size of the font (in user space units), and a text encoding.</p><p>To set the font to a text encoding other than MacRoman, you can use the functions <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code> and <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFontSize" target="_top">CGContextSetFontSize</a></code>. You must supply a CGFont object to the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code>. You call the function <code><a href="../../../Reference/CGFont/Reference/reference.html#//apple_ref/c/func/CGFontCreateWithPlatformFont" target="_top">CGFontCreateWithPlatformFont</a></code> to obtain a CGFont object from an ATS font. When you are ready to draw the text, you use the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowGlyphsAtPoint" target="_top">CGContextShowGlyphsAtPoint</a></code> rather than <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowTextAtPoint" target="_top">CGContextShowTextAtPoint</a></code>. </p><p>The reason you cannot use <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowTextAtPoint" target="_top">CGContextShowTextAtPoint</a></code> when you use <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code> is that Quartz needs a text encoding to map the bytes in the text string to glyphs in the font. By default, the text encoding is <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/econst/kCGEncodingFontSpecific" target="_top">kCGEncodingFontSpecific</a></code>, so there's no guarantee of what you'll get when you call <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowTextAtPoint" target="_top">CGContextShowTextAtPoint</a></code>. Since there's no way to set the text encoding other than with a call to <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code> you cannot draw text using <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowTextAtPoint" target="_top">CGContextShowTextAtPoint</a></code> if you set the font with <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetFont" target="_top">CGContextSetFont</a></code>. If you set the font this way, you must also be prepared to use ATSUI, Cocoa, or your own code to map character strings to glyphs so that you can then call <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowGlyphsAtPoint" target="_top">CGContextShowGlyphsAtPoint</a></code>. It might be easier for you to simply use ATSUI or Cocoa to perform the text drawing, and not use any of the Quartz 2D functions.</p><p>Now that you understand some of the limitations of using Quartz to draw text, you can take a look some sample code that draws text when the font and font size are set using the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSelectFont" target="_top">CGContextSelectFont</a></code>. This function, although not recommended except for cases in which MacRoman encoding is sufficient, is fairly straightforward to use. <span class="content_text">Listing 17-1</span> shows a function—<code>MyDrawText</code>—that draws the text shown in <span class="content_text"><a href="dq_text.html#//apple_ref/doc/uid/TP30001066-CH213-BBCDEDGG">Figure 17-1</a></span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001066-CH213-BBCGDEAC" title="Listing 17-1Drawing text"></a><p class="codesample"><strong>Listing 17-1&nbsp;&nbsp;</strong>Drawing text</p><div class="codesample"><table><tr><td scope="row"><pre>void MyDrawText (CGContextRef myContext, CGRect contextRect) <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    float w, h;<span></span></pre></td></tr><tr><td scope="row"><pre>    w = contextRect.size.width;<span></span></pre></td></tr><tr><td scope="row"><pre>    h = contextRect.size.height;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGAffineTransform myTextTransform; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSelectFont (myContext, <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                    "Times-Bold",<span></span></pre></td></tr><tr><td scope="row"><pre>                     h/10,<span></span></pre></td></tr><tr><td scope="row"><pre>                     kCGEncodingMacRoman);<span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetCharacterSpacing (myContext, 10); <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetTextDrawingMode (myContext, kCGTextFillStroke); <span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBFillColor (myContext, 0, 1, 0, .5); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetRGBStrokeColor (myContext, 0, 0, 1, 1); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    myTextTransform =  CGAffineTransformMakeRotation  (MyRadians (45)); <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    CGContextSetTextMatrix (myContext, myTextTransform); <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    CGContextShowTextAtPoint (myContext, 40, 0, "Quartz 2D", 9); <span>// 10</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Takes as parameters a graphics context and a rectangle to draw to.</p></li><li class="li"><p>Declares storage for the affine transform. </p></li><li class="li"><p>Sets the font to Times Bold and the font size to the height of the page rectangle divided by 10. The font size is in text space units. In this example, the text is drawn to a resizable window. When the user resizes the window, the text resizes as well. The encoding is set to <code>kCGEncodingMacRoman</code>, but the only other choice is <code>kCGEncodingFontSpecific</code>.</p></li><li class="li"><p>Sets the character spacing to 10 text space units. You call this function only if you want to add the additional space to the advance between the origin of one glyph and the origin of the next glyph.</p></li><li class="li"><p>Sets the text drawing mode to fill and stroke. </p></li><li class="li"><p>Sets the fill color to green with an alpha value of .5 for a partially transparent fill. Note that this is not a text-specific attribute. The fill color applies to the graphics state.</p></li><li class="li"><p>Sets the stroke color to opaque blue. This is another attribute that is not text specific.</p></li><li class="li"><p>Creates an affine transform that performs a 45 degree rotation. The <code>MyRadians</code> routine is an application-defined convenience function for computing degrees from radians. You either need to supply your own routine to convert degrees to radians, or you need to substitute this call with a value that specifies radians. Otherwise, this code example will not compile.</p></li><li class="li"><p>Sets the text matrix to the transform created in the last step.</p></li><li class="li"><p>Draws the text, passing the x- and y-coordinates in text space to start the drawing (40, 0), an array of characters to draw, and a value that specifies the length of the text array. In this case, you pass a C-style string and the value <code>9</code> to specify the number of characters.</p></li></ol><br/><div><a name="//apple_ref/doc/uid/TP30001066-CH213-BBCDEDGG" title="Figure 17-1Text drawn using Quartz 2D functions"></a><p><strong>Figure 17-1&nbsp;&nbsp;</strong>Text drawn using Quartz 2D functions</p><img src = "../Art/draw_text.gif" alt = "Text drawn using Quartz 2D functions" width="401" height="324"></div><br/><a name="//apple_ref/doc/uid/TP30001066-CH213-DontLinkElementID_44" title="Measuring Text Before Drawing"></a><h2>Measuring Text Before Drawing</h2><p>If text measurements are important to your application, it is possible to calculate them using Quartz 2D functions. However, you might first consider using ATSUI, whose strength is in text layout and measurement. ATSUI has several functions that obtain text metrics. Not only can you obtain after-layout text metrics, but in the rare cases you need them, you can obtain before-layout text metrics. Unlike Quartz, for which you must perform the calculations yourself, ATSUI computes the measurements for you. For example, you can obtain the image bounding rectangle for text by calling the ATSUI function <code><a href="../../../../Carbon/Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/c/func/ATSUMeasureTextImage" target="_top">ATSUMeasureTextImage</a></code>.</p><p>If you decide that Quartz text suits your needs better than ATSUI (or Cocoa), you can follow these steps to measure the width of text before Quartz draws it:</p><ol class="ol"><li class="li"><p>Call the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextGetTextPosition" target="_top">CGContextGetTextPosition</a></code> to obtain the current text position.</p></li><li class="li"><p>Set the text drawing mode to <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/econst/kCGTextInvisible" target="_top">kCGTextInvisible</a></code> using the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextSetTextDrawingMode" target="_top">CGContextSetTextDrawingMode</a></code>.</p></li><li class="li"><p>Draw the text by calling the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextShowText" target="_top">CGContextShowText</a></code> to draw the text at the current text position.</p></li><li class="li"><p>Determine the final text position by calling the function <code><a href="../../../Reference/CGContext/Reference/reference.html#//apple_ref/c/func/CGContextGetTextPosition" target="_top">CGContextGetTextPosition</a></code>.</p></li><li class="li"><p>Subtract the starting position from the ending position to determine the width of the text.</p></li></ol><a name="//apple_ref/doc/uid/TP30001066-CH213-BAJEBJHI" title="Copying Font Variations"></a><h2>Copying Font Variations</h2><p>A <strong>font variation</strong> is a setting along a variation axis that allows your application to produce a range of typestyles algorithmically. Each variation axis has:</p><ul class="ul"><li class="li"><p>A name (such as <code>'wght'</code>) that indicates the typestyle that the axis represents, specified in the font variation axis dictionary using the key <code>kCGFontVariationAxisName</code>.</p></li><li class="li"><p>A set of maximum and minimum values for the axis, specified in the font variation axis dictionary using the keys <code>kCGFontVariationAxisMinValue</code> and <code>kCGFontVariationAxisMaxValue</code>.</p></li><li class="li"><p>The default value of the axis, specified in the font variation axis dictionary using the key <code>kCGFontVariationAxisDefaultValue</code>.</p></li></ul><p>The weight axis, for example, governs the possible values for the weight of the font—the minimum value produces the lightest appearance of that font, the maximum value the boldest. The default value is the position along the variation axis at which that font falls normally. Because the axis is created by the font designer, font variations can be optimized for their particular font. Not all fonts have variations.</p><p>Quartz provides three functions in Mac OS X v10.4 that let you work with font variations:</p><ul class="ul"><li class="li"><p><code><a href="../../../Reference/CGFont/Reference/reference.html#//apple_ref/c/func/CGFontCreateCopyWithVariations" target="_top">CGFontCreateCopyWithVariations</a></code>, which creates a copy of a font using a variation specification dictionary. The function returns a font created by applying the specified variation specification dictionary to the font you provide.</p></li><li class="li"><p><code><a href="../../../Reference/CGFont/Reference/reference.html#//apple_ref/c/func/CGFontCopyVariations" target="_top">CGFontCopyVariations</a></code>, which returns a dictionary that contains the font variations, or <code>NULL</code> if the font doesn’t support variations.</p></li><li class="li"><p><code><a href="../../../Reference/CGFont/Reference/reference.html#//apple_ref/c/func/CGFontCopyVariationAxes" target="_top">CGFontCopyVariationAxes</a></code>, which returns an array of variation axis dictionaries, or <code>NULL</code> if the font doesn’t support variations.</p></li></ul><a name="//apple_ref/doc/uid/TP30001066-CH213-BAJGDAHE" title="PostScript Fonts"></a><h2>PostScript Fonts</h2><p>Quartz provides several functions in Mac OS X v10.4 that support PostScript and allow you to:</p><ul class="ul"><li class="li"><p>Obtain the PostScript name of a font.</p></li><li class="li"><p>Determine whether or not you can create a subset of a font in Postscript format.</p></li><li class="li"><p>Create a subset of a font in PostScript format.</p></li><li class="li"><p>Create a PostScript encoding of a font.</p></li></ul><p>If you need to work with PostScript fonts, see <em><a href="../../../Reference/CGFont/index.html#//apple_ref/doc/uid/TP30000953" target="_top">CGFont Reference</a></em> for detailed information on the Quartz functions for PostScript.</p><a name="//apple_ref/doc/uid/TP30001066-CH213-SW1" title="See Also"></a><h2>See Also</h2><ul class="ul"><li class="li"><p><em><a href="../../../Reference/CGFont/index.html#//apple_ref/doc/uid/TP30000953" target="_top">CGFont Reference</a></em> provides a complete description of each of the Quartz text functions discussed in this chapter.</p></li><li class="li"><p><em><a href="../../../../Carbon/Conceptual/CoreText_Programming/index.html#//apple_ref/doc/uid/TP40005533" target="_top">Core Text Programming Guide</a></em> discusses the text programming interface added in Mac OS X v10.5 and shows how to use it.</p></li><li class="li"><p><em><a href="../../../../Carbon/Conceptual/ATSUI_Concepts/index.html#//apple_ref/doc/uid/TP30000984" target="_top">ATSUI Programming Guide</a></em> explains how to lay out, process, and draw Unicode text. </p></li><li class="li"><p><em><a href="../../../../Carbon/Reference/ATSUI_Reference/index.html#//apple_ref/doc/uid/TP30000309" target="_top">ATSUI Reference</a></em> describes the ATSUI application programming interface.</p></li><li class="li"><p><em><a href="../../../../Cocoa/Conceptual/TextArchitecture/index.html#//apple_ref/doc/uid/10000086i" target="_top">Text System Overview</a></em> provides a survey of the Cocoa text system.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../dq_python/dq_python.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../dq_revisions/dq_revisions.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_text/dq_text.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_text/dq_text.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_text/dq_text.html%3Fid%3DTP30001066-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>