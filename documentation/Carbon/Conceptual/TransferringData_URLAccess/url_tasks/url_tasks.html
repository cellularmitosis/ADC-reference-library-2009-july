<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Transferring Data With URL Access Manager (Legacy): Transferring Data With URL Access Manager</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Transferring Data With URL Access Manager"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001046-CH210" title="Transferring Data With URL Access Manager"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000494" target="_top">Carbon</a> &gt; <a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_4">Transferring Data With URL Access Manager (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <!-- Previous button --><span style="margin-left: 8px"><a href="../url_revisions/url_revisions.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
URL Access Manager is deprecated as of Mac OS X v10.4. You should use CFNetwork instead (as described in <em><a href="../../../../Networking/Conceptual/CFNetwork/index.html#//apple_ref/doc/uid/TP30001132" target="_top">CFNetwork Programming Guide</a></em>).</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_4" title="Transferring Data With URL Access Manager"></a><h1><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF101" title="Transferring Data With URL Access Manager"></a>Transferring Data With URL Access Manager</h1><div class="importantbox"><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_5" title="Important:"></a><p><strong>Important:</strong>&nbsp;URL Access Manager is deprecated as of Mac OS X v10.4. You should use CFNetwork instead (as described in <em><a href="../../../../Networking/Conceptual/CFNetwork/index.html#//apple_ref/doc/uid/TP30001132" target="_top">CFNetwork Programming Guide</a></em>).</p><p></p></div><p>This document describes how to use URL Access Manager to transfer data to and from a network resource specified with a uniform resource locator (URL). </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_6" title="Note"></a><p><strong>Note:</strong>&nbsp; Apple does not recommend that you directly incorporate the sample code in this document into your application. For example, only limited error handling is shown—you should develop your own techniques for detecting and handling errors. </p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_1">Overview</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFDDFCI">Setting and Determining URL Properties</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BAAJDIGA">Performing Simple Data Transfer</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BAAFBCBG">Naming Your Destination File</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF104">Controlling Data Transfer</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF108">Terminating Data Transfer Operations</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF105">Obtaining Data Transfer Information</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF106">Responding to Data Transfer Events</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF107">Responding to System Events During Data Transfer</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFGIAJH">Using URL Access Manager with AppleScript</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF102">Case Study: Downloading Data From a URL</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFHCBHF">Case Study: Downloading Data From Multiple URLs</a>
				
			<br/>
			
        
			
			
				<a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_2">See Also</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_1" title="Overview"></a><h2>Overview</h2><p>URL Access Manager includes support for:</p><ul class="ul"><li class="li"><p>Automatic decompression of compressed files</p></li><li class="li"><p>Automatic file extraction from Stuffit archives (with version 5.0 of Stuffit)</p></li><li class="li"><p>Firewalls, HTTP proxy servers, and SOCKS gateways</p></li></ul><p>URL Access Manager allows you to use any of the following protocols during download operations: File Transfer Protocol (FTP), Hypertext Transfer Protocol (HTTP), secure Hypertext Transfer Protocol (HTTPS), or the local file protocol (a URL beginning with<code> file:///</code> that represents a local file). You could use the local file protocol to test your application on a computer that does not have access to a HTTP or FTP server. </p><p>For upload operations, you must use an FTP URL. URL Access Manager allows you to upload data using either anonymous or authenticated FTP sessions and supports both passive and active FTP connections. You can use FTP to download and upload files and directories, as well as to set and obtain URL properties.</p><p>If you use HTTP or HTTPS when downloading data, you will be able to perform data transfer with 40-bit RSA encryption, send HTML form information to a URL, and set and obtain URL properties. </p><p>URL Access Manager is designed to run in Mac OS 8.6 and later. URL Access Manager is part of Carbon 1.0.2, and is part of the Carbon framework in Mac OS X. </p><p>In Mac OS 8 and 9, the implementation of URL Access Manager is stored in a shared library called URL Access. You install it in the Extensions folder in the System Folder. The initial implementation of the data store is a local file.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFDDFCI" title="Setting and Determining URL Properties "></a><h2>Setting and Determining URL Properties </h2><p>To use URL Access Manager, you must first make sure that it is installed, and find out which version is installed. Your application can call the functions <code>URLAccessAvailable</code> and <code>URLGetURLAccessVersion</code> to determine this information. </p><p>In order to set and obtain URL properties, you must create a URL reference. To do this, call the function <code>URLNewReference</code>. URL Access Manager uses a URL reference to uniquely identify a URL and its associated data to be transferred. When you are finished with a URL, make sure you deallocate its memory by calling the function <code>URLDisposeReference</code>. </p><p>You can call the functions <code>URLGetProperty</code> and <code>URLSetProperty</code> to obtain and set information associated with a URL. You must pass the correct data type and size of the property value you wish to set in the <code>propertyBuffer</code> parameter of <code>URLSetProperty</code>. Before calling these functions, you should call the function <code>URLGetPropertySize</code> to determine the size of the buffer to allocate for the property value. </p><p>You may wish to call these functions before calling the functions <code>URLDownload</code> and <code>URLUpload</code> to get and set information associated with the specified URL in the <code>urlRef</code> parameter. </p><p>Once you have created a URL reference, you can create a function to display the properties of that reference. In <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP25">Listing 1-1</a></span>, the function <code>displayProperties</code> first creates a <code>propertyList</code> array of Apple-defined URL properties, obtains the corresponding sizes and values of these properties by calling <code>URLGetPropertySize</code> and <code>URLGetProperty</code>, respectively, and then displays each property value.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_7" title="Listing 1-1Displaying the value of each URL property"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP25" title="Listing 1-1Displaying the value of each URL property"></a><strong>Listing 1-1&nbsp;&nbsp;</strong>Displaying the value of each URL property</p><div class="codesample"><table><tr><td scope="row"><pre>void displayProperties (URLReference urlRef)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    int propCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    const char* propertyList[21];<span></span></pre></td></tr><tr><td scope="row"><pre>    Size propertySize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle theProperty = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[0]  = kURLURL;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[1] = kURLResourceSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[2] = kURLLastModifiedTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[3] = kURLMIMEType;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[4] = kURLFileType;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[5] = kURLFileCreator;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[6] = kURLCharacterSet;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[7] = kURLResourceName;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[8] = kURLHost;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[9] = kURLAuthType;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[10] = kURLUserName;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[11] = kURLPassword;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[12] = kURLStatusString;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[13] = kURLIsSecure;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[14] = kURLCertificate;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[15] = kURLTotalItems;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[16] = kURLHTTPRequestMethod;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[17] = kURLHTTPRequestHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[18] = kURLHTTPRequestBody;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[19] = kURLHTTPRespHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    propertyList[20] = kURLHTTPUserAgent;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Get the size of each property, allocate a handle to store the<span></span></pre></td></tr><tr><td scope="row"><pre>    // property’s value, get the property value, and display it.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for( propCount = 0; propCount &lt; 21; propCount++)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Get the size of the property’s value.<span></span></pre></td></tr><tr><td scope="row"><pre>        err = URLGetPropertySize (urlRef, propertyList[propCount], &amp;propertySize);<span></span></pre></td></tr><tr><td scope="row"><pre>        if(err != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Error %d getting property size %s. Size returned was: %d\n", err, propertyList[propCount], propertySize);<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Property size is %d: %s\n", propertySize, propertyList[propCount]);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Now get a handle for the property value.<span></span></pre></td></tr><tr><td scope="row"><pre>        theProperty = NewHandleClear (propertySize + 1);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = MemError();<span></span></pre></td></tr><tr><td scope="row"><pre>        if(err != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Error %d getting property handle %s\n", err, propertyList[propCount]);<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Got handle for %s\n", propertyList[propCount]);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Now get the property’s value.<span></span></pre></td></tr><tr><td scope="row"><pre>        err = URLGetProperty (urlRef, propertyList[propCount], *theProperty, propertySize);<span></span></pre></td></tr><tr><td scope="row"><pre>        if(err != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Error %d getting property %s\n", err, propertyList[propCount]);<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Property %s: %s\n", propertyList[propCount], *theProperty);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Clean up.<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle (theProperty);<span></span></pre></td></tr><tr><td scope="row"><pre>        printf("\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001046-CH210-BAAJDIGA" title="Performing Simple Data Transfer"></a><h2>Performing Simple Data Transfer</h2><p>URL Access Manager provides four high-level functions for performing simple upload and download operations. These functions are synchronous, meaning that they return control to your application upon completion. If you want more control over the data transfer than these functions afford, see the description of the function <code>URLOpen</code> in <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TPXREF104">“Controlling Data Transfer.”</a></span> </p><p>To perform simple download operations, you can call the function <code>URLSimpleDownload</code> or <code>URLDownload</code>. The difference between these functions is that <code>URLSimpleDownload</code> takes a character string as the URL, while <code>URLDownload</code> takes a URL reference. If you call <code>URLDownload</code> and pass a URL reference, you can perform a number of additional operations on the reference, including manipulating and obtaining its properties. </p><p>To perform simple upload operations, you can call the function <code>URLSimpleUpload</code> or <code>URLUpload</code>. Like <code>URLSimpleDownload</code>, <code>URLSimpleUpload</code> takes a character string as the URL. <code>URLUpload</code> takes a URL reference, and like <code>URLDownload</code>, allows you to perform additional operations. </p><p>You can specify the data transfer options that these functions should use by passing the appropriate bitmask in the openFlags parameter. For upload operations, the options you can specify include whether to replace an existing file, display a progress indicator bar during data transfer operations, display an authentication dialog box if URL Access Manager requires authentication, decode an encoded file and expand it if the Stuffit Engine is installed, specify that URL is a directory, or download a directory listing instead of the contents of a file or directory. For download operations, you can set any of the following masks: <code>kURLReplaceExistingFlag</code>, <code>kURLExpandFileFlag</code>, <code>kURLExpandAndVerifyFlag</code>, <code>kURLDisplayProgressFlag</code>, <code>kURLDisplayAuthFlag</code>, <code>kURLIsDirectoryHintFlag</code>, <code>kURLDoNotTryAnonymousFlag</code>, or <code>kURLDirectoryListingFlag</code>. </p><p>Prior to Mac OS X, if you want update events to be passed to your application while dialog boxes are displayed by any of these functions, you should write your own system event callback function. Pass a pointer to it in the <code>eventProc</code> parameter of the appropriate function. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-BAAFBCBG" title="Naming Your Destination File"></a><h2>Naming Your Destination File</h2><p><span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFCBHJD">Figure 1-1</a></span> shows a flowchart illustrating the factors that influence the name of your destination file when performing upload and download operations using the functions <code>URLSimpleDownload</code>, <code>URLDownload</code>, <code>URLSimpleUpload</code>, <code>URLUpload</code>, and <code>URLOpen</code>. These factors include the specification of the name of the destination file or directory, the existence of the destination, and the setting of the <code>kURLReplaceExistingFlag</code> mask in the <code>openFlags</code> parameter. </p><p>For upload operations performed by the functions <code>URLSimpleUpload</code>, <code>URLUpload</code>, and <code>URLOpen</code>, if you want to replace the destination file with the one you passed in the <code>fileSpec</code> parameter, set the mask constant <code>kURLReplaceExistingFlag</code> in the <code>openFlags</code> parameter and do not terminate the destination URL with a “/” character. If you specify a URL that doesn’t end with a “/” character, URL Access Manager assumes that the destination is a file, not a directory. </p><p>For downloading, the name of the destination file or directory is considered specified if the name field passed in the <code>FSSpec</code> is not empty. For uploading, the name of the destination is considered specified if the path portion of the URL is not terminated by a '/'. If you specify a name that already exists on the server and do not set the mask constant <code>kURLReplaceExistingFlag</code>, the function returns the result code <code>kURLDestinationExistsError</code>. If you do not specify the name of the destination file, do not set the mask constant <code>kURLReplaceExistingFlag</code>, and the destination file already exists on the server, URL Access Manager creates a unique name by appending a number to the original name before the extension, if any. For example, if the URL specifies a file named <code>file.txt</code>, <code>URLOpen </code>changes the filename to <code>file1.txt</code>. If the file exists and the <code>kURLReplaceExistingFlag</code> mask is set, then the file being uploaded will replace the contents of the destination file and retain the name of the destination file. For example, if you wanted to upload the file “sari.mov” and replace the contents of the file specified by the URL “ftp://host/path/lisa.mov”, the file “lisa.mov” existed, and that the <code>kURLReplaceExistingFlag</code> mask was set, the file “sari.mov” would replace “lisa.mov” and the resulting URL would be “ftp://host/path/lisa.mov”. </p><br/><div><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_8" title="Figure 1-1Naming your destination file"></a><p><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFCBHJD" title="Figure 1-1Naming your destination file"></a><strong>Figure 1-1&nbsp;&nbsp;</strong>Naming your destination file</p><img src = "../art/url_l_01.gif" alt = "Naming your destination file" width="475" height="333"></div><br/><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF104" title="Controlling Data Transfer"></a><h2>Controlling Data Transfer</h2><p>URL Access Manager provides the low-level function <code>URLOpen</code> for more control over data transfer operations than can be achieved using the high-level functions described in <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BAAJDIGA">“Performing Simple Data Transfer.”</a></span> <code>URLOpen</code> is an asynchronous function, meaning that it returns control to your application immediately, not upon completion. </p><p>When you call <code>URLOpen</code> to perform an upload operation, you must specify a valid destination file. For download operations, you do not have to specify a valid destination file. </p><p>If you do not specify a valid destination file, there are several functions that you may wish to call to get information about the download operation being performed by <code>URLOpen</code>. To retrieve data as it is downloaded, call the function <code>URLGetBuffer (page 48)</code>. Note that you cannot retain or modify the retrieved data. You should call <code>URLGetBuffer</code> repeatedly until the download is complete. This is marked by a <code>kURLCompletedEvent </code>or <code>kURLErrorOccurredEvent</code> event, or the state constants <code>kURLCompletedState </code>or <code>kURLErrorOccurredState</code> returned by the function <code>URLGetCurrentState</code>. Between calls to <code>URLGetBuffer</code>, you should call the function <code>URLIdle</code> to allow time for URL Access Manager to refill its buffers during download operations. After each call to <code>URLGetBuffer</code>, you call the function <code>URLReleaseBuffer)</code> to prevent URL Access Manager from running out of buffers.</p><p>You may wish to call the function <code>URLGetDataAvailable</code> to determine the number of bytes remaining to be handed off from URL Access Manager to your application. Calling this function tells you how much data you will obtain by a call to <code>URLGetBuffer</code> (that is, how much data is remaining in the buffer of URL Access Manager). This does not include the number of bytes in transit to your buffer, nor does it include the amount of data not yet transferred from URL Access Manager. To calculate the amount of data remaining to be downloaded, pass the name constant <code>kURLResourceSize</code> in the <code>property</code> parameter of the function <code>URLGetProperty</code> and subtract the amount of data copied. </p><p>Note that <code>URLGetBuffer</code>, <code>URLReleaseBuffer</code>, and <code>URLGetDataAvailable</code> only provide useful information if you specified an invalid destination file for a download operation performed by <code>URLOpen</code>. </p><p>You can specify the data transfer options that <code>URLOpen</code> should use by passing the appropriate bitmask in the openFlags parameter. For upload operations, the options you can specify to <code>URLOpen</code> include whether to replace an existing file, decode an encoded file, specify that URL is a directory, or download a directory listing instead of the contents of a file or directory. For download operations, you can set any of the following masks: <code>kURLReplaceExistingFlag</code>, <code>kURLExpandFileFlag</code>, <code>kURLExpandAndVerifyFlag</code>, <code>kURLIsDirectoryHintFlag</code>, <code>kURLDoNotTryAnonymousFlag</code>, or <code>kURLDirectoryListingFlag</code>. </p><p>If you wish to be notified of certain data transfer events, you can write your own data transfer event callback function and pass a pointer to it in the <code>URLEventMask</code> parameter of <code>URLOpen</code>. The data transfer events that you can receive depend on whether the destination file you specify is valid. In addition, you should pass a bitmask representing the events you wish to be notified of in the <code>eventRegister</code> parameter. You can then manipulate the data or write it to the destination of your choice. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF108" title="Terminating Data Transfer Operations"></a><h2>Terminating Data Transfer Operations</h2><p>The function <code>URLAbort</code> terminates a data transfer operation that was started by any function transferring data to or from a URL reference, including <code>URLDownload</code>, <code>URLUpload</code>, and <code>URLOpen</code>. When your application calls <code>URLAbort</code>, URL Access Manager changes the state returned by the function <code>URLGetCurrentState</code> to <code>kURLAbortingState</code> and passes the constant <code>kURLAbortInitiatedEvent </code>to your notification callback function. When data transfer is terminated, URL Access Manager changes the state returned by <code>URLGetCurrentState</code> to <code>kURLCompletedState</code> and passes the constant <code>kURLCompletedEvent </code>in the <code>event</code> parameter of your notification callback function.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF105" title="Obtaining Data Transfer Information "></a><h2>Obtaining Data Transfer Information </h2><p>You can use these functions to determine the error code returned when a data transfer operation fails, determine the status of a data transfer operation, yield time so that URL Access Manager can refill its buffers, or get information about a file.</p><p>You may want to call the function <code>URLGetError</code> when a data transfer operation fails. <code>URLGetError</code> passes back the error code associated with the failed transfer, which may be a system error code, a protocol-specific error code, or one of the error codes listed in “URL Access Result Codes”.</p><p>If you wish to determine the status of a data transfer operation, you should call the function <code>URLGetCurrentState</code>. You may wish to call <code>URLGetCurrentState</code> periodically to monitor the status of a download or upload operation.</p><p>The function <code>URLGetFileInfo</code> obtains the file type and creator codes for a specified filename. The type and creator codes are determined by the Internet configuration mapping table and are based on the filename extension. For example, if you pass the filename <code>"jane.txt</code>", <code>URLGetFileInfo</code> will return <code>'TEXT'</code> in the <code>type</code> parameter and<code> 'ttxt'</code> in the <code>creator</code> parameter. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF106" title="Responding to Data Transfer Events"></a><h2>Responding to Data Transfer Events</h2><p>During a call to <code>URLOpen</code>, data transfer events are generated after:</p><ul class="ul"><li class="li"><p><code>URLOpen</code> has been called but the location specified by the URL reference has not yet been accessed. </p></li><li class="li"><p>The location specified by the URL reference has been accessed and is valid. </p></li><li class="li"><p>A download operation is in progress. </p></li><li class="li"><p>A data transfer operation has been aborted. </p></li><li class="li"><p>All operations associated with a call to <code>URLOpen</code> have been completed. </p></li><li class="li"><p>An error occurred during data transfer. </p></li><li class="li"><p>Data is available in buffers. </p></li><li class="li"><p>A download operation is complete because there is no more data to retrieve from buffers. </p></li><li class="li"><p>An upload operation is in progress. </p></li><li class="li"><p>A system event has occurred. </p></li><li class="li"><p>The size of the data being downloaded is known. </p></li><li class="li"><p>A time interval of approximately one quarter of a second has passed. </p></li><li class="li"><p>A property such as a filename has become known or changed. </p></li></ul><p>If you want to be notified of data transfer events, pass a Universal Procedure Pointer (UPP) to your notification callback function in the <code>notifyProc</code> parameter of <code>URLOpen</code>. To create a UPP to your notification callback, you must call the function <code>NewURLNotifyUPP</code>. You must also specify which data transfer events you want to receive as a bitmask in the <code>eventRegister</code> parameter of <code>URLOpen</code>. You can then manipulate the data or write it to the destination of your choice. </p><p>Your application’s notification callback function should process the event record passed by URL Access Manager in the <code>event</code> parameter and return 0. The only restriction that URL Access Manager imposes on the functionality of your notification callback function is that it should not call the function <code>URLDisposeReference</code>. For information on how to write a notification callback, see <code>URLNotifyProcPtr</code>.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF107" title="Responding to System Events During Data Transfer"></a><h2>Responding to System Events During Data Transfer</h2><p>Prior to Mac OS X, if you want update events to be passed to your application while a dialog box is displayed by the functions <code>URLSimpleDownload</code>, <code>URLDownload</code>, <code>URLSimpleUpload</code>, and <code>URLUpload</code>, you should write your own system event callback function. (In Mac OS X, this is not necessary, since all dialog boxes are moveable). In order for these functions to display a dialog box, you must set the mask constant <code>kURLDisplayProgressFlag </code>or<code> kURLDisplayAuthFlag</code> in the bitmask passed in the <code>openFlags</code> parameter. If you write your own callback to handle update events in these dialog boxes, you should pass a Universal Procedure Pointer (UPP) to your callback in the <code>eventProc</code> parameter of these functions. Call the function <code>NewURLSystemEventUPP</code> to create a UPP to your callback function. </p><p>If you do not create a callback function to handle update events when a dialog box is displayed, these functions will display a nonmovable modal dialog box when warranted.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFGIAJH" title="Using URL Access Manager with AppleScript"></a><h2>Using URL Access Manager with AppleScript</h2><p>You can use AppleScript to call URL Access Manager functions. If your AppleScript application uses URL Access Manager for operations that may take a substantial amount of time, such as transferring large amounts of data over a low-speed connection, be sure to set the timeout to a large value. Setting the timeout to a large value, such as 60,000 seconds, will avoid unnecessary AppleEvent errors.</p><p>For information about the standard scripting addition commands distributed with AppleScript, see the AppleScript section of the Mac OS Help Center, or visit the <span class="content_text"><a href="http://www.apple.com/applescript" target="_blank">AppleScript</a></span> website.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-TPXREF102" title="Case Study: Downloading Data From a URL"></a><h2>Case Study: Downloading Data From a URL</h2><p>This section describes how the sample application <code>SamplePost</code> posts information to an HTTP URL and download the URL’s response using URL Access Manager function <code>URLDownload</code>. </p><p><span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP15">Listing 1-2</a></span> shows the header file for the application, <code>SamplePost.h</code>, which contains definitions of the URL from which data is to be downloaded (<code>kSampleURL</code>) and the structure <code>urlDownInfo</code>, as well as declarations of the function <code>DoSamplePost</code>, which calls <code>URLDownload</code>, and a system event callback function, <code>MyURLCallbackProc</code>, which is a place holder for code that handles system events that occur during the download. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_9" title="Listing 1-2SamplePost.h "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP15" title="Listing 1-2SamplePost.h "></a><strong>Listing 1-2&nbsp;&nbsp;</strong>SamplePost.h </p><div class="codesample"><table><tr><td scope="row"><pre>#define kSampleURL"http://www.internic.net/cgi-bin/itts/whois"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct urlDownInfo {<span></span></pre></td></tr><tr><td scope="row"><pre>    URLReference urlRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec * destination;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle destinationHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>    URLOpenFlags openFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    URLSystemEventProcPtr eventProc;<span></span></pre></td></tr><tr><td scope="row"><pre>    void * userContext;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean done;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus errorCode;<span></span></pre></td></tr><tr><td scope="row"><pre>} URLDownloadInfo;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct urlDownInfo *URLDownInfoPtr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static void DoSamplePost();<span></span></pre></td></tr><tr><td scope="row"><pre>pascal OSStatus MyURLCallbackProc (void*, EventRecord *);<span></span></pre></td></tr></table></div><p>SamplePost is a multi-threaded application. As a result, in <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP16">Listing 1-3</a></span>, SamplePost’s main function calls the Memory Manager functions <code>MaxApplZone</code> and <code>MoreMasters</code> in its main function. Note that all URL Access Manager functions are threaded with Thread Manager cooperative threads. These threads are nonreentrant on PowerPC.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_10" title="Listing 1-3SamplePost initialization"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP16" title="Listing 1-3SamplePost initialization"></a><strong>Listing 1-3&nbsp;&nbsp;</strong>SamplePost initialization</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Events.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Threads.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Processes.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;Files.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include "URLAccess.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include "SamplePost.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main (void)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    // Call MaxAppleZone() when using the Thread Manager.<span></span></pre></td></tr><tr><td scope="row"><pre>    MaxApplZone();<span></span></pre></td></tr><tr><td scope="row"><pre>    for (i = 0; i &lt; 20; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        MoreMasters();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP17">Listing 1-4</a></span> shows <code>SamplePost</code> calling the function<code></code><code>URLAccessAvailable</code> to verify that URL Access Manager is available. If URL Access Manager is available, <code>DoSamplePost</code> is called. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_11" title="Listing 1-4Verifying the availability of URL Access Manager"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP17" title="Listing 1-4Verifying the availability of URL Access Manager"></a><strong>Listing 1-4&nbsp;&nbsp;</strong>Verifying the availability of URL Access Manager</p><div class="codesample"><table><tr><td scope="row"><pre>    // Make sure URL Access Manager is available.<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( URLAccessAvailable()) {<span></span></pre></td></tr><tr><td scope="row"><pre>        DoSamplePost();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Call error handling function.<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>In <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP18">Listing 1-5</a></span>, <code>DoSamplePost</code> defines a <code>URLDownloadInfo</code> structure named <code>myRef</code> that is uses to store information for calling <code>URLDownload</code>. The <code>DoSamplePost</code> function then calls <code>NewHandle</code> to allocate the memory in which the downloaded information will be stored, creates a URL reference, and stores it in <code>myRef.urlRef</code>.  </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_12" title="Listing 1-5Allocating memory and creating a URL reference"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP18" title="Listing 1-5Allocating memory and creating a URL reference"></a><strong>Listing 1-5&nbsp;&nbsp;</strong>Allocating memory and creating a URL reference</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>static void DoSamplePost (void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    ThreadID threadID = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    URLDownloadInfo myRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle downloadHandle = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    long downloadSize = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    downloadHandle = NewHandle(0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( downloadHandle == NULL) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Call error handling function.<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    //  Create a URLReference<span></span></pre></td></tr><tr><td scope="row"><pre>    err = URLNewReference( kSampleURL, &amp;myRef.urlRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( err != noErr) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Call error handling function.<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>As shown in <code><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFHBAHJ">Listing 1-6</a></code>, <code>DoSamplePost</code> calls the function <code>URLSetProperty</code> to set the HTTP request method property value to the 4-byte string <code>"POST"</code> and the value of the HTTP request body property value to the 19-byte string <code>"whois_nic=apple.com"</code>. When you set the property identified by <code>kURLHTTPRequestBody</code>, URL Access Manager automatically adds the length of the value identified by <code>kURLHTTPRequestHeader</code> to the request, so you do not need to set the request header explicitly. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_13" title="Listing 1-6Setting URL properties"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFHBAHJ" title="Listing 1-6Setting URL properties"></a><strong>Listing 1-6&nbsp;&nbsp;</strong>Setting URL properties</p><div class="codesample"><table><tr><td scope="row"><pre>URLSetProperty (myRef.urlRef, kURLHTTPRequestMethod, "POST", 4);<span></span></pre></td></tr><tr><td scope="row"><pre>URLSetProperty (myRef.urlRef, kURLHTTPRequestBody, "whois_nic=apple.com", 19);<span></span></pre></td></tr></table></div><p>Next, <code>DoSamplePost</code> uses the remaining fields of the <code>myRef</code> structure to store values that will be used as parameters for calling <code>URLDownload</code>.</p><ul class="ul"><li class="li"><p><code>DoSamplePost</code> sets <code>myRef.destination</code> to <code>NULL</code>. When <code>NULL</code> is provided as the destination parameter to the <code>URLDownload</code>, the calling application indicates that the downloaded data is not going to be written to a file on disk.</p></li><li class="li"><p><code>DoSamplePost</code> sets <code>myRef.destinationHandle</code> to the value of <code>downloadHandle</code>, which is the location in memory at which the downloaded data is to be stored.</p></li><li class="li"><p><code>DoSamplePost</code> sets <code>myRef.OpenFlags</code> to <code>kURLDisplayProgressFlag</code>. When the value of the <code>openFlags</code> parameter to <code>URLDownload</code> is <code>kURLDisplayProgressFlag</code>, <code>URLDownload</code> displays a progress indicator during the download process. You may wish to provide a system event callback function to handle system events that occur. </p></li><li class="li"><p><code>DoSamplePost</code> sets <code>myRef.eventProc</code> to the address of the SamplePost application’s system event callback function. When <code>DoSamplePost</code> calls <code>URLDownload</code>, it will specify <code>myRef.eventProc</code> as the <code>eventProc</code> parameter. If a system event occurs while the progress indicator is displayed, URL Access Manager will call the function specified by the <code>eventProc</code> parameter and will pass to it the value of the <code>userContext</code> parameter, which is described next.</p></li><li class="li"><p><code>DoSamplePost</code> sets <code>myRef.userContext</code> to point to <code>myref</code>. When <code>DoSamplePost</code> calls <code>URLDownload</code>, it will specify <code>myRef.userContext</code> as the <code>userContext</code> parameter. Your application can use the user context to set up its context when the system event callback function is called.</p></li></ul><p><code><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-BCFGAEHD">Listing 1-7</a></code> illustrates setting these values. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_14" title="Listing 1-7Setting the URLDownload parameters"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFGAEHD" title="Listing 1-7Setting the URLDownload parameters"></a><strong>Listing 1-7&nbsp;&nbsp;</strong>Setting the URLDownload parameters</p><div class="codesample"><table><tr><td scope="row"><pre>myRef.destination = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.destinationHandle = downloadHandle;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.openFlags = kURLDisplayProgressFlag;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.eventProc = &amp;MyURLCallbackProc;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.userContext = &amp;myRef;<span></span></pre></td></tr><tr><td scope="row"><pre>myRef.errorCode = 0;<span></span></pre></td></tr></table></div><p>Once the URL reference has been created, its properties set, and the parameters for <code>URLDownload</code> prepared, <code>DoSamplePost</code> is ready to call <code>URLDownload</code>, as shown in <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP19">Listing 1-8</a></span>. If the download is successful, <code>DoSamplePost</code> calls the function <code>URLGetProperty</code> to obtain the size of the downloaded data using the <code>downloadSize</code> parameter.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_15" title="Listing 1-8Calling the URLDownload function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP19" title="Listing 1-8Calling the URLDownload function"></a><strong>Listing 1-8&nbsp;&nbsp;</strong>Calling the URLDownload function</p><div class="codesample"><table><tr><td scope="row"><pre>err = URLDownload (<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.urlRef,<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.destination,<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.destinationHandle,<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.openFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.eventProc,<span></span></pre></td></tr><tr><td scope="row"><pre>    myRef.userContext);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myRef.errorCode = err;<span></span></pre></td></tr><tr><td scope="row"><pre>if (  myRef.errorCode != noErr) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Call error handling function.<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>else {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Successful download. Get the size of the downloaded data.<span></span></pre></td></tr><tr><td scope="row"><pre>    err = URLGetProperty(myRef.urlRef, kURLResourceSize, &amp;downloadSize, 4);<span></span></pre></td></tr><tr><td scope="row"><pre>if ( err != noErr) {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Call error handling function.<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP20">Listing 1-9</a></span><code>DoSamplePost</code> calls <code>SetHandleSize</code> to set the size of <code>downloadHandle</code> to <code>downloadSize + 1</code> and sets the value of the last byte of downloaded data to <code>NULL</code>. DoSamplePost calls <code>printf</code> to display the data, and concludes by disposing of the URL reference.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_16" title="Listing 1-9Displaying the downloaded data"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP20" title="Listing 1-9Displaying the downloaded data"></a><strong>Listing 1-9&nbsp;&nbsp;</strong>Displaying the downloaded data</p><div class="codesample"><table><tr><td scope="row"><pre>downloadSize = GetHandleSize(downloadHandle);<span></span></pre></td></tr><tr><td scope="row"><pre>SetHandleSize(downloadHandle, (downloadSize+1));<span></span></pre></td></tr><tr><td scope="row"><pre>(*myRef.destinationHandle)[downloadSize] = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>printf( "&lt;•>==================== Downloaded Data ==================\n" );<span></span></pre></td></tr><tr><td scope="row"><pre>printf( "%s", *myRef.destinationHandle );<span></span></pre></td></tr><tr><td scope="row"><pre>DisposeHandle(downloadHandle);<span></span></pre></td></tr><tr><td scope="row"><pre>URLDisposeReference(myref.urlRef);<span></span></pre></td></tr></table></div><p><span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP21">Listing 1-10</a></span> shows a placeholder for SamplePost’s system event callback function. The <code>userContext</code> parameter can be used to associate any particular call of <code>URLDownload</code> with any particular call of the system event callback function.</p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_17" title="Listing 1-10SamplePost&acirc;&#128;&#153;s system event callback function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP21" title="Listing 1-10SamplePost&acirc;&#128;&#153;s system event callback function"></a><strong>Listing 1-10&nbsp;&nbsp;</strong>SamplePost’s system event callback function</p><div class="codesample"><table><tr><td scope="row"><pre>pascal OSStatus MyURLCallbackProc (void *userContext, EventRecord *event)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("&lt;•>System callback thread fired! Thread: %u\n", userContext);<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001046-CH210-BCFHCBHF" title="Case Study: Downloading Data From Multiple URLs"></a><h2>Case Study: Downloading Data From Multiple URLs</h2><p>This section describes how the sample application Downloader downloads data from multiple URLs and stores it in multiple files using URL Access Manager function U<code>RLDownload</code>. Downloader obtains the URLs to be downloaded by reading a text file in which they have been stored.</p><p><span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP22">Listing 1-11</a></span> illustrates how Downloader’s main function sets up the main event loop and calls the function <code>getURL</code> to obtain a URL from a file of URLs. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_18" title="Listing 1-11The Downloader application&acirc;&#128;&#153;s main function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP22" title="Listing 1-11The Downloader application&acirc;&#128;&#153;s main function"></a><strong>Listing 1-11&nbsp;&nbsp;</strong>The Downloader application’s main function</p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;Events.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include "URLAccess.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include "string.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#include "Memory.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void main (void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    char url[255];<span></span></pre></td></tr><tr><td scope="row"><pre>    int count, fileCount = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord ev;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Call MaxApplZone, MoreMasters.<span></span></pre></td></tr><tr><td scope="row"><pre>    // Initialize graphics port, fonts, menus, cursor, and dialogs.<span></span></pre></td></tr><tr><td scope="row"><pre>    // Clear the screen.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    while ( url != NULL )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Handle Events through each loop<span></span></pre></td></tr><tr><td scope="row"><pre>        WaitNextEvent(everyEvent, &amp;ev, 0, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        eventHandler( NULL, &amp;ev );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Obtain a URL from the file of URLs<span></span></pre></td></tr><tr><td scope="row"><pre>        result = getURL (url); // getURL function not shown<span></span></pre></td></tr><tr><td scope="row"><pre>        if (result == eofErr) { // Handle error condition. }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Call Download function.<span></span></pre></td></tr><tr><td scope="row"><pre>        result = DoDownload (url);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (result != noErr) { // Handle error condition. }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("\n All of the URLs have been downloaded.\n");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>DoDownload</code> function shown in <span class="content_text"><a href="url_tasks.html#//apple_ref/doc/uid/TP40001046-CH210-TP23">Listing 1-12</a></span> does the actual work of downloading data from the URL. It creates a file specification for the data that is to be downloaded and a URL reference. It specifies the mask <code>kURLReplaceExistingFlag</code> in the <code>openFlags</code> parameter to replace an existing file (if any) with the downloaded data and to display a progress indicator during the download. Finally, it calls the function <code>URLDownload</code> to download the data. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_19" title="Listing 1-12Downloader&acirc;&#128;&#153;s DoDownload function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP23" title="Listing 1-12Downloader&acirc;&#128;&#153;s DoDownload function"></a><strong>Listing 1-12&nbsp;&nbsp;</strong>Downloader’s <code>DoDownload</code> function</p><div class="codesample"><table><tr><td scope="row"><pre>void DoDownload (void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    URLReference urlRef;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec dest, *destPtr = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    destPtr = &amp;dest;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle destHandle = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    int openFlags = kURLReplaceExistingFlag + kURLDisplayProgressFlag;<span></span></pre></td></tr><tr><td scope="row"><pre>    Str255 newFile;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create the file specification for the download.<span></span></pre></td></tr><tr><td scope="row"><pre>    sprintf((char*)newFile, "File %d", fileCount);<span></span></pre></td></tr><tr><td scope="row"><pre>    c2pstr((char*)newFile);<span></span></pre></td></tr><tr><td scope="row"><pre>    fileCount++;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = FSMakeFSSpec(0, 0, newFile, &amp;dest);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Create the URLReference.<span></span></pre></td></tr><tr><td scope="row"><pre>    err = URLNewReference( theURL, &amp;urlRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr) printf("URLNewReference failed\n");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Download the data.<span></span></pre></td></tr><tr><td scope="row"><pre>    err = URLDownload( urlRef, destPtr, destHandle, openFlags, &amp;eventHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>        (void*)&amp;fileCount );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr) printf("URLDownload failed\n");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Clean up.<span></span></pre></td></tr><tr><td scope="row"><pre>    err = URLDisposeReference( urlRef );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err != noErr) printf("URLDisposeReference failed\n");<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 1-13</span> illustrates Downloader’s general event handling function <code>eventHandler</code>. This function handles system events that might occur during calls to the functions <code>URLSimpleDownload</code>, <code>URLDownload</code>, <code>URLSimpleUpload</code>, and <code>URLUpload</code>. The <code>userContext</code> parameter can be used to associate any particular call of <code>URLDownload</code> with any particular call of the system event callback function. In this context, it is an integer. </p><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_20" title="Listing 1-13Downloader&acirc;&#128;&#153;s system event callback function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001046-CH210-TP24" title="Listing 1-13Downloader&acirc;&#128;&#153;s system event callback function"></a><strong>Listing 1-13&nbsp;&nbsp;</strong>Downloader’s system event callback function</p><div class="codesample"><table><tr><td scope="row"><pre>pascal long eventHandler (void * userContext, EventRecord* eventPtr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    EventRecord* ev;<span></span></pre></td></tr><tr><td scope="row"><pre>    int what = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    int context = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    int* intPtr = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Convert the event pointer into an event record.<span></span></pre></td></tr><tr><td scope="row"><pre>    ev = (EventRecord*)eventPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>    what = ev->what;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Convert the void* to an integer.<span></span></pre></td></tr><tr><td scope="row"><pre>    intPtr = (int*)userContext;<span></span></pre></td></tr><tr><td scope="row"><pre>    context = *intPtr;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (context &lt; 0 || context > 99) {<span></span></pre></td></tr><tr><td scope="row"><pre>        context = -1; // Unknown context<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (what) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case 0 : // Null Event<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case mouseDown:<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Handler: mouseDown  User Context: %d\n", context);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Call function to handle event.<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case updateEvt:<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Handler: updateEvt  User Context: %d\n", context);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Call function to handle event.<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case activateEvt:<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Handler: activateEvt  User Context: %d\n", context);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Call function to handle event.<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case keyDown:<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Handler: keyDown  User Context: %d\n", context);<span></span></pre></td></tr><tr><td scope="row"><pre>            // Call function to handle event.<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            printf("Handler: Default  User Context: %d\n", context);<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001046-CH210-DontLinkElementID_2" title="See Also"></a><h2>See Also</h2><p>These documents in the ADC Reference Library contain additional information about URL Access Manager:</p><ul class="ul"><li class="li"><p><em><a href="../../../Reference/URL_Access_Manager/index.html#//apple_ref/doc/uid/TP30000058" target="_top">URL Access Manager Reference</a></em> describes the URL Access Manager API through version 2.0.3, including functions, data types, constants, and result codes.</p></li><li class="li"><p>The example application <em><!--a target="_top" -->URLAccessSample<!--/a--></em> incorporates most of the URL Access Manager API. It demonstrates simple calls like <code>URLDownload</code> and <code>URLUpload</code>, as well as asynchronous calls using <code>URLOpen</code>. It also shows how to POST to a HTTP server.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <!-- Previous button --><span style="margin-left: 8px"><a href="../url_revisions/url_revisions.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/TransferringData_URLAccess/url_tasks/url_tasks.html%3Fid%3DTP40001046-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/TransferringData_URLAccess/url_tasks/url_tasks.html%3Fid%3DTP40001046-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/TransferringData_URLAccess/url_tasks/url_tasks.html%3Fid%3DTP40001046-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>