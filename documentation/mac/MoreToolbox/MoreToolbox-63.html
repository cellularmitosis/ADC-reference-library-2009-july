<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>ChangedResource (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING63></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-62.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-64.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-9.html"><B>Chapter 1 - Resource Manager</B></A> / <A HREF="MoreToolbox-24.html"><B>Resource Manager Reference</B></A><BR><DL><DD><A HREF="MoreToolbox-30.html"><B>Resource Manager Routines</B></A> / <A HREF="MoreToolbox-62.html"><B>Modifying Resources</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING63-0></A>
<H3><A NAME=MARKER-9-338></A>ChangedResource</H3>
 <A NAME=MARKER-11-339></A><A NAME=MARKER-2-340></A>If you've changed a resource's data or changed an entry in a resource map, you can use the <CODE>ChangedResource</CODE> procedure to set a flag in the resource's resource map entry in memory to show that you've made changes. <P>
<PRE>
PROCEDURE ChangedResource (theResource: Handle);
</PRE>
<DL>
<DT><CODE>theResource</CODE>
<DD> A handle to a resource.
</DL>
<A NAME=HEADING63-4></A>
<H5>DESCRIPTION</H5>
 Given a handle to a resource, the <CODE>ChangedResource</CODE> procedure sets the <CODE>resChanged</CODE> attribute for that resource in the resource map in memory. If the <CODE>resChanged</CODE> attribute for a resource has been set and your application calls <CODE>UpdateResFile</CODE> or quits, the Resource Manager writes the resource data for that resource (and for all other resources whose <CODE>resChanged</CODE> attribute is set) and the entire resource map to the resource fork of the corresponding file on disk. If the <CODE>resChanged</CODE> attribute for a resource has been set and your application calls <CODE>WriteResource</CODE>, the Resource Manager writes only the resource data for that resource to disk.<P>
 If you change information in the resource map with a call to <CODE>SetResInfo</CODE> or <CODE>SetResAttrs</CODE> and then call <CODE>ChangedResource</CODE> and <CODE>UpdateResFile</CODE>, the Resource Manager still writes both the resource map and the resource data to disk. If you want any of your changes to the resource map or resource data to be temporary, you must restore the original information before the Resource Manager updates the resource fork on disk.<P>
 After writing a resource to disk, the Resource Manager clears the resource's <CODE>resChanged</CODE> attribute in the appropriate entry of the resource map in memory.<P>
 If the given handle isn't a handle to a resource, if the modified resource data can't be written to the resource fork, or if the <CODE>resProtected</CODE> attribute is set for the modified resource, <CODE>ChangedResource</CODE> does nothing. To find out whether any of these errors occurred, call <CODE>ResError</CODE>.<P>
 When your application calls <CODE>ChangedResource</CODE>, the Resource Manager attempts to reserve enough disk space to contain the changed resource. If the modified resource data can't be written to the resource fork (for example, if there's not enough room on disk), the <CODE>resChanged</CODE> attribute is not set to 1. If this is the case and you call <CODE>UpdateResFile</CODE> or <CODE>WriteResource</CODE>, the Resource Manager won't know that the resource data has been changed. Thus, the routine won't write the modified resource data to the resource fork and won't return an error. For this reason, always make sure that the <CODE>ResError</CODE> function returns the result code <CODE>noErr</CODE> after a call to <CODE>ChangedResource</CODE>.<P>
<DL>
<DT><B>IMPORTANT</B>
<DD>If you need to make changes to a purgeable resource using routines that may cause the Memory Manager to purge the resource, you should make the resource temporarily not purgeable. To do so, use the Memory Manager procedures <CODE>HGetState</CODE>, <CODE>HNoPurge</CODE>, and <CODE>HSetState</CODE> to make sure the resource data remains in memory while you change it and until the resource data is written to disk. (You can't use the <CODE>SetResAttrs</CODE> procedure for this purpose, because the changes don't take effect immediately.) First call <CODE>HGetState</CODE> and <CODE>HNoPurge</CODE>, then change the resource as necessary. To make a change to a resource permanent, use <CODE>ChangedResource</CODE> and <CODE>UpdateResFile</CODE> or <CODE>WriteResource</CODE>; then call <CODE>HSetState</CODE> when you're finished. Or, instead of calling <CODE>WriteResource</CODE> to write the resource data immediately, you can call <CODE>SetResPurge</CODE> with the <CODE>install</CODE> parameter set to <CODE>TRUE</CODE> before making changes to purgeable resource data.  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
<DD>If your application doesn't make its resources purgeable, or if the changes you are making to a purgeable resource don't involve routines that may cause the resource to be purged, you don't need to take these precautions.<B><EM></EM></B>   <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING63-12></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The <CODE>ChangedResource</CODE> procedure may move or purge memory blocks in the application heap. Your application should not call this procedure at interrupt time.<P>
 When called, <CODE>ChangedResource</CODE> reserves disk space for the changed resource. The procedure reserves space every time you call it, but the resource is not actually written until you call <CODE>WriteResource</CODE> or <CODE>UpdateResFile</CODE>. Thus, if you call <CODE>ChangedResource</CODE> several times before the resource is actually written, the procedure reserves much more space than is needed. If the resource is large, you may unexpectedly run out of disk space. When the resource is actually written, the file's end-of-file (<CODE>EOF</CODE>) is set correctly, and the next call to <CODE>ChangedResource</CODE> will work as expected.<P>
 If your application frequently changes the contents of resources (especially large resources), you should call <CODE>WriteResource</CODE> or <CODE>UpdateResFile</CODE> immediately after calling <CODE>ChangedResource</CODE>. <P>
<A NAME=HEADING63-16></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>resNotFound<TD>-192<TD>Resource not found<TR>
<TD>resAttrErr<TD>-198<TD>Attribute inconsistent with operation</TABLE>
</H5>
<A NAME=HEADING63-17></A>
<H5>SEE ALSO</H5>
 To check for errors, call the <CODE>ResError</CODE> function as described on <A HREF=MoreToolbox-35.html#MARKER-9-220>page 1-47</A>.<P>
 For examples of the use of the <CODE>ChangedResource</CODE> procedure, see <A HREF=MoreToolbox-18.html#MARKER-9-134>Listing 1-2 on page 1-16</A> and <A HREF=MoreToolbox-22.html#MARKER-9-180>Listing 1-11 on page 1-32</A>.<P>
 For descriptions of the <CODE>UpdateResFile</CODE> and <CODE>WriteResource</CODE> procedures, see <A HREF=MoreToolbox-66.html#MARKER-9-349>page 1-87</A> and <A HREF=MoreToolbox-67.html#MARKER-9-353>page 1-88</A>, respectively. For descriptions of the <CODE>SetResInfo</CODE>, <CODE>SetResAttrs</CODE>, and <CODE>SetResPurge</CODE> procedures, see <A HREF=MoreToolbox-59.html#MARKER-9-322>page 1-77</A>, <A HREF=MoreToolbox-61.html#MARKER-9-332>page 1-80</A>, and <A HREF=MoreToolbox-68.html#MARKER-9-357>page 1-89</A>, respectively.<P>
 For information about using the Memory Manager procedures <CODE>HGetState</CODE>, <CODE>HNoPurge</CODE>, and <CODE>HSetState</CODE>, see <I><A HREF="../Memory/Memory-2.html">Inside Macintosh: Memory</A></I>. <A NAME=MARKER-2-341></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-62.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-64.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
