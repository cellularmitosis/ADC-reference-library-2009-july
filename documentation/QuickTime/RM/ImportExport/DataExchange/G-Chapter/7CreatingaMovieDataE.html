<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Import and Export Guide: Creating a Movie Data Exchange Component</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating a Movie Data Exchange Component"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent" title="Creating a Movie Data Exchange Component"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../../ImportExport-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000523" target="_top">Import &amp; Export</a> &gt; <a href="../A-Intro/1Introduction.html#//apple_ref/doc/uid/TP40000903-IntroductiontoQuickTimeImportandExportGuide-DontLinkElementID_4">QuickTime Import and Export Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../F-Chapter/6MovieDataExchangeCo.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../H-Chapter/8UsingMovieDataExcha.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SW1" title="Creating a Movie Data Exchange Component"></a>
<h1>Creating a Movie Data Exchange Component</h1>

<p>This chapter discusses the details of creating a movie data exchange component. The chapter also includes source code for two simple movie data exchange components.</p>
<p>You should consider creating a movie data import component if you have data that you would like to place in a QuickTime movie and there are not currently facilities for placing that type of data into a movie. Similarly, if you want to work with data from a QuickTime movie without using QuickTime, you might consider creating a movie data export component that can convert the data into a format your program can understand.</p>
<p>Before reading this chapter, you should be familiar with how to create components. After reading this chapter, you should understand the special requirements of these components. Note that a single component may support only import or export functions, not both.</p>
<p>Apple has defined component type values for movie data exchange components. You can use the following constants to specify this component type:</p>
<p>Apple has defined a functional interface for movie data exchange components. You can use the following constants to refer to the request codes for each of the functions that your component must support:</p>

<div class="codesample"><table><tr><td scope="row"><pre>#define MovieImportType 'eat '                  /* movie data import */<span></span></pre></td></tr><tr><td scope="row"><pre>#define MovieExportType 'spit'                  /* movie data export */<span></span></pre></td></tr></table></div>


<div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    /* movie data import components */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportHandleSelect                = 1,  /* import from handle */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportFileSelect                  = 2,  /* import from file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetSampleDurationSelect     = 3,  /* set sample duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetSampleDescriptionSelect  = 4,  /* set sample description */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetMediaFileSelect          = 5,  /* set media file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetDimensionsSelect         = 6,  /* set track dimensions */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetChunkSizeSelect          = 7,  /* set chunk size */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetProgressProcSelect       = 8,  /* set progress function */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetAuxiliaryDataSelect      = 9,  /* set additional data */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetFromScrapSelect          = 10, /* data from scrap */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportDoUserDialogSelect          = 11, /* invoke user dialog box */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetDurationSelect           = 12  /* set paste duration */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* movie data export components */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportToHandleSelect              = 128, /* export to handle */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportToFileSelect                = 129, /* export to file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportDoUserDialogSelect          = 130, /* invoke user dialog box */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportGetAuxiliaryDataSelect      = 131, /* get additional data */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportSetProgressProcSelect '     = 132  /* set progress function */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>




<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImportingMovieData">Importing Movie Data</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ExportingMovieData">Exporting Movie Data</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SummaryofConstants">Summary of Constants</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ResultCodes">Result Codes</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ASampleMovieImportComponent">A Sample Movie Import Component</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImplementingtheRequiredImportComponentFunctions">Implementing the Required Import Component Functions</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ASampleMovieExportComponent">A Sample Movie Export Component</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SaveandRestoreComponentRoutines">Save-and-Restore Component Routines</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SettingsContainerFormatandGuidelines">Settings Container Format and Guidelines</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-RegisteringMovieDataExportComponents">Registering Movie Data Export Components</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ExportRegistrationMechanism">Export Registration Mechanism</a>
				
			<br/>
			
        
			
			
				<a href="7CreatingaMovieDataE.html#//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImplementingMovieDataExportComponents">Implementing Movie Data Export Components</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImportingMovieData" title="Importing Movie Data"></a>
<h2>Importing Movie Data</h2>
<p>Movie data import components may provide one or two functions that allow the Movie Toolbox to request a data conversion operation. The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportHandle" target="_top">MovieImportHandle</a></code> function instructs your component to retrieve the data that is to be imported from a specified handle. The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportFile" target="_top">MovieImportFile</a></code> function instructs you to retrieve the data from a file. You should set the appropriate flags in your component’s <code>componentFlags</code> field to indicate which of these functions your component supports. Note that your component may support both functions.</p>
<p>Before the Movie Toolbox calls one of these functions, a requesting application may call one or more of your component’s configuration functions (see <span class="content_text"><a href="../H-Chapter/8UsingMovieDataExcha.html#//apple_ref/doc/uid/TP40000903-UsingMovieDataExchangeComponents-ConfiguringMovieDataImportComponents">“Configuring Movie Data Import Components”</a></span> for more information about these functions). However, your component should work properly even if none of these configuration functions is called.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ExportingMovieData" title="Exporting Movie Data"></a>
<h2>Exporting Movie Data</h2>
<p>Movie data export components may provide one or two functions that allow the Movie Toolbox to request a data conversion operation. The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToHandle" target="_top">MovieExportToHandle</a></code> function instructs your component to place the converted data into a specified handle. The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToFile" target="_top">MovieExportToFile</a></code> function instructs you to put the data into a file. You should set the appropriate flags in your component’s <code>componentFlags</code> field to indicate which of these functions your component supports. Note that your component may support both functions.</p>
<p>Before the Movie Toolbox calls one of these functions, a requesting application may call one or more of your component’s configuration functions (see <span class="content_text"><a href="../H-Chapter/8UsingMovieDataExcha.html#//apple_ref/doc/uid/TP40000903-UsingMovieDataExchangeComponents-ConfiguringMovieDataExportComponents">“Configuring Movie Data Export Components”</a></span> for more information about these functions). However, your component should work properly even if none of these configuration functions is called.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SummaryofConstants" title="Summary of Constants"></a>
<h2>Summary of Constants</h2>

<div class="codesample"><table><tr><td scope="row"><pre>/* component type values */<span></span></pre></td></tr><tr><td scope="row"><pre>#define MovieImportType                   'eat '    /* movie data import */<span></span></pre></td></tr><tr><td scope="row"><pre>#define MovieExportType                   'spit'    /* movie data export */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*  componentFlags values for movie import and movie export components */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    canMovieImportHandles                = 1,    /* can import from handles */<span></span></pre></td></tr><tr><td scope="row"><pre>    canMovieImportFiles                  = 2,    /* can import from files */<span></span></pre></td></tr><tr><td scope="row"><pre>    hasMovieImportUserInterface          = 4,    /* import has user interface */<span></span></pre></td></tr><tr><td scope="row"><pre>    canMovieExportHandles                = 8,    /* can export to handles */<span></span></pre></td></tr><tr><td scope="row"><pre>    canMovieExportFiles                  = 16,   /* can export to files */<span></span></pre></td></tr><tr><td scope="row"><pre>    hasMovieExportUserInterface          = 32,   /* export has user interface */<span></span></pre></td></tr><tr><td scope="row"><pre>    dontAutoFileMovieImport              = 64    /* do not automatically<span></span></pre></td></tr><tr><td scope="row"><pre>                                                      import movie files */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/*  flags for MovieImportHandle and MovieImportFile */<span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    movieImportCreateTrack                 = 1,    /* create a new track */<span></span></pre></td></tr><tr><td scope="row"><pre>    movieImportInParallel                  = 2,    /* paste imported data */<span></span></pre></td></tr><tr><td scope="row"><pre>    movieImportMustUseTrack                = 4     /* use specified track */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    movieImportResultUsedMultipleTracks    = 8,    /* component used<span></span></pre></td></tr><tr><td scope="row"><pre>                                                      several tracks */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    /* movie data import components */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportHandleSelect                = 1,  /* import from handle */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportFileSelect                  = 2,  /* import from file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetSampleDurationSelect     = 3,  /* set sample duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetSampleDescriptionSelect  = 4,  /* set sample description */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetMediaFileSelect          = 5,  /* set media file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetDimensionsSelect         = 6,  /* set track dimensions */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetChunkSizeSelect          = 7,  /* set chunk size */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetProgressProcSelect       = 8,  /* set progress func */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetAuxiliaryDataSelect      = 9,  /* set additional data */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetFromScrapSelect          = 10, /* data from scrap */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportDoUserDialogSelect          = 11, /* invoke user dialog */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieImportSetDurationSelect           = 12  /* set paste duration */<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    /* movie data export components */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportToHandleSelect             = 128,  /* export to handle */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportToFileSelect               = 129,  /* export to file */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportDoUserDialogSelect         = 130,  /* invoke user dialog */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportGetAuxiliaryDataSelect     = 131,  /* get additional data */<span></span></pre></td></tr><tr><td scope="row"><pre>    kMovieExportSetProgressProcSelect      = 132   /* set progress function */<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ResultCodes" title="Result Codes"></a>
<h2>Result Codes</h2>
<div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5">

<tr>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Constant</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th>
<th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th>
</tr>


<tr>
<td  scope="row"><p><code>invalidTrack</code></p></td>
<td ><p>-2009</p></td>
<td ><p>Specified track cannot receive imported data</p></td>
</tr>
<tr>
<td  scope="row"><p><code>unsupportedAuxiliaryImportData</code></p></td>
<td ><p>-2057</p></td>
<td ><p>Cannot work with specified handle type</p></td>
</tr>
<tr>
<td  scope="row"><p><code>badComponentSelector</code></p></td>
<td ><p>0x80008002</p></td>
<td ><p>Function not supported</p></td>
</tr>

</table></div>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ASampleMovieImportComponent" title="A Sample Movie Import Component"></a>
<h2>A Sample Movie Import Component</h2>
<p>This section describes how to create a movie import component. First, you implement the required functions. Then, you instruct your component to obtain the movie data from a handle or a file. This section supplies a sample program that implements a movie data exchange component that imports a Scrapbook file containing QuickDraw PICT images.</p>
<p>Your movie data import component may provide a user dialog box. You may use this dialog box in any way that is appropriate for your component; for example, to obtain certain parameter information governing the import operation, such as the image-compression method.</p>
<p>In addition, the requesting application may use one or more of the configuration functions to establish parameters for the import operation.</p>
<p>You should not rely on any outside configuration information. Your component should work properly knowing only the source data and the target movie. The Movie Toolbox supplies this information to your component when it calls your <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportHandle" target="_top">MovieImportHandle</a></code> function or <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportFile" target="_top">MovieImportFile</a></code> function.</p>
<p>Your movie data import component may implement either one or both of these functions, which allow the Movie Toolbox to request that data be converted into a format for use in a QuickTime movie.</p>
<p>If the data is to be imported from a handle, the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportHandle" target="_top">MovieImportHandle</a></code> function is used.</p>
<p>If data is to be imported from a file, the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportFile" target="_top">MovieImportFile</a></code> function is used.</p>
<p>Set the appropriate flags in your component’s <code>componentFlags</code> field to indicate which of these functions your component supports. Note that your component may support both functions.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImplementingtheRequiredImportComponentFunctions" title="Implementing the Required Import Component Functions"></a>
<h2>Implementing the Required Import Component Functions</h2>
<p>Listing 6-1 supplies a sample program that implements a movie data exchange component that imports a Scrapbook file containing QuickDraw PICT images. The sample program also provides the dispatchers for the movie import component together with the required functions.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_32" title="Listing 6-1Implementing the required import functions"></a>
<p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>Implementing the required import functions</p>
<div class="codesample"><table><tr><td scope="row"><pre>#define kMediaTimeScale 600<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentInstance       self<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue               frameDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>} ImportScrapbookGlobalsRecord, **ImportScrapbookGlobals;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* entry point for all Component Manager requests */<span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookDispatcher (ComponentParameters *params,<span></span></pre></td></tr><tr><td scope="row"><pre>        Handle storage)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = badComponentSelector;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentFunction componentProc = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (params->what) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookOpen; break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookClose; break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookCanDo; break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookVersion; break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieImportFileSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookFile; break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieImportSetSampleDurationSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ImportScrapbookSetSampleDuration; break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (componentProc)<span></span></pre></td></tr><tr><td scope="row"><pre>        err = CallComponentFunctionWithStorage (storage,<span></span></pre></td></tr><tr><td scope="row"><pre>     params,<span></span></pre></td></tr><tr><td scope="row"><pre>          componentProc);<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookCanDo<span></span></pre></td></tr><tr><td scope="row"><pre>                 (ImportScrapbookGlobals storage, short ftnNumber)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (ftnNumber) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieImportFileSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieImportSetSampleDurationSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            return true;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            return false;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookVersion<span></span></pre></td></tr><tr><td scope="row"><pre>                                        (ImportScrapbookGlobals storage)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0x00010001;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookOpen<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (ImportScrapbookGlobals storage,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    storage = (ImportScrapbookGlobals) NewHandleClear<span></span></pre></td></tr><tr><td scope="row"><pre>                            (sizeof (ImportScrapbookGlobalsRecord));<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!storage) return MemError();<span></span></pre></td></tr><tr><td scope="row"><pre>    (**storage).self = self;<span></span></pre></td></tr><tr><td scope="row"><pre>    SetComponentInstanceStorage (self, (Handle)storage);<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookClose<span></span></pre></td></tr><tr><td scope="row"><pre>                                         (ImportScrapbookGlobals storage,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (storage) DisposeHandle((Handle)storage);<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImportingaScrapbookFile" title="Importing a Scrapbook File"></a>
<h3>Importing a Scrapbook File</h3>
<p>Before the import operation begins, the client may set the duration of samples to be added by the movie data import component by calling the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetDuration" target="_top">MovieImportSetDuration</a></code> function.</p>
<p>The <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportFile" target="_top">MovieImportFile</a></code> function performs the import operation. The tasks involved in importing the data include</p>
<ul class="spaceabove">
<li class="li"><p>opening the source file</p></li>
<li class="li"><p>retrieving the first sample in order to determine the track dimension</p></li>
<li class="li"><p>creating a new track and media</p></li>
<li class="li"><p>determining the frame duration</p></li>
<li class="li"><p>setting up a sample description structure</p></li>
<li class="li"><p>cycling through all the frames in the Scrapbook and adding them to the new media</p></li>
<li class="li"><p>adding the new media to the track</p></li>
<li class="li"><p>closing the source file</p></li>
</ul>
<p>Listing 6-2 supplies an example in which a Scrapbook file is imported.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_33" title="Listing 6-2Importing a Scrapbook file"></a>
<p class="codesample"><strong>Listing 6-2&nbsp;&nbsp;</strong>Importing a Scrapbook file</p>
<div class="codesample"><table><tr><td scope="row"><pre>/* If this function is called, it provides a hint from the caller as to the<span></span></pre></td></tr><tr><td scope="row"><pre>desired sample (frame) duration in the new media */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookSetSampleDuration<span></span></pre></td></tr><tr><td scope="row"><pre>                                         (ImportScrapbookGlobals storage,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            TimeValue duration,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            TimeScale scale)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeRecord tr;<span></span></pre></td></tr><tr><td scope="row"><pre>    tr.value.lo = duration;<span></span></pre></td></tr><tr><td scope="row"><pre>    tr.value.hi = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    tr.scale = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    tr.base = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    ConvertTimeScale (&amp;tr, kMediaTimeScale);<span></span></pre></td></tr><tr><td scope="row"><pre>                    /* your new media will have a time scale of 600 */<span></span></pre></td></tr><tr><td scope="row"><pre>    (**storage).frameDuration = tr.value.lo;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ImportScrapbookFile<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (ImportScrapbookGlobals storage,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     FSSpec *theFile, Movie theMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     Track targetTrack, Track *usedTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     TimeValue atTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     TimeValue *addedTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     long inFlags, long *outFlags)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    short resRef = 0, saveRes = CurResFile();<span></span></pre></td></tr><tr><td scope="row"><pre>    PicHandle thePict;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect trackRect;<span></span></pre></td></tr><tr><td scope="row"><pre>    short pageIndex = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track newTrack = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media newMedia;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean endMediaEdits = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue frameDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    SampleDescriptionHandle sampleDesc = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    *outFlags = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (inFlags &amp; movieImportMustUseTrack)<span></span></pre></td></tr><tr><td scope="row"><pre>        return invalidTrack;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* open source file */<span></span></pre></td></tr><tr><td scope="row"><pre>    resRef = FSpOpenResFile (theFile, fsRdPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = ResError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    UseResFile(resRef);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* get the first PICT to determine the track size */<span></span></pre></td></tr><tr><td scope="row"><pre>    thePict = (PicHandle)Get1IndResource ('PICT', 1);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!thePict) {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = ResError();<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    trackRect = (**thePict).picFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>    OffsetRect(&amp;trackRect, -trackRect.left, -trackRect.top);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* create a track and PICT media */<span></span></pre></td></tr><tr><td scope="row"><pre>    newTrack = NewMovieTrack (theMovie, trackRect.right &lt;&lt; 16,<span></span></pre></td></tr><tr><td scope="row"><pre>                                     trackRect.bottom &lt;&lt; 16, kNoVolume);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = GetMoviesError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    newMedia = NewTrackMedia (newTrack, 'PICT', kMediaTimeScale, nil, 0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = GetMoviesError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = BeginMediaEdits (newMedia)) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    endMediaEdits = true;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* determine the frame duration (check the hint you may<span></span></pre></td></tr><tr><td scope="row"><pre>        have been called with) */<span></span></pre></td></tr><tr><td scope="row"><pre>    frameDuration = (**storage).frameDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!frameDuration) frameDuration = kMediaTimeScale/5;<span></span></pre></td></tr><tr><td scope="row"><pre>                                        /* default is 1/5th second */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* set up a simple sample description */<span></span></pre></td></tr><tr><td scope="row"><pre>    sampleDesc = (SampleDescriptionHandle) NewHandleClear<span></span></pre></td></tr><tr><td scope="row"><pre>                                            (sizeof (SampleDescription));<span></span></pre></td></tr><tr><td scope="row"><pre>    (**sampleDesc).descSize = sizeof(SampleDescription);<span></span></pre></td></tr><tr><td scope="row"><pre>    (**sampleDesc).dataFormat = 'PICT';<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* cycle through all source frames and add them to the media */<span></span></pre></td></tr><tr><td scope="row"><pre>    do {<span></span></pre></td></tr><tr><td scope="row"><pre>        Handle thePict;<span></span></pre></td></tr><tr><td scope="row"><pre>        short resID = pageToMapIndex (++pageIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>                                      *GetResource ('SMAP', 0));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (resID == 0) break;<span></span></pre></td></tr><tr><td scope="row"><pre>        thePict = Get1Resource ('PICT', resID);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (thePict == nil) continue;           /* some pages may not<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    contain a 'PICT' */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = AddMediaSample(newMedia, thePict, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    GetHandleSize (thePict),<span></span></pre></td></tr><tr><td scope="row"><pre>                                     frameDuration, sampleDesc, 1, 0, nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        ReleaseResource (thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle (thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>    } while (!err);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* add the new media to the track */<span></span></pre></td></tr><tr><td scope="row"><pre>    err = InsertMediaIntoTrack (newTrack, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                GetMediaDuration (newMedia), kFix1);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (resRef) CloseResFile (resRef);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (endMediaEdits) EndMediaEdits (newMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err &amp;&amp; newTrack) {<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeMovieTrack (newTrack);<span></span></pre></td></tr><tr><td scope="row"><pre>        newTrack = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    UseResFile (saveRes);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sampleDesc) DisposeHandle ((Handle)sampleDesc);<span></span></pre></td></tr><tr><td scope="row"><pre>    *usedTrack = newTrack;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* map from a Scrapbook page number to a resource ID */<span></span></pre></td></tr><tr><td scope="row"><pre>short pageToMapIndex (short page, Ptr map)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short mapIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    for (mapIndex = 0; mapIndex &lt; 256; mapIndex++)<span></span></pre></td></tr><tr><td scope="row"><pre>        if (*map++ == page)<span></span></pre></td></tr><tr><td scope="row"><pre>            return mapIndex | 0x8000;<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ASampleMovieExportComponent" title="A Sample Movie Export Component"></a>
<h2>A Sample Movie Export Component</h2>
<p>As with movie data import components, the movie data export component should not rely on any configuration information beyond that which is supplied by the Movie Toolbox when it calls the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToHandle" target="_top">MovieExportToHandle</a></code> or <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToFile" target="_top">MovieExportToFile</a></code> function, respectively.</p>
<p>This section provides an implementation of a movie data exchange component that exports a movie or movie’s track to a PICS animation file.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImplementingtheRequiredExportComponentFunctions" title="Implementing the Required Export Component Functions"></a>
<h3>Implementing the Required Export Component Functions</h3>
<p>Listing 6-3 provides the component dispatchers for the movie export component together with the required functions.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_34" title="Listing 6-3Implementing the required export functions"></a>
<p class="codesample"><strong>Listing 6-3&nbsp;&nbsp;</strong>Implementing the required export functions</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct {<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentInstance self;<span></span></pre></td></tr><tr><td scope="row"><pre>} ExportPICSGlobalsRecord, *ExportPICSGlobals;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/* entry point for all Component Manager requests */<span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ExportPICSDispatcher<span></span></pre></td></tr><tr><td scope="row"><pre>                                        (ComponentParameters *params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                         Handle storage)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = badComponentSelector;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentFunction componentProc = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (params->what) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ExportPICSOpen; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ExportPICSClose; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ExportPICSCanDo; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ExportPICSVersion; break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieExportToFileSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            componentProc = ExportPICSToFile; break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (componentProc)<span></span></pre></td></tr><tr><td scope="row"><pre>        err = CallComponentFunctionWithStorage (storage, params,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                componentProc);<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ExportPICSCanDo (ExportPICSGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                     short ftnNumber)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    switch (ftnNumber) {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentOpenSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCloseSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentCanDoSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kComponentVersionSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>        case kMovieExportToFileSelect:<span></span></pre></td></tr><tr><td scope="row"><pre>            return true;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:<span></span></pre></td></tr><tr><td scope="row"><pre>            return false;<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ExportPICSVersion (ExportPICSGlobals store)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0x00010001;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ExportPICSOpen (ExportPICSGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                     ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    store = (ExportPICSGlobals) NewPtrClear<span></span></pre></td></tr><tr><td scope="row"><pre>                (sizeof(ExportPICSGlobalsRecord));<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = MemError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    store->self = self;<span></span></pre></td></tr><tr><td scope="row"><pre>    SetComponentInstanceStorage(self, (Handle)store);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal ComponentResult ExportPICSClose (ExportPICSGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                        ComponentInstance self)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (store) DisposPtr((Ptr)store);<span></span></pre></td></tr><tr><td scope="row"><pre>    return noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>


<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ExportingDatatoaPICSFile" title="Exporting Data to a PICS File"></a>
<h3>Exporting Data to a PICS File</h3>
<p>To export data to a PICS file, your component must allow the Movie Toolbox to call the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToFile" target="_top">MovieExportToFile</a></code> function in order to export movie data into a file read the data from the track or movie perform appropriate conversions on that data place the data into the specified file (the file’s type corresponds to the component subtype of your movie data export component)</p>
<p>Listing 6-4 provides an implementation of these tasks in a movie export component. The <code></code></p>
<p>ExportPICSToFile function performs the export operation by opening the resource fork of the PICS file and cycling through the movie time segment, adding a frame to the PICS file.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_35" title="Listing 6-4Exporting a frame of movie data to a PICS file"></a>
<p class="codesample"><strong>Listing 6-4&nbsp;&nbsp;</strong>Exporting a frame of movie data to a PICS file</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult ExportPICSToFile (ExportPICSGlobals store,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        const FSSpec *theFile,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        Movie m,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        Track onlyThisTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        TimeValue startTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        TimeValue duration)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    short resRef = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    short saveResRef = CurResFile();<span></span></pre></td></tr><tr><td scope="row"><pre>    short resID = 128;<span></span></pre></td></tr><tr><td scope="row"><pre>    PicHandle thePict = nil;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* open the resource fork of the PICS file<span></span></pre></td></tr><tr><td scope="row"><pre>        (the caller is responsible for creating the file) */<span></span></pre></td></tr><tr><td scope="row"><pre>    resRef = FSpOpenResFile (theFile, fsRdWrPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (err = ResError()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    UseResFile(resRef);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* cycle through the movie time segment you were given */<span></span></pre></td></tr><tr><td scope="row"><pre>    while (startTime &lt; duration) {<span></span></pre></td></tr><tr><td scope="row"><pre>        Byte c = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (onlyThisTrack)<span></span></pre></td></tr><tr><td scope="row"><pre>            thePict = GetTrackPict (onlyThisTrack, startTime);<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>            thePict = GetMoviePict(m, startTime);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (!thePict) continue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* add a frame to the PICS file */<span></span></pre></td></tr><tr><td scope="row"><pre>        AddResource ((Handle)thePict, 'PICT', resID++, &amp;c);<span></span></pre></td></tr><tr><td scope="row"><pre>        err = ResError();<span></span></pre></td></tr><tr><td scope="row"><pre>        WriteResource ((Handle)thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>        DetachResource ((Handle)thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>        KillPicture (thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>        thePict = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (err) break;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        /* find the time of the next frame */<span></span></pre></td></tr><tr><td scope="row"><pre>        do {<span></span></pre></td></tr><tr><td scope="row"><pre>            TimeValue nextTime;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (onlyThisTrack)<span></span></pre></td></tr><tr><td scope="row"><pre>                GetTrackNextInterestingTime (onlyThisTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             nextTimeMediaSample, startTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                             kFix1, &amp;nextTime, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>            else {<span></span></pre></td></tr><tr><td scope="row"><pre>                OSType mediaType = VisualMediaCharacteristic;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                GetMovieNextInterestingTime (m, nextTimeMediaSample,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        1, &amp;mediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        startTime, kFix1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                        &amp;nextTime, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            if (GetMoviesError ()) goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (nextTime != startTime) {<span></span></pre></td></tr><tr><td scope="row"><pre>                startTime = nextTime;<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        } while (++startTime &lt; duration);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (thePict) KillPicture (thePict);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (resRef) CloseResFile (resRef);<span></span></pre></td></tr><tr><td scope="row"><pre>    UseResFile (saveResRef);<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>



<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SaveandRestoreComponentRoutines" title="Save-and-Restore Component Routines"></a>
<h2>Save-and-Restore Component Routines</h2>
<p>If you are writing movie data exchange components, and would like your components' settings to be saved and restored, you need to implement two additional component routines in order to allow your components to have their settings saved and restored. A component’s settings are stored in a QuickTime QT atom container. The data stored in the QT atom container is private to the particular component but should be stored so that it is possible to read the data on all platforms supported by QuickTime, thus allowing the same settings to be used anywhere.</p>
<p>For each type of movie data exchange component, there is one routine to return a QT atom container holding the settings and another routine to configure the component from previously-saved settings. For more information about QT atom containers, see <em><a href="../../../MovieBasics/MTEditing/index.html#//apple_ref/doc/uid/TP40000908" target="_top">QuickTime Movie Basics</a></em>.</p>
<p>Import component developers need to implement the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportGetSettingsAsAtomContainer" target="_top">MovieImportGetSettingsAsAtomContainer</a></code> and <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetSettingsFromAtomContainer" target="_top">MovieImportSetSettingsFromAtomContainer</a></code> routines. For <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportGetSettingsAsAtomContainer" target="_top">MovieImportGetSettingsAsAtomContainer</a></code>, the component should allocate a new QT atom container, stuff current settings into it, and return it to the caller. For <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetSettingsFromAtomContainer" target="_top">MovieImportSetSettingsFromAtomContainer</a></code>, the component should accept a QT atom container, extract the settings in which it is interested, and change its internal state.</p>
<p>Export component developers need to implement the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportGetSettingsAsAtomContainer" target="_top">MovieExportGetSettingsAsAtomContainer</a></code> and <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportSetSettingsFromAtomContainer" target="_top">MovieExportSetSettingsFromAtomContainer</a></code> routines. Like import components, the component’s <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportGetSettingsAsAtomContainer" target="_top">MovieExportGetSettingsAsAtomContainer</a></code> routine allocates and returns a QT atom container holding the component’s settings. For <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportSetSettingsFromAtomContainer" target="_top">MovieExportSetSettingsFromAtomContainer</a></code>, the component accepts a QT atom container, extracts the settings, and updates its internal state.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-SettingsContainerFormatandGuidelines" title="Settings Container Format and Guidelines"></a>
<h2>Settings Container Format and Guidelines</h2>
<p>The particular atoms stored within the component’s settings QT atom container are private to that component type. However, there are some guidelines that need to be followed. These include:</p>
<p>In all <code>SetSettingsFromAtomContainer</code> routines, the QT atom container belongs to the caller. The component should not dispose of the passed QT atom container.</p>
<p>The settings QT atom container should contain one or more top-level atoms. These top-level atoms can contain either leaf data or other atoms. Each atom has both a type (<code>QTAtomType)</code> and an ID. Choosing an atom type that is mnemonic is helpful in indicating how it is used. For example, QuickTime stores video compression settings in atoms of type <code><!--a target="_top" -->'vide'<!--/a--></code>. Sound compression settings are stored in <code>'soun'</code> atoms. The text components use <code>'text'</code> for their atom types.</p>
<p>Several of QuickTime’s export components use the standard compression component to allow the user to configure compression settings for exported files. When one of these components is asked to return its settings atom container, the export component first requests that the standard compression component return its settings using the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCGetSettingsAsAtomContainer" target="_top">SCGetSettingsAsAtomContainer</a></code> function described above. To the QT atom container it receives, the export component adds any of its own settings. When the export component’s <code>SetSettingsFromAtomContainer</code> is called, the exporter calls <code></code></p>
<p><code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/SCSetSettingsFromAtomContainer" target="_top">SCSetSettingsFromAtomContainer</a></code> with the passed atom container. The standard compression component extracts only those settings it expects, ignoring all other, and configures itself. The exporter then looks for its own settings in the same atom container and configures itself.</p>
<p>This is possible because the standard compression and data exchange components both use QT atom containers to hold their settings. Because many third-party developers do the same, there must be a mechanism so that QuickTime’s own top-level atom types and those of third parties don’t collide. To achieve this, Apple Computer reserves all top-level atom types consisting exclusively of lowercase letters with or without numerals. For example, <code><!--a target="_top" -->'vide'<!--/a--></code> is reserved by Apple, but <code>'Vide'</code> is not. There is no restriction on the atom types for atoms stored within these top-level atoms.</p>
<p>Apple recommends that you store all of your component settings under a single top-level atom. However, there is no requirement to do so.</p>
<p>The data within an atom should be stored in a canonical form on all platforms. It should be always in big-endian format or always in little-endian format. Different types of atoms can be stored in different endian orders but for a single type of atom, it should always use the same order. This allows the settings to be created in the Mac OS and read in Windows or vice-versa.</p>
<p>In either <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieImportSetSettingsFromAtomContainer" target="_top">MovieImportSetSettingsFromAtomContainer</a></code> or <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportSetSettingsFromAtomContainer" target="_top">MovieExportSetSettingsFromAtomContainer</a></code>, you should not necessarily expect all atoms to be included in the atom container you receive. This allows another developer, for example, to create a settings atom container, add atoms and data for only those parts of the settings that should be changed, and then pass this incomplete atom container to the component. The component then only changes those particular settings, leaving other settings alone. QuickTime’s own components use this approach.</p>
<p>If <code>nil</code> is passed for the settings to the component routines, return <code>paramErr</code>.</p>
<p>If your component does not have configurable settings, you do not need to implement the settings-related routines.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-RegisteringMovieDataExportComponents" title="Registering Movie Data Export Components"></a>
<h2>Registering Movie Data Export Components</h2>
<p>QuickTime allows more than one export (<code>'spit')</code> component to be registered for the same type of file and the same export source (the movie or the particular track type). This is accomplished in a way that preserves compatibility with third-party components that may have already been written using the former rules.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-TheRegistrationMechanism" title="The Registration Mechanism"></a>
<h3>The Registration Mechanism</h3>
<p>QuickTime provides a movie export component routine that returns the same information that would have been previously stored in the <code>componentManufacturer</code> field of the registered <code>'spit'</code> components. An export-specific component flag indicates that the export component implements the new protocol. By implementing the routine, the export component’s <code>componentManufacturer</code> field can be used to differentiate components.</p>
<p>The routine is <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportGetSourceMediaType" target="_top">MovieExportGetSourceMediaType</a></code>. This routine returns an <code>OSType</code> value through its <code>mediaType</code> parameter, which is interpreted in exactly the same way that the <code>componentManufacturer</code> was previously interpreted. If the export component requires a particular type of track to exist in a movie, it returns that media handler type (e.g., <code>VideoMediaType</code>, <code>SoundMediaType</code>, etc.) through the <code>mediaType</code> argument. If the export component works for an entire movie, it returns 0 through this parameter.</p>

<div class="codesample"><table><tr><td scope="row"><pre>EXTERN_API( ComponentResult )<span></span></pre></td></tr><tr><td scope="row"><pre>MovieExportGetSourceMediaType (MovieExportComponent  ci, OSType * mediaType);<span></span></pre></td></tr></table></div>

<p>The following component flag indicates that this routine is implemented:</p>

<div class="codesample"><table><tr><td scope="row"><pre>movieExportMustGetSourceMediaType = 1L &lt;&lt; 19,<span></span></pre></td></tr></table></div>

<p>If you implement the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportGetSourceMediaType" target="_top">MovieExportGetSourceMediaType</a></code> routine, you must register the component with this flag. Otherwise, the Movie Toolbox will not know to call the routine and will assume the older semantics for the <code>componentManufacturer</code> field.</p>
<p>Using this mechanism does not replace the need for implementing <code>Validate</code> in your export components. The mechanism is only used to find candidate components.</p>


<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ExportRegistrationMechanism" title="Export Registration Mechanism"></a>
<h2>Export Registration Mechanism</h2>
<p>Both the Movie and the DVC export components use the export registration mechanism. The components are registered as shown below.</p>

<div class="codesample"><table><tr><td scope="row"><pre>componentType  'spit'<span></span></pre></td></tr><tr><td scope="row"><pre>componentSubType  'MooV'<span></span></pre></td></tr><tr><td scope="row"><pre>componentManufacturer  'appl'<span></span></pre></td></tr><tr><td scope="row"><pre>componentFlags  canMovieExportFiles  + canMovieExportFromProcedures  +<span></span></pre></td></tr><tr><td scope="row"><pre>                hasMovieExportUserInterface   + canMovieExportValidateMovie<span></span></pre></td></tr><tr><td scope="row"><pre>                + movieExportMustGetSourceMediaType<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>componentType 'spit'<span></span></pre></td></tr><tr><td scope="row"><pre>componentSubType   'dvc!'<span></span></pre></td></tr><tr><td scope="row"><pre>componentManufacturer 'appl'<span></span></pre></td></tr><tr><td scope="row"><pre>componentFlags  canMovieExportFiles  + canMovieExportFromProcedures<span></span></pre></td></tr><tr><td scope="row"><pre>                + hasMovieExportUserInterface  + canMovieExportValidateMovie<span></span></pre></td></tr><tr><td scope="row"><pre>                + movieExportMustGetSourceMediaType<span></span></pre></td></tr></table></div>

<p>Because the DVC component uses the QuickTime Movie export component, it searches for the 'MooV' exporter, using the following <code><!--a target="_top" -->ComponentDescription<!--/a--></code> values:</p>

<div class="codesample"><table><tr><td scope="row"><pre>cd.componentType = 'spit';<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentSubType = MovieFileType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentManufacturer = 'appl';<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlags = canMovieExportFromProcedures<span></span></pre></td></tr><tr><td scope="row"><pre>                    + movieExportMustGetSourceMediaType;<span></span></pre></td></tr><tr><td scope="row"><pre>cd.componentFlagsMask = cd.componentFlags;<span></span></pre></td></tr></table></div>

<p>If you are working with export components (either writing them, or trying to enumerate or otherwise match up components with source media types) you need to understand this registration mechanism.</p>

<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-ImplementingMovieDataExportComponents" title="Implementing Movie Data Export Components"></a>
<h2>Implementing Movie Data Export Components</h2>
<p>You can implement a movie data export component by calling the <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> function.</p>
<p>Because many existing applications expect to be able to perform an export operation from a movie or track, export components should support <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToFile" target="_top">MovieExportToFile</a></code>, <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code> and <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToDataRef" target="_top">MovieExportToDataRef</a></code>.</p>
<p>Listing 6-5 shows how to implement <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToFile" target="_top">MovieExportToFile</a></code> so that it simply calls <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToDataRef" target="_top">MovieExportToDataRef</a></code>.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_36" title="Listing 6-5Calling MovieExportToDataRef from MovieExportToFile"></a>
<p class="codesample"><strong>Listing 6-5&nbsp;&nbsp;</strong>Calling MovieExportToDataRef from MovieExportToFile</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult MovieExportToFile(Globals store, const FSSpec *theFile, Movie m, Track onlyThisTrack, TimeValue startTime, TimeValue duration) { ComponentResult err;<span></span></pre></td></tr><tr><td scope="row"><pre>     AliasHandle alias;<span></span></pre></td></tr><tr><td scope="row"><pre>     err = QTNewAlias (theFile, &amp;alias, true);<span></span></pre></td></tr><tr><td scope="row"><pre>     err = MovieExportToDataRef(store->self, (Handle)alias, rAliasType, m, onlyThisTrack, startTime,<span></span></pre></td></tr><tr><td scope="row"><pre>           duration);<span></span></pre></td></tr><tr><td scope="row"><pre>     DisposeHandle((Handle)alias); }<span></span></pre></td></tr></table></div>

<p>Listing 6-6 shows how to use the utility routines provided by the QuickTime movie data export component to implement <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportToDataRef" target="_top">MovieExportToDataRef</a></code> by calling <code><a href="../../../../Reference/QTRef_MovieComponents/Reference/reference.html#//apple_ref/c/func/MovieExportFromProceduresToDataRef" target="_top">MovieExportFromProceduresToDataRef</a></code>. Your implementation may differ, depending on the types of data to be exported. For example, the number and type of data sources created may change. This example creates a single sound data source, and is appropriate for any movie data export component that exports audio only.</p>
<a name="//apple_ref/doc/uid/TP40000903-CreatingaMovieDataExchangeComponent-DontLinkElementID_37" title="Listing 6-6Calling MovieExportFromProceduresToDataRef from MovieExportToDataRef"></a>
<p class="codesample"><strong>Listing 6-6&nbsp;&nbsp;</strong>Calling MovieExportFromProceduresToDataRef from MovieExportToDataRef</p>
<div class="codesample"><table><tr><td scope="row"><pre>pascal ComponentResult MovieExportToDataRef(Globals store, Handle dataRef,<span></span></pre></td></tr><tr><td scope="row"><pre>  OSType dataRefType, Movie m, Track onlyThisTrack, TimeValue startTime,<span></span></pre></td></tr><tr><td scope="row"><pre>  TimeValue duration) {<span></span></pre></td></tr><tr><td scope="row"><pre>     ComponentResult err;<span></span></pre></td></tr><tr><td scope="row"><pre>     ComponentDescription cd;<span></span></pre></td></tr><tr><td scope="row"><pre>     ComponentInstance ci;<span></span></pre></td></tr><tr><td scope="row"><pre>     TimeScale scale;<span></span></pre></td></tr><tr><td scope="row"><pre>     MovieExportGetPropertyUPP getPropertyProc = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>     MovieExportGetDataUPP getDataProc = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>     void *refCon;<span></span></pre></td></tr><tr><td scope="row"><pre>     long trackID;<span></span></pre></td></tr><tr><td scope="row"><pre>     cd.componentType = MovieExportType;<span></span></pre></td></tr><tr><td scope="row"><pre>     cd.componentSubType = 'MooV';<span></span></pre></td></tr><tr><td scope="row"><pre>     cd.componentManufacturer = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>     cd.componentFlags = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>     cd.componentFlagsMask = canMovieExportFromProcedures;<span></span></pre></td></tr><tr><td scope="row"><pre>     err = OpenAComponent(FindNextComponent(nil, &amp;cd), &amp;ci);<span></span></pre></td></tr><tr><td scope="row"><pre>     err = MovieExportNewGetDataAndPropertiesProcs(ci, SoundMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>           &amp;scale, m, onlyThisTrack,  startTime, duration, &amp;getPropertyProc,<span></span></pre></td></tr><tr><td scope="row"><pre>           &amp;getDataProc, &amp;refCon);<span></span></pre></td></tr><tr><td scope="row"><pre>     err = MovieExportAddDataSource(store->self, SoundMediaType, scale,<span></span></pre></td></tr><tr><td scope="row"><pre>           &amp;trackID, getPropertyProc, getDataProc, refCon);<span></span></pre></td></tr><tr><td scope="row"><pre>     err = MovieExportFromProceduresToDataRef(store->self, dataRef, dataRefType);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

<p>The code in Listing 6-6 retrieves default property and data procedures, instead of providing them, by using the QuickTime Movie export component. It also must dispose of these procedures. They take care of interpreting the tracks and returning media properties and data.</p>




        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../F-Chapter/6MovieDataExchangeCo.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../H-Chapter/8UsingMovieDataExcha.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-01-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/RM/ImportExport/DataExchange/G-Chapter/7CreatingaMovieDataE.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/RM/ImportExport/DataExchange/G-Chapter/7CreatingaMovieDataE.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/RM/ImportExport/DataExchange/G-Chapter/7CreatingaMovieDataE.html%3Fid%3DTP40000903-3.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>