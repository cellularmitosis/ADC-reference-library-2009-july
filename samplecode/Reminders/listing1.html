<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Reminders - /ReadMe.txt</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../index.html#//apple_ref/doc/uid/TP30000925" target="_top">Sample Code</a> &gt; <a href="../AppleApplications/index.html#//apple_ref/doc/uid/TP30000925-TP30000418" target="_top">Apple Applications</a> &gt; <a href="../AppleApplications/idxDashboard-date.html#//apple_ref/doc/uid/TP30000925-TP30000418-TP40001366">Dashboard</a> &gt; <A HREF="javascript:location.replace('index.html');">Reminders</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->


	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Reminders</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/ReadMe.txt</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/ReadMe.txt</option>
<option value="listing2.html">/Reminders.wdgt/Reminders.css</option>
<option value="listing3.html">/Reminders.wdgt/Reminders.html</option>
<option value="listing4.html">/Reminders.wdgt/Reminders.js</option>
<option value="listing5.html">/Reminders.wdgt/UserCalendarPreferences.js</option>
<option value="listing6.html">/RemindersPlugIn/CalendarItems.h</option>
<option value="listing7.html">/RemindersPlugIn/CalendarItems.m</option>
<option value="listing8.html">/RemindersPlugIn/NSColorHexadecimalValue.h</option>
<option value="listing9.html">/RemindersPlugIn/NSColorHexadecimalValue.m</option>
<option value="listing10.html">/RemindersPlugIn/RemindersPlugIn.h</option>
<option value="listing11.html">/RemindersPlugIn/RemindersPlugIn.m</option>
<option value="listing12.html">/RemindersPlugIn/RemindersPlugIn_Prefix.pch</option></select>
				</p>
				</form>
				<p><strong><a href="Reminders.zip">Download Sample</a></strong> (&#147;Reminders.zip&#148;, 349.1K)<BR>
<strong><a href="Reminders.dmg">Download Sample</a></strong> (&#147;Reminders.dmg&#148;, 324.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">Reminders illustrates how you can use a WebKit plug-in to extend the
functionality of a Dashboard widget. It also shows how to share complex data
from Objective-C to JavaScript, update and retrieve widget preferences, and call
JavaScript from a WebKit plug-in and vice versa.

It is a Dashboard widget that displays upcoming iCal events and to do items
occurring within the year. Users can see all events (starting now) and
incomplete tasks ending before the end of the year without launching iCal. All
iCal changes are instantly added to the widget. The widget shows the date and
title of each event or to do item, the start and end time of each event, and the
priority of each to do item. The &quot;all-day&quot; tag is used in lieu of start and end
time for events lasting all day long. Users are informed when there are no
available events, calendars, or to do items. 

Reminders displays data from multiple calendars at once. However, you can
choose to restrict your widget to some specific calendars. It contains a menu
bar that enables users to toggle between events and to do items. A set of
checkboxes, in the back of the widget, allows users to choose which calendars
should be seen in the widget. The widget saves and remembers the users&apos; calendar
preferences.  

Reminders uses the RemindersPlugIn plug-in to query the CalendarStore framework
for iCal events, to do items, and calendars. RemindersPlugIn is a Cocoa bundle
that provides data used by the widget through JavaScript callbacks; the
JavaScript enabled widget can access specific Objective-C methods [in the
plug-in] while the plug-in can call the widget&apos;s JavaScript functions. 


Using the sample 
1. Add some calendars, events, or to do items to iCal. For testing purposes,  
Reminders add a fictitious calendar with an event and to do item if your iCal
is empty. 

2. Click the Reminders.wdgt to install the widget and open it in Dashboard.

3. Toggle between the &quot;Events&quot; and &quot;To Do Items&quot; buttons to view events and to 
do items. Click the info button to switch to the back of the widget. Set your
calendar preferences by checking one or more calendars. Use the Done 
button to return to the front of the widget. 


Building the sample
This sample consists of a widget (Reminders) and plug-in (RemindersPlugIn).
Thus, building the sample consists of implementing RemindersPlugIn in Xcode and
creating Reminders in Dashcode.


Creating the plug-in RemindersPlugIn
In the steps below, we are going to create and set up RemindersPlugIn in Xcode,
then add classes to it.

Setting up the Project
This section shows how to create and set up RemindersPlugIn. 

1. Create a new Project
RemindersPlugIn is a Cocoa bundle. 
Open Xcode, choose File &gt; New Project and select Cocoa Bundle under Bundle in
the New Project Assistant window. Click Next and save the project as
RemindersPlugIn.


2. Add the WebKit and CalendarStore frameworks
Open the Frameworks and Libraries group in the Groups &amp; Files list of the
project window and then right-click or control-click the Linked Frameworks
subgroup. 
Choose Add &gt; Existing Frameworks from the pop-up menu and navigate to the 
/System/Library/Frameworks/ folder to select and add the WebKit.framework and
CalendarStore.framework to the project.


3. Add the minimum system version Info.plist key
This project uses the CalendarStore framework that is only available in Mac OS
X 10.5 and later. Set the LSMinimumSystemVersion to 10.5 so users can receive
notices informing them about the minimum system requirement when they attempt to
run the application on a system earlier than Mac OS X 10.5. 
Double-click the Info.plist file in the resource area of the project and copy
and paste the following lines into the file. 
    &lt;key&gt;LSMinimumSystemVersion&lt;/key&gt;
    &lt;string&gt;10.5&lt;/string&gt;


4. Set the Target SDK to Mac OS X 10.5
Double-click the RemindersPlugIn project icon in the Groups &amp; Files list  to
open the project info window. Go to the General tab and set the &quot;Cross-Develop
Using Target SDK&quot; to Mac OS X 10.5. 


5. Set the bundle identifier and principal class
The bundler identifier uniquely identifies your plug-in. The principal class
identifies the main class used to define your plug-in&apos;s functionality; its name
should be the same as the name of your project. 

Choose Project &gt; Edit Active Target &quot;RemindersPlugin&quot; and click the Properties
tab.
Fill out the identifier and principal class text fields with a bundle
identifier of your choice and RemindersPlugin, respectively.

Read the Code Loading Programming Topics for Cocoa &gt; Creating Loadable Bundles
and Code Loading Programming Topics for Cocoa &gt; Preventing Name Conflicts
sections to learn more about bundle identifiers.


6. Set the Wrapper Extension.
Double-click the &quot;RemindersPlugIn&quot; target, select the Build pane, and search
for the Wrapper Extension setting. Set the Wrapper Extension&apos;s value to
widgetplugin. 



Adding Classes 
We just set up our Xcode project. In the steps below, we are going to add the 
NSColorHexadecimalValue, CalendarItems, and RemindersPlugIn classes to our
project. These classes are needed for querying the CalendarStore framework,
parsing and processing data, and exposing Objective-C methods and instance
variables to JavaScript and vice versa. 


7. Create the NSColorHexadecimalValue&apos;s class files
Select File &gt; New File and click Objective-C class under Cocoa in the New File
Assistant window. Name the file NSColorHexadecimalValue. 


8. Create the NSColorHexadecimalValue class
NSColorHexadecimalValue is an Objective-C category that adds the
&quot;hexadecimalStringValue&quot; method to the NSColor class. &quot;hexadecimalStringValue&quot;
returns the hexadecimal value of a color.
The declaration of the NSColorHexadecimalValue interface (in the
NSColorHexadecimalValue.h file) is shown below:

@interface NSColor(NSColorHexadecimalValue) 
-(NSString *)hexadecimalStringValue;

The NSColorHexadecimalValue.m file, which contains the category implementation,
describes how to implement &quot;hexadecimalStringValue.&quot;


9. Create the CalendarItems&apos;s class files
Proceed as done in step 7 and name the file CalendarItems.
CalendarItems is an Objective-C class that stores specific information about a
calendar (uid, title, color), event (start date, title, color, start and end
time), and to do item (start date, title, color, start and end time).
See below for its interface declaration:

extern NSString * const kJSSelectorPrefix;
@interface CalendarItems : NSObject {
    NSString *js_uid;
    NSString *js_startDate;
    NSString *js_title;
    NSString *js_color;
    NSString *js_timeOrPriority;    
}

@property(copy, readwrite) NSString *js_uid;
@property(copy, readwrite) NSString *js_startDate;
@property(copy, readwrite) NSString *js_title;
@property(copy, readwrite) NSString *js_color;
@property(copy, readwrite) NSString *js_timeOrPriority;

-(id)initWithStartDate:(NSString *)date 
                 title:(NSString *)aTitle 
                 color:(NSString *)aColor 
                timeOrPriority:(NSString *)aValue;

-(id)initWithUID:(NSString *)aUid title:(NSString *)aTitle color:(NSString
*)aColor; 
 

CalendarItems.m implements the WebKit&apos;s isKeyExcludedFromWebScript and
webScriptNameForKey methods, which allows its exposure to JavaScript.
Note that step b is optional. Follow that step if you want to use custom names
for your instance variables.


a) Identify all instance variables that will be shared with JavaScript
 The isKeyExcludedFromWebScript method determines which Objective-C properties
should be available to JavaScript. In this sample, all CalendarItems instance
variables are exposed to JavaScript. See below for an implementation of
isKeyExcludedFromWebScript : 

+ (BOOL)isKeyExcludedFromWebScript:(const char *)name
{
    NSString* keyName = [[[NSString alloc] initWithUTF8String: name]
autorelease];
    return !([ keyName hasPrefix:kJSSelectorPrefix]);
}


b) Provides mapping between Objective-C and JavaScript instance variable names
The plug-in adds a &quot;js&quot; to the beginning of any property that is to be exposed
to JavaScript. The webScriptNameForKey method returns friendly names for the
exposed Objective-C instance variables. In this sample, all properties are
exposed to JavaScript without the &quot;js&quot; prefix. See below for an implementation
of webScriptNameForKey:


+ (NSString *)webScriptNameForKey:(const char *)name
{
    NSString* keyName = [[[NSString alloc] initWithUTF8String: name]
autorelease];
    if ([ keyName hasPrefix:kJSSelectorPrefix] &amp;&amp; 
       ([ keyName length] &gt; [kJSSelectorPrefix length]))
    {
        return [keyName substringFromIndex:[kJSSelectorPrefix length]];
    }
    return nil;
}


10. Create the RemindersPlugIn class&apos; s files
Proceed as done in step 7 and name the file RemindersPlugIn.


11. Create the RemindersPlugIn class
Add the &quot;#import &lt;WebKit/WebKit.h&gt;&quot; to the beginning of the RemindersPlugIn.h
file.
Add both &quot;#import &lt;CalendarStore/CalendarStore.h&gt;&quot; and &quot;#import
&quot;NSColorHexadecimalValue.h&quot; to the beginning of the RemindersPlugIn.m file.
This process involves several steps that are described from number 12 to 15.


12. Add code for exporting Objective-C methods to JavaScript
The plug-in defines a WebScriptObject object and implements some functions that
allows communication between the widget and itself.
Note that step b is optional. Follow that step if you want to use custom names
for your methods.

a) Identify the object that contains methods and properties to be exported to
JavaScript
This step consists of providing a name to the plug-in and using the Web Kit&apos;s
windowScriptObjectAvailable method to bind this name to the above mentioned
WebScriptObject object.See below for an implementation of
windowScriptObjectAvailable:

- (void)windowScriptObjectAvailable:(WebScriptObject*)scriptObject
{
    // our plug-in will be called as RemindersPlugIn from JavaScript
    [scriptObject setValue:self forKey:@&quot;RemindersPlugIn&quot;];
    webScriptObject = scriptObject;
    [webScriptObject retain];
}


b) Provide mapping between Objective-C and JavaScript method names
The plug-in adds a &quot;js&quot; to the beginning of any method that will be exposed to
JavaScript. The Web Kit&apos;s webScriptNameForSelector method returns friendly names
for these exposed Objective-C methods.  In this sample, all Objective-C methods
will be used in JavaScript without the &quot;js&quot; prefix. For instance, the
Objective-C  &quot;js_calendarToDoItems&quot; method will be exposed as
&quot;calendarToDoItems&quot; in JavaScript. See below for webScriptNameForSelector&apos;s
implementation: 

NSString * const kJSSelectorPrefix = @&quot;js_&quot;;

+ (NSString *)webScriptNameForSelector:(SEL)aSelector 
{
    NSString* selectorName = NSStringFromSelector(aSelector);
    if ([selectorName hasPrefix:kJSSelectorPrefix] &amp;&amp; ([selectorName length] &gt;
[kJSSelectorPrefix length]))
    {
        return [[[selectorName substringFromIndex:[kJSSelectorPrefix length]]
componentsSeparatedByString: @&quot;:&quot;] objectAtIndex: 0];
    }
    return nil;
}


c) Allow JavaScript to access Objective-C methods and properties
This step consists of identifying all methods and instance variables that will
be shared with JavaScript.

i) Identify all methods that will be shared with JavaScript
The Web Kit&apos;s isSelectorExcludedFromWebScript determines which Objective-C
methods should be exposed to JavaScript. In this sample, all methods with a &quot;js&quot;
prefix  are shared with JavaScript. Below is an implementation of
isSelectorExcludedFromWebScript: 

+ (BOOL)isSelectorExcludedFromWebScript:(SEL)aSelector 
{
    return !([NSStringFromSelector(aSelector) hasPrefix:kJSSelectorPrefix]);
}


13. Fetching and parsing data
The &quot;fetchCalendarEvents&quot; and &quot;fetchToDoItems&quot; are used to retrieve events and
to do items, respectively. They both receive a list of calendars&apos; uids. They
return data from specific calendars if the list is not empty and all available
calendars otherwise. Both methods use the &quot;fetchCalendarsWithUIDs&quot; to get all
calendars corresponding to the specified uids. 

Data parsing is accomplished through the &quot;parseCalendarEvents,&quot;
&quot;parseCalendars,&quot; and &quot;parseCalendarToDoItems&quot; methods that respectively parse
events, calendars, and to do items information. All three methods build an array
of CalendarItems objects. 


14. Calling the plug-in from JavaScript
JavaScript can access the plug-in&apos;s &quot; js_calendarEvents,&quot; 
&quot;js_calendarToDoItems,&quot; &quot;js_calendars,&quot; and &quot;js_nameForCalendarWithUIDs&quot;
methods. They are rendered in JavaScript without the &quot;js&quot; prefix. For instance,
the &quot;js_nameForCalendarWithUIDs&quot; will be accessed in JavaScript as follows:
    RemindersPlugIn.nameForCalendarWithUIDs


15. Calling JavaScript from the plug-in
Both &quot;eventsChanged&quot; and &quot;tasksChanged&quot; methods call the JavaScript
&quot;reloadEventsOrToDoItems&quot; from the plug-in whenever users add, remove, or update
events or to do items. This is accomplished using the WebScriptObject object and
the evaluateWebScript method as seen in the code below: 

- (void)eventsChanged:(NSNotification *)notification
{
    [webScriptObject evaluateWebScript:@&quot;reloadEventsOrToDoItems(false)&quot;];
}


16. Build the sample
Click the Build toolbar item in the project window to compile the plug-in. 



Creating  the widget Reminders
We have just created the plug-in part, what follows are the steps for creating
the widget that uses the plug-in. We are going to set up the widget, build its
interface, and add functionalities for fetching and displaying data on its front
and back. 


Note: The widget consists of several files; however, the most important files  
                             
are: Reminders.js, Reminders.html, Reminders.css, and
UserCalendarPreferences.js. 

1. Create the widget 
Reminders was created using Dashcode and consists of HTML, CSS, and JavaScript
files. Open Dashcode, select File &gt; new Project, and choose the widget&apos;s custom
template. Save the new project as Reminders.


2. Set up the widget&apos;s identifier 
Click the widget attributes pane in the window to access the widget&apos;s
properties. Fill the widget identifier with the RemindersPlugIn&apos;s bundle
identifier.  


3. Set up the widget&apos;s plugin
The widget plugin field holds our plug-in&apos;s name. Use the &quot;choose&quot; button in
the widget&apos;s properties window to select the RemindersPlugIn.widgetplugin folder
(RemindersPlugIn/build/Release/RemindersPlugIn.widgetplugin).


4. Add the widget&apos;s preferrredCalendar key
The widget uses the preferrredCalendar key to save the user&apos;s calendar
preferences.
Click the &quot;+&quot; sign in the Localization area to add the preferredCalendar key.


5. Create the widget&apos;s interface
Our widget has front and back interfaces. Both interfaces were created using
controls available in Dashcode&apos;s library. 
Choose Window &gt; Show Library and click the Parts button to see all available
Dashcode&apos;s controls. We built the widget by dragging each of its parts (buttons,
scroll areas, rectangles) from the Parts Library to the widget&apos;s body on the
canvas.


6. Implement the front of the widget 
The Reminders.js file contains all required JavaScript functions for the front
of the widget. Its &quot;showEvents&quot; and &quot;showToDoItems&quot; functions are activated when
users respectively click the &quot;Events&quot; or &quot;To Do Items&quot; buttons on the widget&apos;s
menu bar. 
Both functions call the RemindersPlugIn object to retrieve events and to do
items belonging to all or specific calendars, respectively. &quot;showEvents&quot;  calls
the plug-in using the following line: 
    RemindersPlugIn.calendarEvents(preferredCalendars)

Its &quot;displayResults&quot; function receives an array of CalendarItems objects and a
boolean value; it shows events if the value is false and to do items otherwise.
The &quot;showErrorMessage&quot; function adds specific error messages on the widget. Both
&quot;displayResults&quot; and &quot;showErrorMessage&quot;  write data to the widget&apos;s scroll area.
We need to refresh the scroll area once we are done appending data to it. Use
the following line to refresh the scroll area: 
    document.getElementById(scrollArea).object.refresh()


Note: Below are problems that you may encounter if you do not refresh the
scroll area after changing its content:
-Sliders might not be visible when the content is too large for the scroll
area. 
 -If you move the slider up or down while the widget displays either events or
to do items data, then switches to the other view, the slider will stay at its
previous position instead of jumping to the top of the scroll area. 

Users can switch to the back of the widget using the &quot;showBack&quot; function. 


7. Implement the back of the widget 
The UserCalendarPreferences.js file defines all required JavaScript functions
for the back of the widget. It uses the &quot;displayUserCalendarPreferences&quot;
function to fetch and display all available calendars. It calls the
&quot;retrieveSelectedCalendars&quot; function to get all calendars checked by the user
and update the custom &quot;preferredCalendars&quot; key.

All calendars are selected by default when the widget first loads.
&quot;retrieveSelectedCalendars&quot; shows a warning message and icon if users uncheck
all of them. The following line shows how to update the &quot;preferredCalendars&quot;
key: 
    widget.setPreferenceForKey(preferredCalendars,&quot;preferredCalendars&quot;)

The &quot;userCalendarPreferences&quot; function checks the widget&apos;s &quot;preferredCalendars&quot;
key using widget.preferenceForKey(&quot;preferredCalendars&quot;) and returns 
the user&apos;s calendar preferences. Use the &quot;showFront&quot; function to return to the
front of the widget.


8. Build the sample
Click Run in the toolbar to test the widget.
Click File &gt; Deploy Widget to Dashboard to install the widget on your computer.


Feedback and Bug Reports
Please send all feedback about this sample by using the Feedback form on the
bottom of the sample&apos;s webpage.
Please submit any bug reports about this sample to the Bug Reporting
&lt;http://developer.apple.com/bugreporter&gt; page.

Copyright (C) 2008 Apple Inc. All rights reserved.</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Reminders/listing1.html%3Fid%3DDTS40007877-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Reminders/listing1.html%3Fid%3DDTS40007877-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Reminders/listing1.html%3Fid%3DDTS40007877-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>