<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Read and Write Routines</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c4.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c6.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=3897"> </A><A NAME="16522"> </A>Read and Write Routines</H1><P CLASS="T1.Text1"><A NAME="pgfId=3899"> </A><A NAME="marker=3898"> </A>Driver read and write routines implement I/O requests. You can make read and write routines execute synchronously or asynchronously. A synchronous read or write routine must complete an entire I/O request before returning to the Device Manager; an asynchronous read or write routine can begin an I/O transaction and then return to the Device Manager before the request is complete. In this case, the I/O request continues to be executed, typically when more data is available, by other routines such as interrupt handlers or completion routines. <A HREF="PCI_BOOK.c9.html#32891" CLASS="XRef">Handling Asynchronous I/O</A> discusses how to complete an asynchronous read or write routine. </P><P CLASS="T1.Text1"><A NAME="pgfId=3903"> </A>One rule you can always follow regarding synchronous and asynchronous operation is:</P><P CLASS="T1.Text1"><A NAME="pgfId=3904"> </A>If your device driver can be called asynchronously and you call another device driver, you must call it asynchronously. And, if your device driver can be called asynchronously, always operate as if you are being called asynchronously.</P><P CLASS="T1.Text1"><A NAME="pgfId=3905"> </A>In other words, you should not test to see whether an operation is synchronous or asynchronous, and do different things in each case. </P><P CLASS="T1.Text1"><A NAME="pgfId=3909"> </A><A HREF="PCI_BOOK.c5.html#10837" CLASS="XRef">Listing&nbsp;8-7</A> shows a sample read routine. </P><P CLASS="L.Listing"><B><A NAME="pgfId=3913"> </A>Listing&nbsp;8-7	<A NAME="10837"> </A>Sample driver read routine<A NAME="marker=3911"> </A><A NAME="marker=3912"> </A> </B></P><CODE CLASS="Cv.Code"><A NAME="pgfId=17512"> </A>OSErr DoReadCommand (IOpb pb)<BR>{<BR>long&nbsp;&nbsp;&nbsp;&nbsp;numBytes;<BR>short&nbsp;&nbsp;&nbsp;myErr;<BR><BR>numbytes = pb -&gt; IORegCount;<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* do the read into pb -&gt; iobuffer */<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>return(myErr);<BR>}</CODE><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c4.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c6.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>