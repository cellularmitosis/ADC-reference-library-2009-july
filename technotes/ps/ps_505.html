<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PS505: Notification Manager Q&amp;As</title><meta name="keywords" content="Mac OS 8 Notification Manager DA desktop accessory alert foreground"><meta name="Description" content="Technical Note PS505: This Technical Note details how touse the Notification Manager to alert the user to bring aDestop Accessory to the front so that it can display an alert.">                                       <meta name="categories" content="Processes"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002653" title="Notification Manager Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxProcessManagement-date.html" target="_blank">Carbon > Process Management</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PS505</div>
<div id="pageheadsub">Notification Manager Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Macintosh background DA alerts</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;As can be found on the <A HREF = "../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A>                     <h2>Macintosh background DA alerts</h2><p>Date Written:  6/10/91</p><p>Last reviewed:  6/14/93</p><p>How can I use the Notification Manager to alert the user to bring my DA to thefront and then display an alert?</p><p>Basically, if your DA is in the foreground and you finish your task, you canjust use <code>Alert()</code> to notify the user. If your DA is in the background when itfinishes, post a notification with <code>NMInstall</code> that notifies the user by sound,icon, and mark in the process menu (but not an alert) that something is up inyour desk accessory. When they switch to your DA, you then display your alert.</p><p>The following code is for a DA written in Think C that notifies the user asdescribed above. Portions of the code are borrowed from the Think C example"Hex Dump DA." Basically, this code keeps track of whether the DA is in theforeground or background by setting the global variable <code>gInBackground</code> at everyactivate and deactivate event. If there is a notification pending and anactivate event is received, the routine <code>MyResponse</code> is called to remove thenotification and display the appropriate alert.</p><p>Note that for MPW you'll have to store your globals elsewhere, as MPW doesn'tprovide the Think C A4 feature. You'll have to modify the code to work withyour function to get the proper resource IDs.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void PostNotify(StringPtr theStr){    extern Boolean gInBackground;    /* true=in background */    extern NMRec *gNotify;   /* global var pointing to notif. rec 0=none */    Handle notIcon;    Ptr txtPtr;    /* blast away any other pending notification */    if (gNotify) {        DisposPtr((Ptr) gNotify-&gt;nmRefCon);        NMRemove(gNotify);        gNotify = nil;    }    /* see if we should notify or use alert */    if (gInBackground) {        /* allocate memory for notification */        txtPtr = NewPtr(sizeof(Str255));        if (MemError()!=noErr)            return;        gNotify = (NMRec *)NewPtr(sizeof(NMRec));        if (MemError()!=noErr)            return;        /* copy notif. string to dynamically allocated block */        BlockMove(theStr,txtPtr,256);        /* fill out notif. record */        notIcon = GetResource('SICN',OwnedResourceID(NOTIF_ICON));        gNotify-&gt;nmStr = nil;        gNotify-&gt;qType = nmType;        gNotify-&gt;nmMark = 1;        gNotify-&gt;nmIcon = notIcon;        gNotify-&gt;nmSound = (Handle)-1;        gNotify-&gt;nmResp = nil;        gNotify-&gt;nmRefCon = (long)txtPtr;        NMInstall(gNotify);    }    else {        ParamText(theStr,&quot;\p&quot;,&quot;\p&quot;,&quot;\p&quot;);        StopAlert(OwnedResourceID(ALERT_DIALOG),nil);    }}/* response procedure-- called on activateEvt */pascal void MyResponse(QElemPtr nmReqPtr){    StringPtr errTxt;    errTxt = (StringPtr) ((NMRec *)nmReqPtr)-&gt;nmRefCon;    NMRemove((NMRec *)nmReqPtr);    ParamText(errTxt,&quot;\p&quot;,&quot;\p&quot;,&quot;\p&quot;);    StopAlert(OwnedResourceID(ALERT_DIALOG),nil);    DisposPtr(errTxt);}/*---------------------------------------------------------*/  here's the piece of the code that handles activate events/*---------------------------------------------------------*/doActivate(activate)Boolean activate;{    extern Boolean gInBackground;    extern NMRec *gNotify;    Rect r;    GrafPtr    savePort;    GetPort(&amp;savePort);    SetPort(wp);    r = wp-&gt;portRect;    r.top = r.bottom - 16;    r.left = r.left - 16;    InvalRect(&amp;r);    gInBackground = !activate;    if ( activate ) {        if (gNotify) {            MyResponse((QElemPtr)gNotify);            gNotify = nil;        }    }    SetPort(savePort);}</pre>	</TD></TR></TABLE></CENTER><a name=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (16K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ps_505.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ps/ps_505.html%3Fid%3DDTS10002653-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ps/ps_505.html%3Fid%3DDTS10002653-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ps/ps_505.html%3Fid%3DDTS10002653-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>