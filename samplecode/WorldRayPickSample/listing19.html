<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>WorldRayPickSample - /Source/WRay_Scene.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">WorldRayPickSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">WorldRayPickSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/WRay_Scene.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Headers/WRay_Document.h</option>
<option value="listing2.html">/Headers/WRay_Error.h</option>
<option value="listing3.html">/Headers/WRay_Events.h</option>
<option value="listing4.html">/Headers/WRay_Main.h</option>
<option value="listing5.html">/Headers/WRay_Memory.h</option>
<option value="listing6.html">/Headers/WRay_Menu.h</option>
<option value="listing7.html">/Headers/WRay_Message.h</option>
<option value="listing8.html">/Headers/WRay_Pick.h</option>
<option value="listing9.html">/Headers/WRay_Scene.h</option>
<option value="listing10.html">/Headers/WRay_System.h</option>
<option value="listing11.html">/Source/WRay_Document.c</option>
<option value="listing12.html">/Source/WRay_Error.c</option>
<option value="listing13.html">/Source/WRay_Events.c</option>
<option value="listing14.html">/Source/WRay_Main.c</option>
<option value="listing15.html">/Source/WRay_Memory.c</option>
<option value="listing16.html">/Source/WRay_Menu.c</option>
<option value="listing17.html">/Source/WRay_Message.c</option>
<option value="listing18.html">/Source/WRay_Pick.c</option>
<option value="listing19.html">/Source/WRay_Scene.c</option>
<option value="listing20.html">/Source/WRay_System.c</option></select>
				</p>
				</form>
				<p><strong><a href="WorldRayPickSample.zip">Download Sample</a></strong> (&#147;WorldRayPickSample.zip&#148;, 42.5K)<BR>
<strong><a href="WorldRayPickSample.dmg">Download Sample</a></strong> (&#147;WorldRayPickSample.dmg&#148;, 101.9K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  *  WRay_Scene.c * *  QuickDraw 3D 1.6 Sample *  Robert Dierkes * *   07/28/98  RDD    Created. *//*------------------*//*  Include Files  *//*------------------*/#include &quot;QD3D.h&quot;#include &quot;QD3DDrawContext.h&quot;#include &quot;QD3DCamera.h&quot;#include &quot;QD3DLight.h&quot;#include &quot;QD3DGeometry.h&quot;#include &quot;QD3DGroup.h&quot;#include &quot;QD3DMath.h&quot;#include &quot;QD3DRenderer.h&quot;#include &quot;QD3DShader.h&quot;#include &quot;QD3DTransform.h&quot;#include &quot;QD3DView.h&quot;#include &quot;WRay_Error.h&quot;#include &quot;WRay_Document.h&quot;#include &quot;WRay_Main.h&quot;#include &quot;WRay_Memory.h&quot;#include &quot;WRay_Scene.h&quot;#include &quot;WRay_System.h&quot;#include &lt;math.h&gt;/*------------------*//*    Constants    *//*------------------*/#define  kDefaultCamLoc      0.0, 0.0, 10.0#define  kDefaultPtOfInt    0.0, 0.0, 0.0#define  kDefaultUpVector  0.0, 1.0, 0.0#define  kAngleDelta      Q3Math_DegreesToRadians(2.0f)/*----------------------*//*  Global Declarations  *//*----------------------*/static  TQ3CameraObject  gCamera      = NULL;static  float      gRotationAngle  = Q3Math_DegreesToRadians(90.0f);static  TQ3Boolean    gDoRotation    = kQ3False;/*----------------------*//*  Local Prototypes  *//*----------------------*/staticTQ3DrawContextObject Scene_NewDrawContext(      WindowPtr    pWindow);staticTQ3Status Scene_ChangeViewAttributes(      TQ3ViewObject  view);staticTQ3Status Scene_NewRenderer(      TQ3ViewObject  view,      TQ3ObjectType  rendererType);staticTQ3CameraObject Scene_NewCamera(      Rect      *pWindowRect);staticTQ3GroupObject Scene_NewLights(      void);staticTQ3Status  Scene_NewStyles(      TQ3GroupObject  group);staticTQ3Status  Scene_NewScene(      TQ3GroupObject  group);staticTQ3Status  Scene_NewBoxSides(      TQ3GroupObject  group,      TQ3BoundingBox  *pBBox);/* *  Scene_NewView */TQ3ViewObject   Scene_NewView(  WindowPtr    pWindow){  TQ3Status        status = kQ3Failure;  TQ3ViewObject      view;  TQ3DrawContextObject  drawContext;  TQ3CameraObject      camera;  TQ3GroupObject      lights;  view = Q3View_New();  DEBUG_ASSERT(view != NULL, Scene_NewView);  if (view == NULL) {    goto bail;  }  /* Create and set draw context */  DEBUG_ASSERT(pWindow != NULL, Scene_NewView);  if ((drawContext = Scene_NewDrawContext(pWindow)) == NULL) {    goto bail;  }  if ((status = Q3View_SetDrawContext(view, drawContext)) == kQ3Failure) {    goto bail;  }  Object_Dispose_NULL(&amp;drawContext);  /* Change view's attributes */  if ((status = Scene_ChangeViewAttributes(view)) == kQ3Failure) {    goto bail;  }  /* Create and set renderer */  if ((status = Scene_NewRenderer(view, kQ3RendererTypeInteractive)) == kQ3Failure) {    goto bail;  }  /* Create and set camera */  if ((camera = Scene_NewCamera(&amp;pWindow-&gt;portRect)) == NULL) {    goto bail;  }  if ((status = Q3View_SetCamera(view, camera)) == kQ3Failure) {    goto bail;  }  /* Save reference to camera */  gCamera = camera;  Object_Dispose_NULL(&amp;camera);  /* Create and set lights */  if ((lights = Scene_NewLights()) == NULL) {    goto bail;  }  if ((status = Q3View_SetLightGroup(view, lights)) == kQ3Failure) {    goto bail;  }  Object_Dispose_NULL(&amp;lights);  return (view);bail:  return NULL;}/* *  Scene_NewDrawContext */staticTQ3DrawContextObject Scene_NewDrawContext(  WindowPtr    pWindow){  TQ3DrawContextObject    drawContext;  TQ3DrawContextData      *pDCData;  TQ3MacDrawContextData    macDrawContextData;  pDCData = &amp;macDrawContextData.drawContextData;  #define  kDefaultClearImageColor    1.0, 0.15, 0.15, 0.15  /* Fill in common draw context data */  pDCData-&gt;clearImageMethod = kQ3ClearMethodWithColor;  Q3ColorARGB_Set(&amp;pDCData-&gt;clearImageColor, kDefaultClearImageColor);  pDCData-&gt;paneState         = kQ3False;  pDCData-&gt;maskState         = kQ3False;  /* Mac draw context */  pDCData-&gt;doubleBufferState = kQ3True;  /* This is the window associated with the view */  DEBUG_ASSERT(pWindow != NULL, Scene_NewDrawContext);  macDrawContextData.window   = (CGrafPtr) pWindow;  macDrawContextData.library  = kQ3Mac2DLibraryNone;  macDrawContextData.viewPort = NULL;  macDrawContextData.grafPort = NULL;  /* Create draw context and return it, if it's nil the caller must handle */  drawContext = Q3MacDrawContext_New(&amp;macDrawContextData);  DEBUG_ASSERT(drawContext != NULL, Scene_NewDrawContext);  #undef  kDefaultClearImageColor  return drawContext;}/* *  Scene_ChangeViewAttributes */TQ3Status Scene_ChangeViewAttributes(  TQ3ViewObject  view){  TQ3Status      status = kQ3Failure;  TQ3AttributeSet   attributeSet = NULL;  TQ3ColorRGB      color = { 1.0, 0.0, 0.0 };  status = Q3View_GetDefaultAttributeSet(view, &amp;attributeSet);  DEBUG_ASSERT(status == kQ3Success, Q3View_GetDefaultAttributeSet);  DEBUG_ASSERT(attributeSet != NULL, Q3View_GetDefaultAttributeSet);  if (status == kQ3Failure) {    return status;  }  /* Change view's specular color */  Q3AttributeSet_Add(attributeSet, kQ3AttributeTypeSpecularColor, &amp;color);  status = Q3View_SetDefaultAttributeSet(view, attributeSet);  DEBUG_ASSERT(status == kQ3Success, Q3View_SetDefaultAttributeSet);  Object_Dispose_NULL(&amp;attributeSet);  return status;}/* *  Scene_NewRenderer */TQ3Status Scene_NewRenderer(  TQ3ViewObject  view,  TQ3ObjectType  rendererType){  TQ3Status      status = kQ3Failure;  TQ3RendererObject  renderer = NULL;  if (view == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewRenderer: view == NULL.&quot;);    return status;  }  /* Use the interactive software renderer if present */  if ((renderer = Q3Renderer_NewFromType(rendererType)) != NULL) {    if ((status = Q3View_SetRenderer(view, renderer)) == kQ3Success) {      /* Use hardware accelerator for IR if present */      if (rendererType == kQ3RendererTypeInteractive) {        Q3InteractiveRenderer_SetDoubleBufferBypass(renderer, kQ3True);      }     }     else {      ERROR_DEBUG_STR(&quot;Scene_NewRenderer: Q3View_SetRenderer failed.&quot;);    }  }  else {    /* Default to wireframe renderer */    if ((renderer = Q3Renderer_NewFromType(kQ3RendererTypeWireFrame)) != NULL) {      if ((status = Q3View_SetRenderer(view, renderer)) == kQ3Failure) {        ERROR_DEBUG_STR(&quot;Scene_NewRenderer: Q3View_SetRenderer(WF) failed.&quot;);      }    }  }  Object_Dispose_NULL(&amp;renderer);  return status;}/* *  Scene_NewCamera */staticTQ3CameraObject Scene_NewCamera(  Rect      *pWindowRect){  TQ3ViewAngleAspectCameraData            perspectiveData;  TQ3CameraObject    camera;  TQ3Point3D       from  = { kDefaultCamLoc };  TQ3Point3D       to    = { kDefaultPtOfInt };  TQ3Vector3D     up    = { kDefaultUpVector };  perspectiveData.cameraData.placement.cameraLocation   = from;  perspectiveData.cameraData.placement.pointOfInterest   = to;  perspectiveData.cameraData.placement.upVector       = up;  perspectiveData.cameraData.range.hither  = kDefaultHither;  perspectiveData.cameraData.range.yon   = kDefaultYon;  perspectiveData.cameraData.viewPort.origin.x = -1.0;  perspectiveData.cameraData.viewPort.origin.y =  1.0;  perspectiveData.cameraData.viewPort.width    =  2.0;  perspectiveData.cameraData.viewPort.height   =  2.0;  perspectiveData.fov        = kDefaultFieldOfView;  perspectiveData.aspectRatioXToY  =    (float) (pWindowRect-&gt;right -  pWindowRect-&gt;left) /     (float) (pWindowRect-&gt;bottom - pWindowRect-&gt;top);  camera = Q3ViewAngleAspectCamera_New(&amp;perspectiveData);  DEBUG_ASSERT(camera != NULL, Scene_NewCamera);  return camera;}/*----------------------------------------------------------------------------------*//* *  Scene_NewLights */staticTQ3GroupObject Scene_NewLights(  void){  TQ3GroupPosition    groupPosition = NULL;  TQ3GroupObject      lightGroup = NULL;  TQ3LightObject      light = NULL;  TQ3DirectionalLightData  comboLightData;  /* Create light group and add each of the lights into the group */  lightGroup = Q3LightGroup_New();  if (lightGroup == NULL)    goto bail;  /* Create ambient light */  comboLightData.lightData.isOn    = kQ3True;  comboLightData.lightData.brightness = 0.6f;  Q3ColorRGB_Set(&amp;comboLightData.lightData.color, 1.0f, 1.0f, 1.0f);  light = Q3AmbientLight_New(&amp;comboLightData.lightData);  DEBUG_ASSERT(light != NULL, Q3AmbientLight_New);  if (light == NULL)    goto bail;  groupPosition = Q3Group_AddObject(lightGroup, light);  DEBUG_ASSERT(groupPosition != NULL, Q3Group_AddObject);  if (groupPosition == NULL)    goto bail;  Object_Dispose_NULL(&amp;light);  /* Create a yellow directional light */  comboLightData.lightData.brightness  = 0.9f;  Q3ColorRGB_Set(&amp;comboLightData.lightData.color, 0.9f, 0.9f, 0.0f);  comboLightData.castsShadows      = kQ3True;  Q3Vector3D_Set(&amp;comboLightData.direction, 1.0f, -1.0f, -2.0f);  light = Q3DirectionalLight_New(&amp;comboLightData);  DEBUG_ASSERT(light != NULL, Q3DirectionalLight_New);  if (light == NULL)    goto bail;  groupPosition = Q3Group_AddObject(lightGroup, light);  DEBUG_ASSERT(groupPosition != NULL, Q3Group_AddObject);  if (groupPosition == NULL)    goto bail;  Object_Dispose_NULL(&amp;light);  /* Create a magenta directional light */  comboLightData.lightData.brightness  = 0.9f;  Q3ColorRGB_Set(&amp;comboLightData.lightData.color, 0.9f, 0.0f, 0.9f);  comboLightData.castsShadows      = kQ3True;  Q3Vector3D_Set(&amp;comboLightData.direction, -1.0f, 1.0f, 2.0f);  light = Q3DirectionalLight_New(&amp;comboLightData);  DEBUG_ASSERT(light != NULL, Q3DirectionalLight_New);  if (light == NULL)    goto bail;  groupPosition = Q3Group_AddObject(lightGroup, light);  DEBUG_ASSERT(groupPosition != NULL, Q3Group_AddObject);  if (groupPosition == NULL)    goto bail;  Object_Dispose_NULL(&amp;light);  return (lightGroup);bail:  Object_Dispose_NULL(&amp;light);  Object_Dispose_NULL(&amp;lightGroup);  return (NULL);}/* *  Scene_NewModel */TQ3GroupObject Scene_NewModel(  void){  TQ3Status        status = kQ3Failure;  TQ3GroupObject      model = NULL;  TQ3DisplayGroupState  state;  TQ3ShaderObject      illuminationShader = NULL;  if ((model = Q3OrderedDisplayGroup_New()) != NULL) {    /* Make group inline so state isn't pushed */    if (Q3DisplayGroup_GetState(model, &amp;state) == kQ3Success) {      state |= kQ3DisplayGroupStateMaskIsInline;      Q3DisplayGroup_SetState(model, state);    }    /* Add shader to model */    if ((illuminationShader = Q3PhongIllumination_New()) != NULL) {      Q3Group_AddObject(model, illuminationShader);      Object_Dispose_NULL(&amp;illuminationShader);      /* Add styles to model */      if ((status = Scene_NewStyles(model)) == kQ3Success) {        /* Add geometries to model */        status = Scene_NewScene(model);      }    }    if (status == kQ3Failure) {      Object_Dispose_NULL(&amp;model);    }  }  return (model);}/* *  Scene_NewStyles */staticTQ3Status Scene_NewStyles(  TQ3GroupObject  group){  TQ3StyleObject    style;  if (group == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewStyles: group == NULL.&quot;);    return kQ3Failure;  }  /* Interpolation Style */  if ((style = Q3InterpolationStyle_New(kQ3InterpolationStyleVertex)) == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewStyles: Q3InterpolationStyle_New failed.&quot;);    return kQ3Failure;  }  Q3Group_AddObject(group, style);  Object_Dispose_NULL(&amp;style);  /* Backfacing Style */  if ((style = Q3BackfacingStyle_New(kQ3BackfacingStyleBoth)) == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewStyles: Q3BackfacingStyle_New failed.&quot;);    return kQ3Failure;  }  Q3Group_AddObject(group, style);  Object_Dispose_NULL(&amp;style);  /* Fill Style */  if ((style = Q3FillStyle_New(kQ3FillStyleFilled)) == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewStyles: Q3FillStyle_New failed.&quot;);    return kQ3Failure;  }  Q3Group_AddObject(group, style);  Object_Dispose_NULL(&amp;style);  /* Subdivision Style */  {    TQ3SubdivisionStyleData    data;    data.method  = kQ3SubdivisionMethodConstant;    data.c1    = 9.0f;    data.c2    = 9.0f;    if ((style = Q3SubdivisionStyle_New(&amp;data)) == NULL) {      ERROR_DEBUG_STR(&quot;Scene_NewStyles: Q3SubdivisionStyle_New failed.&quot;);      return kQ3Failure;    }    Q3Group_AddObject(group, style);    Object_Dispose_NULL(&amp;style);  }  return kQ3Success;}#pragma mark -/* *  Scene_NewScene */staticTQ3Status Scene_NewScene(  TQ3GroupObject  group){  TQ3Status      status = kQ3Success;  TQ3BoundingBox    sceneBBox;  TQ3GeometryObject  geometry = NULL;  TQ3CylinderData    cylinderData;  TQ3AttributeSet    attr = NULL;  unsigned long    rx, cy;  #define  kNumRows      5  /* X */  #define  kNumColumns      7  /* Y */  #define  kCylHeight      4.0f  #define  kCylDiameter    (2.0f * kCylRadius)  #define  kCylGap        (0.9f * kCylRadius)  #define  kSceneWidth      ((kNumColumns * kCylDiameter) + ((kNumColumns-1) * kCylGap))  #define  kSceneHeight    ((kNumRows    * kCylDiameter) + ((kNumRows-1)    * kCylGap))  #define  kSceneDepth      kCylHeight  #define  kSceneHalfWidth    (kSceneWidth  / 2.0f)  #define  kSceneHalfHeight  (kSceneHeight  / 2.0f)  #define  kSceneHalfDepth    (kSceneDepth  / 2.0f)  if (group == NULL) {    ERROR_DEBUG_STR(&quot;Scene_NewScene: group == NULL.&quot;);    return kQ3Failure;  }  /* Create a 4 sided box */  Q3Point3D_Set(&amp;sceneBBox.min, -kSceneHalfWidth, -kSceneHalfHeight, -kSceneHalfDepth);  Q3Point3D_Set(&amp;sceneBBox.max,  kSceneHalfWidth,  kSceneHalfHeight,  kSceneHalfDepth);  sceneBBox.isEmpty = kQ3False;  if (Scene_NewBoxSides(group, &amp;sceneBBox) == kQ3Failure) {    return kQ3Failure;  }  /* Create cylinders inside box */  for (rx = 0; rx &lt; kNumColumns; rx++) {    for (cy = 0; cy &lt; kNumRows; cy++) {      /* Skip middle geometry */      if ((rx == (kNumColumns / 2))  &amp;&amp;  (cy == (kNumRows / 2))) {        continue;      }      /* Every other geometry */      if ((rx + cy) &amp; 1) {        continue;      }      /* Cylinder is parallel to z-axis */      Q3Point3D_Set(&amp;cylinderData.origin,        (((float) rx) * (kCylDiameter + kCylGap)) + kCylRadius - kSceneHalfWidth,        (((float) cy) * (kCylDiameter + kCylGap)) + kCylRadius - kSceneHalfHeight,        -kSceneHalfDepth);      Q3Vector3D_Set(&amp;cylinderData.orientation,  0.0,    0.0,    kCylHeight);      Q3Vector3D_Set(&amp;cylinderData.majorRadius,  kCylRadius,  0.0,    0.0);      Q3Vector3D_Set(&amp;cylinderData.minorRadius,  0.0,    kCylRadius,  0.0);      cylinderData.uMin = cylinderData.vMin = 0.0f;      cylinderData.uMax = cylinderData.vMax = 1.0f;      cylinderData.caps = kQ3EndCapMaskTop | kQ3EndCapMaskBottom;      cylinderData.interiorAttributeSet  = NULL;      cylinderData.topAttributeSet    = NULL;      cylinderData.faceAttributeSet    = NULL;      cylinderData.bottomAttributeSet    = NULL;      cylinderData.cylinderAttributeSet  = NULL;      attr = Q3AttributeSet_New();      if (attr != NULL) {        TQ3ColorRGB    rgbColor;        Q3ColorRGB_Set(&amp;rgbColor,                0.0,                (float) (kNumColumns - rx) / kNumColumns,                (float) cy / kNumRows);        Q3AttributeSet_Add(attr, kQ3AttributeTypeDiffuseColor, &amp;rgbColor);      }      cylinderData.cylinderAttributeSet = attr;      geometry = Q3Cylinder_New(&amp;cylinderData);      if (geometry == NULL) {        status = kQ3Failure;        break;      }      Object_Dispose_NULL(&amp;attr);      Q3Group_AddObject(group, geometry);      Object_Dispose_NULL(&amp;geometry);    }  }  Object_Dispose_NULL(&amp;attr);  Object_Dispose_NULL(&amp;geometry);  return status;}staticTQ3Status Scene_NewBoxSides(  TQ3GroupObject  group,  TQ3BoundingBox  *pBBox){  #define  kMaxPolygons  4  #define  kMaxPolyVerts  4  #define  kOutsetScale  0.15f  TQ3Status      status   = kQ3Success;  TQ3GeometryObject  geometry = NULL;  TQ3PolygonData    polyData;  TQ3Vertex3D      vertices[kMaxPolyVerts],            *pVertex;  TQ3Point3D      min, max;  unsigned long    side;  TQ3AttributeSet    attr = NULL;  float        boxOutset;  min = pBBox-&gt;min;  max = pBBox-&gt;max;  boxOutset = (max.x - min.x) * kOutsetScale;  min.x -= boxOutset;  max.x += boxOutset;  boxOutset = (max.y - min.y) * kOutsetScale;  min.y -= boxOutset;  max.y += boxOutset;  boxOutset = (max.z - min.z) * kOutsetScale;  min.z -= boxOutset;  max.z += boxOutset;  polyData.numVertices = kMaxPolyVerts;  polyData.vertices   = vertices;  pVertex = polyData.vertices;  vertices[0].attributeSet =  vertices[1].attributeSet =  vertices[2].attributeSet =  vertices[3].attributeSet = NULL;  for (side = 0; side &lt; kMaxPolygons; side++) {    attr = Q3AttributeSet_New();    if (attr != NULL) {      TQ3ColorRGB    rgbColor;      Q3ColorRGB_Set(&amp;rgbColor, 0.0, 0.5, 0.5);      Q3AttributeSet_Add(attr, kQ3AttributeTypeDiffuseColor, &amp;rgbColor);    }    polyData.polygonAttributeSet = attr;    switch (side) {    case 0:      Q3Point3D_Set(&amp;pVertex[0].point, min.x, min.y, min.z);      Q3Point3D_Set(&amp;pVertex[1].point, min.x, min.y, max.z);      Q3Point3D_Set(&amp;pVertex[2].point, max.x, min.y, max.z);      Q3Point3D_Set(&amp;pVertex[3].point, max.x, min.y, min.z);      break;    case 1:      Q3Point3D_Set(&amp;pVertex[0].point, max.x, min.y, min.z);      Q3Point3D_Set(&amp;pVertex[1].point, max.x, min.y, max.z);      Q3Point3D_Set(&amp;pVertex[2].point, max.x, max.y, max.z);      Q3Point3D_Set(&amp;pVertex[3].point, max.x, max.y, min.z);      break;    case 2:      Q3Point3D_Set(&amp;pVertex[0].point, min.x, max.y, min.z);      Q3Point3D_Set(&amp;pVertex[1].point, max.x, max.y, min.z);      Q3Point3D_Set(&amp;pVertex[2].point, max.x, max.y, max.z);      Q3Point3D_Set(&amp;pVertex[3].point, min.x, max.y, max.z);      break;    case 3:      Q3Point3D_Set(&amp;pVertex[0].point, min.x, min.y, min.z);      Q3Point3D_Set(&amp;pVertex[1].point, min.x, max.y, min.z);      Q3Point3D_Set(&amp;pVertex[2].point, min.x, max.y, max.z);      Q3Point3D_Set(&amp;pVertex[3].point, min.x, min.y, max.z);      break;    }    geometry = Q3Polygon_New(&amp;polyData);    Object_Dispose_NULL(&amp;polyData.polygonAttributeSet);    if (geometry == NULL) {      return kQ3Failure;    }    Q3Group_AddObject(group, geometry);    Object_Dispose_NULL(&amp;geometry);  }  return kQ3Success;}#pragma mark -/* *  Scene_IsRotating */TQ3Boolean Scene_IsRotating(  void){  return gDoRotation;}/* *  Scene_SetIsRotating */TQ3Boolean Scene_SetIsRotating(  TQ3Boolean    newIsRotating){  TQ3Boolean  oldIsRotating = gDoRotation;  gDoRotation = newIsRotating;  return oldIsRotating;}/* *  Scene_Rotate * *  Global: *    gCamera */TQ3Status Scene_Rotate(  void){  TQ3Status      status = kQ3Failure;  TQ3CameraPlacement  placement;  float        cameraDist;  if (gDoRotation) {    gRotationAngle += kAngleDelta;    status = Q3Camera_GetPlacement(gCamera, &amp;placement);    DEBUG_ASSERT(status == kQ3Success, Q3Camera_GetPlacement);    cameraDist = Q3Point3D_Distance(&amp;placement.cameraLocation, &amp;placement.pointOfInterest);    /* Assumes pointOfInterest is at origin any pointOfInterest.y is 0 */    placement.cameraLocation.x = cos(gRotationAngle) * cameraDist;    placement.cameraLocation.z = sin(gRotationAngle) * cameraDist;    status = Q3Camera_SetPlacement(gCamera, &amp;placement);    DEBUG_ASSERT(status == kQ3Success, Q3Camera_SetPlacement);  }  return status;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/WorldRayPickSample/listing19.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/WorldRayPickSample/listing19.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/WorldRayPickSample/listing19.html%3Fid%3DDTS10000140-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>