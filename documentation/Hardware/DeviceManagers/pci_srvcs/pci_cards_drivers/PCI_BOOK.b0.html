<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Completing an I/O Request</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.af.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.af.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b1.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3429"> </A><A NAME="40454"> </A>Completing an I/O Request</H1><P CLASS="T1.Text1"><A NAME="pgfId=3430"> </A>To replace the <TT CLASS="cv">IODone</TT> routine and its associated low memory global <TT CLASS="cv">jIODone</TT>, a new routine has been added to the Device Manager called <A NAME="marker=3431"> </A><TT CLASS="cv">IOCommandIsComplete</TT>. The difference between <TT CLASS="cv">IODone</TT> and <TT CLASS="cv">IOCommandIsComplete</TT> is that while <TT CLASS="cv">IODone</TT> initiates request completion processing for a request that is implicitly designated by the request queue head, a caller of <TT CLASS="cv">IOCommandIsComplete</TT> must explicitly specify the request that is to be completed.</P><P CLASS="T1.Text1"><A NAME="pgfId=3432"> </A>After a nonimmediate <TT CLASS="cv">IOCommandKind</TT> command has been accepted, the driver performs the actions implied by the command and the IO parameter block contents. When the command has been processed, the driver must complete the command. </P><P CLASS="T1.Text1"><A NAME="pgfId=3433"> </A>The driver must identify the command it is completing; this is done by passing the command ID to <TT CLASS="cv">IOCommandIsComplete</TT>. The command ID is provided to a driver as the first parameter to its I/O entry point, as well as being stored in the IO parameter block's <TT CLASS="cv">ioCmdAddr</TT> field ( <TT CLASS="cv">ThePb</TT> -&gt;<TT CLASS="cv"> ioParam.ioCmdAddr</TT> ). </P><P CLASS="T1.Text1"><A NAME="pgfId=3434"> </A>As a result of a completion, the Device Manager takes several actions. If the command was performed synchronously, the I/O trap finishes. If the command was performed asynchronously, the requested I/O completion routine is invoked. The routine <TT CLASS="cv">IOCommandIsComplete</TT> stores the <TT CLASS="cv">status</TT> value in the I/O parameter block <TT CLASS="cv">result</TT> field. It also starts the next request if the driver isn't concurrent and there is a request queued. The driver should never try to modify <TT CLASS="cv">result</TT>. </P><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=16591"> </A>Note</b></p><P CLASS="Note"><A NAME="pgfId=3435"> </A>Under current versions of the Mac OS command ID == &amp;param block. Your driver should not rely on this always being true. </P></blockquote></DIV><H2 CLASS="RoH.RoutineHeadingTOC"><A HREF="PCI_BOOK.b1.html#pgfId=3436" CLASS="Hypertext">IOCommandIsComplete</A></H2><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.af.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.af.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.b1.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>