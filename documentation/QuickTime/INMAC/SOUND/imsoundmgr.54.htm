<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE>Allocating and Releasing Sound Channels (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.53.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.51.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.55.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="RH3.RoutineHd3"><A NAME="pgfId=3292"> </A>Allocating and Releasing Sound Channels</H1><P CLASS="T0.Text0"><A NAME="pgfId=2213"> </A>If you use a high-level Sound Manager routine to play sounds, you might be able to let the Sound Manager internally allocate a sound channel. However, to use low-level sound commands or to take full advantage of the Sound Manager's high-level routines, you must allocate your own sound channels. The <TT CLASS="cv">SndNewChannel</TT> function allows your application to allocate a new sound channel, and the <TT CLASS="cv">SndDisposeChannel</TT> function allows your application to dispose of it.</P><DIV><H2 CLASS="RoH.RoutineHeading"><A NAME="pgfId=2214"> </A><A NAME="10091"> </A>SndNewChannel<A NAME="marker=822"> </A></H2><P CLASS="T0.Text0"><A NAME="pgfId=3771"> </A>You can use the <TT CLASS="cv">SndNewChannel</TT> function to allocate a new sound channel.<A NAME="marker=1669"> </A></P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=12449"> </A>FUNCTION SndNewChannel (VAR chan: SndChannelPtr; synth: Integer; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init: LongInt; userRoutine: ProcPtr): <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR></CODE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12451"> </A><TT CLASS="cv">chan</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2263"> </A>A pointer to a sound channel record. You can pass a pointer whose value is <TT CLASS="cv">NIL</TT> to force the Sound Manager to allocate the sound channel record internally.</BLOCKQUOTE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12460"> </A><TT CLASS="cv">synth</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2264"> </A>The sound data type you intend to play on this channel. If you do not want to specify a specific data type, pass 0 in this parameter. You might do this if you plan to use the channel to play a single sound resource that itself specifies the sound's data type.</BLOCKQUOTE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12469"> </A><TT CLASS="cv">init</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2265"> </A>The desired initialization parameters for the channel. If you cannot determine what types of sounds you will be playing on the channel, pass 0 in this parameter. Only sounds defined by wave-table data and sampled-sound data currently use the <TT CLASS="cv">init</TT> options. You can use the <TT CLASS="cv">Gestalt</TT> function to determine if a sound feature (such as stereo output) is supported by a particular computer.</BLOCKQUOTE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12478"> </A><TT CLASS="cv">userRoutine</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2266"> </A> A pointer to a callback procedure that the Sound Manager executes whenever it receives a <TT CLASS="cv">callBackCmd</TT> command. If you pass <TT CLASS="cv">NIL</TT> as the <TT CLASS="cv">userRoutine</TT> parameter, then any <TT CLASS="cv">callBackCmd</TT> commands sent to this channel are ignored. </BLOCKQUOTE><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=2379"> </A>DESCRIPTION</H3><P CLASS="T0.Text0"><A NAME="pgfId=3773"> </A>The <TT CLASS="cv">SndNewChannel</TT> function internally allocates memory to store a queue of sound commands. If you pass a pointer to <TT CLASS="cv">NIL</TT> as the <TT CLASS="cv">chan</TT> parameter, the function also allocates a sound channel record in your application's heap and returns a pointer to that record. If you do not pass a pointer to <TT CLASS="cv">NIL</TT> as the <TT CLASS="cv">chan</TT> parameter, then that parameter must contain a pointer to a sound channel record.</P><P CLASS="T1.Text1"><A NAME="pgfId=2106"> </A>If you pass a pointer to <TT CLASS="cv">NIL</TT> as the <TT CLASS="cv">chan</TT> parameter, then the amount of memory the <TT CLASS="cv">SndNewChannel</TT> function allocates to store the sound commands is enough to store 128&nbsp;sound commands. However, if you pass a pointer to the sound channel record rather than a pointer to <TT CLASS="cv">NIL</TT>, the amount of memory allocated is determined by the <TT CLASS="cv">qLength</TT> field of the sound channel record. Thus, if you wish to control the size of the sound queue, you must allocate your own sound channel record. Regardless of whether you allocate your own sound channel record, the Sound Manager allocates memory for the sound command queue internally.</P><P CLASS="T1.Text1"><A NAME="pgfId=4660"> </A>The <TT CLASS="cv">synth</TT> parameter specifies the sound data type you intend to play on this channel. You can use these constants to specify the data type:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=12490"> </A>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;squareWaveSynth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{square-wave data}<BR>&nbsp;&nbsp;&nbsp;&nbsp;waveTableSynth&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{wave-table data}<BR>&nbsp;&nbsp;&nbsp;&nbsp;sampledSynth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 5;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{sampled-sound data}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=1995"> </A>In Sound Manager versions earlier than version 3.0, only one data type can be produced at any one time. As a result, <TT CLASS="cv">SndNewChannel</TT> may fail if you attempt to open a channel specifying a data type other than the one currently being played.</P><P CLASS="T1.Text1"><A NAME="pgfId=3876"> </A>To specify a sound output device other than the current sound output device, pass the value <TT CLASS="cv">kUseOptionalOutputDevice</TT> in the <TT CLASS="cv">synth</TT> parameter and the signature of the desired sound output device component in the <TT CLASS="cv">init</TT> parameter.</P><CODE CLASS="Cv.Code"><A NAME="pgfId=12494"> </A>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;kUseOptionalOutputDevice&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= -1;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3878"> </A><A NAME="marker=12496"> </A>The ability to redirect output away from the current sound output device is intended for use by specialized applications that need to use a specific sound output device. In general, your application should always send sound to the current sound output device selected by the user.</P></DIV><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3386"> </A>SPECIAL CONSIDERATIONS</H3><P CLASS="T0.Text0"><A NAME="pgfId=3387"> </A>Because the <TT CLASS="cv">SndNewChannel</TT> function allocates memory, you should not call it at interrupt time.</P></DIV><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3388"> </A>RESULT CODES</H3><TABLE><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLCv.MLCode"><A NAME="pgfId=3291"> </A>noErr</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLR.RtAlign"><A NAME="pgfId=4171"> </A>0</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="ML.ColsList"><A NAME="pgfId=4172"> </A>No error</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLCv.MLCode"><A NAME="pgfId=4173"> </A>resProblem</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLR.RtAlign"><A NAME="pgfId=4174"> </A>-204</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="ML.ColsList"><A NAME="pgfId=4176"> </A>Problem loading the resource</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLCv.MLCode"><A NAME="pgfId=4177"> </A>badChannel</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLR.RtAlign"><A NAME="pgfId=4178"> </A>-205</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="ML.ColsList"><A NAME="pgfId=4179"> </A>Channel is corrupt or unusable</P></TD></TR></TABLE></DIV><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=2468"> </A>SEE ALSO</H3><P CLASS="T0.Text0"><A NAME="pgfId=3129"> </A>For an example of a routine that uses the <TT CLASS="cv">SndNewChannel</TT> function, see <A target="doc" HREF="imsoundmgr.c.htm#18564" CLASS="XRef">Listing 1-11</A>.</P><P CLASS="T1.Text1"><A NAME="pgfId=3334"> </A><A NAME="marker=823"> </A>For information on the format of a callback procedure, see <A target="doc" HREF="imsoundmgr.5e.htm#37451" CLASS="XRef">&quot;Callback Procedures&quot;</A>.</P></DIV></DIV><DIV><H2 CLASS="RoH.RoutineHeading"><A NAME="pgfId=2215"> </A>SndDisposeChannel<A NAME="marker=824"> </A> <A NAME="marker=826"> </A></H2><P CLASS="T0.Text0"><A NAME="pgfId=3778"> </A>If you allocate a sound channel by calling the <TT CLASS="cv">SndNewChannel</TT> function, you must release the memory it occupies by calling the <TT CLASS="cv">SndDisposeChannel</TT> function. </P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=12500"> </A>FUNCTION SndDisposeChannel (chan: SndChannelPtr; <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quietNow: Boolean): OSErr;<BR></CODE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12502"> </A><TT CLASS="cv">chan</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2267"> </A>A pointer to a valid sound channel record.</BLOCKQUOTE><P CLASS="DT.DefinitionTerm"><A NAME="pgfId=12511"> </A><TT CLASS="cv">quietNow</TT></P><BLOCKQUOTE CLASS="DD.DefinitionDef"><A NAME="pgfId=2268"> </A>A Boolean value that indicates whether the channel should be disposed immediately (<TT CLASS="cv">TRUE</TT>) or after sound stops playing (<TT CLASS="cv">FALSE</TT>).</BLOCKQUOTE><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=2380"> </A>DESCRIPTION</H3><P CLASS="T0.Text0"><A NAME="pgfId=3780"> </A>The <TT CLASS="cv">SndDisposeChannel</TT> function disposes of the queue of sound commands associated with the sound channel specified in the <TT CLASS="cv">chan</TT> parameter. If your application created its own sound channel record in memory or installed a sound as a voice in a channel, the Sound Manager does not dispose of that memory. The Sound Manager also does not release memory associated with a sound resource that you have played on a&nbsp;channel. You might use the <TT CLASS="cv">userInfo</TT> field of the sound channel record to store the&nbsp;address of a sound handle you wish to release before disposing of the sound channel&nbsp;itself.</P><P CLASS="T1.Text1"><A NAME="pgfId=2107"> </A>The <TT CLASS="cv">SndDisposeChannel</TT> function can dispose of a channel immediately or wait until&nbsp;the queued commands are processed. If <TT CLASS="cv">quietNow</TT> is set to <TT CLASS="cv">TRUE</TT>, a <TT CLASS="cv">flushCmd</TT> command and then a <TT CLASS="cv">quietCmd</TT> command are sent to the channel bypassing the&nbsp;command queue. This removes all commands, stops any sound in progress, and closes the channel. If <TT CLASS="cv">quietNow</TT> is set to <TT CLASS="cv">FALSE</TT>, then the Sound Manager issues a <TT CLASS="cv">quietCmd</TT> command only; it does not bypass the command queue, and it waits until the&nbsp;<TT CLASS="cv">quietCmd</TT> command is processed before disposing of the channel.<A NAME="marker=684"> </A><A NAME="marker=685"> </A></P></DIV><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3390"> </A>SPECIAL CONSIDERATIONS</H3><P CLASS="T0.Text0"><A NAME="pgfId=3391"> </A>Because the <TT CLASS="cv">SndDisposeChannel</TT> function might dispose of memory, you should not call it at interrupt time.</P></DIV><DIV><H3 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=3389"> </A>RESULT CODES</H3><TABLE><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLCv.MLCode"><A NAME="pgfId=2469"> </A>noErr</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLR.RtAlign"><A NAME="pgfId=3326"> </A>0</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="ML.ColsList"><A NAME="pgfId=3777"> </A>No error</P></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLCv.MLCode"><A NAME="pgfId=4180"> </A>badChannel</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="MLR.RtAlign"><A NAME="pgfId=4181"> </A>-205</P></TD><TD ROWSPAN="1" COLSPAN="1"><P CLASS="ML.ColsList"><A NAME="pgfId=4182"> </A>Channel is corrupt or unusable<A NAME="marker=1372"> </A><A NAME="marker=1373"> </A></P></TD></TR></TABLE></DIV></DIV><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imsoundmgr.53.htm">Previous</A> | <A target="doc" HREF="imsoundmgr.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundmgr.htm">Chapter top</A> | <A target="doc" HREF="imsoundmgr.51.htm">Section top</A> | <A target="doc" HREF="imsoundmgr.55.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>