<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Byte Operations</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.1a2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1a2.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1a4.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=5014"> </A>Byte Operations</H1><P CLASS="T1.Text1"><A NAME="pgfId=5016"> </A>The Driver Services Library provides several 32-, 16-, and 8-bit <A NAME="marker=5015"> </A>atomic memory operations for use by device drivers. These routines take logical address pointers and ensure that the operations are atomic with respect to all devices (for example, other processors and DMA engines) that participate in the coherency architecture of the Power Macintosh system.</P><DIV><blockquote><p CLASS="ImportantHead"><b><A NAME="pgfId=20145"> </A>IMPORTANT</b></p><P CLASS="I.Important"><A NAME="pgfId=5017"> </A>Memory locations used by these operations must be long word aligned; if they are stored in a structure, you should use the compiler directive<TT CLASS="cv"> #pragma options align=power</TT>. </P> </blockquote><CODE CLASS="Cv.Code"><A NAME="pgfId=20149"> </A>Boolean<BR>CompareAndSwap (long oldValue, long newValue, long *Value);</CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=20155"> </A><br><br>SInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IncrementAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SInt32 *value);<BR>SInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DecrementAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SInt32 *value);</CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=20161"> </A><br><br>SInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SInt32 amount,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SInt32 *value);</CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=20167"> </A><br><br>UInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitAndAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt32 *value);<BR>UInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitOrAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt32 *value);<BR>UInt32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitXorAtomic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt32 *value);</CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=20173"> </A><br><br>SInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IncrementAtomic16&nbsp;&nbsp;&nbsp;(SInt16 *value);<BR>SInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DecrementAtomic16&nbsp;&nbsp;&nbsp;(SInt16 *value);<BR>SInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddAtomic16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SInt32 amount, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SInt16 *value);<BR>UInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitAndAtomic16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt16 *value);<BR>UInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitOrAtomic16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt16 *value);<BR>UInt16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitXorAtomic16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt16 *value);</CODE><CODE CLASS="Cv.Code"><A NAME="pgfId=20179"> </A><br><br>SInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IncrementAtomic8&nbsp;&nbsp;&nbsp;&nbsp;(SInt8 *value);<BR>SInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DecrementAtomic8&nbsp;&nbsp;&nbsp;&nbsp;(SInt8 *value);<BR>SInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddAtomic8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(SInt32 amount, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SInt8 *value);<BR>UInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitAndAtomic8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt8 *value);<BR>UInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitOrAtomic8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt8 *value);<BR>UInt8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BitXorAtomic8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(UInt32 mask, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UInt8 *value);</CODE><DIV><H6 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=5033"> </A><A NAME="25107"> </A>DESCRIPTION</H6><P CLASS="T1.Text1"><A NAME="pgfId=5034"> </A>The atomic routines perform various operations on the memory address specified by <TT CLASS="cv">value</TT>: </P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=5035"> </A>The <TT CLASS="cv">CompareAndSwap</TT> routine compares the value at the specified address with <TT CLASS="cv">oldValue</TT>. The value of <TT CLASS="cv">newValue</TT> is written to the specified address only if <TT CLASS="cv">oldValue</TT> and the value at the specified address are equal. <TT CLASS="cv">CompareAndSwap</TT> returns <TT CLASS="cv">true</TT> if <TT CLASS="cv">newValue</TT> is written to the specified address; otherwise, it returns <TT CLASS="cv">false</TT>. A <TT CLASS="cv">false</TT> return value does not imply that <TT CLASS="cv">oldValue</TT> and the value at the specified address are not equal; it only implies that <TT CLASS="cv">CompareAndSwap</TT> did not write <TT CLASS="cv">newValue</TT> to the specified address.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=5036"> </A><TT CLASS="cv">IncrementAtomic</TT> increments the value by 1 and <TT CLASS="cv">DecrementAtomic</TT> decrements it by 1. These functions return the value as it was before the change.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=5037"> </A><TT CLASS="cv">AddAtomic</TT> adds the specified amount to the value at the specified address and returns the result. </LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=5038"> </A><TT CLASS="cv">BitAndAtomic</TT> performs a logical <TT CLASS="cv">and</TT> operation between the bits of the specified mask and the value at the specified address, returning the result. Similarly, <TT CLASS="cv">BitOrAtomic</TT> performs a logical <TT CLASS="cv">OR</TT> operation and <TT CLASS="cv">BitXorAtomic</TT> performs a logical <TT CLASS="cv">XOR</TT> operation.</LI></UL></DIV><DIV><H6 CLASS="RSb.RoutineSbhd"><A NAME="pgfId=5039"> </A>EXECUTION CONTEXT</H6><P CLASS="T1.Text1"><A NAME="pgfId=5040"> </A>The atomic operation routines may be called from task level, secondary interrupt level, or hardware interrupt level.</P></DIV></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.1a2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1a2.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.1a4.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>