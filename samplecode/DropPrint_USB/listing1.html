<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>DropPrint USB - /DropShell.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; <A HREF="javascript:location.replace('index.html');">DropPrint USB</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/idxUSB-date.html" target="_blank">Hardware & Drivers > USB</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">DropPrint USB</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/DropShell.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/DropShell.c</option>
<option value="listing2.html">/DropShell.h</option>
<option value="listing3.html">/dropshell.r</option>
<option value="listing4.html">/DSAppleEvents.c</option>
<option value="listing5.html">/DSAppleEvents.h</option>
<option value="listing6.html">/DSGlobals.h</option>
<option value="listing7.html">/DSUserProcs.c</option>
<option value="listing8.html">/DSUserProcs.h</option>
<option value="listing9.html">/DSUtils.c</option>
<option value="listing10.html">/DSUtils.h</option>
<option value="listing11.html">/ListInDialog.c</option>
<option value="listing12.html">/ListInDialog.h</option>
<option value="listing13.html">/ListInDialog.r</option>
<option value="listing14.html">/Prefix.h</option>
<option value="listing15.html">/SafeNameRegistry.c</option>
<option value="listing16.html">/SafeNameRegistry.h</option>
<option value="listing17.html">/TestPrinterClass.c</option>
<option value="listing18.html">/TestPrinterClass.h</option></select>
				</p>
				</form>
				<p><strong><a href="DropPrint_USB.zip">Download Sample</a></strong> (&#147;DropPrint_USB.zip&#148;, 72.5K)<BR>
<strong><a href="DropPrint_USB.dmg">Download Sample</a></strong> (&#147;DropPrint_USB.dmg&#148;, 133.2K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/**********************************************************************************  Project Name:  DropShell**     File Name:  DropShell.c****   Description:  Main application code for the QuickShell***********************************************************************************                       A U T H O R   I D E N T I T Y***********************************************************************************  Initials  Name**  --------  -----------------------------------------------**  LDR      Leonard Rosenthol**  MTC      Marshall Clow**  SCS      Stephan Somogyi***********************************************************************************                      R E V I S I O N   H I S T O R Y***********************************************************************************    Date    Author  Description**  ---------  ------  ---------------------------------------------**  23 Jun  94  LDR    Implemented support for disk insertion events**  02 Feb  94  LDR    Updated for Final SDK &amp; CodeWarrior a2**            Removed the ResumeProc as per new Apple recommendations**  11 Dec 93  SCS    Universal Headers/UPPs (Phoenix 68k/PPC &amp; PPCC)**            Skipped System 6 compatible rev of DropShell source**  09 Dec 91  LDR    Added support for new &quot;Select File&quot; menu item**            Quit now sends AEVT to self to be politically correct**            Added support for the new gSplashScreen**  24 Nov 91  LDR    Added support for the Apple Menu (duh!)**  29 Oct 91  SCS    Changes for THINK C 5**  28 Oct 91  LDR    Officially renamed DropShell (from QuickShell)**            Added a bunch of comments for clarification**  06 Oct 91  MTC    Converted to MPW C**  09 Apr 91  LDR    Added to Projector********************************************************************************///#ifndef __MWERKS__//#include &lt;Desk.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Errors.h&gt;#include &lt;Files.h&gt;#include &lt;Fonts.h&gt;#include &lt;Memory.h&gt;#include &lt;Menus.h&gt;#include &lt;StandardFile.h&gt;#include &lt;TextEdit.h&gt;#include &lt;Types.h&gt;#include &lt;Windows.h&gt;#include &lt;DiskInit.h&gt;#include &lt;Devices.h&gt;//#endif#include &quot;DSGlobals.h&quot;#include &quot;DSUserProcs.h&quot;#include &quot;DSAppleEvents.h&quot;#include &quot;DropShell.h&quot;Boolean    gDone, gOApped, gHasAppleEvents, gWasEvent;EventRecord  gEvent;MenuHandle  gAppleMenu, gFileMenu;WindowPtr  gSplashScreen;QDGlobals  qd;#ifdef MPWextern void _DataInit();  #endif#pragma segment Initializevoid InitToolbox (void) {#ifdef MPW  UnloadSeg ((Ptr) _DataInit );#endif  InitGraf ( &amp;qd.thePort );  InitFonts ();  InitWindows ();  InitMenus ();  TEInit ();  InitDialogs (NULL);    // use of ResumeProcs no longer approved by Apple  InitCursor ();  FlushEvents ( everyEvent, 0 );    // how about some memory fun! Two should be enough!  MoreMasters ();  MoreMasters ();  }/*  Let's setup those global variables that the DropShell uses.    If you add any globals for your own use,  init them in the InitUserGlobals routine in DSUserProcs.c*/#pragma segment InitializeBoolean InitGlobals (void) {  long aLong;  gDone      = false;  gOApped      = false;  // probably not since users are supposed to DROP things!  gHasAppleEvents  = Gestalt ( gestaltAppleEventsAttr, &amp;aLong ) == noErr;  gSplashScreen  = NULL;  return(InitUserGlobals());  // call the user proc}/*  Again, nothing fancy.  Just setting up the menus.    If you add any menus to your DropBox - insert them here!*/#pragma segment Initializevoid SetUpMenus (void) {  gAppleMenu = GetMenu ( kAppleNum );  AppendResMenu ( gAppleMenu, 'DRVR' );  InsertMenu ( gAppleMenu, 0 );  gFileMenu = GetMenu ( kFileNum );  InsertMenu ( gFileMenu, 0 );  DrawMenuBar ();}/*  This routine is called during startup to display a splash screen.    This was recommend by the Blue Team HI person, John Sullivan, who  feels that all apps should display something so that users can easily  tell what is running, and be able to switch by clicking.  Thanks John!*/#pragma segment Initializevoid InstallSplashScreen(void) {  #define windowPicID  128  PicHandle  picH;  if (!gSplashScreen) {  // show the splash screen window    picH = GetPicture(windowPicID);    if (picH) {      gSplashScreen = GetNewWindow(windowPicID, NULL, (WindowPtr)-1L);      if (gSplashScreen) {        SetWindowPic(gSplashScreen, picH);        // Don't show it here, since we only want to it for oapp launches!        // ShowWindow(gSplashScreen);      }    }  }}/*  --------------- Standard Event Handling routines ---------------------- */#pragma segment Mainvoid ShowAbout () {  (void) Alert ( 128, NULL );  }#pragma segment Mainvoid DoMenu ( long retVal ) {  short  menuID, itemID;  Str255  itemStr;  menuID = HiWord ( retVal );  itemID = LoWord ( retVal );    switch ( menuID ) {    case kAppleNum:      if ( itemID == 1 )        ShowAbout ();  /*  Show the about box */      else      {        GetMenuItemText(GetMenuHandle(kAppleNum), itemID, itemStr);        OpenDeskAcc(itemStr);      }      break;          case kFileNum:      if ( itemID == 1 )        SelectFile();    // call file selection userProc      else        SendQuitToSelf();  // send self a 'quit' event      break;        default:      break;          }  HiliteMenu(0);    // turn it off!  }#pragma segment Mainvoid DoMouseDown ( EventRecord *curEvent ) {  WindowPtr  whichWindow;  short    whichPart;  whichPart = FindWindow ( curEvent-&gt;where, &amp;whichWindow );  switch ( whichPart ) {    case inMenuBar:      DoMenu ( MenuSelect ( curEvent-&gt;where ));      break;        case inSysWindow:      SystemClick ( curEvent, whichWindow );      break;        case inDrag:      {        Rect  boundsRect = (*GetGrayRgn())-&gt;rgnBBox;        DragWindow ( whichWindow, curEvent-&gt;where, &amp;boundsRect );      }    default:      break;    }  }#pragma segment Mainvoid DoKeyDown ( EventRecord *curEvent ) {  if ( curEvent-&gt;modifiers &amp; cmdKey )    DoMenu ( MenuKey ((char) curEvent-&gt;message &amp; charCodeMask ));  }#pragma segment Mainvoid main ( ) {  InitToolbox ();  if ( InitGlobals () ) {  // if we succeeding in initting self    if ( !gHasAppleEvents )      ErrorAlert ( kErrStringID, kCantRunErr, 0 );    else {      InitAEVTStuff ();      SetUpMenus ();      //&lt;oja&gt; InstallSplashScreen ();            while ( !gDone ) {        gWasEvent = WaitNextEvent ( everyEvent, &amp;gEvent, 0, NULL );        if ( gWasEvent ) {          switch ( gEvent.what ) {            case kHighLevelEvent:              DoHighLevelEvent ( &amp;gEvent );              break;                          case mouseDown:              DoMouseDown ( &amp;gEvent );              break;                          case keyDown:            case autoKey:              DoKeyDown ( &amp;gEvent );              break;            case diskEvt:              if (HiWord(gEvent.message)) {                Point diskInitPt;                                diskInitPt.v = diskInitPt.h = 100;                DILoad();                DIBadMount(diskInitPt, gEvent.message);                DIUnload();              }              break;                          default:              break;          }        }      }    }    DisposeUserGlobals();  // call the userproc to clean itself up  }}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/DropPrint_USB/listing1.html%3Fid%3DDTS10000288-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/DropPrint_USB/listing1.html%3Fid%3DDTS10000288-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/DropPrint_USB/listing1.html%3Fid%3DDTS10000288-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>