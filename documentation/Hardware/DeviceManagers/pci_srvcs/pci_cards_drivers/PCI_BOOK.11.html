<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Maximizing PCI Bus Performance</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.5.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.10.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.12.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H1.Heading1"><A NAME="pgfId=3745"> </A>Maximizing PCI Bus Performance</H1><P CLASS="T1.Text1"><A NAME="pgfId=3746"> </A>The guidelines in this section examine the PCI bus commands, the operation of the PowerPC processor to PCI interface bridge chip, achievable PCI bandwidth on PCI Power Macintosh computers, and finally, Mac OS services available to maximize PCI bandwidth. <A NAME="marker=3747"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=3748"> </A>A good place to start addressing PCI performance on Power Macintosh CPUs is the PCI standard itself. The PCI Bus Specification features a 32-bit data path -- upgradeable to 64-bits -- with synchronous bus operation up to 33 Mhz, and the ability to transfer a data object on the raising edge of each PCI clock cycle. Assuming that neither the initiator nor the target inserts wait states during each data phase, the maximum theoretical bandwidth over a 32-bit bus is 132 Mbytes/second. This also assumes continuous bursting with a 32-bit data object transferred on each PCI clock cycle. (Apple's implementation incorporates a 32-bit data bus.)</P><P CLASS="T1.Text1"><A NAME="pgfId=3749"> </A>Because the IB chip competes for system memory along with other system devices, continuous PCI bursting is not possible. Therefore, the achievable PCI bandwidth on Power Macintosh computers is less than the PCI theoretical maximum. Also, the bandwidth is dependent on the PCI target's hardware design and the architecture of the driver software.</P><P CLASS="T1.Text1"><A NAME="pgfId=3750"> </A>A PCI burst transfer is defined by one PCI bus transaction with a signal address phase followed by two or more data phases. One may ask, how can the bus master transfer a data object on each PCI clock cycle? To initiate a bus transaction, the PCI master only has to arbitrate for ownership of the bus one time. The master then issues the start address and transaction type during the address phase. It is the responsibility of the target device to latch the start address into an address counter and increment the addressing from data phase to data phase. (A single-beat read or write transaction is defined by a signal address phase followed by only one data phase.)</P><P CLASS="T1.Text1"><A NAME="pgfId=3751"> </A>For data to be transferred between the PowerPC processor and the PCI target, or for the PCI target to transfer data between system memory, one of the commands shown in <A HREF="PCI_BOOK.11.html#39187" CLASS="XRef">Table&nbsp;1-4</A> is initiated.</P><b><P CLASS="Tb.Table"><A NAME="pgfId=3758"> </A>Table&nbsp;1-4	<A NAME="39187"> </A>Commands between PowerPC processor and PCI bus</P></b><TABLE border=1 cellpadding=3><TR><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=3762"> </A>PCI command</P></TH><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=3764"> </A>Initiator</P></TH></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3766"> </A>I/O Read</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3768"> </A>Processor generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3770"> </A>I/O Write</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3772"> </A>Processor generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3774"> </A>Configuration Read</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3776"> </A>Processor generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3778"> </A>Configuration Write</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3780"> </A>Processor generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3782"> </A>Memory Read</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3784"> </A>Processor or PCI Master generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3786"> </A>Memory Read Line</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3788"> </A>Processor or PCI Master generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3790"> </A>Memory Read Multiple</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3792"> </A>Processor or PCI Master generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3794"> </A>Memory Write</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3796"> </A>Processor or PCI Master generated</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3798"> </A>Memory Write and Invalidate</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=3800"> </A>Processor or PCI Master generated</FONT></TD></TR></TABLE><P CLASS="T1.Text1"><A NAME="pgfId=3801"> </A>The I/O Read and I/O Write commands are used to transfer data between the PowerPC processor and the target's I/O space.</P><P CLASS="T1.Text1"><A NAME="pgfId=3802"> </A>The Configuration Read and Configuration Write commands are used to transfer data between the PowerPC processor and the PCI target's configuration registers during system initialization.</P><P CLASS="T1.Text1"><A NAME="pgfId=3803"> </A>The Memory Read and Memory Write commands are used to transfer data between the PCI Master and the target's memory space.</P><P CLASS="T1.Text1"><A NAME="pgfId=3804"> </A>The Memory Read Line command is used by the PCI Master to transfer a cache line of data from the PCI target's memory space.</P><P CLASS="T1.Text1"><A NAME="pgfId=3805"> </A>The Memory Read Multiple command is used by the PCI Master to transfer more than one cache line of data from the PCI Target's memory space.</P><P CLASS="T1.Text1"><A NAME="pgfId=3806"> </A>The Memory Write and Invalidate command is used by the PCI Master to transfer one or more complete cache lines of data to the PCI target's memory space.</P><P CLASS="T1.Text1"><A NAME="pgfId=3807"> </A>A cache line is 32-bytes for Apple Power Macintosh computers.</P><H2 CLASS="H2.Heading2TOC"><A HREF="PCI_BOOK.12.html#pgfId=3808" CLASS="Hypertext">PowerPC Processor and PCI Commands</A></H2><H2 CLASS="H2.Heading2TOC"><A HREF="PCI_BOOK.13.html#pgfId=3815" CLASS="Hypertext">Bursting from PowerPC to PCI</A></H2><H2 CLASS="H2.Heading2TOC"><A HREF="PCI_BOOK.14.html#pgfId=3820" CLASS="Hypertext">Bursting from PCI to PowerPC</A></H2><H2 CLASS="H2.Heading2TOC"><A HREF="PCI_BOOK.15.html#pgfId=4021" CLASS="Hypertext">Mac OS &amp; Services That Maximize PCI Throughput</A></H2><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.5.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.10.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.12.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>