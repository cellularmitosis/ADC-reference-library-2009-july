<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>AppleScript Studio Programming Guide: Mail Search Tutorial: Design the Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Mail Search Tutorial: Design the Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001254" title="Mail Search Tutorial: Design the Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/AppleScript-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000481" target="_top">AppleScript</a> &gt; <a href="../chapter01/studio_intro_book.html#//apple_ref/doc/uid/20001248-TPXREF101">AppleScript Studio Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../chapter06/studio_cur_converter.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../chapter08/studio_ms_create_intf.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/20001254-TPXREF101" title="Mail Search Tutorial: Design the Application"></a><h1>Mail Search Tutorial: Design the Application</h1><p>In this chapter you’ll use AppleScript Studio to design a fairly complex AppleScript Studio application called Mail Search. Mail Search searches for text in messages in the Mac OS X Mail application. You’ll design Mail Search by performing the steps described in the following sections:</p><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_37" title="Note"></a><p><strong>Note:</strong>&nbsp; The Mail Search sample application distributed with AppleScript Studio was formerly known as “Watson”.</p></div><ol class="ol"><li class="li"><p><span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCIHJHJI">“Identify a Goal for the Application.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-TPXREF150">“Examine Mail’s Scripting Dictionary.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-TPXREF151">“Specify Operations for Mail Search.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-TPXREF152">“Design the Interface.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCIGJAJC">“Plan the Code.”</a></span></p></li></ol><p>You’ll complete the Mail Search application in the following chapters:</p><ul class="simple"><li><p><span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF101">“Mail Search Tutorial: Create the Interface”</a></span></p></li><li><p><span class="content_text"><a href="../chapter09/studio_ms_connect_intf.html#//apple_ref/doc/uid/20001256-TPXREF101">“Mail Search Tutorial: Connect the Interface”</a></span></p></li><li><p><span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF101">“Mail Search Tutorial: Write the Code”</a></span></p></li><li><p><span class="content_text"><a href="../chapter11/studio_ms_build_debug.html#//apple_ref/doc/uid/20001258-TPXREF101">“Mail Search Tutorial: Build and Test the Application”</a></span></p></li><li><p><span class="content_text"><a href="../chapter12/studio_ms_customize.html#//apple_ref/doc/uid/20001259-TPXREF101">“Mail Search Tutorial: Customize the Application”</a></span></p></li></ul><p>This organization demonstrates a design decision to use separate steps to create the interface, connect it, and write scripts to perform operations. Working in this manner is appropriate for a tutorial, where the outcome is known in advance, but once you’re familiar with AppleScript Studio, it may not be the most convenient way to design your own applications. Instead, you may choose to work more incrementally, adding part of the interface, connecting it to a handler, and testing (even if only with diagnostic statements to show that program flow is working properly). This tutorial points out places where you might choose to build and test the application in the normal course of development.</p><a name="//apple_ref/doc/uid/20001254-TPXREF207" title="Before You Start This Tutorial"></a><h2>Before You Start This Tutorial</h2><p>Before starting the Mail Search tutorial, it is recommended that you complete the <span class="content_text"><a href="../chapter06/studio_cur_converter.html#//apple_ref/doc/uid/20001253-TPXREF101">“Currency Converter Tutorial,”</a></span> read <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-TPXREF101">“AppleScript Studio Components,”</a></span> and experiment with some of the sample applications described in <span class="content_text"><a href="../chapter02/studio_about_book.html#//apple_ref/doc/uid/20001249-CJBJBFAA">“AppleScript Studio Sample Applications.”</a></span> In particular, the Table and Outline sample applications demonstrate how to work with table view and outline view objects. </p><a name="//apple_ref/doc/uid/20001254-BCIHJHJI" title="Identify a Goal for the Application"></a><h2>Identify a Goal for the Application</h2><p>If you’re a regular user of the Mac OS X Mail application, you may know that it has a convenient feature for finding specified text in the messages within a mailbox, but prior to Mac OS X version 10.2, it could only search one mailbox at a time. Suppose you recently got mail from a friend and couldn’t remember if you filed it in Personal Mail, To Do List, Read Later, or some other mailbox. You could look for the message in any single mailbox by searching for your friend’s name, or for a word or phrase you remember from the message. You could specify what part of the message to search—Subject, To, From, or Entire message text—but there was no option to search more than one mailbox at a time.</p><p>Well, many users had to wait for Mac OS X version 10.2 to be able to search across mailboxes. But AppleScript Studio supplied this feature in Mac OS X version 10.1, through the Mail Search application, one of the sample applications distributed with AppleScript Studio. And though this feature is now built in to Mail, the Mail Search application still provides a useful introduction to a full-featured AppleScript Studio application.</p><p>In this tutorial, you’ll perform all the steps required to design and build the Mail Search application. In the process, you’ll gain experience with many AppleScript Studio features, including</p><ul class="ul"><li class="li"><p>working with document-based applications</p></li><li class="li"><p>creating and connecting complex user interface objects, using multiple nib files</p></li><li class="li"><p>writing scripts to control outline and table views, progress bars, and other interface objects</p></li><li class="li"><p>incorporating script objects in an application</p></li><li class="li"><p>building AppleScript Studio applications</p></li></ul><p>While designing and building the Mail Search application may prove a challenging task, by the time you complete the tutorial you should have a good grasp of many of the key tools and concepts needed to build AppleScript Studio applications. And even if you don’t work through every step of the tutorial, you can browse it to find tips for performing specific tasks.</p><a name="//apple_ref/doc/uid/20001254-TPXREF150" title="Examine Mail&acirc;&#128;&#153;s Scripting Dictionary"></a><h2>Examine Mail’s Scripting Dictionary</h2><p>Before you can design an AppleScript Studio application to script the Mail application, you need to know what scripting terminology Mail supports. To examine Mail’s scripting dictionary, do the following:</p><ol class="ol"><li class="li"><p>Open Xcode.</p></li><li class="li"><p>Choose Open Dictionary from the File menu.</p></li><li class="li"><p>Choose the Mail application. If it doesn’t show up among the available scriptable applications, you can navigate to it by clicking the Browse button. The application itself is located in <code>/Applications</code>.</p></li></ol><p>You’ll find more information on examining scripting dictionaries in <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-BAJBFHJJ">“Terminology Browser.”</a></span> <span class="content_text">Figure 6-1</span> shows Mail’s scripting dictionary in an Xcode pane. (You can also open dictionaries in the Script Editor application. Both applications provide the same information.)</p><br/><div><a name="//apple_ref/doc/uid/20001254-BCIGAFAI" title="Figure 6-1The Mail application&acirc;&#128;&#153;s scripting dictionary in an Xcode window"></a><p><strong>Figure 6-1&nbsp;&nbsp;</strong>The Mail application’s scripting dictionary in an Xcode window</p><img src = "../art/mail_dct_view.gif" alt = "The Mail application’s scripting dictionary in an Xcode window" width="965" height="637"></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_38" title="Note"></a><p><strong>Note:</strong>&nbsp;The scripting terminology for the Mail application changed with Mac OS X version 10.2. The scripts and examples created prior to that version differ from their counterparts today. The listings shown in this document reflect terminology revisions through Mac OS X version 10.3.</p></div><p><span class="content_text">Figure 6-1</span> shows several terminology suites, or collections of related classes and events. The Standard Suite and Text Suite are default suites that all Cocoa applications get just by turning on scripting (as described in <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-TPXREF168">“Cocoa Scripting Support”</a></span>). The Mail and Message suites are specific to Mail. Take some time to examine the classes and events available in each suite. Mail Search is likely to require scripting terms from the Mail and Message suites, as well as terms from the Standard suite, such as <code>get</code> and <code>set</code>.</p><p>For example, to search through messages in all mailboxes, Mail Search has to access:</p><ul class="ul"><li class="li"><p>accounts (elements of the application class in the Mail suite)</p></li><li class="li"><p>the mailboxes they contain (elements of the account class)</p></li><li class="li"><p>the messages (elements of the mailbox class) in those mailboxes</p></li></ul><p>Look for other classes whose properties and elements Mail Search might need, as well as for events that may be useful. As it turns out, Mail Search doesn’t require any events from the Message or Mail suites, but does use events from the Standard Suite (which includes such built-in AppleScript commands as <code>get</code> and <code>set</code>). In fact, Mail Search uses the <code>get</code> command extensively to get accounts, mailboxes, and messages.</p><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_39" title="Note"></a><p><strong>Note:</strong>&nbsp;See <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-BAJBFHJJ">“Terminology Browser”</a></span> for a description of how AppleScript Studio distinguishes between events and commands.</p></div><a name="//apple_ref/doc/uid/20001254-TPXREF151" title="Specify Operations for Mail Search"></a><h2>Specify Operations for Mail Search</h2><p>The goal of the Mail Search application is to search multiple Mail application mailboxes for specified text. A Mail user can have multiple mail accounts—for example, an IMAP account for work-related email, a POP account from an Internet service provider, and perhaps additional accounts as well. Each account can have multiple mailboxes, including mailboxes within other mailboxes.</p><p>A user should be able to search all or a selected group of mailboxes and to specify which part of the messages to search: Subject, To, From, or Contents (in Mail, the equivalent of Contents is “Entire message text”). For lengthy operations, Mail Search should display a progress bar. On completion of a search, Mail Search should display a list of messages that contain the specified text. Columns in the list should display the From and Subject fields, as well as the name of the mailbox the message is in.</p><p>Finally, a user must be able to read individual messages that contain the search text. Because Mail’s scripting support doesn't currently support opening an individual message in a Mail window, Mail Search can instead display a message in a separate window it creates.</p><p>Based on this analysis, Mail Search’s requirements can be summarized as follows:</p><ul class="ul"><li class="li"><p>Mail Search can obtain and display a list of all mailboxes from all accounts.</p></li><li class="li"><p>A user can specify which mailboxes to search, by specifying one or more of the available mailboxes.</p></li><li class="li"><p>A user can specify text to search for.</p></li><li class="li"><p>A user can specify where to search from the following choices:</p><ul class="nested"><li class="nested li"><p>Subject field</p></li><li class="nested li"><p>To field</p></li><li class="nested li"><p>From field</p></li><li class="nested li"><p>Contents of message</p></li></ul></li><li class="li"><p>Mail Search can find and display all messages containing the specified text. The result list includes</p><ul class="nested"><li class="nested li"><p>From</p></li><li class="nested li"><p>Subject</p></li><li class="nested li"><p>Mailbox name</p></li></ul></li><li class="li"><p>A user can double-click a message in the result list to open it in a separate window.</p></li><li class="li"><p>During long operations, such as searching through multiple mailboxes and potentially thousands of messages, Mail Search can provide feedback on its progress.</p></li></ul><p>As you’ll see in later sections, the Cocoa application framework and the Cocoa user interface objects you use to implement Mail Search have many built-in features. As a result, Mail Search automatically gains many capabilities not listed here.</p><a name="//apple_ref/doc/uid/20001254-TPXREF152" title="Design the Interface"></a><h2>Design the Interface</h2><p>One way to design an interface is to perform these simple steps:</p><ol class="ol"><li class="li"><p>Figure out what the application does so that you can describe what information and user actions the interface must be able to handle.</p><p>This step has already been completed, in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-TPXREF151">“Specify Operations for Mail Search.”</a></span></p></li><li class="li"><p>Identify the kinds of user interface widgets you might use to implement the interface.</p><p>AppleScript Studio supplies plenty of widgets—namely all of Cocoa’s user interface objects. This step is described in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCICHIIG">“Identify Objects for the User Interface.”</a></span></p></li><li class="li"><p>Arrange the widgets in a pleasing format. This step is described in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCICCEHH">“Arrange the User Interface.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/20001254-BCICHIIG" title="Identify Objects for the User Interface"></a><h3>Identify Objects for the User Interface</h3><p>Before specifying requirements for Mail Search, which works closely with the Mail application, you investigated the scriptable features supported by Mail. Similarly, before designing Mail Search’s interface, you should investigate the user interface objects available to AppleScript Studio applications. <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-BAJHAAGF">“Cocoa User Interface Objects”</a></span> describes how to view user interface objects in the Palettes window in Interface Builder. You can also take a look various sample applications distributed with AppleScript Studio, including Browser and Outline, which demonstrate the use of column and outline views that imitate the Finder’s column and list views. For more information on the sample applications, see <span class="content_text"><a href="../chapter02/studio_about_book.html#//apple_ref/doc/uid/20001249-CJBJBFAA">“AppleScript Studio Sample Applications.”</a></span></p><p>To help narrow the search for objects, here are Mail Search’s requirements from a previous section, along with recommended user interface objects, as well as the script suite to which each object class belongs (where you can examine the scripting terminology for that object):</p><ul class="spaceabove"><li class="li"><p>Mail Search can obtain and display a list of all mailboxes from all accounts.</p><p>To display a list of mailboxes, consider using an outline view (from the Data View suite). An outline view can display hierarchical data, similar to the way the Finder displays folders and files in a list view. You can build the Outline sample application to see an outline view in action.</p><p>To avoid unnecessary complexity in this tutorial, Mail Search only uses one layer of nesting in the outline view.</p></li><li class="li"><p>A user can specify which mailboxes to search, including a single mailbox, a subset, or all mailboxes.</p><p>An outline view, as a subclass of the table view class (both belong to the Data View suite), automatically supports row selection.</p></li><li class="li"><p>A user can specify text to search for.</p><p>A text field (from the Control View suite) is the obvious choice for obtaining text from a user.</p><p>In addition, Mail Search can use a button (also from the Control View suite) to initiate the search.</p></li><li class="li"><p>A user can specify where to search:</p><ul class="nested"><li class="nested li"><p>Subject field</p></li><li class="nested li"><p>To field</p></li><li class="nested li"><p>From field</p></li><li class="nested li"><p>Contents of message</p></li></ul><p>A good way to choose one item from a small number of items is a pop-up menu, which is supported by the popup button class (from the Control View suite). By using a pop-up menu, Mail Search mimics Mail’s implementation of this feature.</p></li><li class="li"><p>Mail Search can find and display all messages containing the specified text.</p><p>There are several aspects of a found message that a user might like to see, including who it’s from, the subject, and the mailbox where it is stored. In fact, the interface for displaying messages should look similar to the ones that display mail in Mail and similar applications.</p><p>A table view (from the Data View suite) is a good choice for displaying rows and columns of data. You can build the Tables sample application (distributed with AppleScript Studio) to see a table view in action. The Tables application demonstrates two ways to work with table views: using a data source object to supply table data (the approach Mail Search uses), and operating without a data source (supplying the data directly from a script).</p><p>A data source object is a special object supplied by AppleScript Studio to supply row and column data to a table or outline view. Data source objects are available from the AppleScript pane of Interface Builder’s Palette window.</p></li><li class="li"><p>A user can double-click a message in the result list to open it in a separate window.</p><p>As a simple solution for displaying text in a separate window, you can use a window object containing a text view (from the Text View suite). Though it is easy to implement, a text view supports many operations on the displayed messages, including Cut, Paste, and even Undo.</p></li><li class="li"><p>During long operations, such as searching through multiple mailboxes and potentially thousands of messages, Mail Search should provide feedback on its progress.</p><p>A progress bar (from the Control View suite) provides a standard mechanism for user feedback. Combined with a text field, it can provide both determinate (the total time is known and the bar moves from left to right proportional to the percentage of the task completed) and indeterminate (the total time is not known, and a striped cylinder spins continually) progress bars, as well as text messages.</p><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_40" title="Note"></a><p><strong>Note:</strong>&nbsp;The AppleScript Studio terminology for a progress bar is <code>progress indicator</code>; that term is used in Mail Search’s script file.</p></div></li></ul><p>You’ve now got a good start on the objects you’ll use for Mail Search’s user interface. In later sections, you’ll read about a few additional objects you’ll need that work together with those described here.</p><a name="//apple_ref/doc/uid/20001254-BCICCEHH" title="Arrange the User Interface"></a><h3>Arrange the User Interface</h3><p>There are any number of ways to sketch out a user interface, from the legendary napkin sketch to laying out actual interface objects in a tool such as Interface Builder. This section presents Interface Builder snapshots of the prospective Mail Search interface. Keep in mind that these illustrations represent just one solution for the specified requirements. Other solutions are certainly possible; feel free to look for changes and improvements as you work through this tutorial and gain knowledge of the interface objects available in AppleScript Studio.</p><p><span class="content_text">Figure 6-2</span> shows the Interface Builder definition for Mail Search’s main window, the search window. It contains a pop-up menu to specify where to search, a text field to specify the text to search for, a button to start the search, an outline view to show the available mailboxes, and a table view to display the messages found by the search. The outline view and table view contain sample entries inserted by Interface Builder to help display the views’ rows and columns. This data is not displayed in the application. </p><p>You’ll learn how to create each of the interface objects shown in the search window in <span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF168">“Create the Search Window.”</a></span> The search window also contains the standard close, minimize, and zoom buttons. This set of buttons is just one of the many features you'll get automatically in an AppleScript Studio application.</p><br/><div><a name="//apple_ref/doc/uid/20001254-BCIJGGCH" title="Figure 6-2Mail Search&acirc;&#128;&#153;s search window in Interface Builder"></a><p><strong>Figure 6-2&nbsp;&nbsp;</strong>Mail Search’s search window in Interface Builder</p><img src = "../art/watson_final_search.gif" alt = "Mail Search’s search window in Interface Builder" width="559" height="489"></div><br/><p><span class="content_text">Figure 6-3</span> shows the status dialog that Mail Search displays during lengthy operations, such as gathering a list of mailboxes or searching through a large number of messages. Mail Search displays the status dialog as a sheet attached to the main window, not as a separate window. You’ll learn how to create each of the interface objects shown in the status dialog in <span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF168">“Create the Search Window.”</a></span></p><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_41" title="Note"></a><p><strong>Note:</strong>&nbsp;You’ll have to get use to a bit of naming inconsistency when working with the status dialog. The Mail Search application often refers to the status dialog as a status panel because you use an object that Interface Builder calls a Panel to create the status dialog. Whether you see status dialog or status panel, you’ll know it refers to the same object.</p></div><br/><div><a name="//apple_ref/doc/uid/20001254-BCIDIFEE" title="Figure 6-3A status dialog in Interface Builder"></a><p><strong>Figure 6-3&nbsp;&nbsp;</strong>A status dialog in Interface Builder</p><img src = "../art/watson_final_status.gif" alt = "A status dialog in Interface Builder" width="293" height="121"></div><br/><p><span class="content_text">Figure 6-4</span> shows the MainMenu instance from Mail Search’s <code>MainMenu.nib</code> file as it appears in Interface Builder. The application menu is open, showing the items in that menu. Mail Search uses the default menu nib created for an AppleScript Studio application, changing only the names of certain menu items shown in <span class="content_text">Figure 6-4</span>. You’ll learn how to create this nib in <span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF163">“Create the Message Window”</a></span> and how to modify it in <span class="content_text"><a href="../chapter12/studio_ms_customize.html#//apple_ref/doc/uid/20001259-BCIIAFBC">“Customize Menus.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/20001254-BCIBBFIE" title="Figure 6-4Mail Search&acirc;&#128;&#153;s menu nib in Interface Builder, showing the application menu"></a><p><strong>Figure 6-4&nbsp;&nbsp;</strong>Mail Search’s menu nib in Interface Builder, showing the application menu</p><img src = "../art/watson_menus.gif" alt = "Mail Search’s menu nib in Interface Builder, showing the application menu" width="322" height="262"></div><br/><p><span class="content_text">Figure 6-5</span> shows a Mail Search message window as it appears in Interface Builder. When a user double-clicks a message in Mail Search’s search window, Mail Search opens a message window to display the message text. You will learn how to create this window in <span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF163">“Create the Message Window.”</a></span> </p><br/><div><a name="//apple_ref/doc/uid/20001254-BCICJDCA" title="Figure 6-5A Mail Search message window in Interface Builder"></a><p><strong>Figure 6-5&nbsp;&nbsp;</strong>A Mail Search message window in Interface Builder</p><img src = "../art/watson_final_msg.gif" alt = "A Mail Search message window in Interface Builder" width="577" height="438"></div><br/><p>The interface items shown in this section form the basic user interface for the Mail Search application.</p><a name="//apple_ref/doc/uid/20001254-BCIGJAJC" title="Plan the Code"></a><h2>Plan the Code</h2><p>Although you won’t write scripts and handlers for Mail Search until you’ve completed several additional tasks, it makes sense to spend a little time now thinking about the application’s code. A look at dependencies between the code and the interface provides useful background for building the interface and connecting it to handlers in application script files.</p><div class="notebox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_42" title="Note"></a><p><strong>Note:</strong>&nbsp;Mail Search has a tiny dab of Objective-C code in its <code>main</code> routine, and there is a lot of Cocoa code working behind the scenes to implement user interface objects and application operations. But the code you’ll design for Mail Search consists of only handlers and script objects, and the script statements they contain.</p></div><p>Because every AppleScript Studio application is built on the Cocoa application architecture, Mail Search can perform many operations automatically, without any additional effort on your part. For example, users can open multiple windows, resize and minimize windows, enter text, and even shuffle the position of the From, Subject, and Mailbox columns in the list of found messages. To experiment with the features you get in the simplest document-based AppleScript Studio application, even before adding any of Mail Search’s user interface, follow the steps in <span class="content_text"><a href="../chapter08/studio_ms_create_intf.html#//apple_ref/doc/uid/20001255-TPXREF153">“Create a Project.”</a></span></p><p>AppleScript Studio applications also have the ability to connect user actions and other events in the application to handlers in scripts. As you saw in <span class="content_text"><a href="../chapter03/studio_components.html#//apple_ref/doc/uid/20001250-BAJBFHJJ">“Terminology Browser,”</a></span> user interface objects in AppleScript Studio applications can respond to a variety of events and contain many scriptable elements and properties. In planning the code for Mail Search, you’ll need to identify the events that Mail Search responds to.</p><p>To summarize Mail Search briefly, it opens a search window, connects to the Mail application (opening it if necessary), obtains a list of available mailboxes, and displays them. At that point, it waits for user input and responds accordingly, by opening new search windows, selecting mailboxes to search, initiating a search, displaying results, and so on.</p><p>To perform these operations, Mail Search needs two kinds of handlers:</p><ul class="ul"><li class="li"><p>Handlers that respond directly to user actions (such as the opening or closing of a window) or changes of state in the application (such as completion of application launch). These handlers, called event handlers (as defined in <span class="content_text"><a href="../chapter02/studio_about_book.html#//apple_ref/doc/uid/20001249-CJBGGJHD">“Connecting Actions to Scripts”</a></span>), are identified in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCIHEBHE">“Event Handlers in Mail Search.”</a></span></p></li><li class="li"><p>Handlers that are not necessarily called to respond to an event, but rather perform basic tasks in the application, such as obtaining a list of available mailboxes, displaying a status dialog, and so on. These handlers are typically called from event handlers. These handlers are identified in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCICFHJC">“Additional Handlers and Scripts in Mail Search.”</a></span></p></li></ul><p>Because AppleScript Studio provides so much built-in support, Mail Search won’t require as much code as you might expect. For a full listing of Mail Search’s script file, <code>Mail Search.applescript</code>, see <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF101">“Mail Search Tutorial: Write the Code.”</a></span></p><div class="importantbox"><a name="//apple_ref/doc/uid/20001254-DontLinkElementID_43" title="Important:"></a><p><strong>Important:</strong>&nbsp;Before implementing any of the handlers or other script statements shown in the Mail Search tutorial chapters, you should read the section <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF218">“Obtaining the Code for the Mail Search Tutorial.”</a></span></p><p></p></div><a name="//apple_ref/doc/uid/20001254-BCIHEBHE" title="Event Handlers in Mail Search"></a><h3>Event Handlers in Mail Search</h3><p>Most interaction with user interface items takes place in the search window, and you’ve already identified the objects for that window in <span class="content_text"><a href="studio_ms_design_app.html#//apple_ref/doc/uid/20001254-BCICHIIG">“Identify Objects for the User Interface.”</a></span> Working from those objects, you can identify events the objects must handle and the event handlers for those events:</p><ul class="spaceabove"><li class="li"><p><strong>The search window:</strong> Mail Search needs to know when a window is opened, when it is activated, and when it is closed. The corresponding event handlers are:</p><ul class="nested"><li class="nested li"><p><code>will open</code>: This event handler is called after a window is instantiated from a nib file and before it is opened. Mail Search can use this handler to perform any initialization associated with the search window that can’t be stored with the nib file.</p></li><li class="nested li"><p><code>became main</code>: This event handler is called when a window becomes the main window (the front window and principal focus of user action), such as when a window is first opened or when a user switches back to the application. The main window is typically (but not always) also the key window (or first recipient for keystrokes). Mail Search can use this handler to perform any required tasks prior to the search window becoming main, such as checking whether the available mailboxes have been loaded.</p></li><li class="nested li"><p><code>will close</code>: This event handler is called before a window is closed. Mail Search can use it to perform any cleanup when a search window is closed.</p></li></ul></li><li class="li"><p><strong>The search text field:</strong> Mail Search needs to know when a user presses the Return key so it can initiate a search. It can do so by implementing an <code>action</code> event handler.</p></li><li class="li"><p><strong>The find button:</strong> Mail Search also needs to know when a user clicks the find button so it can initiate a search. It can do so by implementing a <code>clicked</code> event handler.</p></li><li class="li"><p><strong>The search results table view:</strong> Mail Search should open a message window when a user double-clicks on a message. It can handle this event by implementing a <code>double-clicked</code> event handler.</p></li><li class="li"><p><strong>The application object:</strong> Mail Search needs to perform certain initialization tasks after the application has unarchived its user interface objects from the nib file but before it enters its main routine. It can achieve this goal by implementing a <code>will finish launching</code> event handler.</p></li></ul><p>You’ll connect objects to these event handlers in <span class="content_text"><a href="../chapter09/studio_ms_connect_intf.html#//apple_ref/doc/uid/20001256-TPXREF155">“Connect the Interface”</a></span> and write the handlers in <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF156">“Write Event Handlers for the Interface.”</a></span></p><a name="//apple_ref/doc/uid/20001254-BCICFHJC" title="Additional Handlers and Scripts in Mail Search"></a><h3>Additional Handlers and Scripts in Mail Search</h3><p>A <strong>script object</strong> is a user-defined object, combining data (in the form of properties) and handlers, that can be used in a script. A <strong>script object definition</strong> is a compound statement that can contain collections of properties, handlers, and other AppleScript script statements. A script object definition is similar to an object-oriented class definition—you can instantiate multiple instances of the script object, each containing data and handlers to operate on that data. You can even extend or modify the behavior of a handler in one script object when calling it from another script object.</p><p>Most event handlers in Mail Search are associated with the search window. These event handlers need to call other handlers to perform searches and display results. One convenient way to organize these handlers is to create a script object for each search window that implements all the necessary handlers related to searching and displaying results. In response to user actions, Mail Search’s event handlers call the script object’s handlers, which in turn call other handlers in the script object as needed. Mail Search can also use a script object to encapsulate operations involving the status dialog. In Mail Search, neither of these script objects require the use of inheritance to modify contained handlers.</p><p>In the next sections, you’ll specify script and handlers for Mail Search. You’ll write these handlers in <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF157">“Write Scripts and Additional Handlers.”</a></span></p><a name="//apple_ref/doc/uid/20001254-TPXREF203" title="The Controller Script"></a><h4>The Controller Script</h4><p>Mail Search defines a script to handle operations for the search window. It calls this script a controller, in the tradition of the <strong>model-view-controller (MVC)</strong> paradigm. In MVC, the view is responsible for what the user sees, the model represents the application’s data and algorithms, and the controller interprets user input and specifies changes to the model and the view. When a search window is about to open, Mail Search creates a controller script object for it and stores it in a global list of controllers. When a window is activated, Mail Search gets its controller and tells it to load all available mail- boxes from the Mail application.</p><p>Each open search window has an associated controller in Mail Search’s global list of controllers. When a user performs an action in a window, such as clicking the find button, the application calls the appropriate event handler (such as <code>on clicked</code>). That event handler typically gets the controller (a script object) for its window, then calls the appropriate handler in the controller (such as the <code>find</code> handler) to perform the requested action (to find matching messages).</p><p>The controller script object defines properties for things it needs to keep track of, including</p><ul class="spaceabove"><li class="li"><p>a reference to its window</p></li><li class="li"><p>a reference to a status panel (or dialog)</p></li><li class="li"><p>a list of found messages</p></li><li class="li"><p>a boolean for whether it has created a list of available mailboxes</p></li></ul><p>The controller script object defines handlers for the searching-related tasks it performs:</p><ul class="spaceabove"><li class="li"><p><code>initialize:</code> performs any initialization needed for searching</p></li><li class="li"><p><code>loadMailboxes:</code> loads mailboxes if they haven’t already been loaded; shows status dialog</p></li><li class="li"><p><code>find:</code> if a valid search has been specified (there is text to search for and at least one selected mailbox to search in), performs the search</p></li></ul><p>In addition to these high-level handlers, the controller script object needs handlers to actually load the mailboxes and search for and display messages. For example, to load mailboxes, Mail Search must search each account. This leads to the following handlers:</p><ul class="spaceabove"><li class="li"><p><code>addMailboxes:</code> called by <code>loadMailboxes</code>; calls <code>addAccount</code> for each account</p></li><li class="li"><p><code>addAccount:</code> called by <code>addMailboxes</code>; adds an account name to the mailboxes view; for each mailbox in the account, calls <code>addMailbox</code></p></li><li class="li"><p><code>addMailbox:</code> called by <code>addAccount</code>; adds the mailbox to the mailboxes view</p></li></ul><p>This should help you understand how the controller script might implement other tasks, such as adding found messages to the messages view.</p><p>Finally, Mail Search needs several handlers that are not part of the controller script itself:</p><ul class="spaceabove"><li class="li"><p><code>makeController:</code> creates a controller script object for a window</p></li><li class="li"><p><code>addController:</code> adds a controller to the global list of controllers</p></li><li class="li"><p><code>removeController:</code> removes a controller from the global list of controllers</p></li><li class="li"><p><code>controllerForWindow:</code> given a window, returns the controller for that window from the global list of controllers</p></li></ul><p>You’ll find more information about controller handlers in <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF157">“Write Scripts and Additional Handlers.”</a></span> Of course you can always look ahead by examining Mail Search in <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF101">“Mail Search Tutorial: Write the Code,”</a></span> or by opening the Mail Search sample application in Xcode.</p><a name="//apple_ref/doc/uid/20001254-TPXREF204" title="The Status Dialog Script"></a><h4>The Status Dialog Script</h4><p>The status dialog provides both determinate (the bar moves from left to right) and indeterminate (a spinning striped cylinder) progress bars, as well as text messages. Mail Search’s approach for handling a status dialog is similar to its approach for handling search operations. That is, it defines a status dialog script and instantiates a script object based on that script whenever it needs to display a status dialog. The status dialog script defines properties for things it needs to keep track of, including</p><ul class="spaceabove"><li class="li"><p>a reference to its window</p></li><li class="li"><p>a boolean for whether it has been initialized</p></li><li class="li"><p>count variables used in showing progress</p></li></ul><p>The status dialog script is fairly simple, and requires fewer handlers than the controller script. As you might expect, its handlers are used for opening and closing the panel or adjusting its status:</p><ul class="spaceabove"><li class="li"><p><code>openPanel:</code> performs initialization and displays the status dialog</p></li><li class="li"><p><code>closePanel:</code> closes the panel</p></li><li class="li"><p><code>changePanel:</code> changes the progress display message</p></li><li class="li"><p><code>adjustPanel:</code> adjusts the current state of the progress bar</p></li><li class="li"><p><code>incrementPanel:</code> increments the progress bar display</p></li></ul><p>These handlers aren’t shown in individual listings, but you can examine them in <span class="content_text"><a href="../chapter10/studio_write_code.html#//apple_ref/doc/uid/20001257-TPXREF101">“Mail Search Tutorial: Write the Code”</a></span> or in the Mail Search sample application.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../chapter06/studio_cur_converter.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../chapter08/studio_ms_create_intf.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-04-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/StudioBuildingApps/chapter07/studio_ms_design_app.html%3Fid%3DTP30000889-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/StudioBuildingApps/chapter07/studio_ms_design_app.html%3Fid%3DTP30000889-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/StudioBuildingApps/chapter07/studio_ms_design_app.html%3Fid%3DTP30000889-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>