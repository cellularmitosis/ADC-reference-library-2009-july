<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html><head>
<!-- BEGIN META TAG INFO -->
<link rel="home" href="http://developer.apple.com/">
<link rel="find" href="http://developer.apple.com/search/">
<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
<script language="JavaScript" type="text/javascript" src="../../documentation/js/busnav.js"></script>
<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- END META TAG INFO -->
<!-- BEGIN TITLE -->
<title>Technical Note TN2016: iTunes Visual Plug-ins</title>
<!-- END TITLE -->
</head>
<!-- BEGIN BODY OPEN -->
<body bgcolor="#ffffff"><a name="//apple_ref/doc/uid/DTS10003055" title="iTunes Visual Plug-ins"></a>
<!--END BODY OPEN -->
<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->
<a name="top"></a>
<!-- BEGIN LOGO AND SEARCH -->
<!--#include virtual="/includes/adcnavbar"-->
<!-- END LOGO AND SEARCH -->
<!-- START BREADCRUMB -->
<div id="breadcrumb"><table width="680" border="0" cellpadding="0" cellspacing="0"><tr>
<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
<td><img width="340" height="10" src="images/1dot.gif" alt=""></td></tr><tr valign="middle"><td align="left" colspan="2">
<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/AppleApplications/index.html">Apple Applications</a> &gt; <a href="../../technicalnotes/AppleApplications/idxiTunes-date.html">iTunes</a> &gt; 
</td></tr><tr><td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td></tr></table></div>
<!-- END BREADCRUMB -->

<!-- START MAIN CONTENT -->
<!-- START TITLE GRAPHIC AND INTRO-->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top">
<td><h1>
<div id="pagehead">Technical Note TN2016</div>
<div id="pageheadsub">iTunes Visual Plug-ins</div>
</h1></td></tr></table>
<!-- END TITLE GRAPHIC AND INTRO -->
<!-- BEGIN WIDE COLUMN -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td align="left" width="680">
<!-- BEGIN CONTENTS -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td><p>This note is directed at application developers who want to create visual plug-ins for iTunes version 7.4 on Mac OS X 10.3.9 and later, and iTunes version 7.4 on Windows XP &amp; Vista.</p><p>If you received this documentation as part of the iTunes Visual plug-ins SDK package, you should check the <A HREF="../../sdk/">Apple Development Kits web page</A> for an updated version.</p><p>All of the code described in this documentation can also be found in the iTunes Visual plug-ins SDK, which is available to all registered ADC members (visit the <A HREF="../../products/">Apple Developer Connection Membership page</A> to learn how to become an ADC member).</p><p>We'd like to hear about your finished Visual plug-in. Send information about it, and the Visual plug-in itself if you like, to <A HREF="mailto:itunesvisuals@mac.com">itunesvisuals@mac.com</A>.</p></td></tr><tr><td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td width="680"><ul><li><a href="#GENID1">Overview</a></li><li><a href="#DISCOVERY">Plug-in discovery and registration</a></li><li><a href="#MESSAGES">Messages in Detail</a><ul><li><a href="#GENID2">1. Plug-in main entry point messages</a><ul><li><a href="#GENID3">kPluginInitMessage</a></li></ul></li><li><a href="#GENID4">2. Visual plug-in messages</a><ul><li><a href="#GENID5">kVisualPluginInitMessage</a><li><a href="#GENID6">kVisualPluginCleanupMessage</a><li><a href="#GENID7">kVisualPluginIdleMessage</a><li><a href="#GENID8">kVisualPluginConfigureMessage</a><li><a href="#GENID9">kVisualPluginEnableMessage</a><li><a href="#GENID10">kVisualPluginDisableMessage</a><li><a href="#GENID11">kVisualPluginShowWindowMessage</a><li><a href="#GENID12">kVisualPluginHideWindowMessage</a><li><a href="#GENID13">kVisualPluginSetWindowMessage</a><li><a href="#GENID14">kVisualPluginRenderMessage</a><li><a href="#GENID15">kVisualPluginUpdateMessage</a><li><a href="#GENID16">kVisualPluginPlayMessage</a><li><a href="#GENID17">kVisualPluginChangeTrackMessage</a><li><a href="#GENID18">kVisualPluginStopMessage</a><li><a href="#GENID19">kVisualPluginSetPositionMessage</a><li><a href="#GENID20">kVisualPluginEventMessage</a><li><a href="#GENID21">kVisualPluginDisplayChangedMessage</a></li></ul></li></ul></li><li><a href="#GENID22">Callback APIs</a></li><li><a href="#TNT_HISTORY_TAG">Document Revision History</a></li></ul></td></tr><tr><td colspan="3" scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><A NAME="GENID1"></A><H2>Overview</H2><p>When the user selects the Turn On Visualizer menu item in the View menu in iTunes, custom visual special effects appear.</p><p class="caption"><strong>Figure 1:</strong> Turn On Visualizer menu item</p><p><img  src="images/tn2016_001.jpg" width="218" height="144" alt="Figure 1, Turn On Visualizer menu item"></p><p>iTunes plug-ins are implemented on Mac OS X as shared libraries, and on Windows as Dynamic Link Libraries (DLLs). For ease of implementation across different architectures, iTunes plug-ins export a single entry point. In addition, plug-ins do not link against the iTunes application. Instead, a callback function pointer is provided to your plug-in during initialization, and the iTunes API calls are implemented via that function.</p><p>iTunes sends messages to your plug-in to tell it when to initialize and clean up, when the user turns visual effects on and off, when the window is resized, when the user starts or stops playing music, etc. When visual effects are on, iTunes will forward keyboard, mouse, and update events for the visual effects window to your plug-in. Messages are described in more detail below.</p><p>While music is playing, iTunes sends render messages that include waveform data (sound samples) corresponding to the music that is currently playing, and a spectrum analysis of the samples. During registration, your plug-in indicates the number of channels of waveform and spectrum data it wants, and how often it wants to receive render messages.</p><p>During registration, your plug-in indicates if it wants to receive idle messages. Idle messages are sent periodically whether music is playing or not. When the music stops, you can draw in response to idle messages to fade out your visual effects smoothly.</p><p>Your plug-in can have preferences that get stored in the iTunes preferences file. The iTunes API includes functions to access your plug-in's preferences. iTunes sends the configure message when the user clicks on the options button to tell you to show your settings dialog.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="DISCOVERY"></A><H2>Plug-in discovery and registration</H2><p>On Windows, iTunes recursively scans the folder named &quot;Plug-Ins&quot;, which is located beside the iTunes.exe application itself, for visual plug-in files having the .dll extension.</p><p>On Mac OS X, iTunes recursively scans the plug-ins folder which is located at ~/Library/iTunes/iTunes Plug-ins/ (and /Library/iTunes/iTunes Plug-ins/ if that directory exists), and only that folder, for plug-ins. On Mac OS X, iTunes recognizes plug-ins packaged as bundles with <code>CFBundlePackageType</code> 'hvpl'. We recommend using iTunes' creator &quot;hook&quot; as the file or bundle signature so it gets an icon and kind string consistent with the other iTunes plug-ins.</p><p>A visual plug-in sample code is provided for both Windows and Mac OS X formats in the iTunes Visual Plug-in SDK.</p><p>A plug-in library exports a single entry point. The name of the exported function depends on how the plug-in is packaged.</p><p>For Windows plug-in DLLs, the name of the main entry point must be &quot;iTunesPluginMain&quot;.</p><p>For Mac OS X plug-in shared libraries, the name of the entry point must be &quot;iTunesPluginMainMachO&quot;.</p><p>For each plug-in found, iTunes sends a <code>kPluginInitMessage</code> message to the entry point mentioned above, which is referred to as the plug-in &quot;main&quot; entry point in this SDK. A single plug-in file can contain multiple plug-ins. To support this, the plug-in main entry point must register each of the contained plug-ins when it receives the <code>kPluginInitMessage</code>, which will be sent only once.</p><p>To register a visual plug-in, you call <code>PlayerRegisterVisualPlugin</code>, passing a pointer to your visual plug-in message handler function. All <code>kVisualPlugin...</code> messages are sent to this handler function, starting with <code>kVisualPluginInitMessage</code>, which is sent immediately upon registration.</p><p>It is not necessary to unregister visual plug-ins. When it's time to shut down, a <code>kVisualPluginCleanupMessage</code> will be sent to your visual plug-in message handler, and then a <code>kPluginCleanupMessage</code> will be sent your plug-in's main entry point.</p><p>For compatibility with future versions of iTunes, if your plug-in receives a message it does not recognize, it should return <code>unimpErr</code>.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="MESSAGES"></A><H2>Messages in Detail</H2><A NAME="GENID2"></A><H3>1. Plug-in main entry point messages</H3><p>These messages are sent to your plug-in main entry point, which has the following signature:</p><pre class="sourcecodebox">
OSStatus main(OSType message, PluginMessageInfo * messageInfo, void * refCon);</pre><p><code>message</code></p><p>what message is being sent</p><p><code>messageInfo</code></p><p>a pointer to additional parameters, if any.</p><p><code>refCon</code></p><p>the value you returned in <code>PluginInitMessage.refCon</code> will be passed back in this parameter.</p><p>This table lists the plug-in main entry point messages and corresponding <code>PluginMessageInfo</code> variants. Messages that have no additional parameters are listed as &quot;n/a&quot;; you should ignore <code>messageInfo</code> for those messages.</p><p class="smalltext"><strong>Table 1:</strong> Plug-in main entry point messages</p><table cellspacing="0" class="graybox"><tr><th><code>message</code></th><th><code>messageInfo-&gt;u</code></th></tr><tr><td scope="row"><code>kPluginInitMessage</code></td><td><code>PluginInitMessage</code></td></tr><tr><td scope="row"><code>kPluginCleanupMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kPluginIdleMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code> kPluginPrepareToQuitMessage </code></td><td><code>n/a</code></td></tr></table><A NAME="GENID3"></A><H4>kPluginInitMessage</H4><p>This message is sent to your plug-in library at launch time. You should register your plug-ins by calling <code>PlayerRegisterVisualPlugin</code>, described below, when you get this message. Then fill in the <code>options</code> and <code>refCon</code> fields of the <code>PluginInitMessage</code> before returning.</p><p><code>messageInfo-&gt;u </code>is a<code> PluginInitMessage</code>:</p><pre class="sourcecodebox">
enum {
    /* PluginInitMessage.options */

    /* Send idle messages to plugin main */
    kPluginWantsIdleMessages        = (1L &lt;&lt; 1),

    /* Don't close this plugin just because it didn't register anyone */
    kPluginWantsToBeLeftOpen        = (1L &lt;&lt; 2),

    /* The plugin wants to be notified when volumes are mounted/unmounted/renamed */
    kPluginWantsVolumeMessages      = (1L &lt;&lt; 3),

    /* The plugin wants to know when the display depth/size changes */
    kPluginWantsDisplayNotification = (1L &lt;&lt; 5)
};

struct PluginInitMessage {
 UInt32       majorVersion; /* Input */
 UInt32       minorVersion; /* Input */

 void *       appCookie;    /* Input */
 ITAppProcPtr appProc;      /* Input */

 OptionBits   options;      /* Output */
 void *       refCon;       /* Output */
};
</pre><p><code>majorVersion minorVersion</code></p><p>the version of the iTunes API implemented by the iTunes application.</p><p><code>appCookie appProc</code></p><p>parameters to be passed to the callback APIs</p><p><code>options</code></p><p>return options parameters (see flags above) to specify whether you want to receive idle messages, know about display depth/size changes, and so on.</p><p><code>refCon</code></p><p>the value you return here will be passed back as the <code>refCon</code> parameter in future calls to your main entry point</p><p><code>kPluginIdleMessage</code></p><p>This message is intended for use by device plug-ins. Visual plug-ins that want idle time register for <code>kVisualPluginIdleMessage</code>, described below.</p><p><code>kPluginCleanupMessage</code></p><p>This message is sent to your plug-in when iTunes is about to quit.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID4"></A><H3>2. Visual plug-in messages</H3><p>A visual plug-in message handler has the following signature:</p><pre class="sourcecodebox">
OSStatus VisualPluginHandler(OSType message,
  VisualPluginMessageInfo * messageInfo, void * refCon);
</pre><p><code>message</code></p><p>what message is being sent.</p><p><code>messageInfo</code></p><p>a pointer to additional parameters, if any.</p><p><code>refCon</code></p><p>the value you returned in <code>VisualPluginInitMessage.refCon</code> will be passed back in this parameter.</p><p>This table lists the visual plug-in messages and corresponding <code>VisualPluginMessageInfo</code> variants. Messages that have no additional parameters are listed as &quot;n/a&quot;, you should ignore <code>messageInfo</code> for those messages.</p><p class="smalltext"><strong>Table 2:</strong> Visual plug-in messages</p><table cellspacing="0" class="graybox"><tr><th><code>message</code></th><th><code>messageInfo-&gt;u</code></th></tr><tr><td scope="row"><code>kVisualPluginInitMessage</code></td><td><code>VisualPluginInitMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginCleanupMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginIdleMessage</code></td><td><code>VisualPluginIdleMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginConfigureMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginEnableMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginDisableMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginShowWindowMessage</code></td><td><code>VisualPluginShowWindowMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginHideWindowMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginSetWindowMessage</code></td><td><code>VisualPluginSetWindowMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginRenderMessage</code></td><td><code>VisualPluginRenderMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginUpdateMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginPlayMessage</code></td><td><code>VisualPluginPlayMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginChangeTrackMessage</code></td><td><code>VisualPluginChangeTrackMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginStopMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginSetPositionMessage</code></td><td><code>VisualPluginSetPositionMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginPauseMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginUnpauseMessage</code></td><td><code>n/a</code></td></tr><tr><td scope="row"><code>kVisualPluginEventMessage</code></td><td><code>VisualPluginEventMessage</code></td></tr><tr><td scope="row"><code>kVisualPluginDisplayChangedMessage</code></td><td><code>VisualPluginDisplayChangedMessage</code></td></tr></table><A NAME="GENID5"></A><H4>kVisualPluginInitMessage</H4><p>This message is sent right after you register your plug-in with <code>PlayerRegisterVisualPlugin</code>. For this message only, the <code>refCon</code> parameter will be the value you returned in <code>PlayerRegisterVisualPluginMessage.registerRefCon</code>. Fill in the <code>options</code> and <code>refCon</code> fields of the <code>VisualPluginInitMessage</code> before returning.</p><p><code>messageInfo-&gt;u.visualPluginInitMessage</code> is a <code>VisualPluginInitMessage</code>:</p><pre class="sourcecodebox">
enum {
    /* Initialize options */

    /* monitor will not resolution switch in fullscreen mode */
    kVisualDoesNotNeedResolutionSwitch      = (1L &lt;&lt; 0),    /* Added in 7.0 */

    /* iTunes will not erase Visualizer background to black. Visualizer
    plugin must do it. */
    kVisualDoesNotNeedErase                 = (1L &lt;&lt; 1)    /* Added in 7.0 */
};

struct VisualPluginInitMessage {
 UInt32       messageMajorVersion; /* Input */
 UInt32       messageMinorVersion; /* Input */
 NumVersion   appVersion;          /* Input */

 void *       appCookie;           /* Input */
 ITAppProcPtr appProc;             /* Input */

 OptionBits   options;             /* Output */
 void *       refCon;              /* Output */
};
</pre><p><code>messageMajorVersion</p><p>messageMinorVersion</code></p><p>the version of the iTunes API implemented by the iTunes application.</p><p><code>appVersion</code></p><p>the version of iTunes that is running.</p><p><code>appCookie</p><p>appProc</code></p><p>The plug-in should copy these two fields into its private data since it will need to pass them as parameters to all the iTunes APIs described below.</p><p><code>options</code></p><p>return options here (see flags above) to prevent monitor resolution switch in fullscreen mode and erasing of the Visualizer background to black.</p><p><code>refCon</code></p><p>the value returned in this field will be passed as the <code>refCon</code> parameter in subsequent calls to the visual plug-in handler. Your plug-in can use this for anything it chooses, typically to store a pointer to data which is allocated in the init message. The sample code uses this technique to recover the pointer to its private data in its visual plug-in handler.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID6"></A><H4>kVisualPluginCleanupMessage</H4><p>This message is sent when iTunes is about to quit. You should free any resources allocated by your visual plug-in at this time.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID7"></A><H4>kVisualPluginIdleMessage</H4><p>This message is sent periodically if the plug-in requests idle messages. Do this by setting the <code>kVisualWantsIdleMessages</code> option in the <code>PlayerRegisterVisualPluginMessage.options</code> field.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID8"></A><H4>kVisualPluginConfigureMessage</H4><p>This message is sent when the user clicks on the Options button at the top right of the iTunes window. Enable the Options button (and this message) by setting the <code>kVisualWantsConfigure</code> option in the <code>PlayerRegisterVisualPluginMessage.options</code> field. The sample code shows how to implement a settings dialog for configuration, incuding when to call <code>PlayerHandleMacOSEvent</code> to handle events.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID9"></A><H4>kVisualPluginEnableMessage</H4><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID10"></A><H4>kVisualPluginDisableMessage</H4><p>iTunes currently enables all loaded visual plug-ins. Your plug-in should simply return <code>noErr</code> for these messages.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID11"></A><H4>kVisualPluginShowWindowMessage</H4><p>Sent when visual effects are turned on. At this point, the plug-in should allocate any large buffers it needs.</p><p><code>messageInfo-&gt;u.showWindowMessage</code> is a <code>VisualPluginShowWindowMessage</code>:</p><pre class="sourcecodebox">
struct VisualPluginShowWindowMessage {
    GRAPHICS_DEVICE                 GRAPHICS_DEVICE_NAME;   /* Input */
    Rect                            drawRect;               /* Input */
    OptionBits                      options;                /* Input */
    Rect                            totalVisualizerRect;    /* Input  -- Added in 7.0 */
};</pre><p><code> GRAPHICS_DEVICE_NAME </code></p><p>the graphics device to draw into. The plug-in should remember this since it is not sent with render or update messages.</p><p><code>drawRect</code></p><p>the rect to draw into. The plug-in should remember this since it is not sent with render or update messages.</p><p><code>options</code></p><p>the only option currently defined is <code>kWindowIsFullScreen</code>, it's set when you are in full screen mode.</p><p><code> totalVisualizerRect </code></p><p>the total rect the visualizer is running in. The drawRect (see above) will always be smaller than or equal in size to this rect, and the ratio of these two rects is controlled by the user's &quot;Visualizer Size&quot; setting in the iTunes preferences.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID12"></A><H4>kVisualPluginHideWindowMessage</H4><p>This message is sent when visual effects are turned off. Your plug-in should free any large buffers allocated in the course of rendering here.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID13"></A><H4>kVisualPluginSetWindowMessage</H4><p>This message is sent when the user resizes the iTunes window or toggles full screen mode. It is conceptually the same as a <code>kVisualPluginHideWindowMessage</code> followed by a <code>kVisualPluginShowWindowMessage</code> with the new window info, but your plug-in may be able to handle this combined message more efficiently.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID14"></A><H4>kVisualPluginRenderMessage</H4><p>This message is sent periodically when music is playing, at a rate specified during registration.</p><p><code>messageInfo-&gt;renderMessage</code> is a <code> VisualPluginRenderMessage </code>:</p><pre class="sourcecodebox">
struct VisualPluginRenderMessage {
    RenderVisualData *              renderData;             /* Input */
    UInt32                          timeStampID;            /* Input */
    UInt32                          currentPositionInMS;    /* Input */
};

struct RenderVisualData {
 UInt8 numWaveformChannels;
 UInt8 waveformData[kVisualMaxDataChannels][kVisualNumWaveformEntries];

 UInt8 numSpectrumChannels;
 UInt8 spectrumData[kVisualMaxDataChannels][kVisualNumSpectrumEntries];
};</pre><p><code>renderData-&gt;numWaveformChannels</code></p><p>The number of channels of waveform data included. This will be the number you requested during registration.</p><p><code>renderData-&gt;waveformData</code></p><p>The most significant 8 bits of the sound samples that are currently playing. The values range from 0 to 255, where 128 is the midpoint (AC zero value).</p><p><code>renderData-&gt;numSpectrumChannels</code></p><p>The number of channels of spectrum data included. This will be the number you requested during registration.</p><p><code>renderData-&gt;spectrumData</code></p><p>This is a 512-point Fast Fourier Transform of the waveform data.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID15"></A><H4>kVisualPluginUpdateMessage</H4><p>This message is sent in response to an update event. The visual plug-in should update into its remembered port. This will only be sent if the plug-in's window is showing, i.e. in between <code>kVisualPluginShowWindowMessage</code> and <code>kVisualPluginHideWindowMessage</code> messages.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID16"></A><H4>kVisualPluginPlayMessage</H4><p>This message is sent when iTunes starts playing a track. Your plug-in should copy any track info it wants to display. Also, when streaming an internet radio station the track info contains the name (and meta data) for the radio station, and the song name (and its meta data) is in the <code>ITStreamInfo</code> field.</p><p><code>messageInfo-&gt;u.playMessage</code> is a <code>VisualPluginPlayMessage</code>:</p><pre class="sourcecodebox">
struct VisualPluginPlayMessage {
    ITTrackInfoV1 *                 trackInfo;              /* Input */
    ITStreamInfoV1 *                streamInfo;             /* Input */
    SInt32                          volume;                 /* Input */

    UInt32                          bitRate;                /* Input */

    SoundComponentData              oldSoundFormat;         /* Input */
    ITTrackInfo *                   trackInfoUnicode;       /* Input */
    ITStreamInfo *                  streamInfoUnicode;      /* Input */
    AudioStreamBasicDescription     audioFormat;            /* Input -- added in 7.1 */
};
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID17"></A><H4>kVisualPluginChangeTrackMessage</H4><p>This message is sent when the information about a track changes, e.g., when the user edits track info, or when iTunes begins playing a different track. Your plug-in should copy any track info it wants to display. Also, when streaming an internet radio station the track info contains the name (and meta data) for the radio station, and the song name (and its meta data) is in the <code>ITStreamInfo</code> field.</p><p><code>messageInfo-&gt;u.changeTrackMessage</code> is a <code>VisualPluginChangeTrackMessage</code>:</p><pre class="sourcecodebox">
struct VisualPluginChangeTrackMessage {
    ITTrackInfoV1 *                 trackInfo;              /* Input */
    ITStreamInfoV1 *                streamInfo;             /* Input */
    ITTrackInfo *                   trackInfoUnicode;       /* Input */
    ITStreamInfo *                  streamInfoUnicode;      /* Input */
};
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID18"></A><H4>kVisualPluginStopMessage</H4><p>This message is sent when the music stops playing.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID19"></A><H4>kVisualPluginSetPositionMessage</H4><p>This message is sent when iTunes changes the elapsed time position within a track. A plug-in that shows the elapsed time would use this.</p><p><code>messageInfo-&gt;u.setPositionMessage</code> is a <code>VisualPluginSetPositionMessage</code>:</p><pre class="sourcecodebox">
struct VisualPluginSetPositionMessage {
 UInt32 positionTimeInMS; /* Input */
};</pre><p><code>kVisualPluginPauseMessage kVisualPluginUnpauseMessage </code></p><p>iTunes does not currently use pause or unpause. A pause in iTunes is handled by stopping and remembering the position. Your plug-in should simply return <code>noErr</code> for these messages.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID20"></A><H4>kVisualPluginEventMessage</H4><p>This message is sent when the user generates an event that could be handled by your plug-in. If your plug-in handles the event, it should return <code>noErr</code>. Otherwise it should return <code>unimpErr</code>.</p><p><code>messageInfo-&gt;u.eventMessage</code> is a <code>VisualPluginEventMessage</code>:</p><pre class="sourcecodebox">
struct VisualPluginEventMessage {
 EventRecord * event; /* Input */
};</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID21"></A><H4>kVisualPluginDisplayChangedMessage</H4><p>This message is sent when something about the display environment (bit depth, for example) has changed. If your plugin handles the event it should return <code>noErr</code>. Otherwise it should return <code>unimpErr</code>.</p><p><code>messageInfo-&gt;u.displayChangedMessage</code> is a <code> VisualPluginDisplayChangedMessage </code>:</p><pre class="sourcecodebox">
enum {
    kVisualDisplayDepthChanged  = 1 &lt;&lt; 0,                   /* the display's depth has changed */
    kVisualDisplayRectChanged   = 1 &lt;&lt; 1,                   /* the display's location changed */
    kVisualWindowMovedMoved     = 1 &lt;&lt; 2,                   /* the window has moved location */
    kVisualDisplayConfigChanged = 1 &lt;&lt; 3,                   /* something else about the display changed */
};

struct VisualPluginDisplayChangedMessage {
  UInt32              flags;    /* Input */
};
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="GENID22"></A><H2>Callback APIs</H2><p>As mentioned in the overview, plug-ins do not link against iTunes. Instead, the first two parameters of all of the iTunes APIs are a cookie and a callback function pointer. These are provided to your plug-in in the init messages. The glue code in iTunesAPI.c takes care of marshaling parameters and calling iTunes for you, so you don't have to worry about the details.</p><pre class="sourcecodebox">
OSStatus PlayerRegisterVisualPlugin (void *appCookie, ITAppProcPtr appProc,
   PlayerMessageInfo *messageInfo);</pre><p>Register your visual plug-in with <code>PlayerRegisterVisualPlugin</code> when you receive <code>kPluginInitMessage</code>. Pass a <code>PlayerRegisterVisualPluginMessage</code> variant of <code>PlayerMessageInfo</code> as the <code>messageInfo</code> parameter. The fields are explained in the comments below:</p><pre class="sourcecodebox">

    /* PlayerRegisterVisualPluginMessage.options */

enum {
        /* set to enable kVisualPluginIdleMessage */
    kVisualWantsIdleMessages = (1L &lt;&lt; 3),

        /* set to enable kVisualPluginConfigureMessage */
    kVisualWantsConfigure    = (1L &lt;&lt; 5),

        /* set to enable unicodeName */
    kVisualProvidesUnicodeName  = (1L &lt;&lt; 6)
};


struct PlayerRegisterVisualPluginMessage {
    /* Input from plugin */

    /* Displayed in the Visual menu -- may be empty if options include kVisualProvidesUnicodeName */
    Str63                           name;

    OptionBits                      options;                    /* See above */

    OSType                          creator;                    /* Identifies the plugin */

    NumVersion                      pluginVersion;              /* Version number of the plugin */

    VisualPluginProcPtr             handler;                    /* Handler for the plugin's messages */
    void *                          registerRefCon;             /* RefCon for the plugin's handler */

    /* How often to call the plugin (0xFFFFFFFF = as often as possible) */
    UInt32                          timeBetweenDataInMS;
    UInt32                          numWaveformChannels;        /* 0-2 waveforms requested */
    UInt32                          numSpectrumChannels;        /* 0-2 spectrums requested */

    SInt16                          minWidth;                   /* Minimum resizeable width */
    SInt16                          minHeight;                  /* Minimum resizeable height */

    SInt16                          maxWidth;                   /* Maximum resizeable width */
    SInt16                          maxHeight;                  /* Maximum resizeable height */

    UInt16                          minFullScreenBitDepth;      /* 0 = Any */
    UInt16                          maxFullScreenBitDepth;      /* 0 = Any */

    UInt16                          windowAlignmentInBytes;     /* Reserved (should be zero) */

    /* options must include kVisualProvidesUnicodeName for this to be used.
       Developers are strongly encouraged to provide a Unicode name to ensure
       their name will localize properly for other languages. */
    ITUniStr255                     unicodeName;
};
</pre><p>Your plug-in should call <code>PlayerIdle</code> to give time to iTunes if it engages in a lengthy process.</p><pre class="sourcecodebox">
OSStatus PlayerIdle (
    void *appCookie,
    ITAppProcPtr appProc);

</pre><p>Show the &quot;About iTunes&quot; window.</p><pre class="sourcecodebox">
void PlayerShowAbout(
    void *appCookie,
    ITAppProcPtr appProc);
</pre><p>Tell iTunes to open a URL. The <code>urlString</code> parameter is not a Pascal string or a C string; its length is specified by the <code>length</code> parameter.</p><pre class="sourcecodebox">
void PlayerOpenURL (
    void *appCookie,
    ITAppProcPtr appProc,
    SInt8 * urlString,
    UInt32 length);
</pre><p>Read data identified by your plug-in's name from the iTunes preferences file. This can be used to store your plug-in's preferences as a single block of data. Your plug-in's name is specified in <code>PlayerRegisterVisualPluginMessage.name</code>.</p><pre class="sourcecodebox">
OSStatus PlayerGetPluginData (
    void *appCookie,
    ITAppProcPtr appProc,
    void *dataPtr,
    UInt32 dataBufferSize,
    UInt32 *dataSize);
</pre><p>Save data identified by your plug-in's name from the iTunes preferences file. This can be used to store your plug-in's preferences as a single block of data. Your plug-in's name is specified in <code>PlayerRegisterVisualPluginMessage.name</code>.</p><pre class="sourcecodebox">
OSStatus PlayerSetPluginData (
    void *appCookie,
    ITAppProcPtr appProc,
    void *dataPtr,
    UInt32 dataSize);
</pre><p>Read data identified by <code>dataName</code> and your plug-in's name from the iTunes preferences file. This can be used to store your plug-in's preferences, with each preference field stored separately. Your plug-in's name is specified in <code>PlayerRegisterVisualPluginMessage.name</code>.</p><pre class="sourcecodebox">
OSStatus PlayerGetPluginNamedData (
    void *appCookie,
    ITAppProcPtr appProc,
    ConstStringPtr dataName,
    void *dataPtr,
    UInt32 dataBufferSize,
    UInt32 *dataSize);</pre><p>Save data identified by <code>dataName</code> and your plug-in's name from the iTunes preferences file. This can be used to store your plug-in's preferences, with each preference field stored separately. Your plug-in's name is specified in <code>PlayerRegisterVisualPluginMessage.name</code>.</p><pre class="sourcecodebox">
OSStatus PlayerSetPluginNamedData (
    void *appCookie,
    ITAppProcPtr appProc,
    ConstStringPtr dataName,
    void *dataPtr,
    UInt32 dataSize);</pre><p>Ask iTunes to handle an event. The sample code uses this in its <code>SettingsDialogFilterProc</code>.</p><pre class="sourcecodebox">
OSStatus PlayerHandleMacOSEvent (
    void *appCookie,
    ITAppProcPtr appProc,
    const EventRecord *theEvent,
    Boolean *eventHandled);
</pre><p>Return your plug-in's <code>FSSpec</code> (Macintosh only). For bundled plug-ins, this will be the <code>FSSpec</code> of the bundle.</p><pre class="sourcecodebox">
OSStatus PlayerGetPluginFileSpec(
    void *appCookie,
    ITAppProcPtr appProc,
    FSSpec *pluginFileSpec);</pre><p>Tell iTunes to enter or exit full screen mode. If your plug-in wants to behave like a screen saver it could use this.</p><pre class="sourcecodebox">
OSStatus PlayerSetFullScreen (
    void *appCookie,
    ITAppProcPtr appProc,
    Boolean fullScreen);
</pre><p>Specify bit depth and resolution for subsequent uses of full screen mode. If your plug-in has a user interface for setting these options, call this to update the values from what you specified in <code>PlayerRegisterVisualPluginMessage</code>.</p><pre class="sourcecodebox">
OSStatus PlayerSetFullScreenOptions (
    void *appCookie,
    ITAppProcPtr appProc,
    SInt16 minBitDepth,
    SInt16 maxBitDepth,
    SInt16 preferredBitDepth,
    SInt16 desiredWidth,
    SInt16 desiredHeight);
</pre><p>Return the track cover art for the currently playing song.</p><pre class="sourcecodebox">
OSStatus PlayerGetCurrentTrackCoverArt (
    void *appCookie,
    ITAppProcPtr appProc,
    Handle *coverArt,
    OSType *coverArtFormat);
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNT_HISTORY_TAG"></A><H2>Document Revision History</H2><table cellspacing="0" class="graybox" width="680"><tr><th width="100">Date</th><th width="580">Notes</th></tr><tr><td scope="row">2007-11-13</td><td>Update to version 7.4 interfaces</td></tr><tr><td scope="row">2001-06-26</td><td>Describes the APIs used by iTunes and its Visual plug-ins to communicate back and forth.</td></tr></table><p><b>Posted:</b> 2007-11-13</p>
<!-- END CONTENTS -->
</td></tr></table>
<!-- END WIDE COLUMN -->
<!-- END MAIN CONTENT -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2016.html%3Fid%3DDTS10003055-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2016.html%3Fid%3DDTS10003055-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2016.html%3Fid%3DDTS10003055-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<!-- START BOTTOM APPLE NAVIGATION -->
<!--#include virtual="/includes/footer"-->
<!-- END BOTTOM APPLE NAVIGATION -->
<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->
</body></html>