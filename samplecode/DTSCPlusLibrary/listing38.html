<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>DTSCPlusLibrary - /Sources/FileClass.cp</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">DTSCPlusLibrary</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">DTSCPlusLibrary</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Sources/FileClass.cp</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Headers/AppleEvent.h</option>
<option value="listing2.html">/Headers/Application.h</option>
<option value="listing3.html">/Headers/ApplicationResources.h</option>
<option value="listing4.html">/Headers/CollectionClasses.h</option>
<option value="listing5.html">/Headers/ColorPicker.h</option>
<option value="listing6.html">/Headers/DTSCPlusLibrary.h</option>
<option value="listing7.html">/Headers/Environment.h</option>
<option value="listing8.html">/Headers/FileClass.h</option>
<option value="listing9.html">/Headers/GDevice.h</option>
<option value="listing10.html">/Headers/GraphicsEnv.h</option>
<option value="listing11.html">/Headers/KeyMap.h</option>
<option value="listing12.html">/Headers/MemoryClass.h</option>
<option value="listing13.html">/Headers/Menu.h</option>
<option value="listing14.html">/Headers/Process.h</option>
<option value="listing15.html">/Headers/Random.h</option>
<option value="listing16.html">/Headers/SoundClass.h</option>
<option value="listing17.html">/Headers/SpinCursor.h</option>
<option value="listing18.html">/Headers/Template.h</option>
<option value="listing19.html">/Headers/Timer.h</option>
<option value="listing20.html">/Headers/Toolbox.h</option>
<option value="listing21.html">/Headers/Tracer.h</option>
<option value="listing22.html">/Headers/UserTermination.h</option>
<option value="listing23.html">/Headers/Volume.h</option>
<option value="listing24.html">/Headers/Window.h</option>
<option value="listing25.html">/Resources/GUIApplication.r</option>
<option value="listing26.html">/Resources/MemoryClass.r</option>
<option value="listing27.html">/Resources/SoundClass.r</option>
<option value="listing28.html">/Resources/SpinCursor.r</option>
<option value="listing29.html">/Sources/AppleEvent.cp</option>
<option value="listing30.html">/Sources/Application.cp</option>
<option value="listing31.html">/Sources/CollectionClasses.cp</option>
<option value="listing32.html">/Sources/CollectionClassesTest.cp</option>
<option value="listing33.html">/Sources/ColorPicker.cp</option>
<option value="listing34.html">/Sources/ColorPickerTest.cp</option>
<option value="listing35.html">/Sources/DTSCPlusLibrary.cp</option>
<option value="listing36.html">/Sources/Environment.cp</option>
<option value="listing37.html">/Sources/EnvironmentTest.cp</option>
<option value="listing38.html">/Sources/FileClass.cp</option>
<option value="listing39.html">/Sources/FileClassTest.cp</option>
<option value="listing40.html">/Sources/GDevice.cp</option>
<option value="listing41.html">/Sources/GDeviceTest.cp</option>
<option value="listing42.html">/Sources/GraphicsEnv.cp</option>
<option value="listing43.html">/Sources/GraphicsEnvTest.cp</option>
<option value="listing44.html">/Sources/KeyMap.cp</option>
<option value="listing45.html">/Sources/KeyMapTest.cp</option>
<option value="listing46.html">/Sources/MemoryClass.cp</option>
<option value="listing47.html">/Sources/MemoryClassTest.cp</option>
<option value="listing48.html">/Sources/Menu.cp</option>
<option value="listing49.html">/Sources/Process.cp</option>
<option value="listing50.html">/Sources/ProcessTest.cp</option>
<option value="listing51.html">/Sources/Random.cp</option>
<option value="listing52.html">/Sources/RandomTest.cp</option>
<option value="listing53.html">/Sources/SoundClass.cp</option>
<option value="listing54.html">/Sources/SoundClassTest.cp</option>
<option value="listing55.html">/Sources/SpinCursor.cp</option>
<option value="listing56.html">/Sources/SpinCursorTest.cp</option>
<option value="listing57.html">/Sources/Template.cp</option>
<option value="listing58.html">/Sources/TemplateTest.cp</option>
<option value="listing59.html">/Sources/Timer.cp</option>
<option value="listing60.html">/Sources/TimerTest.cp</option>
<option value="listing61.html">/Sources/Toolbox.cp</option>
<option value="listing62.html">/Sources/ToolboxTest.cp</option>
<option value="listing63.html">/Sources/Tracer.cp</option>
<option value="listing64.html">/Sources/tracertest.cp</option>
<option value="listing65.html">/Sources/UserTermination.cp</option>
<option value="listing66.html">/Sources/UserTerminationTest.cp</option>
<option value="listing67.html">/Sources/Volume.cp</option>
<option value="listing68.html">/Sources/VolumeTest.cp</option>
<option value="listing69.html">/Sources/Window.cp</option></select>
				</p>
				</form>
				<p><strong><a href="DTSCPlusLibrary.zip">Download Sample</a></strong> (&#147;DTSCPlusLibrary.zip&#148;, 435.0K)<BR>
<strong><a href="DTSCPlusLibrary.dmg">Download Sample</a></strong> (&#147;DTSCPlusLibrary.dmg&#148;, 521.3K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    FileClass.cp  Contains:  TFile is a simple object that does file manipulations            TFile.cp contains the TFile class and subclass member functions.  Written by: Kent Sandvik    Copyright:  Copyright &copy; 1992-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        8/18/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#ifndef _FILECLASS_#include &quot;FileClass.h&quot;#endif// _________________________________________________________________________________________________________ ////  TFile#pragma segment FileTFile::TFile(char* name)// Create a file object based on the name.{  this-&gt;Initialize();              // initialize internal fields to known values  // We are going to assume a lot of things for the default setting  // and files, for instance that we are creating files in the current working directory (folder)  WDPBRec folderBlock;  folderBlock.ioNamePtr = nil;  fError = ::PBHGetVolSync(&amp;folderBlock);  VASSERT(fError == noErr, (&quot;Problems with PBHGetVol = %d&quot;, fError));  fFileSpec.vRefNum = folderBlock.ioVRefNum;  fFileSpec.parID = folderBlock.ioWDDirID;  c2p(name);  Pstrcpy(fFileSpec.name, (StringPtr)name);}#pragma segment FileTFile::TFile(FSSpec theSpec)// Create a file object based on the FSSpec.{  this-&gt;Initialize();              // initialize internal fields to known values  fFileSpec.vRefNum = theSpec.vRefNum;    // store the FSSpec  fFileSpec.parID = theSpec.parID;  Pstrcpy(fFileSpec.name, theSpec.name);}#pragma segment FileTFile::TFile(short volume,       long dirID,       Str63 name)// Create a file object based on the volume no, directory ID and the name.{  this-&gt;Initialize();              // initialize internal fields to known values  fFileSpec.vRefNum = volume;          // store values into the FSSpec  fFileSpec.parID = dirID;  Pstrcpy(fFileSpec.name, name);}#pragma segment FileTFile::~TFile()// Default destructor -- empty for the time being.{}#pragma segment Filevoid TFile::Initialize()// Initialize fields to known values.{  fFileType = kDefaultType;          // gee, we assume everyone's reading/writing text files  fCreator = kDefaultCreator;          // and who's that?  fOpened = false;              // not open yet\xC9  fFlushing = false;              // assume things are OK, so we don't flush unless something's critical}// MAIN INTERFACE#pragma segment FileBoolean TFile::Create()// Create a new file.{  if (!this-&gt;FileExists())  {    fError = ::HCreate(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, fCreator, fFileType);    VASSERT(fError == noErr, (&quot;Problems with HCreate = %d\n&quot;, fError));    goto CreateOK;  }  return false;CreateOK:return true;}#pragma segment FileBoolean TFile::Rename(char* newName)// Rename the file.{  if (this-&gt;FileExists())  {    c2p(newName);    fError = ::HRename(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, (StringPtr)newName);    VASSERT(fError == noErr, (&quot;Problems with HRename = %d&quot;, fError));    Pstrcpy(fFileSpec.name, (StringPtr)newName);    goto RenameOK;  }  return false;RenameOK:return true;}#pragma segment Filevoid TFile::Delete()// Delete the file.{  if (fOpened)    this-&gt;Close();              // first close the file  fError = ::HDelete(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name);  VASSERT(fError == noErr, (&quot;nProblems with HDelete = %d&quot;, fError));}#pragma segment FileBoolean TFile::FileExists()// Test if the file exists or not.{  FInfo info;  fError = HGetFInfo(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, &amp;info);  return (fError == noErr);}// ACCESSORS AND MUTATORS#pragma segment Filevoid TFile::SetType(const OSType creator,          const OSType fileType)// Set file type.{  fCreator = creator;  fFileType = fileType;}#pragma segment Filevoid TFile::SetFileName(const Str63 fileName)// Set file name.{  Pstrcpy(fFileSpec.name, (StringPtr)fileName);}#pragma segment FileFInfo TFile::GetFileInfo()// Get FInfo from the specified file.{  FInfo info;  fError = ::HGetFInfo(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, &amp;info);  VASSERT(fError == noErr, (&quot;Problems with HGetFInfo = %d&quot;, fError));  return info;}// _________________________________________________________________________________________________________ ////  TDataFile// CONSTRUCTORS AND DESTRUCTORS#pragma segment FileTDataFile::TDataFile(char* name) :  TFile(name)// Default constructor, create a file based on the name.{}#pragma segment FileTDataFile::~TDataFile()// Default destructor -- empty for the time being.{}// MAIN INTERFACE#pragma segment FileBoolean TDataFile::Open(SignedByte permission)// Open a file for data fork only access.{  fError = ::HOpen(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, permission, &amp;fRefNum);  VASSERT(fError == noErr, (&quot;Problems with HOpen = %d&quot;, fError));  if (fError == noErr)    fOpened = true;  return (fError == noErr);}#pragma segment FileBoolean TDataFile::Close()// Close the file.{  fError = ::FSClose(fRefNum);  VASSERT(fError == noErr, (&quot;Problems with FSClose = %d&quot;, fError));  if (fError == noErr)    fOpened = false;  if (fFlushing)                // if flagged, flush the volume  {    fError = ::FlushVol(NULL, fFileSpec.vRefNum);    VASSERT(fError == noErr, (&quot;Problems with FlushVol = %d&quot;, fError));  }  return (fError == noErr);}#pragma segment FileBoolean TDataFile::WriteHandle(Handle h)// Write a handle to file (the whole handle).{  long len = ::GetHandleSize(h);        // get lenght of handle  fError = ::SetFPos(fRefNum, fsFromStart, kNoOffset);// move pointer to beginning of file  VASSERT(fError == noErr, (&quot;Problems with SetFPos = %d&quot;, fError));  fError = ::FSWrite(fRefNum, &amp;len, *h);    // write the handle to disk  VASSERT(fError == noErr, (&quot;Problems with FSWrite = %d&quot;, fError));  fError = ::SetEOF(fRefNum, len);      // change size of file if needed  VASSERT(fError == noErr, (&quot;Problems with SetEOF = %d&quot;, fError));  if (fFlushing)  {    fError = ::FlushVol(NULL, fFileSpec.vRefNum);    VASSERT(fError == noErr, (&quot;Problems with FlushVol = %d&quot;, fError));  }  return (fError == noErr);}#pragma segment FileHandle TDataFile::ReadHandle()// Read handle from the file (the whole handle).{  Handle h = NULL;  long len;  fError = ::GetEOF(fRefNum, &amp;len);      // get size of handle in file  VASSERT(fError == noErr, (&quot;Problems with GetEOF = %d&quot;, fError));  h = ::NewHandle(len);            // create a new handle  if (h == NULL)                // problems creating a handle   {    ASSERT(fError == noErr, &quot;\pProblems with NewHandle&quot;);    goto ReadHandleFalse;  }  fError = ::SetFPos(fRefNum, fsFromStart, kNoOffset);  VASSERT(fError == noErr, (&quot;Problems with SetFPos = %d&quot;, fError));  fError = ::FSRead(fRefNum, &amp;len, *h);    // read into handle  VASSERT(fError == noErr, (&quot;Problems with SetFPos = %d&quot;, fError));  return h;ReadHandleFalse:return NULL;}#pragma segment FileBoolean TDataFile::Write(Ptr buffer,             long bytes)// Write N bytes from buffer to file.{  fError = ::FSWrite(fRefNum, &amp;bytes, buffer);  VASSERT(fError == noErr, (&quot;Problems with FSWrite = %d&quot;, fError));  return (fError == noErr);}#pragma segment FileBoolean TDataFile::Read(Ptr buffer,            long bytes)// Read N bytes from file to buffer.{  fError = ::FSRead(fRefNum, &amp;bytes, buffer);  VASSERT(fError == noErr, (&quot;Problems with FSWrite = %d&quot;, fError));  return (fError == noErr);}#pragma segment FileBoolean TDataFile::SetMark(short from,               long offset)// Set file mark (beginning, end, offset).{  if (fOpened)                // have an open file?  {    fError = ::SetFPos(fRefNum, from, offset);    VASSERT(fError == noErr, (&quot;Problems with SetFPos = %d&quot;, fError));    goto SetMarkOK;  }  else    return false;SetMarkOK:return (fError == noErr);}#pragma segment Filelong TDataFile::GetMark()// Get file mark (offset).{  long offset = 0;  fError = ::GetFPos(fRefNum, &amp;offset);  VASSERT(fError == noErr, (&quot;Problems with GetFPos = %d&quot;, fError));  return offset;}#pragma segment FileBoolean TDataFile::Reset()// Set file mark to beginning of file.{  return (this-&gt;SetMark(fsFromStart, kNoOffset));// set mark to beginning of file}#pragma segment FileBoolean TDataFile::GotoEndOfFile()// Set file mark to end of file.{  return (this-&gt;SetMark(fsFromLEOF, kNoOffset));// set mark to end of file}// _________________________________________________________________________________________________________ ////  TResourceFile// CONSTRUCTORS AND DESTRUCTORS#pragma segment FileTResourceFile::TResourceFile(char* name) :  TFile(name)// Default destructor, create a TResourceFile object.{}#pragma segment FileTResourceFile::~TResourceFile()// Default destructor -- not used for the time being.{}// MAIN INTERFACE#pragma segment FileBoolean TResourceFile::Create()// Create the actual resource file.{  if (!this-&gt;FileExists())  {    Boolean result = TFile::Create();    // call inherited create    if (result)                // if OK    {      ::HCreateResFile(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name);      goto CreateResourceOK;    }    else      goto CreateResourceFalse;      // result = false  }  else    goto CreateResourceFalse;        // couldn't create a file that existsCreateResourceFalse:return false;CreateResourceOK:if (ResError() == noErr)    return true;  else    return false;}#pragma segment FileBoolean TResourceFile::Open(SignedByte permission)// Open the resource file.{  if (fOpened)  {    fRefNum = ::HOpenResFile(fFileSpec.vRefNum, fFileSpec.parID, fFileSpec.name, permission);    VASSERT(fRefNum != -1, (&quot;Problems with HOpenResFile = %d&quot;, ::ResError()));    if (::ResError() == 0)      goto ResourceFileOpenOK;    else      goto ResourceFileOpenFalse;  }  else    goto ResourceFileOpenFalse;        // can't open an already open fileResourceFileOpenFalse:return false;ResourceFileOpenOK:fOpened = true;  return true;}#pragma segment FileBoolean TResourceFile::Close()// Close the resource file.{  if (fOpened)  {    ::CloseResFile(fRefNum);    VASSERT(fRefNum != -1, (&quot;Problems with CloseResFile = %d&quot;, ::ResError()));    if (::ResError() == 0)      goto ResourceFileCloseOK;    else      goto ResourceFileCloseFalse;  }ResourceFileCloseFalse:return false;ResourceFileCloseOK:fRefNum = 0;  fOpened = false;  return true;}#pragma segment FileBoolean TResourceFile::HasResourceFork()// Check if the supposed resource file actually has a resource fork.{  HFileParam pb;  pb.ioNamePtr = fFileSpec.name;        // get the name  pb.ioVRefNum = fFileSpec.vRefNum;      // and the volume  pb.ioDirID = fFileSpec.parID;        // and the DirID  pb.ioFDirIndex = 0;              // zero this one  fError = ::PBHGetFInfoSync((HParmBlkPtr) &amp; pb);// call the right trap  VASSERT(fError == noErr, (&quot;Problems with PBHGetFInfo = %d&quot;, fError));  return (pb.ioFlRLgLen != 0);        // if the resource fork is non-zero, then we got one}#pragma segment Filevoid TResourceFile::Update()// Update the resource file.{  if (fOpened)  {    ::UpdateResFile(fRefNum);    VASSERT(::ResError() == noErr, (&quot;Problems with UpdateResFile = %d&quot;, ::ResError()));    if (fFlushing)    {      fError = ::FlushVol(NULL, fFileSpec.vRefNum);      VASSERT(fError == noErr, (&quot;Problems with FlushVol = %d&quot;, fError));    }  }}#pragma segment Filevoid TResourceFile::Assign()// Make sure that we are using this specified resource file.{  if (fOpened)    ::UseResFile(fRefNum);}// _________________________________________________________________________________________________________ ///*  Change History (most recent last):  No    Init.  Date    Comment  1      khs    12/27/92  New file  2      khs    1/14/93    Cleanup*/</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/DTSCPlusLibrary/listing38.html%3Fid%3DDTS10000731-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/DTSCPlusLibrary/listing38.html%3Fid%3DDTS10000731-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/DTSCPlusLibrary/listing38.html%3Fid%3DDTS10000731-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>