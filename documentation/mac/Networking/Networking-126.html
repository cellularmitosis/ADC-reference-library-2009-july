<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>dspOpen(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING126></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-125.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-127.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-98.html"><B>Chapter 5 - AppleTalk Data Stream Protocol (ADSP) </B></A> / <A HREF="Networking-115.html"><B>ADSP Reference</B></A><BR><DL><DD><A HREF="Networking-122.html"><B>Routines</B></A> / <A HREF="Networking-123.html"><B>Establishing and Terminating an ADSP Connection</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING126-0></A>
<H3><A NAME=MARKER-9-315></A>dspOpen</H3>
 <A NAME=MARKER-2-62></A>The <A NAME=MARKER-2-317></A><CODE>dspOpen</CODE> routine opens a connection end. You can open a connection end in request mode, passive mode, accept mode, or establish mode. You use the <CODE>PBControl</CODE> function to call the <CODE>dspOpen</CODE> routine. See <A HREF=Networking-122.html#MARKER-9-273>"Routines" on page 5-43</A> for a description of the <CODE>PBControl</CODE> function.<P>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result. <TR>
<TD>--><TD>ioCRefNum<TD>Integer<TD>The driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always <CODE>dspOpen</CODE> for this function.<TR>
<TD>--><TD>ccbRefNum<TD>Integer<TD>The CCB reference number.<TR>
<TD><--<TD>localCID<TD>Integer<TD>The ID of this connection end.<TR>
<TD><-><TD>remoteCID<TD>Integer<TD>The ID of remote connection end.<TR>
<TD><-><TD>remoteAddress<TD>AddrBlock<TD>A remote internet address.<TR>
<TD>--><TD>filterAddress<TD>AddrBlock<TD>A filter for open-connection requests.<TR>
<TD><-><TD>sendSeq<TD>LongInt<TD>The initial send sequence number.<TR>
<TD><-><TD>sendWindow<TD>Integer<TD>The initial size of remote receive queue.<TR>
<TD>--><TD>recvSeq<TD>LongInt<TD>The initial receive sequence number.<TR>
<TD><-><TD>attnSendSeq<TD>LongInt<TD>The attention send sequence number.<TR>
<TD>--><TD>attnRecvSeq<TD>LongInt<TD>The attention receive sequence number.<TR>
<TD>--><TD>ocMode<TD>Byte<TD>The connection-opening mode.<TR>
<TD>--><TD>ocInterval<TD>Byte<TD>The interval between open requests.<TR>
<TD>--><TD>ocMaximum<TD>Byte<TD>The number of open-connection <BR>request retries.</TABLE>
</B><P>
 The use of parameters by the <CODE>dspOpen</CODE> routine depends on the mode in which the routine is executed, as follows:
<TABLE BORDER="0" CELLPADDING=3><TH colspan=2>ocRequest<TH colspan=2>ocPassive<TH colspan=2>ocAccept<TH colspan=2>ocEstablish<TR>
<TD>--><TD>ioCompletion<TD>--><TD>ioCompletion<TD>--><TD>ioCompletion<TD>--><TD>ioCompletion<TR>
<TD><--<TD>ioResult<TD><--<TD>ioResult<TD><--<TD>ioResult<TD><--<TD>ioResult<TR>
<TD>--><TD>ioCRefNum<TD>--><TD>ioCRefNum<TD>--><TD>ioCRefNum<TD>--><TD>ioCRefNum<TR>
<TD>--><TD>csCode<TD>--><TD>csCode<TD>--><TD>csCode<TD>--><TD>csCode<TR>
<TD>--><TD>ccbRefNum<TD>--><TD>ccbRefNum<TD>--><TD>ccbRefNum<TD>--><TD>ccbRefNum<TR>
<TD><--<TD>localCID<TD><--<TD>localCID<TD><--<TD>localCID<TD>--<TD>localCID<TR>
<TD><--<TD>remoteCID<TD><--<TD>remoteCID<TD>--><TD>remoteCID<TD>--><TD>remoteCID<TR>
<TD>--><TD>remoteAddress<TD><--<TD>remoteAddress<TD>--><TD>remoteAddress<TD>--><TD>remoteAddress<TR>
<TD>--><TD>filterAddress<TD>--><TD>filterAddress<TD>--<TD>filterAddress<TD>--<TD>filterAddress<TR>
<TD><--<TD>sendSeq<TD><--<TD>sendSeq<TD>--><TD>sendSeq<TD>--><TD>sendSeq<TR>
<TD><--<TD>sendWindow<TD><--<TD>sendWindow<TD>--><TD>sendWindow<TD>--><TD>sendWindow<TR>
<TD>--<TD>recvSeq<TD>--<TD>recvSeq<TD>--<TD>recvSeq<TD>--><TD>recvSeq<TR>
<TD><--<TD>attnSendSeq<TD><--<TD>attnSendSeq<TD>--><TD>attnSendSeq<TD>--><TD>attnSendSeq<TR>
<TD>--<TD>attnRecvSeq<TD>--<TD>attnRecvSeq<TD>--<TD>attnRecvSeq<TD>--><TD>attnRecvSeq<TR>
<TD>--><TD>ocMode<TD>--><TD>ocMode<TD>--><TD>ocMode<TD>--><TD>ocMode<TR>
<TD>--><TD>ocInterval<TD>--><TD>ocInterval<TD>--><TD>ocInterval<TD>--<TD>ocInterval<TR>
<TD>--><TD>ocMaximum<TD>--><TD>ocMaximum<TD>--><TD>ocMaximum<TD>--<TD>ocMaximum<TR>
<TD colspan=8><I>Key:</I>  --> input  <-- output  <-> input and output  -- not used</TABLE>
<P>
<DL>
<H5>Field Description</H5>
<DT><CODE>csCode</CODE>
<DD> The routine selector, always equal to <CODE>dspOpen</CODE> for this routine. 
<DT><CODE>ccbRefNum</CODE>
<DD> The connection control block (CCB) reference number that was returned by the <CODE>dspInit</CODE> routine for the connection end that you want to use.
<DT><CODE>localCID</CODE>
<DD> The identification number of the local connection end. This number is assigned by ADSP when you open the connection. ADSP includes this number in every packet sent to a remote connection end. Before you call the <CODE>dspOpen</CODE> routine in <CODE>ocEstablish</CODE> mode, you must call the <CODE>dspNewCID</CODE> routine to cause ADSP to assign this value.<A NAME=MARKER-2-34></A>
<DT><CODE>remoteCID</CODE>
<DD> The identification number of the remote connection end. This parameter is returned by the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> and <CODE>ocPassive</CODE> modes. A connection server must provide this number to the <CODE>dspOpen</CODE> routine when the server executes the routine in <CODE>ocAccept</CODE> mode; in this case, the connection server obtains the <CODE>remoteCID</CODE> value from the <CODE>dspCLListen</CODE> routine. You must provide the <CODE>remoteCID</CODE> value to the <CODE>dspOpen</CODE> routine when you use the routine in <CODE>ocEstablish</CODE> mode. <A NAME=MARKER-2-132></A>
<DT><CODE>remoteAddress</CODE>
<DD> The internet address of the remote socket with which you wish to establish communications. This address consists of a 2-byte network number, a 1-byte node ID, and a 1-byte socket number. You must provide this parameter when you call the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> or <CODE>ocEstablish</CODE> mode. This parameter is returned by the <CODE>dspOpen</CODE> routine when you call the routine in the <CODE>ocPassive</CODE> mode. When you call the <CODE>dspOpen</CODE> routine in the <CODE>ocAccept</CODE> mode, you must use the value for the <CODE>remoteAddress</CODE> parameter that was returned by the <CODE>dspCLListen</CODE> routine. <A NAME=MARKER-2-143></A>
<DT><CODE>filterAddress</CODE>
<DD> <A NAME=MARKER-2-153></A>The internet address of the socket from which you will accept a connection request. The address consists of three fields: a 2-byte network number, a 1-byte node ID, and a 1-byte socket number. Specify 0 for any of these fields for which you wish to impose no restrictions. If you specify a filter address of $00082500, for example, the connection end accepts a connection request from any socket at node $25 of network $0008. Set the <CODE>filterAddress</CODE> parameter equal to the <CODE>remoteAddress</CODE> parameter to accept a connection only with the socket to which you sent a connection request.<A NAME=MARKER-2-77></A>
<DT>
<DD> When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocPassive</CODE> mode, you can receive a connection request from any ADSP connection end on the internet. When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> mode, your connection end can receive a connection request acknowledgment from an address different from the one you specified in the <CODE>remoteAddress</CODE> parameter only if the remote address you specified was that of a connection listener. In either case, you can use the <CODE>filterAddress</CODE> parameter to avoid acknowl-<BR>edging unwanted connection requests. 
<DT>
<DD> When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocAccept</CODE> mode, your connection listener has already received and decided to accept the connection request. You can specify a filter address for a connection listener with the <CODE>dspCLListen</CODE> routine. A connection server can use the <CODE>dspCLDeny</CODE> routine to deny a connection request that was accepted by its connection listener.
<DT>
<DD> You cannot use the filter address when you execute the <CODE>dspOpen</CODE> routine in <CODE>ocEstablish</CODE> mode.
<DT><CODE>sendSeq</CODE>
<DD> The sequence number of the first byte that the local connection end will send to the remote connection end. ADSP uses this number to coordinate communications and to check for errors. ADSP returns a value for the <CODE>sendSeq</CODE> parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> or <CODE>ocPassive</CODE> mode. When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocAccept</CODE> mode, you must specify <BR>the value for the <CODE>sendSeq</CODE> parameter that was returned by the <CODE>dspCLListen</CODE> routine. You must provide the value for this parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocEstablish</CODE> mode.<A NAME=MARKER-2-86></A>
<DT><CODE>sendWindow</CODE>
<DD> The sequence number of the last byte that the remote connection end has buffer space to receive. ADSP uses this number to coordinate communications and to check for errors. ADSP returns <BR>a value for the <CODE>sendWindow</CODE> parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> or <CODE>ocPassive</CODE> mode. When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocAccept</CODE> mode, you must specify the value for the <CODE>sendWindow</CODE> parameter that was returned by the <CODE>dspCLListen</CODE> routine. You must provide the value for this parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocEstablish</CODE> mode.<A NAME=MARKER-2-18></A>
<DT><CODE>recvSeq</CODE>
<DD> The sequence number of the next byte that the local connection <BR>end expects to receive. ADSP uses this number to coordinate communications and to check for errors. You must provide the value for this parameter when you execute the <CODE>dspOpen</CODE> routine <BR>in the <CODE>ocEstablish</CODE> mode. The <CODE>dspOpen</CODE> routine does not use <BR>this parameter when you execute it in any other mode.<A NAME=MARKER-2-26></A>
<DT><CODE>attnSendSeq</CODE> 
<DD> The sequence number of the next attention packet that the local connection end will transmit. ADSP uses this number to coordinate communications and to check for errors. ADSP returns a value <BR>for the <CODE>attnSendSeq</CODE> parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE> or <CODE>ocPassive</CODE> mode. When you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocAccept</CODE> mode, you must specify <BR>the value for the <CODE>attnSendSeq</CODE> parameter that was returned <BR>by the <CODE>dspCLListen</CODE> routine. You must provide the value for <BR>this parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocEstablish</CODE> mode.<A NAME=MARKER-2-128></A>
<DT><CODE>attnRecvSeq</CODE> 
<DD> The sequence number of the next attention packet that the local connection end expects to receive. ADSP uses this number to ensure that packets are delivered in the correct order and to check for errors. You must provide a value for this parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocEstablish</CODE> mode. The <CODE>dspOpen</CODE> routine does not use this parameter when you execute it in any other mode.<A NAME=MARKER-2-138></A>
<DT><CODE>ocMode</CODE>
<DD> <A NAME=MARKER-2-33></A>The <A NAME=MARKER-2-61></A>mode in which the <CODE>dspOpen</CODE> routine is to operate, as follows: 
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Mode<TH>Value<TH>Meaning<TR>
<TD>&nbsp;<TD>ocRequest<TD>1<TD><A NAME=MARKER-13-5></A>ADSP attempts to open a connection with the socket you specify.<A NAME=MARKER-2-37></A><TR>
<TD>&nbsp;<TD>ocPassive<TD>2<TD><A NAME=MARKER-13-7></A>The connection end waits to receive a connection request.<A NAME=MARKER-2-13></A><TR>
<TD>&nbsp;<TD>ocAccept<TD>3<TD><A NAME=MARKER-13-9></A>The connection server accepts and acknowledges receipt of a connection request.<TR>
<TD>&nbsp;<TD>ocEstablish<TD>4<TD><A NAME=MARKER-13-11></A>ADSP considers the connection established and open; you are responsible for setting up and synchronizing both connection ends.<A NAME=MARKER-2-12></A></TABLE>

<DT><CODE>ocInterval</CODE>
<DD> The period between transmissions of open-connection requests. <BR>If the remote connection end does not acknowledge or deny an open-connection request, ADSP retransmits the request after a <BR>time period specified by this parameter. The time period used by ADSP is (<CODE>ocInterval</CODE>  10) ticks, or (<CODE>ocInterval</CODE>/6) seconds. For example, if you set the <CODE>ocInterval</CODE> parameter to 3, the time period between retransmissions is 30 ticks (1/2 second). You can set the <CODE>ocInterval</CODE> parameter to any value from 1 (1/6 second) to <BR>180 (30 seconds). If you specify 0 for the <CODE>ocInterval</CODE> parameter, ADSP uses the default value of 6 (1 second).<A NAME=MARKER-2-144></A>
<DT>
<DD> You must provide a value for the <CODE>ocInterval</CODE> parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE>, <CODE>ocPassive</CODE>, or <CODE>ocAccept</CODE> mode. The <CODE>dspOpen</CODE> routine does not use this parameter when you execute it in the <CODE>ocEstablish</CODE> mode.
<DT><CODE>ocMaximum</CODE>
<DD> The maximum number of times to retransmit an open-connection request before ADSP terminates execution of the <CODE>dspOpen</CODE> routine. If you specify 0 for the <CODE>ocMaximum</CODE> parameter, ADSP uses the default value of 3. If you specify 255 for the <CODE>ocMaximum</CODE> parameter, ADSP retransmits the open-connection request indefinitely until the remote connection end either acknowledges or denies the request.<A NAME=MARKER-2-5></A>
<DT>
<DD> You must provide a value for the <CODE>ocMaximum</CODE> parameter when you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocRequest</CODE>, <CODE>ocPassive</CODE>, or <CODE>ocAccept</CODE> mode. The <CODE>dspOpen</CODE> routine does not use this parameter when you execute it in the <CODE>ocEstablish</CODE> mode.
</DL>
<A NAME=HEADING126-23></A>
<H5>DESCRIPTION</H5>
 The <CODE>dspOpen</CODE> routine opens a connection end. You set the <CODE>ocMode</CODE> field of the parameter block to specify the opening mode that the <CODE>dspOpen</CODE> routine is to use. The <CODE>dspOpen</CODE> routine puts a connection end into one of the four following opening modes: <A NAME=MARKER-2-333></A><P>
<UL>
<LI>The <CODE>ocRequest</CODE> mode, in which ADSP attempts to open a connection with the socket at the internet address you specify as the <CODE>remoteAddress</CODE> parameter. If the socket you specify as a remote address is a connection listener, it is possible that your application will receive a connection acknowledgment and request from a different address than the one to which you sent the open-connection request. You can use <BR>the <CODE>filterAddress</CODE> parameter to restrict the addresses with which you will accept <BR>a connection. <P>
The <CODE>dspOpen</CODE> routine completes execution in the <CODE>ocRequest</CODE> mode when one of the following occurs: ADSP establishes a connection, your connection end receives <BR>a connection denial from the remote connection end, your connection end denies the connection request returned by a connection listener, or ADSP cannot complete <BR>the con<A NAME=MARKER-2-25></A>nection within the maximum number of retries that you specified with the <CODE>ocMaximum</CODE> parameter.
<LI>The <CODE>ocPassive</CODE> <CODE>mode</CODE>, in which the connection end waits to receive an open-<BR>connection request from a remote connection end. You can use the <CODE>filterAddress</CODE> parameter to restrict the addresses from which you will accept a connection request.<P>
The <CODE>dspOpen</CODE> routine completes execution in the <CODE>ocPassive</CODE> mode when ADSP establishes a connection or when either connection end receives a connection denial.
<LI>The <CODE>ocAccept</CODE> mode, used by connection servers to complete an open-connection dialog. When a connection server is informed by its connection listener that the connection listener has received an open-connection request, the connection server calls the <CODE>dspInit</CODE> routine to establish a connection end and then calls the <CODE>dspOpen</CODE> routine in <CODE>ocAccept</CODE> mode to complete the connection. You must obtain the following parameters from the <CODE>dspCLListen</CODE> routine and provide them to the <CODE>dspOpen</CODE> routine: <CODE>remoteAddress</CODE>, <CODE>remoteCID</CODE>, <CODE>sendSeq</CODE>, <CODE>sendWindow</CODE>, and <CODE>attnSendSeq</CODE>. Connection listeners and connection servers are described in <A HREF=Networking-111.html#MARKER-9-184>"Creating and Using a Connection Listener" beginning on page 5-22</A> and in <A HREF=Networking-123.html#MARKER-9-278>"Establishing and Terminating an ADSP Connection" beginning on page 5-44</A>. See <A HREF=Networking-101.html#MARKER-9-100>"Connection Listeners" on page 5-7</A> for a brief introduction to connection listeners.<P>
The <CODE>dspOpen</CODE> routine completes execution in the <CODE>ocAccept</CODE> mode when ADSP establishes a connection or when either connection end receives a connection denial.
<LI>The <CODE>ocEstablish</CODE> mode, in which ADSP considers the connection end established and the connection state open. This mode is for use by clients that determine their connection-opening parameters without using ADSP or the .DSP driver to do so. <P>
You must first use the <CODE>dspInit</CODE> routine to establish a connection end and then execute the <CODE>dspNewCID</CODE> routine to obtain an identification number (ID) for the <BR>local connection end. You must then communicate with the remote connection end <BR>to send it the local connection ID and to determine the values of the following parameters: <CODE>remoteAddress</CODE>, <CODE>remoteCID</CODE>, <CODE>sendSeq</CODE>, <CODE>sendWindow</CODE>, <CODE>recvSeq</CODE>, <CODE>attnSendSeq</CODE>, and <CODE>attnRecvSeq</CODE>. Only then can you execute the <CODE>dspOpen</CODE> routine in the <CODE>ocEstablish</CODE> mode.<P>
The <CODE>dspOpen</CODE> routine completes execution in the <CODE>ocEstablish</CODE> mode immediately. <P>
</UL>
<A NAME=HEADING126-34></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>dspOpen</CODE> routine from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>dspOpen</CODE> in the <CODE>csCode</CODE> field of the parameter block. <P>
<A NAME=HEADING126-36></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>errOpenDenied<TD>-1273<TD>Open request denied by recipient<TR>
<TD>errOpening<TD>-1277<TD>Attempt to open connection failed<TR>
<TD>errState<TD>-1278<TD>Connection end must be closed<TR>
<TD>errAborted<TD>-1279<TD>Request aborted by <CODE>dspRemove</CODE> or <CODE>dspClose</CODE> routine<TR>
<TD>errRefNum<TD>-1280<TD>Bad connection reference numbe<A NAME=MARKER-2-181></A>r</TABLE>
</H5>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-125.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-127.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
