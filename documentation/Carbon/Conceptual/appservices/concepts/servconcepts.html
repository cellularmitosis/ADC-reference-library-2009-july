<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Setting Up Your Carbon Application to Use the Services Menu: Application Services Concepts</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Application Services Concepts"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000993-CH205" title="Application Services Concepts"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../InterapplicationCommunication-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000451" target="_top">Interapplication Communication</a> &gt; <a href="../intro/servintro.html#//apple_ref/doc/uid/TP30000993-CH204-DontLinkElementID_15">Setting Up Your Carbon Application to Use the Services Menu</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../intro/servintro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../tasks/servicestasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_7" title="Application Services Concepts"></a><h1><a name="//apple_ref/doc/uid/TP30000993-CH205-TPXREF101" title="Application Services Concepts"></a>Application Services Concepts</h1><p>This chapter provides an overview of the Services menu and describes how application services are provided and accessed. It also shows typical examples of the services available to, or provided by, applications in Mac OS X. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF102">Types of Application Services</a>
				
			<br/>
			
        
			
			
				<a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJGHDJA">Installation Paths for Services</a>
				
			<br/>
			
        
			
			
				<a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF103">Items in the Services Menu</a>
				
			<br/>
			
        
			
			
				<a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF104">Services Properties</a>
				
			<br/>
			
        
			
			
				<a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF106">What Happens When a Service Is Invoked</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000993-CH205-TPXREF102" title="Types of Application Services"></a><h2>Types of Application Services</h2><p>Mac OS X offers two types of services:</p><ul class="ul"><li class="li"><p>Processor. This type of service acts on data. A processor service acts on the current selection and then sends it to the service. For example, if a user selects an email address in a TextEdit document, and then chooses Mail > Mail To from the Services menu, Mail copies the person’s address, launches the Mail application, and pastes the address into the To field of a new email message.</p></li><li class="li"><p>Provider. This type of service gives data to the calling application. For example, if a user chooses Grab > Screen from the Services menu, the Grab application opens, takes a screenshot, then returns the screenshot (TIFF data in this case) to the calling application. The calling application (such as TextEdit) is responsible for pasting the data into the active document. </p></li></ul><p>Let’s take a look at a few examples. <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJFAEHJ">Figure 2-1</a></span> shows the Services menu from the TextEdit application. Make Sticky is an example of a processor service. The Make Sticky command takes the current selection in the TextEdit document, opens a new Stickies document, and then pastes the selection into the Stickies document. </p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_8" title="Figure 1-1Make Sticky is a processor service "></a><p><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJFAEHJ" title="Figure 1-1Make Sticky is a processor service "></a><strong>Figure 1-1&nbsp;&nbsp;</strong>Make Sticky is a processor service </p><img src = "../art/servicesmakesticky.gif" alt = "Make Sticky is a processor service" width="405" height="201"></div><br/><p><span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJJJEAH">Figure 2-2</a></span> shows another example of a processor service. In this case, the Open URL command copies the selected text, launches a Web browser, pastes the selected text into the browser’s location field, and then tries to connect to that location.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_9" title="Figure 1-2Open URL is a processor service"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJJJEAH" title="Figure 1-2Open URL is a processor service"></a><strong>Figure 1-2&nbsp;&nbsp;</strong>Open URL is a processor service</p><img src = "../art/serviceopenurl.gif" alt = "Open URL is a processor service" width="459" height="204"></div><br/><p>Grab is a provider service. <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJEIJGJ">Figure 2-3</a></span> shows the Wolf Facts document before Grab > Screen is invoked. <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJIIDGE">Figure 2-4</a></span> shows the Wolf Facts document after Grab has taken a shot of the current screen and returned the data to the TextEdit application. Recall that it is TextEdit’s responsibility to do something with the returned data. In this example, TextEdit simply pastes the TIFF into the current document at the active insertion point.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_10" title="Figure 1-3Grab is a provider service "></a><p><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJEIJGJ" title="Figure 1-3Grab is a provider service "></a><strong>Figure 1-3&nbsp;&nbsp;</strong>Grab is a provider service </p><img src = "../art/servicespostgrab.gif" alt = "Grab is a provider service" width="638" height="333"></div><br/><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_11" title="Figure 1-4The Wolf Facts document after a screenshot has been inserted"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJIIDGE" title="Figure 1-4The Wolf Facts document after a screenshot has been inserted"></a><strong>Figure 1-4&nbsp;&nbsp;</strong>The Wolf Facts document after a screenshot has been inserted</p><img src = "../art/servicespregrab.gif" alt = "The Wolf Facts document after a screenshot has been inserted" width="473" height="202"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJGHDJA" title="Installation Paths for Services "></a><h2>Installation Paths for Services </h2><p>A service can be offered as part of an application, such as Mail, or as a standalone service—one without a user interface that is intended for use only in the Services menu. Applications that offer services should be built with the <code>.app</code> extension and installed in the <code>/Applications</code> folder. A standalone service should be built with the <code>.service</code> extension and stored in the <code>/Library/Services</code> folder.</p><p>When a user logs in, Mac OS X searches the <code>/Applications</code> and <code>/Library/Services</code> folders in the four file-system domains—System, Network, Local, and User. (See <em>Inside Mac OS X: System Overview</em> for details on file-system domains.) The system examines the information property list for each bundle in these locations and assembles a list of available services (see <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF104">“Services Properties”</a></span>). It uses this information to populate the items in the Services menu.</p><a name="//apple_ref/doc/uid/TP30000993-CH205-TPXREF103" title="Items in the Services Menu"></a><h2>Items in the Services Menu</h2><p>The Services menu appears automatically as an item in the application menu for Carbon and Cocoa applications. (This is a new feature for Carbon applications, starting with Mac OS X version 10.1.) If an application enables services (see <span class="content_text"><a href="../tasks/servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGBHBJ">“Using a Service”</a></span>), the appropriate items are available in the Services submenu. Otherwise, items in the Services menu are dimmed.</p><p>The items in the Services submenu can be commands or submenus that contain commands. The exact wording of the commands and whether or not there is a submenu is specified by the application. Typically, if an application offers only one service, just the service (stated as a command) is listed in the Services menu. For example, the Stickies application offers only one service—making a new Sticky note—so only the command Make Sticky is listed in the Services menu.</p><p>If an application offers more than one service, the application’s name appears in the Services menu, and the services offered by the application appear in a submenu. For example, the Grab application offers three services: taking a screenshot of the entire screen, taking a screenshot of a selected part of the screen, and taking a screenshot of the entire screen after a set amount of time. As you can see in <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJEIJGJ">Figure 2-3</a></span>, Grab is an item in the Services menu that has its own submenu listing the commands that invoke Grab’s three services: Screen, Selection, and Timed Screen. </p><p>The Services menu for an application is populated with items when the application starts up, but items in the menu aren’t enabled until the user chooses Services from the application menu. Choosing Services causes an event that asks the application to supply the data types it handles. For example, if an application only creates or reads plain text files, it should respond to the event by supplying text as the data type the application can handle. Only those services that provide or act on text will be enabled in the Services menu. The other menu items will be dimmed, unavailable for the user to choose. </p><a name="//apple_ref/doc/uid/TP30000993-CH205-TPXREF104" title="Services Properties"></a><h2>Services Properties</h2><p>Any application that has one or more services to provide must advertise the type of data its services can handle. Services are advertised through the <code>NSServices</code> property of the application’s information property list (<code>Info.plist</code> file). </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_12" title="Note"></a><p><strong>Note:</strong>&nbsp;The information property list (<code>Info.plist</code>) contains key-value pairs that specify the application’s properties that are of interest to the Finder and other applications. Although the <code>Info.plist</code> is a text file that uses XML (Extensible Markup Language) format, you should not modify the XML directly unless you are very familiar with XML syntax. Instead, use Project Builder or the Property List Editor application provided with Mac OS X to modify the <code>Info.plist</code> file. You can find more information on property lists in <em>Inside Mac OS X: System Overview</em>.</p></div><p><code>NSServices</code> is a property whose value is an array of dictionaries that specifies the services provided by the application. Keys for each dictionary entry, are as follows:</p><ul class="ul"><li class="li"><p><code>NSMessage</code> indicates the name of the service to invoke. </p></li><li class="li"><p><code>NSPortName</code> is the name of the port to which the application should listen for service requests. Its value depends on how the service provider application is registered. In most cases, this is the application name. </p></li><li class="li"><p><code>NSMenuItem</code> specifies the text of the Services menu item. You can use a slash to specify a submenu. For example, <code>Mail/Send Selection</code> appears in the Services menu as a submenu named Mail with an item named Send Selection. <code>NSMenuItem</code> must be unique, as only one is used in the Services menu if there are duplicates.</p></li><li class="li"><p><code>NSKeyEquivalent</code> is an optional item that specifies the keyboard equivalent that invokes the menu command.</p></li><li class="li"><p><code>NSSendTypes</code> is an array that contains data type names. Send types are the types sent from the application requesting a service. An applicaton that provides a service must specify an <code>NSSendType</code>, an <code>NSReturnType</code>, or both.</p></li><li class="li"><p><code>NSReturnTypes</code> is an array that contains data type names. Return types are the data types returned to the application requesting a service. An applicaton that provides a service must specify an <code>NSSendType</code>, an <code>NSReturnType</code>, or both.</p></li><li class="li"><p><code>NSUserData</code> is an optional string that contains a value of your choice. You can use this string to customize the behavior of your service. This entry is useful for applications that provide open-ended services. </p></li><li class="li"><p><code>NSTimeout</code> is an optional string that indicates the number of milliseconds Services should wait for a response from the application providing a service when a response is required. If wait time exceeds the timeout value, Services displays an error message to the user. If you don’t specify this entry, the timeout value is 30000 milliseconds (30 seconds).</p></li></ul><p>Let’s take a look at the information property list for the Grab application. The <code>NSServices</code> property is shown in <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJFEEJB">Figure 2-5</a></span> as it appears in the Property List Editor application. </p><p>The <code>NSServices</code> property has three entries, one for each service offered by Grab. The first entry is for the menu item Grab > Selection. The slash notation—Grab/Selection—specifies that Selection should be an item in the Grab submenu. (See <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJEIJGJ">Figure 2-3</a></span>.) </p><p>Note that for each of the three entries, the port name is Grab. As mentioned, the port name is usually the application name.</p><p>Each entry has one return type, <code>NSTIFFPboardType</code>. An application could have more than one return type per entry, and the return types don’t necessarily need to be the same for each entry. </p><p>The entry for Grab/Timed Screen is the only entry that has a specified timeout value. This optional entry is needed in this case so that the Grab application can wait for the user to set up the screen before taking a screenshot.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_13" title="Figure 1-5The NSServices property for the Grab application"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH205-BAJFEEJB" title="Figure 1-5The NSServices property for the Grab application"></a><strong>Figure 1-5&nbsp;&nbsp;</strong>The NSServices property for the Grab application</p><img src = "../art/servicesgrabplist.gif" alt = "The NSServices property for the Grab application" width="506" height="401"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH205-TPXREF106" title="What Happens When a Service Is Invoked"></a><h2>What Happens When a Service Is Invoked</h2><p>This section provides an overview of what happens when a service is invoked from a Carbon application. We’ll use a fictitious text editing application—BestTextEdit—to illustrate what happens when the user chooses Services from the application menu. In this example, a text document is open and active, and there are several paragraphs of text visible. The user has selected some of the text and wants to mail the selected text to a colleague. Now the user opens the application menu and chooses Services.</p><p>As soon as the user chooses Services, the system sends a Carbon event of class <code>kEventClassService</code> and kind <code>kEventServiceGetTypes</code> to the application. In essence, the system wants to know what types the application (BestTextEdit) can provide (copy data types) or accept (paste data types). When the BestTextEdit application receives the Carbon event, it must determine what types are appropriate for the current state of the application. Recall the user has selected text (<code>OSType</code><code>'TEXT'</code>), so BestTextEdit should indicate it can provide text data. It should also be able to accept text data, and may be able to accept other types of data (such as TIFF). </p><p>The BestTextEdit application provides the data types in the Carbon event parameters <code>kEventParamServicesCopyTypes</code> and <code>kEventParamServicesPasteTypes</code>. Each parameter is of type <code>typeCFMutableArrayRef</code>, so more than one data type can be provided if it’s appropriate.</p><p>Once the system knows what data types the BestTextEdit application can handle, it enables the appropriate services. At that point, the user can choose GreatMailApp> Mail To from the Services menu. Figuring out the data types and enabling the appropriate items in the Services menu happens quite rapidly. In fact, to the user, items should appear in the Services menu instantaneously.</p><p>When the user chooses GreatMailApp > Mail To from the Services menu, a Carbon event of class <code>kEventClassService</code> and kind <code>kEventServiceCopy</code> is sent to the BestTextEdit application. The BestTextEdit applicaton must then copy the current text selection to the scrap provided to the application in the services event. Once the data is copied, the Carbon Event Manager sends a Carbon event of class <code>kEventClassService</code> and kind <code>kEventServicePerform </code>to the GreatMailApp application. </p><p>The GreatMailApp application can provide two services: Mail To and Mail Text. Before mail does anything, it must determine which service it needs to provide to the BestTextEdit application. GreatMailApp does this by checking the Carbon event parameter <code>kEventParamServiceMessageName</code>. The string provided in this parameter specifies which service was invoked from the Services menu. When GreatMailApp determines Mail To is the service it must provide, the GreatMailApp application gets the text from the scrap provided by the Carbon Event Manager, opens a new message, and pastes the text into the new message.</p><p>What if nothing is selected in the document when the user chooses Services? The application can’t provide any data, so BestTextEdit shouldn’t provide any data types for the Carbon event parameter <code>kEventParameterServiceCopyTypes</code>. The items in the Services menu are dimmed and not available to the user.</p><p>If the user chooses a service that provides data, such as a screen capture service, the BestTextEdit application receives a Carbon event of class <code>kEventClassService</code> and kind <code>kEventServicePaste</code> after the service has copied the data to the scrap provided to the service by the Carbon Event Manager. The BestTextEdit application responds to the event by copying the data from the scrap and then handling it as appropriate, such as pasting it into the active document at the current insertion point.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000993-CH205-DontLinkElementID_14" title="Note"></a><p><strong>Note:</strong>&nbsp;The Carbon Event Manager uses a specific scrap to pass data between a service provider and a service requestor. The notion of a specific scrap is new to Carbon. In the past there was one public scrap, what users refer to as the Clipboard, and what the Scrap Manager referred to as the current scrap, or simply the scrap. The Scrap Manager has a new function, <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearScrap" target="_top">ClearScrap</a></code>, that takes a scrap reference as a parameter.</p>Specific scraps are parallel in concept to the Cocoa <code>NSPasteboard</code> class. Application services are actually implemented in Cocoa. Elsewhere in this document you’ll see that other Cocoa concepts have been leveraged for the Carbon implementation of application services. (For example, see <span class="content_text"><a href="servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF104">“Services Properties.”</a></span>)</p></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../intro/servintro.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../tasks/servicestasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-12-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/appservices/concepts/servconcepts.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/appservices/concepts/servconcepts.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/appservices/concepts/servconcepts.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>