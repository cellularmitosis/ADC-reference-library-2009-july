<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PT555: MPW C++ Q&amp;As</title>                                       <meta name="categories" content="Platforms and Tools"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002704" title="MPW C++ Q&As"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PT555</div>
<div id="pageheadsub">MPW C++ Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic - questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <A HREF = "../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Labels in block with destructors not implemented</h2><P>Date Written:   3/2/93</p><P>Last reviewed: 7/2/93</p><p>When I try to compile some C++ code that I'm porting from another platform, Iget the error message shown below. Can you shed some light on what the errormeans? I can avoid it by removing labels, but sometimes it's difficult to fix.What's the real cure?</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre># 4:14:35 PM ----- Executing build commands.    CPlus -s tops1 -model far -sym on -mf test.cp    Set Echo 0</pre>	</TD></TR></TABLE></CENTER><P>The error message is correct; labels in a scope that locally defines objectswith destructors aren't supported. The most appropriate fix would be forAT&amp;T to fix their <code>CFront</code> code to support this, but that's not going tohappen right away.</p><p>The variety of twisted code paths that become possible when labels and gotosare used probably gave the compiler programmers conniptions. When code cancontain constructors and destructors, the C++ compiler has to be extremelycareful to construct each object only once and destruct each object only once.This probably was a problem for the C++ compiler if gotos were allowed, so thecompiler programmers must have chickened out and didn't write the necessarycode (at least, not yet). The only solution to this error is either to avoidthe label and goto constructs (which you've been trying to do) or to keep anyobjects with destructors out of the block that contains the label.</p><h2>C++ stand-alone code and memory management</h2><P>Date Written:  9/4/92</p><P>Last reviewed:  11/1/92</p><P>We're trying to use MPW C++ 3.2 in stand-alone code using the techniquedescribed in "Polymorphic Code Resources in C++," in <i>develop</i> issue #4.However, we've found that <code>new</code> and <code>malloc</code> both access A5. Is this correct?What's the workaround?</p><P>Unfortunately, you are absolutely correct, in that both <code>new</code> and <code>malloc</code> attemptto use A5-relative globals. Malloc uses global data space to maintainstructures that track its use of memory (the free list, for example); new,because it is based on <code>malloc</code>, suffers from the same limitation. This willlimit your use of <code>malloc</code> and <code>new</code> to when you have an A5 world installed. Also,you will need to be very careful with your memory allocation, because <code>new</code> and<code>malloc</code> do not generally dispose of the memory they request from the Macintosh.They allocate Macintosh Memory Manager blocks with <code>NewPtr</code>, then use that memoryto satisfy requests made by the program. When all of the memory is freed, the<code>NewPtr</code> blocks are not disposed of - they will remain to clutter up the heap.This is particularly a problem with stand-alone code, because most stand-alonecode runs as a parasite in someone else's heap; this means that there may be nosimple way to deallocate these blocks; they may remain just to clutter thehost's heap.</p><p>Our only suggestion is to discontinue use of the ANSI library memory calls;instead, use the Macintosh memory calls, <code>NewPtr</code> and <code>NewHandle</code>. These do notrequire the use of global data space and when their memory is freed, it getsdeallocated. You can change your calls to malloc to use <code>NewPtr</code>, and you canoverride new to allocate its space with <code>NewPtr</code>.</p><h2>MPW C++ pragma support limitations</h2><P>Date Written:  1/15/92</p><P>Last reviewed:  6/14/93</p><P>When used from MPW C++, <code>pragma unused</code>, <code>pragma force_active</code>, and <code>pragma</code> oncedon't appear to work. In fact, pragma unused actually causes a C compile-timeerror. Why does this occur in spite of assurances in release notes that allpragmas are passed on to the C compiler?</p><P>The problem with pragmas and C++ is that the <code>CFront</code> compiler generates C code,and during this phase it also shuffles around the source code lines, so thepragma doesn't end up in the same place as originally intended. Also, <code>CFront</code>moves any pragmas inside the function body outside, because it can't do muchwith the pragmas, and the best bet is to move them just outside the body forthe C compiler. This means that any pragmas stated inside the function body areunusable in real life.</p><p>Here's a summary of how pragmas work with C++:</p><ul type="disc">	<li><code>pragma segment</code>, <code>pragma parameter</code>, and <code>pragma processor</code> should work OK.</li>	<li><code>pragma force_active</code> may or may not work, depending on the code case.</li>	<li><code>pragma warnings</code> and <code>pragma pop/push</code> should work in most cases, depending on the code movement.</li>	<li><code>pragma trace</code> should also work, especially if it's defined just before a function or member function.</li>	<li><code>pragma unused</code> and <code>pragma</code> once won't work, alas.</li></ul><p>For more information about <code>pragmas</code> and C++, please consult the MPW 3.2 C++documentation:</p><h2>Undefined Pascal class constructor and Unmangle tool</h2><P>Date Written:  6/22/90</p><P>Last reviewed:  6/14/93</p><p>When a constructor is declared in a Pascal object base class (used, forinstance, in MacApp) and not defined, the error message contains a garbled name(strange characters at the beginning and end). The Unmangle tool is in my Toolsfolder. Do you know what the problem is?</p><P>The Unmangle tool doesn't get invoked automagically; you'll have to use it tounmangle the symbol that's given in the error message yourself.</p><h2>MPW C++ 3.1 and volatile variables</h2><P>Date Written:  7/20/90</p><P>Last reviewed:  8/1/92</p><p>The volatile keyword isn't supported by <code>CFront</code> 2.0 (upon which MPW C++ isbased). Until it is, you can keep a variable from being assigned to a registerby taking its address (using the &amp; operator).</P><P>To keep your code readable (and to make it easier to make the appropriate fixeswhen volatile works), you might use the following macro (MacApp 3.0 and theSystem 7 Finder both do this!):</p><p>Whenever you define a variable to be used in handling a failure, invoke thismacro after you define it as follows:</p><p>This workaround isn't free: it has the side effect of adding a harmless (butuseless) LEA instruction to the resulting object code.</p><h2>Use extern to link C++ code with object code written in C</h2><P>Date Written:  12/12/91</p><P>Last reviewed:  6/14/93</p><p>I'm having trouble linking a program that is written in C++ with object codewritten in C. The example below illustrates the problem. The main program,compiled with CPlus, doesn't find the routine, foo(). The error message is:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre># 3:27:27 PM ----- Build of test.# 3:27:27 PM ----- Analyzing dependencies.# 3:27:28 PM ----- Executing build commands.  CPlus a.cp -o a.cp.o   Set Echo 0  C b.c -o b.c.o  Link -d -c '????' -t APPL a.cp.o b.c.o &quot;splinter:OpenInterface:MPW:Libraries:CLibraries:&quot;StdClib.o &quot;splinter:OpenInterface:MPW:Libraries:Libraries:&quot;Runtime.o &quot;splinter:OpenInterface:MPW:Libraries:Libraries:&quot;Interface.o -o test### Link: Error: Undefined entry, name: (Error 28) &quot;foo__Fv&quot;</pre>	</TD></TR></TABLE></CENTER><P>This is actually a common stumbling block, but fortunately one that is easy toaddress. In a nutshell, you need to declare your routines to have externallinkage by declaring them using extern. For a good description of extern versusstatic declarations (and how this affects external versus internal linkage),please see page 35 of the <i>AT&amp;T C++ Language System Reference Manual</i>(Release 2.0). This comes with MPW C++ 3.1. You'll probably also find thisexplained in most good C++ books.</p><p>In the MPW 3.2 C interface files, for example, you'll find routines defined asfollows (basically the extern "C" is declaration is included if you'recompiling with C++):</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#ifdef __cplusplusextern &quot;C&quot; {#endifpascal OSErr AECreateDesc(DescType typeCode,             Ptr dataPtr,             Size dataSize,             AEDesc *result)  = {0x303C,0x0825,0xA816};#ifdef __cplusplus}</pre>	</TD></TR></TABLE></CENTER><p>Here's an additional excerpt on the subject, from a paper by BjarneStroustrup:</p><p>C Linkage</p><P>This leaves us the problem of how to call a C function or a C++ function"masquerading" as a C function. To do this a programmer must state that afunction has C linkage. Otherwise, a function is assumed to be a C++ functionand its name is encoded. To express this, an extension of the externdeclaration is introduced into C++:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre> extern &quot;C&quot; {       double sqrt (double);    // sqrt(double) has C linkage</pre>	</TD></TR></TABLE></CENTER><p>This linkage specification does not affect the semantics of the program using<code>sqrt()</code> but simply tells the compiler to use the C naming conventions for thename used for <code>sqrt()</code> in the object code. This means that the name of this<code>sqrt()</code> is "sqrt" or "_sqrt" or whatever is required by the C linkageconventions on a given system.</p><h2>Bottom up C++ construction, base classes through derived classes</h2><P>Date Written:  10/23/90</p><P>Last reviewed:  8/1/92</p><p>When calling overridden functions from the constructor of a superclass, thefunctions in the superclass are called. Using the MPW C++ TE example, when afunction such as <code>StackNeeded</code> is called by the superclass constructor of anapplication object, the superclass function by that name is called when onewould expect an overriding function returning the derived class's needed valuewould be called instead.</p><p>To work around the problem, I created a function in the superclass called bythe subclass's constructor that is not a constructor (called it <code>ReluctantInit</code>).I would rather use the constructor, however, instead of the derived classhaving to "know" to call an INIT function in the superclass. (You might want tofix <code>TECPlusSample</code>, which makes this very same mistake.)</P><P>According to the AT&amp;T docs, the superclass's constructor should be calledbefore the derived class's. The syntax SubClass::SubClass:SuperClass (used inthe derived class constructor) therefore does not make sense to me, as itsuggests that the derived class constructor is called first.</p><P>I have bad news: You've uncovered a weirdness (sort of) in how MPW C++constructs things. Apparently C++ constructs things "from the bottom up,"meaning from base classes through derived classes. Therefore, in a base-classconstructor, calling a member function will call the base-class member functionrather than the derived-class member function, because the derived class hasn'tbeen constructed yet!</P><P>Your workaround, although I agree that it's philosophically displeasing, is theonly one that I can think of offhand.</p><h2>Where to find documentation on virtual table generation</h2><P>Date Written:  11/5/90</p><P>Last reviewed:  8/1/92</p><p>Using the MPW C++ -l option when linking some of our source files, we noticedthe virtual table sizes in the output file are different for different objects.This we expected, but we couldn't discern any pattern. What comprises thevtable?</p><P>The topic concerning generation of vtables is very big. As you know our MPW 3.1C++ compiler originates from AT&amp;T CFront 2.0, so we generate vtables in thesame manner as the original C++ compiler.</p><p>You can find information about virtual tables and how the tables aregenerated/accessed from the following sources:</p><p>    "MPW C++ 3.1 Release Notes"</p>    <P>Macintosh Technical Note "Multiple Inheritance and Handle Objects"</p>     <P>"Multiple Inheritance for C++," included with MPW C++</p>    <P> Chapter 10 of <i>Annotated C++ Reference Guide</i> by Ellis andStroustrup</p><h2>How to use C++ dump/load capabilities</h2><P>Date Written:  12/10/90</p><P>Last reviewed:  8/1/92</p><p>It seems like this dump facility is one of the features that everyone takes forgranted, like me, and in real life it's more tricky than the examples given inthe manual.</p><P>I will try to write down what I learned experimenting with C++ dump/load andespecially MacApp.</p><p>A. To start with, the best thing to check if you have the right C compiler fordump/load is to do a simple test under Macintosh Programmer's Workshop (MPW).You need to have the C compiler included with the MPW C++ 1.0 final, and thatone is MPW C 3.2&szlig;1 (3.2&szlig;1 or later). If you have a C compiler fromthe MPW 3.1 release you won't get dump/load to work at all.</p><p>OK, do a</p><p>or something similar. If the C compiler complains about "unexpected tokens" youhave the wrong C compiler. This is especially true if you have one of the firstAPDA ones, the MPW 3.1&szlig;1 release.</p><p>B. If this worked, the next step is to get it working with a generic C++program. The example given in the C++ release notes (C++ 1.0 final) is a goodone that should work. Use the rules at page 6-7 to build a single uniformheader file that will be used to include the other header files.</p><p>C. Let's now try with MacApp. Here we have some really interesting issues. Tostart with, MacApp 2.0 has a flag for MABuild that takes care of the wholedump/load management concerning the MacApp C++ header files. If you include a<code>-CPlusLoad</code> to MABuild it will happen automagically. The dumped file is storedinto a folder under the MPW folder called Load Files. In the MacApp folderthere's a file called Startup where you can modify where the dump file isstored, as well as if the<code> -CplusLoa</code>d is done every time without the flag toMABuild.</p><p>So in this case the dump/load management is handled for you. The drawback isthat you could not include your own header files. Which leads to:</p><p>D.1. How to include your own header files. Here I actually found two differentways to do it. The first one is to hack a file under the MacApp:Tools foldercalled Build Rules and Dependencies. If you search this one you will find aplace where the dump/load is defined. Comment out the line that says, "Includeyou own files here." I tested this and it worked OK.</p><p>D.2. Now let us assume that you want to build your own MAMake file. This isalso OK. The trick in this case is to carefully specify where the dump, source,and object files reside by using the prefix {ObjApp} and {SrcApp} for eachfile. The other trick is to have a dummy object file as one of the dependencyrules that builds the dump file in the first place. It is important that theOtherLinkFiles variable has this dummy file in its definition!</P><P>The dump/load is about 2-3 times faster during the C compilation phase due tothe fast load of static information. An example of an MAMake file for MacApp("DemoText with C++ load/dump") is on AppleLink.</p><h2>MPW C++ compiler external link bug and workaround</h2><P>Date Written:  1/8/91</p><P>Last reviewed:  8/1/92</p><p>Is there a bug in the dump/load functions of the Macintosh MPW C++ compiler(CFront) on declarations of external routines with C linkage--for example, theGraphAccel.h file?</p><P>You are absolutely right, it won't work. As a workaround you might trysomething like:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    // This one works...    extern &quot;C&quot;     { void SwapHandleBytes(Handle theBuffer);        }    // This one won't...</pre>	</TD></TR></TABLE></CENTER><p>In other words, put braces around the external link statement, and it works OKwith the dump make rules. This is the reason most of the header files inCInclude files work without problems with dumping.</P><h2>Function pointer won't return type pointer in union or struct</h2><P>Date Written:  1/25/91</p><P>Last reviewed:  8/1/92</p><p>Why is it that I cannot define a Macintosh function point that returns apointer to a type (such as a long) in either a union or a struct, though I canoutside of one. In fact, I can do this in C, but not in C++. The error occurs when compiled by C++. When compiled only in C, it compiles with noerrors.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    ---------------------(test.c)------------------------    pascal long* (*biz) ();    union waka        { long* (*baz) (); pascal long* (*foo) (); pascal short (*bar) (); };</pre>	</TD></TR></TABLE></CENTER><p>Is this a bug in Apple's MPW C++ implementation?</p><P>It seems like this is a real bug (that is, any Pascal declared function pointerinside a union/struct that tries to return a pointer to a val won't compile). Ialso tried to typecast this, but it naturally failed (because the typecast mapsback to the original declaration).</p><p>I have to report this as a bug to C++ engineering. Meanwhile, the onlyworkaround is either to use a nonPascal function for the work, or to returnnonpointers. Note that there's a known bug with Pascal functions and MPW C++:The Pascal keyword is broken in the specific situation where one attempts tocall a C function that returns a pointer to a Pascal-style function. The Ccompiler currently misinterprets the C function as a Pascal-style function andthe function result is lost.</p><h2>Workaround for MPW C++ -w2 option limitation</h2><P>Date Written:  1/29/91</p><P>Last reviewed:  8/1/92</p><p>If I compile with the -w2 option, <code>CFront</code> generates an error message for theanachronism "overload" instead of a warning message. Why is it generating anerror for this instead of a warning?</p><P>It seems that the -w2 option is a little bit too rough with good old "overload"keywords. ARM (page 405) also defines that overload could still be used infunction declaration (even if this is not needed, and in the long run it'sgone, maybe ANSI C++ will not include this at all).</p><p>Anyway the -w1 option did not scream. Also if you have a lot of old C++ codewith billions of overload declarations, do a "#define overload    " so thosewill not be used with -w2 testing. Meanwhile I will send a small bug report tothe C++ dudes.</p><p>X-Ref:</p><P>Annotated C++ Reference Manual by Ellis &amp; Stroustup</p><h2>Put MPW C++ inlines in class definition header file</h2><P>Date Written:  6/19/91</p><P>Last reviewed:  6/14/93</p><p>According to the AT&amp;T Reference Manual, it's possible to declare aconstructor as inline, but in MPW C++ it only works if the definition of theconstructor is in the declaration. For example, declaring the constructor of<code>TEDocument</code> (<code>TESample</code>) as inline results in a link error because the symboltable of the linker is wrong. Is there a solution?</p><P>Inline member functions must be in the same header file (xxx.h) as the classdefinition. If you do this with the inline constructor, the linker will notcomplain. Also, CFront tries to automatically inline most of the constructorsby default.</p><h2>Workaround for Revert failure with multiple forks open</h2><P>Date Written:  9/17/91</p><P>Last reviewed:  6/14/93</p><p>Our application, written using C++ and MacApp, works under System 6, but, theRevert mechanism fails under System 7.0. We use both forks of our document'sfile and keep both open. The failure occurs way down in <code>MAOpenFile</code> with a -49error. It appears that the problem is related to the fact that <code>ReadFromFile</code>calls <code>OpenAFile</code>, even if both forks of the file being reverted are alreadyopen. I've overridden this behavior and things seem to work. Am I going to getinto any additional trouble by doing this?</p><P>Some access permission strategies have changed between 6.0.x and 7.0. Untilthese changes are incorporated into MacApp, the only solution, as you foundout, is to tweak the <code>ReadFromFile-OpenAFile-MAOpenFile</code> sequence so it doesn'ttry to reopen an already opened fork. Seems like the old Revert code broke withthe new System 7 behavior.</p><p>Test your fix also with an AppleShare-based file, checking for -54 permissionerrors and errors inside <code>PBHOpenDeny</code>.</p><h2>Script for filtering out C++ dump/load warning</h2><P>Date Written:  10/4/91</p><P>Last reviewed:  6/14/93</p><p>Is there a way to turn off the warning message given by C++ when using the-load option? The message, "warning: -d or -u option(s) will not affect codesaved in dump file," makes it hard to spot real errors in our build log.</p><P>The warning about -d and -u options will be bounced to the -w1 flag in a futureC++ release. Meanwhile, here's a script for filtering unneeded warnings, basedon streamedit (MPW 3.2). Note that because of the way pipes are implemented inMPW (files), the streamedit script that prints out the filtered information isnot triggered until the compiler/linker and so on is finished at the left sideof the pipe. This can be used for filtering any kinds of warnings that thedeveloper would consider not to be important (even if all compiler and linkermessages should be considered important information).</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>        MABuild -nodebug -sym DemoText [[Sigma]] Dev:stdout | [[partialdiff]]</pre>	</TD></TR></TABLE></CENTER><h2>MPW 3.2 C objfilegen bug requires simpler statements</h2><P>Date Written:  8/12/91</p><P>Last reviewed:  6/14/93</p><p>I'm using MPW C++ streams, and sometimes the compiler seems to generate badcode when I build a large statement, with lots &lt;&lt; of &lt;&lt; leftshift&lt;&lt; operators. Why, and what can I do about it?</p><P>This is a known bug in the MPW 3.2 C compiler, but we don't know when it willbe fixed. It turns out that <code>CFront</code> translates your complex statement into anested series of procedure calls. Eventually, this series becomes toocomplicated for the C compiler to deal with. Unfortunately, the C compilerdoesn't detect this condition itself. The only workaround is to make simplerstatements (try to keep it to a dozen &lt;&lt;'s or less).</p><h2>MPW C++ 3.2 is based on AT&amp;T USL CFront 2.1</h2><P>Date Written:  3/24/92</p><P>Last reviewed:  8/1/92</p><p>Do you have a <code>CFront</code> that supports AT&amp;T's version 2.1?</p><P>MPW C++ 3.2 is based on AT&amp;T USL CFront 2.1. Apple recommends it for alldevelopment, except for MacApp 2.0.x development. Please note that you must useMPW C++ 3.2 if you are using MacApp 3.0.</p><p>MPW C++ 3.2 is available from APDA and is also included on the E.T.O. CD as ofE.T.O. #7. The specific path for MPW C++ 3.2 on the CD is as follows: "E.T.O.#7:Tools - Objects:MPW C++:MPW C++ 3.2". In the same directory, you will find areadMe TeachText document with more information about this particular releaseof C++.</p><h2>Creating C++ objects from resources</h2><P>Date Written:  2/21/91</p><P>Last reviewed:  8/1/92</p><p>Can you give me an example of how to create C++ object from resources in theway <code>NewTemplateWindow</code> creates Object Pascal objects from view templates?</p><P>The scheme for creating C++ objects from resources is the same if you use<code>PascalObjects</code> as the base class as it is with Object Pascal. Check the method<code>NewObjectByName</code> in MacApp 2.0, and it should be fairly easy to transpose thatto C++, if you really want to do this.</p><p>Concerning non-MacApp base class objects, unfortunately you are on your own.There are many ways to obtain persistent objects in one form or another. Forinstance there's an example about this in <i>C++ programming with MacApp</i> byWilson, Rosenstein, and Shafer, called <code>TStream</code>. Even if this class isrudimentary it should show some of the guidelines, and the new MacApp 3.0release includes <code>TStream</code>.</p><p>Another article about metaclass handling is in the <i>MADA Newsletter,</i>Volume 3, No 5, "Meta-information in MacApp 2.0" by Larry Rosenstein.</p><h2>MPW C++ "free store exhausted" error</h2><P>Date Written:  3/8/91</p><P>Last reviewed:  8/1/92</p><p>I can't compile any of the MacApp C++ example programs without getting a CFront"free store exhausted" error from CFront. I cannot find any reference to thisdiagnostic in my MPW documentation. The example C programs compile OK.</p><P>Because the MPW C++ compiler is a port of the AT&amp;T CFront, which wasdesigned with the assumption that all computers in the world have virtualmemory paging (spell UNIX), it makes notorious use of memory. It doesn't careabout the free memory because it assumes that unused memory will be paged outtemporarily and new free pages will be available for the compiler. Enter PC andMacintosh systems, with no virtual memory paging. This is the reason the MPWC++ needs a lot of temporary memory.</p><p>Fortunately the peak "need memory" points are infrequent, mostly during theparsing phase. A switch called "-mf" can be used with all the MPW compiler,lib, and link tools. It uses the MultiFinder temporary memory, which is not inuse normally and is sort of a pool of unused memory.</p><p>If you include the -mf switch with the set of <code>CFront</code> options, either at the MPWShell level, in the Makefile, with <code>MAMake</code> using the <code>-CFront</code> -mf, or evendefining it in the Startup file inside the MacApp folder as one of the defaultCFront parameters, then you should have a far easier time compiling MacApp/C++code.</p><p>If this does not help, increase the MPW Shell application heap size as well(Get Info on the MPW Shell icon in the Finder). The shell size should be atleast 2.5 MB, or up to 3 or 4 MB if possible. If you have even more memory andyou use MPW most of the time, increase the size to near the top of the memoryrange.</p><p>(UNIX is a registered trademark of UNIX System Laboratories)</p><h2>Intro to OOP tutorial Lab 1 interface file update</h2><P>Date Written:  6/17/91</p><P>Last reviewed:  8/1/92</p><p>When I try to compile Lab 1 of the Intro to OOP CD-ROM tutorial, I get a stacksmashed into the heap error! Any ideas?</p><P>Try increasing memory partition for the MPW Shell using Get Info. Also, the MPWinterface file TYPES.h has been modified since MPW 3.1. You will need to editone line of the file, UTILS.h. UTILS.h can be found in the folder:"IntroToOOPLabs :C++:CourseLibrary:" Here is the segment of code as it appearsin the shipping version of intro to OOP:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    inline void Copystr255(const Str255 from, Str255 to)    {         BlockMove((Ptr) from, (Ptr) to, Length(from) +1;</pre>	</TD></TR></TABLE></CENTER><p>Replace the above code with:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    inline void Copystr255(const Str255 from, Str255 to)    {</pre>	</TD></TR></TABLE></CENTER><h2>Resource fork handling with streams support</h2><P>Date Written:  6/1/92</p><P>Last reviewed:  6/14/93</p><p>Where can I find an example of connecting a Macintosh file to the C++ streamlibrary, so that I can operate on either fork with the iostream library?</p><P>By default the Apple-ported iostream libraries only work with the data fork.You should use the Resource Manager traps for resource handling, for tworeasons: (1) they are tested and work well, and (2) any outside file I/Opackages can't by default handle two forks (because UNIX and MS-DOS only knowof one single data fork in a file).</p><p>However, the AT&amp;T streams package has something called <code>strstreams</code>, whichyou can use to redirect byte streams from one memory location to another. Ifyou want to get a form of resource fork handling with streams support, youcould use the strstreams concept and redirect material sent to a memorylocation to/from the resource fork. It needs a little bit of coding, but theMPW C++ 3.1 documentation about streams provides the starting information.</p><h2>C++ static constructors and checking for an FPU</h2><P>Date Written:  8/17/92</p><P>Last reviewed:  6/14/93</p><p>We are faced with a problem related to the sequencing of events when ourapplication starts up: Because of the way that static constructors are handledin C++, code gets executed before our main is encountered, thus we're unable tocheck for an FPU before the code that uses the FPU is executed, which will ofcourse crash on an FPUless machine (a Bad Thing). We'd like to insert a call tocode that can check for the presence of the FPU and take appropriate stepsbefore <code>__CplusInit</code> is called from <code>_RTInit</code>. Is there a way to do this? Onepossibility involves messing with the library to rename <code>__CplusInit</code> tosomething else and writing our own <code>__CplusInit</code> that will call the real one ifthe FPU checks are passed. Is there a better way to do this?</p><P>You're right, checking for an FPU can be a problem because of the C++ staticconstructors. The best workaround we can recommend to you at this time is theone you suggest of having your own <code>CplusInit</code>, which then calls the real oneonly after FPU checks are passed.</p><br>         <a name=Downloads></A>                  <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (54K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pt_555.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pt/pt_555.html%3Fid%3DDTS10002704-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pt/pt_555.html%3Fid%3DDTS10002704-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pt/pt_555.html%3Fid%3DDTS10002704-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>