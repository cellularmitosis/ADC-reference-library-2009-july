<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>PowerPC Stack Structure</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING59></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-58.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-60.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-56.html"><B>Chapter 4 - PowerPC Runtime Conventions</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING59-0></A>
<H1>PowerPC Stack Structure</H1>
 <A NAME=MARKER-2-25></A>The PowerPC runtime environment uses a grow-down stack that contains linkage information, local variables, and a routine's parameter information as shown in <A HREF=#MARKER-9-26>Figure 4-1</A>. <P>
<B>Figure 4-1  <A NAME=MARKER-9-26></A>The PowerPC stack</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-58.jpg"> <P>
 <A NAME=MARKER-2-27></A>The typical PowerPC stack conventions use only a stack pointer (held in register GPR1) and no frame pointer. This configuration assumes a fixed stack frame size, which is known at compile time. Parameters are not passed by pushing them onto the stack. <P>
 <A NAME=MARKER-2-28></A>The calling routine's stack frame includes a parameter area and some linkage information. The parameter area has space for the parameters of any routines the caller calls (not the parameters of the caller itself). Since the calling routine might call several different routines, the parameter area must be large enough to accomodate the largest parameter list of all the routines the caller calls. It is the calling routine's responsibility for setting up the parameter area before each call to some other routine, and the called routine's responsibility for accessing the parameters placed within it. See <A HREF=RTArch-62.html#MARKER-9-42>"Routine Calling Conventions," beginning on page 4-11</A>, for more information about the calling conventions. <P>
 <A NAME=MARKER-2-29></A>The calling routine's linkage area holds a number of values, some of which are saved by the calling routine and some by the called routine. <A HREF=#MARKER-9-30>Figure 4-2</A> shows the structure of the linkage area.<P>
<B>Figure 4-2  <A NAME=MARKER-9-30></A>A stack frame's linkage area</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-59.jpg"> <P>
 The elements within the linkage area are as follows:<P>
<UL>
<LI>The base register (GPR2) value is saved at <CODE>20(SP)</CODE> by the calling routine prior to the call if <P>
<UL>
<LI>the call is to an imported routine
<LI>the call is a pointer-based call (which may or may not be cross-fragment)<P>
This action ensures that the calling routine can still access its own direct data area upon return. See <A HREF=RTArch-29.html#MARKER-9-32>"PowerPC Implementation," beginning on page 2-6</A>, for more information. Local calls do not need to save this value. <P>
</UL>
<LI>The Link Register (LR) value is saved at <CODE>8(SP)</CODE> by the called routine if it chooses to do so. 
<LI>The Condition Register (CR) value may be saved at <CODE>4(SP)</CODE> by the called routine. As with the Link Register value, the called routine is not required to save this value. 
<LI>The stack pointer is always saved by the calling routine as part of its stack frame. <P>
</UL>
 Note that the linkage area is at the top of the stack, adjacent to the stack pointer. This positioning is necessary so the calling routine can find and restore the values stored there and also to enable the called routine to find the caller's parameter area. This placement means that a routine cannot push and pop parameters from the stack once the stack frame is set up. <P>
 <A NAME=MARKER-2-31></A>The stack frame also includes space for the called routine's local variables. In general, the general-purpose registers GPR13 through GPR31 and the floating-point registers FPR14 through FPR31 are reserved for the routine's local variables. However, if the routine contains more local variables than would fit in the registers, it uses additional space on the stack. The size of the local variable area is determined at compile time; once a stack frame is allocated, the size of the local variable area cannot change. <P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DL>
<DT><A HREF="RTArch-60.html#HEADING60-0">Prologs and Epilogs</A>
<DD>
<DT><A HREF="RTArch-61.html#HEADING61-0">The Red Zone</A>
<DD>
</DL>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-58.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-60.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
