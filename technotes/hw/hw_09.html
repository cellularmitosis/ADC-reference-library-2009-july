<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"        "http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd"><HTML><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note HW09: Macintosh IIfx:  The Inside Story</title><meta name="categories" content="Hardware"><meta name="week-posted" content="Mar 26, 1990 - Apr 6, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002478" title="Macintosh IIfx:  The Inside Story"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note HW09</div>
<div id="pageheadsub">Macintosh IIfx:  The Inside Story</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->                     <P id = "menutext">         <A HREF = "#Section1">What's Inside</a><BR><BR> <A HREF = "#Section2">ADB</a><BR><BR> <A HREF = "#Section3">CD-ROM Driver</a><BR><BR> <A HREF = "#Section4">EtherTalk Driver (.ENET)</a><BR><BR> <A HREF = "#Section5">MacsBug</a><BR><BR> <A HREF = "#Section6">NuBus</a><BR><BR> <A HREF = "#Section7">SADE MultiFinder</a><BR><BR> <A HREF = "#Section8">SCC</a><BR><BR> <A HREF = "#Section9">SCSI</a><BR><BR><A HREF = "#Section10">SWIM</a><BR><BR><A HREF = "#Section11">VIA2</a><BR><BR><A HREF = "#Section12">Summary</a><BR><BR> <A HREF="#References">References</A><BR><BR>         <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note addresses various areas of potential incompatibilities withthe Macintosh IIfx and current software applications and provides informationabout some of Apple's compatibility software updates.</p> <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Feb 01 1991]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Section1"></a><h2>What's Inside</h2><p>On the Macintosh IIfx, the CPU no longer handles I/O operations like floppydisk access, SCC access, and mouse events.  Instead of the CPU doing all of thework, the IIfx contains a couple of separate I/O processors, Apple customASICs, to handle all floppy disk, mouse, and SCC I/O.  With the advent of thesenew I/O processors (IOP), the IIfx can handle smooth cursor movement and timeconsuming disk operations simultaneously.  These new IOPs are just an exampleof the new capability of this machine.</p><p>Each of the following sections talks about the changes and added functionalitywhich makes life difficult for some types of applications.  The IOPs in theIIfx cause some applications problems, and this Note shows why certaintechniques no longer work and provides solutions to work around theseincompatibilities where possible.  A few additional sections provideinformation about updated System Software or peripheral software from Applewhich the IIfx requires for operation.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>ADB</h2><p>Applications which depend upon direct access to the ADB transceiver or its VIAregisters do not work with the IIfx, because the IOP which now handles ADB isnot available for direct access.  As in the past, the hardware is subject tochange, and applications which access it directly break when new hardware isintroduced.  There is no solution for applications which try to directly accessthe ADB hardware; these applications must now use the ADB Manager or theycannot run on the IIfx and future Macintosh models.</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>CD-ROM Driver</h2><p>To use the AppleCD SC with a Macintosh IIfx (and IIci), you must use version3.0.1 or later of the <A HREF = "downloads/Apple_CD-ROM.hqx">Apple CD-ROM</a> drivers.  Earlier versions of this driverare incompatible with this hardware.  You can obtain a copy of this driver fromany authorized Apple dealer, the Developer CD Series, AppleLink (DeveloperServices: Macintosh Developer Technical Support: Peripheral Software), and theApple FTP site on the Internet (Apple.COM under ~ftp/pub/dts/sw.license/).</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>EtherTalk Driver (.ENET)</h2><p>To use the Apple EtherTalk card with a Macintosh IIfx, you should use version2.0.2 of the EtherTalk driver.  Earlier versions of this driver do not performas well with this hardware.  You can obtain a copy of this driver from anyauthorized Apple dealer, the Developer CD Series, AppleLink (DeveloperServices: Macintosh Developer Technical Support: Peripheral Software), and theApple FTP site on the Internet (Apple.COM under ~ftp/pub/dts/sw.license/).</p><P><A HREF="#top">Back to top</A></P><a name="Section5"></a><h2>MacsBug</h2><p>To use MacsBug with a Macintosh IIfx, you must use version 6.2.  Earlierversions of MacsBug are incompatible with this hardware.  You can obtain a copyof MacsBug 6.2 from APDA, the Developer CD Series, and AppleLink (DeveloperServices: Macintosh Developer Technical Support: Tools: MacsBug).</p><P><A HREF="#top">Back to top</A></P><a name="Section6"></a><h2>NuBus</h2><p>If the Macintosh IIfx executes a Read-Modify-Write NuBus(TM) code sequence to acard (i.e., <code>TAS</code> or test and set) and immediately follows it with aregular cycle Read or Write, the system hangs.  The solution to this problem isto execute five <code>NOP</code> instructions between the <code>TAS</code> and the nextcycle.  This number of <code>NOP</code> instructions should also handle futureaccelerations of the CPU clock, should Apple decide to further accelerate it.</p><P><A HREF="#top">Back to top</A></P><a name="Section7"></a><h2>SADE MultiFinder</h2><p>To use SADE with a Macintosh IIfx, you must use version 6.1b9 of MultiFinderwith the Set Aside feature.  Earlier versions of MultiFinder are incompatiblewith SADE on this hardware.  You can obtain a copy of MultiFinder 6.1b9 fromAPDA with SADE 1.1, the Developer CD Series, and AppleLink (Developer Services:Macintosh Developer Technical Support: Tools: SADE MultiFinder).  Developersmay <b>not</b> distribute MultiFinder 6.1bx to customers, even if licensed todistribute Apple's Macintosh System Software.</p><P><A HREF="#top">Back to top</A></P><a name="Section8"></a><h2>SCC</h2><p>Like the processor which controls floppy disk and ADB I/O, the IIfx has anotherASIC to control the SCC, but unlike the former, this processor is capable ofrunning in a special "IOP Bypass" mode which allows direct access to the SCC.</p><p>The new SCC architecture also contains a few other differences from theprevious architecture.  On the IIfx, there is no longer a VIA line availablefor monitoring the Wait/Request signal of the SCC.  Applications which dependupon this bit have no solution to this problem and are incompatible with theIIfx.  In addition, on the IIfx the vSync bit (which has been available sincethe Macintosh SE) has moved to a new location; however, Apple is providingdevelopers with a trap call (<code>_HWPriv</code>) which allows applications toenable or disable this bit in its new location, thereby providing a solutionfor applications which depend upon this bit.  For more information on this trapcall, see the vSync Bit section later in this Note.  Technical Note #261, CacheAs Cache Can, also addresses <code>_HWPriv</code>.</p><h3>IIfx Serial Switch cdev</h3><p>If an application requires direct access to the SCC, then you should licensethe IIfx Serial Switch cdev from Apple Software Licensing.  The native mode ofthe IIfx uses a special processor to handle all SCC work, thus increasingoverall machine performance by offloading this task from the CPU.  However,applications must sacrifice direct SCC access for this performance gain.  TheIIfx Serial Switch cdev allows applications which must directly access the SCCto bypass the processor while sacrificing the increased performance.</p><p>This cdev sets a bit in parameter RAM which the IIfx checks during startup.  If"Faster" mode is chosen (default), then the IIfx uses the special processor,but if "Compatibility" mode is chosen, then the IIfx lets the CPU handle SCCprocessing, which allows direct access.  To license this cdev, contact:</p><p>                Apple Software Licensing<br>                Apple Computer, Inc.</p>                <P>20525 Mariani Avenue, M/S 38-I<br>                Cupertino, CA  95014<br>                (408) 974-4667<br>                AppleLink: Sw.License<br>                Internet:  Sw.License@AppleLink.Apple.com</p><p>There is no way for an application to determine in which mode it is running;therefore, if the machine is in "Faster" mode and an application attempts adirect call to the SCC, the machine crashes.</p><h3>Wait/Request Bit</h3><p>On previous Macintosh models, there is a Wait/Request bit on the VIA1 registerA for monitoring incoming serial data while the Macintosh is busy with someother operation.  When the SCC receives a character, it sets this bit in theVIA, which tells the operating system that the SCC needs attention.  Since theIIfx has a dedicated processor for SCC transactions, it has no need for thismechanism.  Even if a machine is using the IOP Bypass mode to directly accessthe SCC, this line is not active, so applications which rely upon it areincompatible with the IIfx.  For more information about this bit, refer to the<i>Guide to the Macintosh Family Hardware</i>, Second Edition.</p><h3>vSync Bit</h3><p>The <code>_HWPriv</code> ($A198, selector 7) routine enables or disables externalSCC clocking.  The external clock comes to the SCC through the RTxC signal,which is connected to the GPi pin on the serial port connector.  This routineis used instead of writing directly to the vSync bit on VIA1 (which is notimplemented on the IIfx), and it is backpatched into all previous CPUs, exceptthe Macintosh Plus, which does not support external clocking.  <code>_HWPriv</code>only works in IOP Bypass mode on the IIfx, and is documented below for yourconvenience:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Entry:    d0.l = routine selector = 7    a0.l =  &lt;port number&gt;.w &lt;enable/disable ext clock&gt;.w            23-16: port number 0 = port A, 1 = port B,... for future expansion            15-0 : 0 = internal clocking, 1 = external clockingExit:    d0.l = zero if good, -1 if error    a0.l = &lt;port number&gt;.w &lt;last state of external clock&gt;.w</pre>	</TD></TR></TABLE></CENTER><h3>Synchronous SCC I/O</h3><p>If an application expects to make synchronous SCC I/O calls with interruptsturned off, it does not work on the IIfx, because the new IOP serial driveruses the Deferred Task Manager, which is interrupt driven.  If an applicationtries to do something like communicate with the IOP SCC driver when interruptsare turned off, the IIfx hangs.</p><P><A HREF="#top">Back to top</A></P><a name="Section9"></a><h2>SCSI</h2><p>The Macintosh IIfx may cause developers problems in two areas which deal withthe SCSI interface.  The first are the SCSI low-memory globals.  A fewapplications rely upon undocumented low-memory globals which point to addressesin the SCSI controller chip; however, on the Macintosh IIfx, these globals nowpoint to an entirely different area.  If an application depends upon theseglobals, it either does nothing or crashes on the IIfx.  The second problemdeals with SCSI termination.  For more information about SCSI termination onthe Macintosh IIfx and how it differs from previous Macintosh models, refer toTechnical Note #273, SCSI Termination.</p><p>In addition, although the IIfx hardware has SCSI DMA capability, the MacintoshSystem Software does not yet take advantage of it.  Apple recommends that youwait until the Macintosh System Software implements support for the IIfx SCSIDMA to use this hardware feature.</p><P><A HREF="#top">Back to top</A></P><a name="Section10"></a><h2>SWIM</h2><p>On the IIfx, the floppy disk controller, the SWIM, is not directly accessible;instead, the IIfx has a processor which handles all floppy drive access.  Thisprocessor, an Apple custom ASIC, is not accessible to third-party developers.The I/O processing hardware is subject to change, and applications whichattempt to access it directly are likely to break when new hardware isintroduced.</p><p>Apple has always recommended against direct hardware access, but someapplications do it anyway, and these applications now have problems with thenew IIfx hardware.  The most common reason these applications access thehardware directly is to move hidden information to and from the disk.  As apartial solution to this problem, the IIfx includes a new version of the Sonydriver which allows applications to make a control call to get raw data fromthe disk.  For more information on this new driver and control call, refer toTechnical Note #272, <A HREF = "../dv/dv_17.html">What Your Sony Drives For You.</a></p><h3>Asynchronous Disk I/O</h3><p>If an application expects to make asynchronous I/O calls to the Sony driverwith interrupts turned off, it does not work on the IIfx, because the new IOPdrivers are interrupt driven.  If an application tries to do something likeopen a resource when interrupts are turned off, the IIfx hangs.</p><P><A HREF="#top">Back to top</A></P><a name="Section11"></a><h2>VIA2</h2><p>All of the functionality of VIA2 has been moved to other chips in MacintoshIIfx, so if an application depends on VIA2 registers, it must find a differentway to get the information for which it is looking to be compatible with theIIfx.</p><P><A HREF="#top">Back to top</A></P><a name="Section12"></a><h2>This is What Makes a "Wicked Fast" Macintosh</h2><p>The basic message of this Note is that if developers directly access Macintoshhardware, their applications are likely to break on new hardware like theMacintosh IIfx.  If an application is having compatibility problems with theIIfx, they are probably due to one of these documented changes, and this Noteshould help provide the necessary solutions where they are available.  If anapplication is having compatibility problems with the IIfx and they are notrelated to one of these areas, then qualified developers should contactDeveloper Technical Support for help in tracking down the problem.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P>Guide to the Macintosh Family Hardware, Second Edition</p><P>Inside Macintosh, Volume V, Compatibility Guidelines</p><P>Inside Macintosh, Volume V, Deferred Task Manager</p><P>Technical Note M.OV.Compatibility--         <A HREF = "../ov/ov_03.html">Compatibility Guidelines</a></p><P>Technical Note M.OV.Compatibility --        <A HREF = "../ov/ov_04.html">Compatibility:  Why and How</a></p><P>Technical Note M.OV.GestaltSysenvirons --         <A HREF = "../ov/ov_16.html">_SysEnvirons:  System 6.0 and Beyond</a></p><P>Technical Note M.HW.Cache --         <A HREF = "hw_06.html">Cache as Cache Can.</a></p><P>Technical Note M.DV.SonyDriver --         <A HREF = "../dv/dv_17.html">What Your Sony Drives For You.</a></p><P>Technical Note M.DV.SCSITermination --         <A HREF = "../dv/dv_15.html">SCSI Termination</a></p><p>NuBus is a trademark of Texas Instruments.</p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (68K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/hw_09.pdf">Download</A></P>               </TD>            </TR></table><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/hw/hw_09.html%3Fid%3DDTS10002478-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/hw/hw_09.html%3Fid%3DDTS10002478-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/hw/hw_09.html%3Fid%3DDTS10002478-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>