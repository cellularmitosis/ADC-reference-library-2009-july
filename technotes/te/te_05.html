<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TE05: Fonts and the Script Manager</title>                                       <meta name="categories" content="Text"><meta name="week-posted" content="May 29, 1989 - Jun 2, 1989"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002813" title="Fonts and the Script Manager"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTextFonts-date.html">Text & Fonts</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/TextFonts/index.html" target="_blank">Reference Library > Text & Fonts</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TE05</div>
<div id="pageheadsub">Fonts and the Script Manager</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">So How Do They Work?</A><BR><BR><A HREF="#Section3">What's This Forced Stuff?</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note describes how the Script Manager uses the font family ID todetermine a script code.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jun 01 1989]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><P>The traps <code>_FontScript</code>, <code>_IntlScript</code>, and <code>_Font2Script</code>all use a font family ID to determine the script interface system code thatthey return.  This Note describes the process, the way the Script Managerrenumbers the Chicago font for non-Roman systems, and the equation forcalculating Script IDs from font family IDs.</p><p>On a Roman system the Chicago <code>'FOND'</code> is numbered zero, but this causesno confusion since Chicago is also the system font.  Non-Roman systems mustrenumber Chicago so that it will not interfere with the mapping of <code>'FOND'ID = 0</code> to the correct system <code>'FOND'</code>.  Typically Chicago isrenumbered to 16383.</p><p>In <i>Inside Macintosh</i>, Volume V-293, The Script Manager, the descriptionsof <code>_FontScript</code>, <code>_IntlScript</code>, and <code>_Font2Script</code> statethat the current font identification number (e.g., <code>'FOND'</code> ID) is usedto calculate the correct script code.   The equation for calculating scriptcodes from <code>'FOND'</code> IDs is as follows:</p><p>For a specific example, consider the Kyoto font which is one of the fontsincluded in KanjiTalk.  Its <code>'FOND'</code> ID is 16385.  Plugging that valueinto the equation above, we get: script = ((16385-16384) DIV 512) +1.  Whichresults in a value of one, the script code for the Kanji script system.</p><p>Note that this means that script systems other than Roman can only have 512separate font families.  Furthermore, Roman font families (FOND) must not havean ID greater than 16383, and <code>'FOND'</code> ID 16383 is reserved for Chicagoon non-Roman systems.</p><P><A HREF="#top">Back to top</A></p><a name="Section2"></a><h2>So How Do They Work?</h2><p><code>_FontScript</code>, <code>_IntlScript</code>, and <code>_Font2Script</code> begin bysetting two Script Manager globals, <code>Forced</code> and <code>Default</code> tofalse.  Then the two special font family (<code>'FOND'</code>) numbers zero and oneare mapped to the System and Application font.</p><p>Next the <code>'FOND'</code> ID is tested to see if it is an international font.<code>_FontScript</code> and <code>_IntlScript</code> simply take the value out of the<code>txFont</code> field of the current <code>grafPort</code>.  <code>_Font2Script</code>uses the value passed to it.  The test is simply:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>IF FONDid &lt; $4000  {16384}    script is Roman so return 0ELSE</pre>	</TD></TR></TABLE></CENTER><p>Once the script code has been determined, the routine looks at the ScriptManager globals <code>FontForce</code> and <code>IntlForce</code>.</p><p>If the currently installed script is Roman and <code>fontForce</code> is true, orif <code>intlForce</code> is true and the routine called was <code>_IntlScript</code>,then the value returned will be the current system script.  If the installedscript is not Roman; the script code calculated will be returned when theroutine called was <code>_IntlScript</code>, <code>intlForce</code> is true, and thescript code does not equal the system script.</p><p>Once the script code to be returned as been calculated, a final check is madeto be sure that the script is installed and enabled.  If it is not; Roman isreturned, and <code>Forced</code> is set to false and <code>Default</code> is set totrue.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><h2>What's This Forced Stuff?</h2><p>Two Script Manager globals, <code>fontForce</code> and <code>intlForce</code>, areflags that support compatibility.  Turning <code>fontForce</code> on will causeRoman fonts to be interpreted as belonging to the system script.  This providescompatibility for applications that hard-code font numbers.</p><p>For example, the Arabic script interface system provides a cdev which lets auser turn <code>fontForce</code> on.  When a user does this, any Roman fonts willbe mapped to an Arabic font.  Note this is only a partially effective measuresince the user still does not have complete control over fonts.</p><p>It should also be noted that if a user sets <code>fontForce</code> on via the cdev,values returned for fonts with family IDs in the range $0002 to $3FFF (Roman<code>'FOND'</code> ID range) may vary.  This is not a good feature forapplications that allow mixed text.  To avoid this problem, an application canturn the <code>fontForce</code> flag off before calling <code>_Font2Script</code> or<code>_FontScript</code>.  The flag value should be saved before turning it off,and restored later.</p><p>The <code>intlForce</code> flag determines how the call <code>IUGetIntl</code> behaves.If this flag is on, <code>IUGetIntl</code> will always return the internationalresources (<code>'itlx'</code> where <code>x</code> is 0-2) corresponding to the systemscript.  When <code>intlForce</code> is off, the font in the current port will beused to determine which international resources will be returned.  This flaglets an application control what  date formats, sorting routines, etc. will beused.</p><p>For that reason, before calling any of the international utility routines orusing the binary to decimal routines, an application should verify that<code>thePort</code> and <code>thePort^.txFont</code> are set correctly, or that<code>intlForce</code> is set properly.</p><h3>Let's Look at a Picture</h3><p>The flowchart in Figure 1 illustrates the operation of <code>_FontScript</code>,<code>_IntlScript</code>, and <code>_Font2Script</code>, and how they are affected bythe global flags <code>fontForce</code> and <code>intlForce</code>.</p><P align=center><img src="images/te_05_001.gif" alt="Operation Flowchart" width=512 height=594></P><P align=center><b>Figure 1</b> - Operation Flowchart</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P><i>Inside Macintosh</i>, Volume I-493, The International Utilities Package</p><P><i>Inside Macintosh</i>, Volume V-293, The Script Manager</p><P><i>Inside Macintosh</i>, Volume V-287, The International Utilities Package</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (144K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/te_05.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/te/te_05.html%3Fid%3DDTS10002813-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/te/te_05.html%3Fid%3DDTS10002813-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/te/te_05.html%3Fid%3DDTS10002813-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>