<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Interactive Movies: Creating Advanced Interactive Movies</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating Advanced Interactive Movies"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000883-CH211" title="Creating Advanced Interactive Movies"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../WiredMoviesandSprites-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000594" target="_top">Wired Movies and Sprites</a> &gt; <a href="../preface/QT_Interactive_preface.html#//apple_ref/doc/uid/TP40000883-CH204-DontLinkElementID_69">Interactive Movies</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../flashmediahandler/6-Flash-Media-Handler.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../quicktimeatoms/8-QuickTime-Atoms.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000883-CH211-DontLinkElementID_1" title="Creating Advanced Interactive Movies"></a><h1><a name="//apple_ref/doc/uid/TP40000883-CH211-BCICIJJI" title="Creating Advanced Interactive Movies"></a>Creating Advanced Interactive Movies</h1><p>QuickTime 4.1 introduced a set of new features for authors and tool developers that allow for the creation of even more advanced, interactive movies. These features included </p><ul class="ul"><li class="li"><p>the introduction of embedded movies</p></li><li class="li"><p>the addition of new wired actions and events</p></li><li class="li"><p>the addition of new ways to communicate between a wired movie and JavaScript in a Web browser</p></li></ul><p>The current version of QuickTime also introduces new features for manipulating text tracks in QuickTime movies, along with other capabilities.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-TPXREF101">Embedded Movies</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIEIFAF">Movie Track and Movie Wired Actions</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-TPXREF110">Movie Controller Actions</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-TPXREF111">Wired QT Event</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-TPXREF112">Extended Wired Operand Functionality</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-TPXREF113">Wired Actions and JavaScript</a>
				
			<br/>
			
        
			
			
				<a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIHFEJJ">Custom Wired Actions</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF101" title="Embedded Movies"></a><h2>Embedded Movies</h2><p>Embedded movies are implemented through the track type––the movie track, which is discussed in the section <span class="content_text"><a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIEIFAF">“Movie Track and Movie Wired Actions.”</a></span> </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF102" title="Creating New Types of QuickTime Movies"></a><h3>Creating New Types of QuickTime Movies</h3><p>Because embedded movies can have independent clocks, new types of movies can be created. </p><p>For example, you can create a movie containing animated characters that are watching a video. This movie could contain an animation track, perhaps a sprite or Flash track, and an embedded movie track for the video content. In this example, the root movie’s time base would control the animation, but the video’s rate could be controlled independently from the animations’ rate. Wired actions could be sent to the embedded movie when a user clicks on buttons in the animation track. The wired actions could play, pause, and fast forward the video, or switch to a new one.</p><p>Another way you can take advantage of independent time bases is to allow long audio tracks to be triggered interactively.  For example, if you create a game with sound effects and background music that need to be played back at times defined by events that occur in the game, you can use an embedded movie for each audio track. The advantage of using an embedded movie instead of a music track with a custom sound is that the entire sound does not need to be loaded into memory, so it is appropriate for longer sounds. The disadvantage is that you may not control it similar to a MIDI instrument. </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF103" title="Using Embedded Movies"></a><h3>Using Embedded Movies</h3><p>One way to use embedded movies is to break projects into components, allowing portions to be reused in other projects, and simplifying the authoring process. In QuickTime, this technique could be used in a Web browser using external movie-to-movie communication. In QuickTime, a single movie can be created that is playable in the QuickTime Player or any application that plays QuickTime movies.</p><p>For example, an interactive movie could contain three elements, as illustrated in <span class="content_text"><a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIEHBGG">Figure 7-1</a></span>:</p><ul class="spaceabove"><li class="li"><p>A control strip with custom controls for audio and scene navigation</p></li><li class="li"><p>An area used to display text</p></li><li class="li"><p>An area used for interactive animation</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP40000883-CH211-DontLinkElementID_2" title="Figure 7-1An interactive movie example with three elements"></a><p><a name="//apple_ref/doc/uid/TP40000883-CH211-BCIEHBGG" title="Figure 7-1An interactive movie example with three elements"></a><strong>Figure 7-1&nbsp;&nbsp;</strong>An interactive movie example with three elements</p><img src = "../art/interactive_movie.gif" alt = "An interactive movie example with three elements" width="429" height="259"></div><br/><p>By encapsulating these three elements each in a separate movie, you can reload only portions that are necessary to reload. For example, the control strip may persist throughout the entire experience, while the animation area may be replaced once per scene and the displayed text changed several times per scene. By implementing each element as a movie and composing them together using movie tracks in a container movie, you can minimize reload time and memory usage, and even update the source movies on your Web server as you improve or change them.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF104" title="Dynamically Loading Embedded  Movies From URLs"></a><h3>Dynamically Loading Embedded  Movies From URLs</h3><p>A movie track maintains a list of movies that may be loaded and played within the track. The movie track plays only one movie from the list at a given time. This list is initialized from data in a movie track sample, but the list may be augmented at runtime. Each entry in the list is identified by a unique ID, and contains a data reference to a movie. There are two wired actions, which allow you to add a new URL data reference to this list, and to load and play a movie from this list.</p><p>Dynamically loading a movie into a movie track is similar to loading a URL into a frame of a Web page. This dynamic loading allows for movies to manage memory efficiently by loading QuickTime playable content as it is needed. In addition, it allows for content which is generated on a Web server to be loaded into a movie; this content could even be created based upon information that a wired movie sends to the server using the <code>GotoURL</code> wired action.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF105" title="Triggering Wired Actions When an  Embedded Movie is Loaded"></a><h3>Triggering Wired Actions When an  Embedded Movie is Loaded</h3><p>A <code>MovieLoaded</code> QuickTime event allows wired actions to be executed when an embedded movie is loaded. There are two places to store these actions. The movie that is being loaded may store actions in its movie properties atom container, and the movie track may store these actions in its samples. </p><p>These wired actions can be used to examine the current state of the parent movie, and to make changes both to the movie being loaded and to elements of the parent movie.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF106" title="Targeting Elements of Embedded  Movies with All Wired Actions"></a><h3>Targeting Elements of Embedded  Movies with All Wired Actions</h3><p>All wired actions may be performed on elements of embedded movies, and wired action handlers inside of embedded movies may perform actions on elements of their parent movie.</p><p>To understand this targeting hierarchy, we can look at the current runtime state of a movie as a tree, as shown in the example in <span class="content_text"><a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIBAIAB">Figure 7-2</a></span>. The root of this tree is the root movie itself. The children of the root movie node are tracks. Some types of tracks, such as the sprite track, can contain child nodes that are sprites. In earlier versions of QuickTime, this was as deep as the tree ever got, but with the introduction of the movie track, the tree can be indefinitely deep. The movie track node has child track nodes based on its currently loaded movie; one or more of these tracks may be yet another movie track.</p><p>Take, for example, a movie containing a Flash track and a movie track. The movie track’s currently loaded movie contains a video track, an audio track, and a sprite track with two sprites. This constitutes the target hierarchy tree shown in <span class="content_text"><a href="7-Advanced-Interactive.html#//apple_ref/doc/uid/TP40000883-CH211-BCIBAIAB">Figure 7-2</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40000883-CH211-DontLinkElementID_3" title="Figure 7-2An example targeting hierarchy tree"></a><p><a name="//apple_ref/doc/uid/TP40000883-CH211-BCIBAIAB" title="Figure 7-2An example targeting hierarchy tree"></a><strong>Figure 7-2&nbsp;&nbsp;</strong>An example targeting hierarchy tree</p><img src = "../art/root_movie.gif" alt = "An example targeting hierarchy tree" width="217" height="205"></div><br/><p>Conceptually, you may think of the movie track and its currently loaded movie as a single entity––that is, a movie track. A movie track such as the child movie in this example may be the target of both track and movie actions. When specifying a target for an action, you first specify the movie (or movie track) that is the target or that contains the target. Then, you can further specify a track and track object if needed.</p><p>These are the ways you can target various elements within a hierarchy:</p><ul class="spaceabove"><li class="li"><p>external movies by movie name or movie ID</p></li><li class="li"><p>child movie track by track ID, track index or track name </p></li><li class="li"><p>movies higher in the hierarchy as the parent movie or the root movie</p></li></ul><p>These targets are relative to the current movie that contains the action handler. A few examples may help clarify how to target various elements.</p><p>Example 1: Sprite 1 has an action handler on a mouse click that tells the root movie to play.</p><p>Since Sprite 1 is contained in the child movie, the movie target is specified relative to the child movie. This may be accomplished by targeting the parent movie or root movie. </p><p>Example 2: Sprite 2 has an action handler that tells the Flash track to pan left. </p><p>Again, the target is relative to the child movie, so you can use either the parent movie or the root movie to specify the root movie. Additionally, you specify the Flash track.</p><p>Example 3:  A button in the Flash track contains a mouse click handler that sets the volume of the audio track in the child movie. In this example, Flash track is contained in the root movie, so the movie target is specified relative to the root movie. You can use any of the child movie target types to specify the child movie. You can specify that the target is the audio track.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF107" title="Target Type Atoms for Hierarchical Movies"></a><h3>Target Type Atoms for Hierarchical Movies</h3><p>There are target atoms to accommodate embedded movies in QuickTime. They allow for paths to be specified in a hierarchical movie tree.</p><p>Target movies may be an external movie, the default movie, or any movie embedded within another movie. Targets are specified using a movie path that may include parent and child movie relationships, and may additionally include track and track object target atoms as needed.</p><p>By using embedded <code>kActionTarget</code> atoms along with parent and child movie target atoms, you can build up paths for movie targets. Note that you look for these embedded <code>kActionTargetAtoms</code> only when evaluating a movie target, and any movie target type may contain a sibling <code>kActionTargetAtom</code>.</p><p>Paths start from the current movie, which is the movie containing the object that is handling an event. You may go up the tree using a <code>kTargetParentMovie</code> atom or down the tree using one of five child movie atoms. You may use a <code>kTargetRootMovie</code> atom as a shortcut to get to the top of the tree containing an embedded movie and may use the existing <code>movieByName</code> and <code>movieByID</code> atoms to specify a root external movie.</p><p>The target atoms are described below. Note that there are five ways to specify an embedded child movie. Three of them specify movie track properties. Two specify properties of the currently loaded movie in a movie track.</p><dl class="termdef">	<dt><i class="mono">kTargetRootMovie (leaf atom –– no data)</em></dt><dd><p>The root movie containing the action handler.</p></dd><dt><i class="mono">kTargetParentMovie  (leaf atom –– no data)</em></dt><dd><p>The parent movie.</p><div class="codesample"><table><tr><td scope="row"><pre>kTargetChildMovieTrackName<span></span></pre></td></tr><tr><td scope="row"><pre>[Pstring movieTrackName]<span></span></pre></td></tr></table></div><p>A child movie track specified by track name. </p><div class="codesample"><table><tr><td scope="row"><pre>kTargetChildMovieTrackID<span></span></pre></td></tr><tr><td scope="row"><pre>[QTAtomID movieTrackID]<span></span></pre></td></tr></table></div><p>A child movie track specified by track ID.</p><div class="codesample"><table><tr><td scope="row"><pre>kTargetChildMovieTrackIndex<span></span></pre></td></tr><tr><td scope="row"><pre>[long movieTrackIndex]<span></span></pre></td></tr></table></div><p>A child movie track specified by track index.</p><div class="codesample"><table><tr><td scope="row"><pre>kTargetChildMovieMovieName<span></span></pre></td></tr><tr><td scope="row"><pre>[Pstring movieName]<span></span></pre></td></tr></table></div><p>A child movie specified by the currently loaded movie’s movie name. The child movie must contain <code>movieName</code> user data with the specified name.</p><div class="codesample"><table><tr><td scope="row"><pre>kTargetChildMovieMovieID<span></span></pre></td></tr><tr><td scope="row"><pre>[QTAtomID movieID]<span></span></pre></td></tr></table></div><p>A child movie specified by the currently loaded movie’s movie ID. The child movie must contain <code>movieID</code> user data with the specified ID. </p></dd></dl><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF108" title="Example #1"></a><h4>Example #1</h4><p>Movie "Root" contains two embedded movies. "Controller" is an embedded movie controller movie. "ControlMe" is an embedded audio/video movie to be controlled. "Controller" and "ControlMe" are both child movies of the Root Movie.</p><p>To control the rate of the movie’s audio/video, a sprite in the “Controller” movie uses the following target:</p><div class="codesample"><table><tr><td scope="row"><pre>kActionTarget<span></span></pre></td></tr><tr><td scope="row"><pre>    kTargetParentMovie<span></span></pre></td></tr><tr><td scope="row"><pre>    kActionTarget<span></span></pre></td></tr><tr><td scope="row"><pre>        kTargetChildMovieMovieName<span></span></pre></td></tr><tr><td scope="row"><pre>            [movieName = "ControlMe"]<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF109" title="Example #2"></a><h4>Example #2</h4><p>A sprite in one movie targets a sprite which is embedded in a movie which is again embedded in another movie.</p><p>You target a sprite named "Dude" in a track of index 1 in a movie of ID 2 which is nested in a movie whose track name is "Rad", which is nested in a movie whose user data name is <code>OuterExternalMovie</code>. <code>OuterExternalMovie</code> is an external movie to the one that is executing an action handler.</p><div class="codesample"><table><tr><td scope="row"><pre>kActionTarget<span></span></pre></td></tr><tr><td scope="row"><pre>        kTargetMovieName<span></span></pre></td></tr><tr><td scope="row"><pre>                [name = "OuterExternalMovie"]<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionTarget<span></span></pre></td></tr><tr><td scope="row"><pre>                kTargetChildMovieTrackName<span></span></pre></td></tr><tr><td scope="row"><pre>                        [name = "Rad"]<span></span></pre></td></tr><tr><td scope="row"><pre>                kActionTarget<span></span></pre></td></tr><tr><td scope="row"><pre>                        kTargetChildMovieMovieID<span></span></pre></td></tr><tr><td scope="row"><pre>                                [ID = 2]<span></span></pre></td></tr><tr><td scope="row"><pre>                        kTargetTrackIndex<span></span></pre></td></tr><tr><td scope="row"><pre>                                [Index = 1]<span></span></pre></td></tr><tr><td scope="row"><pre>                        kTargetSpriteName<span></span></pre></td></tr><tr><td scope="row"><pre>                                [spriteName = "Dude"]<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH211-BCIEIFAF" title="Movie Track and Movie Wired Actions"></a><h2>Movie Track and Movie Wired Actions</h2><p>Two actions operate on a movie track target:</p><ul class="ul"><li class="li"><p><code>kActionMovieTrackAddChildMovie (QTAtomID childMovieID, CStr                                   childMovieURL)</code></p></li></ul><p>This action adds a movie URL data reference to the targeted movie track’s array of movie data references. The URL data reference is added with the specified ID. If a data reference with the same ID already exists, it is replaced. It is generally a good idea to use an ID that is not contained in the movie track's sample, since this may be reloaded under some conditions.</p><ul class="ul"><li class="li"><p><code>kActionMovieTrackLoadChildMovie (QTAtomID childMovieID)</code></p></li></ul><p>This action loads a movie specified by <code>childMovieID</code> as the current movie being played by the movie track. The movie replaces the current movie.</p><p>Another action operates on a root movie or a movie track target:</p><div class="codesample"><table><tr><td scope="row"><pre>kActionMovieRestartAtTime (TimeValue startTime, Fixed rate)<span></span></pre></td></tr></table></div><p>This action restarts the targeted movie at the specified movie time, restarting it at the specified rate. If <code>rate</code> is set to 0, then the current movie rate is used. More specifically, this action stops the current movie, changes the movie’s time to the specified time, and then prerolls the movie from that time at the specified rate. </p><p>Note that the wired actions <code>DoScript</code>, <code>GotoURL</code>, <code>DebugString</code>, and <code>StatusString</code> are sent through the root movie’s <code>MCDoActionProc</code> when executed from a child movie, allowing them to work with existing applications that trap for these actions.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF110" title="Movie Controller Actions"></a><h2>Movie Controller Actions</h2><p><code>mcActionDoScript</code> allows a movie to send requests to execute scripts of various sorts to a host application. The parameter is of type <code>QTDoScriptPtr</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>struct QTDoScriptRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>        long scriptTypeFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>        char *command;<span></span></pre></td></tr><tr><td scope="row"><pre>        char *arguments;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef QTDoScriptRecord *QTDoScriptPtr;<span></span></pre></td></tr></table></div><p>These are the constants currently defined for the <code>scriptTypeFlags</code> field:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>        kScriptIsUnknownType = 1L &lt;&lt; 0<span></span></pre></td></tr><tr><td scope="row"><pre>        kScriptIsJavaScript = 1L &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>        kScriptIsLingoEvent = 1L &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>        kScriptIsVBEvent = 1L &lt;&lt; 3,<span></span></pre></td></tr><tr><td scope="row"><pre>        kScriptIsProjectorCommand = 1L &lt;&lt; 4<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>For more information, see the explanation above of the new wired action <code>kActionDoScript</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>mcActionRestartAtTime<span></span></pre></td></tr></table></div><p>This allows a movie to be restarted at a particular time and rate.</p><p>The parameter is a <code>QTRestartAtTimePtr. </code></p><div class="codesample"><table><tr><td scope="row"><pre>struct QTRestartAtTimeRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue       startTime;  /* time scale is the movie timescale*/<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed           rate;       /* if rate is 0, the movie's current<span></span></pre></td></tr><tr><td scope="row"><pre>                                rate is maintained*/<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTRestartAtTimeRecord QTRestartAtTimeRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>typedef QTRestartAtTimeRecord *QTRestartAtTimePtr;<span></span></pre></td></tr></table></div><p>For more information, see the explanation above of the new wired action <code>kActionMovieRestartAtTime</code>.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF111" title="Wired QT Event"></a><h2>Wired QT Event</h2><p><code>kQTEventMovieLoaded</code> event was added to QuickTime 4.1. This event is sent when an embedded movie is loaded. Embedded movies may be loaded when a movie containing an embedded movie is first opened, when an embedded movie loads a new sample due to the movie’s time changing, or when an embedded movie is sent a <code>kActionMovieTrackLoadChildMovie</code> action.</p><p>Action handlers for the <code>kQTEventMovieLoaded</code> event may reside in two places.  They may be placed in a sample of a movie track’s media or placed in the movie property atom of a movie that is loaded into a movie track.</p><p>If handlers exist in both places, the action list from the sample is appended to the one from the movie property atom. This means that the actions from the sample will be executed second, and if the same action resides in both places for the same target, the effect of the action from the sample will persist.</p><p>To add an event handler to a movie media sample, you add an atom of type <code>kQTEventMovieLoaded</code> to the sample, with child atoms defining the actions. </p><p>To add an event handler to a child movie that is to be loaded, you add an atom of type <code>kQTEventMovieLoaded</code> to the child movie’s movie property atom using the new QuickTime Movie Toolbox routine <code>SetMoviePropertyAtom</code>. You may use the <code>GetMoviePropertyAtom</code> function to first retrieve the existing movie properties container, add or modify the <code>kQTEventMovieLoaded</code> atom, and then write it back using the <code>SetMoviePropertyAtom</code> function.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF112" title="Extended Wired Operand Functionality "></a><h2>Extended Wired Operand Functionality </h2><p>A special case was added to the wired operand <code>kOperandComponentVersion</code>.</p><p>By using the arguments <code>kOperandComponentVersion("mac ", "os  ", "vers" )</code> the version of Mac OS is returned. 0 is returned on Windows.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF113" title="Wired Actions and JavaScript"></a><h2>Wired Actions and JavaScript</h2><div class="codesample"><table><tr><td scope="row"><pre>kActionDoScript (long flags, CStr commands, CStr arguments)<span></span></pre></td></tr></table></div><p>This new wired action has no target (system target). </p><p>The action calls the root movie controller’s <code>mcActionDoScript</code>, so that scripts can be invoked by a host application. For example, the QuickTime Plug-in in a browser can invoke JavaScripts.</p><p>If the script flags are set to <code>kScriptIsUnknownType</code> or <code>kScriptIsJavaScript</code>, the QuickTime Plug-in invokes a JavaScript routine in the HTML file that has embedded the QuickTime movie, with the following prototype:</p><div class="codesample"><table><tr><td scope="row"><pre>function DoFSCommand(command, arguments) { }<span></span></pre></td></tr></table></div><p>If the movie is embedded with a NAME tag, a <code>movieName</code> tag, or is named by user data, then this prototype is used instead:</p><div class="codesample"><table><tr><td scope="row"><pre>function movieName_DoFSCommand(command, arguments) { }<span></span></pre></td></tr></table></div><p>This allows for wired movies to invoke a JavaScript. The QuickTime Plug-in also supports many movie-related JavaScript routines, so it is possible to set sprite track variables and post custom wired events to a wired movie from JavaScript as well. It is important to note that this functionality works only with the QuickTime Plug-in and that some versions of some browsers do not support the necessary interfaces to allow for these things to work. </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF114" title="Movie Property Atom Toolbox Routines"></a><h3>Movie Property Atom Toolbox Routines</h3><p>Similar to the <code>GetMediaPropertyAtom</code> and <code>SetMediaPropertyAtom</code> routines, QuickTime 4.1 introduced <code>GetMoviePropertyAtom</code> and <code>SetMoviePropertyAtom</code> routines. These routines allow an atom container of structured data to be associated with a movie. This information is saved in a movie resource.</p><p>The <code>kQTEventMovieLoaded</code> looks for an atom of type <code>kQTEventMovieLoaded</code> in a movie's property atom container when a MovieTrack loads a new movie.</p><div class="codesample"><table><tr><td scope="row"><pre>GetMoviePropertyAtom (Movie theMovie, QTAtomContainer * propertyAtom)<span></span></pre></td></tr></table></div><p>This routine allocates and returns in <code>propertyAtom</code> an atom container containing a copy of <code>theMovie</code>’s properties’ atom container.</p><div class="codesample"><table><tr><td scope="row"><pre>SetMoviePropertyAtom (Movie theMovie, QTAtomContainer  propertyAtom)<span></span></pre></td></tr></table></div><p>This routine sets the contents of <code>theMovie</code>’s property atom container to the contents of the <code>propertyAtom</code> atom container.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-BCIHFEJJ" title="Custom Wired Actions"></a><h2>Custom Wired Actions</h2><p>Developers may supplement the set of built-in wired actions by using a plug-in mechanism. You may write custom action handler components to perform new types of actions. For example, you could write a math library component to perform complicated computations quickly, returning the result by setting a sprite track variable. Another use would be for allowing a custom media handler to be scripted using wired actions.</p><p>Custom wired actions in a movie are routed to these components for handling. They are passed information about the current <code>QTEvent</code>, the movie element that is to be the target of the action, the default movie element that received the <code>QTEvent</code> and generated the action, the type of the action, and the parameters of the action. The wired action expression evaluation machinery has been exposed as a single API call, allowing general wired expressions to be passed as parameters.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF115" title="Custom Action Handler Usage"></a><h3>Custom Action Handler Usage</h3><p>Custom action handler usage falls into one of two categories:</p><ul class="spaceabove"><li class="li"><p>as a stateless subroutine library</p></li><li class="li"><p>as an object that maintains state across multiple custom action executions</p></li></ul><p>When used as a subroutine library, the movie author simply scripts custom actions. QuickTime opens an instance of the specified custom action handler, passes it the action to execute, and then closes the component. When used as an object that maintains state, the movie author needs to open an instance of the handler with a unique instance ID. In this case, QuickTime keeps the action handler component open until the movie is closed. When making calls to an action handler that has been opened, the unique instance ID is specified, allowing QuickTime to route the request to the correct component instance.</p><p>Note that there is currently no way to specify that the handler is a component that has already been opened by QuickTime, such as a media handler or codec that is in use. One special case has been included for developers authoring media handlers that support custom wired actions. If the component description of the custom action’s target matches that of the target media handler, then the custom action is sent to the instance of the media handler that already in use. This means that the movie author does not need to (and should not) open an instance of the component.</p><p>When authoring a movie with a custom action, the type of component used to execute it is specified, along with an instance ID. If the component is being used as a simple subroutine library, which does not need to keep track of any state, then the ID may be set to 0. If a particular instance of an open action-handling component is intended to be used, then the ID is used to refer to it. You may use the <code>kActionOpenCustomHandler</code> to open the component with a particular ID. This ID should be obtained by using the <code>kOperandUniqueCustomHandlerID</code> to ensure that your movie will work after edits are performed. After opening a custom action handler you may use <code>kOperandCustomActionHandlerOpen</code> to determine that the component was indeed found and opened successfully.</p><p>If the instance ID is set to 0 and the component description matches that of the media handler that is the target of the action, then the media handler is used to execute the custom action. </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF116" title="Authoring Custom Wired Actions "></a><h3>Authoring Custom Wired Actions </h3><p>To specify that an action is to be handled by a custom handler, you add the <code>kCustomActionHandler</code> atom as a child of the <code>kAction</code> atom. You define which type of component is to handle the action by adding a <code>kCustomHandlerDesc</code> atom, and optionally specify a particular handler instance ID using the <code>kCustomHandlerID</code> atom. </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF117" title="Extension to Wired Movie Format: Executing Custom Actions"></a><h4>Extension to Wired Movie Format: Executing Custom Actions</h4><div class="codesample"><table><tr><td scope="row"><pre>kActionAtom<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kCustomActionHandler, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>       kCustomHandlerDesc, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>            [ComponentDescription handlerDesc]<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kCustomHandlerID, 1, 1><span></span></pre></td></tr><tr><td scope="row"><pre>            [long handlerID]<span></span></pre></td></tr></table></div><p>You define parameter atoms as usual and have access to the parameters through an API for writing custom action handlers. This means that parameters may be wired expressions and your component may fetch the result of the evaluated expression.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF118" title="Wired Actions"></a><h4>Wired Actions</h4><div class="codesample"><table><tr><td scope="row"><pre>kActionOpenCustomHandler<span></span></pre></td></tr><tr><td scope="row"><pre>    Supported Flags: None<span></span></pre></td></tr><tr><td scope="row"><pre>    Param 1: [long handlerID]<span></span></pre></td></tr><tr><td scope="row"><pre>    Param 2: [QTCustomActionHandlerRecord<span></span></pre></td></tr></table></div><p>Opens a custom action-handling component that may be referred to later by its handler ID. </p><p>Typically, you would first use the <code>kOperandUniqueCustomActionHandlerID</code> operand to obtain a unique ID. After storing this in a variable, you use this action to open the handler. Then you can use <code>kOperandCustomActionHandlerOpen</code> to determine if the handler was found. </p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF119" title="Wired Operands"></a><h4>Wired Operands</h4><div class="codesample"><table><tr><td scope="row"><pre>kOperandUniqueCustomActionHandlerID<span></span></pre></td></tr><tr><td scope="row"><pre>    No Params<span></span></pre></td></tr></table></div><p>Returns a unique custom handler ID that may be used with <code>kActionOpenCustomHandler</code>. </p><div class="codesample"><table><tr><td scope="row"><pre>kOperandCustomActionHandlerOpen<span></span></pre></td></tr><tr><td scope="row"><pre>    Param 1: handlerID<span></span></pre></td></tr></table></div><p>Returns <code>true</code> if a handler with the specified ID is open, otherwise <code>false</code>. This may be used to determine if the component specified by <code>kActionOpenCustomHandler</code> was found and opened.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF120" title="Writing a Custom Action Handler Component"></a><h3>Writing a Custom Action Handler Component</h3><p>Any component type, whether it is a media handler, a codec, or your own component type, may be extended to handle custom actions. To extend your component, you implement the <code>ExecuteWiredAction</code> routine described below. If you are writing a component that is being used only to handle custom actions, you should use the component type <code>'wire'</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>EXTERN_API( ComponentResult )<span></span></pre></td></tr><tr><td scope="row"><pre>CallComponentExecuteWiredAction (ComponentInstance  ci,<span></span></pre></td></tr><tr><td scope="row"><pre>                                QTAtomContainer actionContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                QTAtom  actionAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>                                QTCustomActionTargetPtr target,<span></span></pre></td></tr><tr><td scope="row"><pre>                                QTEventRecordPtr event);<span></span></pre></td></tr></table></div><p>All the state passed to you in this routine is only valid for the duration of the execution of your custom action, which should be completed when you return from this routine.</p><p>The <code>actionContainer</code> contains all of the actions that are being executed in response to the current <code>QTEvent</code>. This atom container should not be edited, only read from, since other actions that have yet to be executed may be contained within it. </p><p>The <code>actionAtom</code>  specifies the <code>kActionAtom</code> that concerns you, since it contains all of the atoms describing the action type and parameters to your components custom action that are to be executed.  </p><p>The <code>target</code> parameter specifies the movie elements that you need in order to execute your action.</p><div class="codesample"><table><tr><td scope="row"><pre>struct QTCustomActionTargetRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie                           movie;<span></span></pre></td></tr><tr><td scope="row"><pre>    DoMCActionUPP                   doMCActionCallbackProc;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            callBackRefcon;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                           track;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            trackObjectRefCon;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                           defaultTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            defaultObjectRefCon;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre>typedef struct QTCustomActionTargetRecord QTCustomActionTargetRecord;<span></span></pre></td></tr><tr><td scope="row"><pre>typedef QTCustomActionTargetRecord * QTCustomActionTargetPtr;<span></span></pre></td></tr></table></div><p>The <code>movie</code> field is the movie that is or contains the movie element, which is the target of the action.</p><p>The <code>doMCActionCallbackProc</code> and <code>callBackRefcon</code> specify the movie controller and <code>refCon</code> for the target movie’s movie controller. They may be used with the <code>CallDoMCActionProc</code> routine to invoke the movie controller functionality, including the new <code>mcActionFetchParameterAs</code>. </p><p>The <code>track</code> field is the track that is or contains the movie element, which is the target of the action.</p><p>The <code>trackObjectRefCon</code> field is the <code>refCon</code> or ID of the movie element that is the target of the action. If the target is a sprite, this will be the sprite ID.</p><p>The <code>defaultTrack</code> is the track that contains the movie element that handled the <code>QTEvent</code> and generated the custom action. For example, if a hypertext element of a text track generated a <code>SetSpriteVisible</code> action for a sprite in a sprite track, the <code>defaultTrack</code> would be the text track, while the sprite track would be the target track.</p><p>The <code>defaultObjectRefCon</code> is the <code>refCon</code> or ID of the movie element that handled the QTEvent and generated the custom action.</p><p>The <code>event</code> specifies information about what <code>QTEvent</code> generated the custom action.</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF121" title="The Action Being Executed"></a><h4>The Action Being Executed</h4><p>If your component defines multiple custom action types, then you can determine the action type by looking at the <code>kWhichAction</code> atom, which is a child atom of this <code>kActionAtom</code>. The data of this <code>kWhichAction</code> atom is a <code>long</code> defining the action (and needs byte flipping for Windows).</p><a name="//apple_ref/doc/uid/TP40000883-CH211-TPXREF122" title="Fetching the Parameters"></a><h4>Fetching the Parameters</h4><p>The parameters to your custom action may be the result of a wired expression. You don’t have to be concerned about analyzing the <code>kActionParameter</code> child atoms: the wired expression evaluation machinery has been made accessible via a movie controller action called <code>mcActionFetchParameterAs</code>. </p><p>You fill out a <code>QTFetchParameterAsRecord</code> and pass it to <code>mcActionFetchParameterAs</code> as in:</p><div class="codesample"><table><tr><td scope="row"><pre>CallDoMCActionProc(resolvedTarget->doMCActionCallbackProc,<span></span></pre></td></tr><tr><td scope="row"><pre>                    resolvedTarget->callBackRefcon,<span></span></pre></td></tr><tr><td scope="row"><pre>                    mcActionFetchParameterAs,<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;fetchAs, &amp;handled );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>struct QTFetchParameterAsRecord {<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomSpec                      paramListSpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            paramIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            paramType;<span></span></pre></td></tr><tr><td scope="row"><pre>    long                            allowedFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *                          min;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *                          max;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *                          currentValue;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *                          newValue;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean                         isUnsignedValue;<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>You set the container and atom of the <code>paramListSpec</code> to the <code>actionContainer</code> and <code>actionAtom</code> passed to <code>ExecuteWiredAction()</code>.<code></code></p><p>You set the <code>paramIndex</code> to the index of the parameter you wish to fetch. If you allow a variable number of parameters, you may count how many child atoms of type <code>kActionParameter</code> the <code>actionAtom</code> has.</p><p>You set the <code>paramType</code> to one of the parameter types from the following enumeration:</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsBooleanPtr                  = 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsShortPtr                    = 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsLongPtr                     = 3,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsMatrixRecordPtr             = 4,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsModifierTrackGraphicsModeRecord = 5,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsHandle                      = 6,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsStr255                      = 7,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsFloatPtr                    = 8,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsPointPtr                    = 9,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsNewAtomContainer            = 10,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsQTEventRecordPtr            = 11,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsFixedPtr                    = 12,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsSetControllerValuePtr = 13,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsRgnHandle                   = 14,   /* flipped to native*/<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsComponentDescriptionPtr = 15,<span></span></pre></td></tr><tr><td scope="row"><pre>    kFetchAsCString                     = 16<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>You set the <code>allowedFlags</code> to flags from the following enumeration, or 0 fetching without constraints.</p><div class="codesample"><table><tr><td scope="row"><pre>enum {<span></span></pre></td></tr><tr><td scope="row"><pre>    kActionFlagActionIsDelta        = 1L &lt;&lt; 1,<span></span></pre></td></tr><tr><td scope="row"><pre>    kActionFlagParameterWrapsAround  = 1L &lt;&lt; 2,<span></span></pre></td></tr><tr><td scope="row"><pre>    kActionFlagActionIsToggle       = 1L &lt;&lt; 3<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>If <code>allowedFlags</code> is not set to 0, you set the <code>min</code>, <code>max</code>, <code>current</code>, and <code>isUnsignedValue</code> fields to appropriate values based on the data type being fetched.</p><p>The <code>newValue</code> field returns the result of the parameter. </p><p>For scalar and structure types, you pass a pointer to the appropriate data type and it will be filled in.</p><p>For <code>Handle</code>, <code>RgnHandle</code>, and <code>Cstring</code>, you pass in a new empty handle that will be resized as needed, you are responsible for disposing the handle when done.</p><p>For <code>kFetchAsNewAtomContainer</code>, you pass in a pointer to a non-allocated <code>QTAtomContainer</code>. On return, this container will contain the contents of the single child atom of the parameter atom and all of its children. This lets you pass arbitrary data that is not evaluated in an atom container as a parameter.</p><p></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../flashmediahandler/6-Flash-Media-Handler.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../quicktimeatoms/8-QuickTime-Atoms.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-10-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/IQ_InteractiveMovies/advancedinteractive/7-Advanced-Interactive.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/IQ_InteractiveMovies/advancedinteractive/7-Advanced-Interactive.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/IQ_InteractiveMovies/advancedinteractive/7-Advanced-Interactive.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>