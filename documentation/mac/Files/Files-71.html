<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of File Management (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING71></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-70.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-72.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-12.html"><B>Chapter 1 - Introduction to File Management</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING71-0></A>
<H1>Summary of File Management</H1>
<A NAME=HEADING71-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING71-2></A>
<H3>Constants</H3>
<PRE>
CONST
   {Gestalt constants}
   gestaltFSAttr           =  'fs  ';  {file system attributes selector}
   gestaltHasFSSpecCalls   =  1;       {supports FSSpec records}
   gestaltStandardFileAttr =  'stdf';  {Standard File attributes selector}
   gestaltStandardFile58   =  0;       {supports StandardPutFile etc.}
   gestaltFindFolderAttr   =  'fold';  {FindFolder attributes selector}
   gestaltFindFolderPresent=  0;       {FindFolder is present}
   {access modes for opening files}
   fsCurPerm         =  0;       {whatever permission is allowed}
   fsRdPerm          =  1;       {read permission}
   fsWrPerm          =  2;       {write permission}
   fsRdWrPerm        =  3;       {exclusive read/write permission}
   fsRdWrShPerm      =  4;       {shared read/write permission}
   {file mark positioning modes}
   fsAtMark          =  0;       {at current mark}
   fsFromStart       =  1;       {set mark relative to beginning of file}
   fsFromLEOF        =  2;       {set mark relative to logical end-of-file}
   fsFromMark        =  3;       {set mark relative to current mark}
   rdVerify          =  64;      {add to above for read-verify}
   {messages from CountAppFiles}
   appOpen           =  0;       {open the document(s)}
   appPrint          =  1;       {print the document(s)}
</PRE>
<A NAME=HEADING71-7></A>
<H3>Data Types</H3>
<A NAME=HEADING71-8></A>
<H4>File System Specification Record</H4>
<PRE>
TYPE FSSpec          =
   RECORD
      vRefNum:       Integer;    {volume reference number}
      parID:         LongInt;    {directory ID of parent directory}
      name:          Str63;      {filename or directory name}
   END;

   FSSpecPtr         =  ^FSSpec;
   FSSpecHandle      =  ^FSSpecPtr;
</PRE>
<A NAME=HEADING71-10></A>
<H4>Standard File Reply Record</H4>
<PRE>
TYPE StandardFileReply=
   RECORD
      sfGood:        Boolean;    {TRUE if user did not cancel}
      sfReplacing:   Boolean;    {TRUE if replacing file with same name}
      sfType:        OSType;     {file type}
      sfFile:        FSSpec;     {selected item}
      sfScript:      ScriptCode; {script of selected item's name}
      sfFlags:       Integer;    {Finder flags of selected item}
      sfIsFolder:    Boolean;    {selected item is a folder}
      sfIsVolume:    Boolean;    {selected item is a volume}
      sfReserved1:   LongInt;    {reserved}
      sfReserved2:   Integer;    {reserved}
   END;
</PRE>
<A NAME=HEADING71-12></A>
<H4>Application Files Record</H4>
<PRE>
TYPE AppFile         =
   RECORD
      vRefNum:       Integer;    {working directory reference number}
      fType:         OSType;     {file type}
      versNum:       Integer;    {version number; ignored}
      fName:         Str255;     {filename}
   END;
   SFTypeList        =  ARRAY[0..3] OF OSType;
   FileFilterProcPtr =  ProcPtr; {file filter function}
</PRE>
<A NAME=HEADING71-16></A>
<H3>File Specification Routines</H3>
<A NAME=HEADING71-17></A>
<H4>Opening Files</H4>
<PRE>
PROCEDURE StandardGetFile	(fileFilter: FileFilterProcPtr;
				numTypes: Integer; typeList: SFTypeList; 
				VAR reply: StandardFileReply);
</PRE>
<A NAME=HEADING71-19></A>
<H4>Saving Files</H4>
<PRE>
PROCEDURE StandardPutFile	(prompt: Str255; defaultName: Str255; 
				VAR reply: StandardFileReply);
</PRE>
<A NAME=HEADING71-21></A>
<H3>File Access Routines</H3>
<A NAME=HEADING71-22></A>
<H4>Reading, Writing, and Closing Files</H4>
<PRE>
FUNCTION FSRead			(refNum: Integer; VAR count: LongInt; 
				buffPtr: Ptr): OSErr;
FUNCTION FSWrite		(refNum: Integer; VAR count: LongInt; 
				buffPtr: Ptr): OSErr;
FUNCTION FSClose		(refNum: Integer): OSErr;
</PRE>
<A NAME=HEADING71-26></A>
<H4>Manipulating the File Mark</H4>
<PRE>
FUNCTION GetFPos		(refNum: Integer; VAR filePos: LongInt): OSErr;
FUNCTION SetFPos		(refNum: Integer; posMode: Integer; 
				posOff: LongInt): OSErr;
</PRE>
<A NAME=HEADING71-29></A>
<H4>Manipulating the End-of-File</H4>
<PRE>
FUNCTION GetEOF			(refNum: Integer; VAR logEOF: LongInt): OSErr;
FUNCTION SetEOF			(refNum: Integer; logEOF: LongInt): OSErr;
</PRE>
<A NAME=HEADING71-32></A>
<H3>File and Directory Manipulation Routines</H3>
<A NAME=HEADING71-33></A>
<H4>Opening, Creating, and Deleting Files</H4>
<PRE>
FUNCTION FSpOpenDF		(spec: FSSpec; permission: SignedByte; 
				VAR refNum: Integer): OSErr;
FUNCTION FSpCreate		(spec: FSSpec; creator: OSType; 
				fileType: OSType; scriptTag: ScriptCode): 
				OSErr;
FUNCTION FSpDelete		(spec: FSSpec): OSErr;
</PRE>
<A NAME=HEADING71-37></A>
<H4>Exchanging the Data in Two Files</H4>
<PRE>
FUNCTION FSpExchangeFiles	(source: FSSpec; dest: FSSpec): OSErr;
</PRE>
<A NAME=HEADING71-39></A>
<H4>Creating File System Specifications</H4>
<PRE>
FUNCTION FSMakeFSSpec		(vRefNum: Integer; dirID: LongInt;
				fileName: Str255; VAR spec: FSSpec): OSErr;
</PRE>
<A NAME=HEADING71-41></A>
<H3>Volume Access Routines</H3>
<A NAME=HEADING71-42></A>
<H4>Updating Volumes</H4>
<PRE>
FUNCTION FlushVol		(volName: StringPtr; vRefNum: Integer): OSErr;
</PRE>
<A NAME=HEADING71-44></A>
<H4>Obtaining Volume Information</H4>
<PRE>
FUNCTION GetVInfo		(drvNum: Integer; volName: StringPtr; 
				VAR vRefNum: Integer; VAR freeBytes: LongInt): 
				OSErr;
FUNCTION GetVRefNum		(refNum: Integer; VAR vRefNum: Integer): OSErr;
</PRE>
<A NAME=HEADING71-47></A>
<H3>Application Launch File Routines</H3>
<PRE>
PROCEDURE GetAppParms		(VAR apName: Str255; VAR apRefNum: Integer; 
				VAR apParam: Handle);
PROCEDURE CountAppFiles		(VAR message: Integer; VAR count: Integer);
PROCEDURE GetAppFiles		(index: Integer; VAR theFile: AppFile);
PROCEDURE ClrAppFiles		(index: Integer);
</PRE>
<A NAME=HEADING71-52></A>
<H2>C Summary</H2>
<A NAME=HEADING71-53></A>
<H3>Constants </H3>
<PRE>
/*Gestalt constants*/
#define gestaltFSAttr            'fs  '   /*file system attributes selector*/
#define gestaltFullExtFSDispatching 0     /*exports HFSDispatch traps*/
#define gestaltHasFSSpecCalls       1     /*supports FSSpec records*/
#define gestaltFindFolderAttr    'fold'   /*FindFolder attributes selector*/
#define gestaltFindFolderPresent    0     /*FindFolder is present*/
/*Gestalt Standard File attributes selector and reply*/
#define gestaltStandardFileAttr  'stdf'
#define gestaltStandardFile58       0
/*values for requesting file read/write permissions*/
enum {
   fsCurPerm            = 0,     /*whatever permission is allowed*/
   fsRdPerm             = 1,     /*read permission*/
   fsWrPerm             = 2,     /*write permission*/
   fsRdWrPerm           = 3,     /*exclusive read/write permission*/
   fsRdWrShPerm         = 4};    /*shared read/write permission*/
/*file mark positioning modes*/
enum {
   fsAtMark             = 0,     /*at current mark}
   fsFromStart          = 1,     /*set mark relative to beginning of file*/
   fsFromLEOF           = 2,     /*set mark relative to logical end-of-file*/
   fsFromMark           = 3,     /*set mark relative to current mark*/
   rdVerify             = 64};   /*add to above for read-verify*/
/*messages from CountAppFiles*/
enum {
   appOpen              =  0,    /*open the document(s)*/
   appPrint             =  1};   /*print the document(s)*/
</PRE>
<A NAME=HEADING71-59></A>
<H3>Data Types</H3>
<A NAME=HEADING71-60></A>
<H4>File System Specification Record</H4>
<PRE>
struct FSSpec  {                    /*file system specification*/
      short       vRefNum;          /*volume reference number*/
      long        parID;            /*directory ID of parent directory*/
      Str63       name;             /*filename or directory name*/
};

typedef struct FSSpec FSSpec;
typedef FSSpec *FSSpecPtr;
typedef FSSpecPtr *FSSpecHandle;
</PRE>
<A NAME=HEADING71-62></A>
<H4>Standard File Reply Record</H4>
<PRE>
struct StandardFileReply {       /*enhanced standard file reply record*/
      Boolean        sfGood;     /*TRUE if user did not cancel*/
      Boolean        sfReplacing;/*TRUE if replacing file with same name*/
      OSType         sfType;     /*file type*/
      FSSpec         sfFile;     /*selected file, folder, or volume*/
      ScriptCode     sfScript;   /*script of file, folder, or volume name*/
      short          sfFlags;    /*Finder flags of selected item*/
      Boolean        sfIsFolder; /*selected item is a folder*/
      Boolean        sfIsVolume; /*selected item is a volume*/
      long           sfReserved1;/*reserved*/
      short          sfReserved2;/*reserved*/
};

typedef struct StandardFileReply StandardFileReply;
</PRE>
<A NAME=HEADING71-64></A>
<H4>Application Files Record</H4>
<PRE>
struct AppFile {
      short          vRefNum;    /*working directory reference number*/
      OSType         fType;      /*file type*/
      short          versNum;    /*version number; ignored*/
      Str255         fName;      /*filename*/
   END;

typedef struct AppFile AppFile;
</PRE>
<A NAME=HEADING71-66></A>
<H4>Standard File Type List</H4>
<PRE>
typedef OSType SFTypeList[4];
</PRE>
<A NAME=HEADING71-68></A>
<H4>Callback Routine Pointer Types</H4>
<PRE>
/*file filter function*/
typedef pascal Boolean (*FileFilterProcPtr)
   (ParmBlkPtr PB);
</PRE>
<A NAME=HEADING71-72></A>
<H3>File Specification Routines</H3>
<A NAME=HEADING71-73></A>
<H4>Opening Files</H4>
<PRE>
pascal void StandardGetFile	(const Str255 prompt,
				FileFilterProcPtr fileFilter, 
				short numTypes, SFTypeList typeList, 
				StandardFileReply *reply);
</PRE>
<A NAME=HEADING71-75></A>
<H4>Saving Files</H4>
<PRE>
pascal void StandardPutFile	(const Str255 prompt, const Str255 defaultName, 
				StandardFileReply *reply);
</PRE>
<A NAME=HEADING71-77></A>
<H3>File Access Routines</H3>
<A NAME=HEADING71-78></A>
<H4>Reading, Writing, and Closing Files</H4>
<PRE>
pascal OSErr FSRead		(short refNum, long *count, Ptr buffPtr);
pascal OSErr FSWrite		(short refNum, long *count, Ptr buffPtr);
pascal OSErr FSClose		(short refNum);
</PRE>
<A NAME=HEADING71-82></A>
<H4>Manipulating the File Mark</H4>
<PRE>
pascal OSErr GetFPos		(short refNum, long *filePos);
pascal OSErr SetFPos		(short refNum, short posMode, long posOff);
</PRE>
<A NAME=HEADING71-85></A>
<H4>Manipulating the End-of-File</H4>
<PRE>
pascal OSErr GetEOF		(short refNum, long *logEOF);
pascal OSErr SetEOF		(short refNum, long logEOF);
</PRE>
<A NAME=HEADING71-88></A>
<H3>File and Directory Manipulation Routines</H3>
<A NAME=HEADING71-89></A>
<H4>Opening, Creating, and Deleting Files</H4>
<PRE>
pascal OSErr FSpOpenDF		(const FSSpec *spec, char permission, 
				short *refNum);
pascal OSErr FSpCreate		(const FSSpec *spec, OSType creator, 
				OSType fileType, ScriptCode scriptTag);
pascal OSErr FSpDelete		(const FSSpec *spec);
</PRE>
<A NAME=HEADING71-93></A>
<H4>Exchanging the Data in Two Files</H4>
<PRE>
pascal OSErr FSpExchangeFiles
   				(const FSSpec *source, const FSSpec *dest);
</PRE>
<A NAME=HEADING71-96></A>
<H4>Creating File System Specifications</H4>
<PRE>
pascal OSErr FSMakeFSSpec	(short vRefNum, long dirID, 
				ConstStr255Param fileName, FSSpecPtr spec);
</PRE>
<A NAME=HEADING71-98></A>
<H3>Volume Access Routines</H3>
<A NAME=HEADING71-99></A>
<H4>Updating Volumes</H4>
<PRE>
pascal OSErr FlushVol 		(StringPtr volName, short vRefNum);
</PRE>
<A NAME=HEADING71-101></A>
<H4>Obtaining Volume Information</H4>
<PRE>
pascal OSErr GetVInfo		(short drvNum, StringPtr volName,
				short *vRefNum, long *freeBytes);
pascal OSErr GetVRefNum		(short refNum, short *vRefNum);
</PRE>
<A NAME=HEADING71-104></A>
<H3>Application Launch File Routines</H3>
<PRE>
pascal void GetAppParms		(Str255 apName, short *apRefNum, 
				Handle *apParam);
pascal void CountAppFiles	(short *message, short *count);
pascal void GetAppFiles		(short index, AppFile *theFile);
pascal void ClrAppFiles		(short index);
</PRE>
<A NAME=HEADING71-109></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING71-110></A>
<H3>Global Variables
<TABLE BORDER="0" CELLPADDING=3><TD>AppParmHandle<TD>long<TD>Handle to Finder information.<TR>
<TD>CurApName<TD>32 bytes<TD>Name of current application (length byte followed by up to <BR>31 characters).<TR>
<TD>CurApRefNum<TD>word<TD>Reference number of current application's resource file.</TABLE>
</H3>
<A NAME=HEADING71-111></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD><CODE>dirFulErr</CODE><TD><B> -33</B><TD><B>File directory full</B><TR>
<TD>dskFulErr<TD> -34<TD>All allocation blocks on the volume are full<TR>
<TD>nsvErr<TD>-35<TD>Volume not found<TR>
<TD>ioErr<TD>-36<TD>I/O error<TR>
<TD>bdNamErr<TD>-37<TD>Bad filename or volume name<TR>
<TD>fnOpnErr<TD> -38<TD>File not open<TR>
<TD>eofErr<TD>-39<TD>Logical end-of-file reached<TR>
<TD>posErr<TD> -40<TD>Attempt to position mark before start of file<TR>
<TD>tmfoErr<TD>-42<TD>Too many files open<TR>
<TD>fnfErr<TD>-43<TD>File not found<TR>
<TD>wPrErr<TD>-44<TD>Hardware volume lock<TR>
<TD>fLckdErr<TD>-45<TD>File locked<TR>
<TD>vLckdErr<TD>-46<TD>Software volume lock<TR>
<TD>fBsyErr<TD> -47<TD>File is busy; one or more files are open; directory not empty or working directory control block is open<TR>
<TD>dupFNErr<TD> -48<TD>A file with the specified name and version number already exists<TR>
<TD>opWrErr<TD>-49<TD>File already open for writing<TR>
<TD>paramErr<TD>-50<TD>Parameter error<TR>
<TD>rfNumErr<TD> -51<TD>Reference number specifies nonexistent access path<TR>
<TD>gfpErr<TD> -52<TD>Error during <CODE>GetFPos</CODE><TR>
<TD>volOfflinErr<TD>-53<TD>Volume is offline<TR>
<TD>permErr<TD> -54<TD>Attempt to open locked file for writing<TR>
<TD>nsDrvErr<TD> -56<TD>Specified drive number doesn't match any number in the drive queue<TR>
<TD>wrPermErr<TD>-61<TD>Read/write permission doesn't allow writing<TR>
<TD>dirNFErr<TD>-120<TD>Directory not found or incomplete pathname<TR>
<TD>wrgVolTypErr<TD>-123<TD>Not an HFS volume<TR>
<TD>notAFileErr<TD>-1302<TD>Specified file is a directory<TR>
<TD>diffVolErr<TD>-1303<TD>Files are on different volumes<TR>
<TD>sameFileErr<TD>-1306<TD>Source and destination files are the same<TR>
<TD>afpAccessDenied<TD>-5000<TD>User does not have the correct access to the file<TR>
<TD>afpObjectTypeErr<TD>-5025<TD>Object is a directory, not a file; a directory exists with that name<TR>
<TD>afpSameObjectErr<TD>-5038<TD>Source and destination files are the same</TABLE>
</H2>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-70.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-72.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
