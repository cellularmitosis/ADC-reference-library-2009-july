<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PR14: Dictionary Downloading</title>                                       <meta name="categories" content="Printing"><meta name="week-posted" content="Apr 1, 1991 - Apr 5, 1991"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002635" title="Dictionary Downloading"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PR14</div>
<div id="pageheadsub">Dictionary Downloading</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					 <A HREF="#Section1">Introduction</A><BR><BR>					 <A HREF="#Section2">Caveats</A><BR><BR>					 <A HREF="#Section3">Implementation</A><BR><BR>					 <A HREF="#Section4">Conclusion</A><BR><BR>					  <A HREF="#References">References</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This technical note discusses a method for  downloading PostScript dictionariesautomatically using the LaserWriter driver.  It will also provide the formatand use of the PREC(103) resource.  It will also describe some problems withthe now obsolete PREC(201) resource.  If you are using PostScript dictionaries,or either of these resources, you should definitely read this note.</p> <!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1991]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A> <h2>Introduction</h2><p>Although many picture comments have been added to support the features ofPostScript that are missing from Quickdraw, many developers have still taken tosending PostScript directly from their applications.  As the use and complexityof this PostScript code increases, more and more developers are finding itnecessary to define and use their own PostScript dictionaries.  PostScriptdictionaries are basically collections of variables and procedures that can bepredefined, and accessed later.  They are used to prevent conflicts between thesymbols used by applications and those used by system software (such as theLaserWriter driver's LaserPrep dictionary).  Unfortunately, because of theLaserWriter drivers habit of using the PostScript "save" and "restore"operators, there are problems with keeping a PostScript dictionary defined.PostScript definitions made by code sent with the print job (i.e., sent betweenthe calls to <code>PrOpenPage/PrClosePage</code>) will be lost the first time theLaserWriter driver calls "restore."  There are a couple of solutions to thisproblem, but one that hasn't been documented before involves the use of thePREC(103) resource.  If the LaserWriter driver finds a resource of type PRECwith an ID of 103, it will download the PostScript code to the LaserWriter<b>before</b> performing the initial "save" operation.  This means that anydefinitions made by the PostScript code stored in the PREC(103) resource willremain defined for the duration of the print job, independent of theLaserWriter driver's calls to save and restore.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></P><h2>Caveats</h2><p>The PREC(103) method is a great way to get a dictionary downloaded at printtime.  Unfortunately, this does not solve the problem for using dictionaries inexport files like PICT.  If you insert PostScript code into Quickdraw pictures,the system is not smart enough to record the PREC(103) code into the picture.Instead, you must record the dictionary using the standard PostScript picturecomments (defined in Technical Note #91, <A HREF = "../qd/qd_10.html">Optimizing for theLaserWriter-PicComments</a>).  You should also use the appropriate PostScriptstructuring comments as defined by the <i>Adobe Document StructuringConventions</i>.  If you use the Adobe comments correctly, an application thatis importing your picture will have the option of parsing for the procedure setcomments, and extracting the dictionary definition to be placed in a PREC(103)resource at print time.</p><p>The next caveat concerns the use of multiple PREC(103) resources.  At <code>PrOpenDoc</code>time, the LaserWriter driver makes one <code>GetResource</code> call to load the resource oftype PREC with an ID of 103.  Because the call is a <code>GetResource</code> call (insteadof <code>Get1Resource</code>), the PREC can be stored in any open resource file.  To avoidany conflicts, the resource should be stored in the resource fork of yourapplication, or in the document file that is referencing the PostScriptdictionary.  Because the <code>GetResource</code> call is only made once, only the firstPREC resource found by <code>GetResource</code> will be used.  Any other PREC(103) resourceswill be ignored.  As long is this resource is only used by applications, thereis no problem since there can only be one application active at any particulartime.  If the resource is used by other elements of the system (i.e., deskaccessories, drivers, INITs), you can easily run into the problem of your PRECresource being ignored.  The best solution to this problem is to only use theresource from within an application.</p><p>Since the PREC(103) resource is considered part of the print job, thedefinitions it makes are lost when the job ends (i.e., when the LaserWriterreceives <code>EndOfFile</code> from the Macintosh).  Because of this, the code you place inthe PREC(103) resource should not attempt changing any persistent parameters inthe printer.  The means avoiding the PostScript "exitserver" operator.  Youshould also avoid calling other routines that reset the current state of theprinter (i.e., initclip, initgraphics, etc.).  Use of these operators will have aserious effect on Quickdraw operations that may be present in the print job.</p><p>When the PREC(103) resource was originally introduced, it had a cousin calledPREC(201).  PREC(201) was similar to the PREC(103) resource in that it allowedPostScript to be downloaded to the printer before the actual print job.  Thedifference between the two resources was that the PREC(201) resource downloadedthe PostScript code at the same time that it downloaded the LaserPrepdictionary, outside of the PostScript "server loop."  Because of this, anydefinitions made by the code in the PREC(201) resource would remain after thecurrent job.  Like the LaserPrep dictionary, the dictionary downloaded inPREC(201) would remain until the LaserWriter was rebooted (i.e., powered off thenon again).  Although this feature was useful in some situations, it did haveits problems.  Not the least of which was the valuable printer memory consumedby the dictionary that was downloaded.  Since the dictionary remained after thejob that required it, subsequent jobs had less memory available to them.  Theonly way to reclaim the memory was to reboot the printer, and this was notobvious to naive users.  The other problem was introduced when backgroundprinting became available.  With background printing enabled, the LaserWriterdriver could no longer count on the PREC(201) resource always being available.Since you could no longer store the resource in the LaserWriter driver (becauseof the LaserWriter driver being MultiFinder compatible - see <i>Learning ToDrive</i> for more information), it has to be stored in a separate resourcefile.  This made it virtually impossible for the LaserWriter driver to find theresource when it was required.  For this reason, the PREC(201) resource is onlydownloaded when background printing is turned off.</p><p>Needless to say, we don't recommend the use of features that only work incertain situations, so the PREC(201) resource is now considered unsupported andobsolete.  If you are using the PREC(201) resource, you should be able torevise your application to use the PREC(103) resource instead, with only asmall performance penalty.  On the bright side, the PREC(201) resource willcontinue to be supported in the foreground through the 7.0 version of theLaserWriter driver, and most likely, until the new printing architecturebecomes available, giving you plenty of time to revise....</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></P><h2>Implementation</h2><p>The PREC(103) resource can be implemented by simply creating the resource withResEdit or Rez, and then storing it in an open resource file at print time.  Inthe case of ResEdit, you should create a new resource of type PREC with an IDof 103.  You should then open the new resource using the resource template forstring (<code>'STR '</code>) resources.  You can then type your PostScript code directlyinto the resource.</p><p>If you would rather keep your PREC definition as a Rez source file with therest of your project, you can do this by simply defining the PREC resource typeat the top of the file, followed by an instance of the PREC resource.  Considerthe following Rez source code:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    /* First the resource type definition: */    type 'PREC' {        string;    };    /* Now the real resource definition: */    resource 'PREC' (103) {        &quot;userdict /mydict 50 dict def&quot;;</pre>	</TD></TR></TABLE></CENTER><p>We begin by defining the resource type as being a string.  We then define aninstance of the resource with an ID of 103.  Finally, we define the contents ofthe resource.  The PostScript code above basically defines a dictionary namedmydict within the userdict dictionary.  The mydict dictionary is defined ashaving a maximum of 50 elements.  Consult the PostScript Language ReferenceManual for more information concerning legal operations on dictionaries.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>Conclusion</h2><p>The PREC(103) is a simple, efficient way to download a PostScript dictionary atprint time.  It does not solve the problem of exporting PostScript thatreferences a dictionary into file formats such as PICT, but it can help.Applications can be revised to extract PostScript dictionary definitions fromfiles such as PICT and download them at print time using the PREC(103).  Itshould be noted however that this is not automatic, the application must parsethe picture to get this functionality.  Finally, the PREC(201) resource canonly be supported when background printing is disabled, so it is now consideredobsolete, and use of it is unsupported.</p> <P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P>PostScript Language Reference Manual, Adobe Systems Inc.</p><P>Adobe Document Structuring Conventions, Adobe Systems Inc.</p><P>LaserWriter Reference Manual, Addison-Wesley</p><p>PostScript is a registered trademark of Adobe Systems Incorporated.</p>         <P><A HREF="#top">Back to top</A></P>         <a name=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pr_14.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pr/pr_14.html%3Fid%3DDTS10002635-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pr/pr_14.html%3Fid%3DDTS10002635-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pr/pr_14.html%3Fid%3DDTS10002635-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>