<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>GCC 3 Release Notes: GCC 3 Release Notes for Mac OS X v10.3</title>
	<meta name="Generator" content="Gutenberg"/>
	<meta name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta name = "Copyright" content="Copyright 2009 AppleInc. All Rights Reserved."/>
	<meta name="IndexTitle" content="GCC 3 Release Notes for Mac OS X v10.3"/>
	<meta name="xcode-display" content="render"/>
	<meta id="RESOURCES" content="../../../documentation/Resources" />
	<link rel="stylesheet" type="text/css" href="../../../documentation/Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/pedia.js"></script>
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001007" title="GCC 3 Release Notes for Mac OS X v10.3"></a>
        <a name="top"></a>
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000872" target="_top">Release Notes</a> &gt; <a href="../index.html#//apple_ref/doc/uid/TP30000872-TP30000436" target="_top">Tools</a> &gt; <a href="../idxCompilersDebuggers-date.html#//apple_ref/doc/uid/TP30000872-TP30000436-TP30001025">Compiling &amp; Debugging</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
                
        
        <a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_21" title="GCC 3 Release Notes for Mac OS X v10.3"></a><h1>GCC 3 Release Notes for Mac OS X v10.3</h1><div class="importantbox"><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_22" title="Important:"></a><p><strong>Important:</strong>&nbsp;In Xcode 2.1 and higher, the gcc 3.3 compiler does not support generating code for x86.</p><p></p></div><p>These notes describe Apple's GCC 3.3, which is based on version 3.3 of the Free Software Foundation's GNU Compiler Collection. GCC 3.3 will be the default compiler on Mac OS X for C, C++, Objective-C, and Objective-C++ source code after this package is installed. GCC 3.1, which was the default compiler in the Mac OS X 10.2 Development Tools, continues to be provided for backward compatibility. GCC 2.95 is also still provided for backward compatibility.</p><p>The actual FSF GCC versions that each compiler in this release is based on are:</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><td  scope="row"><p>gcc2</p></td><td ><p>2.95.2 final release</p></td></tr><tr><td  scope="row"><p>gcc3</p></td><td ><p>3.1 prerelease snapshot dated 2002-10-03</p></td></tr><tr><td  scope="row"><p>gcc-3.3</p></td><td ><p>3.3 prerelease snapshot dated 2003-03-04</p></td></tr></table></div>
<!-- This template is being used for both PDF and HTML. -->
<!-- TopicBook.pm currently relies on the element name bmini_toc. -->

    <h4>Contents:</h4>
    
    <p class="blockquote">

        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_1" target="_top">Switching to GCC 3.3</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_4" target="_top">Documentation</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_5" target="_top">Compiler option compatibility issues</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_6" target="_top">Source code compatibility issues</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_7" target="_top">Precompiled headers</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_8" target="_top">New language features</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_13" target="_top">Compilation speed</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_14" target="_top">Symbol Separation</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_15" target="_top">Major bugs fixed in this release</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_16" target="_top">Optimization</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_19" target="_top">How to build the compiler from source</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40001007-DontLinkElementID_20" target="_top">Ways in which Apple GCC 3.3 differs from gcc on other platforms</a>
                
            <br/>
            
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_1" title="Switching to GCC 3.3"></a><h2>Switching to GCC 3.3</h2><p>The Xcode Tools package provides three compilers: GCC 2, based on version 2.95 of the Free Software Foundation's GCC compiler suite, GCC 3 (also called GCC 3.1), based on version 3.1 of the Free Software Foundation's GCC compiler suite, and GCC 3.3, which is based on version 3.3 of the Free Software Foundation's GCC compiler suite.</p><p>Here are some important things to keep in mind before you switch from GCC 2 or GCC 3.1 to GCC 3.3:</p><ul class="ul"><li class="li"><p>Recompile all your C++ and Objective-C++ code, including all libraries and frameworks that export a C++ interface. The application binary interface (ABI) for C++ programs changed between GCC 2 and GCC 3.1, and again between GCC 3.1 and GCC 3.3. The changes between GCC 2 and GCC 3.1 were comprehensive, including changes to name mangling, exception handling, and class layout and alignment. The changes between 3.1 and 3.3 are much smaller, but are still large enough to prevent a mixed C++ program from operating correctly. Do not link C++ modules compiled with one of these compilers against modules compiled with any of the other two compilers. Even if the modules appear to link correctly, C++ ABI differences may still cause problems that will not manifest themselves until run time.</p></li><li class="li"><p>You do not need to recompile C or Objective-C code. The C and Objective-C ABI has not changed.</p></li><li class="li"><p>Do not ignore warnings. GCC 3.3 enforces the C and C++ standards much more strictly. New warnings may point out errors that GCC 2 or GCC 3.1 overlooked.</p></li><li class="li"><p>Test your code. Even if the compiler doesn't raise any errors or warnings, your code may rely on idiosyncrasies in GCC 2 or GCC 3.1 that GCC 3.3 handles differently.</p></li><li class="li"><p>If you're creating kernel extensions that must run on Mac OS X 10.1 and earlier, you must use GCC 2. If the extensions will run only on Mac OS X 10.2 and later, you should use GCC 3.1 or GCC 3.3.</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_2" title="Switching between compilers"></a><h3>Switching between compilers</h3><p>All three compilers may coexist on the same system. GCC 3.3 is always available as /usr/bin/gcc-3.3, GCC 3.1 is always available as /usr/bin/gcc-3.1 and /usr/bin/gcc3, and GCC 2 is always available as /usr/bin/gcc2. In addition, there are symbolic links at /usr/bin/cc and /usr/bin/gcc that point to the selected compiler. By default, the selected compiler is GCC 3.3.</p><p>However, if you have a lot of make files and shell scripts that refer to /usr/bin/cc or /usr/bin/gcc, changing all those references to your compiler of choice may be impractical. In that case, use the gcc_select command to change the selected compiler.</p><p>To use GCC 2 as the selected compiler:</p><ul class="spaceabove"><li class="li"><p>Open the Terminal, and enter <code>sudo /usr/sbin/gcc_select 2</code>. If you're asked, enter your password.</p></li><li class="li"><p>This command line logs in as root, makes the neccesary changes, and leaves you logged in under your original account. When it's done, /usr/bin/cc and /usr/bin/gcc use GCC 2.</p></li></ul><p>To use GCC 3.1 as the selected compiler:</p><ul class="spaceabove"><li class="li"><p>Open the Terminal, and enter <code>sudo /usr/sbin/gcc_select 3.1</code> or <code>sudo /usr/sbin/gcc_select 3</code>. If you're asked, enter your password.</p></li><li class="li"><p>This command line logs in as root, makes the neccesary changes, and leaves you logged in under your original account. When it's done, /usr/bin/cc and /usr/bin/gcc use GCC 3.1.</p></li></ul><p>To use GCC 3.3 as the selected compiler:</p><ul class="spaceabove"><li class="li"><p>Open the Terminal, and enter <code>sudo /usr/sbin/gcc_select 3.3</code>. If you're asked, enter your password.</p></li><li class="li"><p>This command line logs in as root, makes the neccesary changes, and leaves you logged in under your original account. When it's done, /usr/bin/cc and /usr/bin/gcc use GCC 3.3.</p></li></ul><p>To see which compiler version you are using, enter <code>gcc -v</code>. For more help on gcc_select, enter <code>/usr/sbin/gcc_select -h</code>.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_3" title="Switching between compilers in Xcode"></a><h3>Switching between compilers in Xcode</h3><p>To set the compiler for your target for a classic (Jambase) target, double-click on the target in the project window to open it in an editor. Choose Settings -> Simple View -> GCC Compiler Settings. Select the compiler with which you wish to build the target using the <strong>Compiler version</strong> popup.</p><p>To set the compiler for your target for a native target, bring up the inspector for the target. Select the <strong>Build Rules</strong> tab. If the compiler shown in the System C Rule is not the desired compiler, then add a new build rule by clicking on the + button. Configure your new build rule to process "C source files" using the desired version of GCC. If you wish to revert to using the system compiler, you can delete the build rule.  </p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_4" title="Documentation"></a><h2>Documentation</h2><p>Documentation for the 3.3 compiler is available in <em><a href="../../../documentation/DeveloperTools/gcc-3.3/gcc/index.html#//apple_ref/doc/uid/TP40001011" target="_top">GNU C/C++/Objective-C 3.3 Compiler</a></em>.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_5" title="Compiler option compatibility issues"></a><h2>Compiler option compatibility issues</h2><ul class="ul"><li class="li"><p>The compiler now checks that an option is valid for the current language, and warns if an invalid option is passed. For instance, <code>-frtti</code>, an option that only makes sense for C++, is no longer silently accepted by the C compiler.</p></li><li class="li"><p>The <code>-traditional-cpp</code> option has changed. In Apple GCC 3.1 and earlier Apple GCC compilers, <code>-traditional-cpp</code> was used to toggle between the standard GNU GCC preprocessor and Apple's own preprocessor, "cpp-precomp". The GNU GCC compiler interpreted <code>-traditional-cpp</code> differently on all other platforms. Since cpp-precomp has been removed for Apple's GCC 3.3 compiler, the standard GNU meaning of <code>-traditional-cpp</code> has been restored. By default, the GCC 3.3 preprocessor conforms to the ISO C standard. Using the <code>-tradtional-cpp</code> option means the C preprocessor should instead try to emulate the old "K&amp;R C".</p></li><li class="li"><p>The <code>-nostdinc</code> option directs the compiler not to search for header files in the standard system directories. In previous compiler releases the implementation of this option was incomplete, and the compiler would still search for header files in standard umbrella frameworks. This bug has been fixed in the GCC 3.3 compiler: <code>-nostdinc</code> now removes all standard directories from the header search path, as it is supposed to.</p></li><li class="li"><p>The Apple build number is now output with the <code>--version</code> option, and the format of the <code>-v</code> output has changed. The <code>--version</code> output is intended to be machine-parseable.</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_6" title="Source code compatibility issues"></a><h2>Source code compatibility issues</h2><p>Some source code will need to be changed when moving to GCC 3.3 because the new compiler adheres more closely to the rules of the relevant language standards. Here are some specific areas where you may notice a difference:</p><ul class="ul"><li class="li"><p>The C++ Standard permits in-class initialization of static const member variables of integer types. Previous versions of the GCC compiler were more lax than that, and also allowed in-class initialization of static const member variables of pointer types. GCC 3.3 no longer permits this. This fix is simply to move the initialization to the member variable's definition.</p></li><li class="li"><p>Taking the address of a cast, as in "&amp;(int)p" is illegal, in both C and C++. The C compiler has always enforced this rule, but the C++ compiler used to permit taking the address of a cast. This bug has now been fixed. If you have code that takes the address of casts, it will have to be fixed. The fix is simply to take the address and then cast the resulting pointer.</p></li><li class="li"><p>As required by the C++ standard, the C++ compiler now issues a warning when the <code>offsetof</code> macro is applied to a non-POD type. The <code>-Wno-invalid-offsetof</code> compiler flag can be used to suppress this warning.</p></li><li class="li"><p>In C++, the ordinary template name lookup rules now apply to names from a base class template that are referred to from a derived class template: that is, they must explicitly be written as dependent names. If a class template <code>D&lt;T></code> inherits from another class template <code>B&lt;T></code> then, to access names from <code>B&lt;></code> from within <code>D&lt;></code>, you should write "<code>B&lt;T>::x</code>" instead of just "<code>x</code>". An alternative solution is for the derived class template <code>D</code> to include using-declarations of names that it needs to access from <code>B</code>.</p></li><li class="li"><p>GCC 3.3 now supports hexadecimal floating-point numbers, as defined in the C99 Standard. There are rare constructs that may have to be changed as a result of this new feature: for example, GCC 3.1 interpreted the expression "0x5e-0x03" as a subtraction of two integer constants, and GCC 3.3 rejects it as a malformed hexadecimal floating point constant. The simplest fix is to put spaces around the minus sign.</p></li><li class="li"><p>The GCC 3.3 preprocessor inserts a new pragma, <code>#pragma GCC set_debug_pwd</code>, as part of the new Distributed Builds feature. (See below.) This may surprise tools and scripts that depended on the exact form of preprocessed output from GCC. These scripts should be rewritten to ignore unrecognized pragmas.</p></li><li class="li"><p>GCC 3.3 warns about nested comments when <code>-Wall</code> is turned on.</p></li><li class="li"><p>The GCC 3.3 preprocessor does not support the use of token pasting to create new invalid tokens.</p></li><li class="li"><p>GCC 3.3 enforces #import and #include semantics strictly compared to cpp-precomp.</p></li><li class="li"><p>Because of the removal of cpp-precomp, the GCC 3.3 preprocessor is stricter and more standards compliant than cpp-precomp was. (Similar to the preprocessor used in 3.1 when using the <code>-no-cpp-precomp</code> flag.)</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_7" title="Precompiled headers"></a><h2>Precompiled headers</h2><p>Apple's 3.3 compilers support a new form of precompiled headers. The new form is available from Xcode; refer to the Xcode documentation for more information. If you're using some other build system, such as make, see the “3.20 Using Precompiled Headers” section of <em><a href="../../../documentation/DeveloperTools/gcc-3.3/gcc/index.html#//apple_ref/doc/uid/TP40001011" target="_top">GNU C/C++/Objective-C 3.3 Compiler</a></em> for information on specific compiler options. </p><p>cpp-precomp is no longer supported in the GCC 3.3 compiler. GCC 3.3 ignores cpp-precomp specific options.</p><p>GCC 3.1's form of precompiled headers, "PFE", is no longer supported in GCC 3.3; use the new form instead.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_8" title="New language features"></a><h2>New language features</h2><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_9" title="STL debugging mode for C++"></a><h3>STL debugging mode for C++</h3><p>By default, libstdc++ is built with efficiency in mind, and therefore performs little or no error checking that is not required by the C++ standard. This release adds support for the <strong>libstdc++ debug mode</strong>, which performs run-time checking for correct usage of the C++ standard library. Incorrect usage (such as passing an iterator to the wrong container, or passing an invalid range to a generic algorithm) will result in a clear error message followed by an abort, rather than an unpredictable crash.</p><p>To enable STL debugging mode, compile your application with the <code>-D_GLIBCXX_DEBUG</code> compile flag. Note that this flag changes the sizes and behavior of standard class templates such as <code>std::vector</code>, and therefore you can only link code compiled with debug mode and code compiled without debug mode if no instantiation of a container is passed between the two translation units. This does not mean that you are required to recompile your entire application: for instance, if one source file uses <code>std::vector</code> but <code>std::vector</code> doesn't occur in its public interface, that file can be recompiled in debug mode even if the rest of the program is not compiled in debug mode.</p><p>When it is not feasible to recompile your application, or when only specific containers need checking, debugging containers are available as GNU extensions. These debugging containers are functionally equivalent to the containers used in debug mode, e.g., <code>__gnu_debug::vector&lt;int></code> is equivalent to <code>std::vector&lt;int></code> in debug mode, but the <code>__gnu_debug</code> versions can be used in either release or debug mode without changing semantics.</p><p>Pedantic debug mode checks not only for errors, but also for usages that rely on GNU extensions and that, while correct, may not be portable to other compilers. In pedantic mode, for example, constructing an <code>std::string</code> with a null pointer will result in an abort, not an exception. Pedantic debug mode is not the default. To enable pedantic debug mode, compile your program with both <code>-D_GLIBCXX_DEBUG</code> and <code>-D_GLIBCXX_DEBUG_PEDANTIC</code>.</p><p>STL debugging mode is recommended during developent or when you suspect an error caused by incorrect use of the C++ standard library. It is not recommended for deployment builds, because it introduces substantial overhead.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_10" title="Wide character support"></a><h3>Wide character support</h3><p>Mac OS X 10.3 adds support for the <code>wchar_t</code> data type and for the library functions that manipulate wide strings, as required by the ISO C99 standard. On Mac OS X 10.3, GCC 3.3 adds support for wide character manipulation in C++. For example, <code>std::wstring</code> is now enabled.</p><p>Note that wide character support is unavailable on previous releases of Mac OS X. Programs that are intended to be run on previous versions of Mac OS X should avoid <code>wchar_t</code> and <code>wstring</code>.</p><p>Wide character support is provided for compliance with the ISO C and C++ standards, and for ease of porting applications from other operating systems. New Mac OS X applications should instead use Apple's Unicode APIs, such as CFString and NSString.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_11" title="ObjC/ObjC++ exception and synchronization support"></a><h3>ObjC/ObjC++ exception and synchronization support</h3><p>The Objective-C language now offers syntactic support for structured exception handling that is similar to what is offered by C++ and Java. To enable the new syntax, you must pass the '-fobjc-exceptions' options to the ObjC/ObjC++ compiler, and/or set the MACOSX_DEPLOYMENT_TARGET environment variable to "10.3".</p><div class="codesample"><table><tr><td scope="row"><pre>    @try {<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>         @throw expr;<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    @catch (AnObjCClass *exc) {<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>        @throw expr;<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>        @throw;<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    @catch (AnotherClass *exc) {<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    @catch (id allOthers) {<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    @finally {<span></span></pre></td></tr><tr><td scope="row"><pre>      ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>The @throw statement may appear anywhere in an Objective-C program; when used inside of a @catch block, the @throw may appear without an argument (as show above), in which case the object caught by the @catch will be rethrown.</p><p>Note that only (pointers to) Objective-C objects may be thrown and caught using this scheme. When an object is thrown, it will be caught by the nearest @catch clause capable of handling objects of that type, just as is the case in C++ and Java. A @catch(id) clause (as shown above) may also be provided to catch any and all Objective-C exceptions not caught by previous @catch clauses.</p><p>The @finally clause, if present, will be executed upon exit from the immediately preceding @try-@catch section. This will happen regardless of whether any exceptions are thrown, caught or rethrown inside the @try-@catch section, just as is the case in Java.</p><p>There are several caveats to using the new exception mechanism:</p><ul class="spaceabove"><li class="li"><p>Although currently designed to be binary compatible with NS_HANDLER-style idioms provided by the NSException class, the new exceptions can only be used on Mac OS X 10.3 (Panther) and later systems, due to additional functionality needed in the Objective-C runtime.</p></li><li class="li"><p>As mentioned above, the new exceptions do not support handling types other than Objective-C objects. The Objective-C exception model does not interoperate with C++ exceptions at this time. This means you cannot throw an exception from Objective-C and catch it from C++, or vice versa.</p></li></ul><p>The <code>-fobjc-exceptions</code> switch also enables the use of synchronization blocks for thread-safe execution:</p><div class="codesample"><table><tr><td scope="row"><pre>   ObjCClass *lockObject = ...;<span></span></pre></td></tr><tr><td scope="row"><pre>   ...<span></span></pre></td></tr><tr><td scope="row"><pre>   @synchronized (lockObject) {<span></span></pre></td></tr><tr><td scope="row"><pre>     ...<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr></table></div><p>Unlike Java, Objective-C does not allow for entire methods to be marked @synchronized. Note that throwing exceptions out of @synchronized blocks is allowed, and will cause the guarding object to be unlocked properly.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_12" title="Inline Assembly"></a><h3>Inline Assembly</h3><p>In addition to the traditional GCC syntax for inline assembly, Apple GCC 3.3 now supports inline assembly using syntax as in CodeWarrior, which allows you to write assembly instructions in function bodies the same way as you do for assembly source files. Both asm functions and asm blocks within functions are available. This feature is not turned on by default; use -fasm-blocks to enable.</p><p>In general, the syntax and capabilities are exactly the same as what is documented for CodeWarrior, and so the assembly code can refer to variables and local parameters, use structure fields for offsets, and so forth. (The Apple GCC manual includes a short section describing the basics of the syntax.) However, the implementation is new, and some bugs did not get fixed in time for this release.</p><ol class="ol"><li class="li"><p>Function names cannot be referenced in the block; they will be interpreted as (undefined) labels, resulting in an error. There is no workaround.</p></li><li class="li"><p>Macros whose expansions include one or more instruction opcodes will result in syntax errors. For instance,</p><div class="codesample"><table><tr><td scope="row"><pre>#define INSN_SEQ(X,Y) \<span></span></pre></td></tr><tr><td scope="row"><pre>  mr r9,X \<span></span></pre></td></tr><tr><td scope="row"><pre>  mr Y,r9<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>asm void fn() {<span></span></pre></td></tr><tr><td scope="row"><pre>  INSN_SEQ(r3,r4)<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>should work, but fails. This is a side-effect of the preprocessor being integrated in 3.3; a slow but reliable workaround is to use -save-temps. Beware that -save-temps will leave preprocessor output and assembly files behind, and you will need to clean those up manually.</p></li></ol><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_13" title="Compilation speed"></a><h2>Compilation speed</h2><p>Compilation speed in GCC 3.3 is significantly faster than it was in GCC 3.1, particularly for C++ projects that use precompiled headers. In addition to the general speedup, there are several special features that are related to compilation speed.</p><p>The following features are available from Xcode:</p><ul class="ul"><li class="li"><p>The <strong>Distributed Build</strong> feature makes it possible to farm a project build to several different machines.</p></li><li class="li"><p><strong>ZeroLink</strong> makes it possible to avoid static link during a development build. This feature is particularly useful for builds where only a small number of files change.</p></li><li class="li"><p><strong>Fix and Continue</strong> enables some changes (particularly changes within a function body) while a program is still running.</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_14" title="Symbol Separation"></a><h2>Symbol Separation</h2><p><strong>Symbol Separation</strong> is not yet available from Xcode, but it is available by explictly providing command-line options to the compiler.</p><p>If your project contains large headers that are included in many different source files, Symbol Separation makes it possible to put the debug symbols from those headers in a separate repository. The compiler can thus save disk space and I/O time, because it no longer has to put the debug symbols into every object file where the headers are included. Symbols repositories are themselves normal object files, and can be supplied to the linker so that the debug information is included in the final executable.</p><p>To create the symbol repository for a header file foo.h, use the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>    gcc-3.3 &lt;other flags> -fsave-repository=<em>cinfo_dir_name</em> foo.h<span></span></pre></td></tr></table></div><p>This command will create two files:</p><ul class="ul"><li class="li"><p><code>foo.cinfo</code> in the <em>cinfo_dir_name</em> directory.</p></li><li class="li"><p>An output file, which by default is foo.h.o in the current folder. As usual, the name and location can be changed from the default by explicitly using the <code>-o</code> compiler flag.</p></li></ul><p>To use the repository in subsequent compilations, you must provide the <code>-grepository</code> command line option. The compiler will then search for <code>.cinfo</code> files in all include paths.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_15" title="Major bugs fixed in this release"></a><h2>Major bugs fixed in this release</h2><ul class="ul"><li class="li"><p>Type checking has been fixed and improved in many situations involving Objective-C message dispatching and protocol lookup.</p></li><li class="li"><p>Type checking has been fixed and improved in many situations involving Objective-C protocols.</p></li><li class="li"><p>In Objective-C when -Wselector is used, check the whole list of selectors at the end of compilation, and emit a warning if a @selector() is not known.</p></li><li class="li"><p>In C++, a number of bugs involving static member variables of class templates have been fixed.</p></li><li class="li"><p>An bug in the C++ I/O library, which involved EOF being signaled incorrectly and sometimes required multiple carriage returns in interactive input, has been fixed. (Radar 3027668, 3043108, 3057353, 3057473, 3066494, 3068598 and many other duplicates.)</p></li><li class="li"><p>A C++ front end bug, which caused an internal compiler error for some template friend declarations where the friend class template was defined in a namespace, has been fixed. (Radar 3081259)</p></li><li class="li"><p>The Altivec type vector <code>bool</code> is now being treated correctly as a distinct type. In previous compiler versions it was being treated incorrectly as a synonym for unsigned.</p></li><li class="li"><p>The printf formatting macros for <code>int32_t</code> and <code>uint32_t</code> in <code>&lt;inttypes.h></code> have been fixed.</p></li><li class="li"><p>An bug in tail recursion optimization, which sometimes caused incorrect code generation at -O2 and above, has been fixed. (Radar 3109864)</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_16" title="Optimization"></a><h2>Optimization</h2><p>GCC 3.3 has greatly improved code optimization, especially for Altivec code. If you've turned off optimization before, particularly if you are switching from GCC2, it's recommended that you turn it on now. Many bugs and inefficiencies have been fixed.</p><p>Xcode automatically chooses the recommended optimization level for you. Just be sure to build with the pbxbuild tool or to choose the Deployment build style before building your final product.</p><p>For deployment builds, the recommended setting is -Os, which produces the smallest possible binary size. Generally, a binary that's smaller is also faster. That's because a large application spends much of its time paging its binary code in and out of memory. The smaller the binary, the less the application needs to page. For example, say a binary uses aggressive function inlining. That binary saves time with fewer function calls, but it could easily spend far more time paging the binary code containing those inlined functions in and out of memory.</p><p>For debugging versions, the recommended optimization level is -O0.</p><p>Here are the different levels for C, C++, Objective-C and Objective-C++:</p><ul class="ul"><li class="li"><p>No optimization (-O0). This option level is intended for debugging; it ensures that the debugger works as you would expect.</p></li><li class="li"><p>Simple optimizations (-O) performs simple optimizations, including automatic register allocation and jump threading. This optimization level makes a trade-off between compile speed and execution speed.</p></li><li class="li"><p>More optimizations (-O2)performs all of GCC's optimizations that don't involve a space-time trade-off. In addition to all the optimizations for level 1, it performs common subexpression elimination, strength reduction, and loop optimizations. It also considers any function declared with the inline keyword for inlining.</p></li><li class="li"><p>Optimization for speed (-O3) performs still more optimizations. It can be best for code that contains lots of loops and computation. In addition to all the optimizations for level 2, it considers all functions for inlining, even if they aren't declared with the inline keyword.</p></li><li class="li"><p>Optimization for code size (-Os) produces the smallest binary size. It performs no loop unrolling, scheduling optimizations, or register renaming. The performance is similar to -O2.</p></li><li class="li"><p><code>-fast</code>: see below.</p></li></ul><p>When performing function inlining, GCC 3 inlines forward-referenced functions in addition to the functions it inlined before. A function is inlined if it's smaller than the inlining limit. The default limit is 600 internal GCC instructions. To raise the limit, add -finline-limit=number to the command line. Raising this limit too high can slow down compiling, increase the size of your executables with too much inlining, and lower execution speed.</p><p>Here are some interesting optimizations that aren't included by -O2 or -O3:</p><dl class="termdef">	<dt><code>-faltivec</code></dt><dd><p>Optimizes code for Altivec. Code built with this flag might not run on G3 processors.</p></dd><dt><code>-mtune=G3 -mtune=G4 -mtune=G5</code></dt><dd><p>Optimizes for speed on the indicated chip. The default is close to G4, but produces slightly smaller and slower code. Code built with these flags will still run on any processor; if you only want code that runs on one processor, you may use <code>-mcpu=G4</code> and similar.</p><p>When <code>-mtune=G5</code> is used in conjunction with -O3, the following alignment flags should also be enabled for optimum performance:</p><ul class="simple_termdef"><li class="simple_termdef"><p><code>-falign-loops-max-skip=32</code></p></li><li class="simple_termdef"><p><code>-falign-jumps-max-skip=32</code></p></li><li class="simple_termdef"><p><code>-falign-loops=16</code></p></li><li class="simple_termdef"><p><code>-falign-jumps=16</code></p></li><li class="simple_termdef"><p><code>-falign-functions=32</code></p></li></ul></dd><dt><code>-mdynamic-no-pic</code></dt><dd><p>Produces better code for references to static and global data. Generally, you should use this option when building an executable. Do not use it when building shared libraries or plug-ins because the produced code is not valid for them.</p></dd><dt><code>-funroll-loops</code></dt><dd><p>Unrolls loops. Unrolling makes the code larger, but may make it faster by reducing the number of branches executed.</p></dd><dt><code>-ffast-math</code></dt><dd><p>Enables some floating point optimizations that are not IEEE754-compliant, but which usually work. Programs which require strict IEEE compliance may not work with this option.</p></dd><dt><code>-fstrict-aliasing</code></dt><dd><p>Optimize code by making more aggressive assumptions about whether pointers can point to the same objects as other pointers. Programs which use pointers a lot may benefit from this, but programs that don't strictly follow the ISO C rules about the type with which an object may be accessed may behave unexpectedly.</p></dd></dl><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_17" title="Optimization using the new -fast flag"></a><h3>Optimization using the new -fast flag</h3><p>-fast changes the overall optimization strategy of GCC 3.3 in order to produce the fastest possible running code for G4 and G5 architectures. Optimizations under -fast are roughly grouped under the following categories.</p><ol class="ol"><li class="li"><p><code>-fast</code> sets the optimization level to -O3, the highest level of optimization supported by GCC 3.3. If any other optimization level (<code>-O0</code>, <code>-O1</code>, <code>-O2</code> or <code>-Os</code>) is specified, it is ignored by the compiler.</p></li><li class="li"><p>Alignment. Assume alignments for loops, functions, branches and structure data fields that provide fastest performance on the PowerPC. <code>-fast</code> sets the following alignment-specific options:</p><ul class="simple-spaceabove"><li><p><code>-falign-loops-max-skip=15</code></p></li><li><p><code>-falign-jumps-max-skip=15</code></p></li><li><p><code>-falign-loops=16</code></p></li><li><p><code>-falign-jumps=16</code></p></li><li><p><code>-falign-functions=16</code></p></li><li><p><code>-malign-natural</code></p></li></ul></li><li class="li"><p><code>-fast</code> enables the <code>-ffast-math</code> option, which allows certain unsafe math operations for performance gains.</p></li><li class="li"><p>Strict aliasing rules. -fast allows the compiler to assume the strictest aliasing rules applicable to the language being compiled. For C and C++, this activates optimizations based on the type of expressions: an object of one type is assumed never to reside at the same address as an object of a different type, unless the types are almost the same. Furthermore, struct field references are assumed not to alias each other as long as their direct and indirect enclosing structure types are distinct. -fast enables the following aliasing options:</p><ul class="simple-spaceabove"><li><p><code>-frelax-aliasing</code></p></li><li><p><code>-fgcse-mem-alias</code></p></li></ul><p>Warning: the behavior of standard-conforming programs will not be affected by strict aliasing, but programs that make use of nonstandard type conversions may behave in unexpected ways.</p></li><li class="li"><p><code>-fast</code> enables various performance-related code transformations. These include loop unrolling, transposing nested loops to improve locality of array element access, conversion of certain initialization loops to memset calls, and inline expansion of calls to library functions such as floor. <code>-fast</code> enables the following code transformation options:</p><ul class="simple-spaceabove"><li><p><code>-funroll-loops</code></p></li><li><p><code>-floop-transpose</code></p></li><li><p><code>-floop-to-memset</code></p></li><li><p><code>-finline-floor</code>  (G5 only)</p></li></ul><p>Some of these transformations increase code size.</p></li><li class="li"><p>G5 specific instruction generation. With -fast (unless <code>-mcpu=G4</code> is specified), GCC 3.3 generates instructions which are specific to G5 and result in performance gain for G5. The following options are assumed for G5 under <code>-fast</code>:</p><ul class="simple-spaceabove"><li><p><code>-mcpu=G5</code></p></li><li><p><code>-mpowerpc64</code></p></li><li><p><code>-mpowerpc-gpopt</code></p></li></ul></li><li class="li"><p>Scheduling changes. <code>-fast</code> option allows inter-block scheduling, and scheduling specific to the G5 architecture. One such scheduling change is load after a store that partially loads what was stored. The following scheduling-related options are enabled by <code>-fast</code>:</p><ul class="simple-spaceabove"><li><p><code>-mtune=G5</code>  (unless <code>-mtune=G4</code> is specified)</p></li><li><p><code>-fsched-interblock</code></p></li><li><p><code>-fload-after-store</code></p></li><li><p><code>--param max-gcse-passes=3</code></p></li><li><p><code>-fno-gcse-sm</code></p></li><li><p><code>-fgcse-loop-depth</code></p></li></ul></li><li class="li"><p><code>-fast</code> enables intermodule inlining when all source files are placed on the same command line. The following options are set by <code>-fast</code> and affect such inlining:</p><ul class="simple-spaceabove"><li><p>-funit-at-a-time</p></li><li><p>-fcallgraph-inlining</p></li><li><p>-fdisable-typechecking-for-spec</p></li></ul></li><li class="li"><p><code>-fast</code> sets <code>-mdynamic-no-pic</code> by default. This allows for generation of non-relocatable code and is not suitable for shared libraries. This option may be overridden by <code>-fPIC</code>.</p></li></ol><p>Users of <code>-fast</code> should be aware of the following caveats:</p><ul class="spaceabove"><li class="li"><p>Because <code>-fast</code> enables highly aggressive optimizations, some of which may have an effect on code size or on program behavior, thorough testing is especially important before deploying applications compiled with <code>-fast</code>.</p></li><li class="li"><p>For maximum run-time performance you should experiment with a variety of optimization options; no one set of flags is best for all applications.</p></li><li class="li"><p>In future releases of GCC, -fast may enable a different set of optimization options. The intention behind this option is that -fast will enable optimizations that result in the fastest code for most applications.</p></li><li class="li"><p>The <code>-malign-natural</code> option incorporated in <code>-fast</code> results in non-ABI-conforming code, which can cause problems when mixing code compiled with and without <code>-fast</code>. In particular, some of the functions in the C++ I/O libraries do not currently work properly on MacOSX 10.3 when linked with code compiled <code>-fast</code>. Use <code>-fastf</code> (below) for C++ on MacOSX 10.3.</p></li></ul><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_18" title="Optimization using the new -fastf flag"></a><h3>Optimization using the new -fastf flag</h3><p><code>-fastf</code> is just like <code>-fast</code> (above), except that it does not set <code>-malign-natural</code>. This is useful for cases where the ABI incompatibilities introduced by <code>-malign-natural</code> cause problems. In particular, C++ on MacOSX 10.3 should use <code>-fastf</code> rather than <code>-fast</code>.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_19" title="How to build the compiler from source"></a><h2>How to build the compiler from source</h2><p>The source code for the Apple GCC 3.3 compiler is available for download using anonymous CVS from <code>:pserver:anonymous@anoncvs.opensource.apple.com:/cvs/root</code> using password <code>anonymous</code> and module <code>gcc3</code>. See the “Source Code” section of <em><a href="../../../documentation/DeveloperTools/gcc-3.3/gcc/index.html#//apple_ref/doc/uid/TP40001011" target="_top">GNU C/C++/Objective-C 3.3 Compiler</a></em> for more information about how to obtain specific compiler versions using CVS. The opensource.apple.com repository may also contain compilers that are more up-to-date (and less stable) than the compiler in this release.</p><p>The file <code>README.Apple</code>, in the top level source directory, explains how to build the compiler.</p><a name="//apple_ref/doc/uid/TP40001007-DontLinkElementID_20" title="Ways in which Apple GCC 3.3 differs from gcc on other platforms"></a><h2>Ways in which Apple GCC 3.3 differs from gcc on other platforms</h2><ul class="ul"><li class="li"><p>Xcode Tools uses STABS as its debugging format, and does not support DWARF.</p></li><li class="li"><p>Apple GCC 3.3 generates optimized STABS by default. That is, it emits debug symbols only for symbols that are actually used. The "generic" FSF GCC emits debug information for all symbols, regardless of whether they are used. The <code>-gfull</code> command line option directs the Apple GCC compiler to turn off STABS optimization and to emit debug information for all symbols, as the FSF GCC compiler does.</p></li><li class="li"><p>Apple GCC 3.3 removes empty BINCL/EINCL STABS. This is helpful in improving GDB startup time. This optimization will be available in FSF GCC 3.4.</p></li><li class="li"><p>Apple GCC's implementation of Altivec uses the older Motorola syntax, as described in the Altivec PIM. The newer GNU syntax is not yet supported. (Programs using the GNU syntax may compile without messages, yet produce unexpected results at runtime.)</p></li><li class="li"><p>Apple's version of GCC 3.3 supports precompiled headers (PCH). In the "generic" FSF GCC, precompiled headers will not appear until version 3.4.</p></li><li class="li"><p>Apple's version of GCC 3.3 supports Objective-C++. In addition, Apple's Objective-C implementation contains numerous fixes and improvements, most notably exception and synchronization support (see above).</p></li><li class="li"><p>Apple's version of libstdc++ supports STL debugging mode (see above). This feature is not yet present in the FSF version.</p></li><li class="li"><p>The -fast option is specific to Apple's version of GCC 3.3. Some of the optimizations controlled by <code>-fast</code> are not yet present in the FSF version of GCC.</p></li></ul>

        <br/><br/> 
        
        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2006 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2006-05-23<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/releasenotes/DeveloperTools/RN-GCC3/index.html%3Fid%3DTP40001007-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/releasenotes/DeveloperTools/RN-GCC3/index.html%3Fid%3DTP40001007-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/releasenotes/DeveloperTools/RN-GCC3/index.html%3Fid%3DTP40001007-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
</body>
</html>