<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Image Kit Programming Guide: Browsing Images</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Browsing Images"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004907-CH5" title="Browsing Images"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000424" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../../../Quartz-date.html#//apple_ref/doc/uid/TP30000440-TP30000424-TP30000559" target="_top">Quartz</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004907-CH1-SW1">Image Kit Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ImageViews/ImageViews.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Slideshows/Sildeshows.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004907-CH5-SW1" title="Browsing Images"></a><h1>Browsing Images</h1><p>Applications such as iPhoto provide a rich user experience for viewing digital image collections. By using the <code><a href="../../../Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> class and its related protocols—<code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code>, <code><!--a target="_top" -->IKImageBrowserDelegate<!--/a--></code>, and <code><!--a target="_top" -->IKImageBrowserItem<!--/a--></code>—any application can support browsing large numbers of images efficiently.</p><p>This chapter describes the user interface provided by the <code><a href="../../../Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> class, discusses the related protocols, lists the image representation types that the browser can display, and includes step-by-step instructions for creating an application that uses the image browser.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW11">The Image Browser User Interface</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW12">The Requirements of an Image Browser Application</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW5">Displaying Images in an Image Browser</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW6">Supporting Zoom</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW7">Supporting Removing and Reordering Items</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW8">Supporting Drag and Drop</a>
				
			<br/>
			
        
			
			
				<a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW9">Setting Browser and Cell Appearance</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004907-CH5-SW11" title="The Image Browser User Interface"></a><h2>The Image Browser User Interface</h2><p>The <code><a href="../../../Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> class provides a view that displays an array of images. The size of each image depends on the zoom value that you set for the image browser view. Typically, an application provides a control, such as the slider shown in <span class="content_text">Figure 3-1</span>, that allows the user to control the zoom value.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH5-SW2" title="Figure 3-1The image browser view"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>The image browser view</p><img src = "../Art/imagebrowser_02.jpg" alt = "The image browser view" ></div><br/><p>When fully zoomed in, the image browser displays a single image, as shown in <span class="content_text">Figure 3-2</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH5-SW3" title="Figure 3-2The image browser zoomed"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong>The image browser zoomed</p><img src = "../Art/imagebrowser_03.jpg" alt = "The image browser zoomed" ></div><br/><p>You can set up the image browser view to support dragging images into the window to add them as well as dragging images within the window to rearrange them.  In addition to drag and drop, your application should support adding photos through the <code>NSOpenPanel</code> class, as shown in <span class="content_text">Figure 3-3</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP40004907-CH5-SW4" title="Figure 3-3Adding images"></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>Adding images</p><img src = "../Art/add_photos.jpg" alt = "Adding images" ></div><br/><p>The <code>IKImageBrowserView</code> class also supports scrolling (see <span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW3">Figure 3-2</a></span>), which is necessary for large image sets or when the user has the zoom value set such that the image set doesn’t fit in the view. Your application needs to take one of the following approaches:</p><ul class="ul"><li class="li"><p>Embed the image browser in an <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSScrollView_Class/Reference/Reference.html#//apple_ref/occ/cl/NSScrollView" target="_top">NSScrollView</a></code> object, which is the typical approach.</p></li><li class="li"><p>Connect the image browser to an <code><a href="../../../../Cocoa/Reference/ApplicationKit/Classes/NSScroller_Class/Reference/Reference.html#//apple_ref/occ/cl/NSScroller" target="_top">NSScroller</a></code> object. This approach is a bit more efficient but doesn’t allow auto-hiding of the scrollers.</p></li></ul><a name="//apple_ref/doc/uid/TP40004907-CH5-SW12" title="The Requirements of an Image Browser Application"></a><h2>The Requirements of an Image Browser Application</h2><p>This section gives an overview of the Image Kit classes and protocols needed to write a full-featured image browser application and describes how such an application works. After reading this section you’ll be ready to read the rest of this chapter, which provides step-by-step instructions for these programming tasks:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW5">“Displaying Images in an Image Browser”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW6">“Supporting Zoom”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW7">“Supporting Removing and Reordering Items”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW8">“Supporting Drag and Drop”</a></span></p></li><li class="li"><p><span class="content_text"><a href="ImageBrowser.html#//apple_ref/doc/uid/TP40004907-CH5-SW9">“Setting Browser and Cell Appearance”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP40004907-CH5-SW13" title="The Image Kit Classes and Protocols for an Image Browser Application"></a><h3>The Image Kit Classes and Protocols for an Image Browser Application</h3><p>An image browser application has a number of requirements. In addition to creating an instance of the <code>IKImageBrowserView</code> class, you’ll need to provide a data source that provides the items to show in the image browser. You’ll also need to implement the required methods of the <code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code> and <code><!--a target="_top" -->IKImageBrowserItem<!--/a--></code> protocols.</p><p>The <code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code> protocol defines methods for accessing the data source. You use this protocol to add and remove items, to move items, and to obtain information about individual items or groups. Your application must implement two methods:</p><ul class="spaceabove"><li class="li"><p><code><!--a target="_top" -->numberOfItemsInImageBrowser:<!--/a--></code> returns the number of items in the image browser.</p></li><li class="li"><p><code><!--a target="_top" -->imageBrowser:itemAtIndex:<!--/a--></code>returns the object located at a specified index. The returned object must implement the required methods of the <code><!--a target="_top" -->IKImageBrowserItem<!--/a--></code> protocol.</p></li></ul><p>Methods that support editing or that return group information are optional. See <em><a href="../../../Reference/IKImageBrowserDataSource_Protocol/index.html#//apple_ref/doc/uid/TP40004669" target="_top">IKImageBrowserDataSource Protocol Reference</a></em> for details.</p><p>The <code><!--a target="_top" -->IKImageBrowserItem<!--/a--></code> protocol defines required and optional methods that the browser view uses to access a particular item from the data source. You must implement three methods:</p><ul class="spaceabove"><li class="li"><p><code><!--a target="_top" -->imageRepresentationType<!--/a--></code> returns  the image representation type. An image browser view can handle a variety of image representations. You must specify which representation type the image browser view uses by returning the appropriate constant. <span class="content_text">Table 3-1</span> lists the constants.</p></li><li class="li"><p><code><!--a target="_top" -->imageUID<!--/a--></code> returns a string that uniquely identifies the data source item, such as the string that represents the path to the item.</p></li><li class="li"><p><code><!--a target="_top" -->imageRepresentation<!--/a--></code> returns the representation (such as the path to an image) for an item in the image browser view. The representation must match the image representation type. </p></li></ul><p>You can optionally implement methods that return the image version, title, subtitle, and whether or not the item can be selected. See <em><a href="../../../Reference/IKImageBrowserItem_Protocol/index.html#//apple_ref/doc/uid/TP40004709" target="_top">IKImageBrowserItem Protocol Reference</a></em> for details.</p><a name="//apple_ref/doc/uid/TP40004907-CH5-SW10" title="Table 3-1Image representations and types"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Image representations and types</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Image representation constants</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Image representation data types</p></th></tr><tr><td  scope="row"><p><code>IKImageBrowserPathRepresentationType</code></p></td><td ><p>A path (<code>NSString </code>object)</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserNSURLRepresentationType</code></p></td><td ><p><code>NSURL</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserNSImageRepresentationType</code></p></td><td ><p><code>NSImage</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserCGImageRepresentationType</code></p></td><td ><p><code>CGImage</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserCGImageSourceRepresentationType</code></p></td><td ><p><code>CGImageSource</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserNSDataRepresentationType</code></p></td><td ><p><code>NSData</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserNSBitmapImageRepresentationType</code></p></td><td ><p><code>NSBitmapImageRep</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserQTMovieRepresentationType</code></p></td><td ><p><code>QTMovie</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserQTMoviePathRepresentationType</code></p></td><td ><p>A path (<code>NSString</code> object) to a <code>QTMovie</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserQCCompositionRepresentationType</code></p></td><td ><p><code>QCComposition</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserQCCompositionPathRepresentationType</code></p></td><td ><p>A path (<code>NSString</code> object) to a <code>QCComposition</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserQuickLookPathRepresentationType</code></p></td><td ><p>A path (<code>NSString</code> object) to load an object using the Quick Look framework</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserIconRefRepresentationType</code></p></td><td ><p><code>IconRef</code> object</p></td></tr><tr><td  scope="row"><p><code>IKImageBrowserIconRefPathRepresentationType</code></p></td><td ><p>A path (<code>NSString</code> object) to an <code>IconRef</code> object</p></td></tr></table></div><p>The <code><!--a target="_top" -->IKImageBrowserDelegate<!--/a--></code> informal protocol defines methods that respond to user events, such as a selection. See <em><a href="../../../Reference/IKImageBrowserDelegate_Protocol/index.html#//apple_ref/doc/uid/TP40004710" target="_top">IKImageBrowserDelegate Protocol Reference</a></em> for a description of the delegate methods.</p><a name="//apple_ref/doc/uid/TP40004907-CH5-SW14" title="How the Sample Image Browser Application Works"></a><h3>How the Sample Image Browser Application Works</h3><p>When the sample application that you’ll build in the rest of this chapter launches, it allocates two mutable arrays, one that represents images that are displayed in the image browser view (image array) and another that represents images that need to be imported into the image browser view (import images array). Initially, both arrays are empty. The application then performs any setup work for the image browser view, such as setting the style of the cells and whether the movement of items is animated. After the setup is complete, the window with the image browser view opens without any images. The image browser view has a vertical scroll bar. The window has a button for importing images.</p><p>Clicking the Import Images button invokes an action to add images to the image browser view. The application uses an  instance of the <code>NSOpenPanel</code> class to solicit a selection from the user. If the user makes a selection, the Open panel returns the selection as a path. This application allows users to choose either a file or a folder. A folder can contain files, other folders, or both files and folders. However, files are the only items that are added to the image browser view, which means that the application must traverse all paths until each resolves to a single file.</p><p>The application creates a data source object—an image object—for each file. The object has one instance variable, the path to the file (represented as an <code>NSString</code> object). Each image object is appended to the import images array. After all the objects are added to that array, the application appends that array to the images array. The application then removes all objects from the import images array so that the array can be ready to import more images should the user choose to do so. Finally the application calls the <code>reloadData</code> method of the <code>IKImageBrowserView</code> class to populate the image browser view with the images represented by the import images array.</p><p>The image browser application has five major parts to its implementation:</p><ul class="spaceabove"><li class="li"><p>The nib file. You need to add an Image Browser view (<code>IKImageBrowserView</code> class) to a window. You’ll add a scroll view for the vertical scroller, and a button for importing images. </p></li><li class="li"><p>The window controller. This is the main class. You create it in Xcode and then instantiate it in Interface Builder. The window controller is the data source of the image browser view. The controller manages the mutable array  for the image objects that represent the items in the image browser view and the mutable array for imported image objects. In Interface Builder, you’ll need to make the appropriate connections between the image browser view and the window controller.</p></li><li class="li"><p>The <code>IKImageBrowserDataSource</code> protocol. You need to implement the required methods for this protocol: <code><!--a target="_top" -->numberOfItemsInImageBrowser:<!--/a--></code> and <code><!--a target="_top" -->imageBrowser:itemAtIndex:<!--/a--></code>.</p></li><li class="li"><p>The <code>IKImageBrowserItem</code> protocol. You need to declare an interface for an image object that represents a single item in the image browser view. In the implementation for the image object, you need to provide the required methods for this protocol: <code><!--a target="_top" -->imageUID<!--/a--></code>, <code><!--a target="_top" -->imageRepresentationType<!--/a--></code>, and <code><!--a target="_top" -->imageRepresentation<!--/a--></code>.</p></li><li class="li"><p>Image importing. You need to set up an Open panel and write code that traverses all folder paths until all paths are resolved to individual items.</p></li></ul><p>The sections that follow provide step-by-step instructions for writing the image browser application.</p><a name="//apple_ref/doc/uid/TP40004907-CH5-SW5" title="Displaying Images in an Image Browser"></a><h2>Displaying Images in an Image Browser</h2><p>This section shows how to create an application that displays images in an image browser. First, you’ll set up the Xcode project, the project files, and the interface for the image browser controller. Then you’ll add routines to the implementation. Finally, you’ll set up the user interface in Interface Builder.</p><a name="//apple_ref/doc/uid/TP40004907-CH5-SW15" title="Setting Up the Project, Project Files, and the Controller Interface"></a><h3>Setting Up the Project, Project Files, and the Controller Interface</h3><p>Follow these steps to set up the project:</p><ol class="ol"><li class="li"><p>Open Xcode and create a Cocoa application named <code>Browse Images</code>.</p></li><li class="li"><p>Add the Quartz framework.</p><p>For more details, see<span class="content_text"><a href="../ImageKitComponents/ImageKitComponents.html#//apple_ref/doc/uid/TP40004907-CH3-SW4">“Using the Image Kit in Xcode.”</a></span> </p></li><li class="li"><p>Choose File > New File.</p></li><li class="li"><p>Choose “Objective-C Class NSWindowController subclass” and click Next.</p></li><li class="li"><p>Name the file <code>ImageBrowserController.m</code> and keep the option to create the header file. Then click Finish.</p></li><li class="li"><p>In the <code>ImageBrowserController.h</code> file, import the Quartz framework by adding this statement:</p><p><code>#import &lt;Quartz/Quartz.h></code></p></li><li class="li"><p>Add <code>IBOutlet</code> outlet for the image browser and two mutable arrays . </p><p>One array will hold paths to images that are currently displayed in the browser. The other array will hold paths to images that are about to be imported into the browser. </p><div class="codesample"><table><tr><td scope="row"><pre>@interface ImageBrowserController : NSWindowController {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet id mImageBrowser;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray * mImages;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray * mImportedImages;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the following method signature:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) addImageButtonClicked:(id) sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>ImageBrowserController.h</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH5-SW16" title="Adding Routines to the Implementation File"></a><h3>Adding Routines to the Implementation File</h3><p>Follow these steps to implement the main tasks of the image browser application:</p><ol class="ol"><li class="li"><p>Open the <code>ImageBrowserController.m</code> file.</p></li><li class="li"><p>In the implementation file, add an <code>awakeFromNib</code> method.</p><p>This method allocates and initializes the images and imported images arrays. For visual interest, the method also sets the image browser to animate as it updates.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    mImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    mImportedImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setAnimates:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a  <code>dealloc</code> method.</p><p>The method needs to release the two image arrays.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImages release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImportedImages release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a method for updating the data source for the image browser controller.</p><p>This method needs to add the recently imported items to the image objects array, then empty the imported images array. Finally it reloads the image browser, which causes the image browser to update the display with the recently added images.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) updateDatasource<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImages addObjectsFromArray:mImportedImages];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImportedImages removeAllObjects];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser reloadData];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the two required methods of the image browser data source protocol.</p><p>The number of items in the image browser is simply the number of items in the images array. An item’s index is simply its index in the images array.</p><div class="codesample"><table><tr><td scope="row"><pre>- (int) numberOfItemsInImageBrowser:(IKImageBrowserView *) view<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [mImages count];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (id) imageBrowser:(IKImageBrowserView *) view itemAtIndex:(int) index<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [mImages objectAtIndex:index];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In the <code>IKImageBrowserController.m</code> file, immediately after the import statement, create an interface for a data source object.</p><p>The data source object defines one instance variable, a string that is a path to an item to display.</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MyImageObject : NSObject{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString * mPath;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>In the same file, create the implementation for the data source object <code>MyImageObject</code>. In the next three steps, you’ll be entering methods between the the following two statements, as you would normally for a Cocoa class.</p><div class="codesample"><table><tr><td scope="row"><pre>@implementation MyImageObject<span></span></pre></td></tr><tr><td scope="row"><pre> // Methods here<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>In the <code>MyImageObject</code> implementation, add a <code>dealloc</code> method that releases the path object.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mPath release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write a method that sets the path object.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) setPath:(NSString *) path<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if(mPath != path){<span></span></pre></td></tr><tr><td scope="row"><pre>        [mPath release];<span></span></pre></td></tr><tr><td scope="row"><pre>        mPath = [path retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the three required methods of the <code>IKImageBrowserItem</code> protocol. </p><p>The data source is a file path representation and its unique identifier is the path itself.</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSString *)  imageRepresentationType<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return IKImageBrowserPathRepresentationType;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (id)  imageRepresentation<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return mPath;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (NSString *) imageUID<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return mPath;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Now that you are done with the MyImageObject implementation, you need to add a method to the  ImageBrowserController implementation. This method is invoked when the user  clicks an Import Images button.</p><p>This method calls a routine that displays the Open panel and returns the path chosen by the user. If there is a path, the method sets up an independent thread, calling the <code>addImagesWithPaths:</code> method, which you’ll write next. You’ll write an open files routine later. Check to make sure that you add the following method in the ImageBrowserController implementation,</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) addImageButtonClicked:(id) sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray *path = openFiles();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if(!path){<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLog(@"No path selected, return...");<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>   [NSThread detachNewThreadSelector:@selector(addImagesWithPaths:) toTarget:self withObject:path];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write a method that adds an array of paths to the data source. </p><p>The method parses all paths in the <code>paths</code> array and adds them to a temporary array. (You’ll write the <code>addImagesWithPath:</code> method in the next step. Note this is <em>path</em>, singular.) It then updates the  data source in the main thread.</p><p>Add this method after the <code>addImageButtonClicked:</code> method.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) addImagesWithPaths:(NSArray *) paths<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int i, n;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [paths  retain];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    n = [paths count];<span></span></pre></td></tr><tr><td scope="row"><pre>    for(i=0; i&lt;n; i++){<span></span></pre></td></tr><tr><td scope="row"><pre>        NSString *path = [paths objectAtIndex:i];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self addImagesWithPath:path recursive:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [self performSelectorOnMainThread:@selector(updateDatasource)<span></span></pre></td></tr><tr><td scope="row"><pre>                           withObject:nil<span></span></pre></td></tr><tr><td scope="row"><pre>                        waitUntilDone:YES];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [paths release];<span></span></pre></td></tr><tr><td scope="row"><pre>    [pool release];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write the method that adds images at a path.</p><p>This method checks to see if the path identifies a directory or a file. If the path is a directory, the code parses the directory content and  calls  the <code>addImagesAtPath:</code> method. If the path is to a file, the code calls a method that adds a single image to the imported images array. You’ll write the <code>addAnImageWithPath:</code> method next.</p><p>Note this method has an option to enable or disable recursion. Enabling recursion allows you to traverse nested folders to retrieve the individual items in each folder.</p><p>Add this method before the <code>addImagesWithPaths:</code> method.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) addImagesWithPath:(NSString *) path recursive:(BOOL) recursive<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int i, n;<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL dir;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSFileManager defaultManager] fileExistsAtPath:path isDirectory:&amp;dir];<span></span></pre></td></tr><tr><td scope="row"><pre>    if(dir){<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray *content = [[NSFileManager defaultManager]<span></span></pre></td></tr><tr><td scope="row"><pre>                              directoryContentsAtPath:path];<span></span></pre></td></tr><tr><td scope="row"><pre>        n = [content count];<span></span></pre></td></tr><tr><td scope="row"><pre>       for(i=0; i&lt;n; i++){<span></span></pre></td></tr><tr><td scope="row"><pre>            if(recursive)<span></span></pre></td></tr><tr><td scope="row"><pre>               [self addImagesWithPath:<span></span></pre></td></tr><tr><td scope="row"><pre>                     [path stringByAppendingPathComponent:<span></span></pre></td></tr><tr><td scope="row"><pre>                            [content objectAtIndex:i]]<span></span></pre></td></tr><tr><td scope="row"><pre>                            recursive:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>            else<span></span></pre></td></tr><tr><td scope="row"><pre>              [self addAnImageWithPath:<span></span></pre></td></tr><tr><td scope="row"><pre>                     [path stringByAppendingPathComponent:<span></span></pre></td></tr><tr><td scope="row"><pre>                           [content objectAtIndex:i]]];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        [self addAnImageWithPath:path];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div></li><li class="li"><p>Write a method that adds a single image to the imported images array.</p><p>The method creates an image object and adds the path to the object. The code then adds the image object to the imported images array. </p><p>Add this method before the <code>addImagesWithPath:recursive:</code> method.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) addAnImageWithPath:(NSString *) path<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MyImageObject *p;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    p = [[MyImageObject alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [p setPath:path];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImportedImages addObject:p];<span></span></pre></td></tr><tr><td scope="row"><pre>    [p release];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Write an open files routine that displays an <code>NSOpenPanel</code> object and retrieves the path chosen by the user.</p><p>Place this routine at the top of the<code> ImageBrowserController.m</code> file, immediately after the import statement.</p><div class="codesample"><table><tr><td scope="row"><pre>static NSArray *openFiles()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSOpenPanel *panel;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    panel = [NSOpenPanel openPanel];<span></span></pre></td></tr><tr><td scope="row"><pre>    [panel setFloatingPanel:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [panel setCanChooseDirectories:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [panel setCanChooseFiles:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    int i = [panel runModalForTypes:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    if(i == NSOKButton){<span></span></pre></td></tr><tr><td scope="row"><pre>        return [panel filenames];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return nil;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Build the Project.</p><p>This ensures that Interface Builder detects the action that you added.</p></li><li class="li"><p>Save the <code>IKImageBrowserController.m</code> file.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH5-SW17" title="Creating the User Interface"></a><h3>Creating the User Interface</h3><p>Set up the user interface in Interface Builder by following these steps:</p><ol class="ol"><li class="li"><p>Double-click the  <code>MainMenu.nib</code> file to open Interface Builder.</p></li><li class="li"><p>Choose File > Synchronize With Xcode.</p></li><li class="li"><p>If it’s not already open, double-click the Window icon in the nib document window.</p></li><li class="li"><p>Drag a Image Browser View from the Library to the window and resize the view so that you leave space at the bottom of the window for a button.</p></li><li class="li"><p>In the Size inspector for the view, make sure that the Autosizing springs and struts look as follows:</p><div class="item_figure"><img src = "../Art/browser_view_struts.jpg" alt = "All struts and all springs set." ></div></li><li class="li"><p>Choose Layout > Embed Objects In > Scroll View.</p></li><li class="li"><p>In the Scroll View Attributes inspector, leave Show Vertical Scroller selected but deselect  Show Horizontal Scroller.</p><p>This will allow users to scroll easily through large numbers of images.</p></li><li class="li"><p>In the Size pane, set the Autosizing springs and struts so they look the same as those shown in Step 5. </p></li><li class="li"><p>Drag an Object (<code>NSObject</code>) from the Library to the nib document window.</p></li><li class="li"><p>In the Identity inspector, choose ImageBrowserController from the Class pop-up menu.</p></li><li class="li"><p>Control-drag from the ImageBrowserController icon to the title bar of the window. Then connect to <code>window</code>  in the  connections panel.</p></li><li class="li"><p>Control-drag from the ImageBrowserController icon to the <code>IKImageBrowserView</code> view. Then  connect to <code>mImageBrowser</code> in the  connections panel.</p></li><li class="li"><p>Control-drag from the <code>IKImageBrowserView</code> view to the ImageBrowserController icon. Then connect to _dataSource in the connections panel. </p></li><li class="li"><p>Control-drag from the window icon to the controller icon. Then connect to <code>delegate</code> in the  connections panel.</p></li><li class="li"><p>Drag a Push Button from the library to the lower right portion of the window and label it Import Images.</p></li><li class="li"><p>In the Size inspector, set Autosizing to have outer struts on the left and bottom.</p></li><li class="li"><p>Control-drag from the Import Images button to the the ImageBrowserController icon and connect to the <code>addImageButtonClicked:</code> action in the connections panel. </p></li><li class="li"><p>Save the nib file.</p></li><li class="li"><p>In Xcode, click Build and Go.</p><p>Click the Import Images button and make sure that the image browser works.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH5-SW6" title="Supporting Zoom"></a><h2>Supporting Zoom</h2><p>Next you’ll add the ability for the user to zoom images. You’ll define zoom factors, add controls to the interface, and then add a zoom method that’s invoked by the controls.</p><p>To add the ability for users to zoom images in an image browser:</p><ol class="ol"><li class="li"><p>Add a zoom method.</p><p>This method responds to the zoom controls in the user interface. You’ll add the controls later. The method needs to set the zoom value and then signal the need to update the browser display.</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) zoomSliderDidChange:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setZoomValue:[sender floatValue]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setNeedsDisplay:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the method signature to the <code>ImageBrowserController.h</code> file.</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction) zoomSliderDidChange:(id)sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>Save the <code>ImageBrowserController.h</code> and <code>ImageBrowserController.m</code> files.</p></li><li class="li"><p>Double-click the <code>MainMenu.nib</code> file to open Interface Builder.</p></li><li class="li"><p>Drag a Horizontal Slider from the Library to the browser window and position it in the lower left of the window.</p></li><li class="li"><p>In the Size inspector for the slider and set the Autosizing struts appropriately.</p></li><li class="li"><p>Set the size to Mini.</p></li><li class="li"><p>In the Attributes inspector set the State to Continuous to cause the action method to send its state continuously while the mouse is down.</p></li><li class="li"><p>Set the slider minimum and maximum values.</p><p>Enter <code>0</code> for the minimum value and <code>1.0</code> for the maximum value.</p></li><li class="li"><p>Control-drag  from the slider to the ImageBrowserController icon and in the connections panel choose <code>zoomSliderDidChange:</code>.</p></li><li class="li"><p>Save the <code>MainMenu.nib</code> file.</p></li><li class="li"><p>In Xcode, click Build and Go.</p><p>Try the zoom controls and make sure they work.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH5-SW7" title="Supporting Removing and Reordering Items"></a><h2>Supporting Removing and Reordering Items</h2><p>The image browser will be far more useful if users can remove items and reorder them. You need to set the option to allow reordering. Then you need to implement the methods defined by the <code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code> protocol that support editing items.</p><p>Follow these steps to support removing and reordering:</p><ol class="ol"><li class="li"><p>Open the <code>ImageBrowserController.m</code> file.</p></li><li class="li"><p>Implement the <code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code> protocol method for removing items.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) imageBrowser:(IKImageBrowserView *) view removeItemsAtIndexes: (NSIndexSet *) indexes<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImages removeObjectsAtIndexes:indexes];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code><!--a target="_top" -->IKImageBrowserDataSource<!--/a--></code> protocol method to move items from one location to another.</p><p>This method first removes items from the data source and stores them temporarily in an array. Then it inserts the removed items into the images array at the new location.</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) imageBrowser:(IKImageBrowserView *) view  moveItemsAtIndexes: (NSIndexSet *)indexes toIndex:(unsigned int)destinationIndex<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>      int index;<span></span></pre></td></tr><tr><td scope="row"><pre>      NSMutableArray *temporaryArray;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      temporaryArray = [[[NSMutableArray alloc] init] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>      for(index=[indexes lastIndex]; index != NSNotFound;<span></span></pre></td></tr><tr><td scope="row"><pre>                         index = [indexes indexLessThanIndex:index])<span></span></pre></td></tr><tr><td scope="row"><pre>      {<span></span></pre></td></tr><tr><td scope="row"><pre>          if (index &lt; destinationIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>              destinationIndex --;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>          id obj = [mImages objectAtIndex:index];<span></span></pre></td></tr><tr><td scope="row"><pre>          [temporaryArray addObject:obj];<span></span></pre></td></tr><tr><td scope="row"><pre>          [mImages removeObjectAtIndex:index];<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      // Insert at the new destination<span></span></pre></td></tr><tr><td scope="row"><pre>      int n = [temporaryArray count];<span></span></pre></td></tr><tr><td scope="row"><pre>      for(index=0; index &lt; n; index++){<span></span></pre></td></tr><tr><td scope="row"><pre>          [mImages insertObject:[temporaryArray objectAtIndex:index]<span></span></pre></td></tr><tr><td scope="row"><pre>                        atIndex:destinationIndex];<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>      return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In the <code>awakeFromNib</code> method, set the image browser to allow reordering.</p><p>After modification, the method should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    mImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    mImportedImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setAllowsReordering:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setAnimates:YES];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In Xcode, click Build and Go.</p><p>Add images to the browser. Then try deleting a few items. Select several items and move them to a new location.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40004907-CH5-SW18" title="Note"></a><p><strong>Note:</strong>&nbsp;If you want to support dragging items, you should also implement <code><a href="../../../Reference/IKImageBrowserDataSource_Protocol/IKImageBrowserDataSource_Reference.html#//apple_ref/occ/instm/NSObject/imageBrowser:writeItemsAtIndexes:toPasteboard:" target="_top">imageBrowser:writeItemsAtIndexes:toPasteboard:</a></code>.</p></div><a name="//apple_ref/doc/uid/TP40004907-CH5-SW8" title="Supporting Drag and Drop"></a><h2>Supporting Drag and Drop</h2><p>It is convenient for users to be able to drag items directly to the browser. Drag and drop requires that you set a dragging destination delegate and implement three methods of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/cat/NSDraggingDestination" target="_top">NSDraggingDestination</a></code> protocol. (See <em><a href="../../../../Cocoa/Conceptual/DragandDrop/index.html#//apple_ref/doc/uid/10000069i" target="_top">Drag and Drop Programming Topics for Cocoa</a></em>.)</p><p>To support the ability for users to drag and drop images, follow these steps:</p><ol class="ol"><li class="li"><p>In the <code>awakeFromNib</code> method, set the dragging destination delegate for the image browser.</p><p>After modification, the method should look as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) awakeFromNib<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    mImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    mImportedImages = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setAllowsReordering:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setAnimates:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mImageBrowser setDraggingDestinationDelegate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/performDragOperation:" target="_top">performDragOperation:</a></code> method of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/cat/NSDraggingDestination" target="_top">NSDraggingDestination</a></code> protocol.</p><p>This method looks for paths in the pasteboard. If there are paths, the method retrieves them, adds them to the data source, then reloads the image browser.</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL) performDragOperation:(id &lt;NSDraggingInfo>)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSData *data = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *errorDescription;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSPasteboard *pasteboard = [sender draggingPasteboard];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ([[pasteboard types] containsObject:NSFilenamesPboardType])<span></span></pre></td></tr><tr><td scope="row"><pre>        data = [pasteboard dataForType:NSFilenamesPboardType];<span></span></pre></td></tr><tr><td scope="row"><pre>    if(data){<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray *filenames = [NSPropertyListSerialization<span></span></pre></td></tr><tr><td scope="row"><pre>            propertyListFromData:data<span></span></pre></td></tr><tr><td scope="row"><pre>                mutabilityOption:kCFPropertyListImmutable<span></span></pre></td></tr><tr><td scope="row"><pre>                          format:nil<span></span></pre></td></tr><tr><td scope="row"><pre>                errorDescription:&amp;errorDescription];<span></span></pre></td></tr><tr><td scope="row"><pre>        int i;<span></span></pre></td></tr><tr><td scope="row"><pre>        int n = [filenames count];<span></span></pre></td></tr><tr><td scope="row"><pre>        for(i=0; i&lt;n; i++){<span></span></pre></td></tr><tr><td scope="row"><pre>            [self addImagesWithPath:[filenames objectAtIndex:i] recursive:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        [self updateDatasource];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/draggingEntered:" target="_top">draggingEntered:</a></code> method of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/cat/NSDraggingDestination" target="_top">NSDraggingDestination</a></code> protocol.</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSDragOperation)draggingEntered:(id &lt;NSDraggingInfo>)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return NSDragOperationCopy;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/instm/NSObject/draggingUpdated:" target="_top">draggingUpdated:</a></code> method of the <code><a href="../../../../Cocoa/Reference/ApplicationKit/Protocols/NSDraggingDestination_Protocol/Reference/Reference.html#//apple_ref/occ/cat/NSDraggingDestination" target="_top">NSDraggingDestination</a></code> protocol.</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSDragOperation)draggingUpdated:(id &lt;NSDraggingInfo>)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return NSDragOperationCopy;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>In Xcode, click Build and Go.</p><p>Drag some images to the image browser. Then add some more images. Note that images dragged to the browser are added at the end.</p></li></ol><a name="//apple_ref/doc/uid/TP40004907-CH5-SW9" title="Setting Browser and Cell Appearance"></a><h2>Setting Browser and Cell Appearance</h2><p>The <code><a href="../../../Reference/IKImageBrowserView/IKImageBrowserView_Reference.html#//apple_ref/occ/cl/IKImageBrowserView" target="_top">IKImageBrowserView</a></code> class provides several methods that control the image browser and browser item appearance. You can set the display style for cells so that the cells are shadowed, outlined, or appear with a title or subtitle. You can specify whether to constrain the size of items to their original size.  You can also set the background color of the image browser and a number of other options, all of which are detailed in <em><a href="../../../Reference/IKImageBrowserView/index.html#//apple_ref/doc/uid/TP40004708" target="_top">IKImageBrowserView Class Reference</a></em>. </p><p>You set cell appearance by including the appropriate statements in the <code>awakeFromNib:</code> method, such as:</p><div class="codesample"><table><tr><td scope="row"><pre> [mImageBrowser setCellsStyleMask:IKCellsStyleOutlined | IKCellsStyleShadowed];<span></span></pre></td></tr><tr><td scope="row"><pre> [mImageBrowser setConstrainsToOriginalSize:YES];<span></span></pre></td></tr></table></div><p>If you support groups, you can set bezel and disclosure styles on a per-group basis—the group style is not a property of the image browser.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../ImageViews/ImageViews.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Slideshows/Sildeshows.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-06-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/ImageBrowser/ImageBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/ImageBrowser/ImageBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/GraphicsImaging/Conceptual/ImageKitProgrammingGuide/ImageBrowser/ImageBrowser.html%3Fid%3DTP40004907-1.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>