<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Scripting Bridge Programming Guide for Cocoa: Using Scripting Bridge</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using Scripting Bridge"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40006104-CH4" title="Using Scripting Bridge"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../Scripting-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000569" target="_top">Scripting &amp; Automation</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40006104-CH1-DontLinkElementID_17">Scripting Bridge Programming Guide for Cocoa</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AboutScriptingBridge/AboutScriptingBridge.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40006104-CH4-SW1" title="Using Scripting Bridge"></a><h1>Using Scripting Bridge</h1><p>Scripting Bridge code is very much like any other Objective-C code. However, there are some differences, mostly deriving from the OSA architecture on which the dispatch and handling of Apple events is based. This chapter describes how to use Scripting Bridge in Objective-C projects, pointing out those differences along the way. <span class="content_text"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html#//apple_ref/doc/uid/TP40006104-CH6-SW1">“Improving the Performance of Scripting Bridge Code”</a></span> also discusses the correct or optimal use of Scripting Bridge, but from a performance angle. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_11">Preparing to Code</a>
				
			<br/>
			
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW15">Creating the Application Object</a>
				
			<br/>
			
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_12">Controlling an Application</a>
				
			<br/>
			
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_13">Getting and Setting Properties</a>
				
			<br/>
			
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW12">Using Element Arrays</a>
				
			<br/>
			
        
			
			
				<a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW11">Creating and Adding Scripting Objects</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_11" title="Preparing to Code"></a><h2>Preparing to Code</h2><p>Before you begin writing any Scripting Bridge code for your project, there are a few steps you should complete: </p><ol class="ol"><li class="li"><p>Generate header files for all scriptable applications that your code is sending messages to.</p></li><li class="li"><p>Add these files to your project.</p></li><li class="li"><p>In your header or implementation files, add <code>#import</code> statements for the generated header files.</p></li><li class="li"><p>Add the Scripting Bridge framework to your project.</p></li></ol><p>You can use <code>id</code> to type Scripting Bridge objects dynamically, but such code is vulnerable to programming errors and results in lots of warning messages when you build your project. It is recommended that you generate a header file for each scriptable application, add these files to your project, and in your code give Scripting Bridge specific types based on what you find in the header files. Doing so allows the compiler to check the types of objects (eliminating spurious warning messages) and gives you more assurance that you are sending messages to the correct recipients. </p><p>A header file that you generate for a scriptable application serves as reference documentation for the scripting classes of that application. It includes information about the inheritance relationships between classes and the containment relationships between their objects. It also shows how commands, properties, and elements are declared. Taking the iTunes application as an example, the header file shows the definition of the application class (<code>iTunesApplication</code>), the application’s scripting classes (such as <code>iTunesTrack</code> and <code>iTunesSource</code>), commands (such as the <code>eject</code> method), and properties (such as the <code>artist</code> declared property). A header file also includes comments extracted from the scripting definition, such as the comment added to this declaration for the <code>FinderApplication</code> class: </p><div class="codesample"><table><tr><td scope="row"><pre>- (void)empty;   // Empty the trash<span></span></pre></td></tr></table></div><p>To create a header file, you need to run two command-line tools—<code>sdef</code> and <code>sdp</code>—together, with the output from one piped to the other. This is the recommended syntax:</p><p><code>sdef </code><em>/path/to/application</em><code>.app | sdp -fh --basename </code><em>applicationName</em></p><p>The <code>sdef</code> utility gets the scripting definition from the designated application; if that application does not contain an <code>sdef</code> file, but does instead contain scripting information in an older format (such as the scripting suite and terminology property lists), it translates that information into the sdef format first. The <code>sdp</code> tool run with the above options generates an Objective-C header file for the designated scriptable application. Thus, for iTunes, you would run the following command to produce a header file named <code>iTunes.h</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>sdef /Applications/iTunes.app | sdp -fh --basename iTunes<span></span></pre></td></tr></table></div><p>Add the generated file to your Xcode project by choosing Add to Project from the Project menu and specifying the file in the ensuing dialog. In any source or header file in your project that references Scripting Bridge objects, insert the appropriate #import statements, such as the following:</p><div class="codesample"><table><tr><td scope="row"><pre>#import "iTunes.h"<span></span></pre></td></tr></table></div><p>Finally, make sure that you have added the Scripting Bridge framework (<code>/System/Library/Frameworks/ScriptingBridge.framework</code>) to your project using the Project > Add to Project menu command. It is not necessary to have <code>#import</code> statements for the framework because the header files for the scriptable applications do that already.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW15" title="Creating the Application Object"></a><h2>Creating the Application Object</h2><p>Before you can send messages to a scriptable application, you need an object that represents the application. As explained in <span class="content_text"><a href="../AboutScriptingBridge/AboutScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH3-SW1">“Classes of the Scripting Bridge Framework,”</a></span> the Scripting Bridge framework declares three class factory methods for creating instances of scriptable applications; each takes a different value for locating the application.</p><ul class="ul"><li class="li"><p><code><a href="../../../Reference/SBApplication_Class/SBApplication/SBApplication.html#//apple_ref/occ/clm/SBApplication/applicationWithBundleIdentifier:" target="_top">applicationWithBundleIdentifier:</a></code> locates an application by its bundle identifier.</p></li><li class="li"><p><code><a href="../../../Reference/SBApplication_Class/SBApplication/SBApplication.html#//apple_ref/occ/clm/SBApplication/applicationWithURL:" target="_top">applicationWithURL:</a></code> locates a (local or remote) application by URL.</p></li><li class="li"><p><code><a href="../../../Reference/SBApplication_Class/SBApplication/SBApplication.html#//apple_ref/occ/clm/SBApplication/applicationWithProcessIdentifier:" target="_top">applicationWithProcessIdentifier:</a></code> locates an application by its BSD process identifier (pid).</p></li></ul><p>The recommended method for creating an instance of a scriptable application is <code>applicationWithBundleIdentifier:</code>. The method can locate an application on a system even if the user has renamed the application, and it doesn’t require you to know where an application is installed in the file system (which could be anywhere). The following line of code creates an instance of the iTunes application:</p><div class="codesample"><table><tr><td scope="row"><pre>iTunesApplication *iTunes = [SBApplication applicationWithBundleIdentifier:@"com.apple.iTunes"];<span></span></pre></td></tr></table></div><p>If you don’t know an application’s bundle identifier, you can find it by looking for the value of <code>CFBundleIdentifier</code> property in the <code>Info.plist</code> file stored in the application bundle.</p><p>There might be occasions when using one of the other class factory methods makes sense. For example, if you are writing an application that uses Scripting Bridge for your own personal use, you could refer to applications by URL. The following example creates an instance of the Pages application, locating it by URL in an installation location other than <code>/Applications</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>NSURL *pagesURL = [NSURL fileURLWithPath:[NSString stringWithFormat:@"%@/Applications/iWork/Pages.app", NSHomeDirectory()]];<span></span></pre></td></tr><tr><td scope="row"><pre>PagesApplication *pagesApp = [SBApplication applicationWithURL:pagesURL];<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_12" title="Controlling an Application"></a><h2>Controlling an Application</h2><p>To control a scriptable application, simply send to the instance of the application or one of its objects a message based on a method declared by the object’s class. These methods correspond to commands in the application’s scripting definition. The action method listed in <span class="content_text">Listing 2-1</span> plays the currently selected iTunes track and then modulates the volume of the sound, eventually restoring it to the original level.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW2" title="Listing 2-1Controlling the volume of iTunes"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Controlling the volume of iTunes</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)play:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre>    iTunesApplication *iTunes = [SBApplication applicationWithBundleIdentifier:@"com.apple.iTunes"];<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( [iTunes isRunning] ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        int rampVolume, originalVolume;<span></span></pre></td></tr><tr><td scope="row"><pre>        originalVolume = [iTunes soundVolume];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        [iTunes setSoundVolume:0];<span></span></pre></td></tr><tr><td scope="row"><pre>        [iTunes playOnce:NO];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for (rampVolume = 0; rampVolume &lt; originalVolume; rampVolume += originalVolume / 16) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [iTunes setSoundVolume: rampVolume];<span></span></pre></td></tr><tr><td scope="row"><pre>            /* pause 1/10th of a second (100,000 microseconds) between adjustments. */<span></span></pre></td></tr><tr><td scope="row"><pre>            usleep(100000);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        [iTunes setSoundVolume:originalVolume];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Note that this method tests whether the application is running before it attempts to control it. (The <code><a href="../../../Reference/SBApplication_Class/SBApplication/SBApplication.html#//apple_ref/occ/instm/SBApplication/isRunning" target="_top">isRunning</a></code> method is declared by the <code>SBApplication</code> class.) This programming practice is discussed in more detail in <span class="content_text"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html#//apple_ref/doc/uid/TP40006104-CH6-SW1">“Improving the Performance of Scripting Bridge Code.”</a></span></p><a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_13" title="Getting and Setting Properties"></a><h2>Getting and Setting Properties</h2><p>In the object graph that Scripting Bridge dynamically generates for a scriptable application, most objects are containers of other objects (that is, ( <code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/cl/SBElementArray" target="_top">SBElementArray</a></code> objects) or of objects that refer to another scripting object. In a data-modeling sense, they express to-many or to-one relationships and enable your code to “drill down” the object graph. It is only when you get to the leaf nodes of the graph, which are typically the properties of an object, that you are able to access concrete data, such as a name, a color, or a numerical value. As you may recall, Scripting Bridge implements properties of scripting objects as declared properties in Objective-C.</p><p>Getting the value of a property requires you to navigate the object hierarchy of the application until you come to the target object—that is, the object that declares those properties—and then send a message to that object that is the same as the property name. Sometimes you don’t have to navigate that far. For example, the fragment of code in <span class="content_text">Listing 2-2</span> sends two messages to the <code>ITunesApplication</code> object.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW4" title="Listing 2-2Getting the name of the current track"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Getting the name of the current track</p><div class="codesample"><table><tr><td scope="row"><pre>iTunesApplication *iTunes = [SBApplication applicationWithBundleIdentifier:@"com.apple.iTunes"];<span></span></pre></td></tr><tr><td scope="row"><pre>NSLog(@"Current song is %@", [[iTunes currentTrack] name]);<span></span></pre></td></tr></table></div>	<p>The first message to the application gets the value of its <code>currentTrack</code> property; this message yields an object of class <code>iTunesTrack</code> representing the track currently playing. This object does itself not represent any concrete data, but the message then sent to it (<code>name</code>) returns the value of its <code>name</code> property as an <code><a href="../../../Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/cl/NSString" target="_top">NSString</a></code> object.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_19" title="Important:"></a><p><strong>Important:</strong>&nbsp;If you call an accessor method to get a property value of a type descended from <code>SBObject</code> (for example, an <code>iTunesTrack</code> object), you receive an <code>SBObject</code> object even if there is no “real” object set. In a sense, this is an “empty” object that refers to nothing in the target application. Attempting to evaluate the reference results in an error. In such cases, it is recommended that you test the returned object with the <code>exists</code> method to determine if it is a reference to a real object.</p><p></p></div><p>You can also set the values of properties unless they are (in their declaration) marked as <code>readonly</code>. The code in <span class="content_text">Listing 2-3</span> implements a command-line tool that clears the <code>locked</code> property in items in the Trash.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW3" title="Listing 2-3Setting the locked property of Finder items"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Setting the <code>locked</code> property of Finder items</p><div class="codesample"><table><tr><td scope="row"><pre>int main (int argc, const char * argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    FinderApplication *theFinder = [SBApplication applicationWithBundleIdentifier: @"com.apple.finder"];<span></span></pre></td></tr><tr><td scope="row"><pre>    SBElementArray *trashItems = [[theFinder trash] items];<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([trashItems count] > 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        for (FinderItem *item in trashItems) {<span></span></pre></td></tr><tr><td scope="row"><pre>            if ([item locked]==YES)<span></span></pre></td></tr><tr><td scope="row"><pre>                [item setLocked:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [pool drain];<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>As the listing shows, you can set the value with a message of the form <code>set</code><em>Property</em><code>:</code>, where <em>Property</em> is the name of the property with the initial letter capitalized. You can also use dot notation when setting property values—these are, after all, Objective-C declared properties. For example,  you could set the value of the <code>locked</code> property with this statement:</p><div class="codesample"><table><tr><td scope="row"><pre>item.locked = NO;<span></span></pre></td></tr></table></div><p>However, you could rewrite the Scripting Bridge code in <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW3">Listing 2-3</a></span> to be more efficient by using the <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/setValue:forKey:" target="_top">setValue:forKey:</a></code> method of <code>NSArray</code>. The example in <span class="content_text">Listing 2-4</span> sends just one Apple event instead of one event per item in the Trash.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW14" title="Listing 2-4More efficiently setting the locked property"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>More efficiently setting the <code>locked</code> property</p><div class="codesample"><table><tr><td scope="row"><pre>int main (int argc, const char * argv[]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    FinderApplication *theFinder = [SBApplication applicationWithBundleIdentifier: @"com.apple.finder"];<span></span></pre></td></tr><tr><td scope="row"><pre>    SBElementArray *trashItems = [[theFinder trash] items];<span></span></pre></td></tr><tr><td scope="row"><pre>    [trashItems setValue:[NSNumber numberWithBool:NO] forKey:@"locked"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [pool drain];<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<div class="notebox"><a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_20" title="Note"></a><p><strong>Note:</strong>&nbsp;See <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW12">“Using Element Arrays”</a></span> for more information on other array-processing approaches and <span class="content_text"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html#//apple_ref/doc/uid/TP40006104-CH6-SW1">“Improving the Performance of Scripting Bridge Code”</a></span> for a discussion of related performance techniques.</p></div><p>Instead of messages you can use dot notation to traverse the object graph of a scriptable application. The following line is equivalent to the second line in  <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW4">Listing 2-2</a></span>:</p><div class="codesample"><table><tr><td scope="row"><pre>NSLog(@"Current song is %@", iTunes.currentTrack.name);<span></span></pre></td></tr></table></div><p>Sometimes asking a scripting object for the value of a property might not return the expected concrete data. This happens if the returned value itself is an instance of an application-specific subclass of <code>SBObject</code>, and thus an object specifier referring to what may be the concrete data. Consider the example in <span class="content_text">Listing 2-5</span>. This code copies the textual content of each selected Mail message to a TextEdit document. </p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW5" title="Listing 2-5Forcing evaluation of a scripting object to get a property value"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Forcing evaluation of a scripting object to get a property value</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)copyMailMessage:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre>    MailApplication *mailApp = [SBApplication applicationWithBundleIdentifier:@"com.apple.mail"];<span></span></pre></td></tr><tr><td scope="row"><pre>    TextEditApplication *textEdit = [SBApplication applicationWithBundleIdentifier:@"com.apple.TextEdit"];<span></span></pre></td></tr><tr><td scope="row"><pre>    SBElementArray *viewers = [mailApp messageViewers];<span></span></pre></td></tr><tr><td scope="row"><pre>    for (MailMessageViewer *viewer in viewers) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray *selected = [viewer selectedMessages];<span></span></pre></td></tr><tr><td scope="row"><pre>        for (MailMessage *message in selected) {<span></span></pre></td></tr><tr><td scope="row"><pre>            TextEditDocument *doc = [[[textEdit classForScriptingClass:@"document"] alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>            [[textEdit documents] addObject:doc];<span></span></pre></td></tr><tr><td scope="row"><pre>            doc.text = [[message content] get];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The last line of code in the example includes the message <code>[message content]</code>, but this message does not yield the textual content of the message as one might expect. Instead, a <code><a href="../../../Reference/SBObject_Class/SBObject/SBObject.html#//apple_ref/occ/instm/SBObject/get" target="_top">get</a></code> message is required to force evaluation and thereby obtain the text for assignment. What <code>[message content]</code> returns in an instance of <code>MailText</code>, which a subclass of <code>SBObject</code>. This instance is an object specifier that refers to the actual text. For more on forced evaluation of object specifiers through the <code>get</code> method, see <span class="content_text"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html#//apple_ref/doc/uid/TP40006104-CH6-SW1">“Improving the Performance of Scripting Bridge Code.”</a></span></p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW12" title="Using Element Arrays"></a><h2>Using Element Arrays</h2><p>Element arrays, or <code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/cl/SBElementArray" target="_top">SBElementArray</a></code> objects, are collections of scripting objects of the same type. Scripting Bridge implements the elements it finds in an application’s scripting definition as methods that return <code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/cl/SBElementArray" target="_top">SBElementArray</a></code> instances. Because <code>SBElementArray</code> is a subclass of <code><a href="../../../Reference/Foundation/Classes/NSMutableArray_Class/Reference/Reference.html#//apple_ref/occ/cl/NSMutableArray" target="_top">NSMutableArray</a></code>, you can send methods to element arrays that are declared by <code>NSMutableArray</code> and its superclass, <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/cl/NSArray" target="_top">NSArray</a></code>. For example, as shown in <span class="content_text">Listing 2-6</span>, you could use an <code><a href="../../../Reference/Foundation/Classes/NSEnumerator_Class/Reference/Reference.html#//apple_ref/occ/cl/NSEnumerator" target="_top">NSEnumerator</a></code> object to enumerate through the array.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW7" title="Listing 2-6Using an enumerator to iterate through an element array"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>Using an enumerator to iterate through an element array</p><div class="codesample"><table><tr><td scope="row"><pre>FinderApplication *theFinder = [[[SBApplication applicationWithBundleIdentifier: @"com.apple.finder"] alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>SBElementArray *trashItems = [[theFinder trash] items];<span></span></pre></td></tr><tr><td scope="row"><pre>if ([trashItems count] > 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSEnumerator *tren = [trashItems objectEnumerator];<span></span></pre></td></tr><tr><td scope="row"><pre>    FinderItem *item;<span></span></pre></td></tr><tr><td scope="row"><pre>    while (item = [tren nextObject]) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if ([item locked]==YES)<span></span></pre></td></tr><tr><td scope="row"><pre>            [item setLocked:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Or you could even use the fast enumeration feature of Objective-C 2.0 to more efficiently iterate through the array, as shown in <span class="content_text">Listing 2-7</span>. </p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW8" title="Listing 2-7Using fast enumeration on an element array"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Using fast enumeration on an element array</p><div class="codesample"><table><tr><td scope="row"><pre>FinderApplication *theFinder = [[[SBApplication applicationWithBundleIdentifier: @"com.apple.finder"] alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    SBElementArray *trashItems = [[theFinder trash] items];<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([trashItems count] > 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        for (FinderItem *item in trashItems) {<span></span></pre></td></tr><tr><td scope="row"><pre>            item.locked = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Although it is possible to enumerate through <code>SBElementArray</code> objects, as a general rule don’t enumerate if you can avoid it. You can get much better performance by using one of the “bulk operation” array methods that Cocoa and Scripting Bridge provide: </p><ul class="ul"><li class="li"><p>Use <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/makeObjectsPerformSelector:withObject:" target="_top">makeObjectsPerformSelector:withObject:</a></code> (<code>NSArray</code>) to make contained objects perform an operation.</p></li><li class="li"><p>Use <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/valueForKey:" target="_top">valueForKey:</a></code> and <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/setValue:forKey:" target="_top">setValue:forKey:</a></code> (NSArray) for bulk fetching and setting, respectively, of the properties of objects in an element array.</p></li><li class="li"><p>Use <code><a href="../../../Reference/Foundation/Classes/NSArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSArray/filteredArrayUsingPredicate:" target="_top">filteredArrayUsingPredicate:</a></code> (<code>NSArray</code>) to obtain a subset of the objects in the array.</p></li><li class="li"><p>Use <code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/instm/SBElementArray/arrayByApplyingSelector:withObject:" target="_top">arrayByApplyingSelector:withObject:</a></code> (<code>SBElementArray</code>) to get a particular value from each object in the array.</p></li></ul><p>The code in <span class="content_text">Listing 2-8</span> uses the last of these methods to create a pop-up list with the calendar names obtained from the iCal application.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW9" title="Listing 2-8Using the arrayByApplyingSelector: method to populate a pop-up button"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Using the <code>arrayByApplyingSelector:</code> method to populate a pop-up button</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)awakeFromNib {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [time setDateValue: [NSDate date]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [NSApp setDelegate: self];<span></span></pre></td></tr><tr><td scope="row"><pre>    iCalApplication *iCal = [SBApplication applicationWithBundleIdentifier:@"com.apple.iCal"];<span></span></pre></td></tr><tr><td scope="row"><pre>    SBElementArray *calendars = [iCal calendars];<span></span></pre></td></tr><tr><td scope="row"><pre>    [cal_popup removeAllItems]; // cal_pop is an outlet to a pop-up button<span></span></pre></td></tr><tr><td scope="row"><pre>    [cal_popup addItemsWithTitles:[calendars arrayByApplyingSelector: @selector(name)]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The code fragment in <span class="content_text">Listing 2-9</span> (which is extracted from the method shown in <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW6">Listing 2-11</a></span>) uses the <code>filteredArrayUsingPredicate:</code> method to create an array containing a subset of calendar events that each have a particular name.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW10" title="Listing 2-9Filtering an element array using a predicate"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Filtering an element array using a predicate</p><div class="codesample"><table><tr><td scope="row"><pre>iCalEvent *theEvent;<span></span></pre></td></tr><tr><td scope="row"><pre>NSArray *matchingEvents = [[theCalendar events] filteredArrayUsingPredicate:<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSPredicate predicateWithFormat:@"summary == %@", eventName]];<span></span></pre></td></tr><tr><td scope="row"><pre>if ( [matchingEvents count] >= 1 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle any events that match..<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p><code>SBElementArray</code> also declares methods for extracting individual objects from element arrays using various forms of reference: name (<code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/instm/SBElementArray/objectWithName:" target="_top">objectWithName:</a></code>), unique identifier (<code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/instm/SBElementArray/objectWithName:" target="_top">objectWithName:</a></code>), and location within the array (<code><a href="../../../Reference/SBElementArray_Class/SBElementArray/SBElementArray.html#//apple_ref/occ/instm/SBElementArray/objectAtLocation:" target="_top">objectAtLocation:</a></code>). The code fragment in <span class="content_text">Listing 2-10</span> shows the use of the <code>objectWithName:</code> method. (Again, this fragment is taken from the example in  <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW6">Listing 2-11</a></span>.)</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW13" title="Listing 2-10Getting an object from an element array by specifying its name"></a><p class="codesample"><strong>Listing 2-10&nbsp;&nbsp;</strong>Getting an object from an element array by specifying its name</p><div class="codesample"><table><tr><td scope="row"><pre>iCalApplication *iCal = [[[SBApplication applicationWithBundleIdentifier:@"com.apple.iCal"] alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>iCalCalendar *theCalendar;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>[iCal activate];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>NSString *calendarName = [calendar titleOfSelectedItem];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if ( [[[iCal calendars] objectWithName:calendarName] exists] ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    theCalendar = [[iCal calendars] objectWithName:calendarName];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// etc....<span></span></pre></td></tr></table></div><div class="importantbox"><a name="//apple_ref/doc/uid/TP40006104-CH4-DontLinkElementID_21" title="Important:"></a><p><strong>Important:</strong>&nbsp;If you call an element accessor method (for example, <code>objectWithName:</code>) to get an object from an element array, you receive an <code>SBObject</code> object even if there is no “real” object with that name, ID, location, or index in the array. In a sense, this is an “empty” object that refers to nothing in the target application. Attempting to evaluate the reference results in an error. In such cases, it is recommended that you test the returned object with the <code>exists</code> method to determine if it is a reference to a real object.</p><p></p></div><p>For adding scripting objects to element arrays, you may use <code>NSMutableArray</code> methods such as <code><a href="../../../Reference/Foundation/Classes/NSMutableArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMutableArray/insertObject:atIndex:" target="_top">insertObject:atIndex:</a></code> and <code><a href="../../../Reference/Foundation/Classes/NSMutableArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMutableArray/addObject:" target="_top">addObject:</a></code>. To remove objects from element arrays, call <code><a href="../../../Reference/Foundation/Classes/NSMutableArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMutableArray/removeObject:" target="_top">removeObject:</a></code> (or a related method of <code>NSMutableArray</code>) on the element array.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW11" title="Creating and Adding Scripting Objects"></a><h2>Creating and Adding Scripting Objects</h2><p>In addition to allowing you to control an application and get and set the properties of scripting objects, Scripting Bridge lets you add scripting objects to an application. For example, you could use Scripting Bridge to dynamically add a playlist to iTunes. There are two important guidelines to remember when adding a scripting object to an application:</p><ul class="ul"><li class="li"><p>Call <code><a href="../../../Reference/SBApplication_Class/SBApplication/SBApplication.html#//apple_ref/occ/instm/SBApplication/classForScriptingClass:" target="_top">classForScriptingClass:</a></code> on the application instance to get the <code>Class</code> object to use for allocating the object.</p><p>This method takes the name of the class as specified in the scripting definition—for example, <code>document</code>. Do not use a class name in the <code>sdp</code>-generated header file as the receiver of the <code>alloc</code> method.</p></li><li class="li"><p>Immediately after creating the object, insert it in the appropriate element array. </p><p>The object is not “viable” in the application until it has been added to its container. Consequently, you cannot set or access its properties until it’s been added. </p></li></ul><p>You can use the <code><a href="../../../Reference/SBObject_Class/SBObject/SBObject.html#//apple_ref/occ/instm/SBObject/init" target="_top">init</a></code> and <code><a href="../../../Reference/SBObject_Class/SBObject/SBObject.html#//apple_ref/occ/instm/SBObject/initWithProperties:" target="_top">initWithProperties:</a></code> methods of <code>SBObject</code> to initialize the scripting object.  Here are a few lines of code (taken from <span class="content_text"><a href="UsingScriptingBridge.html#//apple_ref/doc/uid/TP40006104-CH4-SW5">Listing 2-5</a></span>) that use <code>init</code>: </p><div class="codesample"><table><tr><td scope="row"><pre>TextEditDocument *doc = [[[textEdit classForScriptingClass:@"document"] alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>[[textEdit documents] addObject:doc];<span></span></pre></td></tr><tr><td scope="row"><pre>doc.text = [[message content] get];<span></span></pre></td></tr></table></div><p>Note that the code does not set the <code>text</code> property until the scripting object has been added to TextEdit’s element array of documents. The following code fragment, on the other hand, creates a dictionary with the text property and then initializes the scripting object with it using <code>initWithProperties:</code> :</p><div class="codesample"><table><tr><td scope="row"><pre>NSDictionary *props = [NSDictionary dictionaryWithObject:[[message content] get] forKey:@"text"];<span></span></pre></td></tr><tr><td scope="row"><pre>TextEditDocument *doc = [[[textEdit classForScriptingClass:@"document"] alloc] initWithProperties:props];<span></span></pre></td></tr><tr><td scope="row"><pre>[[textEdit documents] addObject:doc];<span></span></pre></td></tr></table></div><p><span class="content_text">Listing 2-11</span> provides an extended example of conditionally creating and inserting iCal <code>calendar</code> and <code>event</code> objects, showing both approaches.</p><a name="//apple_ref/doc/uid/TP40006104-CH4-SW6" title="Listing 2-11Creating and adding new scripting objects to the object graph"></a><p class="codesample"><strong>Listing 2-11&nbsp;&nbsp;</strong>Creating and adding new scripting objects to the object graph</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)addUpdateEvent:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    iCalApplication *iCal = [SBApplication applicationWithBundleIdentifier:@"com.apple.iCal"];<span></span></pre></td></tr><tr><td scope="row"><pre>    iCalCalendar *theCalendar;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [iCal activate];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *calendarName = [calendar titleOfSelectedItem];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( [[[iCal calendars] objectWithName:calendarName] exists] ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        theCalendar = [[iCal calendars] objectWithName:calendarName];<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        NSDictionary *props = [NSDictionary dictionaryWithObject:calendarName forKey:@"name"];<span></span></pre></td></tr><tr><td scope="row"><pre>        theCalendar = [[[[iCal classForScriptingClass:@"calendar"] alloc] initWithProperties: props] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>        [[iCal calendars] addObject: theCalendar];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *eventName = [event stringValue];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDate* startDate = [time dateValue];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDate* endDate = [[[NSDate alloc] initWithTimeInterval:3600 sinceDate:startDate] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    iCalEvent *theEvent;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray *matchingEvents =<span></span></pre></td></tr><tr><td scope="row"><pre>        [[theCalendar events] filteredArrayUsingPredicate:<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSPredicate predicateWithFormat:@"summary == %@", eventName]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( [matchingEvents count] >= 1 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        theEvent = (iCalEvent *) [matchingEvents objectAtIndex:0];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theEvent setStartDate:startDate];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theEvent setEndDate:endDate];<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        theEvent = [[[[iCal classForScriptingClass:@"event"] alloc] init] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>        [[theCalendar events] addObject: theEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theEvent setSummary:eventName];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theEvent setStartDate:startDate];<span></span></pre></td></tr><tr><td scope="row"><pre>        [theEvent setEndDate:endDate];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [iCal release];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AboutScriptingBridge/AboutScriptingBridge.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../ImproveScriptingBridgePerf/ImproveScriptingBridgePerf.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-03-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/ScriptingBridgeConcepts/UsingScriptingBridge/UsingScriptingBridge.html%3Fid%3DTP40006104-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/ScriptingBridgeConcepts/UsingScriptingBridge/UsingScriptingBridge.html%3Fid%3DTP40006104-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/ScriptingBridgeConcepts/UsingScriptingBridge/UsingScriptingBridge.html%3Fid%3DTP40006104-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>