<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1014: Creating Sub GWorlds using QTNewGWorldFromPtr</title><meta name="keywords" content="QTNewGWorldFromPtr"><meta name="Description" content="Technical Q&amp;A QA1014: Describes how to use QTNewGWorldFromPtrto create sub GWorlds which reference the pixel data of otherGWorlds."><meta name="categories" content="QuickTime Performance and Compatibility and QuickTime"><meta name="week-posted" content="Mar 19, 2001 - Mar 23, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001569" title="Creating Sub GWorlds using QTNewGWorldFromPtr"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxCarbon-date.html">Carbon</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1014</div>
<div id="pageheadsub">Creating Sub GWorlds using QTNewGWorldFromPtr</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>                  <P id=p2>Q:      I use two offscreen GWorlds as sources drawing to a destination      window on screen. Everything works great when both source      and destination are the same size, but what technique can      I use if the destination window is smaller? Specifically,       I don't want to shrink the source but would like to select      sub-rectangles from within the source.</p>                  <P id=p4>A:      QTNewGWorldFromPtr can be used to create smaller GWorlds      which reference larger ones.</p><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSErr QTNewGWorldFromPtr(    GWorldPtr      *gw,         /* on return, a pointer                                   to the offscreen */    OSType         pixelFormat, /* pixel format for                                   the new GWorld */    const Rect     *boundsRect, /* bounds and port                                   rect for the offscreen                                   pixel map */    CTabHandle     cTable,      /* same as the source                                   GWorld */    GDHandle       aGDevice,    /* NULL */    GWorldFlags    flags,       /* 0 */    void           *baseAddr,   /* adjust this value                                   to the new origin */    long           rowBytes );  /* get this value                                   from the source GWorld */</pre></TD></TR></TABLE></CENTER><P id=p4>      Adjust the origin by adding (x * pixelSize(in bytes) + y      * rowBytes) to the baseAddr of the source GWorlds PixMap,      then use this new value as the baseAddr parameter passed      into QTNewGWorldFromPtr.</p><P id=p4>      The caller is responsible for passing in a baseAddr that      isn't going to change during the lifetime of the returned      GWorld, therefore applications should first call LockPixels      for the GWorld being used as the source before calling QTNewGWorldFromPtr.       Listing 1 illustrates this technique.</p><BR><P><B>Listing 1</B>.       CreateNewSubGWorld</P><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre> /*    CreateNewSubGWorld    This function returns a new GWorld that points to a subset    of the main source GWorld. It checks that the inSubRect    rectangle is a true subset of the source GWorlds rectangle,    otherwise the new GWorld would work in an unpredictable    fashion. It also locks the source PixMap if it's not    locked. The source GWorlds PixMap should not be unlocked    or disposed while the sub-GWorld (which is referencing    the same pixel data) is in use.    In        inSrcGWorld  - a pointer to the source GWorld              inSubRect    - the sub rectangle for the                             new GWorld    Out       outSubGWorld - address of a GWorldPtr, returns                             the new subset GWorld*/OSErr CreateNewSubGWorld(GWorldPtr inSrcGWorld,                         const Rect *inSubRect,                         GWorldPtr *outSubGWorld){    PixMapHandle hPixMap = NULL;    long theRowBytes = 0L;    Ptr theBaseAddr = NULL;    OSType thePixelFormat;    UInt32 offset = 0L;    Rect theSubRect = *inSubRect;    Rect theSrcRect;    // sanity checks    if (NULL == inSrcGWorld || NULL == outSubGWorld)        return paramErr;    GetPortBounds(inSrcGWorld, &amp;theSrcRect);    if (theSubRect.top &lt; theSrcRect.top ||        theSubRect.left &lt; theSrcRect.left ||        theSubRect.bottom &gt; theSrcRect.bottom ||        theSubRect.right &gt; theSrcRect.right) return paramErr;    // get what we need from the source GWorld    hPixMap = GetGWorldPixMap(inSrcGWorld);    if (!(GetPixelsState(hPixMap) &amp;&amp; pixelsLocked))        LockPixels(hPixMap);    theBaseAddr = GetPixBaseAddr(hPixMap);    theRowBytes = QTGetPixMapHandleRowBytes(hPixMap);    thePixelFormat = GETPIXMAPPIXELFORMAT(*hPixMap);    // calculate the new origin of the pixels -    // - pixelSize is in bits, so divide by 8    // to turn it to bytes then modify the base    // address to point to our new origin    offset = ((inSubRect-&gt;left * (**hPixMap).pixelSize / 8) +              (inSubRect-&gt;top * theRowBytes));    theBaseAddr += offset;    // coordinate system normalized 0, 0    OffsetRect(&amp;theSubRect, -theSubRect.left, -theSubRect.top);    return QTNewGWorldFromPtr(outSubGWorld,                              thePixelFormat,                              &amp;theSubRect,                              (**hPixMap).pmTable,                              NULL,                              0,                              (void *)theBaseAddr,                              theRowBytes);}</pre></TD></TR><TR><td align="left"></TD></TR></TABLE></CENTER><BR>          <P><B>References:</B><BR><BR>          <A HREF="qa1007.html">Technical Q&amp;A QA1007, "LockPixels and DisposeGWorld with QTNewGWorldFromPtr"</A>          </P>          <P><hr width=500 align=center></P> <!-- begin_date --><H4 ALIGN=center>[Mar 20 2001]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1014.html%3Fid%3DDTS10001569-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1014.html%3Fid%3DDTS10001569-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1014.html%3Fid%3DDTS10001569-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></table></center></BODY></HTML>