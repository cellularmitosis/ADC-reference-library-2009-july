<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A NW26: Numerous Small Packet Exchanges Resultin Poor TCP Performance</title><meta name="keywords" content="Mac OS 8 Open Transport small packets poor performance TCP_NODELAY"><meta name="Description" content="Technical Q&amp;A NW26: Q&amp;A explains why numerous small packageexchanges in an Open Transport Application result in poorTCP performance because the application delays sending packets.Q&amp;A also provides a method for improving performance"><meta name="categories" content="Networking"><meta name="week-posted" content="May 25, 1998 - May 29, 1998"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001438" title="Numerous Small Packet Exchanges Resultin Poor TCP Performance"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalqas/Carbon/idxNetworking-date.html">Networking</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A NW26</div>
<div id="pageheadsub">Numerous Small Packet Exchanges Resultin Poor TCP Performance</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->						<!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id = p2>Q: My Open Transport TCP application exchanges a number ofsmall packets of information, which may or may not generate aresponse from the other side. In some cases, I find that theapplication delays sending packets, and performance is terrible. Howcan I solve this problem?</p><p id=p4>A: One possible reason for this behavior isexplained by the <CODE>TCP_NODELAY</CODE> option. As per the XTIspecification, under most circumstances TCP sends data as soon as itis presented to TCP. However, when outstanding data has not yet beenacknowledged, TCP delays sending small amounts of data, gathering itinto a single packet which is sent when an acknowledgment isreceived. This technique, known as the <STRONG>Nagle Algorithm</STRONG>, is designed to prevent "send-side silly window syndrome."  If an application generates data one byte at a time, this algorithm prevents it from filling the network with lots of one-bytepayload TCP packets.<p id=p4>For some applications, this packetization may cause significantdelays. Setting the <CODE>TCP_NODELAY</CODE> option defeats thisalgorithm. The following snippet shows how to set this option.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>err = SetFourByteOption(ep, INET_TCP, TCP_NODELAY, 1);</pre>	</TD></TR></TABLE></CENTER><p id=p4>This snippet relies on the <CODE>SetFourByteOption</CODE>,shown in<a href="http://developer.apple.com/documentation/mac/NetworkingOT/NetworkingWOT-39.html#MARKER-9-65" target="_blank">Listing7-5</A> of<a href="http://developer.apple.com/documentation/mac/NetworkingOT/NetworkingWOT-2.html" target="_blank">InsideMacintosh: Networking with Open Transport</A>.</P><p id=p4>In general, disabling the Nagle Algorithm is a bad idea because itdecreases the efficiency with which you use the network.  A bettersolution is for you to structure your application so that it sendsall logically associated data in one chunk.  You may find OT'sability to send<a href="http://developer.apple.com/documentation/mac/NetworkingOT/NetworkingWOT-48.html" target="_blank">non-contiguousdata</A> helpful in this case.</P></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[May 25 1998]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/nw/nw26.html%3Fid%3DDTS10001438-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/nw/nw26.html%3Fid%3DDTS10001438-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/nw/nw26.html%3Fid%3DDTS10001438-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center> </BODY></HTML>