<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime VR: Cubic QuickTime VR Movies</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Cubic QuickTime VR Movies"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000944-CH210" title="Cubic QuickTime VR Movies"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../VirtualReality-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000589" target="_top">Virtual Reality</a> &gt; <a href="../0Preface/QTVR-preface.html#//apple_ref/doc/uid/TP40000944-CH204-DontLinkElementID_2">QuickTime VR</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../6Chap/6-Creating-QTVR-Movies.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../7Chap/7-QTVR-atoms-file-format.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_102" title="Cubic QuickTime VR Movies"></a><h1><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJEDFFD" title="Cubic QuickTime VR Movies"></a>Cubic QuickTime VR Movies</h1><p>This chapter is aimed at QuickTime VR developers and programmers who want to create cubic QuickTime VR movies. It discusses some of the key features of the MakeCubic utility application provided by Apple, which enables you to produce cubic QTVR movies from cube faces and from equirectangular spherical pictures. The chapter also explains some of the techniques you can use to convert a panoramic image into a QuickTime VR panoramic movie. To accomplish this, Apple provides free sample code that you can download at </p><p><span class="content_text"><a href="../../../../samplecode/Sample_Code/QuickTime/QuickTime_VR.htm" target="_top">http://developer.apple.com/samplecode/Sample_Code/QuickTime/QuickTime_VR.htm</a></span></p><p>The sample code includes the <code>VRMakePano.h</code> and the <code>VRMakePano.c</code> files, and is part of the VRMakePano library code. </p><p>As discussed briefly in the section <span class="content_text"><a href="../1Chap/1-General-Intro.html#//apple_ref/doc/uid/TP40000944-CH205-BABBFFDI">“QuickTime VR”</a></span> and in more detail in <span class="content_text"><a href="../6Chap/6-Creating-QTVR-Movies.html#//apple_ref/doc/uid/TP40000944-CH209-BCIDDHJF">“Cubic Panoramas,”</a></span> QuickTime 5.01 introduced a new cubic playback engine which stores panoramic images as six or more separate images that can be projected during playback onto the sides of a cube (polyhedron), thus enabling the user to look straight up and straight down––with spectacular results. Imagine looking skyward straight up to the top of the Eiffel Tower or seeing the full dimensions, floor and ceiling, of any room or cubic space. </p><p>The <a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_308"></a>QuickTime VR cubic playback engine was designed to be backward compatible, so that properly constructed cubic VRs would still be able to play in earlier versions of QuickTime as panoramas––with slight distortion.</p><p>This chapter is divided into the following major sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJDHBHJ">“Overview”</a></span> describes some of the features of the <code>VRMakePano.c</code> and <code>VRMakePano.h</code> sample code which is available to developers. </p></li><li class="li"><p><span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJECBJI">“MakeCubic Utility Application”</a></span> describes the utility application provided by Apple for developers who want to create cubic QuickTime VR panoramas. The application is available for download from the Apple developer website.</p></li><li class="li"><p><span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJIBDJH">“Using the VRMakePano.c Library”</a></span> discusses the <code><!--a-->VRMakePano.c<!--/a--></code> code that lets you convert a panoramic image into a QuickTime VR panoramic movie. </p></li><li class="li"><p><span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BCICIEAB">“Inside VRMakePano.c”</a></span> discusses some of the key code snippets from the <code>VRMakePano.h</code> and the <code>VRMakePano.c </code>files that let you convert a tile movie to a cylindrical QuickTime VR movie or convert a movie with six frames into a cubic QuickTime VR panorama movie. </p></li></ul><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJDHBHJ" title="Overview"></a><h2>Overview</h2><p>To assist developers who are working with QuickTime VR, Apple provides the following:</p><ul class="ul"><li class="li"><p>A MakeCubic utility application. This application enables you to construct cubic QTVR movies from cube faces and from equirectangular spherical pictures. </p></li><li class="li"><p><code><!--a-->VRMakePano.c<!--/a--></code> and <code><!--a-->VRMakePano.h<!--/a--></code> sample code. This code lets you make cylindrical and cubic QTVR movies from GWorlds, picture files, or movie files. This is library-quality code, designed to be usable as-is. You drop the code into your project, link, and run. </p></li></ul><p>The process of making a cylindrical or cubic panorama generally involves these steps:</p><ol class="ol"><li class="li"><p>You create the movie file for the destination.</p></li><li class="li"><p>Create the QTVR movie track and the media for it.</p></li><li class="li"><p>Create the panorama track and the media for it. </p></li><li class="li"><p>Add the media for the video. </p></li><li class="li"><p>Add the controller. </p></li><li class="li"><p>Flatten it. </p></li></ol><p>The <code><!--a-->VRMakePano.c<!--/a--></code> and <code><!--a-->VRMakePano.h<!--/a--></code> sample code provides a common interface, with consistent procedure names, for example</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr   VRMovieToQTVRCubicPano(<span></span></pre></td></tr><tr><td scope="row"><pre>    VRMakeQTVRParams    *qtvrParams,<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              *srcTileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              *srcHSTileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              *srcFSTileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              *dstMovieSpec<span></span></pre></td></tr><tr><td scope="row"><pre>);<span></span></pre></td></tr></table></div><p>The procedure names in the <code><!--a-->VRMakePano.h<!--/a--></code> API are consistently formed, as shown in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJEICII">Figure 6-1</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_103" title="Figure 6-1The procedure names in the VRMakePano.h API"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJEICII" title="Figure 6-1The procedure names in the VRMakePano.h API"></a><strong>Figure 6-1&nbsp;&nbsp;</strong>The procedure names in the VRMakePano.h API</p><img src = "../art/iqt_vrprocess.gif" alt = "The procedure names in the VRMakePano.h API" width="310" height="56"></div><br/><p>The common parameters (<em>VRMakeQTVRParams</em>) are</p><div class="codesample"><table><tr><td scope="row"><pre>{pan,tilt,FOV} {min,max,default}<span></span></pre></td></tr><tr><td scope="row"><pre>tiles           {numH, numV, codec, quality}<span></span></pre></td></tr><tr><td scope="row"><pre>preview         {codec, quality}<span></span></pre></td></tr><tr><td scope="row"><pre>name            {scene, node}<span></span></pre></td></tr><tr><td scope="row"><pre>quality         {dynamic, static}<span></span></pre></td></tr><tr><td scope="row"><pre>window          {width,height}<span></span></pre></td></tr><tr><td scope="row"><pre>flattener       {flags, previewResolution}<span></span></pre></td></tr><tr><td scope="row"><pre>hotSpots<span></span></pre></td></tr><tr><td scope="row"><pre>trackDuration<span></span></pre></td></tr></table></div><p>These parameters apply to all types of panoramas (cylindrical and cubic), as well as sources (movies, PICT files, and GWorlds).</p><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJECBJI" title="MakeCubic Utility Application"></a><h2>MakeCubic Utility Application</h2><p>MakeCubic is a simple utility application that is provided by Apple for developers who want to create cubic QuickTime VR panoramas from six faces or from equirectangular (a kind of sphere-to-rectangle projection) images. It is available for download from the Apple developer website at </p><p><span class="content_text"><a href="http://developer.apple.com/quicktime/quicktimeintro/tools/index.html" target="_top">http://developer.apple.com/quicktime/quicktimeintro/tools/index.html</a></span></p><p>MakeCubic performs tiling, compression, and preview creation for cubic VR. To use the default settings, you drag an equirectangular image, or six cubic face images onto the application. </p><p>To adjust the tiling, compression, or preview parameters, you launch the application by double-clicking its icon and selecting Convert from the File menu. The MakeCubic parameters dialog is shown in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJJEBDI">Figure 6-2</a></span>.</p><p>The MakeCubic application provides some features beyond those found in the <code><!--a-->VRMakePano.c<!--/a--></code> Library, including </p><ul class="ul"><li class="li"><p>conversion from equirectangular spherical pictures </p></li><li class="li"><p>optimal minimum and default FOV computed automatically</p></li><li class="li"><p>preview resolution independent of pano resolution</p></li></ul><p>Some VRMakePano functions that are <em>not</em> accessible in the MakeCubic application:</p><ul class="ul"><li class="li"><p>no URL hot spots; only undefined (“blob”) hot spots</p></li><li class="li"><p>no cylindrical panoramas</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_104" title="Figure 6-2The MakeCubic Panorama Parameters dialog"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJJEBDI" title="Figure 6-2The MakeCubic Panorama Parameters dialog"></a><strong>Figure 6-2&nbsp;&nbsp;</strong>The MakeCubic Panorama Parameters dialog</p><img src = "../art/panorama_params.gif" alt = "The MakeCubic Panorama Parameters dialog" width="413" height="428"></div><br/><p>MakeCubic is designed primarily for QuickTime VR developers who are using another stitcher program that generates an equirectangular image and for those who are synthesizing and generating the cube faces directly, as with a 3D renderer. </p><p>The MakeCubic application has a number of settings in the Panorama Parameters dialog, which are briefly explained as follows: </p><ul class="ul"><li class="li"><p>If you click the Equirectangular button, a dialog appears.</p><ul class="nested"><li class="nested li"><p>In the equirectangular setting, you can choose CW (clockwise) or CCW (counterclockwise). This setting is not used unless the source equirectangular spherical image is taller than it is wide, in which case the image is rotated clockwise or counterclockwise before conversion to cubic faces, depending on this setting. </p></li></ul></li><li class="li"><ul class="nested"><li class="nested li"><p>The equirectangular inclination describes the angle from vertical at which the axis of the equirectangular image lies. If you use a tripod with a vertical axis, that will be 0 degrees; with a horizontal axis, it will be 90 degrees. (If the setting is other than 0, you have to make sure that the equirectangular seam corresponds to the top. This is accomplished using the offset filter in Adobe Photoshop.)</p></li></ul></li><li class="li"><p>Clicking the File button produces a dialog that lets you select the source files you want to use in your cubic VR.</p></li><li class="li"><p>You can choose one file, or more than one file. You hold down the Shift key to select all six files.</p></li><li class="li"><p>MakeCubic parses the names from the files and displays them in the Panorama Parameters dialog, so the structure of those files can be verified.</p></li></ul><p>Generally, all image files will be of the same type––that is, JPEGs. You would not normally mix image files––for example, JPEGs, GIFs, and TIFFs––because you would end up with unacceptable compression artifacts, though MakeCubic can deal with it. </p><ul class="ul"><li class="li"><p>Compression settings come from the Preferences dialog. Typically, this is 40% for Quality setting, and PhotoJPEG with color. </p></li><li class="li"><p>Fast Start Preview, if checked will attach a preview. The Preview you select will have the same number as the number of source files. The default is 1 pixel / degree, 24% JPEG blurred, no gray scale. The resolution, however, can be fractional. Blur will apply a blur filter to the whole preview. Although this is the default here, 0.5 pixel/degree, not blurred, no gray scale, 75% JPEG yields a nicer preview, without getting much larger. </p></li><li class="li"><p>Hot spots is the next selection of the dialog. When you click File, you can open up hot spots for your panorama. You don’t want to have these hot spots in JPEG format, because JPEG is not lossless. GIF, PNG, and TIFF are the preferred formats for hot spots. With hot spots, you generate in 8 bits and you want to save the hot spots in a lossless, 8-bit format.</p></li><li class="li"><p>You can use the 8-bit system palette for your color map.</p></li><li class="li"><p>Movie Settings in the dialog: set these to wake up in particular defaults that you like by setting the preferences. Normally, you want to pan from 0 to 360 and set Tilt -90 to 90. The default FOV is set to be 1:1 pixel zoom. With 1:1 pixel zoom, you are seeing pixels exactly as they are in the panorama––zoomed in or zoomed out. </p><ul class="nested"><li class="nested li"><p>Minimum FOV is set to be 2:1 pixel zoom, which doubles the pixel size. Higher pixel zooms may introduce pixelization artifacts. </p></li></ul></li><li class="li"><p>Tiling: normally, six faces are produced for a cube. When you change the tiling from its default of 1 x 1, then you will have more than one polygon per face.</p></li><li class="li"><p>The Auto-Tile checkbox will automatically compute tiling for a desired tile size. The default is 400 x 400. It will try to get tiles that are 400 x 400. </p></li></ul><p>The MakeCubic Preferences dialog, shown in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJDBBFH">Figure 6-3</a></span>, has settings that are explained as follows:</p><ul class="ul"><li class="li"><p>Clicking the Panorama Compression button enables you to preset the level at which you prefer to have your compression. It brings up a standard dialog, which lets you can save the preferences. </p></li><li class="li"><p>The “Initialize parameters from QuickTime VR Movie” checkbox is useful if you’re going to be tweaking a VR panorama. For example, you can take a movie as input––that is, a movie with nothing more than an video track in it––or a VR cubic movie. If you check this box, it will look inside the panroama tracks and get the parameters you set, and store that information when it opens the file. That way, you can easily tweak the initial view. Note that this feature currently only works when the faces are tiled 1 x 1. </p></li><li class="li"><p>Auto-Tile makes each tile a particular size, with 400 pixels as the target dimension. You can change the target dimension to anything you want, such as 256. </p></li><li class="li"><p>You can tailor the optimal FOV computations to your preferences. The default is to set the initial FOV so that the pixels are scaled 1:1, and the minimum FOV will limit zooming so that the pixels can only be doubled in size in order to avoid pixelization artifacts. </p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_105" title="Figure 6-3MakeCubic Preferences dialog"></a><p><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJDBBFH" title="Figure 6-3MakeCubic Preferences dialog"></a><strong>Figure 6-3&nbsp;&nbsp;</strong>MakeCubic Preferences dialog</p><img src = "../art/makecubic_prefs.gif" alt = "MakeCubic Preferences dialog" width="375" height="413"></div><br/><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJIBDJH" title="Using the VRMakePano.c Library"></a><h2>Using the VRMakePano.c Library</h2><p><code><!--a-->VRMakePano.c<!--/a--></code> is code provided by Apple that is designed primarily to serve as a library for developers who want to convert cylindrical panoramic images into QuickTime VR panoramic movies. The code compiles and runs on both the Mac OS and Windows platforms and has minimal dependencies and a rich API. </p><p>Using the code supplied in <code><!--a-->VRMakePano.c<!--/a--></code>, you can also construct a QuickTime VR movie from the six faces of a cube, so that the movie can be viewed using the cubic projection engine introduced in QuickTime. There are three different types of sources that can be supplied to <code>VRMakePano.c</code>: GWorlds, image files, and movies. </p><p>With each of these interfaces, you can supply</p><ul class="ul"><li class="li"><p>movies with single tracks, where the tracks have a panorama, either cubic or cylindrical</p></li><li class="li"><p>hot spots, all tiled and compressed</p></li><li class="li"><p>a Fast start track </p></li></ul><p>For movie files, you have one movie file for each of the three tracks; with picture files, you may have one file (equirectangular), or more than one file (faces); with GWorlds, you assume that you always have six GWorlds for the cubic, or one GWorld for the cylindrical, just the same as for picture files.</p><p>The interface is designed to be orthongonal, so that it looks the same regardless if there are PICT files, or GWorlds, whether they are cubic or cyclindrical. Thus, the interface is the same, regardless of the files you have. </p><p>Most parameters are encapsulated in a standard parameter data structure:</p><div class="codesample"><table><tr><td scope="row"><pre>    VRMakeQTVRParams<span></span></pre></td></tr></table></div><p>All fields should be set. For example, the following settings would be suitable for cubics:</p><div class="codesample"><table><tr><td scope="row"><pre>    p.tilesH             = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.tilesV             = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.tileCodec          = kJPEGCodecType;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.tileQuality        = codecNormalQuality;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.sceneName          = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.nodeName           = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.dynamicQuality     = codecNormalQuality;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.staticQuality      = codecHighQuality;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.trackDuration      = 7200;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.previewCodec      = JPEG<span></span></pre></td></tr><tr><td scope="row"><pre>    p.previewQuality    = low<span></span></pre></td></tr><tr><td scope="row"><pre>    p.wraps              = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.minPan             = 0.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.maxPan             = 360.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.minTilt            = -90.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.maxTilt            =  90.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.minFieldOfView     =   5.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.maxFieldOfView     = 120.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.defaultPan         =   0.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.defaultTilt        =   0.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.defaultFieldOfView =  60.0f;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.windowWidth        = 480;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.windowHeight       = 320;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.hotSpots           = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.flattenerFlags     = kVRMakePano_GeneratePreview |<span></span></pre></td></tr><tr><td scope="row"><pre>                            kVRMakePano_BlurGeneratedPreview;<span></span></pre></td></tr><tr><td scope="row"><pre>    p.flattenerPreviewResolution = 4;<span></span></pre></td></tr></table></div><p>Typical usage would then be:</p><div class="codesample"><table><tr><td scope="row"><pre>    err = VRXXXToQTVRYYYPano(&amp;p, &amp;srcSpec, &amp;srcHSSpec, &amp;srcFSSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;dstSpec);<span></span></pre></td></tr></table></div><p>The API does not currently include the ability to set the hot spot codec (default: graphics 100%).</p><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF104" title="Cubic Panorama File Format "></a><h3>Cubic Panorama File Format </h3><p>As discussed, QuickTime enables you to use cubic panoramas, which store the panoramic image as six or more separate images that are projected during playback onto the sides of a cube (polyhedron), allowing the user to look straight up and straight down. The file format for cubic panoramas is identical with the Version 2.0 cylindrical file format, with these exceptions:</p><ul class="spaceabove"><li class="li"><p>The pano track identifies the type of pano as <code>'cube'</code>. </p></li><li class="li"><p>The pano track has a <code>'cuvw'</code> atom to specify the actual view parameters, allowing the pano data sample’s view parameters to be assigned backward-compatibility values for QuickTime 4.x, which can only render cylindrical panoramas. </p></li><li class="li"><p>The pano track optionally has a <code>'cufa'</code> atom to specify the placement of the faces. This may be omitted if there are six faces and they appear in the standard order. </p></li></ul><p>For cubic panoramas, some of the fields in the panorama sample atom should be assigned special values that allow the file to be displayed with the cylindrical engine if the cubic engine is not available. The cubic engine ignores those values, instead using values stored in the new cubic view atom. </p><a name="//apple_ref/doc/uid/TP40000944-CH210-BCICIEAB" title="Inside VRMakePano.c"></a><h3>Inside VRMakePano.c</h3><p><code><!--a-->VRMakePano.c<!--/a--></code>contains code for creating a QuickTime VR panoramic movie from a panoramic image. The image can be a picture of type <code>'PICT'</code> or any other kind of image for which QuickTime has a graphics importer component. You can also create hot spot image tracks and assemble the various hot spot atoms. This file also contains a function that constructs a QuickTime VR movie that uses the cubic projection available in QuickTime––that is, cubic movies or cubic panoramas.</p><p>A panoramic movie contains at least three tracks: a QTVR track, a panorama track, and a panorama image track. In addition, a QuickTime VR movie must contain some special user data that specifies the QuickTime VR movie controller. A QuickTime VR movie can also contain other kinds of tracks, such as hot spot image tracks, preview tracks, and even sound tracks.</p><p>A QuickTime VR movie contains a single QTVR track, which maintains a list of the nodes in the movie.</p><p>Each individual sample in the QTVR track’s media contains information about a single node, such as the node’s type, ID, and name. Since you are creating a single-node movie here, your QTVR track will contain a single media sample. </p><p>Every media sample in a QTVR track has the same sample description, whose type is <code>QTVRSampleDescription</code>. The data field of that sample description is a VR world, which is an atom container whose child atoms specify information about the nodes in the movie, such as the default node ID and the default imaging properties.</p><p>A panoramic movie also contains a single panorama track, which contains information specific to the panorama. A panorama track has a media sample for each media sample in the QTVR track. As a result, our panorama track will have one sample. The <code><!--a  -->QTVRPanoSampleAtom<!--/a--></code> structure defines the media sample data. </p><p>The actual image data for a panoramic node is contained in a panorama image (video) track. The individual frames in that track are the diced (and compressed) tiles of the original panoramic image.</p><p>There may also be a hot spot image track that contains the diced (and compressed) tiles of the hot spot panoramic image.</p><p>The general strategy, given a panoramic image, is as follows:</p><ol class="ol"><li class="li"><p>Create a movie containing a video track whose frames are the compressed tiles of the panoramic image. Call this movie the “tile movie.” Create a similar movie for the hot spot image. Call this movie the “hot spot tile movie.” Similarly, for the preview. </p></li><li class="li"><p>Create a new, empty movie. Call this movie the “QTVR movie.”</p></li><li class="li"><p>Create a QTVR track and its associated media.</p></li><li class="li"><p>Create a VR world atom container; this is stored in the sample description for the QTVR track.</p></li><li class="li"><p>Create a node information atom container for each node; this is stored as a media sample in the QTVR track.</p></li><li class="li"><p>Create a panorama track and add it to the movie.</p></li><li class="li"><p>Create a preview track. </p></li><li class="li"><p>Create a panorama image track by copying the video track from the tile movie to the QTVR movie.</p></li><li class="li"><p>Create a hot spot image track by copying the video track from the hot spot tile movie to the QTVR movie.</p></li><li class="li"><p>Set up track references from the QTVR track to the panorama track, and from the panorama track to the panorama image track and the hot spot image track and preview.</p></li><li class="li"><p>Add a user data item that identifies the QTVR movie controller.</p></li><li class="li"><p>Flatten the QTVR movie into the final panoramic movie.</p></li></ol><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF102" title="Specifying the Faces of a Cube"></a><h3>Specifying the Faces of a Cube</h3><p>The code in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJJCDJE">Listing 6-1</a></span> deals with the vectors and quaternions that are used to specify the faces of a cube. The interface describes an axis and an orientation around that axis in order to set where the face is. </p><p>For example, this particular interface would be used to specify <em>right</em>, <em>left</em>, <em>back</em>, and <em>front</em> in a mathematically defined way. To do the main four faces, you would set the <em>x, y, z</em> of the axis of rotation to be [<em>0, 1, 0</em>], namely, pointing up on the <em>y</em> axis. So the front face would be rotated by 0 around that axis, the next ones would be rotated by 90 degrees from the previous. From this interface, it can generate all the data needed to set the face orientation, or sub-face. </p><p>This example assumes that the faces are equal subtiles of six cube faces.</p><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_106" title="Listing 6-1Specifying the faces of a cube"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJJCDJE" title="Listing 6-1Specifying the faces of a cube"></a><strong>Listing 6-1&nbsp;&nbsp;</strong>Specifying the faces of a cube</p><div class="codesample"><table><tr><td scope="row"><pre>SetOneCubicFaceData(<span></span></pre></td></tr><tr><td scope="row"><pre>    QTVRCubicFaceData   *face,<span></span></pre></td></tr><tr><td scope="row"><pre>    float               x,   /* axis of rotation */<span></span></pre></td></tr><tr><td scope="row"><pre>    float               y,<span></span></pre></td></tr><tr><td scope="row"><pre>    float               z,<span></span></pre></td></tr><tr><td scope="row"><pre>    float               degrees, /* rotation about axis */<span></span></pre></td></tr><tr><td scope="row"><pre>    long                tilesH, /* subdivisions per face */<span></span></pre></td></tr><tr><td scope="row"><pre>    long                tilesV,<span></span></pre></td></tr><tr><td scope="row"><pre>    long                h,  /* The horizontal index of this sub-face */<span></span></pre></td></tr><tr><td scope="row"><pre>    long                v   /* The vertical   index of this sub-face */<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    double halfAngle, norm, sqrtCotVFOV, s, c;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    sqrtCotVFOV = sqrt((double)tilesV);<span></span></pre></td></tr><tr><td scope="row"><pre>    halfAngle = degrees * pi / 360.0;<span></span></pre></td></tr><tr><td scope="row"><pre>    norm = x*x + y*y + z*z;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (norm != 0.0)<span></span></pre></td></tr><tr><td scope="row"><pre>        norm = 1.0 / sqrt(norm);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (fabs(s = sin(halfAngle)) &lt; 1.0e-8) s = 0.0; /* make nice */<span></span></pre></td></tr><tr><td scope="row"><pre>    if (fabs(c = cos(halfAngle)) &lt; 1.0e-8) c = 0.0; /* file values*/<span></span></pre></td></tr><tr><td scope="row"><pre>    norm *= s * sqrtCotVFOV;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    face->orientation[0] = EndianF32_NtoB(c * sqrtCotVFOV);<span></span></pre></td></tr><tr><td scope="row"><pre>    face->orientation[1] = EndianF32_NtoB(x * norm);<span></span></pre></td></tr><tr><td scope="row"><pre>    face->orientation[2] = EndianF32_NtoB(y * norm);<span></span></pre></td></tr><tr><td scope="row"><pre>    face->orientation[3] = EndianF32_NtoB(z * norm);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /* Center, normalized by the vertical dimension */<span></span></pre></td></tr><tr><td scope="row"><pre>    face->center[0] = EndianF32_NtoB( (2 * h - tilesH + 1) * (float)tilesV<span></span></pre></td></tr><tr><td scope="row"><pre>                                        / (float)tilesH);<span></span></pre></td></tr><tr><td scope="row"><pre>    face->aspect = EndianF32_NtoB(1.0f);<span></span></pre></td></tr><tr><td scope="row"><pre>    face->skew = EndianF32_NtoB(0.0f);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF105" title="Converting a Tile Movie To a  Cylindrical QuickTime VR Movie "></a><h2>Converting a Tile Movie To a  Cylindrical QuickTime VR Movie </h2><p>The code in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJJEAHD">Listing 6-2</a></span> converts a tile movie to a cylindrical QuickTime VR movie. You can also specify an optional hot spot tile movie and/or fast start movie. The window dimensions, tiling, track duration, compression codec, compression qualities and rendering qualities (static and dynamic) are mandatory.</p><p>The tiles are assumed <em>not</em> to be rotated. (The “2vo” version should be used if the tiles are rotated.) For a wrapping panoramic image of VFOV &lt; 145 degrees, this means that the horizontal dimension (circumference) is larger than the vertical (axis).</p><p>Using the <code><!--a-->VRMovieToQTVRCylPano2h0<!--/a--></code> or <code><!--a-->VRMovieToQTVRCylPano2v0<!--/a--></code>functions, you can create a single-node panoramic QTVR movie from the specified tile movies. The <code><!--a-->VRMovieToQTVRCylPano2h0<!--/a--></code> function builds a movie that conforms to version 2.0 of the QuickTime VR file format. VRMakePano.c also contains code to make version 1.0 files, but this is discouraged.</p><p>The newly-created movie contains <em>references</em> to the original tile movie––<em>not</em> the movie data itself. This is done because the assumption is that the caller will flatten the movie into a third movie, which will contain the movie data. Also, the interim file is much smaller than it would be if the data is copied, thus saving time and disk space.</p><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_107" title="Listing 6-2Code to convert a cylindrical movie to a cylindrical  panorama movie, with rotated source "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJJEAHD" title="Listing 6-2Code to convert a cylindrical movie to a cylindrical  panorama movie, with rotated source "></a><strong>Listing 6-2&nbsp;&nbsp;</strong>Code to convert a cylindrical movie to a cylindrical  panorama movie, with rotated source </p><div class="codesample"><table><tr><td scope="row"><pre>VRMovieToQTVRCylPano2h0(<span></span></pre></td></tr><tr><td scope="row"><pre>    VRMakeQTVRParams *qtvrParams, /* Parameters to create the movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *srcTileSpec,   /* Cylindrical panoramic tile movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *srcHSTileSpec, /* Cylindrical hot spot tile movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec *srcFSTileSpec,  /* Cylindrical fast start tile movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *dstMovieSpec   /* Destination movie */<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short               myResRefNum = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie               tmpMovie = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track               myQTVRTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track               myPanoTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentResult     err  = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              tmpSpec;<span></span></pre></td></tr></table></div><p>These are the steps you follow: </p><ol class="ol"><li class="li"><p>You create a movie file for the destination movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    MakeTempFSSpec(dstMovieSpec, ".MV~", &amp;tmpSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateMovieFile(&amp;tmpSpec, FOUR_CHAR_CODE('TVOD'),<span></span></pre></td></tr><tr><td scope="row"><pre>                            smCurrentScript, kCreateMovieFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myResRefNum, &amp;tmpMovie);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the QTVR movie track and media. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreateQTVRTrack(qtvrParams, qtvrParams->trackDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            tmpMovie, &amp;myQTVRTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the panorama track and the media, and add them to the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreatePanoTrackFromMovies(srcTileSpec, srcHSTileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    srcFSTileSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    qtvrParams, panoType, tmpMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    myQTVRTrack, &amp;myPanoTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a user data item that identifies the QTVR movie controller. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = SetQTControllerType(tmpMovie, kQTVRQTVRType);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the final, flattened movie from the temporary file into a new movie file; put the movie resource first, so that FastStart is possible. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = FlattenQTVRMovie(tmpMovie, qtvrParams->flattenerFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            qtvrParams->flattenerPreviewResolution,<span></span></pre></td></tr><tr><td scope="row"><pre>                            dstMovieSpec);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myResRefNum != -1)      CloseMovieFile(myResRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (tmpMovie    != NULL)    DisposeMovie(tmpMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    DeleteMovieFile(&amp;tmpSpec);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return(err);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF106" title="Converting Movies to Cubic  Panorama Movies"></a><h2>Converting Movies to Cubic  Panorama Movies</h2><p>The code in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJGEBAE">Listing 6-3</a></span> converts a movie with six frames into a cubic QuickTime VR panorama movie. An optional hot spot movie and/or fast start movie can also be specified. The window dimensions, tiling, track duration, compression codec, compression qualities and rendering qualities (static and dynamic) are mandatory.</p><p>Using the <code><!--a-->VRMovieToQTVRCubicPano<!--/a--></code> function, you can create a single-node cubic panoramic QTVR movie from the specified six-frame movie.</p><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_108" title="Listing 6-3Converting a movie with six frames into a cubic  QuickTime VR panorama movie"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJGEBAE" title="Listing 6-3Converting a movie with six frames into a cubic  QuickTime VR panorama movie"></a><strong>Listing 6-3&nbsp;&nbsp;</strong>Converting a movie with six frames into a cubic  QuickTime VR panorama movie</p><div class="codesample"><table><tr><td scope="row"><pre>VRMovieToQTVRCubicPano(<span></span></pre></td></tr><tr><td scope="row"><pre>    VRMakeQTVRParams    *qtvrParams,/* Parameters to create the movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *srcFramesSpec, /* Source movie with the panorama faces */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *srcHSFramesSpec, /* Source movie with the hot spot faces */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *srcFSFramesSpec,/* Source movie with the fast start faces */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  *dstMovieSpec   /* Destination movie */<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  tmpSpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    short   myResRefNum = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie   tmpMovie = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track   tmpQTVRTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track   tmpPanoTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentResult  err;<span></span></pre></td></tr></table></div><p>These are the steps you follow: </p><ol class="ol"><li class="li"><p>You create a temporary version of the panorama movie file, located in the same directory as the destination panorama movie file. </p><div class="codesample"><table><tr><td scope="row"><pre>    MakeTempFSSpec(dstMovieSpec, ".MV~", &amp;tmpSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateMovieFile(&amp;tmpSpec, FOUR_CHAR_CODE('TVOD'),<span></span></pre></td></tr><tr><td scope="row"><pre>                            smCurrentScript, kCreateMovieFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myResRefNum, &amp;tmpMovie);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the QTVR movie track and media. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreateQTVRTrack(qtvrParams, qtvrParams->trackDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            tmpMovie, &amp;tmpQTVRTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create panorama track and media, and add them to the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>err = CreatePanoTrackFromMovies(srcFramesSpec, srcHSFramesSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                                srcFSFramesSpec, qtvrParams,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTVRCubicVersion1, tmpMovie,<span></span></pre></td></tr><tr><td scope="row"><pre>                                tmpQTVRTrack, &amp;tmpPanoTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a user data item that identifies the QTVR movie controller. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = SetQTControllerType(tmpMovie, kQTVRQTVRType);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the final, flattened movie, from the temporary file into a new movie file; put the movie resource first, so that FastStart is possible. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = FlattenQTVRMovie(tmpMovie, qtvrParams->flattenerFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            qtvrParams->flattenerPreviewResolution,<span></span></pre></td></tr><tr><td scope="row"><pre>                            dstMovieSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF107" title="Converting Cubic Picture files to  Cubic Panorama Movies"></a><h2>Converting Cubic Picture files to  Cubic Panorama Movies</h2><p>The code in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJCBDDI">Listing 6-4</a></span> converts a set of six picture files to a cubic QuickTime VR panorama movie.</p><p>An optional hot spot picture files and/or fast start picture files can also be specified. The window dimensions, tiling, track duration, compression codec, compression qualities and rendering qualities (static and dynamic) are mandatory.</p><p>There are certain restrictions on sizes, however, for tiling:</p><p>Adjacent tiles duplicate their edges; therefore, the GWorld size should be evenly divisible into tiles, taking this overlap into account. Tile size is:</p><p><code> t = (f + n - 1) / n</code></p><p>where</p><p><code> t</code> is the tile size (width or height),</p><p><code> f</code> is the face size (width or height is the same as above),</p><p><code> n</code> is the number of tiles in that dimension (width or height). </p><p>For example, a 767x767 face is divided into 4=2x2 tiles of size 384x384, while a 766x766 face is divided into 9=3x3 tiles of size 256x256.</p><p>This implements tiling of the faces, but the face dimensions must be appropriately divisible:</p><div class="codesample"><table><tr><td scope="row"><pre>    (width  - tilesH + 1) / tilesH = integer<span></span></pre></td></tr><tr><td scope="row"><pre>    (height - tilesV + 1) / tilesV = integer<span></span></pre></td></tr></table></div><p>For example, {dim=512,tiles=1} , {dim=511,tiles=2} , {dim=510,tiles=3}. </p><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_109" title="Listing 6-4Converting a set of six picture files to a cubic QuickTime VR panorama movie"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJCBDDI" title="Listing 6-4Converting a set of six picture files to a cubic QuickTime VR panorama movie"></a><strong>Listing 6-4&nbsp;&nbsp;</strong>Converting a set of six picture files to a cubic QuickTime VR panorama movie</p><div class="codesample"><table><tr><td scope="row"><pre>VRPictsToQTVRCubicPano(<span></span></pre></td></tr><tr><td scope="row"><pre>    VRMakeQTVRParams *qtvrParams,/* Parameters to create the movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpecHandle    srcPictSpecs,/* Source images */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpecHandle    srcHSPictSpecs, /* Hot spot images */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpecHandle    srcFSPictSpecs, /* Fast start images */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec          *dstMovieSpec   /* Destination movie */<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec  tmpSpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    short   tmpRefNum   = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie   tmpMovie    = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track   qtvrTrack   = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track   panoTrack   = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentResult  err;<span></span></pre></td></tr></table></div><p>These are the steps you follow: </p><ol class="ol"><li class="li"><p>You create a temporary version of the panorama movie file, located in the same directory as the destination panorama movie file. </p><div class="codesample"><table><tr><td scope="row"><pre>    MakeTempFSSpec(dstMovieSpec, ".MV~", &amp;tmpSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateMovieFile(&amp;tmpSpec, FOUR_CHAR_CODE('TVOD'),<span></span></pre></td></tr><tr><td scope="row"><pre>                            smCurrentScript, kCreateMovieFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;tmpRefNum, &amp;tmpMovie);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the QTVR movie track and media. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreateQTVRTrack(qtvrParams, qtvrParams->trackDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            tmpMovie, &amp;qtvrTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create panorama track and media, and add them to the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreatePanoTrackFromPicts(6, srcPictSpecs, srcHSPictSpecs,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    srcFSPictSpecs, kQTVRCubicVersion1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    qtvrParams, tmpMovie, qtvrTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;panoTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a user data item that identifies the QTVR movie controller. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = SetQTControllerType(tmpMovie, kQTVRQTVRType);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the final, flattened movie, from the temporary file into a new movie file; put the movie resource first, so that FastStart is possible. </p><div class="codesample"><table><tr><td scope="row"><pre>err = FlattenQTVRMovie(tmpMovie, qtvrParams->flattenerFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                        qtvrParams->flattenerPreviewResolution,<span></span></pre></td></tr><tr><td scope="row"><pre>                        dstMovieSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40000944-CH210-TPXREF108" title="Converting GWorlds to  Cubic Panorama Movies"></a><h2>Converting GWorlds to  Cubic Panorama Movies</h2><p>The code in <span class="content_text"><a href="5-QTVR-Movie-Controller.html#//apple_ref/doc/uid/TP40000944-CH210-BAJFFHJJ">Listing 6-5</a></span> converts a set of six GWorlds to a cubic QuickTime VR panorama movie. An optional hot spot GWorlds and/or fast start GWorlds can also be specified.</p><p>The window dimensions, tiling, track duration, compression codec, compression qualities and rendering qualities (static and dynamic) are mandatory.</p><p>There are certain restrictions on sizes for tiling:</p><p>Adjacent tiles duplicate their edges; therefore, the GWorld size should be evenly divisible into tiles, taking this overlap into account. Tile size is:</p><div class="codesample"><table><tr><td scope="row"><pre> t = (f + n - 1) / n<span></span></pre></td></tr></table></div><p>where </p><p><code> t</code> is the tile size (width or height),</p><p><code> f</code> is the face size (width or height - same as above), and </p><p><code> n</code> is the number of tiles in that dimension (width or height). </p><p>For example, a 767x767 face is divided into 4=2x2 tiles of size 384x384, while a 766x766 face is divided into 9=3x3 tiles of size 256x256.</p><p>Given six GWorlds (and six possible hot spot GWorlds), you can create a cubic panorama movie. This implements tiling of the faces, but the face dimensions must be appropriately divisible:</p><div class="codesample"><table><tr><td scope="row"><pre> (width  - tilesH + 1) / tilesH = integer<span></span></pre></td></tr><tr><td scope="row"><pre>    (height - tilesV + 1) / tilesV = integer<span></span></pre></td></tr></table></div><p>For example, {dim=512,tiles=1} , {dim=511,tiles=2} , {dim=510,tiles=3}. </p><a name="//apple_ref/doc/uid/TP40000944-CH210-DontLinkElementID_110" title="Listing 6-5Code for converting a set of six GWorlds to a  cubic QuickTime VR panorama movie"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000944-CH210-BAJFFHJJ" title="Listing 6-5Code for converting a set of six GWorlds to a  cubic QuickTime VR panorama movie"></a><strong>Listing 6-5&nbsp;&nbsp;</strong>Code for converting a set of six GWorlds to a  cubic QuickTime VR panorama movie</p><div class="codesample"><table><tr><td scope="row"><pre>VRGWorldsToQTVRCubicPano(<span></span></pre></td></tr><tr><td scope="row"><pre>    VRMakeQTVRParams *qtvrParams, /* Parameters to create the movie */<span></span></pre></td></tr><tr><td scope="row"><pre>    GWorldPtr        *srcGWs,   /* 6 Source GWorlds in standard order */<span></span></pre></td></tr><tr><td scope="row"><pre>    GWorldPtr       *srcHSGWs,  /* 6 Hot spot GWorlds in order */<span></span></pre></td></tr><tr><td scope="row"><pre>    GWorldPtr       *srcFSGWs,  /* 6 Faststart GWorlds in order */<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec          *dstMovieSpec /* Destination movie */<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec              tmpSpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    short               tmpRefNum               = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie               tmpMovie                = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track               qtvrTrack               = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track               panoTrack               = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    ComponentResult     err;<span></span></pre></td></tr></table></div><p>These are the steps you follow: </p><ol class="ol"><li class="li"><p>Create a temporary version of the panorama movie file, located in the same directory as the destination panorama movie file. </p><div class="codesample"><table><tr><td scope="row"><pre>MakeTempFSSpec(dstMovieSpec, ".MV~", &amp;tmpSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>    err = CreateMovieFile(&amp;tmpSpec, FOUR_CHAR_CODE('TVOD'),<span></span></pre></td></tr><tr><td scope="row"><pre>                            smCurrentScript, kCreateMovieFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;tmpRefNum, &amp;tmpMovie);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the QTVR movie track and media. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreateQTVRTrack(qtvrParams, qtvrParams->trackDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            tmpMovie, &amp;qtvrTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create panorama track and media, and add them to the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = CreatePanoTrackFromGWorlds(6, srcGWs, srcHSGWs, srcFSGWs,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kQTVRCubicVersion1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    qtvrParams, tmpMovie, qtvrTrack,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;panoTrack);<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a user data item that identifies the QTVR movie controller. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = SetQTControllerType(tmpMovie, kQTVRQTVRType);<span></span></pre></td></tr></table></div></li><li class="li"><p>Create the final, flattened movie, from the temporary file into a new movie file; put the movie resource first so that FastStart is possible. </p><div class="codesample"><table><tr><td scope="row"><pre>    err = FlattenQTVRMovie(tmpMovie, qtvrParams->flattenerFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            qtvrParams->flattenerPreviewResolution,<span></span></pre></td></tr><tr><td scope="row"><pre>                            dstMovieSpec);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../6Chap/6-Creating-QTVR-Movies.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../7Chap/7-QTVR-atoms-file-format.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-06-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/InsideQT_QTVR/5Chap/5-QTVR-Movie-Controller.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/InsideQT_QTVR/5Chap/5-QTVR-Movie-Controller.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/InsideQT_QTVR/5Chap/5-QTVR-Movie-Controller.html%3Fid%3DTP40000944-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>