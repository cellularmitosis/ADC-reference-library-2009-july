<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN2015: Locating Application Support Files under Mac OS X</title><meta name="keywords" content="location bundle resources binary"><meta name="Description" content="Technical Note TN2015: describing different methods for anapplication to determine its location."><meta name="categories" content="Runtime Architecture, Processes, Operating System, Overview and Files"><meta name="week-posted" content="Mar 26, 2001 - Mar 30, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003054" title="Locating Application Support Files under Mac OS X"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalnotes/Carbon/idxFileManagement-date.html">File Management</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2015</div>
<div id="pageheadsub">Locating Application Support Files under Mac OS X</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">   <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">     <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>            <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <span id="menutitle">CONTENTS   <br>  <br> </span>   </td>  </tr>  <tr bgcolor="#e6e6e6">   <td background="images/tnmenubody.gif" width=300 align=left> <!-- begin_toc -->         <P id = "menutext">         <a href="#UsingPackages">Using Packages</a><BR><BR><a href="#CFBundleAPIs">CFBundle APIs</a><BR><BR><a href="#OlderMethods">Older Methods</a><BR><BR><a href="#TheResults">The Results</a><BR><BR><a href="#Summary">Summary</a><BR><BR><a href="#References">References</a><BR><BR><A HREF = "#Downloads">Downloadables</A></p> <!-- end_toc --></td>  </tr>  <tr>   <td width=300 align=left scope="row"> <img src="images/tnmenubottom.gif" alt="" width=300 height=16>   </td>  </tr>    </table></td>  <td width=300 valign="top" align=left><!-- begin_intro_text --><p>Applications may need additional files, such as dictionaries, plug-ins, scripts, etc., in order to run properly. Apple recommends that such files are stored in special folders such as the Application Support, Scripting Additions, Scripts, and Internet Plug-Ins folders, which can be located using the <code>FindFolder</code> API that works transparently on Mac OS 8, 9, and Mac OS X, but some developers prefer to store those files in folders located adjacent to the related application. In order to locate those files, the application has to locate itself first.  The different methods used in the past by developers to do accomplish this must be revised on Mac OS X.</p><p>If your application is running as a Classic application on Mac OS X, then the current method used to locate itself is still going to work. That's the Classic application compatibility; you don't need to read this Technote further.</p><p>If you carbonized your application to benefit from the multiple advantages of running as a separate modern process on Mac OS X, then you need to read this Technote.</p> <!-- end_intro_text --><!-- begin_date --><H3>&nbsp;Updated: [Mar 27 2001]</H3><!-- end_date --></TD> </TR>    </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><a name="UsingPackages"></a><h2>Using Packages</h2><p>If you already carbonized your application but you are not delivering it as a package, then we strongly recommend that you do so. Packages have been supported since Mac OS 9.0 and are the preferred way of distributing software. Even if you still are building your application as a single file containing a CFM-based data fork and a resource fork, such as is generated by the popular MetroWerks CodeWarrior, you can still deliver it as a minimal package that will run on both Mac OS 9.x and Mac OS X:</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>folder MyCFMPkgAppl.appalias     MyCFMPkgAppl aliasfolder    Contentsfolder       MacOSClassicappl.           MyCFMPkgAppl</pre></TD></TR></TABLE></CENTER><BR><BR><p>The advantage of using the package structure is that you can then use the <code>CFBundle</code> APIs to locate the package and/or its elements, and your code will be compatible when you eventually adopt the Mach-O code format.  Furthermore, you will gain the full benefits of running on Mac OS X, which is only distributed in a package structure by Apple's ProjectBuilder:</p><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>folder MyMachOPkgAppl.appalias     MyMachOPkgAppl aliasfolder    Contentsfolder       MacOSappl.           MyMachOPkgApplfolder       Resourcesfile            MyMachOPkgAppl.rsrc&#133;               &#133;&#133;            &#133;</pre></TD></TR></TABLE></CENTER><BR><BR><BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>For more details on packages, read Technote <A HREF = "tn1188.html">TN1188, "Packages in Mac&nbsp;OS&nbsp;9"</A></P></TD></TR></TABLE></CENTER><BR><BR><P>If you don't use the package structure now, then you will have to change your code again when you switch from CFM to Mach-O in the future even though you would be using the same Carbon APIs. </p><a name="CFBundleAPIs"></a><h2>CFBundle APIs</h2><P>	There are 3 popular methods used by developers to locate the running application. There are three equivalent modern CFBundle APIs to replace them and one extra Process Manager API available on Mac OS X only.</p><p>Here are the 3 CFBundle APIs:</p><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSErr GetApplicationPackageFSSpecFromBundle(FSSpecPtr theFSSpecPtr) { OSErr err = fnfErr; CFBundleRef myAppsBundle = CFBundleGetMainBundle(); if (myAppsBundle == NULL) return err; CFURLRef myBundleURL = CFBundleCopyBundleURL(myAppsBundle); if (myBundleURL == NULL) return err;<BR> FSRef myBundleRef; Boolean ok = CFURLGetFSRef(myBundleURL, &amp;myBundleRef); CFRelease(myBundleURL); if (!ok) return err;<BR> return FSGetCatalogInfo(&amp;myBundleRef, kFSCatInfoNone,      NULL, NULL, theFSSpecPtr, NULL); }OSErr GetApplicationResourceFSSpecFromBundle(FSSpecPtr theFSSpecPtr) { OSErr err = fnfErr; CFBundleRef myAppsBundle = CFBundleGetMainBundle(); if (myAppsBundle == NULL) return err; CFURLRef myBundleURL = CFBundleCopyResourcesDirectoryURL(myAppsBundle); if (myBundleURL == NULL) return err;<BR> FSRef myBundleRef; Boolean ok = CFURLGetFSRef(myBundleURL, &amp;myBundleRef); CFRelease(myBundleURL); if (!ok) return err;<BR> return FSGetCatalogInfo(&amp;myBundleRef, kFSCatInfoNone,      NULL, NULL, theFSSpecPtr, NULL); }OSErr GetExecutableParentFSSpecFromBundle(FSSpecPtr theFSSpecPtr) { OSErr err = fnfErr; CFBundleRef myAppsBundle = CFBundleGetMainBundle(); if (myAppsBundle == NULL) return err; CFURLRef myBundleURL = CFBundleCopyExecutableURL(myAppsBundle); if (myBundleURL == NULL) return err;<BR> FSRef myBundleRef; Boolean ok = CFURLGetFSRef(myBundleURL, &amp;myBundleRef); CFRelease(myBundleURL); if (!ok) return err;<BR> return FSGetCatalogInfo(&amp;myBundleRef, kFSCatInfoNone,      NULL, NULL, theFSSpecPtr, NULL); }</pre></TD></TR><TR><td align="left"><P><b>Listing 1</b> - CFBundle APIs</p></TD></TR></TABLE></CENTER><BR><BR><P>The Process Manager extra API available only on Mac OS X:</p><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSErr GetApplicationBundleFSSpec(FSSpecPtr theFSSpecPtr) { OSErr err; ProcessSerialNumber psn; err = GetCurrentProcess(&amp;psn); if (err != noErr) return err;<BR> FSRef location; err = GetProcessBundleLocation(&amp;psn, &amp;location); if (err != noErr) return err;<BR> return FSGetCatalogInfo(&amp;location, kFSCatInfoNone,      NULL, NULL, theFSSpecPtr, NULL); }</pre></TD></TR><TR><td align="left"><P><b>Listing 2</b> - Process Manager API</p></TD></TR></TABLE></CENTER><BR><BR><a name="OlderMethods"></a><h2>Older Methods</h2><p>And here are the three older methods used by developers in the past:</p><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><pre>OSErr GetApplicationPackageFSSpec(FSSpecPtr theFSSpecPtr) { OSErr err; Str255 applName; ProcessSerialNumber psn; ProcessInfoRec info; info.processInfoLength = sizeof(ProcessInfoRec); info.processName = applName; info.processAppSpec = theFSSpecPtr;<BR> err = GetCurrentProcess(&amp;psn); if (err != noErr) return err;<BR> err = GetProcessInformation(&amp;psn, &amp;info); return err; }OSErr GetApplicationResourceFSSpec(OSType creator,     FSSpecPtr theFSSpecPtr) { Handle creatorHandle; OSErr err; Str255 applName; FCBPBRec theFCBPBRec; // creator is the 4-byte creator code of your application // necessarily unique and sure to belong to your application // resource fork only. creatorHandle = GetResource(creator, 0); if (creatorHandle == NULL) return resNotFound; theFCBPBRec.ioCompletion = nil; theFCBPBRec.ioNamePtr = applName; theFCBPBRec.ioRefNum = HomeResFile(creatorHandle); theFCBPBRec.ioFCBIndx = 0;<BR> err = PBGetFCBInfoSync(&amp;theFCBPBRec); if (err != noErr) return err;<BR> err = FSMakeFSSpec(theFCBPBRec.ioFCBVRefNum,      theFCBPBRec.ioFCBParID,      applName, theFSSpecPtr); return err; }OSErr GetExecutableParentFSSpec(OSType creator,     FSSpecPtr theFSSpecPtr) { Handle creatorHandle; OSErr err; Str255 volName; short vRefNum; long dirID; // creator is the 4-byte creator code of your application // necessarily unique and sure to belong to your application // resource fork only. creatorHandle = GetResource(creator, 0); if (creatorHandle == NULL) return resNotFound;<BR> err = HGetVol(volName, &amp;vRefNum, &amp;dirID); if (err != noErr) return err; // the vRefNum returned by HGetVol is not // really a volume Reference Number // so we need the following extra call // which assumes that the executable and // the resources are on the same volume<BR> err = GetVRefNum(HomeResFile(creatorHandle), &amp;vRefNum); if (err != noErr) return err;<BR> err = FSMakeFSSpec(vRefNum, dirID, nil, theFSSpecPtr); return err; }</pre></TD></TR><TR><td align="left"><P><b>Listing 3</b> - Older methods</p></TD></TR></TABLE></CENTER><BR><BR><p>As an anecdote, it is worthwhile to mention that there was a fourth way which used undocumented side effects (read: unreliable) of a File Manager routine.  Specifically, calling <code>FSMakeFSSpec</code>(0, 0, nil, <code>theFSSpecPtr</code>) very early after the application launch would fill the <code>FSSpec</code> with the default directory of the default volume, and the folder containing the application.</p><a name="TheResults"></a><h2>The Results</h2><p>To illustrate the advantages of the packaging and <code>CFBundle</code> APIs, let's see what each method returns in all the following cases:</p><p><b>case 1:</b> Carbon CFM Application distributed as a file running on Mac OS 9.</p><p><b>case 2:</b> Carbon CFM Application distributed as a file running on Mac OS X.</p><BR><p><b>case 3:</b> Carbon CFM Application distributed as a package running on Mac OS 9.</p><p><b>case 4:</b> Carbon CFM Application distributed as a package running on Mac OS X.</p><BR><p>the ultimate goal:</p><p><b>case 5:</b> Carbon Mach-O Application distributed as a package running on Mac OS X.</p><BR><p>and let's call the <code>CFBundle</code> methods: 1.a, 1.b, and 1.c, the Process Manager method: 2, and the older methods: 3.a, 3.b, and 3.c.</p><p>We fill the following table with the object pointed by the <code>FSSpec</code>:</p><BR><BR><CENTER><TABLE BORDER=1 WIDTH=550><TR><td align="left">&nbsp;</td><td align="left"> <center>1.a</center></td><td align="left"> <center>1.b</center></td><td align="left"> <center>1.c</center></td><td align="left"> <center>2</center></td><td align="left"> <center>3.a</center></td><td align="left"> <center>3.b</center></td><td align="left"> <center>3.c</center></td></tr><TR><td align="left"><b>case 1</b></td><td align="left"> <center>appl folder</center></td><td align="left"> <center>N/A</center></td><td align="left"> <center>appl file</center> </td><td align="left"><center>N/A</center></td><td align="left"><center>appl file</center></td><td align="left"> <center>appl file</center> </td><td align="left"><center>appl folder</center></td></tr><TR><td align="left"><b>case 2</b></td><td align="left"> <center>appl folder</center></td><td align="left"> <center>appl folder</center> </td><td align="left"><center>appl file</center> </td><td align="left"><center>N/A</center> </td><td align="left"><center>appl file</center></td><td align="left"> <center>appl file</center></td><td align="left"> <center>appl folder</center></td></tr><TR><td align="left"><b>case 3</b></td><td align="left"> <center>.app "folder"</center></td><td align="left"> <center>N/A</center></td><td align="left"> <center>appl binary</center></td><td align="left"> <center>N/A</center> </td><td align="left"><center>appl binary</center></td><td align="left"> <center>appl binary</center></td><td align="left"> <code><center>MacOSClassic</center></code></td></tr><TR><td align="left"><b>case 4</b></td><td align="left"> <center>.app "folder"</center> </td><td align="left"><center>N/A</center> </td><td align="left"><center>appl binary</center></td><td align="left"> <center>N/A</center></td><td align="left"> <center>appl binary</center> </td><td align="left"><center>appl binary</center></td><td align="left"> <code><center>MacOSClassic</center></code></td></tr><TR><td align="left"><b>case 5</b></td><td align="left"> <center>.app "folder"</center> </td><td align="left"><code><center>Resources</center></code> </td><td align="left"><center>appl binary</center> </td><td align="left"><center>.app "folder"</center> </td><td align="left"><center>appl binary</center> </td><td align="left"><center>rsrc file</center> </td><td align="left"><code><center>MacOS</center></code></td></tr></table></center><BR><P>When the application is delivered as a package, locating the application binary (the file containing the object code) is not a great help since it would be dangerous to assume that the structure of a package will never change. Thus, the only safe way to locate the application as the user sees it (its icon, a.k.a., the .app "folder") is to use either method 1.a or method 2.</p><a name="Summary"></a><P>Depending on your current distribution constraints, i.e., which platforms you're targeting, you will have to choose whichever method is the most appropriate for you, but as you can see in the table above, the best way to pave the route to case 5 is to adopt the package structure and use the <code>CFBundle</code> APIs even if you still temporarily use the CFM format.</P><BR><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P>Technote <A HREF = "tn1188.html">TN1188, "Packages in Mac&nbsp;OS&nbsp;9"</A></p><BR><P><A HREF="#top">Back to top</A></P><A NAME="Downloads"></A> <h2>Downloadables</h2><center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600"> <TR> <td width=50 align=left>   <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P></TD><td align="left">   <p>Acrobat version of this Note (352K).</P></TD><td width=60 align=left>   <p><A HREF="pdf/tn2015.pdf">Download</A></P></TD>  </TR> </table></center>  <BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2015.html%3Fid%3DDTS10003054-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2015.html%3Fid%3DDTS10003054-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2015.html%3Fid%3DDTS10003054-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>