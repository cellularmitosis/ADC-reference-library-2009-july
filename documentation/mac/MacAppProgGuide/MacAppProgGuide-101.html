<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Overview (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING101></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-100.html"><B>Chapter 17 - Working With Views</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING101-0></A>
<H1>Overview</H1>
 MacApp uses view objects (or views) to represent a window and each of its parts. Each view is an instance of a subclass of MacApp's <CODE>TView</CODE> class. The <CODE>TView</CODE> class provides methods for drawing, highlighting a selection, showing a help balloon, dealing with superviews and subviews, and performing translations between different types of coordinates.<P>
 The views in a window are linked into a hierarchy, starting with the window view itself. One view represents the window frame, another a scroll bar, another the main content area of the window, and so on. Each view can draw its part of the window and can respond to events relating to its part.<P>
<DL>
<DT><B>Note</B>
<DD>Views can also exist outside of windows for use in menus and printing.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING101-4></A>
<H2><A NAME=MARKER-2-20></A>The TView Class</H2>
 The abstract class <CODE>TView</CODE> serves as the base class for all view classes in MacApp. Some of the methods of <CODE>TView</CODE> are fully functional, but others are empty--the code to perform the intended operation must be implemented by a subclass. The following sections describe some of the view fields and methods that are used by most applications. Refer to the <I>MacApp Class and Method Reference</I> or use a code browser to examine additional fields and methods that may be important to your application. <P>
<A NAME=HEADING101-6></A>
<H3><A NAME=MARKER-2-21></A>Fields of TView</H3>
 Some of the most commonly used fields of <CODE>TView</CODE> are shown here:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-22></A>fDocument</CODE>
<DD> Refers to the document associated with the view.
<DT><CODE><A NAME=MARKER-2-23></A>fEnabled</CODE>
<DD> Defined in <CODE>TEventHandler</CODE>. Specifies whether the view can respond to mouse clicks, keystrokes, and other events.
<DT><CODE><A NAME=MARKER-2-24></A>fLocation</CODE>
<DD> Stores the offset of the upper-left corner of the view from the upper-left corner of its superview.
<DT><CODE><A NAME=MARKER-2-25></A>fShown</CODE>
<DD> Specifies whether the view should be shown.
<DT><CODE><A NAME=MARKER-2-26></A>fSize</CODE>
<DD> Stores the size of the view in view coordinates.
<DT><CODE><A NAME=MARKER-2-27></A>fSubView</CODE>
<DD> Refers to the first subview in a linked list of the view's subviews.
<DT><CODE><A NAME=MARKER-2-28></A>fSuperView</CODE>
<DD> Refers to the view's superview; always <CODE>NULL</CODE> if the view is a window object.
</DL>
 The <CODE>TView</CODE> class has many other fields, defined in the file <CODE>UView.h</CODE>.<P>
<A NAME=HEADING101-16></A>
<H3><A NAME=MARKER-2-29></A>Methods of TView</H3>
 <A HREF=#MARKER-9-36>Figure 17-1</A> shows some of the classes and methods you use most often in working with views. They include the following:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-30></A>CalcMinFrame</CODE>
<DD> Computes the view's current frame, which is usually determined from its size and location. Your view class can adjust for other factors.
<DT><CODE><A NAME=MARKER-2-31></A>Close</CODE>
<DD> Calls the view's <CODE>Changed</CODE> method to notify any dependents that the view is closing, then calls <CODE>Close</CODE> on each subview, if any.
<DT><CODE><A NAME=MARKER-2-32></A>DoHighlightSelection</CODE>
<DD> Highlights the current selection in the view. It does nothing in <CODE>TView</CODE> but is overridden in <CODE>TGridView</CODE> and other view subclasses.
<DT><CODE>DoMakeDragCursorRegion</CODE>
<DD> The <CODE>DoMakeDragCursorRegion</CODE> method creates and returns a region, in local coordinates, that can be used to test whether the mouse is in a location that would initiate a drag operation (and over which the cursor image should be set to a drag cursor).
<DT><CODE><A NAME=MARKER-2-33></A>DoMouseCommand</CODE>
<DD> In <CODE>TView</CODE> the <CODE>DoMouseCommand</CODE> method does nothing. Many of MacApp's view classes override <CODE>DoMouseCommand</CODE> to track the mouse in the view, and you may wish to do so in your view classes as well.
<DT><CODE><A NAME=MARKER-2-34></A>DoPostCreate</CODE>
<DD> When you use MacApp's global view server object <A HREF=#MARKER-9-50>(page 425)</A> to create a view hierarchy from a resource, the view server calls <CODE>DoPostCreate</CODE> after the entire view hierarchy has been created. You can override this method to do further initialization at a time when you know all the views in the hierarchy have been created.
</DL>
<B>Figure 17-1  <A NAME=MARKER-2-35></A><A NAME=MARKER-9-36></A>View-handling classes and methods</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-017.gif"><P>
<DL>
<DT><CODE>DoSetCursor</CODE>
<DD> Sets the cursor to the grabber hand if a drag would initiate a drag operation; otherwise, it sets the cursor based on the view's <CODE>fCursorID</CODE> field. If the value of <CODE>fCursorID</CODE> is <CODE>kNoResource</CODE>, it sets the arrow cursor.
<DT><CODE><A NAME=MARKER-2-37></A>Draw</CODE>
<DD> Draws the contents of the view. It does nothing in <CODE>TView</CODE>. It is overridden in many MacApp views and in most of your views as well.
<DT><CODE><A NAME=MARKER-2-38></A>DrawContents</CODE>
<DD> The <CODE>TView::Update</CODE> method calls <CODE>DrawContents</CODE> to draw the view's contents; <CODE>DrawContents</CODE> causes the <CODE>Draw</CODE> method to be called for each subview that needs to be drawn. You don't normally override this method.
<DT><CODE><A NAME=MARKER-2-39></A>Focus</CODE>
<DD> Attempts to set up the drawing environment of the view, which includes the port, origin, offset, and clipping. You rarely override this method.
<DT><CODE><A NAME=MARKER-2-40></A>Locate</CODE>
<DD> Relocates the view to the specified location (calls the <CODE>SetFrame</CODE> method, without changing the size).
<DT><CODE><A NAME=MARKER-2-41></A>Resize</CODE>
<DD> Resizes the view to the specified size (calls the <CODE>SetFrame</CODE> method, without changing the location).
<DT><CODE><A NAME=MARKER-2-42></A>TView</CODE>
<DD> The constructor puts the view object into a safe state, setting fields to <CODE>NULL</CODE> or to default values.
<DT><CODE><A NAME=MARKER-2-43></A>~TView</CODE>
<DD> The destructor method performs various cleanup operations, including freeing all subviews, resetting the application's target, freeing the view's drawing environment object, and removing the view's adorners.
<DT><CODE>WillDrag</CODE>
<DD> The <CODE>WillDrag</CODE> method returns <CODE>TRUE</CODE> if the view can drag and the cursor is over draggable content. You don't normally override this method.
</DL>
 The <CODE>TView</CODE> class also includes methods that provide stream support for view objects. These methods can read and write data for individual views, as well as for entire view hierarchies.<P>
<DL>
<DT><CODE><A NAME=MARKER-2-44></A>WriteFields</CODE>
<DD> Writes view data to a stream.
<DT><CODE><A NAME=MARKER-2-45></A>ReadFields</CODE>
<DD> Reads view data from a stream.
<DT><CODE><A NAME=MARKER-2-46></A>WriteSubViews</CODE>
<DD> Writes a view's subviews to a stream.
<DT><CODE><A NAME=MARKER-2-47></A>ReadSubViews</CODE>
<DD> Reads a view's subviews from a stream and adds them to the view.
</DL>
 You override <CODE>WriteFields</CODE> and <CODE>ReadFields</CODE> if you have added fields to a view class and want the values of those variables preserved when writing or reading the view's data with a stream.<P>
 The <CODE>TView</CODE> class has many other methods, defined in the file <CODE>UView.h</CODE>.<A NAME=MARKER-2-48></A><A NAME=MARKER-2-49></A><P>
<A NAME=HEADING101-42></A>
<H2>Other View Classes</H2>
 You don't normally instantiate an object of type <CODE>TView</CODE>--you define a subclass of <CODE>TView</CODE>, or of one of the more than 20 specialized subclasses of <CODE>TView</CODE> provided by MacApp, which include the following:<P>
<DL>
<DT><CODE>TControl</CODE>
<DD> The <CODE>TControl</CODE> class, along with its subclasses, provides methods to deal with traditional Macintosh controls, such as radio buttons and checkboxes. Other view types that can be used as controls include pop-up menus, pictures, and icons.
<DT><CODE>TDeskScrapView</CODE>
<DD> Provides methods to help your application show the Clipboard.
<DT><CODE>TDialogView</CODE>
<DD> Duplicates (with the help of other classes) some of the Dialog Manager's functions to make a MacApp window operate like a dialog box.
<DT><CODE>TGridView</CODE>
<DD> Provides methods to deal with rows and columns of cells.
<DT><CODE>TScroller</CODE>
<DD> Calculates coordinate translations to perform scrolling in a view.
<DT><CODE>TTEView</CODE>
<DD> Displays and manipulates text.
<DT><CODE>TWindow</CODE>
<DD> Represents a Macintosh window.
</DL>
<A NAME=HEADING101-51></A>
<H2>Other View-Related Classes</H2>
 MacApp also provides two classes your application uses in working with views: <CODE>TViewServer</CODE> for creating views and <CODE>TDrawingEnvironment</CODE> for working with a view's drawing characteristics. These classes are described in the following sections.<P>
<A NAME=HEADING101-53></A>
<H3>The TDrawingEnvironment Class</H3>
 MacApp provides the <CODE>TDrawingEnvironment</CODE> class to work with characteristics of a view's graphics environment, including the pen size, pen pattern, pen mode, foreground color, and background color. You can associate an object of type <CODE>TDrawingEnvironment</CODE> with each view object, making it possible to customize the drawing environment of a view without having to define a view subclass. You can use a view-editing application to specify the drawing environment for a view in its <CODE>'View'</CODE> resource.<P>
<A NAME=HEADING101-55></A>
<H3><A NAME=MARKER-9-50></A>The TViewServer Class</H3>
 The <A NAME=MARKER-2-52></A><CODE>TViewServer</CODE> class provides methods to manage the creation of views for your application. MacApp automatically creates a <CODE>TViewServer</CODE> object and stores a reference to it in the global variable <CODE>gViewServer</CODE>. You create views by calling on the methods of <CODE>gViewServer</CODE>, which include the following:<P>
<DL>
<DT><CODE><A NAME=MARKER-2-53></A>NewPaletteWindow</CODE>
<DD> Creates a window that has a main view, which may or may not scroll, plus a nonscrolling palette along the left edge or a nonscrolling status area at the top of the window.
<DT><CODE><A NAME=MARKER-2-54></A>NewSimpleWindow</CODE>
<DD> Creates a simple window that contains one view, which may or may not scroll.
<DT><CODE><A NAME=MARKER-2-55></A>NewTemplateWindow</CODE>
<DD> Creates a window from a <CODE>'View'</CODE> resource. The window may have a view hierarchy of arbitrary complexity.
<DT><CODE><A NAME=MARKER-2-56></A>DoCreateViews</CODE>
<DD> Creates a view hierarchy using the <CODE>ReadViewsFromResource</CODE> method. Calls the root view's <CODE>AdjustSize</CODE> and <CODE>HandlePostCreate</CODE> methods. Called by <CODE>NewTemplateWindow</CODE>.
</DL>
 In the IconEdit application an icon document creates its view hierarchy with this call:<P>
<PRE>
aWindow = gViewServer-&gt;NewTemplateWindow(kIconWindowId, this);
</PRE>
 The constant kIconWindowId specifies a resource ID for a predefined view resource.<P>
<A NAME=HEADING101-64></A>
<H2><A NAME=MARKER-2-57></A><A NAME=MARKER-9-58></A>Working With View Resource Templates</H2>
 MacApp provides a useful tool for defining views and view hierarchies: view resource templates. View resource templates are described in <A HREF=#MARKER-9-58>"Specifying Views With View Resource Templates," beginning on page 217</A>.<P>
 You can use a resource-editing application such as the Ad Lib view editor (available from Apple Computer) to create view resources that specify the user interface for your application. A view resource can define an entire window or view hierarchy containing many MacApp view objects, including checkboxes, radio buttons, and other controls. You can specify the initial settings for any window or view in the hierarchy.<P>
<A NAME=HEADING101-67></A>
<H3>Defining View Resources</H3>
 The Ad Lib view editor provides a graphical environment that lets you quickly define your application's user interface. <A HREF=#MARKER-9-59>Figure 17-2</A> shows the Object Palette window from Ad Lib. As you design a window for your application, you can drag any of the view items from the Object Palette window into your window, including pop-up menus, edit text views, picture views, clusters, and radio buttons.<P>
<B>Figure 17-2  <A NAME=MARKER-9-59></A>Ad Lib's Object Palette window</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-S-066.gif"><P>
 Ad Lib allows you to set initial values for many fields in MacApp's predefined view classes. You can also specify the default target view for a window and add a drag-and-drop behavior to a view. For more information, refer to the Ad Lib user's manual.<P>
 Resource editors such as Ad Lib produce a compiled resource that you can include into your resource definition file. For example, the following line includes a 'View' resource, with resource ID k<I>Your</I>View, into a text resource definition file:<P>
<PRE>
include &quot;kYourView.rsrc&quot; 'View' (kYourView); // Some view resource.
</PRE>
 The following section describes how to convert between text and compiled resource formats.<P>
<A NAME=HEADING101-75></A>
<H3><A NAME=MARKER-9-60></A>Converting Between Resource Formats</H3>
 <A NAME=MARKER-2-61></A>It may sometimes be convenient to edit a compiled view resource with a resource editor. At other times it may be easier to edit a text resource definition with a text editor. You can use MPW's Rez resource compiler tool to convert a text resource definition into a compiled view resource. The DeRez tool converts in the other direction--from a compiled view resource into a text resource definition.<P>
 The following three MPW command lines "derez" a view (convert from a compiled view resource to a text resource definition):<P>
<PRE>
DeRez YourView.rsrc Types.r SysTypes.r &quot;{MARIncludes}MacAppTypes.r&quot; <img src = "delta.gif" BORDER=NONE>
-i &quot;{MACPlusIncludes}&quot; -only &quot;'View'(1234)&quot; &gt;YourView.derez

CleanupThreeOhViews YourView.derez

DeRez YourView.rsrc Types.r SysTypes.r &quot;{MARIncludes}MacAppTypes.r&quot; <img src = "delta.gif" BORDER=NONE>
-i &quot;{MACPlusIncludes}&quot; -only 'STR#' -only 'TxSt' &gt;&gt;YourView.derez
</PRE>
 In the first line, the <CODE><img src = "delta.gif" BORDER=NONE></CODE> symbol, created by typing Option-d, indicates that the command should be treated as one line. <I>Your</I>View.rsrc specifies a file you have created that contains a compiled <CODE>'View'</CODE> resource with ID 1234. "{MARIncludes}ViewTypes.r", Types.r, and SysTypes.r specify resource definition files that the DeRez tool should consult for information about the format of the resources to be decompiled. <CODE>&quot;{MARIncludes}ViewTypes.r&quot;</CODE> specifies a full path, but it isn't necessary to do so for Types.r and SysTypes.r. <I>Your</I>View.derez specifies the location for the converted output.<P>
 The second line invokes the MacApp <CODE>CleanupThreeOhViews</CODE> script (found in the <CODE>{MATools}</CODE> folder) to reformat the View resource text to make it easier to read.<P>
 The third line again uses the DeRez tool to get the string list resources ('STR#') from the compiled resource file and add them to the converted file. These resources are used for your window titles, control labels, Balloon Help text, and other purposes. It also gets all the text style resources ('TxSt') that may be used by your views. (DeRez doesn't know which resources you actually use; it just gets all the resources in your file, of the specified type.)<P>
 The Rez tool works in a similar manner to DeRez. Both of these MPW tools can be used with the Commando interface, which presents one or more dialog boxes that allow you to specify command options. For more information, refer to the <I>Macintosh Programmer's Workshop Reference</I>.<P>
<A NAME=HEADING101-83></A>
<H3>Creating Views From Resource Templates</H3>
 When you build your application with MPW, the Rez resource compiler compiles each text view definition into a view resource, which, along with any previously compiled <CODE>'View'</CODE> resources, becomes part of your application. Your application can then use MacApp's global view server object, <CODE>gViewServer</CODE> (<A HREF=#MARKER-9-50>page 425</A>), to create window and view objects based on the view resources you have defined. You can create any number of windows from the same view resource, with the view hierarchy for each window initialized according to the resource.<P>
 By editing your view resources and rebuilding the application, you can change the appearance and settings of a window object without recompiling the application's code. Since a window can be the root of a complex hierarchy of views, you have great flexibility in changing the appearance and behavior of your views, with fast turnaround.<P>
<A NAME=HEADING101-86></A>
<H3>Initializing Views Created by Template</H3>
 View objects, like other MacApp objects, come with a constructor to put the object into a safe state. Putting an object into a safe state includes initializing any reference variables to <CODE>NULL</CODE> so that the object can be safely deallocated if an error occurs during initialization. When you define a new view class, you should define a constructor to set the fields to safe or default values.<P>
 After a view hierarchy has been created, the view server object traverses it, starting with the root view, and calls the <CODE>DoPostCreate</CODE> method of each view object in the hierarchy. <P>
 Your view hierarchy is likely to contain some view objects based on subclasses you have defined (not just views based on MacApp classes). A view-editing application may allow you to install your view classes in a hierarchy but be unable to set initial values for the custom fields in your views. That can happen because a view editor is likely to know about MacApp's view classes, which are defined in <CODE>ViewTypes.r</CODE>, but not about classes you have defined. To initialize fields of a custom view with your view editor, you can add a view type definition to your MacApp <CODE>MAMake</CODE> file and define a corresponding template for your view editor.<P>
 You can override the <CODE>DoPostCreate</CODE> method in your view classes to set initial values and do any other work that cannot be handled automatically through the use of a view resource. For example, the IconEdit application uses the <CODE>DoPostCreate</CODE> method to store an initial zoom-magnification level.<A NAME=MARKER-2-62></A><P>
<A NAME=HEADING101-91></A>
<H2><A NAME=MARKER-2-63></A><A NAME=MARKER-2-64></A><A NAME=MARKER-9-65></A>Using Adorners With Views</H2>
 MacApp defines a number of adornment classes, each of which implements a specific kind of drawing or highlighting. You can instantiate an adorner object in your application and attach it to a view to perform a drawing task, such as highlighting or framing the view. MacApp's adorner mechanism is described in <A HREF=MacAppProgGuide-65.html#MARKER-9-74>"Adorners," beginning on page 213</A>.<P>
 MacApp's adorner classes include<P>
<DL>
<DT><CODE><A NAME=MARKER-2-66></A>TFrameAdorner</CODE>
<DD> Frames the view's adorn extent.
<DT><CODE><A NAME=MARKER-2-67></A>TLineBottomAdorner</CODE>
<DD> Adorns the bottom line of the view's adorn extent.
<DT><CODE><A NAME=MARKER-2-68></A>TLineLeftAdorner</CODE>
<DD> Adorns the left line of the view's adorn extent.
<DT><CODE><A NAME=MARKER-2-69></A>TLineRightAdorner</CODE>
<DD> Adorns the right line of the view's adorn extent.
<DT><CODE><A NAME=MARKER-2-70></A>TLineTopAdorner</CODE>
<DD> Adorns the top line of the view's adorn extent.
<DT><CODE><A NAME=MARKER-2-71></A>TOvalAdorner</CODE>
<DD> Adorns the view's adorn extent with an oval.
<DT><CODE><A NAME=MARKER-2-72></A>TRRectAdorner</CODE>
<DD> Adorns the view's adorn extent with a round rectangle.
</DL>
 For the <CODE>TView</CODE> class, the adorn extent is equal to the view's extent, which is computed by subtracting its location from its size. For the <CODE>TControl</CODE> class, the adorn extent is adjusted if the control has a shadow adorner. To specify a different adorn extent for your view, you override the <CODE>GetAdornExtent</CODE> method.<P>
 Your application can also use one of the global adorner objects defined by MacApp. These adorners are described in <A HREF=MacAppProgGuide-65.html#MARKER-9-77>"MacApp's Adorner Classes," beginning on page 213</A>.<A NAME=MARKER-2-73></A><A NAME=MARKER-2-74></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-100.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-102.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
