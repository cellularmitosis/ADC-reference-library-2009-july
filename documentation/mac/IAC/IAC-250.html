<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Writing Marking Callback Functions(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING250></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-249.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-251.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-231.html"><B>Chapter 6 - Resolving and Creating Object Specifier Records</B></A> / <A HREF="IAC-247.html"><B>Writing Object Callback Functions</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING250-0></A>
<H2><A NAME=MARKER-9-217></A><A NAME=MARKER-9-218></A>Writing Marking Callback Functions</H2>
 <A NAME=MARKER-2-219></A><A NAME=MARKER-2-220></A>Marking callback functions allow applications such as databases that can mark their own objects to take advantage of that capability when resolving object specifier records. Instead of returning a list of tokens for a group of Apple event objects that pass a test, your application can simply mark the Apple event objects and return a token that identifies how they have been marked. In this way, you can speed the resolution of complex object specifier records and reduce the amount of memory you need to allocate for tokens. <P>
 The use of marking callback functions is optional and usually makes sense if (a) you can reasonably expect that the tokens created in the process of resolving some object specifier records might not all fit in memory at once or (b) your application already uses a marking mechanism. If you want the Apple Event Manager to use marking callback functions provided by your application, you must add the <CODE>kAEIDoMarking</CODE> constant to the value of the <CODE>callbackFlags</CODE> parameter for the <CODE>AEResolve</CODE> function. If for any reason your application cannot mark a requested set of Apple event objects, it should return <CODE>errAEEventNotHandled</CODE> as the result code, and the Apple Event Manager will attempt to continue resolving the object specifier record by some other method, such as using a system marking function, if one exists. <P>
 If your application supports marking callback functions, it must provide three functions with declarations that match these examples:<P>
<PRE>
FUNCTION MyGetMarkToken (containerToken: AEDesc; 
                         containerClass: DescType; 
                         VAR Result: AEDesc): OSErr;
FUNCTION MyMark (theToken: AEDesc; markToken: AEDesc; 
                 markCount: LongInt): OSErr;
FUNCTION MyAdjustMarks (newStart, newStop: LongInt; 
                        markToken: AEDesc): OSErr;
</PRE>
 For more detailed information about these sample declarations, see <A HREF=IAC-279.html#MARKER-9-356>"Object Callback Functions,"</A> which begins on <A HREF=IAC-279.html#MARKER-9-356>page 6-109</A>.<P>
 To resolve a given object specifier record with the aid of the marking callback functions provided by your application, the Apple Event Manager first calls your application's <B>mark token function</B> (<CODE>MyGetMarkToken</CODE>), passing a token that identifies the container of the elements to be marked in the <CODE>containerToken</CODE> parameter and the container's object class in the <CODE>containerClass</CODE> parameter. The mark token function returns a mark token. A <B>mark token,</B> like other tokens, can be a descriptor record of any type; however, unlike other tokens, it identifies the way your application marks Apple event objects during the current session while resolving a single test. A mark token does not identify a specific Apple event object; rather, it allows your application to associate a group of objects with a marked set.<A NAME=MARKER-2-221></A><P>
 <A NAME=MARKER-2-222></A>After it receives the mark token, the Apple Event Manager can call your application's <B>object-marking function</B> (<CODE>MyMark</CODE>) repeatedly to mark specific Apple event objects. The Apple Event Manager passes the following information to your marking function: in the <CODE>theToken</CODE> parameter, a token for the object to be marked (obtained from the appropriate object accessor function); in the <CODE>markToken</CODE> parameter, the current mark token; and in the <CODE>markCount</CODE> parameter, the mark count. The <B>mark count</B> indicates the number of times the Apple Event Manager has called the marking function for the current mark token. Your application should associate the mark count with each Apple event object it marks. <P>
 When the Apple Event Manager needs to identify either a range of elements or the absolute position of an element in a group of Apple event objects that pass a test, it can use your application's <B>mark-adjusting function</B> (<CODE>MyAdjustMarks</CODE>) to unmark objects that it has previously marked. For example, suppose an object specifier record specifies "any row in the table 'MyCustomers' for which the City column is 'San Francisco.'" The Apple Event Manager first uses the appropriate object accessor routine to locate all the rows in the table for which the City column is "San Francisco" and calls the application's marking function repeatedly to mark them. It then generates a random number between 1 and the number of rows it found that passed the test and calls the application's mark-adjusting function to unmark all the rows whose mark count does not match the randomly generated number. If the randomly chosen row has a mark count value of 5, the Apple Event Manager passes the mark-adjusting function 5 in both the <CODE>newStart</CODE> parameter and the <CODE>newStop</CODE> parameter, and the current mark token in the <CODE>markToken</CODE> parameter. The <CODE>newStart</CODE> and <CODE>newStop</CODE> parameters identify the beginning and end of the new set of marked objects that the mark-adjusting function will create by unmarking those previously marked objects not included in the new set. <P>
 When the Apple Event Manager calls your mark-adjusting function, your application must dispose of any data structures that it may have created to mark the previously marked objects. The Apple Event Manager calls your mark-adjusting function only once for a given mark token. <A NAME=MARKER-2-223></A><P>
 A mark token is valid until the Apple Event Manager either disposes of it (by calling <CODE>AEDisposeToken</CODE>) or returns it as the result of the <CODE>AEResolve</CODE> function. If the final result of a call to the <CODE>AEResolve</CODE> function is a mark token, the Apple event objects currently marked for that mark token are those specified by the object specifier record passed to <CODE>AEResolve</CODE>, and your application can proceed to do whatever the Apple event has requested. Note that your application is responsible for disposing of a final mark token with a call to <CODE>AEDisposeToken</CODE>, just as for any other final token.<P>
 If your application supports marking, it should also provide a token disposal function. When the Apple Event Manager calls <CODE>AEDisposeToken</CODE> to dispose of a mark token that is not the final result of a call to <CODE>AEResolve</CODE>, the subsequent call to your token disposal function lets you know that you can unmark the Apple event objects marked with that mark token. A call to <CODE>AEDisposeDesc</CODE> to dispose of a mark token (which would occur if you did not provide a token disposal function) would leave the objects marked. <A NAME=MARKER-2-224></A> <A NAME=MARKER-2-225></A> <A NAME=MARKER-2-226></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-249.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-251.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
