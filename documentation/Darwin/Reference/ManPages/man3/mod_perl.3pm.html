<html><head><title>Mac OS X Server
 Manual Page For mod_perl(3pm)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3pm/mod_perl" title="Mac OS X Server
 Manual Page for mod_perl(3pm)"><a name="//apple_ref/doc/man/3/mod_perl" title="Mac OS X Server
 Manual Page for mod_perl(3pm)"><!-- headerDoc=man; indexgroup=Section 3pm; uid="//apple_ref/doc/man/3pm/mod_perl"; name=mod_perl(3pm) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with Mac&nbsp;OS&nbsp;X&nbsp;Server.  It is
not available on standard Mac OS X (client) installations.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
mod_perl(3)                          User Contributed Perl Documentation                         mod_perl(3)



<b>NAME</b>
       mod_perl - Embed a Perl interpreter in the Apache HTTP server

<b>DESCRIPTION</b>
       The Apache/Perl integration project brings together the full power of the Perl programming language
       and the Apache HTTP server.  This is achieved by linking the Perl runtime library into the server and
       providing an object oriented Perl interface to the server's C language API.  These pieces are
       seamlessly glued together by the `mod_perl' server plugin, making it is possible to write Apache
       modules entirely in Perl.  In addition, the persistent interpreter embedded in the server avoids the
       overhead of starting an external interpreter and the penalty of Perl start-up (compile) time.

       Without question, the most popular Apache/Perl module is Apache::Registry module.  This module
       emulates the CGI environment, allowing programmers to write scripts that run under CGI or mod_perl
       without change.  Existing CGI scripts may require some changes, simply because a CGI script has a
       very short lifetime of one HTTP request, allowing you to get away with "quick and dirty" scripting.
       Using mod_perl and Apache::Registry requires you to be more careful, but it also gives new meaning to
       the work "quick"!  Apache::Registry maintains a cache of compiled scripts, which happens the first
       time a script is accessed by a child server or once again if the file is updated on disk.

       Although it may be all you need, a speedy CGI replacement is only a small part of this project.
       Callback hooks are in place for each stage of a request.  Apache-Perl modules may step in during the
       handler, header parser, uri translate, authentication, authorization, access, type check, fixup and
       logger stages of a request.

<b>FAQ</b>
       The mod_perl FAQ is maintained by Frank Cringle &lt;fdc@cliwe.ping.de&gt;: <a href="http://perl.apache.org/faq/">http://perl.apache.org/faq/</a>

<b>Apache/Perl</b> <b>API</b>
       See 'perldoc Apache' for info on how to use the Perl-Apache API.

       See the lib/ directory for example modules and apache-modlist.html for a comprehensive list.

       See the eg/ directory for example scripts.

<b>mod_perl</b>
       For using mod_perl as a CGI replacement see the cgi_to_mod_perl document.

       You may load modules at server startup via:

           PerlModule Apache::SSI SomeOther::Module

       Optionally:

           PerlRequire  perl-scripts/script_to_load_at_startup.pl

       A <b>PerlRequire</b> file is commonly used for intialization during server startup time.  A PerlRequire file
       name can be absolute or relative to <b>ServerRoot</b> or a path in @INC.   A <b>PerlRequire</b>'d file must return
       a true value, i.e., the end of this file should have a:

        1; #return true value

       See eg/startup.pl for an example to start with.

       In an httpd.conf &lt;Location /foo&gt; or .htaccess you need:

           PerlHandler sub_routine_name

       This is the name of the subroutine to call to handle each request.  e.g.  in the PerlModule
       Apache::Registry this is "Apache::Registry::handler".

       If PerlHandler is not a defined subroutine, mod_perl assumes it is a package name which defines a
       subroutine named "handler".

           PerlHandler   Apache::Registry

       Would load Registry.pm (if it is not already) and call it's subroutine "handler".

       There are several stages of a request where the Apache API allows a module to step in and do
       something.  The Apache documentation will tell you all about those stages and what your modules can
       do.  By default, these hooks are disabled at compile time, see the INSTALL document for information
       on enabling these hooks.  The following configuration directives take one argument, which is the name
       of the subroutine to call.  If the value is not a subroutine name, mod_perl assumes it is a package
       name which implements a 'handler' subroutine.

           PerlChildInitHandler          (requires apache_1.3.0 or higher)
           PerlPostReadRequestHandler    (requires apache_1.3.0 or higher)
           PerlInitHandler
           PerlTransHandler
           PerlHeaderParserHandler
           PerlAccessHandler
           PerlAuthenHandler
           PerlAuthzHandler
           PerlTypeHandler
           PerlFixupHandler
           PerlHandler
           PerlLogHandler
           PerlCleanupHandler
           PerlChildExitHandler          (requires apache_1.3.0 or higher)

       Only ChildInit, ChildExit, PostReadRequest and Trans handlers are not allowed in .htaccess files.

       Modules can check if the code is being run in the parent server during startup by checking the
       $Apache::Server::Starting variable.

<b>RESTARTING</b>
       PerlFreshRestart
           By default, if a server is restarted (ala kill -USR1 `cat logs/httpd.pid`), Perl scripts and
           modules are not reloaded.  To reload <b>PerlRequire</b>'s, <b>PerlModule</b>'s, other <u>use()</u>'d modules and flush
           the <b>Apache::Registry</b> cache, enable with this command:

            PerlFreshRestart On

       PERL_DESTRUCT_LEVEL
           With Apache versions 1.3.0 and higher, mod_perl will call the <u>perl</u><b>_</b><u>destruct()</u> Perl API function
           during the child exit phase.  This will cause proper execution of <b>END</b> blocks found during server
           startup along with invoking the <b>DESTROY</b> method on global objects who are still alive.  It is
           possible that this operation may take a long time to finish, causing problems during a restart.
           If your code does not contain and <b>END</b> blocks or <b>DESTROY</b> methods which need to be run during child
           server shutdown, this destruction can be avoided by setting the <u>PERL</u><b>_</b><u>DESTRUCT</u><b>_</b><u>LEVEL</u> environment
           variable to "-1".

<b>ENVIRONMENT</b>
       Under CGI the Perl hash %ENV is magical in that it inherits environment variables from the parent
       process and will set them should a process spawn a child.  However, with mod_perl we're in the parent
       process that would normally setup the common environment variables before spawning a CGI process.
       Therefore, mod_perl must feed these variables to %ENV directly.  Normally, this does not happen until
       the response stage of a request when "PerlHandler" is called.  If you wish to set variables that will
       be available before then, such as for a "PerlAuthenHandler", you may use the "PerlSetEnv"
       configuration directive:

        PerlSetEnv  SomeKey  SomeValue

       You may also use the "PerlPassEnv" directive to pass an already existing environment variable to
       Perl's %ENV:

        PerlPassEnv SomeKey

       CONFIGURATION
           The "PerlSetVar" and "PerlAddVar" directives provide a simple mechanism for passing information
           from configuration files to Perl modules or Registry scripts.

           The "PerlSetVar" directive allows you to set a key/value pair.

            PerlSetVar  SomeKey  SomeValue

           Perl modules or scripts retrieve configuration values using the "$r-&gt;dir_config" method.

             $SomeValue = $r-&gt;dir_config('SomeKey');

           The "PerlAddVar" directive allows you to emulate Perl arrays:

            PerlAddVar  SomeKey  FirstValue
            PerlAddVar  SomeKey  SecondValue
            ...         ...      ...
            PerlAddVar  SomeKey  Nth-Value

           In the Perl modules the values are extracted using the "$r-&gt;dir_config-&gt;get" method.

             @array = $r-&gt;dir_config-&gt;get('SomeKey');

           Alternatively in your code you can extend the setting with:

             $r-&gt;dir_config-&gt;add(SomeKey =&gt; 'Bar');

           "PerlSetVar" and "PerlAddVar" handle keys case-insensitively.

       GATEWAY_INTERFACE
           The standard CGI environment variable <b>GATEWAY_INTERFACE</b> is set to "CGI-Perl/1.1" when running
           under mod_perl.

       MOD_PERL
           The environment variable `MOD_PERL' is set so scripts can say:

            if(exists $ENV{MOD_PERL}) {
                #we're running under mod_perl
                ...
            }
            else {
                #we're NOT running under mod_perl
            }

<b>BEGIN</b> <b>blocks</b>
       Perl executes "BEGIN" blocks during the compile time of code as soon as possible.  The same is true
       under mod_perl.  However, since mod_perl normally only compiles scripts and modules once, in the
       parent server or once per-child, "BEGIN" blocks in that code will only be run once.  As perlmod
       explains, once a "BEGIN" has run, it is immediately undefined.  In the mod_perl environment, this
       means "BEGIN" blocks will not be run during each incoming request unless that request happens to be
       one that is compiling the code.

       Modules and files pulled in via require/use which contain "BEGIN" blocks will be executed:
         - only once, if pulled in by the parent process
         - once per-child process if not pulled in by the parent process
         - an additional time, once per-child process if the module is pulled in off of disk again via
       Apache::StatINC
         - an additional time, in the parent process on each restart if PerlFreshRestart is On
         - unpredictable if you fiddle with %INC yourself

       <b>Apache::Registry</b> scripts which contain "BEGIN" blocks will be executed:
         - only once, if pulled in by the parent process via <b>Apache::RegistryLoader</b>
         - once per-child process if not pulled in by the parent process
         - an additional time, once per-child process if the script file has changed on disk
         - an additional time, in the parent process on each restart if pulled in by the
           parent process via <b>Apache::RegistryLoader</b> and PerlFreshRestart is On

<b>END</b> <b>blocks</b>
       As perlmod explains, an "END" subroutine is executed as late as possible, that is, when the
       interpreter is being exited.  In the mod_perl environment, the interpreter does not exit until the
       server is shutdown.  However, mod_perl does make a special case for <b>Apache::Registry</b> scripts.

       Normally, "END" blocks are executed by Perl during it's "perl_run()" function, which is called once
       each time the Perl program is executed, e.g. once per (mod_cgi) CGI scripts.  However, mod_perl only
       calls "perl_run()" once, during server startup.  Any "END" blocks encountered during main server
       startup, i.e. those pulled in by the <b>PerlRequire</b> or by any <b>PerlModule</b> are suspended and run at server
       shutdown, aka "child_exit" (requires apache 1.3.0+).  Any "END" blocks that are encountered during
       compilation of Apache::Registry scripts are called after the script done is running, including
       subsequent invocations when the script is cached in memory.  All other "END" blocks encountered
       during other Perl*Handler callbacks, e.g. <b>PerlChildInitHandler</b>, will be suspended while the process
       is running and called during "child_exit" when the process is shutting down.  Module authors may be
       wish to use "$r-&gt;register_cleanup" as an alternative to "END" blocks if this behavior is not
       desirable.

<b>MEMORY</b> <b>CONSUMPTION</b>
       Don't be alarmed by the size of your httpd after you've linked with mod_perl.  No matter what, your
       httpd will be larger than normal to start, simply because you've linked with perl's runtime.

       Here's I'm just running

        % /usr/bin/perl -e '1 while 1'

          PID USERNAME PRI NICE   SIZE   RES STATE   TIME   WCPU    CPU COMMAND
        10214 dougm     67    0   668K  212K run     0:04 71.55% 21.13% perl

       Now with a few random modules:

        % /usr/bin/perl -MDBI -MDBD::mSQL -MLWP::UserAgent -MFileHandle -MIO -MPOSIX -e '1 while 1'

        10545 dougm     49    0  3732K 3340K run     0:05 54.59% 21.48% perl

       Here's my httpd linked with libperl.a, not having served a single request:

        10386 dougm      5    0  1032K  324K sleep   0:00  0.12%  0.11% httpd-a

       You can reduce this if you configure perl 5.004+ with -Duseshrplib.  Here's my httpd linked with
       libperl.sl, not having served a single request:

        10393 dougm      5    0   476K  368K sleep   0:00  0.12%  0.10% httpd-s

       Now, once the server starts receiving requests, the embedded interpreter will compile code for each
       'require' file it has not seen yet, each new Apache::Registry subroutine that's compiled, along with
       whatever modules it's use'ing or require'ing.  Not to mention AUTOLOADing.  (Modules that you 'use'
       will be compiled when the server starts unless they are inside an eval block.)  httpd will grow just
       as big as our /usr/bin/perl would, or a CGI process for that matter, it all depends on your setup.
       The mod_perl_tuning document gives advice on how to best setup your mod_perl server environment.

       The mod_perl INSTALL document explains how to build the Apache:: extensions as shared libraries (with
       'perl Makefile.PL DYNAMIC=1').  This may save you some memory, however, it doesn't work on a few
       systems such as aix and unixware.

       However, on most systems, this strategy will only make the httpd <u>look</u> smaller.  When in fact, an
       httpd with Perl linked static with take up less real memory and preform faster than shared libraries
       at the same time.  See the mod_perl_tuning document for details.

       <b>MEMORY</b> <b>TIPS</b>


       Leaks
           If you are using a module that leaks or have code of their own that leaks, in any case using the
           apache configuration directive 'MaxRequestsPerChild' is your best bet to keep the size down.

       Perl Options
           Newer Perl versions also have other options to reduce runtime memory consumption.  See Perl's
           INSTALL file for details on "-DPACK_MALLOC" and "-DTWO_POT_OPTIMIZE".  With these options, my
           httpd shrinks down ~150K.

       Server Startup
           Use the <b>PerlRequire</b> and <b>PerlModule</b> directives to load commonly used modules such as CGI.pm, DBI,
           etc., when the server is started.  On most systems, server children will be able to share this
           space.

       Importing Functions
           When possible, avoid importing of a module functions into your namespace.  The aliases which are
           created can take up quite a bit of space.  Try to use method interfaces and fully qualified
           Package::function names instead.  Here's a freshly started httpd who's served one request for a
           script using the CGI.pm method interface:

            TTY   PID USERNAME  PRI NI   SIZE   RES  STATE   TIME %WCPU  %CPU COMMAND
              p4  5016 dougm     154 20  3808K  2636K sleep   0:01  9.62  4.07 httpd

           Here's a freshly started httpd who's served one request for the same script using the CGI.pm
           function interface:

            TTY   PID USERNAME  PRI NI   SIZE   RES  STATE   TIME %WCPU  %CPU COMMAND
              p4  5036 dougm     154 20  3900K  2708K sleep   0:01  3.19  2.18 httpd

           Now do the math: take that difference, figure in how many other scripts import the same functions
           and how many children you have running.  It adds up!

       Global Variables
           It's always a good idea to stay away from global variables when possible.  Some variables must be
           global so Perl can see them, such as a module's <b>@ISA</b> or <b>$VERSION</b> variables.  In common practice,
           a combination of "use strict" and "use vars" keeps modules clean and reduces a bit of noise.
           However, <b>use</b> <b>vars</b> also creates aliases as the <b>Exporter</b> does, which eat up more space.  When
           possible, try to use fully qualified names instead of <b>use</b> <b>vars</b>.  Example:

            package MyPackage;
            use strict;
            @MyPackage::ISA = qw(...);
            $MyPackage::VERSION = "1.00";

           vs.

            package MyPackage;
            use strict;
            use vars qw(@ISA $VERSION);
            @ISA = qw(...);
            $VERSION = "1.00";

       Further Reading
           In case I forgot to mention, read Vivek Khera's mod_perl_tuning document for more tips on
           improving Apache/mod_perl performance.

<b>SWITCHES</b>
       Normally when you run perl from the command line or have the shell invoke it with `#!', you may
       choose to pass perl switch arguments such as "-w" or "-T".  Since the command line is only parsed
       once, when the server starts, these switches are unavailable to mod_perl scripts.  However, most
       command line arguments have a perl special variable equivilant.  For example, the $^W variable
       coresponds to the "-w" switch.  Consult perlvar for more details.  With mod_perl it is also possible
       to turn on warnings globaly via the <b>PerlWarn</b> directive:

        PerlWarn On

       The switch which enables taint checks does not have a special variable, so mod_perl provides the
       <b>PerlTaintCheck</b> directive to turn on taint checks.  In httpd.conf, enable with:

        PerlTaintCheck On

       Now, any and all code compiled inside httpd will be checked.

       The environment variable <b>PERL5OPT</b> can be used to set additional perl startup flags such as <b>-d</b> and <b>-D</b>.
       See perlrun.

<b>PERSISTENT</b> <b>DATABASE</b> <b>CONNECTIONS</b>
       Another popular use of mod_perl is to take advantage of it's persistance to maintain open database
       connections.  The basic idea goes like so:

        #Apache::Registry script
        use strict;
        use vars qw($dbh);

        $dbh ||= SomeDbPackage-&gt;connect(...);

       Since $dbh is a global variable, it will not go out of scope, keeping the connection open for the
       lifetime of a server process, establishing it during the script's first request for that process.

       It's recommended that you use one of the Apache::* database connection wrappers.  Currently for DBI
       users there is "Apache::DBI" and for Sybase users "Apache::Sybase::DBlib".  These modules hide the
       peculiar code example above.  In addition, different scripts may share a connection, minimizing
       resource consumption.  Example:

        #httpd.conf has
        # PerlModule Apache::DBI
        #DBI scripts look exactly as they do under CGI
        use strict;
        my $dbh = DBI-&gt;connect(...);

       Although <b>$dbh</b> shown here will go out of scope when the script ends, the Apache::DBI module's
       reference to it does not, keep the connection open.

       <b>WARNING:</b> Do not attempt to open a persistent database connection in the parent process (via
       PerlRequire or PerlModule).  If you do, children will get a copy of this handle, causing clashes when
       the handle is used by two processes at the same time.  Each child must have it's own unique
       connection handle.

<b>STACKED</b> <b>HANDLERS</b>
       With the mod_perl stacked handlers mechanism, it is possible for more than one Perl*Handler to be
       defined and run during each stage of a request.

       Perl*Handler directives can define any number of subroutines, e.g. (in config files)

        PerlTransHandler OneTrans TwoTrans RedTrans BlueTrans

       With the method, Apache-&gt;push_handlers, callbacks can be added to the stack by scripts at runtime by
       mod_perl scripts.

       Apache-&gt;push_handlers takes the callback hook name as it's first argument and a subroutine name or
       reference as it's second. e.g.:

        Apache-&gt;push_handlers("PerlLogHandler", \&amp;first_one);

        $r-&gt;push_handlers("PerlLogHandler", sub {
            print STDERR "__ANON__ called\n";
            return 0;
        });

       After each request, this stack is cleared out.

       All handlers will be called unless a handler returns a status other than OK or DECLINED, this needs
       to be considered more.  Post apache-1.2 will have a DONE return code to signal termiation of a stage,
       which Rob and I came up with while back when first discussing the idea of stacked handlers.  2.0
       won't come for quite sometime, so mod_perl will most likely handle this before then.

       example uses:

       CGI.pm maintains a global object for it's plain function interface.  Since the object is global, it
       does not go out of scope, DESTROY is never called.  CGI-&gt;new can call:

        Apache-&gt;push_handlers("PerlCleanupHandler", \&amp;CGI::_reset_globals);

       This function will be called during the final stage of a request, refreshing CGI.pm's globals before
       the next request comes in.

       Apache::DCELogin establishes a DCE login context which must exist for the lifetime of a request, so
       the DCE::Login object is stored in a global variable.  Without stacked handlers, users must set

        PerlCleanupHandler Apache::DCELogin::purge

       in the configuration files to destroy the context.  This is not "user-friendly".  Now,
       Apache::DCELogin::handler can call:

        Apache-&gt;push_handlers("PerlCleanupHandler", \&amp;purge);

       Persistent database connection modules such as Apache::DBI could push a PerlCleanupHandler handler
       that iterates over %Connected, refreshing connections or just checking that ones have not gone stale.
       Remember, by the time we get to PerlCleanupHandler, the client has what it wants and has gone away,
       we can spend as much time as we want here without slowing down response time to the client.

       PerlTransHandlers may decide, based or uri or other condition, whether or not to handle a request,
       e.g. Apache::MsqlProxy.  Without stacked handlers, users must configure:

        PerlTransHandler Apache::MsqlProxy::translate
        PerlHandler      Apache::MsqlProxy

       PerlHandler is never actually invoked unless <u>translate()</u> sees the request is a proxy request
       ($r-&gt;proxyreq), if it is a proxy request, <u>translate()</u> set $r-&gt;handler("perl-script"), only then will
       PerlHandler handle the request.  Now, users do not have to specify 'PerlHandler Apache::MsqlProxy',
       the <u>translate()</u> function can set it with <u>push</u><b>_</b><u>handlers()</u>.

       Includes, footers, headers, etc., piecing together a document, imagine (no need for SSI parsing!):

        PerlHandler My::Header Some::Body A::Footer

       This was my first test:

        #My.pm
        package My;

        sub header {
            my $r = shift;
            $r-&gt;content_type("text/plain");
            $r-&gt;send_http_header;
            $r-&gt;print("header text\n");
        }
        sub body   { shift-&gt;print("body text\n")   }
        sub footer { shift-&gt;print("footer text\n") }
        1;
        __END__
        #in config
        &lt;Location /foo&gt;
        SetHandler "perl-script"
        PerlHandler My::header My::body My::footer
        &lt;/Location&gt;

       Parsing the output of another PerlHandler?  this is a little more tricky, but consider:

        &lt;Location /foo&gt;
          SetHandler "perl-script"
          PerlHandler OutputParser SomeApp
        &lt;/Location&gt;
        &lt;Location /bar&gt;
          SetHandler "perl-script"
          PerlHandler OutputParser AnotherApp
        &lt;/Location&gt;

       Now, OutputParser goes first, but it untie's *STDOUT and re-tie's to it's own package like so:

        package OutputParser;

        sub handler {
            my $r = shift;
            untie *STDOUT;
            tie *STDOUT =&gt; 'OutputParser', $r;
        }

        sub TIEHANDLE {
            my($class, $r) = @_;
            bless { r =&gt; $r}, $class;
        }

        sub PRINT {
            my $self = shift;
            for (@_) {
                #do whatever you want to $_
                $self-&gt;{r}-&gt;print($_ . "[insert stuff]");
            }
        }

        1;
        __END__

       To build in this feature, configure with:

        % perl Makefile.PL PERL_STACKED_HANDLERS=1 [PERL_FOO_HOOK=1,etc]

       Another method 'Apache-&gt;can_stack_handlers' will return TRUE if mod_perl was configured with
       PERL_STACKED_HANDLERS=1, FALSE otherwise.

<b>PERL</b> <b>METHOD</b> <b>HANDLERS</b>
       See mod_perl_method_handlers.

<b>PERL</b> <b>SECTIONS</b>
       With &lt;Perl&gt;&lt;/Perl&gt; sections, it is possible to configure your server entirely in Perl.

       &lt;Perl&gt; sections can contain *any* and as much Perl code as you wish.  These sections are compiled
       into a special package who's symbol table mod_perl can then walk and grind the names and values of
       Perl variables/structures through the Apache core config gears.  Most of the configurations
       directives can be represented as $Scalars or @Lists.  A @List inside these sections is simply
       converted into a single-space delimited string for you inside.  Here's an example:

        #httpd.conf
        &lt;Perl&gt;
        @PerlModule = qw(Mail::Send Devel::Peek);

        #run the server as whoever starts it
        $User  = getpwuid($&gt;) || $&gt;;
        $Group = getgrgid($)) || $);

        $ServerAdmin = $User;

        &lt;/Perl&gt;

       Block sections such as &lt;Location&gt;&lt;/Location&gt; are represented in a %Hash, e.g.:

        $Location{"/~dougm/"} = {
            AuthUserFile =&gt; '/tmp/htpasswd',
            AuthType =&gt; 'Basic',
            AuthName =&gt; 'test',
            DirectoryIndex =&gt; [qw(index.html index.htm)],
            Limit =&gt; {
                METHODS =&gt; 'GET POST',
                require =&gt; 'user dougm',
            },
        };

        #If a Directive can take say, two *or* three arguments
        #you may push strings and the lowest number of arguments
        #will be shifted off the @List
        #or use array reference to handle any number greater than
        #the minimum for that directive

        push @Redirect, "/foo", "<a href="http://www.foo.com/">http://www.foo.com/</a>";

        push @Redirect, "/imdb", "<a href="http://www.imdb.com/">http://www.imdb.com/</a>";

        push @Redirect, [qw(temp "/here" "<a href="http://www.there.com">http://www.there.com</a>")];

       Other section counterparts include %VirtualHost, %Directory and %Files.

       These are somewhat boring examples, but they should give you the basic idea.  You can mix in any Perl
       code your heart desires.  See eg/httpd.conf.pl and eg/perl_sections.txt for some examples.

       A tip for syntax checking outside of httpd:

        &lt;Perl&gt;
        #!perl

        #... code here ...

        __END__
        &lt;/Perl&gt;

       Now you may run "perl -cx httpd.conf".

       It may be the case that &lt;Perl&gt; sections are not completed or an oversight was made in an certain
       area.  If they do not behave as you expect, please send a report to the modperl mailing list.

       To configure this feature build with
        'perl Makefile.PL PERL_SECTIONS=1'

<b>mod_perl</b> <b>and</b> <b>mod_include</b> <b>integration</b>
       As of apache 1.2.0, mod_include can handle Perl callbacks.

       A `sub' key value may be anything a Perl*Handler can be: subroutine name, package name (defaults to
       package::handler), Class-&gt;method call or anonymous sub {}

       Example:

        Child &lt;!--#perl sub="sub {print $$}" --&gt; accessed
        &lt;!--#perl sub="sub {print ++$Access::Cnt }" --&gt; times. &lt;br&gt;

        &lt;!--#perl sub="Package::handler" arg="one" arg="two" --&gt;

        #don't forget to escape double quotes!
        Perl is
               &lt;!--#perl sub="sub {for (0..10) {print \"very \"}}"--&gt;
               fun to use!

       The <b>Apache::Include</b> module makes it simple to include <b>Apache::Registry</b> scripts with the mod_include
       perl directive.

       Example:

        &lt;!--#perl sub="Apache::Include" arg="/perl/ssi.pl" --&gt;

       You can also use 'virtual include' to include Apache::Registry scripts of course.  However, using
       #perl will save the overhead of making Apache go through the motions of creating/destroying a
       subrequest and making all the necessary access checks to see that the request would be allowed
       outside of a 'virtual include' context.

       To enable perl in mod_include parsed files, when building apache the following must be present in the
       Configuration file:

        EXTRA_CFLAGS=-DUSE_PERL_SSI -I. `perl -MExtUtils::Embed -ccopts`

       mod_perl's Makefile.PL script can take care of this for you as well:

        perl Makefile.PL PERL_SSI=1

       If you're interested in sprinkling Perl code inside your HTML documents, you'll also want to look at
       the Apache::Embperl (<a href="http://perl.apache.org/embperl/)">http://perl.apache.org/embperl/)</a> Apache::ePerl and Apache::SSI modules.

<b>DEBUGGING</b>
       MOD_PERL_TRACE
           To enable mod_perl debug tracing configure mod_perl with the PERL_TRACE option:

            perl Makefile.PL PERL_TRACE=1

           The trace levels can then be enabled via the <b>MOD_PERL_TRACE</b> environment variable which can
           contain any combination of:

            d - Trace directive handling during configuration read
            s - Trace processing of perl sections
            h - Trace Perl*Handler callbacks
            g - Trace global variable handling, intepreter construction, END blocks, etc.
            all - all of the above

       spinning httpds
           To see where an httpd is "spinning", try adding this to your script or a startup file:

             use Carp ();
             $SIG{'USR1'} = sub {
                Carp::confess("caught SIGUSR1!");
             };

           Then issue the command line:

             kill -USR1 &lt;spinning_httpd_pid&gt;

<b>PROFILING</b>
       It is possible to profile code run under mod_perl with the <b>Devel::DProf</b> module available on CPAN.
       However, you must have apache version 1.3.0 or higher and the "PerlChildExitHandler" enabled.  When
       the server is started, <b>Devel::DProf</b> installs an "END" block to write the <u>tmon.out</u> file, which will be
       run when the server is shutdown.  Here's how to start and stop a server with the profiler enabled:

        % setenv PERL5OPT -d:DProf
        % httpd -X -d `pwd` &amp;
        ... make some requests to the server here ...
        % kill `cat logs/httpd.pid`
        % unsetenv PERL5OPT
        % dprofpp

       See also: <b>Apache::DProf</b>

<b>BENCHMARKING</b>
       How much faster is mod_perl that CGI?  There are many ways to benchmark the two, see the "benchmark/"
       directory for some examples.

       See also: <b>Apache::Timeit</b>

<b>WARNINGS</b>
       See mod_perl_traps.

<b>SUPPORT</b>
       See the SUPPORT file.

<b>Win32</b>
       See INSTALL.win32 for building from sources.

       Info about win32 binary distributions of mod_perl are available from:

        <a href="http://perl.apache.org/distributions/">http://perl.apache.org/distributions/</a>

<b>REVISION</b>
       $Id: mod_perl.pod 177659 2002-01-02 09:41:23Z stas $

<b>AUTHOR</b>
       Doug MacEachern



perl v5.8.8                                      2007-07-17                                      mod_perl(3)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/mod_perl.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/mod_perl.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/mod_perl.3pm.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
