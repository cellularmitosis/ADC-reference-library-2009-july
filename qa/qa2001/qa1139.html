<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QA1139: Retrieving Data from AEDesc Records - do not use the dataHandle field</title><meta name="keywords" content="AEDesc data retrieval"><meta name="Description" content="Technical Q&amp;A QA1139: A description of the correct way toaccess data stored in AEDesc records."><meta name="categories" content="Overview, Interapplication Communication and AppleScript"><meta name="week-posted" content="Apr 8, 2002 - Apr 12, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001684" title="Retrieving Data from AEDesc Records - do not use the dataHandle field"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/Carbon/index.html">Carbon</a> &gt; <a href="../../technicalqas/Carbon/idxInterapplicationCommunication-date.html">Interapplication Communication</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1139</div>
<div id="pageheadsub">Retrieving Data from AEDesc Records - do not use the dataHandle field</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><hr width=500 align=center>         <P id=p2>Q: How should I retrieve the data stored in an Apple event descriptorrecord?</p><P id=p4>A: You cannot use direct memory access to retrieve the dataassociated with an Apple event descriptor record using the Carbon Apple Event ManagerAPIs.  Apple provides two Carbon accessor APIs (<CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescDataSize">AEGetDescDataSize</A></CODE> and<CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescData">AEGetDescData</A></CODE>) that allow you to retrieve a copy of the datastored in an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> structure.  Appropriate use of these two APIsis illustrated in <A HREF="#howto">Listing 1</A>.       </p>            <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B><A NAME="howto" kind = "Listing">Listing 1</A></B>. Using <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescDataSize">AEGetDescDataSize</A></CODE> and <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescData">AEGetDescData</A></CODE> to retrieve a copy of the data stored in an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record.</P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre>Ptr theData;Size theLength;<A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A> theDesc;<a href="../ov/ov02.html">OSStatus</A> err;    ....    /* find out the length of the data stored    in the descriptor record */theLength = <A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescDataSize">AEGetDescDataSize</A>(&theDesc);    /* allocate a buffer to hold a copy    of the data */theData = malloc(theLength);if (theData != NULL) {        /* copy the data to the buffer */    err = <A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescData">AEGetDescData</A>(theDesc, theData, theLength);    if ( err == noErr) {        /* perform some operation with the        extracted data */        ....</pre></TD></TR></TABLE></CENTER><BR><BR>          <P id=p4>To change the data stored in an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record, applications can use the routine<CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEReplaceDescData">AEReplaceDescData</A></CODE>.  </p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT:</B><BR>The <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescData">AEGetDescData</A></CODE>, <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEGetDescDataSize">AEGetDescDataSize</A></CODE>, and<CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/Functions/Operating_On_d_146_s_Data.html#//apple_ref/C/func/AEReplaceDescData">AEReplaceDescData</A></CODE> routines can only be used with descriptors thatstore simple values - they cannot be used with compound descriptor record typessuch as <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AppleEvent.html">AppleEvent</A></CODE> records, <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AERecord.html">AERecord</A></CODE> records,and <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDescList.html">AEDescList</A></CODE> records.  Attempting to use these routineswith compound descriptor record types may produce unexpected results oreven application crashes.</P></TD></TR></TABLE></CENTER><BR><BR>                                      <H2>Background</H2><P id=p4><CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> structures contain two components: a descriptor typefield and a data field.  The descriptor type field contains a thirty-two bitcode (often four ASCII letters) identifying the type of data stored in thedescriptor record.   The data field is used internally by the Apple Event Managerto store a reference to the data associated with the descriptor record.<A HREF="#declrat">Listing 2</A> shows the declaration for an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE>structure.</p>     <BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B><A NAME="declrat" kind = "Listing">Listing 2</A></B>. <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> structure declaration.</P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre>typedef AEDataStorageType *AEDataStorage;struct <A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A> {    <A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/DescType.html">DescType</A>       descriptorType; /* the data type field */    AEDataStorage  dataHandle;     /* the data field */};</pre></TD></TR></TABLE></CENTER><BR><BR><P id=p4>Implementations of the Apple Event Manager in versions of theMac OS prior to Mac OS X used the <CODE>dataHandle</CODE> field to store the informationassociated with an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record in a block of memory referred toby a Carbon Memory Manager <CODE>Handle</CODE>.  But, with the advent of the CarbonAPIs and Mac OS X, the <CODE>dataHandle</CODE> field in the <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE>structure was changed to an opaque pointer type.  With that change, it becameinappropriate for software to make assumptions about the meaning of the contentsof this field.</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>WARNING:</B><BR>Code that uses the value stored in the <CODE>dataHandle</CODE> field in an <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE>structure or assumes that the <CODE>dataHandle</CODE> field contains a CarbonMemory Manager <CODE>Handle</CODE> is not supported and may not work in futureimplementations of the Apple Event Manager in Mac OS X.</P></TD></TR></TABLE></CENTER><BR><BR>                    <P id=p4>The <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> structure itself is not opaque.  As such, it ispossible for application software to access the <CODE>descriptorType</CODE> fieldto determine the type of data stored in the <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record.  Applications should not make any assumptions about the meaning of the value stored inthe <CODE>dataHandle</CODE> field.  For best results, developers should structuretheir code so that it does not depend on, or make any assumptions about, the contentsof the <CODE>dataHandle</CODE> field (as shown in <A HREF="#vartwo">Listing 3</A>).  </p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B><A NAME="vartwo" kind = "Listing">Listing 3</A></B>. Sample of structuring code so it does not use the value stored in the <CODE>dataHandle</CODE> field ofan <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record.</P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre>    <A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A> theDesc;    char* p = "Hello World";        /* create the descriptor */    err = <A href="../../documentation/mac/IAC/IAC-209.html">AECreateDesc</A>(typeChar, p, strlen(p), &theDesc);    if (err == noErr) {        /* perform some operations using        the descriptor */            /* delete the descriptor */        <A href="../../documentation/mac/IAC/IAC-176.html">AEDisposeDesc</A>(&theDesc);    }</pre></TD></TR></TABLE></CENTER><BR><BR><H2>The Exception to the Rule</H2><P id=p4>It is okay for code to compare the <CODE>dataHandle</CODE> field to <CODE>NULL</CODE> to determine whether the <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record has any data associated with it, as shown in <A HREF="#exeptor">Listing 4</A>. However, it does not make sense to use the <CODE>dataHandle</CODE> field in any other way.</p><BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550><TR><td align="left"><P><B><A NAME="exeptor" kind = "Listing">Listing 4</A></B>. Examples of code that makessafe assumptions about the <CODE>dataHandle</CODE> field in and <CODE><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A></CODE> record.</P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre><A href="../../documentation/Carbon/interapplicationcomm/AppleEventManager/Apple_Event_Manager/DataTypes/AEDesc.html">AEDesc</A> d = { typeNull, NULL };  // Initialize a new empty descriptorif (d.dataHandle != NULL)  // A cheap check for a non-empty descriptor</pre></TD></TR></TABLE></CENTER><BR><BR>                    <hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Apr 10 2002]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1139.html%3Fid%3DDTS10001684-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1139.html%3Fid%3DDTS10001684-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1139.html%3Fid%3DDTS10001684-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>