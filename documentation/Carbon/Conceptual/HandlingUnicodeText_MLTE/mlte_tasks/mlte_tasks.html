<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Handling Unicode Text Editing With MLTE: MLTE Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="MLTE Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000088" title="MLTE Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../TextFonts/index.html#//apple_ref/doc/uid/TP30000440-TP30000435" target="_top">Text &amp; Fonts</a> &gt; <a href="../../../../TextFonts/Carbon-date.html#//apple_ref/doc/uid/TP30000440-TP30000435-TP30000494" target="_top">Carbon</a> &gt; <a href="../mlte_intro/mlte_intro.html#//apple_ref/doc/uid/TP30000086-DontLinkElementID_111">Handling Unicode Text Editing With MLTE</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../mlte_concepts/mlte_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../mlte_docrevhx/mlte_docrevhx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_112" title="MLTE Tasks"></a><h1><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIDHIFH" title="MLTE Tasks"></a>MLTE Tasks</h1><p>This chapter provides instructions and code samples for the most common tasks you can accomplish with Multilingual Text Engine (MLTE), such as displaying static text, working with document-wide settings, and handling File, Edit, and Font menu commands. </p><p>The section on advanced topics includes working with embedded objects (graphics, sound, movies), displaying chemical equations, and displaying advanced typographical features (such as ligatures). </p><p>You should read the section <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIFCGJD">“Migrating an Application from TextEdit to MLTE”</a></span> if you have an existing application that uses TextEdit, and you want to determine what you need to do to rewrite the code so your application uses MLTE instead.</p><p>The code samples assume you are developing your application on Mac OS using CarbonLib. All code samples in this chapter are in C.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIBIGAI">Displaying Static Text</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCICICFB">Initializing MLTE</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIJHBII">Terminating MLTE</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIGCJAG">Working With Text Objects</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIHJEEJ">Handling File and Edit Menu Commands</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIHIGCB">Setting Font Size and Style</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF113">Handling Multiple Text Objects</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCEAJ">Posting an Alert</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIHGDJB">Working With Document-Wide Settings</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIFIAFA">Advanced Topics</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF125">Supporting Monostyled Text</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCDIEBB">Customizing MLTE Support for Carbon Events</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG">Writing an Action Key Mapping Callback Function</a>
				
			<br/>
			
        
			
			
				<a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIFCGJD">Migrating an Application from TextEdit to MLTE</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIBIGAI" title="Displaying Static Text"></a><h2>Displaying Static Text</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_298"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_299"></a><p>MLTE provides an easy way for your application to display static text whether or not it uses other MLTE features to implement editing services. You do not need to initialize MLTE to display static text. You can use a static text box for such purposes as displaying text information associated with a control. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_113" title="Note"></a><p><strong>Note:</strong>&nbsp;If you want to display a document that is read-only, do not use a static text box. Instead, call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code> to create a text object with the frame options parameter (<code>iFrameOptions</code>) set to read only (<code>kTXNReadOnlyMask</code>).</p></div><p>The <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawUnicodeTextBox" target="_top">TXNDrawUnicodeTextBox</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawCFStringTextBox" target="_top">TXNDrawCFStringTextBox</a></code> functions display text that a user cannot edit. You use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawUnicodeTextBox" target="_top">TXNDrawUnicodeTextBox</a></code> function when you want to display a <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_300"></a>Unicode string and the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawCFStringTextBox" target="_top">TXNDrawCFStringTextBox</a></code> function when you want to display a <code>CFString</code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_301"></a>object. Each function draws the text in a rectangle whose size you specify in the local coordinates of the current graphics port. </p><p>MLTE uses the ATSUI style you specify to display the text or creates an ATSUI style based on the style associated with the current graphics port. You can specify a number of other options, such as text orientation (horizontal or vertical) and text alignment (right, left, centered, or fully justified). </p><p><span class="content_text">Listing 3-1</span> shows how to use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawCFStringTextBox" target="_top">TXNDrawCFStringTextBox</a></code> function to display a static string. The <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawCFStringTextBox" target="_top">TXNDrawCFStringTextBox</a></code> function draws into the current graphics port. An explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_114" title="Listing 3-1Displaying static text in a text box"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHDEDD" title="Listing 3-1Displaying static text in a text box"></a><strong>Listing 3-1&nbsp;&nbsp;</strong>Displaying static text in a text box</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_302"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_303"></a><div class="codesample"><table><tr><td scope="row"><pre>static void MyDrawStaticText (CFStringRef stringToDisplay,<span></span></pre></td></tr><tr><td scope="row"><pre>                            WindowRef theWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect            bounds;<span></span></pre></td></tr><tr><td scope="row"><pre>    GrafPtr         myOldPort;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetPort (&amp;myOldPort);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    SetPortWindowPort (theWindow);    <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    EraseRect (GetWindowPortBounds (theWindow, &amp;bounds));<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    TXNDrawCFStringTextBox (stringToDisplay, &amp;bounds, NULL, NULL);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    SetPort (myOldPort);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Call the QuickDraw function <code><a href="../../../Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetPort" target="_top">GetPort</a></code> to save the current graphics port. You’ll need to restore this later.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_115" title="Note"></a><p><strong>Note:</strong>&nbsp;QuickDraw uses the default CGContext. It is also possible for you set up and use your own CGContext. See <em><a href="../../../../GraphicsImaging/Conceptual/drawingwithquartz2d/index.html#//apple_ref/doc/uid/TP30001066" target="_top">Quartz 2D Programming Guide</a></em> for more information.</p></div></li><li class="li"><p>Calls the QuickDraw function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetPortWindowPort" target="_top">SetPortWindowPort</a></code> to set the graphics port to the window port. </p></li><li class="li"><p>Calls the QuickDraw function <code><a href="../../../Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/EraseRect" target="_top">EraseRect</a></code> to make sure the rectangle in which you will draw is empty.</p></li><li class="li"><p>Calls the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDrawCFStringTextBox" target="_top">TXNDrawCFStringTextBox</a></code> to draw the <code>CFString</code> passed to the function.</p></li><li class="li"><p>Restores the graphics port by calling the function <code><a href="../../../Reference/QuickDraw_Ref/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/SetPort" target="_top">SetPort</a></code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCICICFB" title="Initializing MLTE"></a><h2>Initializing MLTE</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_304"></a><p>You need to initialize MLTE before you can use any MLTE function except the two functions that display static text—<code>TXNDrawUnicodeTextBox</code> and <code>TXNDrawCFStringTextBox</code>. You should initialize MLTE at the same time you call other initialization functions for your application. </p><p>At the very least, to use MLTE your application must call the MLTE initialization function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNInitTextension" target="_top">TXNInitTextension</a></code>. On a more practical level, most applications need to provide users with a Font menu or Fonts window. So your application should also set up the menu bar and the Font user interface in addition to calling the MLTE initialization function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNInitTextension" target="_top">TXNInitTextension</a></code>. To set up your application to use MLTE functions and provide users with a Font menu you need to perform the tasks described in this section.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF101" title="Setting Up Font Descriptions "></a><h3>Setting Up Font Descriptions </h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_305"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_306"></a><p>When you call the MLTE initialization <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_307"></a>function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNInitTextension" target="_top">TXNInitTextension</a></code>, you pass an array of <strong>font descriptions</strong>, which are structures of <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_308"></a>type <code>TXNMacOSPreferredFontDescription</code>. Each font description specifies the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_309"></a><strong>font family</strong> ID, point size, style, and encoding. The array can be <code>NULL</code> or can have an entry for any encoding for which you would like to designate a default font. You can use the MLTE <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_310"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_311"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_312"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_313"></a>constants <code>kTXNDefaultFontName</code>, <code>kTXNDefaultFontStyle</code>, and <code>kTXNDefaultFontSize</code> as the font family ID, point size, and style values for a font description. You can supply an encoding of type <code>TextEncoding</code>, created using the function <code><a href="../../../Reference/Text_Encodin_sion_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateTextEncoding" target="_top">CreateTextEncoding</a></code>. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIGEIEA">Listing 3-2</a></span> for an example of assigning font default values to a single font description.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF102" title="Assigning Initialization Options "></a><h3>Assigning Initialization Options </h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_314"></a><p>You can specify whether MLTE should support data types other than text, such as graphics, movies, and sound, in your application. You can specify other data types by using the initialization option masks described in <em>Inside Mac OS X: MLTE Reference</em>. See <code><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIGEIEA">Listing 3-2</a></code> for an example of assigning initialization options using the option masks supplied by MLTE.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF103" title="Calling the MLTE Initialization Function"></a><h3>Calling the MLTE Initialization Function</h3><p>You initialize MLTE by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNInitTextension" target="_top">TXNInitTextension</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_315"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_316"></a>function. You need to call this function only once. Calling it more than once returns the result code <code>kTXNAlreadyInitializedErr</code> and has no effect. If for some reason you want to initialize MLTE again while your application is running, you must first call the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNTerminateTextension" target="_top">TXNTerminateTextension</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_317"></a>function.</p><p><span class="content_text">Listing 3-2</span> shows how you can initialize MLTE using a <code><!--a-->MyInitializeMLTE<!--/a--></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_318"></a>function. You call the <code><!--a-->MyInitializeMLTE<!--/a--></code> function from your application’s one-time-only initialization function. An detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_116" title="Listing 3-2Initializing MLTE"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGEIEA" title="Listing 3-2Initializing MLTE"></a><strong>Listing 3-2&nbsp;&nbsp;</strong>Initializing MLTE</p><div class="codesample"><table><tr><td scope="row"><pre>void MyInitializeMLTE (TextEncodingBase myTextEncodingBase)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr status;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNInitOptions options;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNMacOSPreferredFontDescription  defaults; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = ATSUFindFontFromName ("Times Roman",<span></span></pre></td></tr><tr><td scope="row"><pre>                        strlen("Times Roman"),<span></span></pre></td></tr><tr><td scope="row"><pre>                        kFontFullName, kFontNoPlatform,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kFontNoScript, kFontNoLanguage,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;theFontID);<span></span></pre></td></tr><tr><td scope="row"><pre>    defaults.fontID = theFontID;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    defaults.pointSize = kTXNDefaultFontSize; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    defaults.fontStyle = kTXNDefaultFontStyle;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    defaults.encoding  = CreateTextEncoding (myTextEncodingBase,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTextEncodingDefaultVariant,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTextEncodingDefaultFormat);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    options = kTXNWantMoviesMask | kTXNWantSoundMask |<span></span></pre></td></tr><tr><td scope="row"><pre>                                         kTXNWantGraphicsMask;<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNInitTextension (&amp;defaults, 1, options); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    if (status != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        MyAlertUser (eNoInitialization);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares a data structure to hold the default font values.</p></li><li class="li"><p>Sets Times Roman as the default font by calling the ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUFindFontFromName" target="_top">ATSUFindFontFromName</a></code> to obtain the font ID associated with the font name. If you don’t need to assign a particular font you can assign the default system font using the following line of code:</p><div class="codesample"><table><tr><td scope="row"><pre>defaults.fontID    = kTXNDefaultFontName;<span></span></pre></td></tr></table></div></li><li class="li"><p>Assigns the default font size.</p></li><li class="li"><p>Assigns the default font style.</p></li><li class="li"><p>Assigns the default text encoding. The encoding must be a <code>TextEncoding</code> data type, created by calling the Text Encoding Manger function <code><a href="../../../Reference/Text_Encodin_sion_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateTextEncoding" target="_top">CreateTextEncoding</a></code>. The sample function <code>MyInitializeMLTE</code> uses the <code>TextEncodingBase</code> passed to the function. You would either need to determine the current text encoding base or provide one of the Base Text Encoding constants defined in the Text Encoding Conversion Manager.</p></li><li class="li"><p>Assigns initialization options. The sample code sets up options to support movies, sound, and graphics embedded in text data.</p></li><li class="li"><p>Initializes MLTE by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNInitTextension" target="_top">TXNInitTextension</a></code>. You need to pass an array of font descriptions. In this case, there is only one description in the array. You also need to pass the initialization options.</p></li><li class="li"><p>Checks for an error condition, and if there is one, calls your function to handle the error. You can’t use MLTE unless it initializes without error. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCEAJ">“Posting an Alert”</a></span> for information on writing an alert function.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF104" title="Setting Up the Menu Bar"></a><h3>Setting Up the Menu Bar</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_319"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_320"></a><p>Your application needs to set up menus as part of its initialization function. Once you’ve set up the menu bar, you can use MLTE functions to create a Font menu and handle user interaction with the Font menu. </p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF105" title="Creating a Font Menu Object"></a><h3>Creating a Font Menu Object</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_321"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_322"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_323"></a><p>The <code>TXNFontMenuObject</code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_324"></a>structure is an opaque structure that MLTE uses to handle user interaction with the Font menu. You create a Font menu object by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewFontMenuObject" target="_top">TXNNewFontMenuObject</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_325"></a>function. You should create a font menu object at the same time you are preparing to display your menu bar. </p><p>When you call the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewFontMenuObject" target="_top">TXNNewFontMenuObject</a></code> function, you must provide the Font menu reference, the menu ID, and the menu ID at which hierarchical menus begin. By default, MLTE creates <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_326"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_327"></a>hierarchical menus similar to what is shown in <span class="content_text"><a href="../mlte_concepts/mlte_concepts.html#//apple_ref/doc/uid/TP30000983-TP30000087-BAJECIBC">Figure 2-2</a></span>. </p><p><span class="content_text">Listing 3-3</span> shows how your application can create a Font menu object. If you want to display a check mark next to the active font in the Font menu the first time a user opens the menu, you must call the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_328"></a>function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNPrepareFontMenu" target="_top">TXNPrepareFontMenu</a></code>. However, you call that function right after you create a text object, as shown in <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIAJBI">Listing 3-6</a></span>.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_329"></a></p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_117" title="Listing 3-3Creating a Font menu object"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHCBGH" title="Listing 3-3Creating a Font menu object"></a><strong>Listing 3-3&nbsp;&nbsp;</strong>Creating a Font menu object</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_330"></a><div class="codesample"><table><tr><td scope="row"><pre> void MySetUpFontMenu (MenuRef myMenuRef, SInt16 myMenuID)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNFontMenuObject myFontMenuObject;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    OSStatus  status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNNewFontMenuObject (myMenuRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myMenuID,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kStartHierMenuID,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myFontMenuObject);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    if (status != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            MyAlertUser (eNoFontMenuObject);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    DrawMenuBar();<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares a <code>TXNFontMenuObject</code> data type.</p></li><li class="li"><p>Creates a Font menu object by calling the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewFontMenuObject" target="_top">TXNNewFontMenuObject</a></code>. You must supply a value greater than 160 that specifies the menu ID at which hierarchical menus begin. The sample code uses a an application-defined constant <code>kStartHierMenuID</code>. Note that MLTE creates hierarchical menus automatically on systems that use ATSUI. On output, <code>&amp;myFontMenuObject</code> points to a new Font menu object.</p></li><li class="li"><p>Checks for an error. If there is one, calls your function to notify the user. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCEAJ">“Posting an Alert”</a></span> for information on writing an alert function.</p></li><li class="li"><p>Displays the menu bar by calling the Menu Manager function <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/DrawMenuBar" target="_top">DrawMenuBar</a></code>.</p></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_118" title="Note"></a><p><strong>Note:</strong>&nbsp;If you want to provide a Fonts window in your application instead of a Font menu, see <em><a href="../../ATS_Concepts/index.html#//apple_ref/doc/uid/TP30000981" target="_top">Apple Type Services for Fonts Programming Guide</a></em>.</p></p></div><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIJHBII" title="Terminating MLTE"></a><h2>Terminating MLTE</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_331"></a><p>You need to call the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNTerminateTextension" target="_top">TXNTerminateTextension</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_332"></a>function when you terminate your application. <span class="content_text">Listing 3-4</span> shows how you can terminate MLTE when your application quits. You should first check to make sure all the document windows are closed and the Font menu object is disposed of before you terminate MLTE so that your application quits gracefully. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_119" title="Listing 3-4Terminating MLTE in your application&acirc;&#128;&#153;s termination function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGHEDD" title="Listing 3-4Terminating MLTE in your application&acirc;&#128;&#153;s termination function"></a><strong>Listing 3-4&nbsp;&nbsp;</strong>Terminating MLTE in your application’s termination function</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_333"></a><div class="codesample"><table><tr><td scope="row"><pre>void MyTerminate (TXNFontMenuObject myFontMenuObject)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowPtr       theWindow;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean         closed;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    closed = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    do {<span></span></pre></td></tr><tr><td scope="row"><pre>        theWindow = FrontWindow ();             <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        if (theWindow != NULL)<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>            closed = MyDoCloseWindow (theWindow);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    while (closed &amp;&amp; (theWindow != NULL));<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (closed)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myFontMenuObject != NULL) <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            OSStatus        status;<span></span></pre></td></tr><tr><td scope="row"><pre>            status = TXNDisposeFontMenuObject (myFontMenuObject);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            // If there is an error<span></span></pre></td></tr><tr><td scope="row"><pre>            if (status != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>                MyAlertUser (eNoDisposeFontMenuObject);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            myFontMenuObject = NULL;<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNTerminateTextension ();<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Gets the front window by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FrontWindow" target="_top">FrontWindow</a></code>.</p></li><li class="li"><p>Checks to see if there is a window. If so, calls your function to close the window.</p></li><li class="li"><p>Iterates through each open window, closing each one.</p></li><li class="li"><p>When all the windows are closed, check for a Font menu object. If your application uses a Fonts window instead of a Font menu, you do not need to check for or dispose of a Font menu object.</p></li><li class="li"><p>Disposes of the Font menu object by calling the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNDisposeFontMenuObject" target="_top">TXNDisposeFontMenuObject</a></code>.</p></li><li class="li"><p>Checks for an error. If there is one, calls your function to notify the user. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCEAJ">“Posting an Alert”</a></span> for information on writing an alert function.</p></li><li class="li"><p>Sets the Font menu object to <code>NULL</code>. You need to do this even if there is an error.</p></li><li class="li"><p>Terminates MLTE by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNTerminateTextension" target="_top">TXNTerminateTextension</a></code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGCJAG" title="Working With Text Objects"></a><h2>Working With Text Objects</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_334"></a><p><strong>Text objects</strong> (<code>TXNObject</code>) are the fundamental structures in MLTE; most MLTE functions operate on them. A text object contains text along with character attribute information. Text objects also contain document-wide formatting and privileges information and the private variables and functions necessary to handle text formatting at the document level. (For an overview of text objects see <code><a href="../mlte_concepts/mlte_concepts.html#//apple_ref/doc/uid/TP30000983-TP30000087-BAJHGBAA">“Text Objects (TXNObject)”</a></code>.)</p><p>To work with text objects, your application must perform the tasks described in this section.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF106" title="Creating a Window"></a><h3>Creating a Window</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_335"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_336"></a><p>Creating the text object is not of much use to your users unless you attach the text object to a window and make sure the window is visible. Your application can either create a text object and attach it to a window using the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNAttachObjectToWindow" target="_top">TXNAttachObjectToWindow</a></code>, or it can create a window and then create a text object with a reference to the window. <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIAJBI">Listing 3-6</a></span> shows how to attach a new text object to a window.</p><p>Because of how MLTE uses Carbon events internally, the window that the document will be displayed in must have the standard event handlers installed. This can be easily done by doing one of the following:</p><ul class="spaceabove"><li class="li"><p>If you create the window by calling the Window Manager functions <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateNewWindow" target="_top">CreateNewWindow</a></code> or <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/CreateCustomWindow" target="_top">CreateCustomWindow</a></code> you should include the attribute <code>kWindowStandardHandlerAttribute</code>. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_120" title="Note"></a><p><strong>Note:</strong>&nbsp;If you have an existing window, you can call the function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/ChangeWindowAttributes" target="_top">ChangeWindowAttributes</a></code> to add <code>kWindowStandardHandlerAttribute</code> to the window.</p></div><p>For more information see <em><a href="../../HandlingWindowsControls/index.html#//apple_ref/doc/uid/TP30001004" target="_top">Handling Carbon Windows and Controls</a></em>.</p><p></p></li><li class="li"><p>If you create the window from an Interface Builder nib file, you can call the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/InstallStandardEventHandler" target="_top">InstallStandardEventHandler</a></code> to install the standard event handlers on the window's target, as shown in <span class="content_text">Listing 3-5</span>. For more information on the standard event handler see <em><a href="../../Carbon_Event_Manager/index.html#//apple_ref/doc/uid/TP30000989" target="_top">Carbon Event Manager Programming Guide</a></em>.</p></li></ul><p>A detailed explanation for each numbered line of code appears following <span class="content_text">Listing 3-5</span>. </p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_121" title="Listing 3-5A function that creates a window from a nib file"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCBJI" title="Listing 3-5A function that creates a window from a nib file"></a><strong>Listing 3-5&nbsp;&nbsp;</strong>A function that creates a window from a nib file</p><div class="codesample"><table><tr><td scope="row"><pre>WindowRef MyMakeNewWindow (CFStringRef inName)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    IBNibRef        windowNib;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status;<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowRef       theWindow;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    EventTypeSpec   windowEventSpec[] =  {<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                {kEventClassWindow,  kEventWindowFocusRelinquish},<span></span></pre></td></tr><tr><td scope="row"><pre>                {kEventClassWindow,  kEventWindowFocusAcquired},<span></span></pre></td></tr><tr><td scope="row"><pre>                {kEventClassWindow,  kEventWindowCursorChange},<span></span></pre></td></tr><tr><td scope="row"><pre>                {kEventClassCommand, kEventCommandProcess}};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = CreateNibReference (CFSTR ("window"), &amp;windowNib);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetNibRef);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = CreateWindowFromNib(windowNib, CFSTR ("Window"), &amp;theWindow);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantCreateWindow);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeNibReference (windowNib);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    status =  InstallWindowEventHandler (theWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NewEventHandlerUPP (MyWindowEventHandler),<span></span></pre></td></tr><tr><td scope="row"><pre>                            4, windowEventSpec,<span></span></pre></td></tr><tr><td scope="row"><pre>                            (void *) theWindow, NULL); <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    status =  SetWindowTitleWithCFString (theWindow, inName); <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    return theWindow;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    CantCreateWindow:<span></span></pre></td></tr><tr><td scope="row"><pre>    CantGetNibRef:<span></span></pre></td></tr><tr><td scope="row"><pre>        return NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares an event specification. Your application would declare only those events it wants to handle. In this example, the following four events are specified:</p><ul class="ul"><li class="li"><p>Window focus relinquished. You need to handle this event only if your application uses a Fonts window, as you will need to update the Fonts window display accordingly. See <em>Inside Mac OS X: Managing Fonts</em> for information on handling focus relinquished and focus acquired events.</p></li><li class="li"><p>Window focus acquired. You need to handle this event only if your application uses a Fonts window, as you will need to update the Fonts window to display the current font selection in the window acquiring focus.</p></li><li class="li"><p>Window cursor changed. When this event occurs, you can call your function to update the menus. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF111">“Updating the File and Edit Menus”</a></span> for more information on updating menus.</p></li><li class="li"><p>Command process. When this event occurs, you can call your function to process the command chosen by the user. See <span class="content_text"><a href="../mlte_concepts/mlte_concepts.html#//apple_ref/doc/uid/TP30000983-TP30000087-TPXREF110">“Calling the Appropriate MLTE Function”</a></span> for more information on processing commands.</p></li></ul></li><li class="li"><p>Creates a nib reference for the window by calling the Interface Builder Services function <code><a href="../../../Reference/Interface_Builder/Reference/reference.html#//apple_ref/doc/c_ref/CreateNibReference" target="_top">CreateNibReference</a></code>. You must supply two parameters: </p><ul class="ul"><li class="li"><p>a <code>CFString</code> that represents the name of the nib file that defines the window user interface but without the <code>.nib</code> extension</p></li><li class="li"><p>a pointer to an <code>IBNibRef</code> data type. On return, this points to a reference to the nib file.</p></li></ul></li><li class="li"><p>Checks for errors by calling the macro <code>require_noerr</code>. It the nib reference can’t be created, the function terminates, as it should.</p></li><li class="li"><p>Creates a window from the nib reference by calling the Interface Builder Services function <code><a href="../../../Reference/Interface_Builder/Reference/reference.html#//apple_ref/doc/c_ref/CreateWindowFromNib" target="_top">CreateWindowFromNib</a></code>. On return, <code>theWindow</code> is a window reference to the newly-created window.</p></li><li class="li"><p>Checks for errors by calling the macro <code>require_noerr</code>. It the window reference can’t be created, the function terminates, as it should.</p></li><li class="li"><p>Disposes of the nib reference.</p></li><li class="li"><p>Installs a window event handler on the window. This example installs a window event handler (<code>MyWindowEventHandler</code>) created by the application to handle the four events discussed previously. Everything except these four events will be handled by the standard window event handler. If you want to install only the standard event handler, you would use this code:</p><p><code>status = InstallStandardEventHander (theWindow);</code></p></li><li class="li"><p>Set the title of the newly created window to the name passed to the function <code>MyMakeNewWindow</code>.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF107" title="Setting Options for the Text Object&acirc;&#128;&#153;s Frame"></a><h3>Setting Options for the Text Object’s Frame</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_337"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_338"></a><p>Before you create a text object your application must specify options for the text object’s <strong>frame</strong> (that is, the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_339"></a>view rectangle). Frame options determine whether the window in which the text object is displayed has scroll bars, a size box, or a number of other options. <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIAJBI">Listing 3-6</a></span> shows how an application uses the MLTE frame option masks described in <em>Inside Mac OS X: MLTE Reference</em> to specify a frame that has horizontal and vertical scroll bars and a size box. </p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF108" title="Creating a Text Object"></a><h3>Creating a Text Object</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_340"></a><p>You create a text object using the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_341"></a> function. <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIAJBI">Listing 3-6</a></span> shows a sample function—<code><!--a-->MyCreateTextObject<!--/a--></code>—that creates a text object and attaches it to a window. Error handling code has been omitted in the sample function so that you can more easily read the sequence of functions calls. A detailed explanation for each numbered line of code appears following the listing.</p><p>Once the text object is attached to the window, the <code><!--a-->MyCreateTextObject<!--/a--></code> function sets the state of the scroll bars using the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_342"></a>function and then prepares the Font menu for display. The <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_343"></a>function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNPrepareFontMenu" target="_top">TXNPrepareFontMenu</a></code> displays a check mark next to the active font in the Font menu the first time the user opens the Font menu associated with the text object. If you don’t call the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNPrepareFontMenu" target="_top">TXNPrepareFontMenu</a></code> function, the check mark is not displayed until the second time the user opens the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_344"></a>Font menu associated with the text object. </p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_122" title="Listing 3-6Creating a text object"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIIAJBI" title="Listing 3-6Creating a text object"></a><strong>Listing 3-6&nbsp;&nbsp;</strong>Creating a text object</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_345"></a><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyCreateTextObject (const FSSpec *fileSpecPtr,                                 WindowRef  theWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject   textObject = NULL;               // text object<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNFrameID  frameID    = 0;                  // ID for text frame<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNFrameOptions frameOptions;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    frameOptions = kTXNShowWindowMask | kTXNWantVScrollBarMask |<span></span></pre></td></tr><tr><td scope="row"><pre>                    kTXNWantHScrollBarMask |kTXNDrawGrowIconMask;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    status = TXNNewObject (fileSpecPtr,<span></span></pre></td></tr><tr><td scope="row"><pre>                theWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                frameOptions,<span></span></pre></td></tr><tr><td scope="row"><pre>                kTXNTextEditStyleFrameType,<span></span></pre></td></tr><tr><td scope="row"><pre>                kTXNTextensionFile,<span></span></pre></td></tr><tr><td scope="row"><pre>                kTXNSystemDefaultEncoding,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;textObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;frameID,<span></span></pre></td></tr><tr><td scope="row"><pre>                0);                         <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    SetWindowProperty (theWindow, kPropertyTag, kObjectTag,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof (TXNObject), &amp;textObject);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    SetWindowProperty (theWindow, kPropertyTag, kFrameTag,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof (TXNFrameID),&amp;frameID); <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    status = TXNPrepareFontMenu (object, gTXNFontMenuObject);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Sets frame options for the text object’s frame. The frame options shown here specify to display a window when the text object is created, and that the frame should have horizontal and vertical scroll bars and a size box.</p></li><li class="li"><p>Creates a text object. If <code>fileSpecPtr</code> is <code>NULL</code> the object is empty. Otherwise the object has the contents of the file to which <code>fileSpecPtr</code> points. The remaining parameters specify the following:</p><ul class="ul"><li class="li"><p><code>theWindow</code>, is a reference to the window in which you want the document displayed</p></li><li class="li"><p><code>NULL</code> specifies to use the window’s port rectangle as the frame</p></li><li class="li"><p><code>frameOptions</code> are the options specified previously (See item 1.)</p></li><li class="li"><p><code>kTXNTextEditStyleFrameType</code> specifies to use a Text Edit-style frame</p></li><li class="li"><p><code>kTXNTextensionFile</code> specifies MLTE file format as the file type of the text object</p></li><li class="li"><p><code>kTXNSystemDefaultEncoding</code> specifies to use the default text encoding</p></li><li class="li"><p><code>textObject</code> is the newly created text object you obtain from the function. You need this later when you call other MLTE functions to operate on the text object.</p></li><li class="li"><p><code>frameID</code> is the text frame ID you obtain from the function. You need this later when you call other MLTE functions to operate on the text object.</p></li><li class="li"><p><code>0</code> specifies you have no private data. This is where you can specify a reference constant for your by your application.</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_123" title="Note"></a><p><strong>Note:</strong>&nbsp;When you want to allow text input to this text object, you must call the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNFocus" target="_top">TXNFocus</a></code>.</p></div></li><li class="li"><p>Calls the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code> to save the text object as a property of the window. This allows your application to retrieve the text object later.</p></li><li class="li"><p>Calls the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code> to save the frame ID as a property of the window. This allows your application to retrieve the frame ID later.</p></li><li class="li"><p>Call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNPrepareFontMenu" target="_top">TXNPrepareFontMenu</a></code> to prepare the Font menu for display. When you call this function, MLTE displays a check mark next to the active font. You can call this function only if you have already created a valid Font menu object using the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewFontMenuObject" target="_top">TXNNewFontMenuObject</a></code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_124" title="Note"></a><p><strong>Note:</strong>&nbsp;If you are using a Fonts window instead of a Font menu in your application, then you do not call the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNPrepareFontMenu" target="_top">TXNPrepareFontMenu</a></code>. See <em>Inside Mac OS X: Managing Fonts</em> for an example of what you would need to do to support the Fonts window.</p></div></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF109" title="Disposing of a Text Object"></a><h3>Disposing of a Text Object</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_346"></a><p>When you close a window associated with a text object, you should call the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDeleteObject" target="_top">TXNDeleteObject</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_347"></a>function to release the text object and all associated data structures from memory.</p><p><span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIFGADG">Listing 3-7</a></span> shows a sample function—<code><!--a-->MyDisposeObject<!--/a--></code>—that first checks the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetChangeCount" target="_top">TXNGetChangeCount</a></code> function to see if the text object has been modified since it was created or saved last. If it has been modified, you can give the user an opportunity to save the changes before the object is deleted and the window is disposed of.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_348"></a> A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_125" title="Listing 3-7Disposing of a text object"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIFGADG" title="Listing 3-7Disposing of a text object"></a><strong>Listing 3-7&nbsp;&nbsp;</strong>Disposing of a text object</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_349"></a><div class="codesample"><table><tr><td scope="row"><pre>Boolean MyDisposeObject (WindowPtr theWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject   textObject = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     okToClose = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    MyGetTextObject (theWindow, &amp;textObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (TXNGetChangeCount (textObject))<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        okToClose = MyDoSaveDialog (window, textObject);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (okToClose)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        TXNDeleteObject (textObject);<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeWindow (theWindow);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return okToClose;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Checks to see if the text object has changed. If so, calls your function to open the Save dialog and gives the user an opportunity to save the text object to a file.</p></li><li class="li"><p>If it is okay to close the window, calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDeleteObject" target="_top">TXNDeleteObject</a></code> to dispose of the text object and calls the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/DisposeWindow" target="_top">DisposeWindow</a></code> to dispose of the window.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHJEEJ" title="Handling File and Edit Menu Commands"></a><h2>Handling File and Edit Menu Commands</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_350"></a><p>This section shows how your application can handle commands from the File and Edit menus. MLTE provides a variety of functions to handle these menu commands, such as the functions <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNCut" target="_top">TXNCut</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSelectAll" target="_top">TXNSelectAll</a></code>. Regardless of the command, your application must call the appropriate MLTE function to handle the command and update the menu items.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF110" title="Calling the Appropriate MLTE Function"></a><h3>Calling the Appropriate MLTE Function</h3><p>If you’ve installed a window event handler to process menu commands, the Carbon event manager will call your handler whenever the user chooses a command from the menu. Your handler can then call the appropriate MLTE function to process the command.</p><p><span class="content_text">Listing 3-8</span> shows how your application can handle window-related menu events from within a <code><!--a-->MyWindowEventHandler<!--/a--></code> function.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_351"></a> A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_126" title="Listing 3-8Handling menu commands from the File and Edit menus"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCICBGJF" title="Listing 3-8Handling menu commands from the File and Edit menus"></a><strong>Listing 3-8&nbsp;&nbsp;</strong>Handling menu commands from the File and Edit menus</p><div class="codesample"><table><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>pascal OSStatus MyWindowEventHandler ( EventHandlerCallRef myHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                            EventRef event,<span></span></pre></td></tr><tr><td scope="row"><pre>                            void * userData)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     OSStatus   result,<span></span></pre></td></tr><tr><td scope="row"><pre>                status = eventNotHandledErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    UInt32      eventClass = GetEventClass (event);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    HICommand   command;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject   textObject;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (eventClass)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassWindow:<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            // Your code to handle any window events<span></span></pre></td></tr><tr><td scope="row"><pre>            // such as window-focus and window-relinquish events.<span></span></pre></td></tr><tr><td scope="row"><pre>         }<span></span></pre></td></tr><tr><td scope="row"><pre>        case kEventClassCommand:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            GetEventParameter (event, kEventParamDirectObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                                typeHICommand, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof (HICommand),<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL, &amp;command);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            MyGetTextObject (theWindow, &amp;textObject);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            switch (command.commandID)<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandUndo:<span></span></pre></td></tr><tr><td scope="row"><pre>                    TXNUndo (textObject); <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandRedo:<span></span></pre></td></tr><tr><td scope="row"><pre>                    TXNRedo (textObject); <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandCut:<span></span></pre></td></tr><tr><td scope="row"><pre>                    status = TXNCut (textObject);<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandCopy:<span></span></pre></td></tr><tr><td scope="row"><pre>                    status = TXNCopy (textObject); <span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandPaste:<span></span></pre></td></tr><tr><td scope="row"><pre>                    status = TXNPaste (textObject); <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandClear:<span></span></pre></td></tr><tr><td scope="row"><pre>                    status = TXNClear (textObject); <span>// 13</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandSelectAll:<span></span></pre></td></tr><tr><td scope="row"><pre>                    TXNSelectAll (textObject); <span>// 14</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandPageSetup:<span></span></pre></td></tr><tr><td scope="row"><pre>                    TXNPageSetup (textObject); <span>// 15</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandPrint:<span></span></pre></td></tr><tr><td scope="row"><pre>                    TXNPrint (textObject);          <span>// 16</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandSave:<span></span></pre></td></tr><tr><td scope="row"><pre>                    MyDoSave (textObject); <span>// 17</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandSaveAs:<span></span></pre></td></tr><tr><td scope="row"><pre>                    MyDoSaveAs (textObject); <span>// 18</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kHICommandClose:<span></span></pre></td></tr><tr><td scope="row"><pre>                    MyDoCloseDoc (textObject); <span>// 19</span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            } // switch command.commandID<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>         }//  case kEventClassCommand<span></span></pre></td></tr><tr><td scope="row"><pre>    }//  switch eventClass<span></span></pre></td></tr><tr><td scope="row"><pre>    MyUpdateMenus();<span>// 20</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares parameters for the window event handler. When the Carbon Event Manager invokes your handler it passes an event reference from which you can determine the event. It also passes a reference constant. In this case, <code>userData</code> is a reference to the window on which the handler is installed.</p></li><li class="li"><p>Gets the event class from the event reference by calling the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventClass" target="_top">GetEventClass</a></code>.</p></li><li class="li"><p>Checks for a window class event. You need this only if you want to handle any window events. If your application implements a Fonts window instead of a Font menu, you need to handle window focus and window relinquish events.</p></li><li class="li"><p>Checks for a command class event. This includes any command issued from any menu in the menu bar.</p></li><li class="li"><p>Obtains the parameters associated with a command event by calling the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code>. In this case, gets the HI command that triggered the event.</p></li><li class="li"><p>Calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Checks for one of the standard command ID constants defined in the Carbon Event Manager.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNUndo" target="_top">TXNUndo</a></code> to undo the last user action. The undo stack is 32 levels deep</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNRedo" target="_top">TXNRedo</a></code> to redo the last user action.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNCut" target="_top">TXNCut</a></code> to delete the current selection and copy it to the private MLTE scrap.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNCopy" target="_top">TXNCopy</a></code> to copy the current selection to the private MLTE scrap.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNPaste" target="_top">TXNPaste</a></code> to paste the contents of the Clipboard into the text object. Before you call this function, you can call the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsScrapPastable" target="_top">TXNIsScrapPastable</a></code> to make sure the Clipboard contains data supported by the MLTE.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNClear" target="_top">TXNClear</a></code> to delete the current selection. This function does not add the deleted selection to the private MLTE scrap.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSelectAll" target="_top">TXNSelectAll</a></code> to select all text in the frame of a text object. You can check whether your application should enable the Select All menu item by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDataSize" target="_top">TXNDataSize</a></code> to see if the text object contains any data.</p></li><li class="li"><p>Calls the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNPageSetup" target="_top">TXNPageSetup</a></code> to display the Page Setup dialog. This function handles all changes in response to page layout settings your user makes.</p></li><li class="li"><p>Calls the MTLE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNPrint" target="_top">TXNPrint</a></code> to display the Print dialog. This function handles all changes in response to print settings your user makes, then prints the text associated with the text object.</p></li><li class="li"><p>Closes the window by calling your function to close the window and dispose of the text object.</p></li><li class="li"><p>Calls your function to save the text object. Your <code><!--a-->MyDoSave<!--/a--></code> function should call the MLTE function <code>TXNSave</code> to save the text object and perform any clean-up tasks that are necessary.</p></li><li class="li"><p>Calls your function to save a copy of the text object. Your <code>MyDoSaveAs</code> function should call the MLTE function <code>TXNSave</code> to save the text object and perform any clean-up tasks that are necessary.</p></li><li class="li"><p>Calls your function to update the menu items so the items are enabled or disabled appropriated. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF111">“Updating the File and Edit Menus”</a></span> for more information.</p></li></ol><p>If your application uses a Font menu instead of a Fonts window, you also need to to check for the appropriate case (hierarchical or non hierarchical) and then execute the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>if (gTXNFontMenuObject!= NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>            status = TXNDoFontMenuSelection (textObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                             gTXNFontMenuObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                             menuID, menuItem);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF111" title="Updating the File and Edit Menus"></a><h3>Updating the File and Edit Menus</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_352"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_353"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_354"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_355"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_356"></a><p>MLTE provides functions that your application can use to determine whether File and Edit menu items should be enabled or disabled. (When a menu item is enabled, a user can select it from the menu. When a menu item is disabled, it appears dimmed to the user.) <span class="content_text">Figure 3-1</span> shows two Edit menus, the first with more items enabled than the second.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_127" title="Note"></a><p><strong>Note:</strong>&nbsp;If your application uses an MLTE Font menu object, you do not need to update the Font menu. When your application handles the Font command, MLTE updates the menu automatically.</p></div><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_128" title="Figure 3-1Edit menus with a variety of items enabled and disabled"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGJJGB" title="Figure 3-1Edit menus with a variety of items enabled and disabled"></a><strong>Figure 3-1&nbsp;&nbsp;</strong>Edit menus with a variety of items enabled and disabled</p><img src = "../art/update_items.gif" alt = "Edit menus with a variety of items enabled and disabled" width="417" height="201"></div><br/><p>The Cut, Copy, and Clear items from the Edit menu operate on selected text. Before you enable these items in the Edit menu, your application should check whether the user has selected text by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsSelectionEmpty" target="_top">TXNIsSelectionEmpty</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_357"></a>function. If <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsSelectionEmpty" target="_top">TXNIsSelectionEmpty</a></code> returns <code>false</code> (meaning text is selected) then your application should enable the Cut, Copy, and Clear menu items. </p><p>The Paste item in the Edit menu should be enabled if the current scrap contains data supported by MLTE. You can test the current scrap by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsScrapPastable" target="_top">TXNIsScrapPastable</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_358"></a>function. If <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsScrapPastable" target="_top">TXNIsScrapPastable</a></code> returns <code>true</code>, then your application should enable the Paste menu item.</p><p>The Select All menu item should be enabled if a text object contains any data at all. The <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDataSize" target="_top">TXNDataSize</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_359"></a>function returns the size of a text object. If the returned value is not zero, your application should enable the Select All menu item. </p><p>The Save menu item should be enabled if any changes were made to the text object since the text object was created or saved last. You can check for changes by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetChangeCount" target="_top">TXNGetChangeCount</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_360"></a>function. If the function returns a value greater than 0, then changes have been made.</p><p>The Undo and Redo command should be enabled if the previous action by the user is undoable or redoable. You can use the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_361"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_362"></a>functions <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNCanUndo" target="_top">TXNCanUndo</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNCanRedo" target="_top">TXNCanRedo</a></code> to test whether these menu items should be enabled. These functions also return a value that indicates the action than can be undone or redone. You can use this information to customize the Edit menu. For example, <code><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIGJJGB">Figure 3-1</a></code> shows an Undo Typing menu item instead of simple Undo menu item. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCDIEBB">“Customizing MLTE Support for Carbon Events”</a></span> for information on how to provide a callback that customizes the Undo menu item.</p><p><span class="content_text">Listing 3-9</span> shows a function that updates the File and Edit menu items. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_129" title="Listing 3-9A function that updates the File and Edit menu items "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF122" title="Listing 3-9A function that updates the File and Edit menu items "></a><strong>Listing 3-9&nbsp;&nbsp;</strong>A function that updates the File and Edit menu items </p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_363"></a><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyUpdateMenus ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject       textObject = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNActionKey    actionKey;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    WindowRef       theWindow;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (theWindow = FrontWindow())<span></span></pre></td></tr><tr><td scope="row"><pre>            MyGetTextObject (theWindow, &amp;textObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    if (TXNGetChangeCount (textObject) > 0 ) <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL, kHICommandSave);<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL, kHICommandSaveAs);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL, kHICommandSave);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL, kHICommandSaveAs);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theWindow != NULL)<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandPageSetup);<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandPrint);<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandClose);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandPageSetup);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandPrint);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandClose);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (!TXNIsSelectionEmpty (textObject))<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandCut);<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandCopy);<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL,  kHICommandClear);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandCut);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandCopy);<span></span></pre></td></tr><tr><td scope="row"><pre>            DisableMenuCommand (NULL,  kHICommandClear);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    if (TXNIsScrapPastable () &amp;&amp; (textObject != NULL))<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                    EnableMenuCommand (NULL,  kHICommandPaste);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>                    DisableMenuCommand (NULL,  kHICommandPaste);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (TXNDataSize (textObject) > 0) <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                    EnableMenuCommand (NULL,  kHICommandSelectAll);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>                    DisableMenuCommand (NULL,  kHICommandSelectAll);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (TXNCanUndo (textObject, &amp;actionKey)) <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                    EnableMenuCommand (NULL,  kHICommandUndo);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>                    DisableMenuCommand (NULL,  kHICommandUndo);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (TXNCanRedo (textObject, &amp;actionKey)) <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                    EnableMenuCommand (NULL,  kHICommandRedo);<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>                    DisableMenuCommand (NULL,  kHICommandRedo);<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the Window Manger function <code><a href="../../../Reference/Window_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FrontWindow" target="_top">FrontWindow</a></code> to obtain a reference to the window. If the window is not <code>NULL</code>, calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetChangeCount" target="_top">TXNGetChangeCount</a></code> to get the number of times the text object has changed since the last time it was saved. If there have been changes, enables the Save and Save As items in the File menu. If not, these menu items are disabled. The Menu Manager functions <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/EnableMenuCommand" target="_top">EnableMenuCommand</a></code> and <code><a href="../../../Reference/Menu_Manager/Reference/reference.html#//apple_ref/doc/c_ref/DisableMenuCommand" target="_top">DisableMenuCommand</a></code> take two parameters, a menu reference and a command ID. If you pass <code>NULL</code> instead of a menu reference, the Menu Manager starts the search for the command at the root menu.</p></li><li class="li"><p>Makes sure the window is not <code>NULL</code>. If it is not <code>NULL</code>, you can assume the window is open and you should enable the Print, Page Setup, and Close items. Otherwise, disable these items. </p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsSelectionEmpty" target="_top">TXNIsSelectionEmpty</a></code> to see whether the current selection is empty. If the selection is not empty, enables the Cut, Copy, and Clear items in the Edit menu. If the selection is empty, disables the menu items.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsScrapPastable" target="_top">TXNIsScrapPastable</a></code> to see whether the Clipboard contains data supported by MLTE. If there is data that can be pasted, enables the Paste item in the Edit menu. If the data is not supported by MLTE, or there is no data available to paste, disables the menu item.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNDataSize" target="_top">TXNDataSize</a></code> and checks to see if the size of the data in the text object is greater than 0. Any value other than zero indicates that the text object is not empty, so the code enables the Select All item in the Edit menu. If the text object is empty, disables the menu item.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNCanUndo" target="_top">TXNCanUndo</a></code> to see if the last user action can be undone. If the action can be undone, enables the Undo item in the Edit menu. Otherwise it disables the menu item. On output, this function provides a <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNActionKey" target="_top">TXNActionKey</a></code> value that identifies the action that can be undone. You can use this information to customize the Undo menu item with the name of the item than can be undone. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG">“Writing an Action Key Mapping Callback Function”</a></span> for more information.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNCanRedo" target="_top">TXNCanRedo</a></code> to see if the last user action can be redone. If the action can be redone, enables the Redo item in the Edit menu. Otherwise it disables the menu item.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHIGCB" title="Setting Font Size and Style "></a><h2>Setting Font Size and Style </h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_364"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_365"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_366"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_367"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_368"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_369"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_370"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_371"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_372"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_373"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_374"></a><p>You can set font size and style for the current selection by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_375"></a>function. The current selection can be a range of text selected by the user or specified by your application. You specify the current selection with the <code>iStartOffset</code> and <code>iEndOffset</code> parameters of the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> function.</p><p>MLTE specifies a type attribute using a <strong>triple</strong>. A triple is an attribute tag, the size of the attribute, and a value for the attribute. Attribute tags are constants. The attributes you can specify are described in <em>Inside Mac OS X: MLTE Reference</em> and include the following attribute tags for font size and style:</p><ul class="ul"><li class="li"><p><code>kTXNQDFontSizeAttribute</code></p></li><li class="li"><p><code>kTXNQDFontStyleAttribute</code></p></li></ul><p>The following constants specify attribute sizes for font size and style:</p><ul class="ul"><li class="li"><p><code>kTXNFontSizeAttributeSize</code></p></li><li class="li"><p><code>kTXNQDFontStyleAttributeSize</code></p></li></ul><p>MLTE stores the triple that specifies a type attribute in a <code>TXNTypeAttributes</code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_376"></a>structure. This structure contains the <code>TXNAttributeData</code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_377"></a>union, and it is that union you use to pass the triple that specifies a type attribute. The <code>tag</code> field of the <code>TXNTypeAttributes</code> structure defines the type of data in the <code>TXNAttributeData</code> union, and the <code>size</code> field of the <code>TXNTypeAttributes</code> structure defines the size of the data in the <code>TXNAttributeData</code> union. </p><p>Typically your application would have a function that handles size and style selections whether these selections occur in Size and Style menus or in the Size and Style columns of a Fonts window. If a user selects a new font size or style, you change the appropriate values in the <code>TXNTypeAttributes</code> structure, then you call the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> function to change the attributes for the current selection. </p><p>The code fragment in <span class="content_text">Listing 3-10</span> shows how your application can change size and style changes for the current text selection. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_130" title="Listing 3-10Changing size and style attributes for selected text"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHAJJA" title="Listing 3-10Changing size and style attributes for selected text"></a><strong>Listing 3-10&nbsp;&nbsp;</strong>Changing size and style attributes for selected text</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus ChangeSizeAndStyleAttributes (TXNObject myTextObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                            Fixed myNewSize, Style myNewStyle);<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNTypeAttributes typeAttr[2];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[0].tag = kTXNQDFontSizeAttribute;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[0].size = kTXNFontSizeAttributeSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[0].data.dataValue = myNewSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[1].tag = kTXNQDFontStyleAttribute;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[1].size = kTXNQDFontStyleAttributeSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    typeAttr[1].data.dataValue = myNewStyle;<span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNSetTypeAttributes(myTextObject, 2, typeAttr,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTXNUseCurrentSelection,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTXNUseCurrentSelection);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Assigns a triple (attribute tag, size of the attribute, and attribute value) to specify the font size.</p></li><li class="li"><p>Assigns a triple (attribute tag, size of the attribute, and attribute value) to specify the font style.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> to set the size and style attribute for the current selection.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF113" title="Handling Multiple Text Objects  "></a><h2>Handling Multiple Text Objects  </h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_378"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_379"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_380"></a><p>When your application manages multiple text objects, it must make sure the appropriate text object has user focus. The <strong>user focus</strong> is the part of your application's user interface toward which keyboard input is directed. You can bring the appropriate text object into user focus by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNFocus" target="_top">TXNFocus</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_381"></a>function. </p><p>When you have multiple text objects you may need to handle the activation state of the text objects as well as the user focus. The activation state is independent of the user focus and can be turned on or off by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code>. </p><p>Keep in mind that the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code> function does not change the user focus. You typically call the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code> function when you have multiple text objects in a window and you want all of them to be scrollable even though only one at a time can have user focus. This lets application users scroll the inactive text without changing the focus from another text area.</p><p>Note that if your application sets the <code>iActiveState</code> parameter of the <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code> function to <code>kScrollBarsAlwaysActive</code>, the scroll bars are active even when the text object does not have user focus. Before you call <code>TXNActivate</code>, you should call the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_382"></a>function <code>TXNFocus</code> to focus the scroll bars and insertion point so they become active or inactive, depending on whether you want the text object to obtain user focus.</p><p>When your application brings a <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_383"></a>text object into user focus by calling the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNFocus" target="_top">TXNFocus</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_384"></a>function, the function removes any visual indication of its inactive state and then sets the state of the scroll bars so they are drawn correctly in response to update events. <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCICDHDF">Figure 3-2</a></span> shows examples of text objects that are activated (and have user focus) and deactivated (without user focus). </p><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_131" title="Figure 3-2An activated and a deactivated text object, with and without user focus"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCICDHDF" title="Figure 3-2An activated and a deactivated text object, with and without user focus"></a><strong>Figure 3-2&nbsp;&nbsp;</strong>An activated and a deactivated text object, with and without user focus</p><img src = "../art/focus.gif" alt = "An activated and a deactivated text object, with and without user focus" width="413" height="271"></div><br/><p><span class="content_text">Listing 3-11</span> shows a <code><!--a-->MyDoUserFocus<!--/a--></code> function that handles user focus.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_385"></a> A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_132" title="Listing 3-11Handling an activation event"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIJJJFF" title="Listing 3-11Handling an activation event"></a><strong>Listing 3-11&nbsp;&nbsp;</strong>Handling an activation event</p><div class="codesample"><table><tr><td scope="row"><pre>void MyDoUserFocus (WindowPtr theWindow, Boolean  becomingActive)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject           textObject;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNFrameID          frameID     =   0;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus            status      =   noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    MyGetTextObject (theWindow, &amp;textObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    MyGetFrameID (theWindow, &amp;frameID);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    TXNFocus (textObject, becomingActive);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (becomingActive) <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            TXNActivate (textObject, frameID, kScrollBarsAlwaysActive);<span></span></pre></td></tr><tr><td scope="row"><pre>            MyUpdateMenus ();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    else <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            TXNActivate (textObject, frameID, kScrollBarsSyncWithFocus);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Calls your own function to get the frame ID of the text object associated with the window. </p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNFocus" target="_top">TXNFocus</a></code> to change the user focus of the scroll bars and insertion caret to the state specified by the <code>becomingActive</code> parameter.</p></li><li class="li"><p>If the text object obtains user focus, calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code> to set the state of the scroll bars so they are drawn correctly. Then, calls your function to adjust the menus so menu items are enabled and disabled appropriately.</p></li><li class="li"><p>If the text object loses user focus, calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNActivate" target="_top">TXNActivate</a></code> to synchronize the activity state of the scroll bars with the focus state of the frame. In this case, only when the frame has user focus does the frame have active scroll bars.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BAJJCEAJ" title="Posting an Alert"></a><h2>Posting an Alert</h2><p>When an alert is posted, the Dialog Manager starts a sub-event loop. Keyboard input is instead returned to the Dialog Manager, which in most cases ignores the input. Keyboard input is not sent to your application and does not appear in your application's document.</p><p>MLTE uses event handlers to receive input directly from the Unicode input method. Keyboard events don't flow through the event loop and are not returned as event records. MLTE receives keyboard input and places the input into the active MLTE text object (<code>TXNObject</code>).</p><p>When your application deactivates an MLTE text object, the keyboard input handlers are removed. Typically, your application should deactivate an MLTE text object when it receives a deactivate event for the window that contains the object. When the user switches between two document windows, the application receives the deactivate event in its main event loop, deactivates the old MLTE text object, activates the new MLTE text object, and keyboard input goes to the newly active document window.</p><p>When you post an alert, however, the Dialog Manager's sub-event loop receives the deactivate event for the document window. Your application doesn't see the event so it doesn't deactivate the MLTE text object associated with the document window. When a user presses keys, the input is sent to the MLTE text object instead of the Dialog Manager's sub-event loop. Because the MLTE text object is active, it still has its event handlers installed.</p><p>To avoid this situation, you must provide a modal event filter callback to the Dialog Manger Alert function. The Dialog Manager passes the deactivate event for your application's window to the modal event filter callback, and the callback deactivates the <code>TXNObject</code>. Once the MLTE text object is deactivated by the callback, the document window no longer receives keystrokes while the Alert dialog is open.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHGDJB" title="Working With Document-Wide Settings"></a><h2>Working With Document-Wide Settings</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_386"></a><p>MLTE has a variety of settings that apply to an entire text object, such as line direction, tab values, read-only privileges, keyboard synchronization, automatic indentation, word wrap, caret display, font substitution, and type of input for input methods. You can get and set <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_387"></a>global settings with the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetTXNObjectControls" target="_top">TXNGetTXNObjectControls</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_388"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_389"></a>functions. This section shows you how to implement code for changing two document-wide settings—word wrap and line justification. You can take the same approach shown here to implement code that changes other document-wide settings.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF115" title="Implementing Word Wrap"></a><h3>Implementing Word Wrap</h3><p>Your application can provide a <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_390"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_391"></a>Layout menu that allows the user to enable and disable automatic <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_392"></a>word wrap. Once you create a Layout menu that contains a word-wrap item, you can indicate to the user whether <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_393"></a>automatic word wrap is enabled or disabled by displaying a check mark or other visual indicator next to the item if it is enabled. <code><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIFEHJ">Figure 3-3</a></code> shows a Layout menu that has the Word Wrap item checked.</p><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_133" title="Figure 3-3Using check marks to show enabled Layout settings"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIIFEHJ" title="Figure 3-3Using check marks to show enabled Layout settings"></a><strong>Figure 3-3&nbsp;&nbsp;</strong>Using check marks to show enabled Layout settings</p><img src = "../art/wordwrap_menu.gif" alt = "Using check marks to show enabled Layout settings" width="199" height="172"></div><br/><p>When a user changes the word-wrap setting, your application can use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetTXNObjectControls" target="_top">TXNGetTXNObjectControls</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> functions to get the current setting and then to toggle the setting appropriately. These functions are used to get and set a number of document-wide settings, so you need to use the <code>iControlTags</code> parameter to specify that automatic word wrap is the setting you want to change. MLTE provides a constant called <code>kTXNWordWrapStateTag</code> that you can use for the <code>iControlTags</code> parameter. </p><p>You use the <code>iControlData</code> parameter of the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> function to specify the new value of the word-wrap setting. MLTE provides two constants called <code>kTXNAutoWrap</code> and <code>kTXNNoAutoWrap</code> that you can use to specify the word-wrap state.</p><p><span class="content_text">Listing 3-12</span> shows a <code>MyDoWordWrap</code> function that your application can call from a menu-handling function to enable or disable word wrap in response to what your user selects from a Layout menu you create. A detailed explanation for each numbered line of code appears following the listing.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_394"></a></p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_134" title="Listing 3-12Toggling the word-wrap setting"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGGCAG" title="Listing 3-12Toggling the word-wrap setting"></a><strong>Listing 3-12&nbsp;&nbsp;</strong>Toggling the word-wrap setting</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyToggleWordWrap (WindowRef theWindow)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject   textObject = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNControlTag               controlTag[1];<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNControlData              controlData[1];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    MyGetTextObject (theWindow, &amp;textObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    controlTag[0] = kTXNWordWrapStateTag;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    status = TXNGetTXNObjectControls (textObject, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            controlTag, controlData);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (controlData[0].uValue == kTXNAutoWrap)      <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            controlData[0].uValue = kTXNNoAutoWrap;<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            controlData[0].uValue = kTXNAutoWrap;<span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNSetTXNObjectControls (textObject, false, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    controlTag, controlData);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Assigns the word-wrap state as the formatting data to obtain.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetTXNObjectControls" target="_top">TXNGetTXNObjectControls</a></code> to obtain the current value of the word-wrap state for the text object associated with the specified window.</p></li><li class="li"><p>If the current state is automatic word wrap, set the value to no automatic word wrap.</p></li><li class="li"><p>Otherwise, set the value to enable automatic word wrap.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> to set the value of the word-wrap state for the text object. The second value passed to this function (<code>false</code>) indicates that none of the other formatting and privileges attributes should be reset to their default value.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF116" title="Implementing Line Justification"></a><h3>Implementing Line Justification</h3><p>Your application can provide a <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_395"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_396"></a>Layout menu that allows the user to select a line justification setting. Once you create a menu that contains <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_397"></a>line justification items, you can indicate to the user which justification setting is active by displaying a check mark or other visual indicator next to the item if it is enabled. <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIIFEHJ">Figure 3-3</a></span> shows a Layout menu that has the Justify Full item checked.</p><p>When a user changes the line justification setting, your application can use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetTXNObjectControls" target="_top">TXNGetTXNObjectControls</a></code> and <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> functions to get the current setting, then change the setting appropriately. These functions are used to get and set a number of document-wide settings, so you need to use the <code>iControlTags</code> parameter to specify that line justification is the setting you want to change. MLTE provides a constant called <code>kTXNJustificationTag</code> that you can use for the value of the <code>iControlTags</code> parameter. </p><p>You use the <code>iControlData</code> parameter of the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> function to specify the new value of the line justification setting. MLTE provides six constants that you can use to specify the value—<code>kTXNFlushDefault</code>, <code>kTXNFlushLeft</code>, <code>kTXNFlushRight</code>, <code>kTXNCenter</code>, <code>kTXNFullJust</code>, and <code>kTXNForceFullJust</code>. The <code>kTXNFlushDefault</code> constant indicates text should be flush according to the line direction. The constant <code>kTXNForceFullJust</code> indicates that every line of text, including the last line, should be flush left and right. </p><p><span class="content_text">Listing 3-13</span> shows a <code>MyDoJustification</code> function that your application can call from a menu-handling function to implement the type of justification your user selects from a Layout menu you create. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_135" title="Listing 3-13A function that sets line justification"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIDHICE" title="Listing 3-13A function that sets line justification"></a><strong>Listing 3-13&nbsp;&nbsp;</strong>A function that sets line justification</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_398"></a><div class="codesample"><table><tr><td scope="row"><pre>OSStatus MyDoJustification (WindowRef theWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>                            SInt32 myNewJustification)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNObject       textObject = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNControlTag   controlTag[1];<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNControlData  controlData[1];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    MyGetTextObject (theWindow, &amp;textObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    controlTag[0] = kTXNJustificationTag;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    status = TXNGetTXNObjectControls (textObject, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            controlTag, controlData);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (controlData[0].sValue != myNewJustification)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        controlData[0].sValue = myNewJustification;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        status = TXNSetTXNObjectControls (textObject, false, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                controlTag, controlData);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return status;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls your function to obtain the text object associated with the window. If you saved the text object as a property of the window using <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/SetWindowProperty" target="_top">SetWindowProperty</a></code>, you can retrieve it by calling the Window Manager function <code><a href="../../../Reference/Window_Manager/Reference/reference.html#//apple_ref/doc/c_ref/GetWindowProperty" target="_top">GetWindowProperty</a></code>.</p></li><li class="li"><p>Assigns justification as the formatting data to get.</p></li><li class="li"><p>Calls the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetTXNObjectControls" target="_top">TXNGetTXNObjectControls</a></code> to obtain the current justification value for the text object. </p></li><li class="li"><p>If the justification value is not equal to that passed to the function, assigns the new value. </p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> to set the new justification value.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIFIAFA" title="Advanced Topics"></a><h2>Advanced Topics</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_399"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_400"></a><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIFIAGC" title="Working With Embedded Objects  "></a><h3>Working With Embedded Objects  </h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_401"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_402"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_403"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_404"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_405"></a><p><strong>Embedded objects</strong> are graphics, movie, or sound data embedded in text data. An embedded object is represented by one character offset in a text object. The offset does not represent the size of the embedded object, it is merely a placeholder for the object. This means you cannot use the number of offsets to calculate the size of the text object if your text object contains embedded data. If you need to calculate the size, you must write your own function to do so.</p><p>The <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_406"></a>function does not copy data that cross a data type boundary. But it may be used to copy data that cross a text-run boundary. For example, suppose your document consists of this: <img src = "../art/mlte_s010.gif" alt = "image: ../art/mlte_s010.gif" width="95" height="31"></p><p>If you call the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code> function with a starting offset of 0 and an ending offset of 6, the returned data would contain the characters “abc def” even though the offsets cross a style-run boundary. </p><p>However suppose your document consists of this:<img src = "../art/mlte_s011.gif" alt = "image: ../art/mlte_s011.gif" width="132" height="41"></p><p>If you call the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code> function with a starting offset of 0 and an ending offset of 6, the function returns the result code <code>kTXNIllegalToCrossDataBoundariesErr</code>. </p><p>If you are not sure whether a text object contains embedded data, you can use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNCountRunsInRange" target="_top">TXNCountRunsInRange</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_407"></a>function to determine how many runs are in the text object. If there is more than one run in the range, you can then use the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetIndexedRunInfoFromRange" target="_top">TXNGetIndexedRunInfoFromRange</a></code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_408"></a>function to determine if the runs contain different types of data. The <code>oRunDataType</code> parameter returns the data type of each run. Once you know the run type, you can use the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code> to copy the run data.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIDJEDC" title="Displaying Chemical Equations "></a><h3>Displaying Chemical Equations </h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_409"></a><p>Chemical equations, such as the one displayed in <span class="content_text">Figure 3-4</span>, use <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_410"></a>subscripts. MLTE treats a subscript as a font attribute, so you use the <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_411"></a>function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> to set the attribute that controls subscripts. </p><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_136" title="Figure 3-4Chemical equation that uses a subscript"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIFFGCF" title="Figure 3-4Chemical equation that uses a subscript"></a><strong>Figure 3-4&nbsp;&nbsp;</strong>Chemical equation that uses a subscript</p><img src = "../art/salty_equation.gif" alt = "Chemical equation that uses a subscript" width="411" height="159"></div><br/><p>To subscript the 2 shown in <span class="content_text">Figure 3-4</span> you would do the following </p><ul class="spaceabove"><li class="li"><p>assign values to the <code>TXNTypeAttributes</code> structure to specify the attribute tag, size, and data</p></li><li class="li"><p>call the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code></p></li></ul><p>You can use the ATSUI constant <code>kATSUCrossStreamShiftTag</code> as the attribute tag. This constant specifies a <strong>cross-stream shift</strong>—a shift in a character’s position in the direction against the reading direction<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_412"></a>. In the case of <span class="content_text">Figure 3-4</span>, this is a vertical shift.</p><p>The data value associated with the cross-stream shift tag is the amount by which the position should be changed with respect to the <strong>base line</strong>.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_413"></a> Values can range from -1.0 to 1.0, with negative values indicating that a character should be drawn lower than the base line. (See <em>Inside Mac OS X: Rendering Unicode Text With ATSUI</em> for more information on stream shift attribute tags and values.)</p><p><span class="content_text">Listing 3-14</span> shows how to set text attributes to display a character as a subscript. If you want to display the equation subscript with a smaller font size than the size used for the chemical symbol to which the subscript is associated, you need to change the size attribute for the subscript to an appropriate value. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_137" title="Listing 3-14Setting attributes for a subscript"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIIIEAI" title="Listing 3-14Setting attributes for a subscript"></a><strong>Listing 3-14&nbsp;&nbsp;</strong>Setting attributes for a subscript</p><div class="codesample"><table><tr><td scope="row"><pre>#define myFloatToFixed (a) ((Fixed) ((float) (a) * fixed1))<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSErr   status;<span></span></pre></td></tr><tr><td scope="row"><pre>TXNTypeAttributes typeAttr[1];<span></span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].tag = kATSUCrossStreamShiftTag;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].size = sizeof(Fixed);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].data.dataValue = myFloatToFixed(-0.35);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>status = TXNSetTypeAttributes (myTextObject, 1, typeAttr,<span></span></pre></td></tr><tr><td scope="row"><pre>                kTXNUseCurrentSelection, kTXNUseCurrentSelection);<span>// 4</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Assigns cross-stream shift as the tag.</p></li><li class="li"><p>Assigns an attribute size. The size of the value associated with the cross-stream shift tag is 4-byte fixed.</p></li><li class="li"><p>The value of the cross-stream shift must be between -1. and 1.0. A subscript should be negative. You may need to convert the value type to a fixed value, as shown here.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/c/func/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code>  to set the attribute. You can use the constant <code>kTXNUseCurrentSelection</code> to specify the current selection if you are applying the attribute to user-selected text. Otherwise, you should specify starting and ending offset values for the character you want to subscript.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIBIBFF" title="Accessing and Displaying Advanced Typographical Features"></a><h3>Accessing and Displaying Advanced Typographical Features</h3><p>Your application can use MLTE to display <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_414"></a>advanced typographical features (such as ligatures, diacritical marks, and diphthongs). However, you need to be familiar with font features described in <em>Inside Mac OS X: Rendering Unicode Text With ATSUI</em>.</p><p>To have your application provide your users with the ability to apply advanced typographical features to text they select, your application needs to do the following:</p><ul class="spaceabove"><li class="li"><p>provide an interface for users to select advanced features</p></li><li class="li"><p>respond to user-selected events for advanced features</p></li><li class="li"><p>translate user selections into the appropriate font feature type and font feature selector constants</p></li><li class="li"><p>assign the constants to the <code>TXNTypeAttributes</code> structure</p></li><li class="li"><p>call the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code></p></li><li class="li"><p>update the display</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_138" title="Note"></a><p><strong>Note:</strong>&nbsp;Not all features are available for a font. The set of available features are determined by the font designer. You can provide users access only to those features the font designer has included with the font.</p></div><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF117" title="Providing an Interface for Users to Select Advanced Features"></a><h4>Providing an Interface for Users to Select Advanced Features</h4><p>Your application can provide an interface that lets users view and select advanced font styles, font features, and font variations. One approach is to create a typography dialog that has three panes—Styles, Features, and Variations. This would allow users control over all the advanced ATSUI typography that can be set using the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code>. <span class="content_text">Figure 3-5</span> shows a sample features dialog. The dialog lets users access a few of the ATSUI features for the Skia font that can be set using the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code>. Depending on your users’ needs, your application could create a feature dialog that lists all ATSUI features that can be set for the current font, or you could limit user-selectable font features to those most important to your users.</p><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_139" title="Figure 3-5A Features dialog for the Skia font"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BAJCBCGI" title="Figure 3-5A Features dialog for the Skia font"></a><strong>Figure 3-5&nbsp;&nbsp;</strong>A Features dialog for the Skia font</p><img src = "../art/fontfeatures.gif" alt = "A Features dialog for the Skia font" width="223" height="329"></div><br/><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF118" title="Responding to User Selected Events for Advanced Features"></a><h4>Responding to User Selected Events for Advanced Features</h4><p>Your application then responds to user selections from the features dialog. Depending on how you set up the user interface, your application can respond on an item-by-item basis, or can apply, at the same time, all changes specified in the dialog.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIHFAFC" title="Translating the User&acirc;&#128;&#153;s Selections to Constants "></a><h4>Translating the User’s Selections to Constants </h4><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_415"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_416"></a><p>Translating the user’s selections into the appropriate <a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_417"></a><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_418"></a>font feature type and font feature selector constants requires some research as you write your application. You need to be familiar with the font features and font variations constants that are described in <em><a href="../../ATSUI_Concepts/index.html#//apple_ref/doc/uid/TP30000984" target="_top">ATSUI Programming Guide</a></em>. </p><p></p><p>For example, imagine your user has just made changes to the Ligatures section of the Features pane shown in <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJCBCGI">Figure 3-5</a></span>. Your application should represent the ligatures feature by using the <code>kLigaturesType</code> constant.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_140" title="Note"></a><p><strong>Note:</strong>&nbsp;Although there are constants defined for most font features, this does not mean a font has that feature. You must query a font to see whether or not a specific feature is available.</p></div><p>To represent the specific ligature selections made by the user, you need constants that indicate that rare, common, and diphthong ligatures are enabled, while logo and rebus ligatures are disabled. So your application would use the following font feature type constants: <code>kRareLigaturesOnSelector</code>, <code>kCommonLigaturesOnSelector</code>, <code>kDiphthongLigaturesOnSelector</code>, <code>kLogosOffSelector</code>, and <code>kRebusPicturesOffSelector</code>.</p><p>You would take a similar approach for any font feature or font variation. First, look up the constant that represents the feature or variation category. Then look up the constants that represent the state of each feature or variation in that category. </p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF119" title="Assigning Constants to the Type Attributes Data Structure"></a><h4>Assigning Constants to the Type Attributes Data Structure</h4><p>You can use the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> to set a variety of features from simple to the most complex ATSUI features. The <code>iAttributes</code> parameter of the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> function is an array of <code>TXNTypeAttributes</code> structures that you use to indicate what features you want to set and the values to which the features should be set. </p><p>A <code>TXNTypeAttributes</code> structure has a <code>TXNAttributeData</code> union as one of its fields. The kind of attribute your application needs to set determines the data contained in the union. For ATSUI features, your application should supply <code>atsuFeatures</code> data, as defined by the <code>TXNATSUIFeatures</code> data structure. The <code>TXNATSUIFeatures</code> structure contains information about the number of features in the structure, along with pointers to the feature type and selector information (that is, whether a feature is enabled or not). </p><p>You can also use the MLTE <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> function to set font variations data. In this case, your application would supply <code>atsuVariations</code> data in the <code>TXNAttributeData</code> union.</p><p><span class="content_text">Figure 3-6</span> shows the <code>TXNTypeAttributes</code> structure and its fields. The shaded areas show the fields for which your application needs to provide data in order to change the ATSUI font features for a selection. </p><br/><div><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_141" title="Figure 3-6The fields for which your application needs to supply data in order to set ATSUI font features (shaded areas)"></a><p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BAJHAEFC" title="Figure 3-6The fields for which your application needs to supply data in order to set ATSUI font features (shaded areas)"></a><strong>Figure 3-6&nbsp;&nbsp;</strong>The fields for which your application needs to supply data in order to set ATSUI font features (shaded areas)</p><img src = "../art/mlte_l004.gif" alt = "The fields for which your application needs to supply data in order to set ATSUI font features (shaded areas)" width="403" height="346"></div><br/><p>Once your application identifies the kind of data (feature or variation) it needs to set, then it needs to assign the appropriate values to the <code>tag</code> and <code>size</code> fields of the <code>TXNTypeAttributes</code> structure. The <code>tag</code> field determines the kind of data in the <code>TXNAttributeData</code> structure and the <code>size</code> field indicates the size of the attribute data. If your application needs to set ATSUI feature data, it would use the constant <code>kTXNATSUIFontFeaturesAttribute</code> for the <code>tag</code> field. It would use <code>sizeof(TXNATSUIFeatures)</code> for the <code>size</code> field. See <em>Inside Mac OS X: MLTE Reference</em> for a description of the font run attribute constants you can use for the <code>tag</code> field and for a description of the font run attribute size constants you can use for the <code>size</code> field. </p><p>Finally, your application needs to supply ATSUI feature data. You need only take the constants you identified based on the user’s selections (see <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BCIHFAFC">“Translating the User’s Selections to Constants”</a></span>) and assign them to the appropriate fields of the <code>TXNATSUIFeatures</code> structure.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_419"></a></p><p><span class="content_text">Listing 3-15</span> shows how to assign parameter values that set up diphthongs. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_142" title="Listing 3-15Assigning parameter values for diphthongs"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF123" title="Listing 3-15Assigning parameter values for diphthongs"></a><strong>Listing 3-15&nbsp;&nbsp;</strong>Assigning parameter values for diphthongs</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_420"></a><div class="codesample"><table><tr><td scope="row"><pre>TXNTypeAttributes       typeAttr[1];<span></span></pre></td></tr><tr><td scope="row"><pre>TXNATSUIFeatures        myFeatures;<span></span></pre></td></tr><tr><td scope="row"><pre>TXNObject               textObject;<span></span></pre></td></tr><tr><td scope="row"><pre>ATSUFontFeatureType     myFeatureType[1];<span></span></pre></td></tr><tr><td scope="row"><pre>ATSUFontFeatureSelector myFeatureSelector[1];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myFeatureType[0] = kLigaturesType;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>myFeatureSelector[0] = kDiphthongLigaturesOnSelector;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>myFeatures.featureCount     = 1;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>myFeatures.featureTypes = myFeatureType;<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>myFeatures.featureSelectors = myFeatureSelector;<span>// 5</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].tag = kTXNATSUIFontFeaturesAttribute;<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].size = sizeof (TXNATSUIFeatures);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>typeAttr[0].data.atsuFeatures   = (TXNATSUIFeatures *)&amp;myFeatures;<span>// 8</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Assigns the ligatures feature type.</p></li><li class="li"><p>Assigns the diphthong ligatures on selector. Constants that represent font feature types and selectors are declared in the header file SFNTLayoutTypes.h, and are fully described in <em><a href="../../ATSUI_Concepts/index.html#//apple_ref/doc/uid/TP30000984" target="_top">ATSUI Programming Guide</a></em>.</p></li><li class="li"><p>Assigns the number of features in <code>myFeatures</code> to be 1; <code>myFeatures</code> is a <code>TXNATSUIFeatures</code> data structure.</p></li><li class="li"><p>Assigns the feature type. </p></li><li class="li"><p>Assigns the feature selector.</p></li><li class="li"><p>Assign the attribute tag value to be an ATSUI font feature attribute.</p></li><li class="li"><p>Assigns the attribute size to be the size of the <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/c/tdef/TXNATSUIFeatures" target="_top">TXNATSUIFeatures</a></code>  structure</p></li><li class="li"><p>Sets the value of the data field associated with the ligatures feature.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF120" title="Calling the MLTE Set Type Attributes Function "></a><h4>Calling the MLTE Set Type Attributes Function </h4><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_421"></a><p>Once you have determined which constants to use and to which fields of the <code>TXNTypeAttributes</code> structure the constants should be assigned, the call to the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code> is straightforward. In addition to the <code>TXNTypeAttributes</code> structure, you need to pass the current text object and the starting and ending offsets of the current selection. </p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_143" title="Listing 3-16Calling the MLTE function to set type attributes"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF124" title="Listing 3-16Calling the MLTE function to set type attributes"></a><strong>Listing 3-16&nbsp;&nbsp;</strong>Calling the MLTE function to set type attributes</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre>status = TXNSetTypeAttributes (textObject, 1, typeAttr,<span></span></pre></td></tr><tr><td scope="row"><pre>                kTXNUseCurrentSelection, kTXNUseCurrentSelection);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF121" title="Updating the Display"></a><h4>Updating the Display</h4><p>Your application needs to update the display to reflect your user’s selections. You need to check or uncheck items in the features dialog to reflect whether the item is now enabled or disabled.<a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_422"></a></p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF125" title="Supporting Monostyled Text"></a><h2>Supporting Monostyled Text</h2><p>This section describes how you can use MLTE to create custom, editable controls that use text in a single style. Beginning with Mac OS X version 10.2, MLTE supports monostyled text when typing, copying and pasting, and dragging and dropping styled text into a control. You can specify that MLTE uses monostyled text by using the <code>TXNFrameOptions</code> flag <code>kTXNMonostyledTextMask</code>.</p><p>When you set this option for an object such as a control, the text in the object has a single style no matter what changes the users makes to the text.</p><p>To set monostyled text, follow these steps:</p><ol class="ol"><li class="li"><p>Call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code> with the <code>kTXNMonostyledTextMask</code> option.</p><p>If you obtain data from a file at the same time you create the text object, the style information in the file is ignored. It is preferable that you first create the text object, set its style, and then set data into the text object by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNSetDataFromFile" target="_top">TXNSetDataFromFile</a></code>.</p><p>Alternatively, you can create the text object without attaching it to a window, set the data, then set the style, and finally attach the text object to a window.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_144" title="Note"></a><p><strong>Note:</strong>&nbsp;Font substitution is enabled by default when the <code>kTXNMonostyledTextMask</code> option is set.</p></div></li><li class="li"><p>Set the style of the monostyled text by calling the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTypeAttributes" target="_top">TXNSetTypeAttributes</a></code>. MLTE ignores any starting and ending offsets you supply to this function as the style of the monostyled text is set for all the text associated with the text object.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCDIEBB" title="Customizing MLTE Support for Carbon Events"></a><h2>Customizing MLTE Support for Carbon Events</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_423"></a><p>In Mac OS X version 10.1 or later, MLTE automatically sets up Carbon event handlers for text input and window events. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-CJBFGGJF">“What’s Installed On a Text Object”</a></span> for details. However, there are a few situations in which you might want to configure Carbon events in MLTE:</p><ul class="ul"><li class="li"><p>Your application runs on a release that’s earlier than Mac OS X version 10.1. </p><p>In this case, you need to specify that MLTE use Carbon events instead of Apple events to handle text input and window events, because MTLE does not automatically set up such support in versions 10.1 and earlier. Read the sections <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJBDEDC">“Building a Dictionary,”</a></span> <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCBCFBG">“Instantiating the Carbon Events Structure,”</a></span> and <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF126">“Calling the function TXNSetTXNObjectControls.”</a></span></p></li><li class="li"><p> You need MLTE to support other Carbon events, namely command and Font menu events. </p><p>In this case, you use the data structure <code>TXNCarbonEventInfo</code> to specify that MLTE use Carbon events to handle these simple event-driven tasks that you would otherwise need to route to MLTE through function calls to the MLTE API. Read the sections <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJBDEDC">“Building a Dictionary,”</a></span> <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCBCFBG">“Instantiating the Carbon Events Structure,”</a></span> and <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF126">“Calling the function TXNSetTXNObjectControls.”</a></span></p></li><li class="li"><p>You want to use your own action key mapping callback function to customize the Undo and Redo menus.</p><p>In this case, you pass your callback function to MTLE through the <code>TXNCarbonEventInfo</code> data structure. For information on writing the callback, see <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG">“Writing an Action Key Mapping Callback Function.”</a></span> Then read the sections <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJBDEDC">“Building a Dictionary,”</a></span> <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCBCFBG">“Instantiating the Carbon Events Structure,”</a></span> and <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF126">“Calling the function TXNSetTXNObjectControls.”</a></span></p></li><li class="li"><p>You don’t want to use Carbon events or you want to handle all Carbon events in your application.</p><p>You should let MLTE support Carbon events, but in the rare case you don’t want MLTE to use its Carbon event handlers, you can turn off MLTE automatic support for them. Read the section <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF127">“Turning Off MLTE Support for Carbon Events.”</a></span></p></li></ul><a name="//apple_ref/doc/uid/TP30000983-TP30000088-CJBFGGJF" title="What&acirc;&#128;&#153;s Installed On a Text Object"></a><h3>What’s Installed On a Text Object</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_424"></a><p>MLTE installs Carbon event handlers each time you create an MLTE text object (<code>TXNObject</code>). The handlers that are set up for a text object (<code>TXNObject</code>) depend on the parameters you pass to the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code>.</p><p>If you call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code> with the parameter <code>iFrame</code> set to <code>NULL</code>, handlers are set up for all text input events and the following window events:</p><ul class="spaceabove"><li class="li"><p><code>kEventWindowActivated</code></p></li><li class="li"><p><code>kEventWindowDeactivated</code></p></li><li class="li"><p><code>kEventWindowDrawContent</code></p></li><li class="li"><p><code>kEventWindowClickContentRgn</code></p></li><li class="li"><p><code>kEventWindowResizeCompleted</code></p></li></ul><p>If you call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code> with the parameter <code>iWindow</code> set to <code>NULL</code>, the Carbon event handlers aren’t installed until you call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNAttachObjectToWindow" target="_top">TXNAttachObjectToWindow</a></code> with a valid window pointer. The Carbon event handlers are automatically removed if you call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNAttachObjectToWindow" target="_top">TXNAttachObjectToWindow</a></code> with a <code>NULL</code> window pointer.</p><p>If you call the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code> with the parameter <code>iFrame</code> set to a valid <code>Rect</code>, or if you call the functions <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNSetViewRect" target="_top">TXNSetViewRect</a></code>, <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetFrameBounds" target="_top">TXNSetFrameBounds</a></code>, or <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNSetRectBounds" target="_top">TXNSetRectBounds</a></code>, then the default Carbon event handlers for window events are only the following:</p><ul class="spaceabove"><li class="li"><p><code>kEventWindowDrawContent</code></p></li><li class="li"><p><code>kEventWindowClickContentRgn</code></p></li></ul><p>The reason for this is that the text object is now association with a frame, not the entire window.</p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BAJBDEDC" title="Building a Dictionary"></a><h3>Building a Dictionary</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_425"></a><p>If you want MLTE to support client-specified Carbon events, you need to build a dictionary whose keys are strings that represent events (such as “CommandUpdate” or “WindowResize”) and whose values are event target references associated with the events. A <strong>dictionary</strong> is a set of key-value pairs. (An <strong>event target</strong><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_426"></a> is the interface object (window, menu, and so forth) in which an event occurs.) See <em>Inside Mac OS X: MLE Reference</em> for a list of the predefined keys you can use to build the dictionary.</p><p>There are two additional items that dictionary can contain:</p><ul class="spaceabove"><li class="li"><p>a font menu object (<code>TXNFontMenuObject</code>)</p></li><li class="li"><p>a universal procedure pointer (<code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/c/tdef/TXNActionKeyMapperUPP" target="_top">TXNActionKeyMapperUPP</a></code>) to a callback function you provide to handle action key mapping events</p></li></ul><p>You use an action key mapping callback to dynamically change the edit menu to reflect what actions can be undone and redone (for example, Undo Paste instead of Undo). You’ll see how to create an action key mapping callback in the section <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG">“Writing an Action Key Mapping Callback Function.”</a></span> </p><p>If dictionary values are event target references or a font menu object, how is it possible to provide a universal procedure pointer (UPP) or a <code>TXNFontMenuObject</code> as a dictionary value? These data types use the same amount of space as an event target reference uses. So as long as you cast either of them to be of type <code>EventTargetRef</code>, the compiler won’t complain. Although casting is generally not recommended, in this case you can be confident that once MLTE processes the dictionary, the UPP or <code>TXNFontMenuObject</code> is cast back to the appropriate type.</p><p><span class="content_text">Listing 3-17</span> shows a <code>MyBuildTargetsDictionary</code> function that builds a dictionary for of Carbon events that MLTE should handle. When you create your own function to build a dictionary, you can add as many of the Carbon events supported by MLTE as you’d like. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_145" title="Listing 3-17Building a dictionary"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCGCJFH" title="Listing 3-17Building a dictionary"></a><strong>Listing 3-17&nbsp;&nbsp;</strong>Building a dictionary</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_427"></a><div class="codesample"><table><tr><td scope="row"><pre>static CFDictionaryRef MyBuildTargetsDictionary(<span></span></pre></td></tr><tr><td scope="row"><pre>        WindowRef               targetWindow<span></span></pre></td></tr><tr><td scope="row"><pre>        MenuRef                 editMenu,<span></span></pre></td></tr><tr><td scope="row"><pre>        TXNFontMenuObject       fontMenuObj)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        CFStringRef     keys[] = {  kTXNCommandTargetKey, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                                    kTXNCommandUpdateKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kTXNActionKeyMapperKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kTXNFontMenuObjectKey };<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        EventTargetRef  values[4];<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus        status;<span></span></pre></td></tr><tr><td scope="row"><pre>        MenuRef         theFontMenuRef;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    values[0] = GetWindowEventTarget (targetWindow);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    values[1] = GetMenuEventTarget (editMenu);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (gTXNActionKeyMapperUPP == NULL)  <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        gTXNActionKeyMapperUPP =                         NewTXNActionKeyMapperUPP (ActionKeyMappingProc);<span></span></pre></td></tr><tr><td scope="row"><pre>    values[2] = (EventTargetRef) gTXNActionKeyMapperUPP; <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    values[3] = theFontMenuObj;  <span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return CFDictionaryCreate (kCFAllocatorDefault,<span></span></pre></td></tr><tr><td scope="row"><pre>                        (const void **)&amp;keys,<span></span></pre></td></tr><tr><td scope="row"><pre>                        (const void **)&amp;values,<span></span></pre></td></tr><tr><td scope="row"><pre>                        4,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;kCFCopyStringDictionaryKeyCallBacks,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Defines the keys that will be used in the dictionary. The keys you can use are defined in <em>Inside Mac OS X: MLTE Reference</em>. Each key must be a <code>CFStringRef</code>, which these predefined keys are.</p></li><li class="li"><p>Defines the value associated with the first key (<code>kTXNCommandTargetKey</code>). Each entry in the <code>values</code> array must specify the event target associated with the key of the same index. The target for an edit command event is the <code>WindowRef</code> to which the text object is attached.</p></li><li class="li"><p>Defines the value associated with the second key (<code>kTXNCommandUpdateKey</code>). The target for an edit command update event is the Edit menu.</p></li><li class="li"><p>Defines a universal procedure pointer (<code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/c/tdef/TXNActionKeyMapperUPP" target="_top">TXNActionKeyMapperUPP</a></code>) to your callback function. This is a global UPP which is created the first time the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/c/func/NewTXNActionKeyMapperUPP" target="_top">NewTXNActionKeyMapperUPP</a></code> is called. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG">“Writing an Action Key Mapping Callback Function”</a></span> for more information on this callback.</p></li><li class="li"><p>Defines the value associated with the third key (<code>kTXNActionKeyMapperKey</code>). This is the UPP, but you must cast it to an <code>EventTargetRef</code>.</p></li><li class="li"><p>Defines the value (<code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewFontMenuObject" target="_top">TXNNewFontMenuObject</a></code>) associated with the fourth key (<code>kTXNFontMenuObjectKey</code>).</p></li><li class="li"><p>Calls the Core Foundation Collection Services function <code><a href="../../../../CoreFoundation/Reference/CFDictionaryRef/Reference/reference.html#//apple_ref/doc/c_ref/CFDictionaryCreate" target="_top">CFDictionaryCreate</a></code> to create the dictionary and return a reference to it. The caller of the <code><!--a-->MyBuildTargetsDictionary<!--/a--></code> function must release the dictionary after it has been passed to MLTE.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCBCFBG" title="Instantiating the Carbon Events Structure"></a><h3>Instantiating the Carbon Events Structure</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_428"></a><p>So far you’ve built a dictionary that contains information about the specific Carbon events and event targets you want MLTE to handle. You need to pass this dictionary to a <code>TXNObject</code> you’ve created, along with additional information needed to set the state of the <code>TXNObject</code> to use Carbon events. You use the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> to change the state of the <code>TXNObject</code>. Before you call this function, you need to instantiate the data structure <code>TXNCarbonEventInfo</code><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_429"></a> with the information needed to set up Carbon events. </p><p>The code fragment shown in <span class="content_text">Listing 3-18</span> shows you how to do this. The next section will show you how to pass this structure to MLTE. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_146" title="Listing 3-18Instantiating MLTE&acirc;&#128;&#153;s Carbon events data structure"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCFDCFJ" title="Listing 3-18Instantiating MLTE&acirc;&#128;&#153;s Carbon events data structure"></a><strong>Listing 3-18&nbsp;&nbsp;</strong>Instantiating MLTE’s Carbon events data structure</p><div class="codesample"><table><tr><td scope="row"><pre>TXNCarbonEventInfo      carbonEventInfo;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.useCarbonEvents = true;  <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.filler = 0; <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.flags = 0;  <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.fDictionary = MyBuildTargetsDictionary (aWindow,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                theEditMenu,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                aTXNFontObject);  <span>// 4</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Turns on support for Carbon events by setting <code>useCarbonEvents</code> to <code>true</code> in the <code>TXNCarbonEventInfo</code> data structure.</p></li><li class="li"><p>Sets the filler value to <code>0</code>. The filler is just that, a value that’s not used for anything. </p></li><li class="li"><p>Sets the flags value to <code>0</code>, as there is currently no other value you should supply here.</p></li><li class="li"><p>Calls the dictionary-building function <code><!--a-->MyBuildTargetsDictionary<!--/a--></code> created in <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BAJBDEDC">“Building a Dictionary.”</a></span> </p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF126" title="Calling the function TXNSetTXNObjectControls"></a><h3>Calling the function TXNSetTXNObjectControls</h3><p>The function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> is what you call to request a change to the state of a <code>TXNObject</code>. You must supply tags that identify the data you are passing to the function. To set up Carbon events, you must provide a tag to specify you are passing Carbon events data. </p><p><span class="content_text">Listing 3-19</span> shows the code you need to call the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_147" title="Listing 3-19Changing the state of a text object"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIGFFBB" title="Listing 3-19Changing the state of a text object"></a><strong>Listing 3-19&nbsp;&nbsp;</strong>Changing the state of a text object</p><div class="codesample"><table><tr><td scope="row"><pre>TXNControlTag           iControlTags[] = { kTXNUseCarbonEvents }; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>TXNControlData          iControlData[1];    <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>iControlData[0].uValue = (UInt32) &amp;carbonEventInfo; <span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = TXNSetTXNObjectControls(<span></span></pre></td></tr><tr><td scope="row"><pre>                        MyTextObject,<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                        false, <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        1,<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                        iControlTags,<span></span></pre></td></tr><tr><td scope="row"><pre>                        iControlData);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease (carbonEventInfo.fDictionary);   <span>// 7</span></pre></td></tr></table></div><p>Here what the code does:</p><ol class="ol"><li class="li"><p>Sets the control tag to the constant <code>kTXNUseCarbonEvents</code>. This constant specifies that the data in the <code>iControlData</code> parameter is a <code>TXNCarbonEventInfo</code> structure.</p></li><li class="li"><p>Declares a control data array. <code>TXNControlData</code> is a union that contains a field that you set to point to the <code>TXNCarbonEventInfo</code> structure.</p></li><li class="li"><p>Assigns a pointer to the <code>TXNCarbonEventInfo</code> structure to the <code>iControlData</code> variable. You filled this structure in the section <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCBCFBG">“Instantiating the Carbon Events Structure.”</a></span></p></li><li class="li"><p>Passes <code>MyTextObject</code> which is a <code>TXNObject</code> created by your application. You call the function <code>TXNNewObject</code> to create a <code>TXNObject</code>.</p></li><li class="li"><p>Sets this parameter to <code>false</code> to indicate whether or not MLTE should clear all tags associated with the <code>TXNObject</code>. Make sure you pass <code>false</code>. If you set this to <code>true</code>, all formatting and privileges attributes are reset to their default value.</p></li><li class="li"><p>Specifies the count of the number of items in the <code>iControlTags</code> array.</p></li><li class="li"><p>Calls the Core Foundation Base Services function <code><a href="../../../../CoreFoundation/Reference/CFTypeRef/Reference/reference.html#//apple_ref/doc/c_ref/CFRelease" target="_top">CFRelease</a></code> to release the memory associated with the dictionary you built. </p></li></ol><p>As mentioned in <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCDIEBB">“Customizing MLTE Support for Carbon Events,”</a></span> MLTE supports Carbon events on a per object basis rather than on a per application basis. In other words, every time you allocate a new <code>TXNObject</code> with a call to the function <code><a href="../../../Reference/Multilingual_Text_Engine/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/TXNNewObject" target="_top">TXNNewObject</a></code>, you also need to call the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> to have MLTE support client-specified Carbon events for that text object. </p><a name="//apple_ref/doc/uid/TP30000983-TP30000088-TPXREF127" title="Turning Off MLTE Support for Carbon Events"></a><h3>Turning Off MLTE Support for Carbon Events</h3><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_430"></a><p>There is no need to turn off MLTE’s support for Carbon events unless you don’t want to use Carbon events or you want to handle all Carbon events in your application. <span class="content_text">Listing 3-20</span> shows the code you can use should you encounter such a rare situation. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_148" title="Listing 3-20Turning off MLTE support for Carbon event handling"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIEAHHI" title="Listing 3-20Turning off MLTE support for Carbon event handling"></a><strong>Listing 3-20&nbsp;&nbsp;</strong>Turning off MLTE support for Carbon event handling</p><div class="codesample"><table><tr><td scope="row"><pre>carbonEventInfo.useCarbonEvents = false; <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.filler = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.flags = 0;  <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>carbonEventInfo.fDictionary = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>iControlData[0].uValue = (UInt32) &amp;carbonEventInfo;<span></span></pre></td></tr><tr><td scope="row"><pre>status = TXNSetTXNObjectControls(<span></span></pre></td></tr><tr><td scope="row"><pre>                                    MyTextObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    false,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    iControlTags,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    iControlData<span></span></pre></td></tr><tr><td scope="row"><pre>                                    );<span>// 3</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Sets <code>useCarbonEvents</code> to <code>false</code> to indicate to MLTE that Carbon events should be turned off for the <code>TXNObject</code> you specify.</p></li><li class="li"><p>Sets the flags value to <code>0</code>, which is only value you should currently provide.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetTXNObjectControls" target="_top">TXNSetTXNObjectControls</a></code> to apply the control values to the specified text object.</p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCEHEIG" title="Writing an Action Key Mapping Callback Function"></a><h2>Writing an Action Key Mapping Callback Function</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_431"></a><p>You need to write an action key mapping callback function if you want to customize the Redo and Undo menu items with the specific action that can be redone or undone. For example, if the user just typed some text, you can change the Redo menu item to Redo Typing.</p><p>You provide your callback function to MLTE by passing a universal procedure pointer to the callback as an entry in the <code>TXNCarbonEventInfo</code> data structure. See <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCDIEBB">“Customizing MLTE Support for Carbon Events”</a></span> for details.</p><p>The function shown in <span class="content_text"><a href="mlte_tasks.html#//apple_ref/doc/uid/TP30000983-TP30000088-BBCBFGJG">Listing 3-21</a></span> maps<code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/c/tdef/TXNActionKey" target="_top">TXNActionKey</a></code>  to the localized strings you want displayed to the user. The function takes two parameters: a <code>TXNActionKey</code> and a command ID. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_149" title="Listing 3-21A function that maps action keys to localized strings"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BBCBFGJG" title="Listing 3-21A function that maps action keys to localized strings"></a><strong>Listing 3-21&nbsp;&nbsp;</strong>A function that maps action keys to localized strings</p><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_432"></a><div class="codesample"><table><tr><td scope="row"><pre>static CFStringRef MyActionKeyMappingProc (TXNActionKey theActionKey,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            UInt32   theCommandID )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef  theActionString = CFSTR(""); <span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    switch (theActionKey) <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        case kTXNTypingAction <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            if (theCommandID == kHICommandUndo)<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Undo Typing"), "Localized undo typing string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            else<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Redo Typing"), "Localized redo typing string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kTXNCutAction:<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>            if (theCommandID == kHICommandUndo)<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Undo Cut"), "Localized undo cut string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            else<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Redo Cut"), "Localized redo cut string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        case kTXNPasteAction:<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Undo Paste"), "Localized undo paste string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            else<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Redo Paste"), "Localized redo paste string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>        default:                                                 <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            if (theCommandID == kHICommandUndo)<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Undo"), "Localized plain undo string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            else<span></span></pre></td></tr><tr><td scope="row"><pre>                theActionString = CFCopyLocalizedString(<span></span></pre></td></tr><tr><td scope="row"><pre>                    CFSTR("Redo"), "Localized plain redo string.");<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return theActionString; <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares a <code>CFStringRef</code> and set its value to an empty string. A Core Foundation string (<code>CFString</code>) represents an array of Unicode characters (<code>UniChar</code>) along with a count of the number of characters. You’ll use <code>CFString</code> objects a lot in Carbon because Unicode-based strings in Core Foundation provide a solid foundation for internationalizing software and they are stored more efficiently than arrays of Unicode characters. </p></li><li class="li"><p>Checks for an action key. The switch statement in this sample function has three cases, plus a default case. When you write your own function, you can have as many cases as there are <code>TXNActionKey</code> values, plus a default case. See <em>Inside Mac OS X: MLTE Reference</em> for a complete list of action types.</p></li><li class="li"><p>Checks for a typing action, then checks the command ID to see if the action is an undoable one. If the action is undoable, the code sets the action string to “Undo Typing.” If the action is redoable, the code sets the action string to “Redo Typing.” You must call the Core Foundation String Services macro <code><a href="../../../../CoreFoundation/Reference/CFBundleRef/Reference/reference.html#//apple_ref/doc/c_ref/CFCopyLocalizedString" target="_top">CFCopyLocalizedString</a></code> to get the string (such as “Undo Typing”) you want displayed in the Edit menu. <code><a href="../../../../CoreFoundation/Reference/CFBundleRef/Reference/reference.html#//apple_ref/doc/c_ref/CFCopyLocalizedString" target="_top">CFCopyLocalizedString</a></code> takes two parameters, a <code>CFString</code> that is the key for the string you want to retrieve, and a comment to provide localizers with contextual information necessary for translation. The key is usually in the development language. <code><a href="../../../../CoreFoundation/Reference/CFBundleRef/Reference/reference.html#//apple_ref/doc/c_ref/CFCopyLocalizedString" target="_top">CFCopyLocalizedString</a></code> searches the default strings file (Localizable.strings) for the localized string associated with the specified key. For information on creating Localizable.strings files, see <em>Inside Mac OS X: System Overview</em>.</p></li><li class="li"><p>Checks for a cut action, then checks the command ID to see if the action is an undoable one. If the action is undoable, the code sets the action string to “Undo Cut.” If the action is redoable, the code sets the action string to “Redo Cut.”</p></li><li class="li"><p>Checks for a paste action, then checks the command ID to see if the action is an undoable one. If the action is undoable, the code sets the action string to “Undo Paste.” If the action is redoable, the code sets the action string to “Redo Paste.”</p></li><li class="li"><p>Returns the localized version of the plain Undo or Redo string. </p></li><li class="li"><p>Returns the string associated with the action. The caller of the function <code><!--a-->MyActionKeyMappingProc<!--/a--></code> must release the string by calling the Core Foundation Base Services function <code><a href="../../../../CoreFoundation/Reference/CFTypeRef/Reference/reference.html#//apple_ref/doc/c_ref/CFRelease" target="_top">CFRelease</a></code>. </p></li></ol><a name="//apple_ref/doc/uid/TP30000983-TP30000088-BCIFCGJD" title="Migrating an Application from TextEdit to MLTE"></a><h2>Migrating an Application from TextEdit to MLTE</h2><a name="//apple_ref/doc/uid/TP30000088-DontLinkElementID_433"></a><p>If you have an application that uses TextEdit, and you want to modify the application so it uses MLTE instead of TextEdit, you should get the Multilingual Text Engine Software Developer’s Kit (SDK). The MLTE SDK is available from the Apple Developer Connection website.</p><p>The TEtoMLTESample folder in the MLTE SDK contains a project file named TEtoMLTE.proj. When you open that project, you will find the folders TESources and MLTE Sources. You should compare the C++ code in one folder with the comparable code in the other folder. For example, compare TESample.cp with MLTESample.cp. The comments in the file that uses MLTE describe the changes necessary to use MLTE instead of TextEdit. </p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../mlte_concepts/mlte_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../mlte_docrevhx/mlte_docrevhx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/HandlingUnicodeText_MLTE/mlte_tasks/mlte_tasks.html%3Fid%3DTP30000983-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/HandlingUnicodeText_MLTE/mlte_tasks/mlte_tasks.html%3Fid%3DTP30000983-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/HandlingUnicodeText_MLTE/mlte_tasks/mlte_tasks.html%3Fid%3DTP30000983-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>