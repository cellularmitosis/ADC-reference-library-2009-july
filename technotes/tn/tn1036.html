<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1036: QuickTime VR 1.0 Object Movie File Format</title>      <meta name="keywords" content="Mac OS 8 QuickTime VR qtvr authoring object movie file ">    <meta name="Description" content="Technical Note TN1036: This Technical Note is intended toprovide multimedia developers with the knowledge necessaryto create QuickTime VR 1.0 object movie files from theirown applications. Therefore this Technical Note shows howto create a QuickTime VR object movie by capturing viewsof the object, organizing the frames into a video track,adding movie user data to describe the parameters of theobject, specifying the movie controllers should be used,setting the poster frame, and changing the file type information.">                                     <meta name="categories" content="QuickTime VR"><meta name="week-posted" content="Apr 1, 1996 - Apr 5, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002878" title="QuickTime VR 1.0 Object Movie File Format"></a><A NAME="top"></A> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/QuickTime/idxVirtualReality-date.html" target="_blank">QuickTime > Virtual Reality</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1036</div>
<div id="pageheadsub">QuickTime VR 1.0 Object Movie File Format</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><P id = "menutext"><A HREF = "#RTFToC1">About the Object Movie File Format</a><br><br><A HREF = "#RTFToC2">QuickTime VR Object Movie Authoring</a><br><br><A HREF = "#RTFToC3">Summary</a><br><br><A HREF = "#References">References</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr><tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->  <p id ="introtext">This Technote is intended to provide multimedia developers with the knowledgenecessary to create QuickTime VR 1.0 object movie files from their ownapplications.</p><p id ="introtext">You should be familiar with the QuickTime Movie Toolbox, as documented in<cite>Inside Macintosh: QuickTime</cite>. It will also help if you are familiar withusing the QuickTime VR Authoring Tool Suite to create object movies.</p><CENTER><TABLE BORDER=0 WIDTH=275><TR><td bgcolor="#E6E6E6" align=left><P id = "introtext"><B>Note:</B><BR>Although this file format will be supported in future versions ofQuickTime VR, be aware that the object movie file format will changesignificantly in the next release. </P></TD></TR></TABLE></CENTER><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 1 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name = "RTFToC1"></a><h2>About the Object Movie File Format</h2><P>In QuickTime VR 1.0, an object movie file contains a single object. The moviefile contains: </p><ul><li>an enabled video track containing the views of the object</li><li>a <code>'NAVG'</code> atom in the movie user data area describing the parameters of theobject</li><li>a <code>'ctyp'</code> atom in the movie user data specifying the QuickTime VR object moviecontroller</li><li>the poster time set to the poster view of the object</li><li>the current time set to the poster time</li><li>an optional movie file preview</li></ul><P><A HREF="#top">Back to top</A></P><a name = "RTFToC2"></a><h2>QuickTime VR Object Movie Authoring</h2><P>To author a QuickTime VR object movie, you need to be able to capture orgenerate the bitmap frames of object as viewed from all angles. The frames aresaved in the proper sequence as a video track in a QuickTime movie. User dataand file type information are then added to convert it into a QuickTime VRobject movie.</p><h3>The Movie File</h3><P>A QuickTime VR object movie file is a QuickTime movie file. The only differencebetween an object movie file and a regular linear QuickTime movie file is howthe frames in the video track are displayed and the special user data attachedto the movie. In particular, for the Macintosh, the file type should be set to<code>'MooV'</code>, and on Windows the file extension should be .mov. The file's creatortype on the Macintosh should be <code>'vrod'</code>, which is the creator type for theQTVRPlayer application.</p><P>As with any QuickTime file that is intended to be played on both platforms, adata fork version of the file should be created using the <code>FlattenMovie</code> MovieToolbox call with the <code>flattenAddMovieToDataFork</code> flag set.</p><h3>Movie Controller User Data</h3><P>When you create a new QuickTime VR object movie, you must add a special pieceof user data to specify that a special QuickTime VR movie controller should beused instead of the standard movie controller. The movie controller type forQuickTime VR 1.0 object movies is <code>'stna'</code>. This user data is examined by theMovie Toolbox when <code>NewMovieController</code> is called. The following lines of codeadd the appropriate user data to a new movie: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>UserData uDat;OSType controllerSubType = 'stna';uDat = GetMovieUserData (newMovie);SetUserDataItem (uDat, &amp;controllerSubType, sizeof(controllerSubType),            'ctyp', 1);</pre>	</TD></TR></TABLE></CENTER><h3>The Object Video Track</h3><P>An object movie is represented by a set of views of the object. Usually theviews are captured by moving a camera around the object in the defined patternof horizontal pan and vertical pan angles (see Fig. 1). Set up your camera withthe camera aimed at the object. Camera positions above the object are measuredin positive  degrees; positions below the object are measured in negative degrees. The vertical position with the camera directly above the objectlooking down at it is called vertical pan 90  degrees. The vertical position withthe camera directly below the object looking up at it is called vertical pan-90 degrees. The center vertical position (equator) is vertical pan 0  degrees,Horizontal positions are measured in  degrees from horizontal pan0  degrees, 360  degrees.</p><center><img src="images/tn1036_003.gif" alt="" width=223 height=163><p><b>Figure 1</b>. Camera positions to capture views of an object</p></center><h4>Ordering the Frames - Simple Object</h4><P>For a simple object, one frame is captured at each view of the object. Applerecommends incrementing 10 degrees between each position in both horizontal andvertical directions. This produces relatively smooth motion as you interactwith the resulting object movie. You can experiment with a larger angleincrement if minimal file size is important. Regardless of the increment youchoose, use a consistent increment between all horizontal and vertical framesfor the object. If you are shooting the complete 360 degrees horizontally, makesure that the increment you use divides 360 degrees evenly.</p><P>Your first shot at each horizontal position should be of the back of theobject, so that the frame showing the front of the object is half-way throughthe series at that horizontal position. This improves disk-access time atrun-time, since the user will most likely be looking at the front of theobject.</p><P>Use the following procedure to shoot a <i>full</i> object which shows allpossible views: </p><ol><li>Position your camera with the vertical pan at 90 degrees (directly above theobject).</li><li>Shoot the first frame.</li><li>Keep the camera at the same vertical pan position and rotate itcounter-clockwise to the next position by increasing the horizontal pan angle,then shoot the frame.</li><li>Repeat step 3 until you return to the starting point.<br>If you moved the camera10 degrees between each frame, you should have 36 frames to capture the entire360 degrees</li><li>Move the camera down by reducing the vertical pan angle.</li><li>Repeat steps 2 through 4 for this vertical pan position.</li><li>Repeat step 6 for each vertical pan position until you reach a vertical panposition of -90 degrees (directly below the object).</li></ol><P>Depending on the object, you may choose not to shoot views towards the top orbottom positions. You may also choose not to shoot back views of an object, ifthey are uninteresting. The start and end pan angles in the horizontal andvertical directions are required in the file format.</p><P>Save the resulting set of frames as PICT files in the form name.001, name.002,etc., and then convert the frames into a movie using a utility such as<code>ConvertToMovie</code>. Alternatively save the frames directly into a QuickTime fileduring capture. Each frame must be a key frame. Frame differencing (temporalcompression) cannot be used for simple objects. Apple recommends using theApple Video compressor for 16-bit or greater images and the Apple Graphicscompressor for 8-bit images. Experiment with the compression quality to reducethe file size. Each frame must have the same duration. If you set the durationto about 1/10 of a second, you can play the movie as a QuickTime linear movieto verify that all frames were captured properly. The frame duration isinconsequential after conversion to QuickTime VR format.</p><h4>Ordering the Frames - Looping Object</h4><P>A looping object shows a looping animation at each view of the object. Followthe procedure above for shooting an object, except that Step 2 should be asfollows: </p><P> 2.    Shoot N frames of the animation loop.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>You must shoot exactly N frames at each camera position. Whenconverting the resulting frames to a movie, specify a key frame every N frames.This will reduce the file size by allowing for frame differencing in theanimation loop. At minimum, the first frame of the animation loop at eachcamera position must be a key frame.</P></TD></TR></TABLE></CENTER><BR><h4>Interpreting the Frames of an Object Movie</h4><P>The frames of an object movie are stored in sequential order in the videotrack. They should be interpreted as a two-dimensional array of frames. For asimple object, turning an object one step to the left is equivalent toadvancing the movie one frame forward in time. Turning an object one step downis equivalent to advancing the movie approximately 36 frames (or the actualnumber of horizontal positions during capture) forward in time. For a loopingobject, the number of frames to advance is N times that described above, whereN is the number of frames of the animation loop. Changing views is just amatter of shuttling the play head of a movie to give the illusion of being ableto turn an object in two dimensions.</p><center><img src="images/tn1036_004.gif" alt="" width=327 height=107><P><b>Figure 2</b>. Interpretation of the order of frames saved in a video track in relation to horizontal and vertical camera positions</p></center><P>Table 1 summarizes the information used during the capture process and thecorresponding parameters required by the NAVG atom: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Frame Position            File format parametersNumber of horizontal positions            # ColumnsNumber of vertical positions            # RowsStarting H pan position (usually 0 degrees)        Start H PanEnding H pan position (usually 360 degrees)        End H PanStarting V pan position (usually 90 degrees)    Start V PanEnding V pan position (usually -90 degrees)        End V PanThe N frames of the animation loop        Loop Size</pre>	</TD></TR><TR><td align="left"><P><b>Table 1</b>. Information used during the capture process</p></td></tr></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>If the start and end H pans are exactly 0 and 360, frames in thehorizontal dimensions are "wrapped," i.e., stepping past the last frame of arow will display the first frame of that row. There is no wrapping in thevertical direction. </P></TD></TR></TABLE></CENTER><BR> <h4>Extending the Concept of an Object Movie</h4><P>An object movie is intended as the technology to display views of a3-dimensional object from many angles. However, since the frames of the moviecan contain any kind of picture, different kinds of interactive movies can becreated as QuickTime VR object movies. In many cases, the start and end panparameters might not make sense for these movies. You should interpret theseparameters as mouse scaling factors. The object movie controller interprets adragging motion from approximately one edge of the window to the other to be180 degrees. Play around with the start and end pan parameters until theinteraction feels right.</p><h3>The `NAVG' User Data Atom</h3><p>The <code>'NAVG'</code> atom in the movie user data area contains the parameters of theobject movie. The first user data item list contains the following datastructure: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// File format for version 1.0.#pragma options align=mac68k        // Use Macintosh 68k alignmenttypedef struct {    short    versionNumber;        // Always 1    short    numberOfColumns;    // Number of columns in movie    short    numberOfRows;        // Number rows in movie    short    reserved1;        // Zero    short    loopSize;        // Number of frames shot at each position    short    frameDuration;        // The duration of each frame    short    movieType;        // kStandardObject, kObjectInScene, or                    // kOldNavigableMovieScene    short    loopTicks;        // Number of ticks before next frame of                    // loop is displayed    Fixed    fieldOfView;        // 180.0 for kStandardObject or                    // kObjectInScene, actual  degrees for                    // kOldNavigableMovieScene.    Fixed    startHPan;        // Start horizontal pan angle in                    //  degrees    Fixed    endHPan;        // End horizontal pan angle in  degrees    Fixed    endVPan;        // End vertical pan angle in  degrees    Fixed    startVPan;        // Start vertical pan angle in  degrees    Fixed    initialHPan;        // Initial horizontal pan angle in                    //  degrees (poster view)    Fixed    initialVPan;        // Initial vertical pan angle in  degrees                    // (poster view)    long    reserved2;        // Zero} QTVRObjectFileFormat1x0Record, *QTVRObjectFileFormat1x0Ptr;</pre>	</TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>In the above data structure , the sizes of the data types are: </P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre>Type        bit sizeshort        16Fixed        32</pre></td></tr><TR><td bgcolor="#E6E6E6" align=left><p>The structure uses Macintosh 68K alignment.</p></td></tr></TABLE></CENTER><BR><P>The parameters <code>numberOfColumns</code>, <code>numberOfRows</code>, <code>startHPan</code>, <code>endHPan</code>, <code>startVPan</code> and<code>endVPan</code> are already described in Table 1. The <code>frameDuration</code> parameter specifiesthe duration of each frame in the movie. You may obtain the value from the call<code>GetMovieNextInterestingTime</code>. The <code>movieType</code> parameter specifies the userinterface to be used to manipulate the object and can be one of the followingvalues: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>enum {    kStandardObject        = 1,    // &quot;Object&quot;in Add Object Data dialog    kOldNavigableMovieScene    = 2,    // &quot;Scene&quot;in Add Object Data dialog    kObjectInScene        = 3    // &quot;Object In Scene&quot; in Add Object                    // Data dialog};</pre>	</TD></TR></TABLE></CENTER><P>Specifying <code>kStandardObject</code> will provide the hand grabber interface for objectmanipulation in the central portion of the object and the arrow interface forspinning at the borders. Specifying <code>kObjectInScene</code> will provide a joystick-likeinterface for spinning the object. Experiment to see which interface style isbetter for your object. Specifying <code>kOldNavigableMovieScene</code> will provide theoriginal navigable movie interface for viewing a navigable movie scene. Usethis constant if you have old navigable movies of scenes that you want to usein QuickTime VR.</p><P>The <code>loopSize</code> parameter is 1 for a simple object and the number of frames, N,shot at each position for a looping movie. For a simple object, the <code>loopTicks</code>parameter is ignored. For a looping movie, a <code>LoopTicks</code> value of 0 indicatesthat the next frame at that position should be displayed as quickly aspossible. If the value is greater than 0, the frames of the loop will be cycledat the constant rate specified (in 60ths of a second). Frames will be skippedto maintain the frame rate. If the value is negative, the next frame in theloop is show only after the absolute value of the specified time (in 60ths of asecond) has elapsed. This ensures that every frame will be displayed insequence.</p><P>The field of view parameter is 180 for standard object or an object in scene.For an old navigable movie of a scene, it is the approximate field of view ofthe image.</p><P>The parameters <code>initialHPan</code> and <code>initialVPan</code> specify the horizontal and verticalpan angle of the object's poster view. This view is displayed when the movie isfirst opened.</p><h3>The Object Movie's Poster View</h3><P>To ensure that the initial view (poster view), as specified in the <code>'NAVG'</code> atom,is displayed in QuickTime compatible applications, the current time and postertime of the movie must be set to the frame specified by <code>initialHPan</code> and<code>initialVPan</code>. As an option to make the preview of an object movie manipulable,such as in a Standard File dialog with Show Preview checked, a movie previewcan be created. For a looping movie, make the preview duration equal to thelength of the animation loop.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SetMovieTimeValue    (movie, posterViewTime);SetMoviePosterTime    (movie, posterViewTime);SetMoviePreviewTime    (movie, posterViewTime, frameDuration * loopSize);</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name = "RTFToC3"></a><h2>Summary</h2><P>This Technote has shown how to create a QuickTime VR object movie by capturingviews of the object, organizing the frames into a video track, adding movieuser data to describe the parameters of the object, specifying the moviecontrollers should be used, setting the poster frame, and changing the filetype information.</p><P>Authoring a object movie file is a fairly simple process if you make sure thereare the right number of frames in the video track, and if the duration of allframes are the same. Make sure the resulting file is verified usingQTVRPlayer.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><p><i>Inside Macintosh: QuickTime</i></p><p>"Generating QuickTime VR Movies from QuickDraw 3D," in <i>develop</i>Issue 25.</p><p>QuickTime VR 1.0 Authoring Tool Suite manuals</p><BR><P><A HREF="#top">Back to top</A></P>          <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (104K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1036.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1036.html%3Fid%3DDTS10002878-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1036.html%3Fid%3DDTS10002878-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1036.html%3Fid%3DDTS10002878-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>