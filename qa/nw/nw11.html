<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!--Template 06-20-02--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A NW11: Obtaining a List of Volumes from a Server Programmatically</title>    <meta name="keywords" content="Mac OS 8 AFP obtaining list volumes server programmatically"><meta name="Description" content="Technical Q&amp;A NW11: Q&amp;A illustrates how to programmaticallyobtain the list of volumes from a server, if you have theatalk-internet address of the server."><meta name="categories" content="Networking"><meta name="week-posted" content="May 29, 1995 - Jun 2, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001423" title="Obtaining a List of Volumes from a Server Programmatically"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalqas/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A NW11</div>
<div id="pageheadsub">Obtaining a List of Volumes from a Server Programmatically</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment -->            <!-- begin_content --> <CENTER><TABLE BORDER=0 CELLPADDING=0 WIDTH=600><TR> <td align="left"><hr width=500 align=center><p id = p2>Q:  How do I obtain a list of volumes from a server programmatically, given that Ihave the atalk-internet address of that server?</p><p id=p4>A:  To obtain a list of volumes from a server programatically, you use an<code>AFPCommand</code> called <code>afpGetSParms</code>. This command requires you to log in (as eithera guest or a user) and create a session, and then issue the <code>afpGetSParms</code>. Thestring returned by <code>afpGetSParms</code>, which is described on <b>page 13-98 of<i>Inside AppleTalk</i>,</b>looks like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>[0-3]   long    Current Date-time on Server's clock[4] byte    Number of Volumes that follow----&gt;    byte    NumVol Structure...        Msb = HasPassword (bit)        Lsb = HasConfigInfo (appleII stuff, ignore it)    P-String    Volume Name&lt;----</pre>	</TD></TR></TABLE></CENTER><p id=p4>The string is repeated for each volume.</p><p id=p4>There is also an example in the <b>February 1995 Developer CD:</b></p><p id=p4><b>Dev.CD Feb 95:Sample Code:Snippets:Networking:AppleTalk Libraries</b></p><p id=p4>The string from this example looks like this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>short LogOnAsGuest(AddrBlock *serverAddress,Ptr SCBBlock)  {    AFPLoginPrm *XPPBlock;  /* to build parameter blocks for AFP */    short       cbsize;    char        XPPReply[quantumSize*8];         /* used to get AFP replies (max. size 8 ATP packet) */    char        XPPCmd[quantumSize]; /* used to send AFP commands */    OSErr       error;    short       result;-   /* information used by Login function */    char        AFPVersion[30];    char        AuthentMethod[30];    strcpy(AFPVersion, "AFPVersion 2.0");    strcpy(AuthentMethod, "No User Authent");    if (!(XPPBlock = (AFPLoginPrm *)NewPtrClear(sizeof(AFPLoginPrm))))        return MemError();    XPPBlock-&gt;ioRefNum = xppRefNum;    XPPBlock-&gt;ioCompletion = nil;    XPPBlock-&gt;aspTimeout = 1;    /* Timeout for ATP */    XPPBlock-&gt;aspRetry = 2;      /* Retry count for ATP */    XPPBlock-&gt;afpAddrBlock = *serverAddress;           /* AppleTalk address of the server */    XPPBlock-&gt;afpAttnRoutine = nil ;    XPPBlock-&gt;rbPtr = (Ptr)XPPReply; /* Reply buffer pointer */    XPPBlock-&gt;rbSize = quantumSize;  /* Reply buffer size */    /* prepare command information :       1st byte : command (login)       2nd Pascal string : AFP version       3rd Pascal string : Authentication                           Method - see Inside AppleTalk 13-104 */    XPPCmd[0] = afpLogin;    XPPCmd[1] = strlen(AFPVersion);    strcpy(XPPCmd+2,AFPVersion);    cbsize = strlen(XPPCmd);    XPPCmd[cbsize] = strlen(AuthentMethod);    strcpy(XPPCmd+cbsize+1,AuthentMethod);    cbsize = strlen(XPPCmd);    XPPBlock-&gt;cbPtr = (Ptr)XPPCmd; /* Command block pointer */    XPPBlock-&gt;cbSize = cbsize;    XPPBlock-&gt;afpSCBPtr = (Ptr) SCBBlock; /* SCB pointer in AFP login */    if ((error = AFPCommand((XPPParmBlkPtr)XPPBlock,sync)) != noErr)        result = error;    else        if (XPPBlock-&gt;cmdResult != noErr)           result =  XPPBlock-&gt;cmdResult ;        else result =  XPPBlock-&gt;sessRefnum;                /* return session number */    DisposPtr((Ptr)XPPBlock);    return result;}   /* LogOnAsGuest */OSErr GetServerParams(short sessNum,Ptr replyBuffer,short buffLength){    XPPPrmBlk   *XPPBlock; /* to build parameter blocks for AFP */    char        XPPCmd[quantumSize];/* used to send AFP commands */    OSErr       error;    if (!(XPPBlock = (XPPPrmBlk *)NewPtrClear(sizeof(XPPPrmBlk))))        return MemError();    XPPBlock-&gt;ioRefNum = xppRefNum; /* driver reference number */    /* prepare command information :        no input provided except command - see IA 13-98 */    XPPCmd[0]  = afpGetSParms;    XPPBlock-&gt;sessRefnum = sessNum;    XPPBlock-&gt;aspTimeout = 2; /* Timeout for ATP */    XPPBlock-&gt;aspRetry = 2;    XPPBlock-&gt;cbPtr = (Ptr)XPPCmd;    XPPBlock-&gt;cbSize = 1;            /* Command block size */    XPPBlock-&gt;rbPtr = replyBuffer;   /* Reply buffer pointer */    XPPBlock-&gt;rbSize = buffLength;    XPPBlock-&gt;wdSize = 0;    /* Write Data size */    XPPBlock-&gt;wdPtr = nil;      /* Write Data pointer */    error = AFPCommand((XPPParmBlkPtr)XPPBlock,sync);    DisposPtr((Ptr)XPPBlock);    return error; }main(){Str32 theServer;Ptr buffer;AddrBlock serverAddress;char SCBBlock[scbMemSize]; /* used by AFP to manage a session */short sessionNum;OSErr ErrNo;short refNum;/* allocate a buffer to retrieve info */    if (!(buffer = NewPtr(buffSize))) return;/* open .XPP driver */    ErrNo = OpenXPP(&amp;refNum);// hard coded address cause I'm lazy    serverAddress.aNet = 41107;    serverAddress.aNode = 87;    serverAddress.aSocket = 250;// simple login as guest    if ((sessionNum = LogOnAsGuest(             &amp;serverAddress,&amp;SCBBlock)) &lt;= 0) {        DisposePtr(buffer);        return;        }// get server params    if ((ErrNo = GetServerParams(sessionNum,                buffer,buffSize)) != noErr) {        DisposePtr(buffer);        return;        }// buffer has server string// be a good citizen    LogOut(sessionNum,&amp;SCBBlock);    DisposePtr(buffer);}</pre>	</TD></TR></TABLE></CENTER></td></tr></table></center><!-- end_content --><!-- begin_date --><H4 ALIGN=center>[June 01 1995]</H4><!-- end_date --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/nw/nw11.html%3Fid%3DDTS10001423-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/nw/nw11.html%3Fid%3DDTS10001423-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/nw/nw11.html%3Fid%3DDTS10001423-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center> </BODY></HTML>