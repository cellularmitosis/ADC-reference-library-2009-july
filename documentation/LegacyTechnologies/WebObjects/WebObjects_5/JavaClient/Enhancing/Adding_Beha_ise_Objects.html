<HTML>		<HEAD>        <title>AddingBehavior to Your Enterprise Objects</title>		</HEAD>	<BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../../index.html" target="_top">Documentation</a> <b>></b> <a href="../../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><a href="Expanding_t_ovies_Model.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="../Advanced/index.html" target="_top"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<br><!-- apple_doc: pageHeadingStart --><a name = "TPXREF135"></a><h2><font face="Helvetica,Arial,Lucida Grande">AddingBehavior to Your Enterprise Objects</font></h2><!-- apple_doc: pageHeadingEnd --><p><font face="Times">As the preceding sections illustrate, you can go quite farin a Java Client application without writing any code. However,the real power of such an application or any Enterprise ObjectsFramework application lies in the enterprise objects you create.The behavior (business logic) you add to your objects is what bringsyour stored data to life.</font></p><br><a name = "TPXREF136"></a><h3><font face="Helvetica,Arial,Lucida Grande">SpecifyingCustom Enterprise Object Classes </font></h3><p><font face="Times">When creating a model of a database using the EOModeler application'swizard, you have the option of creating custom enterprise objects.If this option is selected, EOModeler derives both entity name andclass name from the name of the associated database table. Otherwise,EOModeler maps entities to the EOGenericRecord class, which canbe thought of as the default enterprise object class.</font></p><p><font face="Times">The EOGenericRecord class is sufficient when all you wantthe entity to do is get and set properties. However, when you wantto add custom behavior to a class (for example, to assign defaultvalues when you create new objects or to perform validation), youneed to implement a custom enterprise object class. This class includesthe default behavior provided in EOGenericRecord as well as thecustom behavior you implement. </font></p><p><font face="Times">To use a custom class instead of EOGenericRecord follow thesesteps:</font></p><ol><p><li>In EOModeler,select the Movies model root (top of the tree).<p>Make sure you'rein Table mode.</p><p>If the Client-Side Class Name columnis not visible, choose Client-Side Class Name from the Add Columnpop-up menu at the bottom of the window.</p></li></p><p><li>Double-click the Studio's Class Name cell in the table.</li></p><p><li>Type businesslogic.server.Studio inthe cell (businesslogic.server is the package name).</li></p><p><li>Double-click the Client-Side Class Name cell.</li></p><p><li>Type businesslogic.client.Studio inthis cell (businesslogic.client is the package name).</li></p></ol><p><font face="Times">Repeat the above steps for the Talent entity (append "Talent"to the package names).</font></p><p><font face="Times">Save the model.</font></p> <img src = "../Art/customjavaclassnames.gif" alt = "[image: ../Art/customjavaclassnames.gif]"><p><font face="Times">By convention, the names of classes (minus the package prefix)are based on the name of the corresponding entity and the initialletter of the name is capitalized.</font></p><p><font face="Times">There is no requirement that you create matching server andclient classes. You can implement a class only on the server orthe client, whichever suits your needs; the unimplemented classassumes the default behavior of EOGenericRecord.</font></p><p><font face="Times">Once you specify a custom class for an entity in EOModeler,you can generate source files for that entity.</font></p><p><font face="Times">For more information on custom enterprise objects, see  <a sector="mod" href="../Concepts/iWhen_Do_You_ject_Class_.html" target="_top">"When Do You Use a Custom Enterprise Object Class?"</a>.</font></p><br><a name = "TPXREF156"></a><h3><font face="Helvetica,Arial,Lucida Grande">GettingYour Project Ready to Receive Custom Classes</font></h3><p><font face="Times">Project Builder stores most of the files for a project atthe top level of the project directory. To separate <em>businesslogic</em> files from normal WebObjects files, it is recommendedthat a group called Business Logic be created in the project. Init, all the business logic files can be stored. To further separateserver-side files from client-side files, the Business Logic groupshould contain at least two subgroups: Server and Client. And additionalsubgroup, Common, can be added under Business Logic when you wantto share behavior with the server and client applications.</font></p><p><font face="Times">To create the recommended grouping for Java Client projects,follow these steps:</font></p><ol><p><li>Create thedirectory structure.<p>Create the following directories at thetop level of your project directory:</p><ul><p><li><code>BusinessLogic</code></li></p><p><li><code>BusinessLogic/Server</code></li></p><p><li><code>BusinessLogic/Client</code></li></p><p><li><code>BusinessLogic/Common</code> (optional,not needed for this tutorial)</li></p></ul></li></p><p><li>Create the Business Logic group in the project.<p>In theGroups & Files list of Project Builder's main window, selectthe StudioManager root group.</p><p>Choose Project &gt; NewGroup.</p><p>Name the group "Business Logic".</p></li></p></ol><br><a name = "TPXREF137"></a><h3><font face="Helvetica,Arial,Lucida Grande">GeneratingSource Files</font></h3><p><font face="Times">To begin creating your custom classes, generate source filesfor the Studio and Talent entities. You'll use these source filesas a basis for adding custom behavior to your enterprise objects.Generating source files in a Java Client application typically produces skeletalJava (<code>.java</code>) files forthe associated class. You then add these files to your project.</font></p><br><table border = "0" BGCOLOR="#E6E6E6"><tr><td scope="row"><p><b>Note: </b>Togenerate source files for an entity, you must have replaced thetext "EOGenericRecord" in the Class Name and Client-Side ClassName fields with a package name concatenated with a class name. </p></td></tr></table><br><ol><p><li>Generatethe client-side <code>.java</code> files.<p>Openthe Movies model file (if it's not already open).</p><p>Selectthe Studio entity.</p><p>Choose Property &gt; Generate ClientJava Files.</p><p>Select the Client directory inside the BusinessLogicdirectory.</p><p>Click Save.</p> <img src = "../Art/creatingclientclasses.gif" alt = "[image: ../Art/creatingclientclasses.gif]"><p>Repeat the processfor the Talent entity.</p></li></p><p><li>Generate server-side <code>.java</code> files.<p>Selectthe Studio entity.</p><p>Choose Property &gt; Generate JavaFiles.</p><p>Select the <tt>Server</tt> directoryinside the <tt>BusinessLogic</tt> directory.</p><p>ClickSave.</p><p>Repeat the process for the Talent entity.</p></li></p></ol><p><font face="Times">When EOModeler generates a class file (such as <code>Studio.java),</code> itstrips off the package prefix and inserts a package declarationnear the top of the file. The class file also includes the necessaryimport declarations as well as the instance variables and accessormethods derived from the properties of the entity as defined inthe model file.</font></p><br><a name = "TPXREF157"></a><h3><font face="Helvetica,Arial,Lucida Grande">AddingCustom Java Files to Your Project</font></h3><p><font face="Times">After you have generated custom Java files for the enterpriseobjects that you wish to customize, you can add them to your project.Remember that you must first prepare your project file as explainedin  <a href="#TPXREF156">"Getting Your Project Ready to Receive Custom Classes"</a>.</font></p><ol><p><li>Add the customclient-side classes to the project file in Project Builder.<p>Inthe Groups & Files list in Project Builder's main window,select the Business Logic group.</p><p>Choose Project &gt;Add Files.</p><p>Select the <tt>Client</tt> directoryin the <tt>BusinessLogic</tt> directory.</p><p>ClickOpen.</p> <img src = "../Art/addingcustomclientclasses.gif" alt = "[image: ../Art/addingcustomclientclasses.gif]"><p>The target selection sheetappears.</p><p>Select the Client target.</p><p>ClickAdd.</p> <img src = "../Art/selectingtargetforclasses.gif" alt = "[image: ../Art/selectingtargetforclasses.gif]"></li></p><p><li>Add the custom server-side classes.<p>In the Groups &Files list in Project Builder's main window, select the BusinessLogic group.</p><p>Choose Project &gt; Add Files.</p><p>Selectthe <tt>Server</tt> directory in the <tt>BusinessLogic</tt> directory.</p><p>ClickOpen.</p><p>The target selection sheet appears.</p><p>Selectthe Server target.</p><p>Click Add.</p></li></p></ol><p><font face="Times">Now the project uses custom classes for the Studio and Talententerprise objects instead of EOGenericRecord. These class filescan now be edited to implement custom behavior.</font></p><p><font face="Times">If you examine the code in  <a href="#CJBHAJJH">Listing 3-1</a>, you'll notice thatthe class generated by EOModeler does not have actual instance variablesor <em>fields</em>. The methods to access the attributesof the custom enterprise object are implemented using key-valuecoding.</font></p><a name = "CJBHAJJH"></a><b>Listing3-1 Client-side Studio.java file generatedby EOModeler</b><pre>package businesslogic.client;import com.webobjects.foundation.*;import com.webobjects.eocontrol.*;public class Studio extends EOGenericRecord {    public Studio() {        super();    }    public Studio(EOEditingContext context, EOClassDescription classDesc, EOGlobalID  gid) {        super(context, classDesc, gid);    }    public String name() {        return (String)storedValueForKey("name");    }    public void setName(String value) {        takeStoredValueForKey(value, "name");    }    public Number budget() {        return (Number)storedValueForKey("budget");    }    public void setBudget(Number value) {        takeStoredValueForKey(value, "budget");    }    public NSArray movies() {        return (NSArray)storedValueForKey("movies");    }    public void setMovies(NSMutableArray value) {        takeStoredValueForKey(value, "movies");    }    public void addToMovies(EOGenericRecord object) {        NSMutableArray array = (NSMutableArray)movies();        willChange();        array.addObject(object);    }    public void removeFromMovies(EOGenericRecord object) {        NSMutableArray array = (NSMutableArray)movies();        willChange();        array.removeObject(object);    }}</pre><br><a name = "TPXREF139"></a><h3><font face="Helvetica,Arial,Lucida Grande">ImplementingCustom Behavior for Your Classes</font></h3><p><font face="Times">The user interface you designed in Interface Builder alreadyallows you to insert and delete Studio objects. However, it doesn'tdo any additional processing when these operations take place. Forexample, what if you want to assign default values to newly createdobjects? And how can you prevent users from inserting objects thatcontain invalid data? You can add methods to your enterprise objectsto handle such issues.</font></p><p><font face="Times">For more information, see  <a sector="mod" href="../Concepts/iAdding_Beha_ise_Objects.html" target="_top">"Adding Behavior to Enterprise Objects"</a>.</font></p><br><a name = "TPXREF140"></a><h4><font face="Helvetica,Arial,Lucida Grande">DistributingBusiness Logic in Java Client Applications</font></h4><p><font face="Times">The value of Java Client applications, of course, lies intheir ability to distribute processing duties among objects on theserver and objects on the client. Primarily for security and performancereasons, you can have only objects on the server performing sometasks and only objects on the client performing others.</font></p><p><font face="Times">For example, sometimes you want only objects behind the firewallsand other security mechanisms of the server to have access to sensitiveinformation, such as account numbers. On the other hand, processingtasks such as calculation of balances should be performed by objectson the client, thereby improving application performance by eliminatingthe need for a cycle of the request-response loop.</font></p><p><font face="Times">There are no hard and fast rules for how to distribute objectbehavior. An enterprise object on the client can have the same setof methods and instance variables as its counterpart on the server,or what it has can be a subset (or superset) of the other object'smethods and instance variables. The best way to distribute businesslogic among objects depends on the particular nature of your application.</font></p><br><a name = "TPXREF158"></a><h4><font face="Helvetica,Arial,Lucida Grande">ManagingRelationships</font></h4><p><font face="Times">In  <a href="Adding_Relationships.html#TPXREF133" target = "_right">"Transferring Movies Between Studios"</a> you added a pop-up list tothe user interface to transfer movies between studios. However,there is still work to be done. When a movie is sold to a new studio,you need to add the amount of the movie's revenue to the old studio's budget(to show the studio's profit from the sale). Likewise, you needto subtract the amount of the movie's revenue from the new studio'sbudget (to reflect the expense of purchasing the movie).</font></p><p><font face="Times">When you transfer movies between studios, you're actuallymanipulating the <code>movies</code> relationshipproperty in each of the Studio objects, deleting the Movie objectfrom the <code>movies</code> arrayof the old studio, and adding the Movie object to the <code>movies</code> arrayof the new studio. Enterprise Objects Framework automatically invokesthe method <code>addObject</code> when youadd an object to an array that represents a relationship property,and invokes <code>removeObject</code> whenyou delete an object from the array. These methods are part of the EORelatioshipManipulationprotocol. See the <i>EOControl Java API Reference </i>fordetails.</font></p><p><font face="Times">When passed a key (such as <code>movies</code>),the default implementations of these methods look for a method thathas the name <code>addTo</code><em>Key</em> (whenan object is being added) and <code>removeFrom</code><em>Key</em> (whenan object is being removed). Skeletal versions of these methodsare provided in the source code you created using EOModeler in  <a href="#TPXREF137">"Generating Source Files"</a>.</font></p><p><font face="Times">To intervene and perform your own processing when objectsare added to and removed from the <code>movies</code> relationshiparray, you add code to the methods <code>addToMovies</code> and <code>removeFromMovies</code> inthe Studio class of the Client target, as shown in  <a href="#CJBJBEEE">Listing 3-2</a>.</font></p><a name = "CJBJBEEE"></a><b>Listing3-2 Studio.java (server and client) - Extendingdefault behavior</b><pre>import java.math.*;public void addToMovies(EOGenericRecord object) {        NSMutableArray array = (NSMutableArray)movies();        willChange();                // Subtract movie's revenue from budget.        Number newBudget;        Number movieRevenue = (Number)object.storedValueForKey("revenue");        newBudget = new BigDecimal(budget().doubleValue() -  movieRevenue.doubleValue());        setBudget(newBudget);        array.addObject(object);    }    public void removeFromMovies(EOGenericRecord object) {        NSMutableArray array = (NSMutableArray)movies();        willChange();                // Add movie's revenue to budget.        Number newBudget;        Number movieRevenue = (Number)object.storedValueForKey("revenue");        newBudget = new BigDecimal(budget().doubleValue() +  movieRevenue.doubleValue());        setBudget(newBudget);        array.removeObject(object);    }</pre><br><a name = "TPXREF141"></a><h4><font face="Helvetica,Arial,Lucida Grande">WritingDerived Methods</font></h4><p><font face="Times">One kind of behavior you might want to add to your enterpriseobject class is the ability to perform computations based on thevalues of class properties. For example, studios have movies, andthe total revenue of the movies times 1.5 constitutes the studio'sportfolio value. To calculate a studio's portfolio value, youcould have a method in <code>Studio.java</code> like theone shown in  <a href="#CJBDJFAF">Listing 3-3</a>.</font></p><a name = "CJBDJFAF"></a><b>Listing3-3 Studio.java (client) - Calculating astudio's revenue</b><pre>import java.math.*;public Number portfolioValue() {    int i, count;    double total;    NSArray revenues;    total = 0.0;    revenues = (NSArray)(movies().valueForKey("revenue"));    count = revenues.count();    for (i = 0; i &lt; count; i++) {        total +=            ((Number)(revenues.objectAtIndex(i))).doubleValue();    }    return new BigDecimal(total * 1.5);}</pre><p><font face="Times">You can display the results of this method in the user interfaceby forming an association between a control and the method. Thatway, whenever a new studio is selected or when a selected studio'smovie revenues change, its portfolio value is dynamically recalculated anddisplayed.</font></p><ol><p><li>Add methodsto your custom enterprise object classes.<p>Add the code in  <a href="#CJBDJFAF">Listing 3-3</a> tothe client-side <tt>Studio.java</tt> file.</p><p>Savethe <tt>Studio.java</tt> file.</p></li></p><p><li>Add a custom methods as a display-group properties.<p>Openthe project's interface (nib) file.</p><p>Display the Attributespane of the Info window for the Studio EODisplayGroup.</p><p>Enterthe name of the method (<code>portfolioValue</code>)you want to use in an association into the text field.</p><p>ClickAdd.</p> <img src = "../Art/addingcustommethod.gif" alt = "[image: ../Art/addingcustommethod.gif]"></li></p><p><li>Add the necessary user-interface controls.<p>Once you'veadded the method as a class key, you can use it in associations.</p><p>Using  <a href="#BCIGGFGE">Figure 3-3</a> as aguide, do the following:</p><ul><p><li>Add three text fieldsto the user interface.</li></p><p><li>Add labels to the left of fields: "Name:", "Budget:",and "Revenue:".</li></p><p><li>Right-justify the Budget and Revenue text fields.</li></p></ul><a name = "BCIGGFGE"></a><p><font face="Helvetica,Arial,Lucida Grande"><b>Figure3-3 Adding elements to the interface</b></font></p> <img src = "../Art/addinginterfaceelements.gif" alt = "[image: ../Art/addinginterfaceelements.gif]"></li></p><p><li>Associate interface controls with custom methods.<p>Associatethe Revenue text field with the <code>portfolioValue</code> method:</p><ul><p><li>Control-drag fromthe Revenues text field to the Studio EODisplayGroup.</li></p><p><li>Display the Connections view of the Info window.</li></p><p><li>Choose EOTextAssociation from the pop-up menu.</li></p><p><li>Select <code>value</code> inthe left column.</li></p><p><li>Select <code>portfolioValue</code> inthe right column.</li></p><p><li>Click Connect.</li></p></ul> <img src = "../Art/assoccontrolswithmethods.gif" alt = "[image: ../Art/assoccontrolswithmethods.gif]"><p>Repeat the processto connect the Name field to Studio's <code>name</code> attributeand the Budget field to the <code>budget</code> attribute.</p></li></p><p><li>Add the necessary formatters to the interface controls andchoose the format.<p>Currency formatters aren't added automatically,because a field has no way of knowing that it's going to be usedto display currency values-it's just connected to a property.</p><p>Fromthe Data Views palette, drag the currency formatter into the Budgettext field.</p> <img src = "../Art/addingcurrencyformatter.gif" alt = "[image: ../Art/addingcurrencyformatter.gif]"><p>Once you've added the formatter,you can use the Info window to change the display format.</p><p>Selectthe standard currency format.</p> <img src = "../Art/ibtextfieldinfofmt.gif" alt = "[image: ../Art/ibtextfieldinfofmt.gif]"><p>Repeat the processfor the Revenue text field.</p></li></p><p><li>Save the interface file.</li></p><p><li>Build and test the application on the client.<p>(See  <a sector="mod" href="../Creating/iBuilding_an_Application.html" target="_top">"Building and Testing Your Application"</a> for details.)</p></li></p></ol><br><a name = "TPXREF143"></a><h4><font face="Helvetica,Arial,Lucida Grande">PerformingValidation</font></h4><p><font face="Times">Another behavior you'll likely want to add to your enterpriseobject classes is validation. For example, suppose that when a studiobuys a new movie, you want to make sure that acquiring the moviewon't cause the studio to exceed its budget. You could implementa method in the Studio class like the one shown in  <a href="#CJBIEIJD">Listing 3-4</a>.</font></p><a name = "CJBIEIJD"></a><b>Listing3-4 Studio.java (server and client) - Validation</b><pre>public void validateBudget(Number budget) throws    NSValidation.ValidationException {    if (budget.intValue() &lt; 100) {        throw new NSValidation.ValidationException            ("A budget cannot be less than $100");    }}</pre><p><font face="Times">You use a NSValidation.ValidationException object to tellEnterprise Objects Framework that the current object graph is notcleared to be saved to the database.</font></p><p><font face="Times">Now when a studio buys more movies than it can afford, a paneldisplaying the message "A budget cannot be less than $100" appearswhen the user attempts to save the changes to the database.</font></p><p><font face="Times">Validation methods must be of the form <code>validate</code><em>Attribute</em>.The <code>validateBudget</code> methodis invoked by the <code>validateValueForKey</code> method,which is part of the EOValidation interface that uses the EOClassDescriptionclass to provide default implementations of validation methods.These methods are invoked automatically by framework componentssuch as EODisplayGroup and EOEditingContext. They are</font></p><ul><p><li>validateClientUpdate</li></p><p><li>validateForSave</li></p><p><li>validateForDelete</li></p><p><li>validateForInsert</li></p><p><li>validateForUpdate</li></p></ul><p><font face="Times">You can find more information on this topic in the book <i>EnterpriseObjects Framework Developer's Guide</i>.</font></p><br><a name = "TPXREF145"></a><h4><font face="Helvetica,Arial,Lucida Grande">ProvidingDefault Values for Newly Inserted Objects</font></h4><p><font face="Times">When new objects are created in your application and insertedinto the database, it's common to assign default values to someof their properties. For example, you might decide to assign newlycreated Studio objects a default budget (the budget is the amounta studio is allowed to spend on new movies). </font></p><p><font face="Times">To assign default values to newly created enterprise objects,use the method <code>awakeFromInsertion</code>.This method is automatically invoked right after your enterprise objectclass creates a new object and inserts it into an EOEditingContext. </font></p><p><font face="Times"> <a href="#CJBEFFDI">Listing 3-5</a> shows the implementation of <code>awakeFromInsertion</code> inthe Studio class. It sets the default value of the <code>budget</code> propertyto be one million dollars.</font></p><a name = "CJBEFFDI"></a><b>Listing3-5 Studio.java (server and client) - Defaultvalues</b><pre>public void awakeFromInsertion(EOEditingContext context) {    super.awakeFromInsertion(context);    if (budget() == null) {        setBudget(new BigDecimal("1000000"));    }}</pre><p><font face="Times">When a user clicks the Add Studio button in the StudioManagerapplication, a new record is inserted, with "$1,000,000.00"already displayed as a value in the Budget column.</font></p><br><a name = "TPXREF147"></a><h4><font face="Helvetica,Arial,Lucida Grande">InvokingServer Methods Remotely</font></h4><p><font face="Times">In a Java Client application you may want some methods toexecute only on the server. This is particularly the case when securityis an issue, but performance can be a reason as well (as when themethod consumes a lot of system resources). Objects on the clientside of a Java Client application can use two methods to invokea server method:</font></p><ul><p><li><b>invokeRemoteMethod</b> Anenterprise object on the client side can use this method to invokea method in the corresponding enterprise object on the server. Thearguments are the name of the method to invoke and an array of arguments.Before the method is invoked on the server, the current state ofthe client-side editing context is "pushed" to the server toensure that the method executes in an identical context. (Note that EODistributedObjectStorehas a version of this method that includes a flag as an argument;setting this flag to <code>false</code> preventsthe client from pushing its editing-context state to the server.)</li></p><p><li><b>invokeRemoteMethodWithKeyPath</b> You cansend a message to <em>any</em> object on the serverwith this method, which is defined in EODistributedObjectStore.For more on this method, see the specification for this EODistributionclass.</li></p></ul><p><font face="Times">If you want to give studios the ability to buy all of themovies that star a specified actor but consider this a sensitivecomputation, you can implement a method like the one in  <a href="#CJBBEEDD">Listing 3-6</a> inthe client's <code>Studio.java</code>.</font></p><a name = "CJBBEEDD"></a><b>Listing3-6 Studioi.java (client) - Buying all themovies starring a specific talent</b><pre>public void buyAllMoviesStarringTalent(Talent talent) {    invokeRemoteMethod("clientSideRequestBuyAllMoviesStarringTalent",      new Class[] {Object.class}, new Object[] {talent});}</pre><p><font face="Times">The method begins with <code>clientSideRequest</code>;this is not accidental. The EODistributionContext object on theserver-side EODistribution layer will reject a remote invocationunless it has this prefix <em>or</em> its delegate implementsthe proper delegation methods (see the reference documentation forEODistributionContext or EODistributedObjectStore for more information). </font></p><p><font face="Times"> <a href="#CJBGBGGA">Listing 3-7</a> shows the invoked method, which is implemented inthe server's <code>Studio.java</code>.</font></p><a name = "CJBGBGGA"></a><b>Listing3-7 Studio.java (server) - Buying all themovies starring a specific talent</b><pre>public void buyAllMoviesStarringTalent(Talent talent) {    int i, count;    NSArray talentMovies;    EOEnterpriseObject movie, studio;    talentMovies = talent.moviesStarredIn();    count = talentMovies.count();    for (i = 0; i &lt; count; i++) {        movie =            (EOEnterpriseObject)(talentMovies.objectAtIndex(i));        if (!(movies().containsObject(movie))) {            studio =                (EOEnterpriseObject)(movie.valueForKey("studio"));            if (studio != null)                studio.                removeObjectFromBothSidesOfRelationshipWithKey                (movie,"movies");            addObjectToBothSidesOfRelationshipWithKey                (movie,"movies");        }    }}public void clientSideRequestBuyAllMoviesStarring(Object object) {    buyAllMoviesStarringTalent((Talent)object);}</pre><p><font face="Times"> <a href="#CJBHDEBI">Listing 3-8</a> shows server's <code>buyAllMoviesStarringTalent</code> method,which invokes the <code>moviesStarredIn</code> method.</font></p><a name = "CJBHDEBI"></a><b>Listing3-8 Talent.java (server) - Buying all themovies starring a specific talent</b><pre>public NSArray moviesStarredIn() {    int i, count;    NSArray movies;    NSMutableArray moviesStarredIn;    EOEnterpriseObject movie;    moviesStarredIn = new NSMutableArray();    movies = (NSArray)(movieRoles().valueForKey("movie"));    count = movies.count();    for (i = 0; i &lt; count; i++) {        movie = (EOEnterpriseObject)(movies.objectAtIndex(i));        if (!(moviesStarredIn.containsObject(movie))) {            moviesStarredIn.addObject(movie);        }    }    return moviesStarredIn;}</pre><p><font face="Times">You can associate the <code>buyAllMoviesStarringTalent</code> methodwith a user interface control. But first you need to add to youruser interface a table that lists all actors (talent).</font></p><ol><p><li>Add a newtable view to your user interface.<p>Drag the Talent entity fromyour model into the nib file window in Interface Builder.</p><p>Draga table view from the Palette onto your window.</p> <img src = "../Art/addingtableviewtonib.gif" alt = "[image: ../Art/addingtableviewtonib.gif]"></li></p><p><li>Associate the table view columns with enterprise objects.<p>Control-dragfrom the first table view column into the Talent EODisplayGroup.</p><p>Usingthe value aspect of the EOTableColumnAssociation, connect the tableview column to the <code>firstName</code> attributeof the Talent EODisplayGroup.</p><p>Using a similar process,connect the second column of the table view to the <code>lastName</code> propertyof the Talent EODisplayGroup.</p></li></p><p><li>Add a button to the window.<p>Drag a button into the windowand place it below the Revenue field.</p><p>Give it the title"Buy Movies Starring Selected Talent".</p></li></p><p><li>Add a method to an EODisplayGroup. <p>Now that you'veadded the table view, connected it to the <code>firstName</code> and <code>lastName</code> propertiesof the Talent EODisplayGroup, and added a Buy button to the window, you'reready to use an EOActionAssociation to connect the button to the <code>buyAllMoviesStarringTalent</code> method.</p><p>Displaythe Attributes pane of the Info window for the Studio EODisplayGroup.</p><p>Inthe text field type the name of the method (<code>buyAllMoviesStarringTalent</code>)you want to use in an association.</p><p>Click Add.</p> <img src = "../Art/assoccontrolswithmethods2.gif" alt = "[image: ../Art/assoccontrolswithmethods2.gif]"><p>You can now use the <code>buyAllMoviesStarringTalent</code> methodin associations.</p></li></p><p><li>Associate a user interface element with a method.<p>Control-dragfrom the Buy Movies Starring Selected Talent button to the Studio EODisplayGroup.</p><p>Inthe Connections pane of the Info window, choose EOActionAssociationfrom the pop-up menu at the top of the left column.</p><p>Select <code>action</code> inthe left column, and the method you want to connect to (<code>buyAllMoviesStarringTalent</code>)in the right column. </p><p>Click Connect.</p> <img src = "../Art/connectingbuttonwithmethod.gif" alt = "[image: ../Art/connectingbuttonwithmethod.gif.gif]"></li></p><p><li>Associate a user interface element with the arguments it providesto its method.<p>Because the <code>buyAllMoviesStarringTalent</code> methodtakes a Talent object as an argument, you also need to make a connectionfrom the Buy button to the Talent EODisplayGroup.</p><p>Control-dragfrom the Buy Movies Starring Selected Talent button to the Talent EODisplayGroup.</p><p>Inthe Info window, select <code>argument</code> inthe left column. The argument aspect takes the destination of theconnection (Talent) as an argument, which will be supplied to the <code>buyAllMoviesStarringTalent</code> method.</p><p>ClickConnect.</p> <img src = "../Art/connectingbuttontoargument.gif" alt = "[image: ../Art/connectingbuttontoargument.gif]"><p>Once you finish connectingthe button, you can use it to purchase all of the movies starringthe selected actor for the selected studio.</p></li></p><p><li>Save the interface.</li></p><p><li>Build and test your application.</li></p></ol><br><a name = "TPXREF151"></a><h3><font face="Helvetica,Arial,Lucida Grande">Controllingthe User Interface</font></h3><p><font face="Times">In Java Client applications you can give the interface controller(implemented in this project in <code>StudioManagerInterfaceController.java </code>onthe client) a <em>controller display group. </em>Bycreating associations between the controller display group and aspectsof user-interface elements, you can use the interface controllerto manage various facets of the user interface. In the followingsteps, you add a method as a property of the controller display groupand bind this method to the <code>enabled</code> aspectof the Revenue field through an EOControlAssociation; since thismethod simply returns <code>false</code>,the field is disabled.</font></p><ol><p><li>Add a displaygroup to the nib file.<p>Drag a display group from the EnterpriseObjectsPalette to the nib file window.</p> <img src = "../Art/displaygroupdrag.gif" alt = "[image: ../Art/displaygroupdrag.gif]"><p>Double-clickthe title of the display group to select it.</p><p>Give thedisplay group the name "Controller".</p></li></p><p><li>Connect the interface controller to its display group.<p>Asmentioned earlier, the owner of the nib file (File's Owner) isan instance of the custom EOInterfaceController automatically createdby Project Builder. EOIntefaceController has a <code>controllerDisplayGroup</code> outlet;you'll connect the interface controller to this outlet.</p><p>Control-dragfrom File's Owner to the Controller icon.</p><p>In the Connectionspane of the Info window, select controllerDisplayGroup.</p><p>ClickConnect.</p> <img src = "../Art/fileownersdisplaygroupinfo.gif" alt = "[image: ../Art/fileownersdisplaygroupinfo.gif]"></li></p><p><li>Add a property to the controller display group.<p>Now you'lladd the <code>neverEnabled</code> methodas a property of the controller display group.</p><p>Selectthe Controller display group in the nib file.</p><p>In theAttributes pane of the Info window, enter <code>neverEnabled</code> inthe field.</p><p>Click Add.</p> <img src = "../Art/ownerdisplaygroupinfo.gif" alt = "[image: ../Art/ownerdisplaygroupinfo.gif]"></li></p><p><li>Connect an interface element to a property of the controller'sdisplay group.<p>Now you'll hook up the field to the displaygroup using an EOActionAssociation to bind its <code>enabled</code> aspectto the <code>neverEnabled</code> method.</p><p>Control-dragfrom the Revenue field to the Controller display group.</p><p>Inthe Connections pane of the Info window, choose EOActionAssociationfrom the pop-up list at the top of the left column.</p><p>Select <code>enabled</code> inthe left column.</p><p>Select <code>neverEnabled</code> inthe right column.</p><p>Click Connect.</p> <img src = "../Art/interfacetocontroller.gif" alt = "[image: ../Art/interfacetocontroller.gif]"></li></p><p><li>Implement the <code>neverEnabled</code> method.<p>Nowthat the interface controller, the controller display group, andthe Revenue field are interconnected via their outlets and associations,you can implement the method bound to the <code>enabled</code> aspect(in <code>StudioManagerInterfaceController.Java</code> onthe client) as  <a href="#CJBGJJIE">Listing 3-9</a> shows.</p><a name = "CJBGJJIE"></a><b>Listing 3-9 neverEnabledmethod</b><pre>public boolean neverEnabled() {        return false;}</pre></li></p><p><li>Build, run, and test the application.<p>Build the projectand test the application. The user can copy the contents of theRevenue field but it cannot be written into.</p></li></p></ol><br><a href="Expanding_t_ovies_Model.html" target="_right"><img src="../Images/previous.gif" border="0" alt="Previous"></a><a href="../Advanced/index.html" target="_top"><img src="../Images/next.gif" border="0" alt="Next"></a>&nbsp;<p><font face="Geneva,Helvetica,Arial" size="1">&#169; 2001 Apple Computer, Inc.</font></p><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>