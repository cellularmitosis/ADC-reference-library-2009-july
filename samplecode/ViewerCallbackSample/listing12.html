<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ViewerCallbackSample - /Source/Viewer_Main.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">ViewerCallbackSample</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ViewerCallbackSample</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/Viewer_Main.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Headers/Viewer_Callbacks.h</option>
<option value="listing2.html">/Headers/Viewer_Error.h</option>
<option value="listing3.html">/Headers/Viewer_Events.h</option>
<option value="listing4.html">/Headers/Viewer_Main.h</option>
<option value="listing5.html">/Headers/Viewer_Menu.h</option>
<option value="listing6.html">/Headers/Viewer_Message.h</option>
<option value="listing7.html">/Headers/Viewer_System.h</option>
<option value="listing8.html">/Headers/Viewer_Window.h</option>
<option value="listing9.html">/Source/Viewer_Callbacks.c</option>
<option value="listing10.html">/Source/Viewer_Error.c</option>
<option value="listing11.html">/Source/Viewer_Events.c</option>
<option value="listing12.html">/Source/Viewer_Main.c</option>
<option value="listing13.html">/Source/Viewer_Menu.c</option>
<option value="listing14.html">/Source/Viewer_Message.c</option>
<option value="listing15.html">/Source/Viewer_System.c</option>
<option value="listing16.html">/Source/Viewer_Window.c</option></select>
				</p>
				</form>
				<p><strong><a href="ViewerCallbackSample.zip">Download Sample</a></strong> (&#147;ViewerCallbackSample.zip&#148;, 38.1K)<BR>
<strong><a href="ViewerCallbackSample.dmg">Download Sample</a></strong> (&#147;ViewerCallbackSample.dmg&#148;, 97.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  *  Viewer_Main.c * *  QuickDraw 3D 1.6 Sample *  Robert Dierkes * *   12/22/98  RDD    Created. *//*------------------*//*  Include Files  *//*------------------*/#include &quot;QD3D.h&quot;#include &quot;QD3DViewer.h&quot;#if defined(OS_MACINTOSH) &amp;&amp; OS_MACINTOSH#include &lt;Fonts.h&gt;#include &lt;MacWindows.h&gt;#include &lt;StandardFile.h&gt;  /* SFTypeList */#endif#include &quot;Viewer_Error.h&quot;#include &quot;Viewer_Callbacks.h&quot;#include &quot;Viewer_Events.h&quot;#include &quot;Viewer_Message.h&quot;#include &quot;Viewer_Main.h&quot;#include &quot;Viewer_Menu.h&quot;#include &quot;Viewer_Window.h&quot;#include &quot;Viewer_System.h&quot;/*----------------------*//*  Global Declarations  *//*----------------------*/TQ3Boolean    gTimeToQuit;WindowRef    gAppResizeWindow = NULL; /* For example 2 *//*----------------------*//*  Local Prototypes  *//*----------------------*/staticTQ3Boolean Main_Initialize(      void);staticTQ3Boolean Main_Exit(      void);staticvoid  Main_Initialize_Toolbox (      void);staticTQ3Boolean  Main_CreateViewerInWindow(      unsigned long  viewerFlags,      Rect      *pWindowRect,      short      viewerInset,      Str255      title,      WindowPtr    *pWindow,      TQ3ViewerObject  *pViewer);staticTQ3Status Main_CreateViewer(      unsigned long  example,      short      fileRefNum,      WindowPtr    *hWindow);staticTQ3Status Main_GetModelFileRef(      short      *pRefNum);/* *  main */void main(    void){  if (Main_Initialize()) {    Events_Process();    Main_Exit();  }}/* *  Main_Initialize */staticTQ3Boolean Main_Initialize(      void){  short    fileRefNum = 0;  long    i;  gTimeToQuit = kQ3False;  Main_Initialize_Toolbox();  if (Events_Initialize() == false)    return kQ3False;  if (QuickDraw3D_Initialize() == kQ3False)    return kQ3False;  Message_Register();  if (Menu_Initialize() == kQ3False)    return kQ3False;  /* Select a model */  if (Main_GetModelFileRef(&amp;fileRefNum) == kQ3Failure) {    return kQ3False;  }  if (Window_Initialize() == kQ3Failure) {    return kQ3False;  }  i = kMaxWindowCount;  while (--i &gt;= 0) {    if (Main_CreateViewer(i, fileRefNum, &amp;gWindows[i]) == kQ3Failure)      return kQ3False;  }  return kQ3True;}/* *  Main_Initialize_Toolbox * */staticvoid Main_Initialize_Toolbox(      void){  MaxApplZone();  MoreMasters();  MoreMasters();  MoreMasters();   InitGraf(&amp;qd.thePort);  InitFonts();  InitWindows();  InitCursor();    /*   * Must call this to expand heap is expanded to maximum   * size before calling any Viewer routines   */  MaxApplZone();}/* *  Main_Exit */staticTQ3Boolean Main_Exit(      void){  if (gTimeToQuit) {    (void) Window_Exit();    (void) QuickDraw3D_Exit();    gTimeToQuit = kQ3False;  }  return kQ3True;}#pragma mark -/* * Main_CreateViewer */TQ3Status Main_CreateViewer(    unsigned long  example,    short      fileRefNum,    WindowPtr    *hWindow){  const  short  kWindowHeight  = 240;  const  short  kWindowWidth  = 360;  const  short  kWindowLeft    = 12;  const  short  kWindowTop    = 48;  const  short  kWindowRight  = (kWindowLeft + kWindowWidth);  const  short  kWindowBottom  = (kWindowTop  + kWindowHeight);  const  short  kWindowOffset  = 24;  const  short  kViewerInset  = 20;  TQ3Status    status      = kQ3Failure;  OSErr      theErr      = paramErr;  TQ3ViewerObject  viewer      = NULL;  unsigned long  viewerFlags;  short      windowOffset;  short      viewerInset;  Rect      windowRect  = { kWindowTop, kWindowLeft, kWindowBottom, kWindowRight };  Str255      winTitles[] = {  &quot;\pDefault Viewer&quot;,                  &quot;\pViewer with Window Grow Box&quot;,            /* TODO */  &quot;\pViewer with Application Window Grow Box&quot;,                  &quot;\pViewer with Pane Grow Box and Callback&quot;,                  &quot;\pViewer with Pane &amp; Window Grow Boxes&quot;,                  &quot;\pViewer with Drawing Callback&quot;                  };  /* Customize Viewer's appearance and functions */  viewerFlags =   kQ3ViewerButtonCamera    |          kQ3ViewerButtonTruck    |          kQ3ViewerButtonOrbit    |          kQ3ViewerButtonDolly    |          kQ3ViewerButtonReset    |          kQ3ViewerButtonOptions    |          kQ3ViewerDrawDragBorder    |          kQ3ViewerControllerVisible  |          kQ3ViewerActive;  switch (example) {  default:  case 0:  /* Use default Viewer flags and behavior */    viewerFlags  = kQ3ViewerDefault;    viewerInset  = 0;    break;  case 1:  /* Viewer draws window grow box and handles window resizing */    viewerFlags |= kQ3ViewerDrawGrowBox;    viewerInset  = 0;    break;  case 2:  /* Viewer draws window grow box and notifies app after it's been resized */    viewerFlags  = kQ3ViewerDefault;//TODO    viewerFlags |= kQ3ViewerDrawGrowBox;    viewerInset  = 0;    break;  case 3:  /* Viewer draws pane grow box and notifies app when it's been resized */    viewerFlags |= kQ3ViewerPaneGrowBox;    viewerInset  = kViewerInset;    break;  case 4:  /* Viewer draws window &amp; pane grow box and notifies app after pane grow box has been resized */    viewerFlags |= (kQ3ViewerPaneGrowBox | kQ3ViewerDrawGrowBox);    viewerInset  = kViewerInset;    break;  case 5:  /* Viewer notifies app after it's completed drawing */    viewerFlags  = kQ3ViewerDefault;    viewerInset  = kViewerInset;    break;  }  windowOffset = example * kWindowOffset;  MacOffsetRect(&amp;windowRect, windowOffset, windowOffset);  /*   * Create a Viewer with these flags   */  if (Main_CreateViewerInWindow(      viewerFlags,      &amp;windowRect,      viewerInset,      winTitles[example],      hWindow,      &amp;viewer) == kQ3False) {    return kQ3Failure;  }  /*   * Add Viewer model from user selected file   */  if (Q3ViewerUseFile(viewer, fileRefNum) != noErr) {    ERROR_DEBUG_STR(&quot;Main_CreateViewer: Q3ViewerUseFile failed.&quot;);    return kQ3Failure;  }  /*   * Set callback   */  switch (example) {  /* Use default Viewer flags and behavior */  default:  case 0:  status = kQ3Success;  break;  /* Viewer draws window grow box and handles window resizing */  case 1:  status = kQ3Success;  break;  /* Viewer draws window grow box and calls app to resize window */  case 2:  status = Callbacks_InitWindowResizeCallback(viewer, *hWindow);    gAppResizeWindow = *hWindow;    break;  /* Viewer draws pane grow box and notifies app when it's been resized */  case 3:  status = Callbacks_InitPaneResizeCallback(viewer, *hWindow, 0);  break;  /* Viewer draws window &amp; pane grow box and notifies app after pane grow box has been resized */  case 4:  status = Callbacks_InitPaneResizeCallback(viewer, *hWindow, 1);  break;  /* Viewer notifies app after it's completed drawing */  case 5:  status = Callbacks_InitDrawingCallback(viewer, *hWindow);    break;  }  return status;}/* *  Main_CreateViewerInWindow */staticTQ3Boolean Main_CreateViewerInWindow(  unsigned long  viewerFlags,  Rect      *pWindowRect,  short      viewerInset,  Str255      title,  WindowPtr    *pWindow,  TQ3ViewerObject  *pViewer){  WindowPtr    window = NULL;  Rect      viewerRect;  /*   * Create a window   */  if ((*pWindow = GetNewCWindow(kWindowRsrcID, NULL, kWindowOnTop)) == NULL) {    ERROR_DEBUG_STR(&quot;Main_CreateViewerInWindow: NewCWindow failed.&quot;);    return kQ3False;  }  window = *pWindow;  SetPort((GrafPtr) window);  MacMoveWindow(      window,      pWindowRect-&gt;left,      pWindowRect-&gt;top,      true);  SizeWindow(      window,      (pWindowRect-&gt;right  - pWindowRect-&gt;left),      (pWindowRect-&gt;bottom - pWindowRect-&gt;left),      true);  SetWTitle(window, title);  ShowWindow(window);  /*   * Add a Viewer to this window   */  viewerRect = window-&gt;portRect;  MacInsetRect(&amp;viewerRect, viewerInset, viewerInset);  if ((*pViewer = Q3ViewerNew(            (CGrafPtr) window,            &amp;viewerRect,            viewerFlags)) == NULL) {    ERROR_DEBUG_STR(&quot;Main_CreateViewerInWindow: Q3ViewerNew failed.&quot;);    return kQ3False;  }  /* Save reference to Viewer in window's refcon */  SetWRefCon(window, (long) *pViewer);  return kQ3True;}/* *  Main_GetModelFileRef */staticTQ3Status Main_GetModelFileRef(  short        *pRefNum){  TQ3Status      status   = kQ3Failure;  short        numTypes = 1;   SFTypeList      typeList = { '3DMF' };  StandardFileReply  sfReply;  StandardGetFile(nil, numTypes, typeList, &amp;sfReply);  if (sfReply.sfGood) {    /* Open the file */    if (FSpOpenDF(&amp;sfReply.sfFile, fsRdPerm, pRefNum) == noErr) {      status = kQ3Success;    }    else {      ERROR_DEBUG_STR(&quot;Main_GetModelFileRef: FSpOpenDF failed.&quot;);    }  }  return status;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ViewerCallbackSample/listing12.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ViewerCallbackSample/listing12.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ViewerCallbackSample/listing12.html%3Fid%3DDTS10000137-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>