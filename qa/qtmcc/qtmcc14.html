<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Q&amp;A QTMCC14: Component Definitions</title><meta name="keywords" content="have creator list relevant keywords here"><meta name="Description" content="Technical Q&amp;A QTMCC14: This Q&amp;A discusses the differencesbetween Components, Component Instances, Component Storage,and Component RefCons."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Sep 18, 2000 - Sep 22, 2000"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001957" title="Component Definitions"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxQuickTimeComponentCreation-date.html">QuickTime Component Creation</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QTMCC14</div>
<div id="pageheadsub">Component Definitions</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600> <TR> <td align="left"><!-- begin_content --><TABLE>	<TR>		<td align="left"><p id=p2>Q: Please explain the difference between Components, Component Instances, Component Storage, and Component <CODE>RefCons</CODE>.</p><P id=p4>A: A Component is a 32-bit value that identifies a particular component -- for example, Graphics Exporter Components, which know how to export image files in a variety of formats. This value is not a pointer.</p>		</TD>	</TR></TABLE><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>// Finding Componentsvoid FindGraphicsExporterComponents(void){    Component c = 0;    // The Component Identifier    ComponentDescription cd;    cd.componentType = GraphicsExporterComponentType;    cd.componentSubType = 0;    cd.componentManufacturer = 0;    cd.componentFlags = 0;    cd.componentFlagsMask = graphicsExporterIsBaseExporter; while((c = FindNextComponent(c, &amp;cd)) != 0) {  ... // do something with the found component }}</pre></td></tr></table></CENTER><BR><TABLE>	<TR>		<td align="left"><P id=p4>A <CODE>ComponentInstance</CODE> is a 32-bit value which identifies a particular connection that has been opened to a component using <CODE>OpenComponent</CODE>, <CODE>OpenAComponent</CODE>, <CODE>OpenDefaultComponent</CODE> or <CODE>OpenADefaultComponent</CODE>. This value is not a pointer.</P></td></tr></table><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>// Open and return an Instance of the Sequence Grabber ComponentSeqGrabComponent OpenSequenceGrabber(void){    ComponentInstance seqGrabComponent = 0;    OSErr err = noErr;    err = OpenADefaultComponent(SeqGrabComponentType, 0, &amp;seqGrabComponent);    if(err || !seqGrabComponent) return 0;    return seqGrabComponent;}</pre></td></tr></table></CENTER><BR><TABLE>	<TR>		<td align="left"><P id=p4>Components are analogous to classes in object-oriented languages. Component Instances are analogous to objects of those classes.</P><P id=p4>A Component's Instance Storage (or Globals) is a pointer or handle to a block of memory which has been allocated in the component's <CODE>Open</CODE> routine and set up using <CODE>SetComponentInstanceStorage</CODE>. This must be a pointer or handle.</P><P id=p4>When someone calls a component function, the first parameter must be a valid <CODE>ComponentInstance</CODE> or a valid Component. If the first parameter is a Component, the component is opened, the call is made, and then the component is closed again; this is called a one-shot call. By the time the implementation of that component function is called, the first parameter has been replaced by the component's instance storage.</P><P id=p4>Generally, a component's Open function allocates memory for the instance storage (usually using <CODE>NewPtrClear</CODE>) and calls <CODE>SetComponentInstanceStorage</CODE> to associate it with itself.  The <CODE>Open</CODE> function is also passed to the component instance value (as a parameter called <I>self</I>); components usually store this value inside their instance storage if they might need it in another call.</P></td></tr></table><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>typedef struct {    ComponentInstance delegate; // keep track who we are delegating it to.    ComponentInstance self;     // self instance needed if targeted} PrivateGlobals;// Open Component callpascal ComponentResult MyOpen(ComponentInstance self){    PrivateGlobals *myPrivateGlobals;    myPrivateGlobals = NULL;    // Set up an environment to service the connection.    ...    // Create private variables -- allocate memory for our PrivateGlobals.    myPrivateGlobals = (PrivateGlobals *)NewPtrClear(sizeof(PrivateGlobals));    if (myPrivateGlobals == NULL)        goto bail;    // Initialize private variables, etc.    myPrivateGlobals-&gt;self = self;    ...    // Associates the newly allocated instance globals with the    // connection specified by the ComponentInstance parameter. Make sure to    // dispose of any allocated memory for the connection in response to the    // close request.    SetComponentInstanceStorage(self, (Handle)myPrivateGlobals);    return noErr;bail:    if (myPrivateGlobals)        DisposePtr((Ptr)myPrivateGlobals);    return memFullErr;}</pre></td></tr></table></CENTER><BR><P>Remember, any memory allocated during the <CODE>Open</CODE> function should be deallocated in <CODE>Close</CODE> when the connection to the component is closed.</P><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>pascal ComponentResult MyClose(Handle storage, ComponentInstance self){    if (storage)        // Dispose of private globals.        DisposePtr((Ptr)storage));    return noErr;}</pre></td></tr></table></CENTER><BR><P id=p4>A component's <CODE>Refcon</CODE> (or Shared Globals) is a value which the Component Manager associates with a component if it so requests by calling <CODE>SetComponentRefcon</CODE>. Although this <CODE>Refcon</CODE> can be any value the component requires, many components use this <CODE>Refcon</CODE> value to store a pointer to data structures shared by multiple instances of the component.</P><P id=p4>Some components set up their shared globals the first time they are opened and dispose them when they are unregistered, while other components use shared globals, and avoid having multiple copies of lookup tables in memory when there are multiple instances of the component open.  Dispose of them when the lastinstance is closed.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550> <TR> <td bgcolor="#EEEEE0" align=left><pre>typedef struct {    long shared;} SharedGlobals;pascal ComponentResult MyOpen(ComponentInstance self){    SharedGlobals *mySharedGlobals;    mySharedGlobals = NULL;    // Set up an environment to service the connection.    ...    // Create shared variables if they don&#146;t exist.    mySharedGlobals = (SharedGlobals *)GetComponentRefcon((Component)self);    if (mySharedGlobals == NULL) {        mySharedGlobals=(SharedGlobals *)NewPtrSysClear(sizeof(SharedGlobals));        if (mySharedGlobals == NULL)            goto bail;        SetComponentRefcon((Component)self, (long)mySharedGlobals);        // Initialize shared variables.        mySharedGlobals-&gt;shared = 0;    }    // Initialize private variables, set up connection, etc.    ...    return noErr;bail:    if (mySharedGlobals)        DisposePtr((Ptr)mySharedGlobals);    return memFullErr;}</pre></td></tr></table></CENTER><BR><P id=p4>A final note regarding shared globals: if you allocate memory for shared globals on the Macintosh, you should allocate them in the System heap (using <CODE>NewPtrSysClear</CODE>), since they may be shared between multiple applications.</P><hr width=500 align=center> <!-- begin_date --><H4 ALIGN=center>[Sep 22 2000]</H4><!-- end_date --></TD> </TR> </TABLE></CENTER></CENTER><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qtmcc/qtmcc14.html%3Fid%3DDTS10001957-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qtmcc/qtmcc14.html%3Fid%3DDTS10001957-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qtmcc/qtmcc14.html%3Fid%3DDTS10001957-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>