<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Implementing Driver Gestalt</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.cb.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.ce.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d0.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=4110"> </A>Implementing Driver Gestalt</H1><P CLASS="T1.Text1"><A NAME="pgfId=4111"> </A>If a native driver has indicated support for driver gestalt, as described in the previous section, it must conform to these rules:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=4112"> </A>It must respond to all unsupported status <TT CLASS="cv">csCode</TT> values with a <TT CLASS="cv">statusErr</TT> value, and to all unsupported control <TT CLASS="cv">csCode</TT> values with a <TT CLASS="cv">controlErr</TT> value. This rule is the most important for drivers to follow after calling <TT CLASS="cv">DriverGestaltOn</TT>.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=4113"> </A>It should be capable of closing properly and of removing vertical blanking (VBL) tasks, Time Manager tasks, drive queue elements, and so on. Drivers that can close should return <TT CLASS="cv">noErr</TT> in response to <TT CLASS="cv">Close</TT> requests. If it is absolutely not possible for the driver to close, it must respond with <TT CLASS="cv">closErr</TT> and continue to function as if the <TT CLASS="cv">Close</TT> request had not been issued.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=4117"> </A>It must implement the <TT CLASS="cv">csCode</TT> values listed in <A HREF="PCI_BOOK.cf.html#25963" CLASS="XRef">Table&nbsp;8-3</A> and described in the rest of this section. Driver clients seeing the <TT CLASS="cv">DriverGestaltEnable</TT> bit set will assume that these calls will either produce the required actions or result in a <TT CLASS="cv">statusErr</TT> or <TT CLASS="cv">controlErr</TT>. </LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=4118"> </A>It must not use private csCodes with values lower than 128. All codes must be allocated withing the range 128 to 32767.</LI></UL><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=17272"> </A>Note</b></p><P CLASS="Note"><A NAME="pgfId=4119"> </A>The <TT CLASS="cv">kcsDriverGestalt</TT> and <TT CLASS="cv">kcsDriverConfigure</TT> codes produce the principal functionality of the native driver model. For historical reasons, setting the <TT CLASS="cv">DriverGestaltEnable</TT> bit also requires that the other calls listed in <A HREF="PCI_BOOK.cf.html#25963" CLASS="XRef">Table&nbsp;8-3</A> either be supported or return an error code. Future control or status calls for all native PCI drivers will be implemented using only selectors through <TT CLASS="cv">DriverGestalt</TT> and <TT CLASS="cv">DriverConfigure</TT>.</P></blockquote><b><P CLASS="Tb.Table"><A NAME="pgfId=6506"> </A>Table&nbsp;8-3	<A NAME="25963"> </A>Driver gestalt codes</P></b><TABLE border=1 cellpadding=3><TR><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=6512"> </A>Name</P></TH><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=6514"> </A>Value</P></TH><TH ROWSPAN="1" COLSPAN="1"><P CLASS="TbH.TblHd"><A NAME="pgfId=6516"> </A>Description</P></TH></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TbSb.TblSubHd"><A NAME="pgfId=6518"> </A>Status codes</P></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6520"> </A></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6522"> </A></FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6524"> </A><TT CLASS="cv">kcsDriverGestalt</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6526"> </A> 43</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6528"> </A>General status information</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6530"> </A><TT CLASS="cv">kcsGetPowerMode</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6532"> </A> 70</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6540"> </A>Returns card power mode<A HREF="#pgfId=6539" CLASS="footnote">1</A></FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6542"> </A><TT CLASS="cv">kcsReturnDeviceID</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6544"> </A>120</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6546"> </A>Returns SCSI device ID in <TT CLASS="cv">csParam[0]</TT></FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><P CLASS="TbSb.TblSubHd"><A NAME="pgfId=6548"> </A>Control codes</P></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6550"> </A></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6552"> </A></FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6554"> </A><TT CLASS="cv">kcsDriverConfigure</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6556"> </A> 43</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6558"> </A>General configuration commands</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6560"> </A><TT CLASS="cv">kcsSetStartupDrive</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6562"> </A> 44</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6564"> </A>Designates partition as a boot partition</FONT></TD></TR><TR><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6566"> </A><TT CLASS="cv">kcsSetPowerMode</TT></FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6568"> </A> 70</FONT></TD><TD ROWSPAN="1" COLSPAN="1"><FONT CLASS="TbT.TblText"><A NAME="pgfId=6570"> </A>Sets card power mode<EM CLASS="Superscript">*</EM></FONT></TD></TR></TABLE></DIV><HR><DIV CLASS="footnotes"><DIV CLASS="footnote"><FOOTNOTE CLASS="FN.Footnote"><SPAN CLASS="footnoteNumber">1.</SPAN><A NAME="pgfId=6539"> </A>For a discussion of power modes, see <A HREF="PCI_BOOK.1d1.html#10599" CLASS="XRef">Card Power Controls</A>.</FOOTNOTE></DIV></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.cb.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.ce.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.d0.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>