<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Test Code - /Test Code/TinselTest.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Test Code</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Test Code</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Test Code/TinselTest.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Test Code/TinselMipMap.c</option>
<option value="listing2.html">/Test Code/TinselTest.c</option>
<option value="listing3.html">/Test Code/TinselTest.h</option>
<option value="listing4.html">/Test Code/TinselWindow.c</option>
<option value="listing5.html">/TestLinked.prefix.h</option>
<option value="listing6.html">/TestShared.prefix.h</option></select>
				</p>
				</form>
				<p><strong><a href="Test_Code.zip">Download Sample</a></strong> (&#147;Test_Code.zip&#148;, 24.1K)<BR>
<strong><a href="Test_Code.dmg">Download Sample</a></strong> (&#147;Test_Code.dmg&#148;, 78.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/****************************************************************************** **                                       ** **   Module:    TinselTest.c                       ** **                                      ** **   Purpose:   Main file for Tinsel Town test app             ** **                                      ** **   Author:    Mike W. Kelley                       ** **                                       ** **          2/3/95  Revised for 0.9 SDK release             ** **                                      ** **   Copyright (C) 1994-95 Apple Computer, Inc.  All rights reserved.   ** **                                      ** *****************************************************************************/#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;math.h&gt;/* Macintosh */#include &lt;Types.h&gt;#include &lt;QuickDraw.h&gt;#include &lt;Windows.h&gt;/* Project */#include &quot;RAVE.h&quot;#include &quot;TinselTest.h&quot;/******************************************************************************************* * * Defines that affect how the tests are run. * ******************************************************************************************/  #define dWaitForButton    /* If defined, wait for button click between tests */ /******************************************************************************************* * * Declare the registration function for the empty rasterizer. This allows us to call * it from our app, so we can link the rasterizer in instead of using a shared library. * ******************************************************************************************/extern OSErr TtRegister (void);/******************************************************************************************* * * Globals. * ******************************************************************************************/long      gWindowWidth, gWindowHeight;TQAEngine    *gEngine [kTinselWindows];TQADrawContext  *gDrawContext [kTinselWindows];TQATexture    *gTexture [kTinselWindows];/******************************************************************************************* * * Static variables used by this file's functions only. * ******************************************************************************************/static float frand (void){  return ((Random() + 32768) / 65536.0);}/******************************************************************************************* * * Main. This runs the tests, clearing the windows before each test and waiting for * a mouse click after each test. Each test is run four ways: Single and double buffered, * with and without 2D clipping. * ******************************************************************************************/int main(){  long    tinselTest, tinselStyle;  long    i;  TQAVGouraud  vGouraud[3];  TQAVTexture  vTexture[3];  long    flushCount;        /*   * If we are running with a shared library, TdLinkEngine should not be defined!   */    #ifdef dLinkEngine    (void) TtRegister();  #endif    /*   * Create the test window(s).   */    InitToolbox ();  if ( ! CreateTestWindows (kTinselMaxWindowSize, kTinselMaxWindowSize))  {    return (-1);  }  if ( ! CreateWindowClip ())  {    return (-1);  }  if ( ! TestTextureNew())  {    return (-1);  }    /*   * Run tests.   */    for (tinselStyle = 0; tinselStyle &lt;= kMaxStyle; ++tinselStyle)  {    switch (tinselStyle)    {      case kStyleSingleBuffered:        if ( ! TestDrawContextNew (kQAContext_DeepZ, false))        {          return (-1);        }        break;            case kStyleDoubleBuffered:        if ( ! TestDrawContextNew (kQAContext_DeepZ | kQAContext_DoubleBuffer, false))        {          return (-1);        }        break;              case kStyleSingleBufferedClip:        if ( ! TestDrawContextNew (kQAContext_DeepZ, true))        {          return (-1);        }        break;            case kStyleDoubleBufferedClip:        if ( ! TestDrawContextNew (kQAContext_DeepZ | kQAContext_DoubleBuffer, true))        {          return (-1);        }        break;    }    ClearWindows();          for (tinselTest = 0; tinselTest &lt;= kMaxTest; ++tinselTest)    {      switch (tinselTest)      {        case kTestPoints:          TestRenderStart();          for (i = 0, flushCount = kNPoints / kNFlushes; i++ &lt; kNPoints; /* Nothing */)          {            TestRandomVGouraud (&amp;vGouraud[0]);            TestDrawPoint (&amp;vGouraud[0]);            if ((i % flushCount) == 0)            {              TestFlush();            }          }          TestRenderEnd();          break;                  case kTestLines:          TestRenderStart();          for (i = 0, flushCount = kNLines / kNFlushes; i++ &lt; kNLines; /* Nothing */)          {            TestRandomVGouraud (&amp;vGouraud[0]);            TestRandomVGouraud (&amp;vGouraud[1]);            TestDrawLine (&amp;vGouraud[0], &amp;vGouraud[1]);            if ((i % flushCount) == 0)            {              TestFlush();            }          }          TestRenderEnd();          break;                  case kTestTriGouraud:          TestRenderStart();          for (i = 0, flushCount = kNTris / kNFlushes; i++ &lt; kNTris; /* Nothing */)          {            TestRandomVGouraud (&amp;vGouraud[0]);            TestRandomVGouraud (&amp;vGouraud[1]);            TestRandomVGouraud (&amp;vGouraud[2]);                        TestDrawTriGouraud (&amp;vGouraud[0],                &amp;vGouraud[1], &amp;vGouraud[2], kQATriFlags_None);                        if ((i % flushCount) == 0)            {              TestFlush();            }          }          TestRenderEnd();          break;                  case kTestTriTexture:          TestRenderStart();          TestSetStateTexture();          for (i = 0, flushCount = kNTris / kNFlushes; i++ &lt; kNTris; /* Nothing */)          {            /*             * Setup the u,v values before calling TestRandomVTexture(),             * as it references them.             */                        vTexture[0].uOverW = 0.0;            vTexture[0].vOverW = 0.0;            vTexture[1].uOverW = 0.0;            vTexture[1].vOverW = 1.0;            vTexture[2].uOverW = 1.0;            vTexture[2].vOverW = 1.0;            TestRandomVTexture (&amp;vTexture[0]);            TestRandomVTexture (&amp;vTexture[1]);            TestRandomVTexture (&amp;vTexture[2]);                        TestDrawTriTexture (&amp;vTexture[0],                &amp;vTexture[1], &amp;vTexture[2], kQATriFlags_None);                        if ((i % flushCount) == 0)            {              TestFlush();            }          }          TestRenderEnd();          break;      }            #ifdef dWaitForButton        /*         * Wait for a mouse button click..         */                while ( ! Button())          /* Do nothing */ ;        FlushEvents (everyEvent, 0);      #endif    }        TestDrawContextDelete();  }    return (0);}/******************************************************************************************* * * Set xyzw fields of a TQAVGouraud randomly. All other fields get simple defaults. * ******************************************************************************************/void TestRandomVGouraud (  TQAVGouraud    *v){  v-&gt;x = frand() * gWindowWidth;  v-&gt;y = frand() * gWindowHeight;  v-&gt;z = frand();  v-&gt;invW = 1.0 / v-&gt;z;    v-&gt;a = 1.0;  v-&gt;r = frand();  v-&gt;g = frand();  v-&gt;b = frand();}/******************************************************************************************* * * Set xyzw fields of a TQAVTexture randomly. The incoming u,v values are multiplied * by the random invW value; all other fields get simple defaults. * ******************************************************************************************/void TestRandomVTexture (  TQAVTexture    *v){  v-&gt;x = frand() * gWindowWidth;  v-&gt;y = frand() * gWindowHeight;  v-&gt;z = frand();  v-&gt;invW = 1.0 / v-&gt;z;    v-&gt;uOverW *= v-&gt;invW;  v-&gt;vOverW *= v-&gt;invW;    v-&gt;a = 1.0;  v-&gt;r = 0.0;  v-&gt;g = 0.0;  v-&gt;b = 0.0;    v-&gt;kd_r = 1.0;  v-&gt;kd_g = 1.0;  v-&gt;kd_b = 1.0;    v-&gt;ks_r = 0.0;  v-&gt;ks_g = 0.0;  v-&gt;ks_b = 0.0;}/******************************************************************************************* * * Miscellaneous test functions. * ******************************************************************************************/void TestRenderStart (void){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QARenderStart (gDrawContext [i], NULL, NULL);    }  }}void TestRenderEnd (void){  long    i;  TQAError  status;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      status = QARenderEnd (gDrawContext [i], NULL);    }  }}void TestSetStateTexture (void){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QASetPtr (gDrawContext [i], kQATag_Texture, gTexture [i]);            /*       * NOTE: The current Apple software rasterizer always assumes these       * kQATextureOp_Modulate | kQATextureOp_Highlight are set, as that's       * the standard QuickDraw(tm) 3D mode. So if you change this, you may       * find that the software rasterizer isn't a good test case.       * (This will be fixed soon...)       */            QASetInt (gDrawContext [i], kQATag_TextureOp,          kQATextureOp_Modulate | kQATextureOp_Highlight);    }  }}void TestFlush (void){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QAFlush (gDrawContext [i]);    }  }}void TestDrawPoint (  const TQAVGouraud  *v){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QADrawPoint (gDrawContext [i], v);    }  }}void TestDrawLine (  const TQAVGouraud  *v0,  const TQAVGouraud  *v1){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QADrawLine (gDrawContext [i], v0, v1);    }  }}void TestDrawTriGouraud (  const TQAVGouraud  *v0,  const TQAVGouraud  *v1,  const TQAVGouraud  *v2,  unsigned long    flags){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gDrawContext [i])    {      QADrawTriGouraud (gDrawContext [i], v0, v1, v2, flags);    }  }}void TestDrawTriTexture (  const TQAVTexture  *v0,  const TQAVTexture  *v1,  const TQAVTexture  *v2,  unsigned long    flags){  long    i;    for (i = 0; i &lt; kTinselWindows; ++i)  {    /*     * Test both for a draw context, and that a texture was created.     */        if (gDrawContext [i] &amp;&amp; gTexture [i])    {      QADrawTriTexture (gDrawContext [i], v0, v1, v2, flags);    }  }}Boolean TestTextureNew (void){  TexturePixel    *pixmap;  long        x, y;  long        i;    /*   * Create the source pixmap. Note that we can't free it (unless we   * called QATextureDetach()). We just do a procedural map with some   * checkerboard effect...   */    if ( ! (pixmap = malloc (sizeof (*pixmap) * kTextureSize * kTextureSize)))  {    return (false);  }    for (x = 0; x &lt; kTextureSize; ++x)  {    for (y = 0; y &lt; kTextureSize; ++y)    {      pixmap [x + (y &lt;&lt; kTextureSizeNBits)].a = 0xff;      pixmap [x + (y &lt;&lt; kTextureSizeNBits)].r = (x &amp; 0x1f) &lt;&lt; 3;      pixmap [x + (y &lt;&lt; kTextureSizeNBits)].g = (y &amp; 0x1f) &lt;&lt; 3;      pixmap [x + (y &lt;&lt; kTextureSizeNBits)].b = (((x + y) / 2) &amp; 0x1f) &lt;&lt; 3;    }  }  for (i = 0; i &lt; kTinselWindows; ++i)  {    if (gEngine [i])    {      /*       * Create the texture. If this fails, gTexture[i] will be NULL.       * This is ok, as TestDrawTriTexture() always tests it before calling       * QADrawTriTexture().       */            gTexture [i] = CreateMipMapTexture (          gEngine [i],                /* store context */          pixmap,                    /* high res pix map */          kTextureSize * sizeof (*pixmap),      /* row bytes */          kTextureSizeNBits,              /* widthNBits */          kTextureSizeNBits);              /* heightNBits */    }  }    return (true);}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Test_Code/listing2.html%3Fid%3DDTS10000154-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Test_Code/listing2.html%3Fid%3DDTS10000154-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Test_Code/listing2.html%3Fid%3DDTS10000154-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>