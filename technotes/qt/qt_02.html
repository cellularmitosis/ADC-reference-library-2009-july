<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../style.css" TYPE="text/css"><title>Technical Note QT02: Loading Components Bug</title><meta name="keywords" content="Mac OS 8 Loading Components bug Quicktime Manager resource file"><meta name="Description" content="Technical Note QT02: This Technical Note documents the bugwhere the Component Manager may change the current resourcefile in the resource search path.">                                       <meta name="categories" content="QuickTime"><meta name="week-posted" content="Nov 30, 1992 - Dec 4, 1992"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002744" title="Loading Components Bug"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QT02</div>
<div id="pageheadsub">Loading Components Bug</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">What, Me Worry?</A><BR><BR><A HREF="#Section2">Que pasa?</A><BR><BR><A HREF="#Section3">Whatsamatta U?</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">The Component Manager may change the current resource file in the resourcesearch path. This is a bug and will be fixed as soon as possible.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Dec 01 1992]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><H2>What, Me Worry?</h2><p>In general, the bug documented here will not be a problem for most applications(Don't worry, be happy), because most of the time the component will already bein memory or doesn't have to be loaded, and most applications leave theresource search path set to the topmost file. Here are a couple of questions tohelp you understand if this bug pertains to you:</p><ul type="disc">	<li>Do you use the Component Manager?</li>	<li>Do you keep more than one resource file open and change the current resource path (that is, <code>CurResFile</code>)?</li>	<li>Do you open components at a time when you depend on the current resource path being set to something other than the topmost file?</li></ul><p>If you've said yes to all of the above questions, write a check payable to JimReekes for 33 percent of the amount of taxable income declared on your FederalIncome Tax statement. Then continue reading this Technote to find out if thisbug will byte you. Otherwise, take a vacation, you've been working too hard.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><H2>Que pasa?</h2><p>When the call <code>_OpenComponent</code> is made, the Component Manager may needto load the component's code. To load the Component, the component's resourcefile must be opened and closed. A side effect of this may be to change the topof the Resource Manager's search path. To open the component's resource file,the Component Manager calls <code>_OpenComponentResFile</code>. It then loads thecomponent's code, and calls <code>_CloseComponentResFile</code>. The Resource Manager will set the current resource search path to the top most file, <i>which will be the map that was at the top of the path prior to opening the component</i>.</p><p align=center><img src="images/qt_02_001.gif" alt="Figure 1" width=416 height=189></p><p align=center><b>Figure 1</b>. Resource Search Paths</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><H2>Whatsamatta U?</h2><p>Figure 1 shows how the resource search path is configured during the course ofopening a component. The "before" path shows how the resource search path wouldlook for an application that has opened a resource file and then set the top ofthe resource search path to be itself. Remember the way the Resource Manager works? The top of the search path is searched first when calling <code>_GetResource</code>, and then, if the resource is not found, the search is continued at the next file down in the search path. If an application is opening resource files, it may wish to avoid inadvertently getting resources from that newly opened file. For example, let's say you have opened a resource file that contains sound resources but your application also has sound resources and you don't want to get the wrong one at the wrong time. So you may wish to protect yourself by setting the search path to begin at the application level to exclude the open resource file above it by using <code>_CurResFile</code>. This way whenever you call <code>_GetResource</code> you'll be sure to only get sound resources from your application.</p><p>When a new resource file is opened, by default the resource search path is setto start at this file. This is a good thing. Then when that file is closed, theResource Manager will set the top of the search path to the next file. This maybe a bad thing if you don't want resources to be loaded from this file. This isexactly what is happening when a component is loaded by the Component Manager.The Component Manager may need to load the code resource from the component'sresource file. This is the "during" path shown in the Figure 1.<b> </b>Once thecode resource has been loaded, the Component Manager will close the resourcefile. This is the situation shown in the "after" path of the figure.</p><p>The lesson to learn is that opening a component may change the current resourcesearch path. You can open a component by calling any component's method. Now you don't need to save and restore the resource path around every component call, but when you use <code>_OpenComponent</code> you should protect yourself. Additionally when you use the Component Manager's trap <code>_OpenComponentResFile</code> it will change the resource search path just like <code>_OpenResFile</code>. So you may wish to preserve the resource search path yourself around this call too. Below is an example of the code you may wish to use:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre> oldResFile = CurResFile();    c = OpenComponent(aComponent)    UseResFile(oldResFile);</pre>	</TD></TR></TABLE></CENTER><p>One potential side-effect of this is when you use a component and don't knowit. QuickTime, for example, is based on components. QuickTime installs graphicprocedures to support <code>_DrawPicture</code>. If a picture contains a compressedimage (JPEG, for example), it may cause the image decompression component to beloaded and possibly change the resource search path. If you know you aresupporting QuickTime image compressed images using <code>_DrawPicture</code>, you may need to save and restore the resource search path around it.</p><a name="References"></a><P><A HREF="#top">Back to top</A></p><H2>References</h2><P><i>Inside Macintosh,</i> Component Manager</p><P><i>Inside Macintosh,</i> Resource Manager</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (76K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qt_02.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qt/qt_02.html%3Fid%3DDTS10002744-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qt/qt_02.html%3Fid%3DDTS10002744-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qt/qt_02.html%3Fid%3DDTS10002744-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>