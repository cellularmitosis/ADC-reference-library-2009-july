<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-05-01 --><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1114: LW 8.5.1 CopyBits Support: Transparent and Clipped Images</title>       <meta name="keywords" content="Mac OS 8 CopyBits support transparent mode maskRgn Clipping Laserwriter">    <meta name="Description" content="Technical Note TN1114: This Technical Note describes whereApple has enhanced its   handling of the CopyBits() callin LaserWriter 8.5.1 so that developers and users may takeadvantage of the  improvements. Improvements documented arethe Transparent Mode, and maskRgn Clipping. Limitations tothe added CopyBits() support is also discussed."><meta name="categories" content="Printing"><meta name="week-posted" content="Sep 1, 1997 - Sep 5, 1997"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002954" title="LW 8.5.1 CopyBits Support: Transparent and Clipped Images"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxPrinting-date.html">Printing</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Printing/index.html" target="_blank">Reference Library > Printing</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1114</div>
<div id="pageheadsub">LW 8.5.1 CopyBits Support: Transparent and Clipped Images</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><center><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">          <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><p id="menutext"><A HREF = "#Section1">Transparent Mode</A><BR><BR><A HREF = "#Section2">MaskRgn Clipping</A><BR><BR><A HREF = "#Section3">Limitations</A><BR><BR><A HREF = "#Summary">Summary</A><br><BR><A HREF="#References">References</a><BR><BR><A HREF="#Downloads">Downloadables</A></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left>            			<!-- begin_intro_text --><p id="introtext">In the current LaserWriter 8 driver, the Chooser lists printers which are available on the AppleTalk network (either LocalTalk or AppleTalk) with an NBP type of "LaserWriter".  When the user selects one of these printers, LaserWriter 8 creates a desktop printer by sending an Apple Event to the Finder. In the past, this mechanism of setting up printers has served the needs of most users. However, with LaserWriter 8.5.1, Apple is responding to several requests for more flexible desktop printing functionality. To this end, Apple has introduced a new application called Desktop Printer Utility which enables users to create additional types of desktop printers. Users can now create desktop printers which use the Unix <I>lpr</I> protocol for printing, in addition to the regular AppleTalk PAP printers. There are also "hold" printers which represent local print queues and "virtual" printers which represent printers which are not available on the network.</P>         <p id="introtext">Along with the expanded capabilities, Desktop Printer Utility is also customizable. LaserWriter 8.5.1 and Desktop Printer Utility (together) support the creation and use of desktop printers known as Custom DTPs. When printed to, Custom DTPs cause the LaserWriter 8.5.1 driver to create a PostScript file and to launch an application that can post-process the PostScript. This post-processing application can do anything it likes with the PostScript file, such as converting the PostScript into another file format,  transferring the file to another location using a modem or a network connection, or displaying the PostScript file to the user.  This Technote describes how a developer might customize Desktop Printer Utility for use with an application.</P><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 06 1998]</h3><!-- end_date -->        </td>    </tr></table> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content -->         <A NAME="Section1"></A>                  <H2>Transparent Mode</H2><BR>                  <P>One transfer mode previously unsupported by the LaserWriter          driver is the transparent transfer mode. This mode allows drawing          of images other than 1-bit deep so that any sample in the source          which is the transparent color (defined as the QuickDraw background          color) will not be painted to the destination. The advantage of this          mode is that it lets a deep (&gt; 1-bit) image have holes in it by coloring          the holes in the image with the transparent color. Whereas previously the          LaserWriter driver would paint these images as if the transfer mode were          <CODE>srcCopy</CODE>, LaserWriter 8.5.1's new imaging code now handles the          transparent mode. </P>      <BR><P><A HREF="#top">Back to top</A></P>              <A NAME="Section2"></A>                  <H2>maskRgn Clipping</H2>                  <P>Another previously unsupported feature of <CODE>CopyBits()</CODE> was the ability          to pass in a mask (via the <CODE>maskRgn</CODE> field) to clip out portions of the          destination image. Previous LaserWriter drivers completely ignored the          <CODE>maskRgn</CODE> passed to <CODE>CopyBits()</CODE>. The new imaging code          in LaserWriter          8.5.1 now supports the supplied <CODE>maskRgn</CODE>.</P>         <BR><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>While the LaserWriter 8.5.1 driver now handles a supplied <CODE>maskRgn</CODE> to a <CODE>CopyBits</CODE> call, we do not do any  special handling of the clip provided in the <CODE>grafPort</CODE>. <CODE>GrafPort</CODE> clipping is still handled by clipping only to the bounding rectangle of the port's <CODE>clipRgn</CODE>, both for <CODE>CopyBits</CODE> calls as well as line art and text drawing. Apple considered more generalized support for the port <CODE>clipRgn</CODE> but has rejected it to date mainly due to compatibility concerns.</P></TD></TR></TABLE></CENTER><BR><BR> <BR><P><A HREF="#top">Back to top</A></P>         <P><A NAME="Section3"></A></P>                  <H2>Limitations</H2>                  <P>There are some known limitations with the added <CODE>CopyBits()</CODE> support          that you <BR>should be aware of. They are:</P>                 <UL TYPE=DISC>    <LI>Extremely complex clipping regions may occasionally fail on Level 1 or     Level 2 devices in low printer memory conditions. The result is that the     output will not preserve the clip, and the image will print as if the <CODE>maskRgn</CODE>     parameter is ignored.<BR>    Specifically, for PostScript Level 1 printers, there is a hard coded limit to how     complex a clip can be, regardless of the printer's installed memory. If the clip is     more complex than this limit, the LaserWriter driver ignores the <CODE>maskRgn</CODE>     parameter.     For Level 2 printers, the limits are completely memory-based and generally much more     flexible. However, once again, in low-memory conditions, the clip may still fail.     On PostScript Level 3 printers, all clips should always print correctly regardless     of the complexity of the clip since the driver uses the PostScript Level 3 masked     image to support this feature.<BR><BR></li>        <LI>Since the LaserWriter driver implements the transparent mode via clipping,     complex transparent regions may occasionally fail on Level 1 or Level 2 devices     in low-memory conditions as described above. The result is that the output does     not preserve the transparency, and the pixels image with the background color instead.    <BR><BR></li>    <LI>For 2, 4, and 8-bit images with a color look-up table (CLUT), the LaserWriter     8.5.1 driver only supports one index which maps to the background color. Although     the CLUT may contain many index values which have the background color and are     therefore, in principle, transparent when displayed onscreen, the driver searches     the look-up table for the first index which corresponds to the background color.     Index samples  with that index value are printed as transparent. Other index     values which  correspond to the background color are not treated as transparent     but are printed as the background color.<BR><BR></li>    <LI>In order to maintain compatibility with many applications, the     LaserWriter 8.5.1 driver will ignore a <CODE>maskRgn</CODE> which is an empty region     under some circumstances (e.g. some rotated text and graphics). Some     applications have used the fact that previous drivers always ignored the <CODE>maskRgn</CODE>     parameter to clip out certain data when printing to QuickDraw printers.     Relying on this 'feature' is not recommended, and the fact that there are some     edge cases where a zero clip is ignored for compatibility reasons may be a     temporary 'feature' of the driver. To avoid accidentally encountering these     cases, when you really want a zero clip, either do not draw the image (preferred)     or use <CODE>grafPort</CODE> clipping to clip it.</li></UL>             <BR><P><A HREF="#top">Back to top</A></P>          <A NAME="Summary"></A>                  <H2>Summary</H2>                  <P>New imaging code in the LaserWriter has opened up some new          functionality for the QuickDraw <CODE>CopyBits()</CODE> call. We encourage you          to try LaserWriter 8.5.1 with your application and any PostScript device.</p>          <BR><P><A HREF="#top">Back to top</A></P> <A NAME="References"></A><H2>References</H2>            <p><a href="../../documentation/mac/QuickDraw/QuickDraw-2.html">            Inside Macintosh: Imaging With QuickDraw, Chapter 3 and Appendix B.</A></p>            <p><a href="../index.html">Apple's Technote web site</A></p>            <p>PostScript Level 3 documentation from <A HREF = "http://www.adobe.com">Adobe Systems Incorporated.</A><A NAME="Downloads"></A></P> <BR><P><A HREF="#top">Back to top</A></P>        <A NAME="Downloads"></A>         <br><h2>Downloadables</h2>        <center><TABLE BORDER=0 CELLPADDING=3 WIDTH="600">          <TR>             <td width=50 align=left>               <P ALIGN=center><img src="images/acrobatsmall.gif" align=middle alt="Acrobat" width=22 height=23></P>            </TD>            <td align="left">               <p>Acrobat version of this Note (64K).</P>            </TD>            <td width=60 align=left>               <p><A HREF="pdf/tn1114.pdf">Download</A></P>            </TD>          </TR>        </TABLE></center><BR><BR>        </td></tr></table></center><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1114.html%3Fid%3DDTS10002954-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1114.html%3Fid%3DDTS10002954-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1114.html%3Fid%3DDTS10002954-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>