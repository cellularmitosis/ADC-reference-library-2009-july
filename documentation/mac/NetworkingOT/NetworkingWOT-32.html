<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Handling Multiple Simultaneous Connections</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING32></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-31.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-33.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-10.html"><B>Part 1 - Open Transport Essentials</B></A><BR><DD><A HREF="NetworkingWOT-29.html"><B>Chapter 5 - Programming With Open Transport</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING32-0></A>
<H1><A NAME=MARKER-9-47></A>Handling Multiple Simultaneous Connections</H1>
 This section describes the problems of handling multiple simultaneous connections and explains the use of the <CODE>tilisten</CODE> module as a means of handling these problems.<P>
<A NAME=HEADING32-2></A>
<H2><A NAME=MARKER-9-48></A>Problems With Accepting Multiple Simultaneous Connections</H2>
 One of the big challenges of programming Open Transport is accepting multiple simultaneous incoming connections.  The problem is that the obvious code stream can produce unexpected results. Take, for example, the following sequence:<P>
<OL>
<P><LI>You have a listening endpoint (one bound with a qlen greater than 0 )in asynchronous mode. (The problem is independent of the mode of the listening endpoint but, for the sake of this example, we'll assume the listening endpoint is in asynchronous mode.)
<P><LI>An incoming connection arrives, and the listening endpoint calls your notifier with a <CODE>T_LISTEN</CODE> event. 
<P><LI>Your notifier reads the details of the incoming connection using the <CODE>OTListen</CODE> routine.
<P><LI>Your notifier decides to accept the incoming connection by calling the function <CODE>OTAccept</CODE>.
<P><LI>However, the OTAccept call fails with a <CODE>kOTLookErr</CODE> because there is another pending <CODE>T_LISTEN</CODE> event on the listening endpoint. (This behavior is explicitly allowed in the XTI specification.)<P>
</OL>
 There are a number of ways to solve this problem.  The easiest approach is to use a qlen of 1 when you bind the endpoint.  If you do this, the provider will reject connection attempts while you are in the process of accepting a connection attempt.  The drawback to this approach is that the remote peer will receive unnecessary connection rejections.<P>
 A second approach is to program around the problem using the existing Open Transport APIs.  When you call <CODE>OTAccept</CODE> and get a look error, you turn around and call <CODE>OTLook</CODE>.  If the pending event is a <CODE>T_LISTEN</CODE>, put the first connection on hold and deal with this new connection.  Of course, the attempt to accept the new connection can also fail because of a pending <CODE>T_LISTEN</CODE>, which means you have to put this second connection attempt on hold, and so on.  This requires you to have a queue of pending incoming connection attempts.  You must also deal with <CODE>T_DISCONNECT</CODE> events on the listening endpoint, and delete the corresponding connection attempts from the queue.<P>
 This second approach requires a lot of code, and is very hard to get right.<P>
 The third, and recommended, approach is to use the <CODE>tilisten</CODE> module to serialize incoming connection requests.  This approach is described in the next section.<P>
<A NAME=HEADING32-13></A>
<H2>Using &quot;tilisten&quot; to Accept Multiple Simultaneous Connections</H2>
 The <CODE>tilisten</CODE> module is provided to simplify the job of accepting multiple simultaneous incoming connections.  The module sits on top of the provider associated with the listening endpoint and monitors connection requests being sent up to the client.  When a connection request arrives while the client is still in the process of dealing with an earlier connection request, the <CODE>tilisten</CODE> module holds on to the second connection request until the client is accepts or rejects the first one.<P>
 Thus, when the <CODE>tilisten</CODE> module is installed in the stream, the OTAccept function will never fail because of a pending <CODE>T_LISTEN</CODE> event, and only fail with a pending <CODE>T_DISCONNECT</CODE> event if that disconnection event is for the current connection request.<P>
 You can use the <CODE>tilisten</CODE> module in your listening endpoint by specifying it in the configuration you use to build the listening endpoint.  For example, if you want to create an TCP endpoint with the &quot;tilisten&quot; module, you would do so with the following code:<P>
<PRE>
<A NAME=MARKER-0-95></A>ep = OTOpenEndpoint(OTCreateConfiguration(&quot;tilisten,tcp&quot;), 0, nil, &amp;err);
</PRE>
 You should should only include the <CODE>tilisten</CODE> module in connection-oriented, listening endpoints.  The module is not appropriate for use in hand-off endpoints, or endpoints used for outgoing connections.<P>
<DL>
<DT><B>Note</B>
<DD>The <CODE>tilisten</CODE> module is not available in versions of Open Transport prior to version 1.1.1.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DT><A HREF="NetworkingWOT-32.html#HEADING32-2">Problems With Accepting Multiple Simultaneous Connections</A>
<DD>
<DT><A HREF="NetworkingWOT-32.html#HEADING32-13">Using &quot;tilisten&quot; to Accept Multiple Simultaneous Connections</A>
<DD>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-31.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-33.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
