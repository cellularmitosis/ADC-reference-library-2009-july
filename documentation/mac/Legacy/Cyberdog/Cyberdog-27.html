<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Implementing the Cyberdog Preferences Command(Cyberdog)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING27></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Cyberdog-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Cyberdog-2.html"><B>Cyberdog Programmer's Kit</B></A> / <A HREF="Cyberdog-20.html"><B>Part 2 - Programming in Cyberdog</B></A><BR><DD><A HREF="Cyberdog-21.html"><B>Chapter 3 - Adding Cyberdog Features to an OpenDoc Part</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H1><A NAME=MARKER-9-70></A>Implementing the Cyberdog Preferences Command</H1>
 <A NAME=MARKER-2-71></A><A NAME=MARKER-2-72></A>The Cyberdog Preferences command responds to its corresponding menu item to display the Cyberdog Preferences dialog box. When your part is activated, its <CODE>AdjustMenus</CODE> method is called to set up its menus. You can modify this method to enable the Cyberdog Preferences menu item. To enable the Cyberdog preferences menu item, you must take these actions:<P>
<UL>
<LI>Set the menu item string and enable a command for the preferences.
<LI>Call the Cyberdog service menu's <A NAME=MARKER-2-73></A><CODE>Adjust</CODE> method<P>
</UL>
 <A HREF=#MARKER-9-74>Listing 3-15</A> shows the button part's <CODE>AdjustMenus</CODE> method. <P>
<B>Listing 3-15  <A NAME=MARKER-9-74></A>The button part's <CODE>AdjustMenus</CODE> method</B><P>
<PRE>
void CybTxtBtn::AdjustMenus( Environment* ev,
                       ODFrame* frame )
{
   if (frame-&gt;IsRoot(ev))
   {
      // A root part must validate the menu bar before displaying it
      // because a part can swap the base menu bar at any time.
      CheckMenus(ev, kODNULL);
   }     
   // After copying the base menu bar, install your part's menus.
   ...
   TRY
      ...
      ODArbitrator* arbitrator 
                     = ODGetSession(ev,fSelf)-&gt;GetArbitrator(ev);
      TempODFrame menuOwner 
         = arbitrator-&gt;AcquireFocusOwner(ev, gGlobals-&gt;fMenuFocus);
      if ( ODObjectsAreEqual(ev, frame, menuOwner) )
      {
         Str63 text;
         ...
         ODGetIndString(text, kMenuStringResID, kDefaultContent2ID);
         // Create an IText object to pass into the menu bar.
         TempODIText prefItem(CreateIText(gGlobals-&gt;fEditorsScript,
                         gGlobals-&gt;fEditorsLanguage,
                         (StringPtr)&amp;text));
         // Change the text of the &quot;Preferences&quot; menu item.
         fMenuBar-&gt;SetItemString(ev, kODCommandPreferences, prefItem);
         fMenuBar-&gt;EnableCommand(ev, kODCommandPreferences, kODTrue);
      }
      // Allow Cyberdog services to enable or disable their menu items.
      if(fCyberServiceMenu)
         fCyberServiceMenu-&gt;Adjust(ev, frame);
   CATCH_ALL
   ENDTRY
}
</PRE>
<DL>
<DT><B>Note</B>
<DD>In this example, the part's standard Preferences menu item, specified by kODCommandPreferences, is replaced by the Cyberdog Preferences menu item. <EM>u</EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 <A NAME=MARKER-2-75></A>When a menu event occurs, you should call the Cyberdog service menu's <A NAME=MARKER-2-76></A>DoCommand method to allow a Cyberdog service to handle the event. If the Cyberdog Preferences menu item is selected, you must call the Cyberdog session's <A NAME=MARKER-2-77></A>ShowPreferencesDialog method to display the Cyberdog Preferences dialog box. <A HREF=#MARKER-9-78>Listing 3-16</A> shows the button part's HandleMenuEvent method. <P>
<B>Listing 3-16  <A NAME=MARKER-9-78></A>The button part's <CODE>HandleMenuEvent</CODE> method</B><P>
<PRE>
ODBoolean CybTxtBtn::HandleMenuEvent(Environment* ev,
                            ODEventData* event,
                            ODFrame* frame )
{
   ODULong menuResult = event-&gt;message;
   ODUShort menu = HiWord(menuResult);
   ODUShort item = LoWord(menuResult);
   ODBoolean handled = kODTrue;
   ODULong commandID;
   
   commandID = fMenuBar-&gt;GetCommand(ev, menu, item);
   
   // Give Cyberdog the first chance at the command.
   if (fCyberServiceMenu)
      handled = fCyberServiceMenu-&gt;DoCommand(ev, commandID, frame);

   if (handled == kODFalse)
   {
      switch (commandID)
      {
         ...
         // The Cyberdog Preferences command was sent.
         // Show the Cyberdog Preferences dialog box.
         case kODCommandPreferences:
            CyberSession* cyberSession = GetCyberSession(ev);
            cyberSession-&gt;ShowPreferencesDialog(ev);
            handled = kODTrue;
         break;
         ...
         default:
            handled =  kODFalse;
      }
   }
   return handled;
}
</PRE>
 <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Cyberdog-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Cyberdog-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>   
