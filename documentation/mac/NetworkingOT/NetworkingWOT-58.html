<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>About AppleTalk </TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING58></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-57.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-59.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-10.html"><B>Part 1 - Open Transport Essentials</B></A><BR><DD><A HREF="NetworkingWOT-57.html"><B>Chapter 12 - Introduction to AppleTalk</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING58-0></A>
<H1><A NAME=MARKER-9-39></A>About AppleTalk </H1>
 Every Mac OS computer includes AppleTalk hardware and software, so if your application needs to communicate with other Mac OS computers, you may want to use an AppleTalk protocol. AppleTalk includes protocols that handle file sharing, LaserWriter and ImageWriter printing, data exchange through data streams or packets, and AppleTalk name lookups across a network. <P>
 Although AppleTalk includes protocols that provide connection-oriented services, it is considered a connectionless network because all AppleTalk data is ultimately delivered by the Datagram Delivery Protocol (DDP), which implements connectionless packet delivery. Connection-oriented AppleTalk protocols that establish sessions and provide reliable delivery of data, such as the AppleTalk Data Stream Protocol (ADSP), are built on top of the connectionless packet services that DDP provides. In the AppleTalk protocol stack, each protocol in a specific layer provides a set of functions and services to one or more protocols in a higher-level layer. <P>
 The <A NAME=MARKER-13-40></A>AppleTalk architecture is closely aligned with the industry-standard <A NAME=MARKER-13-41></A>Open Systems Interconnection (OSI) networking model. <A HREF=#MARKER-9-42>Figure 12-1</A> shows the AppleTalk protocols supported by Open Transport and shows how they relate to one another in the layers defined by the OSI model.<P>
<B>Figure 12-1  <A NAME=MARKER-9-42></A>AppleTalk protocol stack and the OSI model  </B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/OTA-L-01.gif"><P>
 Here are some points worth noting about how AppleTalk under Open Transport maps to the OSI model: <P>
<UL>
<P><LI>At the session layer, the AppleTalk Data Stream Protocol (ADSP) provides its own stream-based transport layer services that allow for full-duplex dialogs, while the Printer Access Protocol (PAP) uses the transaction-based services of the AppleTalk Transaction Protocol (ATP) to transport workstation commands to servers. The Zone Information Protocol (ZIP) is also at the session layer; a subset of its functions are available through AppleTalk service providers. <B><A NAME=MARKER-13-43></A></B>
<P><LI>At the transport layer, there are the AppleTalk Transaction Protocol (ATP) and Name-Binding Protocol (NBP), but NBP is accessible only through mapper providers. In addition to these two protocols, ADSP includes functions that span both the session and the transport layers. <A NAME=MARKER-13-44></A>
<P><LI>At the network layer, the Datagram Delivery Protocol (DDP) is AppleTalk's network delivery protocol. <A NAME=MARKER-13-45></A>
<P><LI>At the data-link layer, various link-access protocols support the underlying networking hardware. Open Transport provides standard Streams modules for the LocalTalk, Ethernet, token ring, and FDDI drivers. <A NAME=MARKER-13-46></A><P>
</UL>
<A NAME=HEADING58-11></A>
<H2>AppleTalk Networks and Addresses</H2>
 Applications can use AppleTalk protocols across a single AppleTalk network or an <A NAME=MARKER-13-47></A><B>AppleTalk internet,</B> which is a number of interconnected AppleTalk networks. An AppleTalk internet can include a mix of LocalTalk, TokenTalk, EtherTalk, and FDDITalk networks, or it can consist of multiple networks of a single type, such as several LocalTalk networks. An AppleTalk internet can include both nonextended and extended networks. <P>
 An AppleTalk <A NAME=MARKER-13-48></A><B>nonextended network</B> is one in which<P>
<UL>
<P><LI>the network has one network number assigned to it
<P><LI>the network supports only one zone
<P><LI>all nodes on the network share the same network number and zone name
<P><LI>each node on the network has a unique node ID<P>
</UL>
 <A NAME=MARKER-13-49></A>LocalTalk is an example of a nonextended network. Each node on a nonextended network, such as LocalTalk, has a unique 8-bit node ID. Since there are 256 possible combinations of 8 bits, and three IDs are not available (ID 255 is reserved for broadcast messages and ID 0 and 254 are not allowed), a nonextended network can support up to 253 active nodes at a time.<P>
 An AppleTalk <A NAME=MARKER-13-50></A><B>extended network</B> is one in which<P>
<UL>
<P><LI>the network has a range of network numbers assigned to it
<P><LI>the network supports multiple zones 
<P><LI>each node on the network has a unique network number node ID combination to identify it<P>
</UL>
 <A HREF=#MARKER-9-1>Table 12-1</A> summarizes the identifiers that you use for AppleTalk addressing. <A NAME=MARKER-13-51></A><P>
<B>Table 12-1  AppleTalk addressing identifiers</B>
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-1></A></CAPTION>
<TH>Identifier <TH>Description<TR>
<TD>Network number&nbsp;&nbsp;<TD>A 16-bit number that identifies the network to which a node is connected. An extended network is defined by a range of network numbers.<TR>
<TD>Node ID<TD>An 8-bit number that identifies a node. <TR>
<TD>Zone name<TD>A name assigned to a logical grouping of nodes in an AppleTalk network or internet.<TR>
<TD>Socket number<TD>An 8-bit number that identifies a socket. <TR>
<TD>DDP type<TD>An 8-bit number that identifies an endpoint's protocol.</TABLE>
<P>
 Each network is assigned a<B> <A NAME=MARKER-13-52></A>network number</B> so that an AppleTalk router can determine the packet's destination network number and forward the packet through an internet from one router to another until the packet arrives at its correct destination network. An extended network uses a range of network numbers. Nodes on an extended network can have different zone names and different network numbers within the network number range.<P>
 A <A NAME=MARKER-13-53></A><B>node</B> is the data-link addressable entity on an AppleTalk network; all physical devices on an AppleTalk network are nodes. When a node first connects to an AppleTalk network or is rebooted, AppleTalk dynamically assigns it a unique 8-bit <A NAME=MARKER-13-54></A><B>node ID. </B>For a node on an extended network, AppleTalk also assigns it a 16-bit network number within the range of numbers assigned to the extended network that the device is connected to. Once a packet arrives at its destination network, the packet is delivered to its destination node within that network, based on the node ID. <P>
<DL>
<DT><B>Note</B>
<DD>Open Transport allows system administrators to assign static node IDs.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 Because AppleTalk assigns node IDs dynamically whenever a node joins the network or is rebooted, a node's address on an AppleTalk network can change from time to time, although a computer attempts to reuse the node ID it last used. the NBP provides a mapping of logical names (like those in the Chooser) to physical addresses in such a way that if the node ID changes, you can still find the remote service. This mapping is discussed further in <A HREF=NetworkingWOT-61.html#MARKER-9-23>"About AppleTalk Addressing"</A> and <A HREF=NetworkingWOT-64.html#MARKER-9-22>"About AppleTalk Service Providers"</A> in this book.<P>
 A <A NAME=MARKER-13-55></A><B>zone</B> is a logical grouping of nodes within an AppleTalk internet. The use of zones allows a network administrator to set up departmental or other logical sets of nodes in an internet. A single extended network can contain nodes belonging to multiple zones; an individual node on an extended network can belong to only one zone. Each zone is identified by a unique zone name.<P>
 A <A NAME=MARKER-13-56></A><B>socket</B> is an addressable data-link entity on a network. Endpoints exchange data with each other across an internet through sockets. Because each endpoint has its own socket address, a node can have multiple concurrent open connections, for example, one to a file server and one to a printer. A node can have several sockets open at the same time, so each endpoint on an AppleTalk network is associated with a unique 8-bit <A NAME=MARKER-13-57></A><B>socket number.</B> <P>
 AppleTalk sockets are divided into two groups: statically assigned sockets and dynamically assigned sockets.<B> <A NAME=MARKER-13-58></A>Statically assigned sockets</B> are those sockets that are permanently reserved for a designated protocol or process. For example, socket 4 is always reserved as the echo socket, used for echoing packets across a network. <A NAME=MARKER-13-59></A><B>Dynamically assigned sockets</B> are those sockets arbitrarily assigned by DDP if you do not specify a socket number when binding an endpoint; DDP returns the socket number to you in the endpoint's address when the binding has completed. In certain situations, you can bind multiple endpoints to a single socket.<P>
<A NAME=HEADING58-31></A>
<H2><A NAME=MARKER-13-60></A>Multinodes</H2>
 AppleTalk's <A NAME=MARKER-13-61></A><B>multinode architecture</B> allows an application to acquire virtual node IDs, called<B> <A NAME=MARKER-13-62></A>multinode IDs.</B> These multinode IDs allow the computer running your application to appear as multiple nodes on the network even though it is only one physical entity. Each acquired multinode is in addition to the standard node ID already assigned to the computer when it joined the network as a node. The prime example of a multinode application is Apple Remote Access Server (ARA), which uses multinodes to make the connected remote client appear on the local network.<P>
 You can use a multinode to receive broadcast packets and any AppleTalk packets addressed to it through its multinode ID. You must then process the packets in a custom manner. A multinode ID is not connected to the AppleTalk protocol stack above the network (DDP) layer, which means that an application that uses a multinode cannot expect to be supported by the services of higher-level protocols such as NBP, ATP, and ADSP, but instead must implement its own higher-level protocols if it expects packets for such protocols.<P>
<A NAME=HEADING58-34></A>
<H2>Handling Miscellaneous Events</H2>
 In classic AppleTalk, you could use the <B>AppleTalk Transition Queue (ATQ) </B>to inform your application of <B>miscellaneous events </B>that occurred unexpectedly within AppleTalk. In Open Transport AppleTalk, this facility has been modified to allow your endpoint to receive only a few predefined events. An example of such an event is an AppleTalk router coming online or a zone name changing. When one of these events occurs, Open Transport sends a message to the notifier functions of all endpoints that have registered for reception of miscellaneous events. (Any applications that rely on the AppleTalk Transition Queue must use AppleTalk backward compatibility to handle them as described in <I><A HREF="../Networking/Networking-2.html">Inside Macintosh: Networking</A></I>.) <A NAME=MARKER-13-63></A><P>
 In Open Transport AppleTalk, there are five miscellaneous events that you can receive on your AppleTalk endpoint, which does not need to be bound. They are as follows:<P>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Miscellaneous event<TH>Value<TH>Explanation<TR>
<TD><CODE><A NAME=MARKER-13-2></A>T_ATALKROUTERDOWNEVENT</CODE><TD>0x23010051<TD>The router on your application's network is no longer available. <TR>
<TD><CODE><A NAME=MARKER-13-3></A>T_ATALKROUTERUPEVENT</CODE><TD>0x23010052<TD>A router has become available on your application's network.<TR>
<TD><CODE><A NAME=MARKER-13-4></A>T_ATALKZONENAMECHANGEDEVENT</CODE><TD>0x23010053<TD>The router has changed the name for your computer's zone.<TR>
<TD><CODE><A NAME=MARKER-13-5></A>T_ATALKCONNECTIVITYCHANGEDEVENT&nbsp;&nbsp;</CODE><TD>0x23010054&nbsp;&nbsp;<TD>A multinode connection was established or disconnected on your network.<TR>
<TD><CODE><A NAME=MARKER-13-6></A>T_ATALKCABLERANGECHANGEDEVENT</CODE><TD>0x23010055<TD>A router has become available on your network, and your endpoint's address is no longer in the correct local-network number range.</TABLE>
<P>
 To receive these events, your application must use the <CODE>OTIoctl</CODE> function with a provider reference value, the constant <CODE><A NAME=MARKER-13-64></A>kOTGetMiscellaneousEvents</CODE> as its command, and the value of 1 as its data. For more information on the <CODE>OTIoctl</CODE> function, refer to <A HREF=NetworkingWOT-124.html#MARKER-9-135>"OTIoctl"</A> in this book. <A NAME=MARKER-13-65></A><P>
<A NAME=HEADING58-38></A>
<H2>Configuring AppleTalk Protocol Providers</H2>
 When you want to use a particular AppleTalk protocol, you open an endpoint configured for that protocol. To do this, you use specific constants as part of a configuration string that you pass to the Open Transport function for opening endpoints. This string specifies to Open Transport how to create the correct endpoint for you. For more information on the functions that you use to open endpoints, mappers, and AppleTalk service providers, refer to the chapters in this book on the specific type of provider; for more information about configuring providers, see <A HREF=NetworkingWOT-18.html#MARKER-9-29>"Configuring and Opening a Provider"</A> in this book. <A NAME=MARKER-13-66></A><P>
 <A HREF=#MARKER-9-7>Table 12-2</A> lists the constants you use to configure the AppleTalk providers. You can use either the constant or the literal string when creating configurations.<A NAME=MARKER-13-67></A><P>
<B>Table 12-2  Protocol identifiers for use in configuring AppleTalk providers </B>
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-7></A></CAPTION>
<TH>Constant<TH>Configuration <BR>&nbsp;&nbsp;string value&nbsp;&nbsp;<TH>Type of provider configured<TR>
<TD><CODE><A NAME=MARKER-13-8></A>kNBPName&nbsp;&nbsp;</CODE><TD>"nbp"<TD>NBP mapper provider<TR>
<TD><CODE><A NAME=MARKER-13-9></A>kDDPName</CODE><TD>"ddp"<TD>DDP endpoint provider<TR>
<TD><CODE><A NAME=MARKER-13-10></A>kATPName</CODE><TD>"atp"<TD>ATP endpoint provider<TR>
<TD><CODE><A NAME=MARKER-13-11></A>kADSPName</CODE><TD>"adsp"<TD>ADSP endpoint provider<TR>
<TD><CODE><A NAME=MARKER-13-12></A>kPAPName</CODE><TD>"pap"<TD>PAP endpoint provider</TABLE>
<P>
 There is one exception to the typical method of configuring providers. AppleTalk service providers do not have a string equivalent value. You configure an AppleTalk service provider with the constant <CODE>kDefaultAppleTalkServicesPath</CODE>, which has a value of <CODE>((OTConfiguration*)-3)</CODE>. The code for creating an AppleTalk service provider is as follows:<P>
<PRE>
<A NAME=MARKER-2-68></A>OTOpenEndpoint(kDefaultAppleTalkServicesPath, 0, &amp;err)
</PRE>
 If you want to set an option as part of the configuration string, you need to know which protocols use which options and how to translate the option's constant name, given in the header files, into a string that the configuration functions can parse. For the AppleTalk options, <A HREF=#MARKER-9-14>Table 12-3</A> provides the constant name, the value used in the configuration string, and the protocols that use that option.<P>
<B>Table 12-3  AppleTalk options in the configuration string </B> 
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION>Indicating <A NAME=MARKER-13-13></A><A NAME=MARKER-9-14></A></CAPTION>
<TH>Constant name<TH>Configuration <BR>string value<TH>Valid protocols<TR>
<TD><CODE><A NAME=MARKER-13-152></A>OPT_CHECKSUM</CODE><TD>"Checksum"<TD>DDP, ATP, ADSP, PAP<TR>
<TD><CODE><A NAME=MARKER-13-131></A>OPT_SELFSEND</CODE><TD>"SelfSend"<TD>DDP<TR>
<TD><CODE><A NAME=MARKER-13-151></A>OPT_ENABLEEOM</CODE><TD>"EnableEOM"<TD>ADSP, PAP<TR>
<TD><CODE><A NAME=MARKER-13-145></A>OPT_INTERVAL</CODE><TD>"RetryInterval"&nbsp;&nbsp;<TD>ATP<TR>
<TD><CODE><A NAME=MARKER-13-144></A>OPT_RETRYCNT</CODE><TD>"RetryCount"<TD>ATP<TR>
<TD><CODE><A NAME=MARKER-13-2></A>ATP_OPT_RELTIMER</CODE><TD>"ReleaseTimer"<TD>ATP<TR>
<TD><CODE><A NAME=MARKER-13-149></A>PAP_OPT_OPENRETRY&nbsp;&nbsp;</CODE><TD>"OpenRetry"<TD>PAP</TABLE>
<P>
 To configure a provider with an option string, you put the string and its assigned value in parentheses after the protocol that uses it, as in the following lines of code:<P>
<PRE>
<A NAME=MARKER-0-95></A>OTOpenEndpoint(OTCreateConfiguration
                  (&quot;adsp,ddp(Checksum=1),ltlkB&quot;), 0, NULL, &amp;err) 
<A NAME=MARKER-9-106></A>OTOpenEndpoint(OTCreateConfiguration
                  (kADSPName&quot;(EnableEOM=1)&quot;), 0, NULL, &amp;err); 
</PRE>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DT><A HREF="NetworkingWOT-58.html#HEADING58-11">AppleTalk Networks and Addresses</A>
<DD>
<DT><A HREF="NetworkingWOT-58.html#HEADING58-31">Multinodes</A>
<DD>
<DT><A HREF="NetworkingWOT-58.html#HEADING58-34">Handling Miscellaneous Events</A>
<DD>
<DT><A HREF="NetworkingWOT-58.html#HEADING58-38">Configuring AppleTalk Protocol Providers</A>
<DD>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-57.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-59.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
