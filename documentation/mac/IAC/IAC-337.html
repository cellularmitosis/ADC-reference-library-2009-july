<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Modifying and Recompiling a Compiled Script(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING337></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-336.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-338.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-331.html"><B>Chapter 10 - Scripting Components</B></A> / <A HREF="IAC-333.html"><B>Using Scripting Component Routines</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING337-0></A>
<H2><A NAME=MARKER-9-128></A>Modifying and Recompiling a Compiled Script</H2>
 In addition to loading and executing a previously compiled and saved script as described in the previous section, your application can use the scripting component routines described in this section to decompile a compiled script, display the equivalent source data to users for editing, and recompile the source data after editing is completed. For example, if a user wants to change the script shown in <A HREF=IAC-292.html#MARKER-9-35>Figure 7-4 on page 7-10</A> so that it refers to some other database or looks up other information in addition to the customer's address, the forms application can use scripting component routines to display the compiled script to the user and recompile it after the user has modified it.<A NAME=MARKER-2-129></A> <A NAME=MARKER-9-288></A><P>
 You can use the <CODE>OSAGetSource</CODE> function to obtain the source data for a compiled script. The <CODE>OSAGetSource</CODE> function takes a component instance, a script ID for the compiled script, and the desired type of the resulting descriptor record. If you specify a component instance that identifies a connection with the generic scripting component, you can use <CODE>OSAGetSource</CODE> to get the source data for any compiled script created by a scripting component that is registered with the Component Manager on the local computer. If you specify a component instance that identifies an explicit connection with a scripting component, you can use <CODE>OSAGetSource</CODE> only to get the source data for scripts that were compiled by that scripting component.<P>
 The <CODE>MyEditGenericScript</CODE> procedure in <A HREF=#MARKER-9-131>Listing 10-5</A> shows how you can use the <CODE>OSAGetSource</CODE> function with a component instance that identifies a connection to the generic scripting component. The <CODE>MyEditGenericScript</CODE> function gets the source data for a compiled script, allows the user to edit it, and recompiles the script so the original script ID refers to the recompiled script data.<P>
<B>Listing 10-5  <A NAME=MARKER-9-131></A>A routine that displays a compiled script for editing and recompiles it<A NAME=MARKER-2-132></A></B><P>
<PRE>
PROCEDURE MyEditGenericScript (scriptID: OSAID);
VAR
   scriptText:    AEDesc;
   myOSAErr:      OSAError;
   ignoreErr:     OSErr;
BEGIN
   {first get the source data}
   myOSAErr := OSAGetSource(gScriptingComponent, scriptID, 
                              typeChar, scriptText);
   {call the application's primitive text editor}
   MyEditText(scriptText.dataHandle);
   {now compile the edited script data in scriptText using }
   { the scripting component that originally created it; }
   { passing the original script ID to OSACompile causes }
   { OSACompile to replace the original script with the new one} 
   myOSAErr := OSACompile(gScriptingComponent, scriptText, 
                           kOSAModeNull, scriptID);
   ignoreErr := AEDisposeDesc(scriptText);
   IF myOSAErr = errOSAScriptError THEN 
      MyGetScriptErrorInfo;
END; 
</PRE>
 After obtaining the source data for the script, the <CODE>MyEditGenericScript</CODE> procedure calls the <CODE>MyEditText</CODE> function, which displays the application's own primitive text editor and allows the user to edit the source data. After the user has finished editing the script, <CODE>MyEditGenericScript</CODE> passes the edited text and the script ID for the original compiled script to the <CODE>OSACompile</CODE> function, which updates the script ID so that it refers to the modified and recompiled script. The <CODE>kOSAModeNull</CODE> constant passed in the third parameter of <CODE>OSACompile</CODE> indicates that no mode flags are specified for compilation.<A NAME=MARKER-2-276></A><P>
 If the <CODE>OSACompile</CODE> function returns <CODE>errOSAScriptError</CODE>, the <CODE>MyEditGenericScript</CODE> procedure calls the <CODE>MyGetScriptErrorInfo</CODE> procedure shown in <A HREF=IAC-334.html#MARKER-9-96>Listing 10-3 on page 10-11</A> to obtain information about the error. <P>
 After script data has changed as shown in <A HREF=#MARKER-9-131>Listing 10-5</A>, your application should save the modified script data. <A HREF=IAC-413.html#MARKER-9-291>Listing 10-6</A> shows how this could be done from a function that loads script data, calls the <CODE>MyEditGenericScript</CODE> procedure shown in <A HREF=#MARKER-9-131>Listing 10-5</A> to modify and recompile the script, then saves the modified script data.<P>
<B>Listing 10-6  <A NAME=MARKER-9-291></A>A function that loads and modifies script data, then saves it using a generic storage descriptor record</B><P>
<PRE>
FUNCTION MyLoadAndModifyScriptData (resourceID: Integer)
                                    : OSAError;
VAR
   scriptDesc:       AEDesc;
   storageDescRec:   AEDesc;
   scriptID:         OSAID;
   myOSAErr:         OSAError;
   ignoreErr:        OSErr;
   myHndl:           Handle;
BEGIN
   scriptDesc.descriptorType := typeOSAGenericStorage;
   scriptDesc.dataHandle := GetResource(kOSAScriptResourceType, 
                                          resourceID);
   myOSAErr := OSALoad(gGenericScriptingComponent, scriptDesc,
                        kOSAModeNull, scriptID);
   MyEditGenericScript (scriptID);
   myOSAErr := OSAStore(gScriptingComponent, scriptID, 
                        typeOSAGenericStorage, kOSAModeNull,
                        storageDescRec);
   MyWriteResource(storageDescRec.dataHandle, resourceID);
   ignoreErr := AEDisposeDesc(scriptDesc);
   ignoreErr := AEDisposeDesc(storageDescRec); 
END;
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-336.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-338.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
