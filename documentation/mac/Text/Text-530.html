<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>How Calls Are Dispatched(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING530></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-529.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-531.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-514.html"><B>Appendix A - Built-in Script Support</B></A> / <A HREF="Text-527.html"><B>WorldScript II</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING530-0></A>
<H2>How Calls Are Dispatched</H2>
 <A NAME=MARKER-2-262></A>WorldScript II does not implement all of the script utilities because some of them (such as <CODE>GetScriptManagerVariable</CODE>) are handled by the script management system itself. The script utilities that the script management system does not handle are listed in <A HREF=Text-528.html#MARKER-9-43>Table A-11 on page A-26</A>. For those, the script management system passes execution to the WorldScript II <A NAME=MARKER-2-150></A>dispatch routine, which in turn uses the script system's <A NAME=MARKER-2-151></A>dispatch table to call the appropriate utility routine in WorldScript II.<P>
 When the WorldScript II dispatch routine calls a script utility, it replaces the selector of a normal script utility call with the address of the script record of the font script. It then calls the script utility. For instance:<P>
<OL>
<LI>In assembly language, when you call <CODE>CharacterByteType</CODE>, you typically call it through a macro in the following way:<P>
<pre>subq.w   #2, sp        ; room for result.<BR> move.l   textPtr,-(sp)     ; push text pointer.<BR> clr.w   -(sp)     ; push text offset.<BR> <CODE>CharacterByteType</CODE>        ; find out whether it is 1-byte or<BR>          ; 2-byte character.<BR> tst.w   (sp)+     ; is it 1-byte?</pre>
<LI>The <CODE>CharacterByteType</CODE> macro expands into<P>
<pre>move.l   $82060010,-(sp)      ; push the selector.<BR>ScriptUtil         ; call Script Manager trap.</pre>
<LI>For this example, the stack looks like the following when the trap has been called: 
<TABLE BORDER="0" CELLPADDING=3><TD ALIGN=LEFT>&nbsp;<TD><I>return address</I><TD>(long)  &lt;-- top of stack<TR>
<TD>&nbsp;<TD><I>routine selector</I><TD>(long)<TR>
<TD>&nbsp;<TD><I>text offset</I><TD>(word)<TR>
<TD>&nbsp;<TD><I>text pointer</I><TD>(long)<TR>
<TD>&nbsp;<TD><I>result</I><TD>(word)</TABLE>

<LI>If the Script Manager does not handle the call, it passes the call to the current script's dispatch routine. The dispatch routine figures out by the value of the routine selector whether the call is in the range of calls it handles. If it is not, the dispatch routine strips the stack and returns without doing anything.
<LI>If the call is in the valid range, the dispatch routine performs these tasks:<P>
<OL>
<LI>It gets the address of the WorldScript II version of the script utility from the script's dispatch table.
<LI>It gets the address of the script record and replaces the selector on the stack with the address of the script record.
<LI>It jumps into the routine.<P>
</OL>
<LI>So the stack becomes
<TABLE BORDER="0" CELLPADDING=3><TD ALIGN=LEFT>&nbsp;<TD><I>return address</I><TD>(long)  &lt;-- top of stack<TR>
<TD>&nbsp;<TD><I>address of script record</I><TD>(long)<TR>
<TD>&nbsp;<TD><I>text offset</I><TD>(word)<TR>
<TD>&nbsp;<TD><I>text pointer</I><TD>(long)<TR>
<TD>&nbsp;<TD><I>result</I><TD>(word)</TABLE>
<P>
</OL>
 The script's dispatch routine passes the script record to the WorldScript II script utilities so that they can use the script-specific information (such as the byte-type tables) in the script's international resources.<A NAME=MARKER-2-152></A>  <A NAME=MARKER-2-153></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-529.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-531.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
