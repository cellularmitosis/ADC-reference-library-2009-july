<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="_OpenResFile _OpenRFPerm OpenResFile OpenRFPerm"><meta name="Description" content="Technical Note TB38: This Technical Note discusses a bugin _OpenResFile and _OpenRFPerm which can cause system crashesand what you can do to avoid this problem."><title>Technical Note TB38: Strip With _OpenResFile and _OpenRFPerm</title>                                       <meta name="categories" content="Human Interface Toolbox"><meta name="week-posted" content="Mar 27, 1989 - Apr 7, 1989"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002789" title="Strip With _OpenResFile and _OpenRFPerm"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TB38</div>
<div id="pageheadsub">Strip With _OpenResFile and _OpenRFPerm</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note discusses a bug in <code>_OpenResFile</code> and<code>_OpenRFPerm</code> which can cause system crashes and what you can do toavoid this problem.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1989]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><p>The traps <code>_OpenResFile</code> and <code>_OpenRFPerm</code> call some common codein 128K and later ROMs which was affected by some system patches for earlyprint drivers.  The problem is that the common code checks an attribute bit inthe pointer to the string name to see if it is a dereferenced handle.  If thepointer has the resource attribute bit set, the Resource Manager assumes thatit is a dereferenced handle and calls <code>_RecoverHandle</code>.  This usuallyworks, but when the string is embedded in a code resource, the Resource Managercalls <code>_RecoverHandle</code> with an invalid master pointer.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><b>Note:</b><BR>In MPW C, this bug is <b>not</b> a problem, unless you use eitherthe <code>-b</code>, <code>-b2</code>, or <code>-b3</code> options, which embed stringconstants in the code segment.  If you use these options, you must deal withthis bug.</P></TD></TR></TABLE></CENTER><BR> <p>The following code fragments give an example of this bug:</p><h3>MPW Pascal</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    VAR        fileName : Str255;        ref : INTEGER;    BEGIN        fileName := 'This File';        ref := OpenResFile(fileName);</pre>	</TD></TR></TABLE></CENTER><h3>MPW C</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Str255        fileName;    short int    ref;    fileName = 'This File';</pre>	</TD></TR></TABLE></CENTER><p>Calling <code>_StripAddress</code> on the pointer to the filename prior to calling<code>_OpenResFile</code> or <code>_OpenRFPerm</code> solves the problem:</p><h3>MPW Pascal</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    VAR        fileName : Str255;        ref : INTEGER;    BEGIN        fileName := 'This File';        ref := OpenResFile(StringPtr(StripAddress(@fileName))^);</pre>	</TD></TR></TABLE></CENTER><h3>MPW C</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Str255        fileName;    short int    ref;    fileName = 'This File';</pre>	</TD></TR></TABLE></CENTER><p>By always calling <code>_StripAddress</code> before calling <code>_OpenResFile</code>or <code>_OpenRFPerm</code>, you will not have to deal with this problem, life willbe good, and you will be able to rest a bit easier.</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P><A HREF = "../ov/ov_11.html">M.OV.32BitClean</a></p><P><A HREF = "../me/me_06.html">M.ME.StripAddress</a></p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (44K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tb_38.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tb/tb_38.html%3Fid%3DDTS10002789-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tb/tb_38.html%3Fid%3DDTS10002789-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tb/tb_38.html%3Fid%3DDTS10002789-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>