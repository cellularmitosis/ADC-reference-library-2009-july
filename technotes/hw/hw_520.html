<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"    "http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd"><HTML><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note HW520: NuBus Expansion Interface Q&amp;As</title><meta name="categories" content="Hardware"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002507" title="NuBus Expansion Interface Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note HW520</div>
<div id="pageheadsub">NuBus Expansion Interface Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->                     <P id = "menutext">           <A HREF="#Downloads">Downloadables</A></p>     <!-- end_toc -->     </td>    </tr>    <tr> <td width=300 align=left scope="row">   <img src="images/tnmenubottom.gif" alt="" width=300 height=16> </td>    </tr>  </table>    </td>    <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specifictopic--questions sent the Developer Support Center (DSC) along withanswers from the DSC engineers. Current Q&amp;A's can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;A's web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->    </TD>  </TR> </TABLE> <!-- end_table_box --> <BR> <hr width=500 align=center> <BR><!-- begin_content --><h2>NuBus cards with Macintosh IIvx or IIvi back panels</h2><P>Date Written:  1/22/93</p><P>Last reviewed:  4/1/93</p><P>Our customers report that they're having trouble installing our NuBus boardsinto the new Macintosh IIvx or IIvi machine. The connector extender apparentlyinterferes with the computer's back panel. We haven't had problems with otherMacintosh models. Where can I find detailed diagrams of the back panels forthese two machines?</p><P>  The specs for the size of NuBus cards for the Macintosh haven't changed and arepublished in <i>Designing Cards and Drivers for the Macintosh Family,</i> 3rdedition. The V Series Developer Note in the Developer Notes folder on theDeveloper CD also provides Macintosh II case dimensions.</p><P>Previous models allowed more space than called for in the spec. In the V series(and any future machine using this new metal enclosure) the tolerances havebeen tightened up to exactly match the published spec. Unfortunately someboards have been designed in violation of the published spec and now have amuch harder fit.</p><h2>PowerBook 140 ROM writes to $0000</h2><P>Date Written:  11/16/Last reviewed:  3/1/93</p><P>I just put EvenBetterBusError on my PowerBook, and it seems the PowerBook ROMwrites to location $0. Why? This hampers bug testing on the PowerBook.</p><P>  The current version of EvenBetterBusError (creation date April 8, 1991) isn'tcompatible with the PowerBook 140, 145, 160, 170, 180 and Duos because of theway the Power Manager implements "power cycling." When a power cycle ends, thePower Manager uses location 0 to restore the processor state.</p><P>EvenBetterBusError's author said he'll update his program so it doesn't checkfor writes to location 0 on PowerBooks that power cycle. UntilEvenBetterBusError is updated, turn off "Rest Mode" when usingEvenBetterBusError on PowerBooks that have power cycling. When Rest Mode isturned off, the unit will not power cycle the processor.</p><h2>/PFW NuBus line impedance and other specifications</h2><P>What are the voltage tolerances, duration, and input impedance of the NuBus/PFW signal?</p><P>  Designing Cards and Drivers for the Macintosh Family (2nd edition, page 74 and3rd edition page 110), "/PFW interaction with the power supply," has thefollowing /PFW line specifications: "When /PFW is held between 3.0 and 6.8volts for at least 1.5 seconds, the power supply turns on and the computerbegins operating. Once the power supply turns on, its own +5 volt output holds/PFW high so it can continue operating. If /PFW is pulled below .6 volts, thepower supply will turn off; /PFW should be held below .6 volts until thecomputer completely shuts down." All Apple's power supplies are specified todraw no more than .5 ma from this line.</p><h2>Macintosh Quadra 700 &amp; 950 maximum NuBus card size</h2><P>Could you please tell me the maximum size a NuBus expansion card can be withina Quadra 700 and 950?</p><P>  You can find the technical and physical specifications for NuBus cards bywriting to IEEE. You can also find CPU-specific specifications in DesigningCards and Drivers for the Macintosh Family 3rd edition, which you can purchaseeither from APDA (order #M7075/C) or from any good computer bookstore. Keep inmind, however, that those NuBus cards which exceed the IEEE specification mayfit into some CPUs, but certainly not all. For example, there is a larger sizedcard which will fit into the Quarda 950, but it is technically not NuBusbecause these cards will not fit any true NuBus form factor. This form factoris documented in the Developer Notes from APDA on the 900 and 950. Case inpoint, the 700 will only take NuBus cards, not the larger cards.</p><h2>NuBus boot devices and seRefNum</h2><P>This concerns NuBus cards that want to be boot devices. <i>Designing Cards&amp; Drivers for the Macintosh Family</i> states that, given a boot sRsrc andthe startup info set to the slot device (slot #, sRsrc ID, extDev), then theboot sRsrc is called twice. The first time, seBootState is set to 0 and thedevice is to be opened and added to the drive queue; seRefNum is to be set tothe refNum of the desired device. Now comes the bad part: seRefNum is an 8-bitquantity at offset 20 (cf. Slots.h and SlotEqu.a). The next field isseNumDevices, a byte at offset 21, yet the Quadra and Macintosh IIcx ROMs pickup the refNum by doing a "MOVE.W 20(A1),D4" So the refNum used for a slotdevice is really the refNum in the upper 8 bits, followed by seNumDevices,which is typically garbage. Therefore, slot devices that return a refNum shouldactually do:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    *(short *)&amp;se-&gt;seRefNum = refNum</pre>	</TD></TR></TABLE></CENTER><P>Please confirm that this is what should be done.</p><P>  We verified that the various Macintosh ROM sources treat seRefNum as theyshould, as 16 bits. Even though the interfaces declare a seNumDevices bytefield right after seRefNum, the ROM code apparently doesn't use it at all.Therefore, consider seRefNum to be a real INTEGER, 16-bit quantity. Amazing, noone discovered this all these years...</p><h2>Macintosh II NuBus prototyping cards</h2><P>Are there Macintosh II NuBus prototyping cards with a hardware interface thatcan be used for developing declaration ROMs? What hardware/software support isthere for using MPW to assemble and download code into the declaration ROM?Chapter 10 of Designing Cards and Drivers refers to a NuBus Test Card (NTC) anda SCSI-NuBus Test Card. How can I get these?</p><P>  Creative Solutions sells a "Hurdler II" NuBus prototyping card via APDA(T0429LL/A, $199). There are others, but you'd need to take a look at theMacintosh Buyer's Guide to find them.</p><P>Software support for using MPW to assemble and download code into thedeclaration ROM can be found on the latest <i>Developer CD Series</i> disc inthe Tools &amp; Apps (Moof!): Devices &amp; Hardware: NuBus/Slot Managerfolder.</p><P>The NuBus Test Card and SCSI-NuBus Test Card are design examples that don'tactually exist.</p><h2>Using Mac GetPhysical call to translate NuBus address space</h2><P>Is GetPhysical supposed to return an error when a valid NuBus address is usedas an input to the GetPhysical call? If so, is there a foolproof way todetermine (via a system call or by looking at the address) whether an addressis a valid NuBus address? How can I translate a logical Nubus address to aphysical one?</p><P>  It's true that the GetPhysical call currently can only deal with locked RAM itknows about. Your first step is deciding what addresses are actually not inRAM, and thus guaranteed to be physical addresses. Your first stop is theinformation regarding the NuBus address space in Designing Cards &amp; Drivers,2nd edition, pp 88-92. All you'll need to do is leave an address unchanged ifit's greater than or equal to $4000 0000.</p><P>Your only other difficulty is addresses in physical RAM which appear to be inthe NuBus space. Specifically, on the Macintosh IIci and IIsi, the onboardvideo is physically at address 0, but logically sits at a NuBus addressallocated to slot B (or E in the case of the IIsi). This is difficult to dealwith; basically, you've got to special-case the machines with this kind ofonboard video and walk the GDevice list looking for a frame buffer in theappropriate slot, and if you find one, start manually translating addressesdestined for that frame buffer to the correct physical address (which starts ataddress 0).</p><h2>Should similar Macintosh LC and NuBus cards have same ID?</h2><P>We're considering a Macintosh LC card with the same functionality as our NuBuscard. In creating the declaration ROM for this card, should we be requesting anew card ID from you or should we use the same ID as we do in the NuBusversion?</p><P>  Whether you request a new board ID is up to you. We argued about it here in DTSa bit:</p><P>Pro-New-ID: "You may someday need to tell the difference between the twoboards; any design shortcuts that depend on ID equality are probably bad."</p><P>Con-New-ID: "If they're basically the same board, they oughta have the sameID."</p><P>It really came down to: they're not <i>exactly</i> the same board, and sinceboard IDs are plentiful and free, you might as well request a unique ID for thenew board.</p><h2>NuBus 90 documentation</h2><P>Where can we get NuBus 90 information?</p><P>  NuBus 90 is specified in the following two documents published by the Instituteof Electrical and Electronics Engineers (IEEE):</p><P>IEEE Standard for a Simple 32-bit Backplane Bus: NuBus</p><P>IEEE Std. P1196-R1990</p><P>You can obtain these documents by contacting IEEE at the following address:</p><P>    IEEE Service Center<br>    445 Hoes Lane<br>    Piscataway, NJ  08854<br>    908-981-0060</p><h2>How to request advance NuBus product information from Apple</h2><P>We develop NuBus products. How can we get advance information if Apple makesany NuBus changes?</p><P><BR>Pre-release product information is managed by Apple's Evangelism Group. Torequest advance information on future NuBus technology from Apple, pleaseprovide the following information either by AppleLink or letter addressed toDeveloper Support (the Hotline staff will forward your information to theappropriate Evangelist.):</p><ul type="circle">	<li>A detailed description of the product you intend to or are developing.</li>	<li>Key distinguishing features of your product</li>	<li>Resources you have to conduct the development including:</li>	<li>- a description of your company's technical expertise</li>	<li>- development experience and how it relates to the product</li>	<li>- development you propose (include programming experience, products you've</li>	<li>developed, etc.)</li>	<li>How and where you intend to sell and distribute your product.</li>	<li>Why you think this product warrants seeding.</li>	<li>What does your product do uniquely with a new technology.</li></ul><P>Your request for advance information or pre-release product seeding will bereviewed carefully by Evangelism. Because of the limited quantities of seedunits, not all requests can be granted, nor can Apple seed for compatibilityissues alone. Approximately three weeks after Apple receives your information,Evangelism will inform you of the decision regarding your request.</p><h2>Macintosh IIsi MMU table bug fixed for System 7</h2><P>A bug in the Macintosh IIsi MMU tables, which has been fixed for System 7,caused slot 9 to be shadowed in slot B. This shouldn't affect applications ordrivers using the Slot Manager to look for their cards IF they scan startingfrom slot 0 up to E, because a card in 9 will get seen in 9 and all will workOK. But if someone scans from E down to 0, the Slot Manager would think itfound the card in B. That's bad because the driver would install theSIntInstall interrupt routine for slot B, and the card would really interrupton 9, causing a crash. Fortunately every example DTS has seen publishes indexesfrom 0 to E.</p><h2>Macintosh bus or resource locking for NuBus access</h2><P>Is there a way to do Macintosh-to-NuBus access with bus or resource locking butwithout the CAS CPU operation which uses a Read-Modify-Write cycle? Does a CPURead-Modify-Write cycle do resource locking when the CPU accesses NuBus?</p><P>  Macintosh II CPUs perform an Attention-Resource Lock cycle as a prelude toRead-Modify-Write cycles to NuBus addresses. There is no other way to initiatebus or resource locking from the Macintosh CPU. Macintosh CPUs do not supportlocking NuBus for longer tenures.</p><P>The only Read-Modify-Write instructions are TAS, CAS, and CAS2.</p><P>Use of these instructions is problematic, as they may introduce timing problemsfor certain CPUs (see the Macintosh Technical Note "Macintosh IIfx: The InsideStory"), and the operand address must always be previously cached in the MMUaddress translation cache or else a bus error results. They must be used withextreme care.</p><h2>Byte lanes and 8-bit NuBus data transfers</h2><P>Can we use the Macintosh SReadFHeader function and specify the appropriate bytelanes to send 8-bit data over the NuBus(TM) through QuickDraw?</p><P>  I don't think it's a great idea to be 8 bits wide. But I think you areconfusing byte lanes with the Macintosh actually talking to the board.</p><P>Byte lanes values serve _only_ to show where the declaration ROM is, notanything at all about how the rest of the card is laid out or accessed. Readingthe header to figure out the byte lanes values is only used to figure out howto access the declaration ROM. The driver or application that locates the card(via the Slot Manager) is presumed to know how to talk to the card and so willdo so in the most efficient manner.</p><P>Most card developers use a byte-wide declaration ROM and design the rest of thecard for whatever makes the most sense. For example, video cards need someregisters and frame buffering RAM. It makes the most sense to have the framebuffer be 32 bits wide for performance reasons. Because QuickDraw and theoperating system don't need to access the video card's declaration ROM much atall (mostly during startup), it's quite OK and cost efficient to have thedeclaration ROM be byte-wide (you can put it on any lane you like in this case,such as B/L 0). The registers are mapped typically to byte locations as well.</p><P>One thing to note is that QuickDraw (always) talks _directly_ to the framebuffer RAM on the card by doing long word accesses. This is done for speedreasons, because video buffers can get big and if you have a lot of videoactivity, QuickDraw has to push a lot of data around.</p><P>So, if you want to respond with an 8-bit RAM frame buffer port, when QuickDrawis accessing the video buffer on your card, your card is going to see the NuBusTM lines from the Macintosh showing long word accesses, and you will have to(slowly) fetch, and latch and hold each of the 4 bytes of the long word untilyou fill that long access (that is, all 32 bits) before ACKing. For thisreason, no one to my knowledge has ever produced a video board that did nothave a 32-bit wide frame buffer. Also, QuickDraw does Bit Field Extractinstructions to the buffer, so that may slow things down some more.</p><h2>NuBus board sResources needn't start with ID=1</h2><P>Does the first item in the Macintosh NuBus(TM) sResource directory have to be aboard sResource with an ID of 1? Is a declaration ROM in error if this is notthe case?</p><P>  There's no restriction that sResources must begin with a board sResource withan ID of 1. All our examples do start this way, but it's not necessary. ThesResource IDs do need to be organized in ascending order. A special caserestriction is that video board functional sResource IDs must begin at 128 (forthe default mode) and continue sequentially, covering the remaining operatingmodes. Beyond this restriction, the board sResource can have any ID value.</p><h2>Where to find NuBus declaration ROM sample source code</h2><P>Where can I find a source code sample for NuBus declaration ROM creation?</p><P>  You can find sample code for a NuBus declaration ROM in Issue 1 of<i>develop</i> and in the develop folder on the latest <i>Developer CDSeries</i> disc.</p><h2>Where to get Macintosh IIsi NuBus expansion card specs</h2><P>What are the exact physical specifications for NuBus expansion cards for theMacintosh IIsi? I have heard that there were some slight differences from thephysical specs published in Designing Cards and Drivers for the MacintoshFamily.</p><P>  Macintosh IIsi dimension restrictions for NuBus cards are documented in theMacintosh Technical Note "NuBus Physical Designs--Beware." (This was writtenbefore the Macintosh IIsi was released, but with the Macintosh IIsi in mind.)</p><h2>Test and board exchange for early Macintosh II/NuBus problem</h2><P>I seem to remember that the first few months' worth of Macintosh II systemsshipped had some sort of NuBus problems, which Apple acknowledged and even hada free motherboard swap offer. These problems were subsequently fixed on laterrevisions. What was the real problem with those early Macintosh II systems? Isthe free (or any other) board swap still available, and how does an end usertake advantage of it? What were the serial numbers of the affected Macintoshunits? What should we be telling our customers and dealers?</p><P>  The Rev A Macintosh II mother boards had a problem with 32-bit addressing ofNuBus space. If you have a card which has its ROM mapped into the top of the 16MB space, then the card would not be seen. The other problem was with cardswhich had more than 1 MB of RAM.</p><P>The swap is still available as far was we know. The way to get the swap is togo into any dealer and ask for it. It may take a week for the dealer to get theparts, but they should be able to help any user.</p><P>We give out a tool that will determine if the board is an old version or not.The tool, "NuBusTester," is on the developer CD and you can give it to all ofyour users. The tool checks the machine and if the machine is one of theproblem machines, then it will bring up a dialog which tells the user to seetheir dealer. If the machine is fine then the app does nothing. The testerapplication will tell the customer what to do.</p><h2>NuBus RAM can be used as RAM disk driver</h2><P>Can the Macintosh use my NuBus board RAM as additional system memory or as aRAM disk?</p><P>  There is no way that the Macintosh operating system can recognize NuBus RAM anduse it for applications. If you want to use it as a RAM disk, you'll need towrite a RAM disk driver. (Refer to <i>Inside Macintosh</i> for more informationabout this.)</p><h2>Macintosh board IDs and sResource equate info not available</h2><P>Can I get a list of all Macintosh NuBus board IDs?</p><P>  No, that information is confidential. We register board ID and functionalsResource equates so developers don't use equates that are already in use, butwe can't distribute the list because the database contains information onunreleased products.</p><P>However, even if the list could be distributed, any program that depended onthe information in it would be obsolete as soon as a new board came out.</p><P>We recommend that you use the Slot Manager's ability to find certain cards orfunctions. That way, you only need to write your code once, and it will workwith newer boards. That's why QuickDraw can find video cards years after it wasfrozen in ROM. It does so by calling the Slot Manager and looking for boardsthat perform the QuickDraw-compatible video function.</p><h2>How to register a Macintosh NuBus board</h2><P>How do I register a Macintosh NuBus board?</p><P>  You need to have the Developer Support Center assign ID values for thesRsrc_Type fields (Category, cType, DrvrSW, and DrvrSW) for sResources otherthan the board sResource (the sRsrc_Type fields for the board sResource areALWAYS $0001, $0000, $0000, and $0000 for the Category, cType, DrvrSW, andDrvrSW fields respectively), as well as board IDs for the board sResource.AppleLink or mail the following information to MacDTS:</p><ul type="circle">	<li>- Company name</li>	<li>- Company address</li>	<li>- Person to contact (name, mailstop, phone number, and electronic mail address)</li>	<li>- The official product name (or at least a code name for the board)</li>	<li>- What the board will do</li>	<li>- If the board will have a software driver</li>	<li>- If the board will have a software driver, if it will be in ROM</li>	<li>- If the board will have a software driver, if it will be compatible with one that has already been defined (for example, Apple's defined video driver)</li></ul><P>We need this information to maintain our database of NuBus boards. Theinformation you provide is kept confidential, and the database is not availableoutside of DTS.</p><P>X-Refs:</p><ul type="circle">	<li>"Slot Manager," <i>Inside Macintosh</i> Volume V</li>	<li>Designing Cards and Drivers for the Macintosh Family, Addison-Wesley</li></ul><h2>NuBus test for early 1-MB Macintosh systems</h2><P>My NuBus card needs more than 1 MB of memory. How do I determine if my card hasbeen installed in a Macintosh that can see more than 1 MB of memory?</p><P>  Some early Macintosh II systems can't use more than 1 MB of memory. There is anupgrade available for those machines.</p><P>"NuBus Tester," available on AppleLink and on the current developer CD, tellsyou which version of Macintosh you are running on.</p><P>There are object files that you can link with so that you can call CheckNuBusfrom your own application. You can also just send out the application called"NuBus Tester," which checks the Macintosh and alerts you if you need toupgrade.</p><P>Do not try to make your own version of CheckNuBus--the dialog was set up byApple's legal department.</p><h2>How to upgrade earlier EtherTalk cards for Mac IIcx and IIci</h2><P>Why am I having problems with EtherTalk and my Macintosh IIcx/IIci?</p><P>  Revisions J and earlier of the Apple EtherTalk card have a timing problem withMacintosh IIcx and IIci units. Symptoms of the problem are intermittent andinclude system hangs on boot, serious system errors, and exceedingly poornetwork performance. Revisions K and later of the EtherTalk card have beenmodified so that they will not exhibit this problem.</p><P>This problem occurs because the capacitance of a six-slot NuBus was factoredinto the timing mechanism of the EtherTalk card. Consequently, the capacitancelevel in a three-slot NuBus is lower, thereby affecting adversely the EtherTalkcard's timing.</p><P>As additional NuBus cards are installed into a system, the capacitance level israised on the NuBus. As a result, the problem is less likely to present itself.The most likely IIcx and IIci candidates for having the symptoms mentionedabove are units with a single EtherTalk card installed and no other NuBus cardsin the remaining two slots. This is a configuration that would be commonly usedfor routers, file servers, mail servers, and so on.</p><P>If you need to exchange your EtherTalk card for a newer revision, please seeyour local authorized Apple dealer. To find a dealer near you, call toll-free800-538-9696. You will be asked for your zip code, and you'll be given namesand phone numbers of all dealers in your area.</p><h2>Macintosh II NuBus slot numbers and addresses</h2><P>What are the numbers and addresses of the NuBus slots in the Macintosh II classof machines?</p><P>  If viewed from the front of the machines, from left to right:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Macintosh II     1,2,3,4,5,6 ($9, $A, $B, $C, $D, $E)    Macintosh IIx    1,2,3,4,5,6 ($9, $A, $B, $C, $D, $E)    Macintosh IIfx   1,2,3,4,5,6 ($9, $A, $B, $C, $D, $E)    Macintosh IIcx   1,2,3       ($9, $A, $B)    Macintosh IIci   4,5,6       ($C, $D, $E)    Macintosh IIsi   1           ($9)</pre>	</TD></TR></TABLE></CENTER><p>Software should not assume anything about slot numbers. Programs should callthe Slot Manager and index through the slots using the range 0 through E, oruse Gestalt or the pslt resource.</p><h2>NuBus board configuration ROMs and IDs</h2><P>I am making a NuBus board and I don't think that I need a configuration ROM. DoI need to build a configuration ROM? If so, how do I get the sResource boardID? Why should board manufacturers have configuration ROMs?</p><P>  Technically, you don't need one, but if you don't have at least a minimalconfiguration ROM (also known as a declaration ROM), you can't use the libraryof Macintosh Slot Manager calls.</p><P>Developer Technical Support assigns the board IDs (and sRsrc_Type IDs). Theseexist in order for your card to tell the world what functions your board canperform. In order for DTS to assign these values, you need to provide certaininformation about your board and your company. There is a HyperCard stackpublished by DTS that allows you to enter the required information (it also hasa tutorial that explains the Slot Manager and configuration ROM concepts inmore detail).</p><P>A configuration ROM is desirable for flexibility. The combination of the SlotManager and configuration ROM exists to locate and identify your expansion cardand allow the computer and higher-level applications and drivers to communicatewith it.</p><P>To better understand this, let's look at the Slot Manager in more detail, andsee why it is desirable for you, the developer, to take advantage of it.</p><P>The Slot Manager/configuration ROM architecture has two main functions. Thefirst is to provide a mechanism to allow the user to insert a card in a slotand have the card be operational without having to set any switches, worryabout which slot to put the card in, or install any special software.</p><P>The second is to free an application from being dependent on a particular typeof hardware. That is, the goal is to allow an application to be insulated fromthe hardware by being able to locate underlying, intermediate driver softwarethat will "know" about and talk to the specific hardware. This frees theapplication to be able to deal with higher-level functions without being tiedto a given set of hardware. It allows for different revisions of a given card,or even cards made by different vendors to work with applications, withoutrequiring a revision of the application each time a card changes (or a new oneis introduced).</p><P>Both these goals are accomplished via the Slot Manager software and thefirmware data structures contained in the configuration ROMs of each card. If avalid configuration ROM is present, system software as well as applications anddrivers can take advantage of the Slot Manager library of routines to performthe two functions stated above.</p><P>Let's examine the architecture and concepts further.</p><P>The specific functions of the Slot Manager are as follows:</p><ul type="circle">	<li>Locate and list the cards with configuration ROMs (also known as declaration</li>	<li>ROMs);</li>	<li>Impose a uniform structure on the information in the declaration ROM and  provide a set of library routines to access the information. One major  advantage of this is that once certain sets of data structures are defined and  made public,  host applications may use information contained in the structures  on any card regardless of vendor;  Provide routines to allow host applications to transparently access information  in the ROMs without regard to NuBus or byte lanes;</li>	<li>Provide a mechanism for cards to have initialization code run on the host CPU  during the host's startup sequence;</li>	<li>Allow cards to have drivers in their declaration ROMs loaded into the host  CPU; Initialize and manipulate the parameter RAM on the host CPU for the card  in the slot during startup.</li></ul><P>Without a configuration ROM, most of this will be impossible. Locating the cardwill be difficult. You can't ask the customer where it is, without violatingthe user-friendly interface of the Macintosh, and you can't find it withsoftware without the possibility of stepping on other cards' registers, memory,and so on, not to mention having to deal with bus errors for empty slots.Configuration ROMs are well defined in terms of location in the slot addressspace and structure. Getting at stored nonvolatile data on the board willprobably be different for each card. Having code and or drivers loaded andexecuted at startup time will not be possible.</p><P>In summary, you should make a configuration ROM, and use the Slot Manager. Itwill provide services to applications (and drivers) accessing the card, andwill mean less maintenance for applications and drivers.</p><P>X-Refs:</p><P>"Device Manager," <i>Inside Macintosh</i> Volumes II and IV</p><P>"Slot Manager," <i>Inside Macintosh</i> Volume V  </p><P><A HREF="#top">Back to top</A></p><P><A NAME=Downloads></A></p>          <H2>Downloadables</H2>          <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">  <TR>   <td width=50 align=left>     <P align=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></p>   </TD>   <td align="left">     <P>Acrobat version of this Note (68K)</p>   </TD>   <td width=60 align=left>     <P><A HREF="pdf/hw_520.pdf">Download</A></p>   </TD>  </TR></table><BR><P><A HREF="#top">Back to top</A></p></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/hw/hw_520.html%3Fid%3DDTS10002507-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/hw/hw_520.html%3Fid%3DDTS10002507-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/hw/hw_520.html%3Fid%3DDTS10002507-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>