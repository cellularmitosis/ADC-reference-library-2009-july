<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Register Settings</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.56.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.57.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.59.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3689"> </A>Register Settings</H1><P CLASS="T1.Text1"><A NAME="pgfId=3690"> </A>PCI-to-PCI bridges have specific configuration needs that are different from those of standard PCI devices. The system Open Firmware code is responsible for configuring the PCI-to-PCI bridge components. The following field descriptions list the standard settings for the registers shown in <A HREF="PCI_BOOK.57.html#24385" CLASS="XRef">Figure&nbsp;4-2</A>.</P><p><b>Field descriptions</b><p><DL COMPACT><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14557"> </A><A NAME="marker=14561"> </A>Vendor ID</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3695"> </A>Read by Open Firmware and stored in the property <TT CLASS="cv">vendor-id</TT>. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14567"> </A><A NAME="marker=14571"> </A>Device ID</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3700"> </A>Read by system Open Firmware and stored in property <TT CLASS="cv">device-id</TT>.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14577"> </A><A NAME="marker=14581"> </A>Command</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3702"> </A>Written by system Open Firmware. Bit specifics:</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3703"> </A>Bit 9, Fast Back to Back Enable, is written 1 if all PCI devices are Fast Back to Back capable (if all devices have a <TT CLASS="cv">fast-back-to-back</TT> property stored in their device nodes); otherwise written 0.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3704"> </A>Bit 8, SERR Enable, is written 0 for all devices; the Power Macintosh system doesn't respond to SERRs.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3705"> </A>Bit 7, Wait Cycle Control, is written 0 for all devices.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3706"> </A>Bit 6, Parity Error Response, is written 0 for all devices.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3707"> </A>Bit 5, VGA Palette Snoop, is written 0 for all devices.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3708"> </A>Bit 4, Memory Write and Invalidate Enable. PCI-to-PCI Bridges consider this a read-only bit and will always return 0 when read. They act only as agents for masters behind them and will propagate Memory Write and Invalidate commands if a PCI Master on either side generates such a cycle.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3709"> </A>Bit 3, Special Cycle Enable. PCI-to-PCI Bridges consider this a read-only bit and will always return 0 when read, because they cannot respond to Special Cycles.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3710"> </A>Bit 2, Bus Master Enable, is written 1 for all devices; the Power Macintosh system supports masters in all PCI locations.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3711"> </A>Bit 1, Memory Space Enable, is written 1 for PCI-to-PCI bridges to enable memory cycles to pass through the bridge transparently, based on the programming of the Memory Base and Limit registers.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3712"> </A>Bit 0, I/O Space Enable, is written 1 for PCI-to-PCI bridges to enable I/O cycles to pass through the bridge transparently based on the programming of the I/O Base and Limit registers.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14607"> </A><A NAME="marker=14611"> </A>Status</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3715"> </A>The following bits are read in the <A NAME="marker=3714"> </A>Status register:</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3716"> </A>Bits 10-9, DEVSEL speed, value stored in the node's <TT CLASS="cv">devsel-speed</TT> property.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3717"> </A>Bit 7, Fast Back to Back Capable, value noted for each PCI device. If the value is nonzero, the property <TT CLASS="cv">fast-back-to-back</TT> is created for the node (see Command register explanation of Fast Back to Back Enable bit).</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3718"> </A>No specific action taken based on values of the remaining bits in the Status Register.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14623"> </A><A NAME="marker=14627"> </A>Revision ID</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3720"> </A>Read by system Open Firmware and stored in property <TT CLASS="cv">revision-id</TT>.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14633"> </A><A NAME="marker=14637"> </A>Class Code</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3722"> </A>Read by system Open Firmware and stored in property <TT CLASS="cv">class-code</TT>. The <TT CLASS="cv">name</TT> property for PCI-to-PCI bridges defaults to <TT CLASS="cv">pci-bridg</TT>e, based on the class code matching PCI-to-PCI bridge encoding (0x060400).</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14643"> </A><A NAME="marker=14647"> </A>Cache Line Size</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3724"> </A>Written by system Open Firmware. Set to 0x08 for all devices, which corresponds to the PowerPC family cache line size of 32 bytes.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14653"> </A><A NAME="marker=14657"> </A>Latency Timer</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3726"> </A>Written by system Open Firmware. Set to 0x20 for all devices, which corresponds to 32 PCI clock intervals.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14663"> </A><A NAME="marker=14667"> </A>Header Type</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3728"> </A>Read by system Open Firmware. First, bits 6 through 0 are examined. If the value is 0x00, the configuration space has a standard header layout for configuration addresses 0x10-0x3F; if the value is 0x01, it has a PCI-to-PCI bridge header layout for that section. Described in this section is the behavior taken for a PCI-to-PCI header.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14673"> </A><A NAME="marker=14677"> </A>BIST</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3730"> </A>No action is taken by the system Open Firmware on this register.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14683"> </A>base registers 0-1</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3731"> </A>Open Firmware does not set the Base Registers for PCI-to-PCI bridges. It is assumed that they are programmed only through PCI configuration space.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14692"> </A><A NAME="marker=14696"> </A>Primary Bus Number</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3733"> </A> Written by system Open Firmware with the appropriate PCI Bus number corresponding to this bridge's primary bus location (closer to main memory side) in the system topology.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14703"> </A><A NAME="marker=14707"> </A>Secondary Bus Number</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3735"> </A> Written by system Open Firmware with the appropriate PCI Bus number corresponding to this bridge's secondary bus location (farther from main memory side) in the system topology. This value is stored in the device tree as the first datum in the PCI-to-PCI Bridge's bus-range property. </DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14714"> </A><A NAME="marker=14718"> </A>Subordinate Bus Number</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3737"> </A> Written by system Open Firmware with the appropriate PCI Bus number corresponding to the highest numbered PCI bus that is located behind (subordinate to, or farthest from main memory) this PCI-to-PCI bridge. This value is stored in the device tree as the second datum in the PCI-to-PCI Bridge's bus-range property.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14725"> </A><A NAME="marker=14729"> </A>Secondary Latency Timer</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3739"> </A> Written by system Open Firmware. Set to 0x20 for all devices, which corresponds to 32 PCI clock intervals.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14736"> </A><A NAME="marker=14740"> </A>I/O Base</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3741"> </A>Written by system Open Firmware. If devices found behind the PCI-to-PCI bridge require I/O space address allocation, this byte-wide register is written with the appropriate values corresponding to the base of I/O space located behind the PCI-to-PCI bridge. See the PCI-to-PCI bridge architecture specification (described in <A HREF="PCI_BOOK.25e.html#41621" CLASS="XRef">PCI Special Interest Group</A>) for details on this register. If no I/O space is requested behind the PCI-to-PCI Bridge, the I/O Base Register is written with a value greater than the I/O Limit value, thereby disabling any decoding of I/O space behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14746"> </A><A NAME="marker=14750"> </A>I/O Limit</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3746"> </A>Written by system Open Firmware. If devices found behind the PCI-to-PCI bridge require I/O space address allocation, this byte-wide register is written with the appropriate values corresponding to the base of I/O space plus the amount of space required located behind the PCI-to-PCI bridge. See the PCI-to-PCI bridge architecture specification for details on this register. If no I/O space is requested behind the PCI-to-PCI Bridge, the I/O Base Register is written with a value greater than the I/O Limit value, thereby disabling any decoding of I/O space behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14756"> </A><A NAME="marker=14760"> </A>Secondary Status</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3748"> </A>Read by Open Firmware. Bit specifics:</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3749"> </A>Bits 10-9, DEVSEL speed, the value stored in the node's <TT CLASS="cv">devsel-speed</TT> property.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3750"> </A>Bit 7, Fast Back to Back capable, a value set for each PCI device. If the value is non-zero, the property <TT CLASS="cv">fast-back-to-back</TT> is created for the node (see Command register explanation of Fast Back to Back Enable bit).</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3751"> </A>No specific action is taken based on values of the remaining bits in the Secondary Status Register.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14772"> </A><A NAME="marker=14776"> </A>Memory Base</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3753"> </A>Written by system Open Firmware. If devices found behind the PCI-to-PCI bridge require memory space address allocation, this byte-wide register is written with the values corresponding to the base of memory space located behind the PCI-to-PCI bridge. See the PCI-to-PCI bridge architecture specification for details on this register. If no memory space is requested behind the PCI-to-PCI bridge, the Memory Base Register is written with a value greater than the Memory Limit value, thereby disabling any decoding of memory space behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14782"> </A><A NAME="marker=14786"> </A>Memory Limit</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3755"> </A>Written by system Open Firmware. If devices found behind the PCI-to-PCI bridge require memory space address allocation, this byte-wide register is written with values corresponding to the base of memory space plus the amount of space required behind the PCI-to-PCI bridge. See the PCI-to-PCI bridge architecture specification for details on this register. If no memory space is requested behind the PCI-to-PCI bridge, the Memory Base Register is written with a value greater than the Memory Limit value, thereby disabling any decoding of memory space behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14792"> </A><A NAME="marker=14796"> </A>Prefetchable Memory Base</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3757"> </A> Written by system Open Firmware. All memory space allocated behind a PCI-to-PCI bridge in PCI Power Macintosh systems is defined as non-prefetchable. Therefore, the Prefetchable Memory Base register is always written with a value that is greater than the Prefetchable Memory Limit value. This disables any decoding of Prefetchable Memory behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14803"> </A><A NAME="marker=14807"> </A>Prefetchable Memory Limit</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3759"> </A> Written by system Open Firmware. All memory space allocated behind a PCI-to-PCI bridge is defined as non-prefetchable. Therefore, the Prefetchable Memory Base register is always written with a value that is greater than the Prefetchable Memory Limit value. This disables any decoding of Prefetchable Memory behind a PCI-to-PCI bridge.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14814"> </A>Prefetchable Base Upper 32 bits</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3760"> </A> Written by system Open Firmware with all 0s, because the PCI Power Macintosh computers have a 32-bit address space.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14824"> </A>Prefetchable Limit Upper 32 bits</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3761"> </A> Written by system Open Firmware with all 0s, because the PCI Power Macintosh computers have a 32-bit address space.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14834"> </A>I/O Base Upper 16 bits</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3762"> </A> Written by system Open Firmware with all 0s, because the PCI Power Macintosh computers utilize a 16-bit I/O address space behind PCI-to-PCI bridges.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14844"> </A>I/O Limit Upper 16 bits</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3763"> </A> Written by system Open Firmware with all 0s, because the PCI Power Macintosh computers utilize a 16-bit I/O address space behind PCI-to-PCI bridges.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14854"> </A><A NAME="marker=14858"> </A>Expansion ROM Base Register</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3765"> </A> Open Firmware takes no action with this register. It is assumed that PCI-to-PCI bridges have no FCode in their ROMs.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14865"> </A><A NAME="marker=14869"> </A>Interrupt Line</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3767"> </A>No action taken on this register. The value in this register has no meaning for the Power Macintosh computers, because interrupts are OR-combined per slot in hardware, creating a unique interrupt for each PCI card accessible to the system interrupt controller. No useful information for Power Macintosh driver writers exists in this register.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14875"> </A><A NAME="marker=14879"> </A>Interrupt Pin</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3769"> </A>Read by system Open Firmware. If the value is nonzero, it appears in the property <TT CLASS="cv">interrupts</TT>. It has no meaning for Power Macintosh, for the reasons given in the preceding paragraph.</DD><DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14885"> </A><A NAME="marker=14889"> </A>Bridge Control</DT><DD CLASS="DD.DefinitionDef"><A NAME="pgfId=3771"> </A>Written by system Open Firmware. Bit specifics:</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3772"> </A>Bit 7, Fast Back to Back Enable, is written 1 if all PCI devices on the secondary side of the PCI-to-PCI bridge are Fast Back to Back capable (if all devices have a fast-back-to-back property stored in their device node); otherwise, it is written 0.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3773"> </A>Bit 6, Secondary Bus Reset, is written 0 so as not to cause a separate reset on the secondary bus from the regular PCI hardware reset, which is passed automatically by the PCI-to-PCI bridge hardware.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3774"> </A>Bit 5, Master Abort Mode, is written 0 so that all Master Aborts on the Secondary bus return all Fs on read actions.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3775"> </A>Bit 4, Reserved.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3776"> </A>Bit 3, VGA Enable, is written 0, which disallows the forwarding of VGA hard decoding addresses to the secondary bus.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3777"> </A>Bit 2, ISA Enable, is written 1, which blocks forwarding of traditional hard-decoded addresses (top 768 bytes for each 1K block of I/O space) from the primary to the secondary PCI bus.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3778"> </A>Bit 1, SERR# Enable, is written 0, because the Power Macintosh system doesn't respond to SERR signals.</DD><DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=3779"> </A>Bit 0, Parity Error Response, is written 0.</DD></DL COMPACT><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.56.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.57.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.59.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>