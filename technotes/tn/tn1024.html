<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1024: Palette Manager Tidbits</title>    <meta name="keywords" content="Mac OS 8 Palette Manager enhancements default CopyPalette">    <meta name="Description" content="Technical Note TN1024: This Technical Note describes thechanges and enhancements, over time, to the Palette Manager.The biggest problem facing developers who work with the PaletteManager is making sure that they set the palette to a colorwindow. Enhancements include: Application Default Palettes;Multiple Ports; Color Updates; and CopyPalette."><meta name="categories" content="Inside Macintosh Addenda, QuickDraw and Color"><meta name="week-posted" content="Jan 29, 1996 - Feb 2, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002866" title="Palette Manager Tidbits"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1024</div>
<div id="pageheadsub">Palette Manager Tidbits</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><P id = "menutext"><A HREF = "#Section1">Enhancements to the Palette Manager</a><br><br><A HREF = "#Summary">Summary</a><br><br><A HREF = "#Changes">Change History</a><br><br><A HREF = "#References">References</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr><tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->  <P id = "introtext">This Technote describes the changes and enhancements, over time, to the Palette Manager. The biggest problem facing developers who work with the Palette Manager is making sure that they set the palette to a color window.</p><P id = "introtext">This Technote is of interest to developers designing general-purpose applications who want to use palettes for their windows but who don't want to deal with the hassles of setting up a new palette for each and every window.</p><P id = "introtext">Although the Palette Manager is documented in the Palette Manager chapter of <a href="http://developer.apple.com/documentation/mac/ACI/ACI-14.html#HEADING14-0"><CITE>Inside Macintosh: Advanced Color Imaging</CITE></A>, this Technote sheds light on issues that may remain unclear after reading that chapter.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>&nbsp;[Feb 1 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name="Section1"></a><h2>Enhancements to the Palette Manager</h2><P>Several enhancements to the Palette Manager provide you with additional manageability for applications using the Palette Manager.</p><h3>Application Default Palettes</h3><P>Your application can define a default palette for the system to use when you need to define the color environment, that is, when your application creates a color window without an associated palette or display a dialog box.</p><P>The application palette feature is especially handy in cases where a color application uses old-style dialogs and alerts because without an application palette, the system will use its own default palette, which may not be the appropriate colors, to define the color environment. Since the system uses the default palette, the color environment may change (<b>will</b> change in 16-color mode) and cause some "cosmic" colors to appear in the active window. Defining a default application palette with two colors, black and white, solves this problem.</p><P>If the system needs a palette to define a color environment, it looks in the resource fork of the application for the <code>'pltt'</code> ID = 0 resource and uses the palette contained therein. If the system cannot find this resource in the application's resource fork, it will use its own default palette (resource <code>'pltt'</code> ID = 0 in the System file) if present, or, if necessary, it will use the Palette Manager's built-in palette.</p><P>Once an application has set its color environment (by calling <code>InitMenus</code>, or <code>InitPalettes</code>) it can find the default palette by calling </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>GetPalette (WindowRef) -1);</pre>	</TD></TR></TABLE></CENTER><P>or change the default palette by calling </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>SetPalette ((WindowRef) -1, srcPalette, true);</pre>	</TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note: </B><BR>The initialization of the Palette Manager with a call to <code>InitMenus</code> is contrary to the way <CITE>Inside Macintosh: Advanced Color Imaging,</CITE> "The Palette Manager" documents it.</P></TD></TR></TABLE></CENTER><BR> <h3>One Palette, Many Ports</h3><P>You can associate one palette with many <code>CGrafPort</code> and <code>CWindow</code> records, thus simplifying the use of a single palette with multiple ports and windows.</p><P>Although this ability to associate one palette with multiple ports and windows will allow the use of calls like <code>PmForeColor</code> and <code>PmBackColor</code>, calling ActivatePalette with an off-screen port will associate the palette with the port but will not cause any change in the color environment.</p><P>An important implication of this feature is that <code>DisposeWindow (DisposWindow) </code>will no longer dispose of the associated palette automatically, since it may be allocated to other ports or windows. The only exception to this behavior is when an application has used <code>GetNewCWindow</code> to create the window, there is a <code>'pltt'</code> resource with the same ID as the window, and the application has not called <code>GetPalette</code> for the window.</p><h3>Color Updates</h3><P><code>NSetPalette</code> has the same functionality as <code>SetPalette</code>, but the <code>CUpdates</code> parameter has been modified from a Boolean to an Integer as follows: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void NSetPalette (WindowPtr dstWindow, PaletteHandle srcPalette,                    short nCUpdates)</pre>	</TD></TR></TABLE></CENTER><P><code>NSetPalette</code> changes the palette associated with <code>dstWindow</code> to <code>srcPalette</code>. It also records whether the window will receive updates as a result of a change to its color environment.</p><P>You have more flexibility in setting window updates for your application: </P><UL><LI> If you want <code>dstWindow</code> to be updated whenever its color environment changes, set <code>nCUpdates</code> to <code>pmAllUpdates</code>.</li><LI> If you are only interested in updates when dstWindow is the active window, set <code>nCUpdates</code> to <code>pmFgUpdates</code>.</li><LI> If you are only interested in updates when dstWindow is not the active window, set <code>nCUpdates</code> to <code>pmBkUpdates</code>.</li></ul><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>{NSetPalette Update Constants }pmNoUpdates = 0x8000 {no updates}pmBkUpdates = 0xA000 {background updates only}pmFgUpdates = 0xC000 {foreground updates only}pmAllUpdates = 0xE000 {all updates}</pre>	</TD></TR></TABLE></CENTER><P><code>SetPalette</code> retains its syntax and function: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void SetPalette (WindowPtr dstWindow, PaletteHandle srcPalette,                Boolean CUpdates)</pre>	</TD></TR></TABLE></CENTER><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>IMPORTANT: </B><BR>The trap words for <code>NSetPalette</code> and <code>SetPalette</code> <b>are</b> identical. </P></TD></TR></TABLE></CENTER><BR><h3>CopyPalette</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>void CopyPalette (PaletteHandle srcPalette, PaletteHandle dstPalette,            short srcEntry, short dstEntry, short dstLength);</pre>	</TD></TR></TABLE></CENTER><P><code>CopyPalette</code> is a utility procedure that copies <code>dstLength</code> entries from the source palette into the destination palette; the copy begins at <code>srcEntry</code> and <code>dstEntry</code>, respectively. <code>CopyPalette</code> will resize the destination palette when the number of entries after the copy is greater than the original.</p><P><code>CopyPalette</code> does not call <code>ActivatePalette</code>, so the application is free to do a number of palette changes without causing a series of intermediate changes to the color environment; the application should call <code>ActivatePalette</code> after completing all palette changes.If either of the palette handles are NIL, <code>CopyPalette</code> does nothing.</p><P><A HREF="#top">Back to top</A></P><a name = "Summary"></a><h2>Summary</h2><P>The Palette Manager will accomplish a lot for you with a few simple techniques, such as attaching palettes automatically to your windows. Most developers aren't aware of this. The Palette Manager will also perform automatic updates when your application switches to the foreground.</p><P><A HREF="#top">Back to top</A></P><A NAME="References"></a><H2>References</h2><P><a href="http://developer.apple.com/documentation/mac/ACI/ACI-14.html#HEADING14-0"><CITE>Inside Macintosh: Advanced Color Imaging</CITE></A>, Palette Manager chapter.</p><P><A HREF="#top">Back to top</A></P><a name="Changes"></a><H2>Change History</h2> <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-October-1988</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1996</P>               </TD>               <td align="left">                  <P>Revised.</P>               </TD></tr></table><P><A HREF="#top">Back to top</A></P>          <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1024.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1024.html%3Fid%3DDTS10002866-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1024.html%3Fid%3DDTS10002866-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1024.html%3Fid%3DDTS10002866-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>