<!-- legacy work start -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<!-- legacy work end -->


<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)

LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MyTextDoneCallback (IM: S)  (deprecated)</Title>

<!-- legacy work start -->
        <META NAME="Generator" CONTENT="manual">
        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">
        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">
        <META NAME="IndexTitle" CONTENT="Inside Macintosh: Sound (Not Recommended)">
        <meta name="xcode-display" content="render">

        <LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->
        <script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
<!-- legacy work end -->

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<A NAME=HEADING252></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Sound-251.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-253.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Sound-2.html"><B>Sound</B></A> / <BR><DD><A HREF="Sound-187.html"><B>Chapter 4 - Speech Manager</B></A> / <A HREF="Sound-203.html"><B>Speech Manager Reference</B></A><BR><DL><DD><A HREF="Sound-250.html"><B>Application-Defined Routines</B></A> / <A HREF="Sound-251.html"><B>Text-Done Callback Procedure</B></A></DL></DL></FONT><P>
<HR>

<!-- legacy work start -->
<script type="text/javascript"> placeWatermark()</script>
<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
<i>Inside Macintosh: Sound</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="../../../referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div>
<!-- legacy work end -->


<BLOCKQUOTE>
<A NAME=HEADING252-0></A>
<H3>MyTextDoneCallback</H3>
 A text-done callback procedure has the following syntax:<P>
<PRE>
PROCEDURE MyTextDoneCallback 
                           (chan: SpeechChannel; refCon: LongInt; 
                           VAR nextBuf: Ptr; VAR byteLen: LongInt; 
                           VAR controlFlags: LongInt);
</PRE>
<DL>
<DT><CODE>chan</CODE>
<DD> The speech channel that has finished processing input text.
<DT><CODE>refCon</CODE>
<DD> The reference constant associated with the speech channel.
<DT><CODE>nextBuf</CODE>
<DD> On exit, a pointer to the next buffer of text to process or <CODE>NIL</CODE> if your application has no additional text to be spoken. This parameter is mostly for internal use by the Speech Manager.
<DT><CODE>byteLen</CODE>
<DD> On exit, the number of bytes of the text buffer pointed to by the <CODE>nextBuf</CODE> parameter.
<DT><CODE>controlFlags</CODE>
<DD> On exit, the control flags to be used in generating the next buffer of text.<A NAME=MARKER-2-539></A>
</DL>
<A NAME=HEADING252-8></A>
<H5> DESCRIPTION</H5>
 If a text-done callback procedure is installed in a speech channel, then the Speech Manager calls this procedure when it finishes processing a buffer of text. The Speech Manager might not yet have completed finishing speaking the text and indeed might not have started speaking it.<P>
 A common use of a text-done callback procedure is to alert your application once the text passed to the <CODE>SpeakText</CODE> or <CODE>SpeakBuffer</CODE> function can be disposed of (or, when the text is contained within a locked relocatable block, when the relocatable block can be unlocked). The Speech Manager copies the text you pass to the <CODE>SpeakText</CODE> or <CODE>SpeakBuffer</CODE> function into an internal buffer. Once it has finished processing the text, you may dispose of the original text buffer, even if speech is not yet complete. However, if you wish to write a callback procedure that executes when speech is completed, see the definition of a speech-done callback procedure below.<P>
 Although most applications won't need to, your callback procedure can indicate to the Speech Manager whether there is another buffer of text to speak. If there is another buffer, your callback procedure should reference it by setting the <CODE>nextBuf</CODE> and <CODE>byteLen</CODE> parameters to appropriate values. (Your callback procedure might also change the control flags to be used to process the speech by altering the value in the <CODE>controlFlags</CODE> parameter.) Setting these parameters allows the Speech Manager to generate uninterrupted speech. If there is no more text to speak, your callback procedure should set <CODE>nextBuf</CODE> to <CODE>NIL</CODE>. In this case, the Speech Manager ignores the <CODE>byteLen</CODE> and <CODE>controlFlags</CODE> parameters.<P>
 If your text-done callback procedure does not change the values of the <CODE>nextBuf</CODE> and <CODE>byteLen</CODE> parameters, the text buffer just spoken will be spoken again.<P>
<A NAME=HEADING252-13></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Because your callback procedure executes at interrupt time, you must not call any routines that might move or purge memory. If you are writing a callback procedure so that your application will know when it can dispose of a text buffer, then use the callback procedure to set a global flag variable. Your application's main event loop can check this flag and dispose of the text buffer if it is set.<P>
 Your callback procedure is able to access application global variables only if the A5 register is properly set. The Speech Manager sets A5 to the proper value if you provide your application's A5 value by calling the <CODE>SetSpeechInfo</CODE> function with the <CODE>soCurrentA5</CODE> selector.<P>
<A NAME=HEADING252-16></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 Because a callback procedure is called at interrupt time, it must preserve all registers other than A0-A2 and D0-D2.<A NAME=MARKER-2-292></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Sound-251.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Sound-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Sound-336.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Sound-253.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Sound-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
