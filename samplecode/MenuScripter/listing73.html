<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>MenuScripter - /Sources/MSUtils.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">MenuScripter</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxInterapplicationCommunication-date.html" target="_blank">Carbon > Interapplication Communication</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">MenuScripter</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Sources/MSUtils.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Resources/MenuScripterAETE.r</option>
<option value="listing2.html">/Sources/DebugUtils.c</option>
<option value="listing3.html">/Sources/DebugUtils.h</option>
<option value="listing4.html">/Sources/MenuScripter.r</option>
<option value="listing5.html">/Sources/MenuScripterPPC.r</option>
<option value="listing6.html">/Sources/MSAccessors.c</option>
<option value="listing7.html">/Sources/MSAccessors.h</option>
<option value="listing8.html">/Sources/MSAEClone.c</option>
<option value="listing9.html">/Sources/MSAEClone.h</option>
<option value="listing10.html">/Sources/MSAEClose.c</option>
<option value="listing11.html">/Sources/MSAEClose.h</option>
<option value="listing12.html">/Sources/MSAECoercions.c</option>
<option value="listing13.html">/Sources/MSAECoercions.h</option>
<option value="listing14.html">/Sources/MSAECompare.c</option>
<option value="listing15.html">/Sources/MSAECompare.h</option>
<option value="listing16.html">/Sources/MSAECopy.c</option>
<option value="listing17.html">/Sources/MSAECopy.h</option>
<option value="listing18.html">/Sources/MSAECountElements.c</option>
<option value="listing19.html">/Sources/MSAECountElements.h</option>
<option value="listing20.html">/Sources/MSAECreate.c</option>
<option value="listing21.html">/Sources/MSAECreate.h</option>
<option value="listing22.html">/Sources/MSAECut.c</option>
<option value="listing23.html">/Sources/MSAECut.h</option>
<option value="listing24.html">/Sources/MSAEDelete.c</option>
<option value="listing25.html">/Sources/MSAEDelete.h</option>
<option value="listing26.html">/Sources/MSAEGetData.c</option>
<option value="listing27.html">/Sources/MSAEGetData.h</option>
<option value="listing28.html">/Sources/MSAEGetDataSize.c</option>
<option value="listing29.html">/Sources/MSAEGetDataSize.h</option>
<option value="listing30.html">/Sources/MSAEMenuUtils.c</option>
<option value="listing31.html">/Sources/MSAEMenuUtils.h</option>
<option value="listing32.html">/Sources/MSAEMove.c</option>
<option value="listing33.html">/Sources/MSAEMove.h</option>
<option value="listing34.html">/Sources/MSAEObjectsExist.c</option>
<option value="listing35.html">/Sources/MSAEObjectsExist.h</option>
<option value="listing36.html">/Sources/MSAEPaste.c</option>
<option value="listing37.html">/Sources/MSAEPaste.h</option>
<option value="listing38.html">/Sources/MSAERecording.c</option>
<option value="listing39.html">/Sources/MSAERecording.h</option>
<option value="listing40.html">/Sources/MSAERevert.c</option>
<option value="listing41.html">/Sources/MSAERevert.h</option>
<option value="listing42.html">/Sources/MSAESave.c</option>
<option value="listing43.html">/Sources/MSAESave.h</option>
<option value="listing44.html">/Sources/MSAESelect.c</option>
<option value="listing45.html">/Sources/MSAESelect.h</option>
<option value="listing46.html">/Sources/MSAESetData.c</option>
<option value="listing47.html">/Sources/MSAESetData.h</option>
<option value="listing48.html">/Sources/MSAETextUtils.c</option>
<option value="listing49.html">/Sources/MSAETextUtils.h</option>
<option value="listing50.html">/Sources/MSAEUtils.c</option>
<option value="listing51.html">/Sources/MSAEUtils.h</option>
<option value="listing52.html">/Sources/MSAEWindowUtils.c</option>
<option value="listing53.html">/Sources/MSAEWindowUtils.h</option>
<option value="listing54.html">/Sources/MSAppleEvents.c</option>
<option value="listing55.html">/Sources/MSAppleEvents.h</option>
<option value="listing56.html">/Sources/MSASSubroutines.c</option>
<option value="listing57.html">/Sources/MSASSubroutines.h</option>
<option value="listing58.html">/Sources/MSDrag.c</option>
<option value="listing59.html">/Sources/MSDrag.h</option>
<option value="listing60.html">/Sources/MSFile.c</option>
<option value="listing61.html">/Sources/MSFile.h</option>
<option value="listing62.html">/Sources/MSGlobals.c</option>
<option value="listing63.html">/Sources/MSGlobals.h</option>
<option value="listing64.html">/Sources/MSGXPrinting.c</option>
<option value="listing65.html">/Sources/MSGXPrinting.h</option>
<option value="listing66.html">/Sources/MSMain.c</option>
<option value="listing67.html">/Sources/MSMain.h</option>
<option value="listing68.html">/Sources/MSResultWind.c</option>
<option value="listing69.html">/Sources/MSResultWind.h</option>
<option value="listing70.html">/Sources/MSScript.c</option>
<option value="listing71.html">/Sources/MSScript.h</option>
<option value="listing72.html">/Sources/MSToken.h</option>
<option value="listing73.html">/Sources/MSUtils.c</option>
<option value="listing74.html">/Sources/MSUtils.h</option>
<option value="listing75.html">/Sources/MSWindow.c</option>
<option value="listing76.html">/Sources/MSWindow.h</option>
<option value="listing77.html">/Sources/Offscreen.c</option>
<option value="listing78.html">/Sources/Offscreen.h</option>
<option value="listing79.html">/Sources/PLStrs.c</option>
<option value="listing80.html">/Sources/PLStrs.h</option></select>
				</p>
				</form>
				<p><strong><a href="MenuScripter.zip">Download Sample</a></strong> (&#147;MenuScripter.zip&#148;, 288.0K)<BR>
<strong><a href="MenuScripter.dmg">Download Sample</a></strong> (&#147;MenuScripter.dmg&#148;, 355.0K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">// MSUtils.c//// Original version by Jon Lansdell and Nigel Humphreys.// 4.0 and 3.1 updates by Greg Sutton.// &copy;Apple Computer Inc 1996, all rights reserved./*  Changes for 3.1:      12-Oct-95  : CW : Simplified FeatureIsImplemented routine.               Added init of gHasDragManager flag in CheckEnvironment.                 Changes for 4.0:    17-Apr-96  : GS : Changed pascal calling conventions to C where possible.               Changed behavior of outlining Up, Down and Other in Size menu.*/#ifdef THINK_C  #include &quot;PLStrs.h&quot;#else  #include &lt;PLStringFuncs.h&gt;#endif#include &lt;Events.h&gt;#include &lt;Traps.h&gt;#include &lt;Dialogs.h&gt;#include &lt;Fonts.h&gt;#include &lt;Packages.h&gt;#include &lt;ToolUtils.h&gt;#include &lt;AppleEvents.h&gt;#include &lt;CodeFragments.h&gt;#include &quot;MSUtils.h&quot;//    Name:       LesserOf//    Purpose:    Returns the Lesser of two longints.#pragma segment Utils    long  LesserOf( long A, long B ){  if ( A &lt; B )    return( A );  else    return( B );} // LesserOf      //    Name:       GreaterOf//    Purpose:    Returns the Greater of two longints.  #pragma segment Utils    long  GreaterOf( long A, long B ){  if ( A &gt; B )    return(A);  else    return(B);} // GreaterOf      //    Name:     ShowError//    Purpose:  Reports an error to the user as both string and number.#pragma segment Utils    void  ShowError( Str255 theError, long theErrorCode ){  short     alertResult;  Str255    theString;  OSErr     myErr;     myErr = AEInteractWithUser( kAEDefaultTimeout, nil, nil );     if (myErr == noErr)  {    SetCursor(&amp;qd.arrow);    NumToString(theErrorCode, theString);    ParamText( theError, theString, (unsigned char *)&quot;&quot;, (unsigned char *)&quot;&quot; );    alertResult = Alert(300, nil);  }} // ShowError//    Name:       Ours//    Purpose:    Checks the frontmost window belongs to the app.#pragma segment Utils    Boolean  Ours( WindowPtr aWindow ){  if (aWindow)    if (((WindowPeek)aWindow)-&gt;windowKind == zoomDocProc)      return(true);  return(false);} // Ours//    Name:       SetShortMenus//    Purpose:    Cuts the menus down to a minimum - Apple File Edit.//            Greys out the unavailable options - used when no docs open#pragma segment Utils    void  SetShortMenus( void ){   DeleteMenu(mfontID);  DeleteMenu(sizeID);  DeleteMenu(styleID);  DeleteMenu(mscriptID);  DeleteMenu(subroutineID);  SetMenuItemState ( false, myMenus[fileM], fmClose);  SetMenuItemState ( false, myMenus[fileM], fmSave);  SetMenuItemState ( false, myMenus[fileM], fmSaveAs);  SetMenuItemState ( false, myMenus[fileM], fmRevert);  SetMenuItemState ( false, myMenus[fileM], fmPageSetUp);  if (gGXIsPresent)  {    SetMenuItemState ( false, myMenus[fileM], fmPrint);    SetMenuItemState ( false, myMenus[fileM], fmPrintOne );  }  else    SetMenuItemState ( false, myMenus[fileM], fmNoGXPrint);  // now the unnecessary items on the edit menu          SetMenuItemState ( false, myMenus[editM], undoCommand);  SetMenuItemState ( false, myMenus[editM], cutCommand);  SetMenuItemState ( false, myMenus[editM], copyCommand);  SetMenuItemState ( false, myMenus[editM], clearCommand);  SetMenuItemState ( false, myMenus[editM], pasteCommand);  SetMenuItemState ( false, myMenus[editM], selectAllCommand);  DrawMenuBar();}  // SetShortMenus//    Name:     SetLongMenus//    Purpose:  Reinstates the full menu bar - called when first document//                 opened.#pragma segment Utils    void  SetLongMenus( void ){  InsertMenu(myMenus[fontM], 0);  InsertMenu(myMenus[sizeM], 0);  InsertMenu(myMenus[styleM], 0);  InsertMenu(myMenus[scriptM], 0);  InsertMenu(myMenus[subroutineM], 0);  SetMenuItemState ( true, myMenus[fileM], fmClose);  SetMenuItemState ( true, myMenus[fileM], fmSave);  SetMenuItemState ( true, myMenus[fileM], fmSaveAs);  SetMenuItemState ( true, myMenus[fileM], fmRevert);  SetMenuItemState ( true, myMenus[fileM], fmPageSetUp);  if (gGXIsPresent)  {    SetMenuItemState ( true, myMenus[fileM],  fmPrint );    SetMenuItemState ( true, myMenus[fileM],  fmPrintOne );  }  else    SetMenuItemState ( true, myMenus[fileM], fmNoGXPrint );  // now the necessary items on the edit menu -  //  many other items fixed on each pass thru the main event  //  loop or before the window pulled down    SetMenuItemState ( true, myMenus[editM], selectAllCommand);  DrawMenuBar();}  // SetLongMenus//    Name:     SetStyleMenu//    Purpose:  Sets the style menu checking to reflect the style of the//                 first character of the current selection in the given//           document.#pragma segment Utils        void  SetStyleMenu( DPtr theDoc ){  TextStyle  theTStyle;  short       contMode;  short       i;    contMode = doFace;    TEContinuousStyle(&amp;contMode,&amp;theTStyle,theDoc-&gt;theText);    if ((contMode &amp; doFace) != 0)  {    CheckItem(myMenus[styleM], cPlain,     (theTStyle.tsFace == 0));    CheckItem(myMenus[styleM], cBold,      (bold      &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cItalic,    (italic    &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cUnderline, (underline &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cOutline,   (outline   &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cShadow,    (shadow    &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cCondense,  (condense  &amp; theTStyle.tsFace));    CheckItem(myMenus[styleM], cExtend,    (extend    &amp; theTStyle.tsFace));  }  else    for (i=cPlain; i&lt;= cExtend; i++)      CheckItem(myMenus[styleM], i, false);}//    Name:       SetSizeMenu//    Purpose:    Outline all the items if the current font is an//                outline font. Check the size of the current selection#pragma segment Utils    void  SetSizeMenu( DPtr theDoc ){  short     i;  short    aSize;  short    max;  long     theSize;  Str255      name;  Boolean     sizeinMenu;  Point       numer;  TextStyle  theStyle;  TEHandle    myText;  short       contMode;    numer.h = 1;  numer.v = 1;    myText = theDoc-&gt;theText;    contMode = doSize+doFont;    TEContinuousStyle( &amp;contMode, &amp;theStyle, theDoc-&gt;theText );    sizeinMenu = false;  max = CountMItems(myMenus[sizeM]);  for (i = 1; i &lt;= max - 5; i++)  {    GetItem(myMenus[sizeM], i, name);    StringToNum(name, &amp;theSize);    aSize = (short)theSize;    if (RealFont(theStyle.tsFont, aSize) &amp;&amp; (contMode &amp; doFont) != 0) // there is only one font and this size exists      SetItemStyle(myMenus[sizeM], i, outline);    else      SetItemStyle(myMenus[sizeM], i, 0);    if ((aSize == theStyle.tsSize) &amp;&amp; (contMode &amp; doSize) != 0)    {      sizeinMenu = true;      CheckItem(myMenus[sizeM], i, true);    }    else      CheckItem(myMenus[sizeM], i, false);  }    // If it's not a size in the menu,and there is only one size in the  //  selection range check the other item    if (! sizeinMenu &amp;&amp; (contMode &amp; doSize) != 0)  {    CheckItem(myMenus[sizeM], max, true);    if ( RealFont(theStyle.tsFont, theStyle.tsSize ) &amp;&amp; (contMode &amp; doFont) != 0 )      SetItemStyle(myMenus[sizeM], max, outline);    else      SetItemStyle(myMenus[sizeM], max, 0);  }  else  {    CheckItem(myMenus[sizeM], max, false);    SetItemStyle(myMenus[sizeM], max, 0);  }    // Outline Up if next size up is available  if ( RealFont(theStyle.tsFont, theStyle.tsSize + 1 ) &amp;&amp; (contMode &amp; doFont) != 0 )    SetItemStyle(myMenus[sizeM], max - 3, outline);  else    SetItemStyle(myMenus[sizeM], max - 3, 0);    // Outline Down if next size up is available  if ( RealFont(theStyle.tsFont, theStyle.tsSize - 1 ) &amp;&amp; (contMode &amp; doFont) != 0 )    SetItemStyle(myMenus[sizeM], max - 2, outline);  else    SetItemStyle(myMenus[sizeM], max - 2, 0);}//    Name:       SetFontMenu//    Purpose:    Set the font menu according to the state of//                current selection of the supplied document.#pragma segment Utils    void  SetFontMenu( DPtr theDoc ){  MenuHandle    theMHandle;  short      theNumber;  short      i;  short      max;  Str255      name;  TextStyle    theStyle;  short      contMode;    theMHandle = GetMHandle(mfontID);    if (gFontMItem)  CheckItem(theMHandle, gFontMItem, false);      max = CountMItems(theMHandle);    contMode = doFont;  TEContinuousStyle(&amp;contMode,&amp;theStyle,theDoc-&gt;theText);    gFontMItem = 0;    if (contMode &amp; doFont)    for (i=1; i&lt;=max; i++)    {      GetItem(theMHandle, i, name);      GetFNum(name, &amp;theNumber);      if (theNumber == theStyle.tsFont)        gFontMItem = i;    }    if (gFontMItem)    CheckItem(theMHandle, gFontMItem, true);      SetSizeMenu(theDoc);  SetStyleMenu(theDoc);}//    Name:       GetTempFileName//    Purpose:    Fills newstring with a temporary file name.#pragma segment Utilsvoid  GetTempFileName( DPtr aDoc, Str255 newString ){  Str255        s;  Str255        fileName;    if (aDoc-&gt;everSaved == false)    PLstrcpy(fileName, (unsigned char *)&quot;\pTEXTra&quot;);  else    PLstrcpy(fileName, aDoc-&gt;theFileName);    // generate a unique(ish) temporary filename    if (fileName[0] &gt; 21)    fileName[0] = 21;          NumToString(TickCount(), s);    PLstrcat(fileName, s);    PLstrcpy(newString,fileName);}//    Name:       SetText//    Purpose:    Sets the text of the supplied itemNo in aDialog to //                theString and select it.#pragma segment Utilsvoid  SetText( DialogPtr aDialog, short itemNo, Str255 theString ){  Handle      itemHandle;  Rect        box;  short       kind;  TEHandle    theTEHandle;    GetDItem(aDialog, itemNo, &amp;kind, &amp;itemHandle, &amp;box);  SetIText(itemHandle, theString);    theTEHandle = ((DialogPeek)aDialog)-&gt;textH;    // Set all the text to be selected  if (theTEHandle)    TESetSelect(0, 255, theTEHandle);}      //    Name:       RetrieveText//    Purpose:    Returns the text of anItem in aDialog in aString.#pragma segment Utilsvoid  RetrieveText( DialogPtr aDialog, short anItem, Str255 aString ){  short      kind;  Rect       box;  Handle     itemHandle;    GetDItem(aDialog, anItem, &amp;kind, &amp;itemHandle, &amp;box);  GetIText(itemHandle, aString);}//    Name:       DrawDefaultOutline//    Purpose:    Draws an outline around theItem.//          Called as a useritem Proc by the dialog manager.//          To use place a useritem over the default item in the//          dialog and install the address of this proc as the item//          handle.#pragma segment Utilspascal void  DrawDefaultOutline( DialogPtr theDialog, short theItem ){  short       kind;  Handle      itemHandle;  Rect        box;        GetDItem(theDialog, theItem, &amp;kind, &amp;itemHandle, &amp;box);  PenSize(3, 3);  InsetRect(&amp;box, - 4, - 4);  FrameRoundRect(&amp;box, 16, 16);  PenNormal();} // DrawDefaultOutline      //    Name:       AdornDefaultButton//    Purpose:    Installs DrawDefaultOutline as the useritem proc//                for the given item.#pragma segment Utils    void  AdornDefaultButton(DialogPtr theDialog,short theItem){  short       kind;  Handle      itemHandle;  Rect        box;    GetDItem(theDialog, theItem, &amp;kind, &amp;itemHandle, &amp;box);  SetDItem(theDialog, theItem, kind, (Handle)gDefaultButtonUPP, &amp;box);}void  GetRectOfDialogItem( DialogPtr theDialog, short theItem, Rect *theRect ){  short       kind;  Handle      itemHandle;    GetDItem(theDialog, theItem, &amp;kind, &amp;itemHandle, theRect);}// -------  Determining of Gestalt is available -------// The following routines come from the Inside Mac VI recommendations//  about how to find if a trap is available//  The glue for Gestalt will be in MPW 3.2, so if it is available we will also//   need to check the system version#pragma segment Utilsshort  NumToolboxTraps(void){  if (NGetTrapAddress(_InitGraf, ToolTrap) == NGetTrapAddress(0xAA6E, ToolTrap))    return(0x200);  else    return(0x400);}#pragma segment Utils#define TrapMask  0x0800TrapType  GetTrapType(short theTrap){  if ((theTrap &amp; TrapMask) &gt; 0)    return(ToolTrap);  else    return(OSTrap);}#pragma segment UtilsBoolean  TrapAvailable(short theTrap){  TrapType  tType;    tType = GetTrapType(theTrap);  if (tType == ToolTrap)  {    theTrap = theTrap &amp; 0x07FF;    if (theTrap &gt;= NumToolboxTraps())      theTrap = _Unimplemented;  }  return(NGetTrapAddress(theTrap, tType) != NGetTrapAddress(_Unimplemented,ToolTrap));}#pragma segment Utils#define _Gestalt 0xA1ADBoolean  GestaltAvailable( void ){  return(TrapAvailable(_Gestalt));}// ------ FeatureIsImplemented ------// This is called to use Gestalt to determine if a feature is implemented.// This applies to only those referenced by OSType.#pragma segment UtilsBoolean FeatureIsImplemented( OSType theFeature, short theTestBit ){  OSErr     err;  long      result;  err = Gestalt ( theFeature, &amp;result );  return (err == noErr &amp;&amp; (result &amp; (1L &lt;&lt; theTestBit)));}#pragma segment UtilsBoolean  CheckEnvironment( void ){  long    response;    // first determine of Gestalt is available- if it isn't exit    // as we only run under 7.0.  It could it present in 6.04 - so we need    // to do some further checks for important features  gGestaltAvailable = GestaltAvailable();    if (!gGestaltAvailable)    return(false);    // check if the Edition Manager is present  gEditionManagerImplemented = FeatureIsImplemented(gestaltEditionMgrAttr, gestaltEditionMgrPresent);    // and for good measure - the Alias manager  gAliasManagerImplemented  = FeatureIsImplemented(gestaltAliasMgrAttr, gestaltAliasMgrPresent);    // check for the AppleEvents manager - we certainly can't work without it  gAppleEventsImplemented   = FeatureIsImplemented(gestaltAppleEventsAttr, gestaltAppleEventsPresent);    // check if recording is implemented  gRecordingImplemented   = FeatureIsImplemented(gestaltAppleEventsAttr,1);        // check for the Outline fonts  gOutlineFontsImplemented  = FeatureIsImplemented(gestaltFontMgrAttr, gestaltOutlineFonts);      // We would also like the Drag Manager  gHasDragManager = FeatureIsImplemented ( gestaltDragMgrAttr, gestaltDragMgrPresent );// It isn't enough to use Gestalt because we may not have sucessfully linked// to the DragLib shared library. So, we also need to test one of the symbols// against kUnresolvedSymbol to make sure we have a valid connection to it.#if GENERATINGCFM  if ( gHasDragManager )    gHasDragManager = (InstallTrackingHandler != (void*) kUnresolvedSymbolAddress);#endif      // Want the process manager  gHasProcessManager = ( noErr == Gestalt( gestaltOSAttr, &amp;response ) );  return (gEditionManagerImplemented        &amp;&amp; gAliasManagerImplemented           &amp;&amp; gAppleEventsImplemented            &amp;&amp; gOutlineFontsImplemented              &amp;&amp; gHasProcessManager );              }  // CheckEnvironment      //  DoPageSetup returns true if the page setup of the document is altered  Boolean  DoPageSetup(DPtr theDoc){  Boolean result = false;    if ( ! gGXIsPresent )    if ( theDoc )    {      PrOpen();      result =  PrStlDialog(theDoc-&gt;thePrintSetup);      PrClose();    }      return(result);}  // DoPageSetup//  Name:    CtrlKeyPressed//  Purpose: Returns true if control key pressed during eventBoolean  CtrlKeyPressed( const EventRecord *theEvent ){  return((theEvent-&gt;modifiers &amp; controlKey) != 0);}  //  Name:    OptionKeyPressed//  Purpose: Returns true if option key pressed during eventBoolean  OptionKeyPressed( const EventRecord *theEvent ){  return((theEvent-&gt;modifiers &amp; optionKey) != 0);}Boolean SetMenuItemState (  Boolean    theState,              MenuHandle theMenu,              short      item ){  Boolean reDrawMenuBar = false;  Boolean isSet;    if (item == kMenuTitle)  {    isSet = ((*theMenu)-&gt;enableFlags &amp; 0x00000001);    reDrawMenuBar = (isSet != theState);  }  if (theState)    EnableItem ( theMenu, item );  else    DisableItem ( theMenu, item );    return ( reDrawMenuBar );}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/MenuScripter/listing73.html%3Fid%3DDTS10000668-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/MenuScripter/listing73.html%3Fid%3DDTS10000668-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/MenuScripter/listing73.html%3Fid%3DDTS10000668-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>