<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Attaching Scripts (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING53></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-52.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-54.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-21.html"><B>Part 1 - MacApp Theory and Architecture</B></A><BR><DD><A HREF="MacAppProgGuide-48.html"><B>Chapter 6 - Scripting</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING53-0></A>
<H1><A NAME=MARKER-9-154></A><A NAME=MARKER-2-155></A>Attaching Scripts</H1>
 MacApp provides true attachability through its Apple event dispatching mechanism and its <CODE><A NAME=MARKER-2-156></A>MScriptableObject</CODE> class--that is, a script can be attached to an object, and any Apple events specifying that object will first be dispatched to the attached script. The attached script may perform an action and pass the event on to the specified object, it may perform an action and return, or it may ignore the event and pass it on to the specified object.<P>
 To enable attachability in your application, you must build the application with the <CODE><A NAME=MARKER-9-1></A>qAttachable</CODE> flag set to <CODE>TRUE</CODE>. If you never attach scripts, you can omit MacApp's attachability code. <A HREF=MacAppProgGuide-152.html#MARKER-9-30>"Common Command-Line Options," beginning on page 678</A>, describes how to build your application with and without attachability code when using MPW's MABuild system.<P>
<A NAME=HEADING53-3></A>
<H2>Attaching a Script to an Object</H2>
 <A NAME=MARKER-2-158></A>To have an attached script, an object's class must mix in the MScriptableObject class. You attach a script to an object that mixes in MScriptableObject by calling the <CODE>SetObjectProperty</CODE> method and passing two values: a <CODE>CAEDesc</CODE> value that describes the script and a <CODE>DescType</CODE> value that specifies the <CODE>pScript</CODE> property. The MScriptableObject class has a field <CODE><A NAME=MARKER-2-160></A>fOSAScript</CODE> of type <CODE>COSAScriptCntPtr</CODE>. The <CODE>SetObjectProperty</CODE> method calls the <CODE>SetOSAScript</CODE> method, which sets the <CODE>fOSAScript</CODE> field.<P>
 In setting the <CODE>fOSAScript</CODE> field, the <CODE>SetOSAScript</CODE> method notifies the global <CODE>TOSADispatcher</CODE> object that there is an object with a script attached. When the first script is attached, the dispatcher object calls its <CODE><A NAME=MARKER-2-161></A>InstallPreDispatchHandler</CODE> method <A HREF=MacAppProgGuide-52.html#MARKER-9-108>(page 152)</A> to set up MacApp's mechanism for predispatching Apple events to attached scripts.<P>
 When you remove an attached script, the MScriptableObject<CODE>::FreeOSAScript</CODE> method calls the global dispatcher object's <CODE>ScriptDetached</CODE> method, which removes the predispatch handler if there are no more scripts attached (the <CODE><A NAME=MARKER-2-162></A>fAttachedScripts</CODE> count is equal to 0).<P>
 <A HREF=MacAppProgGuide-93.html#MARKER-9-48>"Recipe--Attaching a Script to Objects in Your Application," beginning on page 365</A>, provides a simple script and shows how you can attach it to every window in your application. MacApp even saves the script with the document, as described in the following section.<P>
<A NAME=HEADING53-8></A>
<H2><A NAME=MARKER-2-163></A>Saving an Attached Script With a Document</H2>
 The <CODE>TFileBasedDocument</CODE> class contains methods to read and write an attached script. Reading and writing are controlled by a field of the <CODE>TDocument</CODE> class, <CODE><A NAME=MARKER-2-164></A>fSaveAttachedScript</CODE>, which specifies whether an attached script should be saved when the document is written to a file (or read in when the document is read from a file). By default, <CODE>fSaveAttachedScript</CODE> is set to <CODE>TRUE</CODE>.<P>
 If the <CODE>fSaveAttachedScript</CODE> field has the value <CODE>TRUE</CODE> when you write a document object based on <CODE>TFileBasedDocument</CODE>, the <CODE>DoWrite</CODE> method calls the <CODE><A NAME=MARKER-2-165></A>DoWriteScript</CODE> method. If there is an attached script, the <CODE>DoWriteScript</CODE> method calls the <CODE><A NAME=MARKER-2-166></A>WriteOSAScript</CODE> method, a method of <CODE>MScriptableObject</CODE>, which writes the attached script to the file stream.<P>
 As a result of this implementation, if you attach a script to a window in your application, the script will automatically be saved with the window's document. When you open the document, the script will be read in and enabled.<P>
<DL>
<DT><B>Note</B>
<DD>When you attach a script to a window by setting the <CODE><A NAME=MARKER-2-167></A>pScript</CODE> property, the window defers to its document, so the script is actually attached to the document.<EM></EM><A NAME=MARKER-2-168></A><A NAME=MARKER-2-169></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-52.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-54.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
