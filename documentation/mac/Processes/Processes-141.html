<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Loading Code Segments (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING141></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-140.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-142.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-135.html"><B>Chapter 7 - Segment Manager</B></A> / <A HREF="Processes-139.html"><B>Using the Segment Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING141-0></A>
<H2>Loading Code Segments<A NAME=MARKER-2-30></A><A NAME=MARKER-2-31></A></H2>
 The Segment Manager loads a code segment into memory automatically when you call any externally referenced routine in that segment. In most cases, the Segment Manager moves the block occupied by the code segment as high in the application heap as possible (by calling the Memory Manager procedure <CODE>MoveHHi</CODE>) and locks the block (by calling <CODE>HLock</CODE>) so that it cannot be moved or purged. You can disable or enable the call to <CODE>MoveHHi</CODE> and monitor the loading of segments into memory by manipulating two low-memory global variables.<A NAME=MARKER-2-32></A><P>
 If a code segment to be loaded is unlocked (that is, if it's not in memory and its <CODE>resLocked</CODE> attribute is clear, or if it is in memory and is unlocked), then the <CODE>_LoadSeg</CODE> trap calls the Memory Manager procedure <CODE>MoveHHi</CODE> to move the segment toward the top of the current heap. To prevent heap fragmentation, you should call the Memory Manager procedure <CODE>MaxApplZone</CODE> early in your application's execution. Otherwise, the heap will grow incrementally, and these automatic calls to <CODE>MoveHHi</CODE> may leave your code segments scattered throughout the heap. You can, however, disable the call to <CODE>MoveHHi</CODE> by setting the low-memory global variable <CODE>SegHiEnable</CODE> to 0. If this variable contains the value 0, <CODE>_LoadSeg</CODE> does not call <CODE>MoveHHi</CODE> to move the segment toward the top of the heap.<A NAME=MARKER-2-33></A><A NAME=MARKER-2-34></A><P>
 Occasionally, especially during application development, it is useful to monitor the otherwise largely invisible process of loading segments. You can do this by manipulating the system global variable <CODE>LoadTrap</CODE>. Before any routine in a newly loaded code segment is executed, the <CODE>_LoadSeg</CODE> trap inspects the <CODE>LoadTrap</CODE> global variable. If <CODE>LoadTrap</CODE> has a nonzero value, then <CODE>_LoadSeg</CODE> calls the <CODE>_Debugger</CODE> trap. This provides a useful way for you to monitor the loading of segments by the Segment Manager.<A NAME=MARKER-9-121></A><A NAME=MARKER-2-36></A><P>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-140.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-142.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
