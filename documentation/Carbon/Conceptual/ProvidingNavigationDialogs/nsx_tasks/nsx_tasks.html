<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Navigation Services Programming Guide: Navigation Services Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Navigation Services Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001147-CH203" title="Navigation Services Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../UserExperience-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000465" target="_top">User Experience</a> &gt; <a href="../nsx_intro/nsx_intro.html#//apple_ref/doc/uid/TP30001147-CH204-DontLinkElementID_9">Navigation Services Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../nsx_concepts/nsx_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../nsx_rev_hx/ns_rev_hx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30001147-CH203-BABGIAGG" title="Navigation Services Tasks"></a><h1>Navigation Services Tasks</h1><p>The Navigation Services API is fairly straightforward to use. It contains a modest number of functions and it performs a well-defined set of tasks. This chapter lists some overall guidelines for using the API, shows you how to accomplish the most common tasks, and discusses approaches to take if you need to customize a navigation dialog. The chapter contains these sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABJJBFA">“Guidelines for Using Navigation Services.”</a></span> Read this first to get an idea how to best use the Navigation Services API in Mac OS X.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABDGBBA">“Steps for Providing a Navigation Dialog.”</a></span> This section is a must-read because it discusses the five tasks required to display and process a navigation dialog.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIJJGHI">“Writing a Navigation Event-Handling Callback.”</a></span> This is another required-reading section. If your application doesn’t provide an event-handling callback, it won’t be able to obtain and process actions taken by the user in a navigation dialog.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIBEAHH">“Filtering the Types of Files That Users Can Open.”</a></span> Navigation Services can filter on the basis of the <code>OSType</code> of a file. You can get more sophisticated filtering by providing your own filtering routine. This section tells you how.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIDBEIC">“Writing a Preview Callback.”</a></span> Only those developers who want to customize a preview display need to read this.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABEBHAH">“Controlling Settings in a Navigation Dialog.”</a></span> Read this for information on how to set values for items in a navigation dialog.</p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABFIHEE">“Adding Custom Items to a Navigation Dialog.”</a></span> If you want to add custom controls to a dialog, read this.</p></li></ul><a name="//apple_ref/doc/uid/TP30001147-CH203-BABJJBFA" title="Guidelines for Using Navigation Services"></a><h2>Guidelines for Using Navigation Services</h2><p>There are a number of guidelines you should follow to ensure optimal performance and efficient memory use when you use Navigation Services. This section summarizes them.</p><ul class="ul"><li class="li"><p>Disable the Open menu item when you are processing an Open command. Enable the menu item after you have disposed of the Open dialog. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIJJGHI">“Writing a Navigation Event-Handling Callback”</a></span> for an example.</p></li><li class="li"><p>Use <code>CFStringRef</code> data types for filenames.</p></li><li class="li"><p>Whenever possible, use sheets for Save dialogs used for documents.</p></li><li class="li"><p>Save user settings for different types of Open and Save dialogs. For example, save settings for a dialog that opens a document template independently of those settings used for a dialog that opens user-created documents.</p></li><li class="li"><p>Use Navigation Services routines—not Dialog Manager, Control Manager, or HIView routines—if you want to handle standard navigation dialog user interface items such as the Open, Save, and Cancel buttons. Although it was possible (but not recommended) to use Dialog Manager routines in the past, their use for standard navigation dialog items is not supported beginning with Mac OS X v. 10.3. Use of Control Manager or HIView routines is discouraged. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABEBHAH">“Controlling Settings in a Navigation Dialog”</a></span> for more information.</p></li><li class="li"><p>If you customize a navigation dialog avoid erasing behind items and do not explicitly draw your controls in the custom area. Instead, create your custom controls in a nib file and let Navigation Services handle the drawing for you. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABFIHEE">“Adding Custom Items to a Navigation Dialog”</a></span> for more information.</p></li></ul><a name="//apple_ref/doc/uid/TP30001147-CH203-BABDGBBA" title="Steps for Providing a Navigation Dialog"></a><h2>Steps for Providing a Navigation Dialog</h2><p>There are five tasks your application performs to allow users to navigate to items in the file system for the purpose of opening a file, saving a new file, or performing a Save As operation on an existing file:</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIGFECA">“Obtain Default Values for a Dialog Creation Structure”</a></span></p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIEGIJC">“Fill the Dialog Creation Structure With Appropriate Values”</a></span></p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIGBDGD">“Create the Dialog”</a></span></p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIHIJCE">“Run the Dialog”</a></span></p></li><li class="li"><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIDGFBB">“Dispose of the Dialog”</a></span></p></li></ol><p>Each of these steps is described in detail in the sections that follow. </p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIGFECA" title="Obtain Default Values for a Dialog Creation Structure"></a><h3>Obtain Default Values for a Dialog Creation Structure</h3><p>You use the data structure <code>NavDialogCreationOptions</code> to set the options you want Navigation Services to use for a dialog. Before you can fill out the data structure with your options, you must initialize it with default values by calling the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavGetDefaultDialogCreationOptions" target="_top">NavGetDefaultDialogCreationOptions</a></code>, as shown in <span class="content_text">Listing 2-1</span>.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIFECFF" title="Listing 2-1Initializing a dialog creation structure"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Initializing a dialog creation structure</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre>NavDialogCreationOptions myDialogOptions;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = NavGetDefaultDialogCreationOptions (&amp;myDialogOptions);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIEGIJC" title="Fill the Dialog Creation Structure With Appropriate Values"></a><h3>Fill the Dialog Creation Structure With Appropriate Values</h3><p>After you have obtained an initialized dialog creation structure, you can change any of the default settings you’d like. <span class="content_text">Table 2-1</span> lists the fields in the dialog creation structure and describes what you’d typically provide. For more details on the fields in the dialog creation structure, see <span class="content_text"><a href="../../../Reference/Navigation_Services_Ref/index.html#//apple_ref/doc/uid/TP30000240" target="_top">Navigation Services Reference</a></span>.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIDIBJG" title="Table 2-1Fields in the dialog creation structure"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Fields in the dialog creation structure</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Field Name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Comments</p></th></tr><tr><td  scope="row"><p><code>version</code></p></td><td ><p>Keep the default value.</p></td></tr><tr><td  scope="row"><p><code>optionFlags</code></p></td><td ><p>Supply the dialog configuration options appropriate for your application. There are many options. The default options as well as the values you can set are fully described in “Dialog Configuration Options” in <span class="content_text"><a href="../../../Reference/Navigation_Services_Ref/index.html#//apple_ref/doc/uid/TP30000240" target="_top">Navigation Services Reference</a></span>.</p></td></tr><tr><td  scope="row"><p><code>Point</code></p></td><td ><p>For Open dialogs, you can optionally supply a location for the upper-left corner of the dialog; the default is the center of the primary screen. This field is not relevant to sheets.</p></td></tr><tr><td  scope="row"><p><code>clientName</code></p></td><td ><p>Provide a string only if you want to identify your application in the title for any dialog and in alert messages for save dialogs. This string is appended to the window title.</p></td></tr><tr><td  scope="row"><p><code>windowTitle</code></p></td><td ><p>Provide a string only if you want to override the default window title.</p></td></tr><tr><td  scope="row"><p><code>actionButtonLabel</code></p></td><td ><p>Provide a button label only if you want to override the default action button label (Open, Save, and so forth).</p></td></tr><tr><td  scope="row"><p><code>cancelButtonLabel</code></p></td><td ><p>Provide a button label only if you want to override the default label for the Cancel button.</p></td></tr><tr><td  scope="row"><p><code>saveFileName</code></p></td><td ><p>Provide a string to use as the name for a file to save; the default behavior is to display a blank field for the user to fill in.</p></td></tr><tr><td  scope="row"><p><code>message</code></p></td><td ><p>Provide a string if you want to display a message or prompt above the browser list.</p></td></tr><tr><td  scope="row"><p><code>preferenceKey</code></p></td><td ><p>Provide this to have Navigation Services save the user settings for different types of Open and Save dialogs.</p></td></tr><tr><td  scope="row"><p><code>popupExtension</code></p></td><td ><p>Provide this only if you want to assign additional menu items to the Show pop-up menu in an Open dialog or to the Format pop-up menu in a Save dialog.</p></td></tr><tr><td  scope="row"><p><code>modality</code></p></td><td ><p>Use to specify whether the dialog is a sheet. For a save dialog provide <code>kWindowModalityWindowModal</code> because a save dialog in Mac OS X should be a sheet.</p></td></tr><tr><td  scope="row"><p><code>parentWindow</code></p></td><td ><p>Supply the parent window for a sheet.</p></td></tr><tr><td  scope="row"><p><code>reserved</code></p></td><td ><p>Ignore this field.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIGBDGD" title="Create the Dialog"></a><h3>Create the Dialog</h3><p>You can create dialogs for opening or saving existing documents, or for closing documents that have unsaved changes. <span class="content_text">Table 2-2</span> lists the functions you can use for opening an item. <span class="content_text">Table 2-3</span> lists those you can use when a user tries to close a document that has unsaved changes. Each table provides guidelines for choosing which function to use. When the user issues a command to save a new, untitled document or to save an existing document using a different filename, there is only one function to use—<code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCreatePutFileDialog" target="_top">NavCreatePutFileDialog</a></code>. </p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIGFJDJ" title="Table 2-2Functions used to create Open dialogs"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>Functions used to create Open dialogs</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use this function</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>When you want a user to choose . . .</p></th></tr><tr><td  scope="row"><p><code>NavCreateChooseObjectDialog</code></p></td><td ><p>One or more files, folders, or volumes</p></td></tr><tr><td  scope="row"><p><code>NavCreateGetFileDialog</code></p></td><td ><p>One or more files</p></td></tr><tr><td  scope="row"><p><code>NavCreateChooseFileDialog</code></p></td><td ><p>A single file</p></td></tr><tr><td  scope="row"><p><code>NavCreateChooseFolderDialog</code></p></td><td ><p>A single folder</p></td></tr><tr><td  scope="row"><p><code>NavCreateChooseVolumeDialog</code></p></td><td ><p>A single volume</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIJBGCI" title="Table 2-3Functions used to create Close dialogs"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-3&nbsp;&nbsp;</strong>Functions used to create Close dialogs</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Use this function</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>When you want to . . .</p></th></tr><tr><td  scope="row"><p><code>NavCreateAskSaveChangesDialog</code></p></td><td ><p>Ask the user whether to save changes. Use in response to Close or Quit commands when the file contents have changed since the file was opened or the last save. </p></td></tr><tr><td  scope="row"><p><code>NavCreateAskReviewDocumentsDialog</code></p></td><td ><p>Notify the user of multiple unsaved documents and provide the option for the user to review them. Use in response to a Quit or Close All command when file contents for at least two of the files have changed. </p></td></tr><tr><td  scope="row"><p><code>NavCreateAskDiscardChangesDialog</code></p></td><td ><p>Ask the user whether to discard changes. Use to provide the user with an opportunity to revert to a previous version.</p></td></tr></table></div><p><span class="content_text">Listing 2-2</span> shows how to use the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCreateGetFileDialog" target="_top">NavCreateGetFileDialog</a></code> to create an open dialog that allows the user to choose one or more files. Although the open-dialog creation functions don’t all take the same parameters, they are similar enough for you to get an idea of how to use all of them by looking at <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCreateGetFileDialog" target="_top">NavCreateGetFileDialog</a></code>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIEGIBG" title="Listing 2-2Creating a navigation dialog for opening a file"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Creating a navigation dialog for opening a file</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = NavCreateGetFileDialog (&amp;myDialogOptions, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                        myFileList, <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                        myNavigationEventCallback, <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                        NULL,       <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                        NULL,       <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        NULL, <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myDialogRef); <span>// 7</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Passes an initialized dialog options structure that is filled out with options appropriate for your application. This is the structure discussed in <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIGFECA">“Obtain Default Values for a Dialog Creation Structure”</a></span> and <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIEGIJC">“Fill the Dialog Creation Structure With Appropriate Values.”</a></span></p></li><li class="li"><p>Passes a <code>NavTypeListHandle</code> value that points to a <code>NavTypeList</code> data structure. You must first declare the storage for this structure, then fill it with: </p><ul class="ul"><li class="li"><p>A four-character sequence that specifies an <code>OSType</code></p></li><li class="li"><p>The number of file types contained in the following list</p></li><li class="li"><p>A list of file types, specified as <code>OSType</code> data types, to show in the Open dialog</p></li></ul><p>In this example, <code>myFileList</code> was previously filled out with the appropriate information.</p></li><li class="li"><p>Passes a universal procedure pointer to a navigation event callback function (<code>NavEventUPP</code> data type). You must supply this callback to handle user events. For details, see <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIJJGHI">“Writing a Navigation Event-Handling Callback.”</a></span></p></li><li class="li"><p>Passes <code>NULL</code>. You can optionally pass a universal procedure pointer to a preview callback function (<code>NavPreviewUPP</code> data type). To determine whether or not you’d need to provide this callback, see <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIDBEIC">“Writing a Preview Callback.”</a></span></p></li><li class="li"><p>Passes <code>NULL</code>. You can optionally pass a universal procedure pointer to a filter callback function (<code><!--a target="_top" -->NavObjectFilterProcPtr<!--/a--></code>). To determine whether or not you’d need to provide this callback, see <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIBEAHH">“Filtering the Types of Files That Users Can Open.”</a></span></p></li><li class="li"><p>Passes <code>NULL</code>. You can optionally pass a 32-bit value containing or referring to application-specific data needed by your callback function.</p></li><li class="li"><p>Passes a valid pointer to a <code>NavDialogRef</code> data type. On return, points to a Navigation Services dialog reference that you later need to run the dialog.</p></li></ol><p><span class="content_text">Listing 2-3</span> shows how to use the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCreatePutFileDialog" target="_top">NavCreatePutFileDialog</a></code> to create a dialog that allows the user to save a PDF file. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIIEHHD" title="Listing 2-3Creating a navigation dialog for saving a file as a PDF"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Creating a navigation dialog for saving a file as a PDF</p><div class="codesample"><table><tr><td scope="row"><pre>#define kFileCreator   'prvw'<span></span></pre></td></tr><tr><td scope="row"><pre>#define kFileTypePDF   'PDF '<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = NavCreatePutFileDialog (&amp;myDialogOptions, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                        kFileTypePDF, <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                        kFileCreator, <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                        myNavigationEventCallback, <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                        NULL, <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myDialogRef); <span>// 6</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Passes an initialized dialog options structure that is filled out with options appropriate for your application. This is the structure discussed in <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIGFECA">“Obtain Default Values for a Dialog Creation Structure”</a></span> and <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIEGIJC">“Fill the Dialog Creation Structure With Appropriate Values.”</a></span></p></li><li class="li"><p>Passes an application-defined constant to specify that the file is to be saved as a PDF.</p></li><li class="li"><p>Passes an application-defined constant to specify the application that can open the file. </p></li><li class="li"><p>Passes a universal procedure pointer to a navigation event callback function (<code>NavEventUPP</code>). You must supply this callback to handle user events. For details, see <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIJJGHI">“Writing a Navigation Event-Handling Callback.”</a></span></p></li><li class="li"><p>Passes <code>NULL</code>. You can optionally pass a 32-bit value containing or referring to application-specific data needed by your callback functions.</p></li><li class="li"><p>Passes a valid pointer to a <code>NavDialogRef</code> data type. On return, points to a Navigation Services dialog reference that you later need to run the dialog.</p></li></ol><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIHIJCE" title="Run the Dialog"></a><h3>Run the Dialog</h3><p>After you have created a dialog, you pass the Navigation Services dialog reference returned by the creation function to the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavDialogRun" target="_top">NavDialogRun</a></code>, as shown in <span class="content_text">Listing 2-4</span>.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIDCJAJ" title="Listing 2-4Running a previously created dialog"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Running a previously created dialog</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>status = NavDialogRun (myDialogRef);<span></span></pre></td></tr></table></div><p>Navigation Services keeps track of the dialog while it is running and invokes your callback to handle user actions such as clicking Open, Save As, or Cancel. Navigation Services handles all the display and browsing activity for you.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIDGFBB" title="Dispose of the Dialog"></a><h3>Dispose of the Dialog</h3><p>After your callback receives a termination notification (<code>kNavCBTerminate</code>), the previous call to the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavDialogRun" target="_top">NavDialogRun</a></code> completes. At this time your application must dispose of the Navigation Services dialog reference, by calling the function <code>NavDialogDispose</code>, as shown in the following line of code. </p><div class="codesample"><table><tr><td scope="row"><pre>NavDialogDispose (myDialogRef);<span></span></pre></td></tr></table></div><p>You pass the dialog reference you obtained when you called the function to create the dialog.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIJJGHI" title="Writing a Navigation Event-Handling Callback"></a><h2>Writing a Navigation Event-Handling Callback</h2><p>A navigation event-handling callback function handles events associated with the navigation dialogs you create. You pass Navigation Services a UPP to your event handler whenever you create a dialog. At a minimum, your event handler performs the following tasks:</p><ul class="ul"><li class="li"><p>It processes these user actions—clicking the Save, Open, and Cancel buttons. Your application obtains the specific action, gets the associated reply record, and processes the action. </p></li><li class="li"><p>It processes a termination event. Any user action that terminates a dialog results in Navigation Services invoking your callback with the event <code>kNavCBTerminate</code>. Your application disposes of the dialog reference you obtained when you created the dialog, cleans up menus, and so forth.</p></li></ul><p>If you customize the dialog by adding your own controls, you also handle their events.</p><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABCGDIC">Listing 2-5</a></span> shows a navigation event-handling callback. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BABCGDIC" title="Listing 2-5A navigation event-handling callback"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>A navigation event-handling callback</p><div class="codesample"><table><tr><td scope="row"><pre>void MyNavEventProc (NavEventCallbackMessage callBackSelector, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                    NavCBRecPtr callBackParms,<span></span></pre></td></tr><tr><td scope="row"><pre>                    void *callBackUserData )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>switch (callBackSelector) <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    case kNavCBUserAction: <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NavReplyRecord  reply; <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        NavUserAction   userAction = 0; <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>        if ((status = NavDialogGetReply (callBackParms->context, <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                             &amp;reply)) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            OSStatus tempErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            userAction = NavDialogGetUserAction <span>// 7</span></pre></td></tr><tr><td scope="row"><pre>                         (callBackParms->context);<span></span></pre></td></tr><tr><td scope="row"><pre>            switch (userAction)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                case kNavUserActionSaveAs: <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>                    // your code to save as<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kNavUserActionOpen: <span>// 9</span></pre></td></tr><tr><td scope="row"><pre>                    // your code to open<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kNavUserActionCancel: <span>// 10</span></pre></td></tr><tr><td scope="row"><pre>                        //..<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>                case kNavUserActionNewFolder: <span>// 11</span></pre></td></tr><tr><td scope="row"><pre>                    //..<span></span></pre></td></tr><tr><td scope="row"><pre>                break;<span></span></pre></td></tr><tr><td scope="row"><pre>            } // switch userAction<span></span></pre></td></tr><tr><td scope="row"><pre>            tempErr = NavDisposeReply (&amp;reply); <span>// 12</span></pre></td></tr><tr><td scope="row"><pre>            if(!status) <span>// 13</span></pre></td></tr><tr><td scope="row"><pre>                status = tempErr;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            break;<span></span></pre></td></tr><tr><td scope="row"><pre>    } // end case kNavCBUserAction<span></span></pre></td></tr><tr><td scope="row"><pre>    break;<span></span></pre></td></tr><tr><td scope="row"><pre>    case kNavCBTerminate: <span>// 14</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>            if(MyDialogRef)<span></span></pre></td></tr><tr><td scope="row"><pre>                NavDialogDispose(callBackParms->context ); <span>// 15</span></pre></td></tr><tr><td scope="row"><pre>            // re-enable open if needed<span></span></pre></td></tr><tr><td scope="row"><pre>            EnableMenuCommand (NULL, kHICommandOpen); <span>// 16</span></pre></td></tr><tr><td scope="row"><pre>    break;<span></span></pre></td></tr><tr><td scope="row"><pre>    } // End case kNavCBTerminate<span></span></pre></td></tr><tr><td scope="row"><pre> } // End switch (callBackSelector)<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Takes three parameters passed to your callback from Navigations Services: a callback selector, callback parameters, and user data. The callback selector contains the event that triggered your callback. The callback parameters, contained in a navigation callback record, contain detailed information about the dialog and the event. You’ll use this later to extract the user action associated with the event. The user data is a 32-bit value containing or referring to application-specific data needed by your callback function. This is the value you passed when you created the dialog. It can be <code>NULL</code>. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIGBDGD">“Create the Dialog.”</a></span></p></li><li class="li"><p>Checks the callback selector to see what event triggered the callback.</p></li><li class="li"><p>Screens for the callback selector case of a user action. </p></li><li class="li"><p>Declares a reply record variable. User actions have an associated reply record that your application retrieves.</p></li><li class="li"><p>Declares a user action variable and sets it to a default of <code>0</code>. You use this variable to retrieve the specific action taken by the user.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavDialogGetReply" target="_top">NavDialogGetReply</a></code> to retrieve the reply record associated with the user action. You need to pass the <code>context</code> field of the navigation callback record. The <code>context</code> field references an opaque object that identifies the dialog instance. You also need to pass the reply record you declared previously. On return, the <code>reply</code> parameter is filled out with information about the reply, including information about the files selected or saved by the user. Typically you pass the reply record to your functions for opening or saving.</p></li><li class="li"><p>Calls the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavDialogGetUserAction" target="_top">NavDialogGetUserAction</a></code> to obtain the specific action taken by the user. You need to pass the <code>context</code> field of the navigation callback record. The function returns the user action in the user action variable you declared previously.</p></li><li class="li"><p>If the user clicks the Save As button, the code calls your function to save the file. You pass the reply record to your function.</p></li><li class="li"><p>If the user clicks the Open button, the code calls your function to open the file. You pass the reply record to your function.</p></li><li class="li"><p>If the user clicks the Cancel button, the code performs any clean up tasks that need to be done. This is optional; typically you don’t need to do anything.</p></li><li class="li"><p>If the user clicks the New Folder button, you can optionally perform any tasks you’d like. Typically you don’t need to do anything; Navigation Services shows the New Folder dialog and processes the event.</p></li><li class="li"><p>Disposes of the reply record.</p></li><li class="li"><p>Checks for errors that may have occurred during the processing of the user action.</p></li><li class="li"><p>Screens for the callback selector case of a termination action. This means that the dialog is about to be closed.</p></li><li class="li"><p>Disposes of the dialog reference.</p></li><li class="li"><p>Enables the Open menu command, just in case you disabled it previously (which is advisable for you to do).</p></li></ol><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIBEAHH" title="Filtering the Types of Files That Users Can Open"></a><h2>Filtering the Types of Files That Users Can Open</h2><p>You can restrict what’s displayed as active in the file browser by:</p><ul class="ul"><li class="li"><p>Choosing one of the restrictive functions (<code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateGetFileDialog" target="_top">NavCreateGetFileDialog</a></code>, <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateChooseFileDialog" target="_top">NavCreateChooseFileDialog</a></code>, <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateChooseFolderDialog" target="_top">NavCreateChooseFolderDialog</a></code>, or <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateChooseVolumeDialog" target="_top">NavCreateChooseVolumeDialog</a></code>) when you create an Open dialog. Navigation Services automatically dims (makes inactive) any object that is not of the appropriate kind (file, folder, volume). It also changes the dialog title appropriately—Choose a File, Choose a Folder, and so forth.</p></li><li class="li"><p>Filter based on a list of uniform type identifiers (or UTIs) by calling the <code>NavDialogSetFilterTypeIdentifiers</code> function, available in Mac OS X v10.4 and later. You can use this function only when creating an Open dialog using <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateGetFileDialog" target="_top">NavCreateGetFileDialog</a></code> or <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/func/NavCreateChooseFileDialog" target="_top">NavCreateChooseFileDialog</a></code>. When you use the <code>NavDialogSetFilterTypeIdentifiers</code> function, Navigation Services automatically provides an Enable pop-up menu and populates the menu with a list of the document types you specified. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABGEHIA">Figure 2-1</a></span> shows an Open dialog that is set up (by providing a list of UTIs) to filter PICT files. Files that are not PICT files are displayed as dimmed. UTIs are discussed later in this section.</p></li><li class="li"><p>Providing a list of <code>OSType</code> data types that specify the document types you want users to open or save. You should choose this option only if you cannot use uniform type identifiers. You pass this list as the <code>inTypeList</code>parameter in a dialog creation function. When you use the <code>inTypeList</code> parameter, Navigation Services automatically provides an Enable pop-up menu and populates the menu with a list of the document types you specified.</p></li><li class="li"><p>Writing a filter callback (<code><!--a target="_top" -->NavObjectFilterProcPtr<!--/a--></code>). When you create a dialog, you supply a UPP to your filter callback. For example, if you want users to open a custom type created by your application, you could supply a filter callback that screens files based on the custom type. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABJIJIA">Figure 2-2</a></span> shows the dialog produced when the filter callback is supplied but UTI or <code>OSType</code> filtering is not supplied. Note that the dialog does not have an Enable pop-up. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABFJGHI">Listing 2-6</a></span> shows an example of a filter callback.</p></li></ul><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABGEHIA" title="Figure 2-1An Open dialog that uses a list to filter PICT files"></a><p><strong>Figure 2-1&nbsp;&nbsp;</strong>An Open dialog that uses a list to filter PICT files</p><img src = "../art/figure3_1.gif" alt = "An Open dialog that uses a list to filter PICT files" width="424" height="321"></div><br/><p><strong>Uniform type identifiers</strong> (or UTIs) are strings that uniquely identify abstract types. They can be used to describe a file format or data type, but can also be used to describe type information for other sorts of entities, such as directories, volumes, or packages. The syntax of a uniform type identifier is similar to a bundle identifier. A UTI has the form of a reversed DNS name, although some special top-level UTI domains are reserved by Apple and are outside the current IANA top-level Internet domain name space.</p><p>Some examples include:</p><ul class="ul"><li class="li"><p>public.jpeg</p></li><li class="li"><p>public.utf16-plain-text</p></li><li class="li"><p>com.apple.xml-plist</p></li><li class="li"><p>com.apple.appleworks.doc</p></li></ul><p><strong>Public types</strong> are standard types or are types that are not controlled by an organization. Currently, public types can be declared only by Apple. Types specific to Apple or Mac OS are declared with identifiers in the com.apple domain. Third parties should declare their own uniform type identifiers in their respective registered Internet domain spaces. </p><p>For more information on UTIs and the UTI API see <em><a href="../../understanding_utis/index.html#//apple_ref/doc/uid/TP40001319" target="_top">Uniform Type Identifiers Overview</a></em>. </p><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABJIJIA" title="Figure 2-2An Open dialog that uses a filter callback for TEXT and PICT files"></a><p><strong>Figure 2-2&nbsp;&nbsp;</strong>An Open dialog that uses a filter callback for TEXT and PICT files</p><img src = "../art/figure3_2.gif" alt = "An Open dialog that uses a filter callback for TEXT and PICT files" width="441" height="353"></div><br/><p>To filter files based on uniform type identifiers, you call the <code>NavDialogSetFilterTypeIdentifiers</code> function (available in Mac OS X v10.4 and later), passing in a CFArray of the UTIs you want your dialog to display as enabled. </p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus NavDialogSetFilterTypeIdentifiers(<span></span></pre></td></tr><tr><td scope="row"><pre>    NavDialogRef inGetFileDialog, CFArrayRef inTypeIdentifiers);<span></span></pre></td></tr></table></div><p>If you need to do more sophisticated filtering, you can write your own custom filtering function. <span class="content_text">Listing 2-6</span> shows a filter function that returns <code>true</code> for any item that is a folder, or for files whose type conforms to the public.text UTI. Using the public.text UTI ensures that all text files—RTF, plain text, Unicode, and so forth—are available in the navigation dialog, not just those that have an <code>OSType</code> value of <code>TEXT</code>.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP30001147-CH203-DontLinkElementID_11" title="Important:"></a><p><strong>Important:</strong>&nbsp;This example serves only to illustrate how you would write a filtering callback function. If you want to filter based on UTIs,  the <code>NavDialogSetFilterTypeIdentifiers</code> function is simpler to use and provides additional features.</p><p></p></div><p>Navigation Services displays as active any item for which your callback returns <code>true</code>. If you return <code>false</code>, the item appears inactive (dimmed) and the user can’t select it. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BABFJGHI" title="Listing 2-6A filter callback that filters out all but text files"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>A filter callback that filters out all but text files</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean MyFilterProc (AEDesc *theItem, void *info,<span></span></pre></td></tr><tr><td scope="row"><pre>                    void *callBackUD,<span></span></pre></td></tr><tr><td scope="row"><pre>                    NavFilterModes filterMode )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean             display = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    NavFileOrFolderInfo *theInfo = (NavFileOrFolderInfo*)info;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSRef               ref;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (theInfo->isFolder == true) <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>        return true;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AECoerceDesc (theItem, typeFSRef, theItem); <span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( AEGetDescData (theItem, &amp;ref, sizeof (FSRef)) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        CFStringRef itemUTI = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>        status = LSCopyItemAttribute (&amp;ref, kLSRolesAll,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kLSItemContentType, (CFTypeRef*)&amp;itemUTI); <span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (status == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>              display = UTTypeConformsTo (itemUTI, CFSTR("public.text") );<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>              CFRelease (itemUTI);  <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return display;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks for a folder and returns <code>true</code> if the item is a folder. Typically you’d want to allow users to open folders and navigate through the folder contents.</p></li><li class="li"><p>Calls the Apple Event Manager function to coerce the <code>FSRef</code> value from the item descriptor record. You need this value in order to obtain extension, type, and creator information for a file.</p></li><li class="li"><p>Calls the Launch Services function (available in Mac OS X v10.4 and later) to obtain the UTI for the file type. Passing <code>kLSItemContentType</code> specifies that you want the uniform type identifier attribute.  </p></li><li class="li"><p>Tests for a conformance relationship between UTI for the file and the public.text type. Returns true if the types are equal or if the UTI conforms, directly or indirectly, to the second type. If the UTI is any kind of text (RTF, plain text, Unicode, and so forth), the function <code>UTTypeConformsTo</code> returns <code>true</code>.</p></li><li class="li"><p>Releases the UTI, which is specified as a CFString object.</p></li></ol><p>You can provide both a filter callback and a list of file types. If you provide a list of file types (either by calling in <code>NavDialogSetFilterTypeIdentifiers</code> or in the <code>inTypeList</code> parameter), make sure that your callback doesn't automatically filter out an entire document type in the filtered list. For example, if the filter list allows JPEG files to be visible, your callback should not automatically screen out all JPEG files. Doing so ensures that the user can always see some files when a particular file type is selected from the Enable popup menu. For more information, see <code><!--a target="_top" -->NavObjectFilterProcPtr<!--/a--></code> in <span class="content_text"><a href="../../../Reference/Navigation_Services_Ref/index.html#//apple_ref/doc/uid/TP30000240" target="_top">Navigation Services Reference</a></span>.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIDBEIC" title="Writing a Preview Callback"></a><h2>Writing a Preview Callback</h2><p>Navigation Services automatically shows a preview of the file content for standard image file and text types and for those files that have a <code>pnot</code> resource (<code>PICT</code> preview resource). For other file types, Navigation Services shows the document icon you specify in your application’s bundle. If your application does not have its own document icon, Navigation Services shows a generic icon. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABICAGB">Figure 2-3</a></span> shows the generic icon supplied by Navigation Services for an AIFF audio file.</p><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABICAGB" title="Figure 2-3A generic icon for an AIFF audio file"></a><p><strong>Figure 2-3&nbsp;&nbsp;</strong>A generic icon for an AIFF audio file</p><img src = "../art/figure3_3.gif" alt = "A generic icon for an AIFF audio file" width="438" height="325"></div><br/><p>If you want to display a preview other than what Navigation Services provides, perform the following tasks:</p><ul class="ul"><li class="li"><p>Write a preview callback function. </p></li><li class="li"><p>Supply a UPP to your preview callback when you call a dialog-creation function for an Open dialog.</p></li><li class="li"><p>Handle the message <code>kNavCBAdjustPreview</code> in your event callback. This message means the user has toggled the preview area on or off. In response, your application adjusts any custom controls it created.</p></li></ul><p>The preview callback function (<code><!--a target="_top" -->NavPreviewProcPtr<!--/a--></code>) takes two parameters: a pointer to a <code>NavCBRec</code> data structure and a pointer to any data your callback needs. The <code>NavCBRec</code> provided to your callback by Navigation Services contains a rectangle, in local QuickDraw coordinates, that describes the preview area available to your application. The minimum size is 145 pixels wide by 118 pixels high. If your callback needs data passed to it, you supply this data when you call a dialog creation function such as <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCreateGetFileDialog" target="_top">NavCreateGetFileDialog</a></code>. When Navigation Services calls your preview function, the data is passed back to your application in the <code>callBackUD</code> parameter.</p><p>Navigation Services invokes your preview-drawing function when the user selects a file. Your preview function, in turn, calls the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code> to determine if the preview area is visible and, if so, what its dimensions are.</p><p>Your preview callback returns a Boolean value. It returns <code>true</code> if the callback successfully draws a custom file preview. If your preview callback returns <code>false</code>, Navigation Services displays the preview if the file contains a valid <code>pnot</code> resource. If your preview function returns <code>false</code> and a <code>pnot</code> resource is not available, Navigation Services displays a default icon preview. </p><p>You create a UPP to your preview callback by calling the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NewNavPreviewUPP" target="_top">NewNavPreviewUPP</a></code>.</p><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABBCHBH">Listing 2-7</a></span> shows a sample preview callback. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BABBCHBH" title="Listing 2-7A preview callback"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>A preview callback</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean myPreviewProc (NavCBRecPtr callBackParms,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NavCallBackUserData callBackUD )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       theErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     previewShowing = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    FSSpec      previewFileSpec;<span></span></pre></td></tr><tr><td scope="row"><pre>    Boolean     result = false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    theErr = NavCustomControl(callBackParms->context, <span>// 1</span></pre></td></tr><tr><td scope="row"><pre>                     kNavCtlIsPreviewShowing,<span></span></pre></td></tr><tr><td scope="row"><pre>                     &amp;previewShowing );<span></span></pre></td></tr><tr><td scope="row"><pre>    if (theErr == noErr &amp;&amp; previewShowing)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (( theErr = MyGetFSSpecInfo( <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>                (AEDesc*)callBackParms->eventData.eventDataParms.param,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;previewFileSpec )) == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            FInfo info;<span></span></pre></td></tr><tr><td scope="row"><pre>            if ((theErr = FSpGetFInfo(&amp;previewFileSpec,&amp;info)) == noErr) <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                Rect previewInfoButtonRect;<span></span></pre></td></tr><tr><td scope="row"><pre>                SetRect (&amp;previewInfoButtonRect, <span>// 4</span></pre></td></tr><tr><td scope="row"><pre>                        callBackParms->previewRect.left + 10,<span></span></pre></td></tr><tr><td scope="row"><pre>                        callBackParms->previewRect.bottom - 30,<span></span></pre></td></tr><tr><td scope="row"><pre>                        callBackParms->previewRect.right - 10,<span></span></pre></td></tr><tr><td scope="row"><pre>                        callBackParms->previewRect.bottom - 10 );<span></span></pre></td></tr><tr><td scope="row"><pre>                // Your code here to create the preview <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                // Use Quartz to draw the preview <span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>                result = true;<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return result;<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code> to obtain the value for <code>kNavCtlIsPreviewShowing</code>. You show a preview only if this value is <code>true</code>.</p></li><li class="li"><p>Calls the application-defined function <code>MyGetFSSpec</code> to obtain the file specification structure (<code>FSSpec</code>) for a given <code>AEDesc</code> record.</p></li><li class="li"><p>Calls the File Manager function <code><a href="../../../Reference/File_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/FSpGetFInfo" target="_top">FSpGetFInfo</a></code> to obtain the Finder information for the file.</p></li><li class="li"><p>Defines a rectangular area to display the preview.</p></li><li class="li"><p>This is where your application supplies its code to create and draw the preview into the preview rectangle.</p></li><li class="li"><p>When you draw the preview, you should use Quartz, not QuickDraw. See <span class="content_text"><a href="../../../../GraphicsImaging/Conceptual/drawingwithquartz2d/index.html#//apple_ref/doc/uid/TP30001066" target="_top">Drawing With Quartz 2D</a></span> for more information.</p></li><li class="li"><p>Sets <code>result</code> to true, to indicate that in the previous lines of code the preview control and its contents were successfully drawn and displayed.</p></li><li class="li"><p>Returns a Boolean value to indicate whether a preview was successfully shown (<code>true</code>) or not (<code>false</code>). If the function returns <code>false</code> and a <code>pnot</code> resource is not available, Navigation Services displays a generic icon.</p></li></ol><a name="//apple_ref/doc/uid/TP30001147-CH203-BABEBHAH" title="Controlling Settings in a Navigation Dialog"></a><h2>Controlling Settings in a Navigation Dialog</h2><p>You control various settings of the noncustom controls in an active dialog by calling the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code> and passing the appropriate control settings in the <code>selector</code> parameter and any associated values in the <code>parms</code> parameter. You call <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code> from within your event-handling callback function or your preview-drawing callback function. </p><p>When an event occurs in a dialog, Navigation Services calls your event-handling function, passing an event message in the <code>param</code> field of a <code>NavCBRec</code> data structure. In response, your application calls the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code>, but only if Navigation Services has already sent the <code>kNavCBStart</code> message to signal that a dialog is ready to be displayed. </p><p>When you call the function <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/doc/c_ref/NavCustomControl" target="_top">NavCustomControl</a></code>, pass a reference to the active Navigation Services dialog, a selector of type <code>NavCustomControlMessage</code> to specify what you want to set, and a pointer to the value to use as the setting. Not all selectors require a value. See <span class="content_text"><a href="../../../Reference/Navigation_Services_Ref/index.html#//apple_ref/doc/uid/TP30000240" target="_top">Navigation Services Reference</a></span> for a complete list of custom control setting constants (<code>NavCustomControlMessage</code>).</p><p><strong>Examples:</strong></p><p>To set the file browser list so it sorts by date:</p><div class="codesample"><table><tr><td scope="row"><pre>theErr = NavCustomControl(myDialogRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kNavCtlSortBy,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;kNavSortDateField);<span></span></pre></td></tr></table></div><p>To set the default location in the file browser list:</p><div class="codesample"><table><tr><td scope="row"><pre>theErr = NavCustomControl(myDialogRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kNavCtlSetLocation,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;locationDesc);<span></span></pre></td></tr></table></div><p>To set one of your custom menu items in the Show pop-up menu or the Format pop-up menu as the default selection:</p><div class="codesample"><table><tr><td scope="row"><pre>theErr = NavCustomControl(myDialogRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kNavCtlSelectCustomType,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;menuItem);<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP30001147-CH203-DontLinkElementID_12" title="Note"></a><p><strong>Note:</strong>&nbsp;You should always use the Navigation Services API to interact with Navigation Services dialogs and the controls within them. Do not use the Dialog Manager API for this purpose; it was always not recommended and it is not supported as of Mac OS X 10.3. It is also not recommended that you use the Control Manager or HIView APIs for interacting with Navigation Services dialogs.</p></div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABFIHEE" title="Adding Custom Items to a Navigation Dialog"></a><h2>Adding Custom Items to a Navigation Dialog</h2><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABEJFJC">Figure 2-4</a></span> shows a Save dialog that has a custom item for choosing the file format. Custom items always appear in a rectangle located above the Save/Open, Cancel buttons located in the dialog. You can add one or more custom items to a navigation dialog by performing these tasks:</p><ol class="ol"><li class="li"><p>Lay out the controls you want to add to the dialog. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIEIGAA">“Using Interface Builder to Lay Out Custom Items.”</a></span></p></li><li class="li"><p>Set up a Carbon event handler to respond to:</p><ul class="ul"><li class="li"><p>The customize event <code>kNavCBCustomize</code>, to which your application gets the controls you laid out and negotiates space for them in the dialog. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIIGHIJ">“Responding to the kNavCBCustomize Event.”</a></span></p></li><li class="li"><p>The start event <code>kNavCBStart</code>, to which your application adds the controls to the dialog. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIDFCBH">“Responding to the kNavCBStart Event.”</a></span></p></li><li class="li"><p>The adjust event <code>kNavCBAdjust</code>, to which your application redraws the controls or handles events beyond moving the controls. Keep in mind that Navigation Services moves controls automatically when the user resizes the dialog.</p></li></ul></li></ol><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABEJFJC" title="Figure 2-4A dialog with a custom File Format pop-up menu"></a><p><strong>Figure 2-4&nbsp;&nbsp;</strong>A dialog with a custom File Format pop-up menu</p><img src = "../art/figure3_4.gif" alt = "A dialog with a custom File Format pop-up menu" width="319" height="259"></div><br/><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIEIGAA" title="Using Interface Builder to Lay Out Custom Items"></a><h3>Using Interface Builder to Lay Out Custom Items</h3><p>The recommended way to create custom controls is for you to use Interface Builder. You create the controls graphically; you don’t need to write code to create them. If you use Xcode to write your application, you can easily launch Interface Builder from within Xcode. </p><p>You simply create a window in Interface Builder, drag a User Pane control from the Carbon-Enhanced Controls palette to the window, and then drag whatever controls you want from the palette to the window, making sure you place the controls on the User Pane control. Later, in your application, you’ll add the User Pane control to the navigation dialog. When you add the User Pane control in Interface Builder, you need to assign it a Control ID. From your application you refer to the User Pane control by its Control ID. </p><p><span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABCBHID">Figure 2-5</a></span> shows a window that contains controls. Although you can’t see the User Pane control, it is the same size as the window, and all other controls are placed over the User Pane control. The example is to show the variety of controls you can add, not to recommend that you add all these controls to a single navigation dialog. After you create a window with custom controls, you save the window as a nib file. Then access the nib file from within your code, as shown in the <code>MyHandleCustomizeEvent</code> function in <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABICGFE">Listing 2-8</a></span>. (For information on using Interface Builder and XCode, see <span class="content_text"><a href="../../../../DeveloperTools/index.html#//apple_ref/doc/uid/TP30000436" target="_top">Tools Documentation</a></span>.)</p><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABCBHID" title="Figure 2-5Controls created using Interface Builder"></a><p><strong>Figure 2-5&nbsp;&nbsp;</strong>Controls created using Interface Builder</p><img src = "../art/figure3_5.gif" alt = "Controls created using Interface Builder" width="386" height="259"></div><br/><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIIGHIJ" title="Responding to the kNavCBCustomize Event"></a><h3>Responding to the kNavCBCustomize Event</h3><p>You negotiate space for the controls you want to add to a dialog by responding to the <code>kNavCBCustomize</code> message in your event-handling callback. The <code>kNavCBCustomize</code> message signals your application to provide layout information in the <code>NavCBRec</code> data structure passed to your callback by Navigation Services. </p><p>The <code>customRect</code> field of the <code>NavCBRec</code> data structure passed to your event callback defines a rectangle in the local coordinates of the dialog. The top-left coordinates define the anchor point for a custom rectangle. To customize the dialog, you set a value in the <code>customRect</code> field that completes the dimensions of a custom rectangle. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABEJFJC">Figure 2-4</a></span> shows a dialog with a custom control for file format. The custom rectangle specifies the area in which the File Format label and pop-up menu reside. You must ensure that any items you add to a dialog follow the design and layout guidelines discussed in <em><a href="../../../../UserExperience/Conceptual/AppleHIGuidelines/index.html#//apple_ref/doc/uid/20000957" target="_top">Apple Human Interface Guidelines</a></em>.</p><p>After you set the dimensions of the custom rectangle, Navigation Services determines if the requested dimensions result in a dialog that can fit on the screen. If the dimensions are too large, then Navigation Services sets the rectangle to the largest size that the screen can accommodate and sends your event callback another <code>kNavCBCustomize</code> message. Your application can continue to negotiate by examining the <code>customRect</code> field and requesting a different size until Navigation Services provides an acceptable rectangle value, at which time you create your custom control or item list. The minimum size for the custom area is 400 pixels wide by 40 pixels high.</p><p>The <code>MyHandleCustomizeEvent</code> function in <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABICGFE">Listing 2-8</a></span> is called from within an event callback in response to the <code>kNavCBCustomize</code> message. The code shows how to unarchive a window, created in Interface Builder, that contains custom controls to add to a navigation dialog. The function calculates the size of the rectangle needed to accommodate the custom controls, and negotiates with Navigation Services for the space. Navigation Services repeatedly sends the <code>kNavCBCustomize</code> message to your event callback until you’ve successfully negotiated a rectangle of an appropriate size. <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABEHFCH">Figure 2-6</a></span> shows the dialog that results from adding the custom controls shown in <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BABCBHID">Figure 2-5</a></span> using the code in <span class="content_text">Listing 2-8</span>. A detailed explanation for each numbered line of code appears following the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BABICGFE" title="Listing 2-8Negotiating space for a custom area in a navigation dialog"></a><p class="codesample"><strong>Listing 2-8&nbsp;&nbsp;</strong>Negotiating space for a custom area in a navigation dialog</p><div class="codesample"><table><tr><td scope="row"><pre>void MyHandleCustomizeEvent (NavCBRecPtr callBackParms, CustomData *data)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status;<span></span></pre></td></tr><tr><td scope="row"><pre>    SInt16 neededHeight, neededWidth;<span></span></pre></td></tr><tr><td scope="row"><pre>    static SInt16 gCarbonEventLastTryHeight;<span></span></pre></td></tr><tr><td scope="row"><pre>    static SInt16 gCarbonEventLastTryWidth;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (data->nibRef == NULL)<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        status = CreateNibReference(CFSTR("AddNibToNav"),<span></span></pre></td></tr><tr><td scope="row"><pre>                                 &amp;data->nibRef);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>        // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>        status = CreateWindowFromNib (data->nibRef, CFSTR("Custom Area"),<span></span></pre></td></tr><tr><td scope="row"><pre>                             &amp;data->windowFromNib);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>        // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>        // You dispose of the nib reference after you handle the<span></span></pre></td></tr><tr><td scope="row"><pre>        // event kNavCBStart, which is in another function<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect windowBounds;<span></span></pre></td></tr><tr><td scope="row"><pre>    GetWindowPortBounds(data->windowFromNib, &amp;windowBounds);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    neededHeight = callBackParms->customRect.top + <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        (windowBounds.bottom - windowBounds.top);<span></span></pre></td></tr><tr><td scope="row"><pre>    neededWidth = callBackParms->customRect.left + <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>                        (windowBounds.right - windowBounds.left);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ((callBackParms->customRect.right == 0) &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>                     (callBackParms->customRect.bottom == 0))<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        callBackParms->customRect.right = neededWidth;<span></span></pre></td></tr><tr><td scope="row"><pre>        callBackParms->customRect.bottom = neededHeight;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>        if (gCarbonEventLastTryWidth != callBackParms->customRect.right)<span></span></pre></td></tr><tr><td scope="row"><pre>            if (callBackParms->customRect.right &lt; neededWidth)<span></span></pre></td></tr><tr><td scope="row"><pre>                    // Your code here to respond to situation<span></span></pre></td></tr><tr><td scope="row"><pre>        if (gCarbonEventLastTryHeight != callBackParms->customRect.bottom)<span></span></pre></td></tr><tr><td scope="row"><pre>                if (callBackParms->customRect.bottom &lt; neededHeight)<span></span></pre></td></tr><tr><td scope="row"><pre>                    // Your code here to respond to situation<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    gCarbonEventLastTryWidth = callBackParms->customRect.right;<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    gCarbonEventLastTryHeight = callBackParms->customRect.bottom;<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Checks to see if the nib reference is <code>NULL</code>. You need to keep track of whether or not the nib reference is created because you only need to create the nib reference once. The customization function can, however, be called many times to negotiate the space needed for your custom controls.</p></li><li class="li"><p>Calls the Interface Builder Services function <code><a href="../../../Reference/Interface_Builder/Reference/reference.html#//apple_ref/doc/c_ref/CreateNibReference" target="_top">CreateNibReference</a></code> to create a reference to a nib file in the current application bundle. You pass the name of the nib file without the <code>.nib</code> extension. </p></li><li class="li"><p>Calls the Interface Builder Services function <code><a href="../../../Reference/Interface_Builder/Reference/reference.html#//apple_ref/doc/c_ref/CreateWindowFromNib" target="_top">CreateWindowFromNib</a></code> to unarchive the window from the nib file. You pass a reference to the nib file and the window name—Custom Area. This is the window name you specified in Interface Builder when you created the custom controls.</p></li><li class="li"><p>Gets the bounds of the window created from the nib file.</p></li><li class="li"><p>Sets the needed height to accommodate the bounds of the window created from the nib file.</p></li><li class="li"><p>Sets the needed width to accommodate the bounds of the window created from the nib file.</p></li><li class="li"><p>Checks to see if this is the first round of negotiations. If the rectangle height and width are each 0, then this is the first round. If it is the first round of negotiations, set the rectangle width and height to what you calculated. Ideally, the width and height you request will be provided by Navigation Services. If it isn’t, your callback is called again, and the <code>else</code> clause (see next step) is executed.</p></li><li class="li"><p>If this is not the first round of negotiations, checks to see if the width specified by Navigation Services is too small, and responds accordingly. Then checks to see if the height specified by Navigations Services is too small, and responds accordingly. </p><p>How your application responds depends on the strategies you’ve implemented. For example, you could have two layouts for the controls–one that uses small controls and another that uses larger controls. If Navigation Services can’t provide enough space for the large layout, you could substitute the smaller layout. You could also not provide custom controls if there is not enough space. Ideally, when you lay out your controls, you’ll make sure that your controls will always fit into the allotted space. If you add only one control, such as a File Format pop-up, you are likely to obtain a rectangle large enough for the control.</p></li><li class="li"><p>Saves the width for the next round of negotiations.</p></li><li class="li"><p>Saves the height for the next round of negotiations.</p></li></ol><br/><div><a name="//apple_ref/doc/uid/TP30001147-CH203-BABEHFCH" title="Figure 2-6A navigation dialog with custom controls"></a><p><strong>Figure 2-6&nbsp;&nbsp;</strong>A navigation dialog with custom controls</p><img src = "../art/figure3_6.gif" alt = "A navigation dialog with custom controls" width="418" height="370"></div><br/><a name="//apple_ref/doc/uid/TP30001147-CH203-BEIDFCBH" title="Responding to the kNavCBStart Event"></a><h3>Responding to the kNavCBStart Event</h3><p>After you application successfully negotiates the space it needs for its custom area, Navigation Services sends your event handler the event <code>kNavCBStart</code>. In response, you should call your function to add the custom area to the dialog. <span class="content_text">Listing 2-9</span> shows a function (<code>MyHandleCarbonStartEvent</code>) that adds a User Pane control created in Interface Builder to a navigation dialog. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30001147-CH203-BEICDGIJ" title="Listing 2-9Adding custom items to a navigation dialog"></a><p class="codesample"><strong>Listing 2-9&nbsp;&nbsp;</strong>Adding custom items to a navigation dialog</p><div class="codesample"><table><tr><td scope="row"><pre>void MyHandleCarbonStartEvent (NavCBRecPtr callBackParms,<span></span></pre></td></tr><tr><td scope="row"><pre>                        CustomData *data)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ControlID userPaneID = {'usrp', 100 };<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    HIViewRef userPane;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>    status = HIViewFindByID (HIViewGetRoot(data->windowFromNib), <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>                                    userPaneID,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;userPane);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>    if (GetHIToolboxVersion() &lt; 0x130)<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        ControlRef rootControl;<span></span></pre></td></tr><tr><td scope="row"><pre>        status = GetRootControl(callBackParms->window, &amp;rootControl);<span></span></pre></td></tr><tr><td scope="row"><pre>        // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>        status = EmbedControl(userPane, rootControl);<span></span></pre></td></tr><tr><td scope="row"><pre>        // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    status = NavCustomControl(callBackParms->context, <span>// 5</span></pre></td></tr><tr><td scope="row"><pre>                        kNavCtlAddControl,<span></span></pre></td></tr><tr><td scope="row"><pre>                        userPane);<span></span></pre></td></tr><tr><td scope="row"><pre>    // Your error checking code here<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeWindow(data->windowFromNib);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>    DisposeNibReference(data->nibRef);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    data->nibRef = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declares a <code>ControlID</code> variable for the User Pane control. You use the same <code>ControlID</code> values that you used in Interface Builder when you created the layout for your controls.</p></li><li class="li"><p>Declares an <code>HIViewRef</code> variable to use for the User Pane control.</p></li><li class="li"><p>Obtains the User Pane control by calling the HIView function <code>HIViewGetRoot</code>, supplying the window that you obtained previously (see<span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIIGHIJ">“Responding to the kNavCBCustomize Event”</a></span>and the <code>ControlID</code> value.</p></li><li class="li"><p>Checks for HIToolbox version. If the version is earlier than Mac OS X v. 10.3, you need to move the User Pane control (which includes the controls you placed in it) from the nib window to the Navigation Services dialog. In Mac OS X v. 10.3 and later you don't need to explicitly move the User Pane control. It’s taken care of automatically in the next step.</p></li><li class="li"><p>Calls the function <code>NavCustomControl</code> to add the User Pane control (and its embedded controls) to the dialog. You pass the <code><a href="../../../Reference/Navigation_Services_Ref/Reference/reference.html#//apple_ref/c/tdef/NavDialogRef" target="_top">NavDialogRef</a></code> value obtained from the <code>context</code> field of the <code>NavCBRec</code> structure specified in the <code>callBackParms</code> parameter of your event-handling function. The constant <code>kNavCtlAddControl</code> specifies to move the User Pane control from the nib window to the Navigation Services dialog.</p></li><li class="li"><p>Disposes of the window created from the nib file. You created this in your <code>MyHandleCustomizeEvent</code> function. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIIGHIJ">“Responding to the kNavCBCustomize Event.”</a></span></p></li><li class="li"><p>Disposes of the nib reference. You created this in your <code>MyHandleCustomizeEvent</code> function. See <span class="content_text"><a href="nsx_tasks.html#//apple_ref/doc/uid/TP30001147-CH203-BEIIGHIJ">“Responding to the kNavCBCustomize Event.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30001147-CH203-DontLinkElementID_8" title="See Also"></a><h2>See Also</h2><p>For an example of how to use Navigation Services within a fully-functioning application, see the file <code>NavServicesHandling.c</code> in the sample application <em><a href="../../../../../samplecode/CGDrawPicture/index.html#//apple_ref/doc/uid/DTS10000490" target="_top">CGDrawPicture</a></em></p><p>You can download the sample code if you want to experiment with it to see how changing various parameters affect the output.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../nsx_concepts/nsx_concepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../nsx_rev_hx/ns_rev_hx.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ProvidingNavigationDialogs/nsx_tasks/nsx_tasks.html%3Fid%3DTP30001147-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ProvidingNavigationDialogs/nsx_tasks/nsx_tasks.html%3Fid%3DTP30001147-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ProvidingNavigationDialogs/nsx_tasks/nsx_tasks.html%3Fid%3DTP30001147-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>