<html><head><title>Mac OS X
 Manual Page For bootpd(8)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/8/bootpd" title="Mac OS X
 Manual Page for bootpd(8)"><!-- headerDoc=man; indexgroup=Section 8; uid="//apple_ref/doc/man/8/bootpd"; name=bootpd(8) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
BOOTPD(8)                 BSD System Manager's Manual                BOOTPD(8)

<b>NAME</b>
     <b>bootpd</b> -- DHCP/BOOTP/NetBoot server

<b>SYNOPSIS</b>
     <b>bootpd</b> <u>[options]</u>

<b>DESCRIPTION</b>
     <b>bootpd</b> implements a DHCP/BOOTP server as defined in RFC951, RFC1542, RFC2131, and RFC2132, as well as a
     BOOTP/DHCP relay agent.  It is also a NetBoot server implementing Apple-proprietary NetBoot 1.0 (BOOTP-<font color="#ffffff" class="whiteout">based)&nbsp;(BOOTPbased)</font>
     based) and NetBoot 2.0 BSDP (Boot Server Discovery Protocol).  BSDP works along with regular DHCP,
     using DHCP-format packets with a special vendor-class identifier and vendor-specific options.

     <b>bootpd</b> understands and handles requests that arrive via a DHCP/BOOTP relay agent, allowing the server
     to be centrally located, and serve many remote subnets.

     The server is normally invoked by <!-- a -->xinetd(8)<!-- /a --> when a request arrives, but can also be invoked manually.
     If it is invoked by <!-- a -->xinetd(8)<!-- /a -->, <b>bootpd</b> continues to service requests until it is idle for a period of 5
     minutes, after which it exits to conserve system resources.  If invoked manually, <b>bootpd</b> continues to
     run indefinitely.

     If <b>bootpd</b> receives a SIGHUP (-1) signal, it will re-read its configuration and client binding files.

     When a request from a client arrives, the server logs an entry to <u>/var/log/system.log</u> indicating which
     client made the request, and logs another entry once a reply is sent.  This feature can be turned off
     using the <b>-q</b> option described below.

     <b>bootpd</b> reads its configuration settings from <u>/etc/bootpd.plist</u>.  There are also a number of command-<font color="#ffffff" class="whiteout">line&nbsp;commandline</font>
     line options to change its behavior on the fly.  Note in particular that options <b>DmNrS</b> can also be con-<font color="#ffffff" class="whiteout">trolled&nbsp;controlled</font>
     trolled via service-control properties.  See Service Controls and Filters below.

<b>OPTIONS</b>
     <b>-B</b>      Disable BOOTP service.  BOOTP is now disabled by default, so specifying this option has no
             effect.

     <b>-b</b>      Only respond if the client's bootfile exists: for BOOTP clients only.

     <b>-D</b>      Enable DHCP service.  By default, DHCP service is disabled.

     <b>-d</b>      Remain in the foreground and produce extra debugging output to stderr.

     <b>-I</b>      Disable re-initialization on IP address changes.  By default, changes to the server's config-<font color="#ffffff" class="whiteout">ured&nbsp;configured</font>
             ured IP addresses cause it to re-initialize.

     <b>-i</b> <u>interface</u>
             Enable service on the specified interface.  This flag may appear multiple times to enable mul-<font color="#ffffff" class="whiteout">tiple&nbsp;multiple</font>
             tiple interfaces.   For example,
                 bootpd -i en0 -i en1
             forces <b>bootpd</b> to respond only to requests received on ethernet ports en0 and en1.  By default,
             all interfaces are enabled.

     <b>-m</b>      Enable NetBoot 1.0 (BOOTP-based) service.

     <b>-N</b>      Enable NetBoot 2.0 (BSDP/DHCP-based) service.

     <b>-o</b> <u>hop</u><b>_</b><u>count</u>
             For relay agent operation, the maximum hop count, default is 4 hops.

     <b>-q</b>      Be quiet as possible.  Only report serious errors to

     <b>-r</b> <u>server</u><b>_</b><u>ip</u>
             Relay packets to the specified server_ip, not exceeding the hop count.  This option can be
             specified multiple times, one for each server to relay to.

     <b>-S</b>      Enable BOOTP service.

     <b>-v</b>      Be more verbose in messages logged to <u>/var/log/system.log</u>.

<b>CONFIGURING</b> <b>BOOTPD</b>
     <b>bootpd</b> reads its configuration from <u>/etc/bootpd.plist</u>, an XML property list.  The root of the property
     list is a dictionary.  The property list has three main areas:

     Root dictionary  Service Controls and Filters

     Subnets          Subnet Entries

     NetBoot          NetBoot Server Controls

   <b>Service</b> <b>Controls</b> <b>and</b> <b>Filters</b>
     The root dictionary in <u>/etc/bootpd.plist</u> contains properties to control whether <b>bootpd</b> will respond to
     a particular request,   There are MAC address filters, DHCP controls, as well as controls to enable
     services.

     The MAC address filter properties are:

     <b>allow</b>  (Array of String) Enables servicing a list of MAC addresses.

     <b>deny</b>   (Array of String) Disables servicing a list of MAC addresses.

     When a packet arrives, <b>bootpd</b> checks whether the client's MAC address is in the deny list.  If it is,
     the packet is dropped.  Otherwise, if the client's MAC address is in the allow list, the packet contin-<font color="#ffffff" class="whiteout">ues&nbsp;continues</font>
     ues to be processed, otherwise it is dropped.  If neither the allow nor the deny property is specified,
     the packet continues to be processed.

     The service-control properties are:

     <b>bootp_enabled</b>        Enables BOOTP on the specified list of interfaces.

     <b>dhcp_enabled</b>         Enables DHCP on the specified list of interfaces.

     <b>netboot_enabled</b>      Enables NetBoot 2.0 (BSDP/DHCP-based) NetBoot on the specified list of interfaces.

     <b>old_netboot_enabled</b>  Enables NetBoot 1.0 (BOOTP-based) NetBoot on the specified list of interfaces.

     <b>relay_enabled</b>        Enables the relay agent on the specified list of interfaces.  Note that this
                          option also requires the <b>relay_ip_list</b> property to be specified.

     For each of the properties dhcp_enabled, bootp_enabled, old_netboot_enabled, netboot_enabled, and
     relay_enabled, the corresponding service can be enabled or disabled for all interfaces, or enabled for
     just a specific set of interfaces.  To enable or disable globally, use a <u>boolean</u> value <u>true</u> or <u>false</u>
     respectively.  To enable just for a specific set of interfaces, use either a string, for a single
     interface, or an array of strings, one element for each interface.

     For example, to enable DHCP on interfaces en0 and en1, disable BOOTP on all interfaces, enable NetBoot
     on en1, and enable relay agent on interface en1, <u>/etc/bootpd.plist</u> could contain:
     &lt;?xml version="1.0" encoding="UTF-8"?&gt;
     &lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "<a href="http://www.apple.com/DTDs/PropertyList-1.0.dtd">http://www.apple.com/DTDs/PropertyList-1.0.dtd</a>"&gt;
     &lt;plist version="1.0"&gt;
     &lt;dict&gt;
             &lt;key&gt;bootp_enabled&lt;/key&gt;
             &lt;false/&gt;
             &lt;key&gt;dhcp_enabled&lt;/key&gt;
             &lt;array&gt;
                     &lt;string&gt;en0&lt;/string&gt;
                     &lt;string&gt;en1&lt;/string&gt;
             &lt;/array&gt;
             &lt;key&gt;netboot_enabled&lt;/key&gt;
             &lt;string&gt;en1&lt;/string&gt;
             &lt;key&gt;relay_enabled&lt;/key&gt;
             &lt;array&gt;
                     &lt;string&gt;en1&lt;/string&gt;
             &lt;/array&gt;
     &lt;/dict&gt;
     &lt;/plist&gt;

     Some additional properties are:

     <b>relay_ip_list</b>             (Array of String) If relay agent functionality is enabled (see <b>relay_enabled</b>
                               above), this property contains the list of IP addresses to relay the packet
                               to.

     <b>detect_other_dhcp_server</b>  (Boolean) If this property is set to true, <b>bootpd</b> calls exit() if it detects
                               that another DHCP server is present on one of the interfaces that DHCP is
                               enabled on.  The default value is false.

     <b>reply_threshold_seconds</b>   (Integer) <b>bootpd</b> won't respond to the request until the bp_secs field is at
                               least <u>reply</u><b>_</b><u>theshold</u><b>_</b><u>seconds</u>.  The default value is 0 (zero).

     <b>use_open_directory</b>        (Boolean) If this property is set to true, <b>bootpd</b> will look for static IP
                               address to ethernet address bindings in <b>Open</b> <b>Directory</b>.  The default value is
                               true.

     <b>dhcp_ignore_client_identifier</b>
                               (Boolean) If this property is set to true, the DHCP server tries to ignore
                               the DHCP client identifier option (code 61) in the client's DHCP packet.
                               Instead, the DHCP server tries to use the hardware address fields (bp_htype,
                               bp_hlen, bp_chaddr) of the DHCP packet to identify the client.  The default
                               value of this property is false.

   <b>Subnet</b> <b>Entries</b>
     The "Subnets" property in <u>/etc/bootpd.plist</u> contains an array of dictionaries, each dictionary corre-
     sponds to a single subnet entry.

     A subnet entry describes a range of IP addresses, and associated information, such as the subnet mask,
     router, DNS servers, and other option data.  A subnet entry also indicates whether the range is an
     address pool from which to allocate vs. simply an informational range in order to fulfill requests for
     option information.  The informational range is used when the client's IP address binding is static, or
     the client knows its own IP address and simply wants relevant option information.

     A subnet entry is required to supply the DHCP service with <!-- a -->pool(s)<!-- /a --> of IP address(es), and to inform the
     server of subnet-specific options and parameters.  A subnet entry can also be used to convey network
     topology information via the <b>supernet</b> property described below.

     Subnet entries may not overlap in the IP ranges the describe, nor specify values that are inconsistent.
     Specifically, applying the <b>net_mask</b> value to each of the values in the <b>net_range</b> must yield the
     <b>net_address</b> value.

     Errors in configuration are logged to <u>/var/log/system.log</u>.  There may be multiple entries for a given
     subnet, allowing different configuration values to be specified for a given sub-range of IP addresses
     within the subnet.  For example, part of the range might be used for statically bound clients, and
     another for a dynamic address pool.

     Each subnet entry is encoded as a dictionary with the following properties:

     <b>name</b>          (String) A descriptive name for the subnet, e.g. "17.202.40/22".

     <b>net_mask</b>      (String) The network mask, e.g. "255.255.252.0".  This property is required.

     <b>net_address</b>   (String) The network address, e.g. "17.202.40.0".  This property is required.

     <b>net_range</b>     (Array of String) The network address range stored as two values: the first IP address
                   and the last IP address.  For example:
                        &lt;array&gt;
                             &lt;string&gt;17.202.40.2&lt;/string&gt;
                             &lt;string&gt;17.202.43.254&lt;/string&gt;
                        &lt;/array&gt;
                   This property is required.

     <b>allocate</b>      (Boolean) Indicates whether the DHCP service should allocate IP addresses from the range
                   specified by <b>net_range</b>.  A <u>true</u> value means allocate IP addresses, otherwise, the subnet
                   entry is informational only.

     <b>lease_min</b>     (Integer) The minimum allowable lease time (in seconds). This property is ignored unless
                   <b>allocate</b> specifies <u>true</u>.  Default value is 3600 (one hour).

     <b>lease_max</b>     (Integer) The maximum allowable lease time (in seconds). This property is ignored unless
                   <b>allocate</b> specifies <u>true</u>.  Default value is 3600 (one hour).

     <b>supernet</b>      (String) This property indicates that the subnet is on the same physical broadcast domain
                   as other subnets with the same supernet value.

     The server can also supply clients with the following DHCP option information:

     <b>dhcp_router</b>   The IP address of the default router (DHCP option code 3).  If this property is not
                   present, the server will attempt to provide its own default route for this option, if it
                   is applicable.

     <b>dhcp_domain_name_server</b>
                   The IP address(es) of the DNS <!-- a -->server(s)<!-- /a --> (option code 6).  If this property is not
                   present, the server will supply its own DNS server configuration (if available).

     <b>dhcp_domain_name</b>
                   The default DNS domain name (option code 15).  If this property is not present, the
                   server will supply its own default domain name (if available).

     <b>dhcp_domain_search</b>
                   The domain search list (option code 119).  If this property is not present, the server
                   will supply its domain search list (if available).

     <b>dhcp_ldap_url</b>
                   The default LDAP URL (option code 95).

     <b>dhcp_netinfo_server_address</b>
                   The NetInfo parent server IP address(es) (option code 112).

     <b>dhcp_netinfo_server_tag</b>
                   The NetInfo parent domain tag (option code 113).

     <b>dhcp_url</b>      The default URL to present in a web browser (option code 114).

     <b>dhcp_time_offset</b>
                   The time offset from GMT in seconds (option code 2).

     <b>dhcp_network_time_protocol_servers</b>
                   The network time protocol (NTP) server IP address(es) (option code 42).

     <b>dhcp_nb_over_tcpip_name_server</b>
                   The NetBIOS over TCP/IP name server IP address(es) (option code 44).

     <b>dhcp_nb_over_tcpip_dgram_dist_server</b>
                   The NetBIOS over TCP/IP datagram distribution server IP address(es) (option code 45).

     <b>dhcp_nb_over_tcpip_node_type</b>
                   The NetBIOS over TCP/IP node type (option code 46).

     <b>dhcp_nb_over_tcpip_scope</b>
                   The NetBIOS over TCP/IP scope string (option code 47).

     <b>dhcp_smtp_server</b>
                   The Simple Mail Transport Protocol (SMTP) server IP address(es) (option code 69).

     <b>dhcp_pop3_server</b>
                   The Post Office Protocol (POP3) server IP address(es) (option code 70).

     <b>dhcp_nntp_server</b>
                   The Network News Transport Protocol (NNTP) server IP address(es) (option code 71).

     <b>dhcp_proxy_auto_discovery_url</b>
                   The default Web Proxy Auto Discovery URL (option code 252).

     DHCP options may also be specified using the naming convention:
          dhcp_option_<u>option</u><b>_</b><u>code</u>
     replacing <u>option</u><b>_</b><u>code</u> with a numeric value in the range of 1 through 254.  For example, to specify
     option code 128, specify a property named <b>dhcp_option_128</b>.

     <b>bootpd</b> has a built-in type conversion table for many more options, mostly those specified in RFC 2132,
     and will try to convert from whatever type the option appears in the property list to the binary,
     packet format.  For example, if <b>bootpd</b> knows that the type of the option is an IP address or list of IP
     addresses, it converts from the string form of the IP address to the binary, network byte order numeric
     value.

     If the type of the option is a numeric value, it converts from string, integer, or boolean, to the
     proper sized, network byte-order numeric value.

     Regardless of whether <b>bootpd</b> knows the type of the option or not, you can always specify the DHCP
     option using the <u>data</u> property list type  e.g.:
          &lt;string&gt;dhcp_option_128&lt;/string&gt;
          &lt;data&gt;
          AAqV1Tzo
          &lt;/data&gt;

   <b>NetBoot</b> <b>Server</b> <b>Controls</b>
     The "NetBoot" property in <u>/etc/bootpd.plist</u> is encoded as a dictionary, and may contain a number of
     properties that alter the NetBoot server's default behavior.  The properties are:

     <b>afp_uid_start</b>        (Integer) The starting uid used when creating AFP machine users. The default is
                          uid 100.

     <b>afp_users_max</b>        (Integer) The number of AFP machine users to automaticaly create.  The default is
                          50.  Note: the server will never remove a user once it is created, so decreasing
                          this value once the server has read it will have no effect.

     <b>age_time_seconds</b>     (Integer) The number of seconds since the client last netbooted before before the
                          client is considered "aged".  A client that has aged becomes
                           available for resource reclamation.  The server will only reclaim aged client
                          bindings when it runs out of free resources.

     <b>machine_name_format</b>  (String) This property is used to generate a unique name to each NetBoot client.
                          The default value is "NetBoot%03d" (without the double quotes).  The format string
                          must be a <a href="../man3/printf.3.html#//apple_ref/doc/man/3/printf">printf(3)</a> compatible format string that takes a single integer value as
                          an argument.  The server ensures that the string is valid by testing the string
                          before using it.  The only conversion specifiers that should be used are <b>diouxX</b>.

     <b>shadow_size_meg</b>      (Integer) The size (in megabytes) to allocate for the client shadow file.  The
                          default is 48 (megabytes).  See Diskless Resources below.

<b>BOOTP/DHCP</b> <b>STATIC</b> <b>BINDINGS</b>
     Static IP address to ethernet address bindings are stored in the <u>/etc/bootptab</u> file and in <b>Open</b> <b>Direc</b>-
     <b>tory</b>.  Bindings specified in the <u>/etc/bootptab</u> file take precedence over those in <b>Open</b> <b>Directory</b>.

     See <a href="../man5/bootptab.5.html#//apple_ref/doc/man/5/bootptab">bootptab(5)</a> for more information about the <u>/etc/bootptab</u> file.

     For <b>Open</b> <b>Directory</b>, <b>bootpd</b> looks at the /Computers records for the following properties:

     <b>ENetAddress</b>              (String) The ethernet MAC address(es) of the computer.  Each address must be
                              of the form xx:xx:xx:xx:xx:xx using only the characters 0123456789abcdef.
                              Leading zeros must be specified.

     <b>IPAddress</b>                (String) The IP address(es) of the computer.

     <b>IPAddressAndENetAddress</b>  (String) Pairs of IP and Ethernet MAC addresses of the computer.  Each address
                              pair consists of an single IP and MAC address separated by a slash character,
                              e.g. "192.168.1.1/01:23:45:67:89:ab".  This attribute should be provided when
                              multiple addresses are provided because not all directories return attribute
                              values in a guaranteed order.

     <b>BootFile</b>                 (String) The bootfile to use for this computer.

<b>DHCP</b> <b>SERVICE</b>
     If DHCP service is enabled for a client, the server processes the client's packet.  The packet may be a
     request for an IP address and option information (DHCP Discover, DHCP Request) or for just option
     information (DHCP Inform).  The packet might also tell the server that the address is in use by some
     other host (DHCP Decline), or that the client is done with the IP address (DHCP Release).

     The server uses the DHCP client identifier (option 61) if it is present as the unique client identi-
     fier, otherwise it uses the htype/hlen/chaddr fields in the DHCP packet.

   <b>IP</b> <b>Allocation</b>
     The DHCP server first tries to find a static binding for the client (see section BOOTP/DHCP STATIC
     BINDINGS above).  If one exists, it uses it.  If not, it tries to find an existing dynamic binding from
     its lease database, stored in /var/db/dhcpd_leases.  If one exists and it is applicable to the subnet,
     the server uses it, otherwise, it tries to allocate an address from one of its address pools.  If an
     address is available, the server uses it, otherwise the packet is discarded.

     After a suitable IP address is found for the client, the server attempts to insert as many of the
     requested DHCP options from the client's request as it can into the reply.

     When the server allocates an address dynamically, it automatically excludes addresses that appear in
     static host entries.  For example, if the address range goes from 10.0.0.2 through 10.0.0.10, but there
     is a static entry that specifies 10.0.0.3, that address is automatically excluded from the pool.

     The server tries to give the same address back to a client by remembering the binding even after it has
     expired.  The server removes an expired lease entry only when it runs out of addresses, and needs to
     reclaim an address in order to fulfill a new request.

     When the server receives a DHCP Release packet, it sets the expiration for that lease to now, so that
     it can immediately reclaim the address if needed.

     When the server receives a DHCP Decline packet, it removes the client binding from the IP address, and
     sets the expiration on the "unbound" lease to 10 minutes from now.  That allows the address to return
     to the address pool again without manual intervention and avoids handing out the same in-use IP address
     over and over.

<b>NETBOOT</b> <b>SERVICE</b>
     The NetBoot server enables a client to perform a network boot, that is, access its operating system
     image over the network instead of from its local drive.

     The sequence of events that occur when a NetBoot client is powered are:

     1.    firmware gets IP address and image information (using BOOTP, or BSDP/DHCP)

     2.    firmware saves relevant <!-- a -->packet(s)<!-- /a --> in memory to be used by client operating system (see step 4
           below)

     3.    firmware TFTP's the bootfile image, and begins executing it

     3.1.  (Mac OS X only) secondary loader TFTP's kernel and drivers, and begins executing the kernel

     4.    client operating system initializes its network stack and accesses its "root" disk using informa-
           tion in packets saved at step 2, uses AFP, NFS, or HTTP to access the image

     Apple NetBoot uses a technique called "shadowing", whereby an otherwise read-only disk image appears to
     the client as a read/write image by "mapping" writes to the original image file to an auxilliary
     "shadow" file.  Subsequent reads from portions that have been written also come from the "shadow" file.
     The disk image driver in the client operating system manages the shadow mapping and provides the illu-
     sion of a writable disk.

     The term diskless NetBoot implies that the client receives all of its necessary booting resources from
     the network, so that a local disk drive is not required, though may still be present.

     The NetBoot server supplies a NetBoot client with the resources and information it needs to boot.  Two
     versions of NetBoot are supported: NetBoot 1.0 (BOOTP-based) and NetBoot 2.0 (BSDP/DHCP-based).  Ser-
     vice for these two types of NetBoot are controlled individually using command-line options <b>m</b> and <b>N</b>, or
     using the service configuration properties <b>old_netboot_enabled</b> and <b>netboot_enabled</b> (described above).

     The NetBoot 1.0 server supplies the client with its IP address in addition to its boot resources.  The
     server must be able to find a static binding for the client (see BOOTP/DHCP STATIC BINDINGS above), or
     the server must have an applicable dynamic pool of IP addresses, just as with DHCP.  If the server does
     not also have DHCP service enabled, the pools are only used for NetBoot 1.0 clients.  In this case, the
     server also acts as a DHCP server but only services those clients for which it has an existing binding.

     There can only be one NetBoot 1.0 server per subnet because the protocol uses BOOTP, and BOOTP does not
     support multiple servers.  However, the NetBoot 1.0 server will co-exist with an existing DHCP server,
     assuming it only serves DHCP.

     The NetBoot 2.0 server only supplies the client with boot resources.  Unlike NetBoot 1.0, there is no
     limit on the number of NetBoot servers per subnet.

     The NetBoot server stores a list of NetBoot client records in the file /var/db/bsdpd_clients.  Each
     client record contains the client name and number assigned by the server, the boot image ID selected by
     the client, and the client's last boot time.

   <b>NetBoot</b> <b>Image</b> <b>Location</b>
     When the NetBoot server initializes, it looks for NetBoot images at well-known locations in the file
     system.  A "NetBoot image" is a directory that ends in the .nbi extension, and contains a valid set of
     files (described below).  If no images are found, NetBoot is temporarily disabled.  If it receives a
     SIGHUP signal, the server again attempts to initialize itself.

     The NetBoot server looks for a symbolic link named:

         Library/NetBoot/.sharepoint

     at the root of each local volume.  If the symlink is valid, and points to a directory, it assumes that
     the directory contains NetBoot images and that the contents are accessible via TFTP, AFP, NFS, and
     HTTP.  By convention, the directory is named:

         Library/NetBoot/NetBootSPx

     where x is a unique number starting at zero (0).

   <b>NetBoot</b> <b>Image</b> <b>(.nbi)</b>
     A NetBoot Image is stored in a directory whose name ends with .nbi, and contains a set of files.  The
     directory must contain an NBImageInfo.plist file, one or more bootfiles, and may contain one or more
     image files.  The NBImageInfo.plist file is encoded as an XML property list, and contains information
     about the image.

     The properties defined in the NBImageInfo.plist file and their meanings are:

     <b>Name</b>              (String) The name of the image that appears in the Startup Disk UI.

     <b>BootFile</b>          (String) The path of the first bootfile, relative to either the .nbi directory (for
                       architecture "ppc" only), or a sub-directory of the .nbi directory.  The sub-direc-
                       tory names correspond to the <b>Architectures</b> that the NetBoot Image supports.  See also
                       the <b>Architectures</b> property below.

     <b>IsEnabled</b>         (Boolean) A flag to mark the image as enabled or not.  An image that is disabled will
                       not be offered as a selection by the NetBoot server. Optional, default value is true.

     <b>IsDefault</b>         (Boolean) A flag to mark the image as a default image.  Setting this key to true for
                       more than one image can be useful if the <b>EnabledSystemIdentifiers</b> property is also
                       defined (see below).  Optional, default value is false.

     <b>IsInstall</b>         (Boolean) A flag to indicate that the image describes an installation image.
                       Optional, default value is false.

     <b>Type</b>              (String) The expected image contents and the mechanism used to supply images to the
                       client.  The defined values are:

                       Classic       After downloading the boot file via TFTP, the client OS accesses its
                                     images via AFP.  The <b>SharedImage</b> and <b>PrivateImage</b> properties (defined
                                     below) specify the images to use.

                       NFS           After downloading the boot files via TFTP, the client OS accesses its
                                     "root" filesystem via NFS.  The <b>RootPath</b> property (detailed below)
                                     specifies the path.

                       HTTP          After downloading the boot files via TFTP, the client accesses its
                                     "root" filesystem via HTTP.  The <b>RootPath</b> property (detailed below)
                                     specifies the path.

                       BootFileOnly  The client downloads the boot <!-- a -->file(s)<!-- /a -->, and does not require any addi-
                                     tional boot image information.

     <b>Kind</b>              (Integer) The defined image kind values are:
                       0 =  Mac OS 9
                       1 =  Mac OS X
                       2 =  Mac OS X Server
                       3 =  Hardware Diagnostics

                       The default <b>Kind</b> is determined from the <b>Type</b>:

                       <b>Type</b>          <b>Default</b> <b>Kind</b>
                       Classic       0 - Mac OS 9
                       NFS           1 - Mac OS X
                       HTTP          1 - Mac OS X
                       BootFileOnly  none

                       The <b>Kind</b> must be specified if the <b>Type</b> is <b>BootFileOnly</b>.

     <b>Index</b>             (Integer) The index of the image.  This is a 16-bit value used to differentiate
                       between multiple NetBoot images supplied by a server.  There are two value ranges:
                       1 .. 4095      Image is local to this server.
                       4096 .. 65535  Image is global and may appear on multiple servers, used for load-bal-
                                      ancing.

                       The <b>Index</b> forms the lower 16-bits of the unique 32-bit Image ID.  <b>IsInstall</b> and <b>Kind</b>
                       make up the remaining bits (with 8 bits reserved).

     <b>RootPath</b>          (String) If Type is "NFS", this is the path of the "root" disk image relative to the
                       .nbi directory.  The NetBoot server assumes that the path up to and including the
                       NetBootSPx directory is exported via NFS.  Indirect NFS paths are also supported
                       using the syntax:

                           &lt;path&gt; = &lt;host&gt;:&lt;mount_path&gt;[:&lt;image_path&gt;]
                           &lt;host&gt; = &lt;IP address&gt; | &lt;host_name&gt;

                       For example, in the path:

                           myserver:/NetBoot:Images/Jaguar.dmg

                       the image is on a server named "myserver" with NFS export "/NetBoot" and the image
                       file appears relative to the mount point as "Images/Jaguar.dmg".

                       If Type is "HTTP", this is the path of the "root" disk image relative to the .nbi
                       directory.  The NetBoot server assumes that the .nbi directory under NetBootSPx is
                       exported via HTTP using the convention:

                           <a href="http://&lt;server_ip">http://&lt;server_ip</a>/NetBoot/NetBootSPx/&lt;image_dir&gt;.nbi</XManL_URL>

                       Indirect HTTP paths are also supported using the HTTP URL syntax:

                           &lt;path&gt; = <a href="http://[&lt;user">http://[&lt;user</a>@]&lt;host&gt;[:&lt;port&gt;]/&lt;image_path&gt;</XManL_URL>
                           &lt;user&gt; = &lt;user_name&gt;:&lt;password&gt;
                           &lt;host&gt; = &lt;IP address&gt; | &lt;host_name&gt;

                       Examples:

                           <a href="http://myserver:8080/Images/Jaguar.dmg">http://myserver:8080/Images/Jaguar.dmg</a>
                           <a href="http://joe:secret@someserver/Jaguar/Jaguar.dmg">http://joe:secret@someserver/Jaguar/Jaguar.dmg</a>

     <b>SharedImage</b>       (String) If Type is "Classic", this is the path of the read/write system disk image
                       used for Mac OS 9.

     <b>PrivateImage</b>      (String) If Type is "Classic", this is the path of the read-only private disk image
                       used to store additional applications for Mac OS 9.  Optional.

     <b>SupportsDiskless</b>  (Boolean) A flag that indicates that the image supports diskless clients, and tells
                       the server to allocate resources.  If the Type is "Classic", the value of this prop-
                       erty is ignored since the server always allocates resources required for diskless
                       clients.  See Diskless Resources below.

     <b>EnabledSystemIdentifiers</b>
                       (Array of String) The list of system identifiers that are enabled for this image.
                       The system identifier for Apple hardware is the model property from the Open Firmware
                       device-tree.  Some example model properties are "PowerMac3,3" and "PowerBook3,1".

                       If this property is not specified, or the list is empty, the image is enabled for all
                       clients (the default).

                       If the server has no images that apply to the client, it will not respond.

                       Due to limitations in the NetBoot 1.0 protocol, there is no way for the NetBoot
                       server to differentiate between older clients such as the original bondi-blue iMac or
                       B&amp;W G3 (Yosemite).  To enable an image for all NetBoot 1.0 clients, include the
                       pseudo system identifier "/NetBoot1".

     <b>Architectures</b>     (Array of String) The list of architectures that this image supports.  Optional,
                       implicit value is an array with a single value "ppc".

                       The NetBoot server uses the following logic in conjunction with the (explicit or
                       implicit) value of the <b>Architectures</b> property and the <b>BootFile</b> property:

                       bootfile = plist.BootFile.string
                       for i = 0; i &lt; plist.Architectures.array.count; i++
                           arch = plist.Architectures.array.value[i].string
                           if $arch/$bootfile exists
                               use $arch/$bootfile
                           else if $arch == "ppc" and $bootfile exists
                               use $bootfile
                           else
                               reject this image

                       That is, for each <u>architecture</u> in the <b>Architectures</b> list look for a sub-directory of
                       the .nbi directory named <u>architecture</u>.  If the <b>BootFile</b> exists within that directory,
                       continue with the next <u>architecture</u>.  Otherwise, if the <u>architecture</u> is "ppc", and
                       the <b>BootFile</b> exists directly within the .nbi directory, continue with the next <u>archi-</u>
                       <u>tecture</u>.  Otherwise, reject the image.  If all <b>Architectures</b> have a valid <b>BootFile</b>,
                       accept the image.

                       This logic allows a single-architecture, "ppc"-only NetBoot Image to work as before.
                       The directory structure ensures that a NetBoot Image that only supports non-"ppc"
                       architectures will be rejected by a NetBoot server that doesn't understand the <b>Archi</b>-
                       <b>tectures</b> property.  This is important because older NetBoot servers only serve "ppc"
                       images, and they must not mistakenly serve a non-"ppc" image to a "ppc" client.

     <b>EnabledMACAddresses</b>
                       (Array of String) The exclusive list of MAC addresses for which this image is
                       enabled.  A client whose MAC address is on this list may be offered this image, sub-
                       ject to any other filtering that might be in effect, e.g. the <b>Architectures</b> and
                       <b>EnabledSystemIdentifiers</b> properties.  If this property is not specified, image MAC
                       address filtering is subject only to the <b>DisabledMACAddresses</b> property, if specified.
                       If this property is defined but the array is empty, the image is disabled.

     <b>DisabledMACAddresses</b>
                       (Array of String) The list of MAC addresses for which this image is disabled.  A
                       client whose MAC address is on this list will not be offered this image.  Defining
                       both this property and the <b>EnabledMACAddresses</b> property at the same time is not gen-
                       erally useful, but this property takes precedence.  That is, if a client's MAC
                       address appears in both lists, it is disabled.

   <b>NetBoot</b> <b>Image</b> <b>Example:</b> <b>Mac</b> <b>OS</b> <b>9</b>
     The path to the image directory in this example is:
         /Library/NetBoot/NetBootSP0/Mac OS 9.nbi

     This directory contains the following files:
         NBImageInfo.plist
         Mac OS ROM
         NetBoot HD.img
         Applications HD.img

     The NBImageInfo.plist contains:
     &lt;?xml version="1.0" encoding="UTF-8"?&gt;
     &lt;!DOCTYPE plist SYSTEM "file://localhost/System/Library/DTDs/PropertyList.dtd"&gt;
     &lt;plist version="0.9"&gt;
     &lt;dict&gt;
             &lt;key&gt;BootFile&lt;/key&gt;
             &lt;string&gt;Mac OS ROM&lt;/string&gt;
             &lt;key&gt;IsEnabled&lt;/key&gt;
             &lt;true/&gt;
             &lt;key&gt;Index&lt;/key&gt;
             &lt;integer&gt;4&lt;/integer&gt;
             &lt;key&gt;IsInstall&lt;/key&gt;
             &lt;false/&gt;
             &lt;key&gt;Name&lt;/key&gt;
             &lt;string&gt;Mac OS 9.2&lt;/string&gt;
             &lt;key&gt;SharedImage&lt;/key&gt;
             &lt;string&gt;NetBoot HD.img&lt;/string&gt;
             &lt;key&gt;PrivateImage&lt;/key&gt;
             &lt;string&gt;Applications HD.img&lt;/string&gt;
             &lt;key&gt;Type&lt;/key&gt;
             &lt;string&gt;Classic&lt;/string&gt;
     &lt;/dict&gt;
     &lt;/plist&gt;

     The Type is Classic, which means this is a Mac OS 9 NetBoot image, so the implied Kind value is 0 (Mac
     OS 9).  The BootFile property points to "Mac OS ROM".  The system image is "NetBoot HD.img".  The read-
     only applications image is "Applications HD.img".  The Name of the image is "Mac OS 9.2".  IsEnabled is
     supplied and set to true, so the image is active.  The Index is 4, which means the image is local to
     this server, and will always appear as a unique choice in the client image selection UI.

   <b>NetBoot</b> <b>Image</b> <b>Example:</b> <b>Mac</b> <b>OS</b> <b>X</b>
     The path to this example is:
         /Library/NetBoot/NetBootSP0/Jaguar.nbi

     This directory contains:
         NBImageInfo.plist
         booter
         mach.macosx
         mach.macosx.mkext
         Jaguar.dmg

     The NBImageInfo.plist contains:
     &lt;?xml version="1.0" encoding="UTF-8"?&gt;
     &lt;!DOCTYPE plist SYSTEM "file://localhost/System/Library/DTDs/PropertyList.dtd"&gt;
     &lt;plist version="0.9"&gt;
     &lt;dict&gt;
             &lt;key&gt;BootFile&lt;/key&gt;
             &lt;string&gt;booter&lt;/string&gt;
             &lt;key&gt;IsEnabled&lt;/key&gt;
             &lt;true/&gt;
             &lt;key&gt;Index&lt;/key&gt;
             &lt;integer&gt;4096&lt;/integer&gt;
             &lt;key&gt;IsInstall&lt;/key&gt;
             &lt;false/&gt;
             &lt;key&gt;Name&lt;/key&gt;
             &lt;string&gt;Mac OS X (Jaguar)&lt;/string&gt;
             &lt;key&gt;RootPath&lt;/key&gt;
             &lt;string&gt;Jaguar.dmg&lt;/string&gt;
             &lt;key&gt;Type&lt;/key&gt;
             &lt;string&gt;NFS&lt;/string&gt;
     &lt;/dict&gt;
     &lt;/plist&gt;

     The Type is NFS, and no Kind is specified, so the server assumes this is a Mac OS X image with Kind 1.
     The BootFile property points to "booter".  Mac OS X uses three separate bootfiles, so the remaining
     files which must exist, but are not currently verified to exist by the server, are "mach.macosx" and
     "mach.macosx.mkext".  Those names are non-negotiable, since the booter hard-codes those names.  The
     RootPath property indicates that the image file is "Jaguar.dmg".  The Index is 4096, so this is a
     global image, that may appear on multiple NetBoot servers.  If another server serves an image of the
     same Kind, IsInstall, and Index, this image may appear as a single choice in client image selection UI.

   <b>NetBoot</b> <b>Image</b> <b>Example:</b> <b>Mac</b> <b>OS</b> <b>X</b> <b>with</b> <b>Multiple</b> <b>Architectures</b>
     The path to this example is:
         /Library/NetBoot/NetBootSP0/Tiger.nbi

     This directory contains:
         NBImageInfo.plist
         booter
         mach.macosx
         mach.macosx.mkext
         i386/
             booter
             mach.macosx
             mach.macosx.mkext
         Tiger.dmg

     The NBImageInfo.plist contains:
     &lt;?xml version="1.0" encoding="UTF-8"?&gt;
     &lt;!DOCTYPE plist SYSTEM "file://localhost/System/Library/DTDs/PropertyList.dtd"&gt;
     &lt;plist version="0.9"&gt;
     &lt;dict&gt;
             &lt;key&gt;Architectures&lt;/key&gt;
             &lt;array&gt;
                     &lt;string&gt;i386&lt;/string&gt;
                     &lt;string&gt;ppc&lt;/string&gt;
             &lt;/array&gt;
             &lt;key&gt;BootFile&lt;/key&gt;
             &lt;string&gt;booter&lt;/string&gt;
             &lt;key&gt;IsInstall&lt;/key&gt;
             &lt;true/&gt;
             &lt;key&gt;IsEnabled&lt;/key&gt;
             &lt;true/&gt;
             &lt;key&gt;Index&lt;/key&gt;
             &lt;integer&gt;5000&lt;/integer&gt;
             &lt;key&gt;Name&lt;/key&gt;
             &lt;string&gt;Mac OS X (Tiger)&lt;/string&gt;
             &lt;key&gt;RootPath&lt;/key&gt;
             &lt;string&gt;Tiger.dmg&lt;/string&gt;
             &lt;key&gt;Type&lt;/key&gt;
             &lt;string&gt;NFS&lt;/string&gt;
     &lt;/dict&gt;
     &lt;/plist&gt;

     This example shows how a NetBoot Image that supports multiple architectures is configured.  The boot-
     files for "ppc" reside directly within the .nbi directory, whereas the bootfiles for "i386" reside
     within a sub-directory of the .nbi directory named "i386".  This image is a Mac OS X installation image
     that is served over NFS.

   <b>Diskless</b> <b>Resources</b>
     The NetBoot server creates and manages per-client AFP user logins as well as per-client directories to
     give each client its own protected resources.  The AFP users are created on the local system with the
     attribute <b>_</b><u>creator</u> set to <u>bsdpd</u>.

     When the server initializes, it ensures there are at least <b>afp_users_max</b> users with this property.  If
     there are not, it allocates new user entries to make up the difference.

     Along with the per-client AFP login, the server creates per-client directories to store the "shadow"
     files.  The server creates these directories on each local volume that contains a symbolic link named:

         Library/NetBoot/.clients

     at the root of the volume.  If the symlink is valid, and points to a directory, it assumes that the
     directory should be used for client files.   It also assumes that the directory is a valid AFP share-
     point of the same name.  By convention, the directory is named:

         Library/NetBoot/NetBootClientsY

     where Y is a unique number starting at zero (0).

     The server "round-robins" client files across each such directory to distribute load amongst multiple
     disk drives to improve overall performance.

     When the server responds to the client's NetBoot request, it ensures that the "shadow" file is preallo-
     cated to <b>shadow_size_meg</b> megabytes.  Setting that property high enough avoids having every client fail
     if the server runs out of disk space.   The only clients that fail if the server runs out of disk space
     are those that run of of space in their own pre-allocated "shadow" files.

     Note: the server allocates shadow files for Mac OS 9 NetBoot clients only on local HFS volumes.

<b>SEE</b> <b>ALSO</b>
     <a href="../man5/bootptab.5.html#//apple_ref/doc/man/5/bootptab">bootptab(5)</a>, <!-- a -->xinetd(8)<!-- /a -->, <a href="tftpd.8.html#//apple_ref/doc/man/8/tftpd">tftpd(8)</a>, <a href="../man5/exports.5.html#//apple_ref/doc/man/5/exports">exports(5)</a>

Mac OS X                       February 8, 2007                       Mac OS X
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man8/bootpd.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man8/bootpd.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man8/bootpd.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
