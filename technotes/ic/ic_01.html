<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"    "http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd"><HTML><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note IC01: SendToSelf: Getting in Touch With Yourself Via the Apple Event Manager</title><meta name="keywords" content="Mac OS 8 SendToSelf Apple Event Manager AESend AESuspendTheCurrentEvent errAETimeout"><meta name="Description" content="Technical Note IC01: This Technical Note discusses the AppleEvent Manager and applications that send Apple Events tothemselves. Special attention is paid to the suspension ofthe Apple Event as the App sends the Apple Event to itself."><meta name="categories" content="Interapplication Communication"><meta name="week-posted" content="Sep 28, 1992 - Oct 2, 1992"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002515" title="SendToSelf: Getting in Touch With Yourself Via the Apple Event Manager"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxInterapplicationCommunication-date.html" target="_blank">Carbon > Interapplication Communication</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note IC01</div>
<div id="pageheadsub">SendToSelf: Getting in Touch With Yourself Via the Apple Event Manager</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">                   <A HREF="#Section1">Introduction</A><BR>                  <BR><A HREF="#Section2">Knowing Yourself</A><BR>                  <BR><A HREF="#Section3">Keeping Yourself in Suspense</A><BR><BR><A HREF="#Section4">Getting Back to Business</A><BR><BR>                  <A HREF="#references">References</A><BR>                  <BR>                                   <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id = "introtext">If an application suspends handling of an Apple event which it sent to itself,the Apple Event Manager will return <code>errAETimeout</code> as the result of the<code>AESend</code> call. The event was still sent correctly, however, and the answer (if any) should appear later in the reply descriptor. However, a problem in system software versions 7.0 and 7.0.1 prevents applications from getting the reply data.</p><p id = "introtext">Since MacApp 3.0 suspends handling of the events it receives, the informationin this note is relevant to applications developed with that framework.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1992]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><h2>Introduction</h2><p>Modern Macintosh applications frequently need to send Apple events tothemselves. To take full advantage of AppleScript, an application should be"factored." A factored application handles a  user command by sending itself anApple event, and then performs the action in response to the Apple event. Thisallows the system to watch and record the actions being performed.</p><p align="center"><img src="images/ic_01_001.gif" alt="Factored applications using Apple events" width=352 height=105></p><p align=center><b>Figure 1</b>. Factored applications using Apple events</p><p>It is easy for an application to send an Apple event to itself by using anaddress descriptor of type <code>typeProcessSerialNumber</code> with the<code>lowLongOfPSN</code> field set to <code>kCurrentProcess</code> and the<code>highLongOfPSN</code> set to 0. Events delivered this way are directlydispatched: The Apple Event Manager processes these events immediately,bypassing the event queue and executing the handler routine directly. Thisspeeds up delivery of the event by evading the Event Manager overhead, and itavoids situations in which an Apple event sent in response to user interactionmight arrive in the event queue after some event that really occurred laterthan the user interaction. For example, if the user chooses Cut from the Editmenu and then clicks in another window, and the Cut event were to end up in thequeue behind the window activate event, a selection in the wrong window mightbe cut.</p><p>An application can send events to itself using other forms of addressing, suchas the true process serial number (as returned by <code>GetCurrentProcess</code>.)Because direct dispatching will avoid event sequence problems, applicationsshould generally send events to themselves only by using a <code>typeProcessSerialNumber </code>address descriptor and the <code>kCurrentProcess</code> constant, not by using a true process serial number or an application signature.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><H2>Knowing Yourself</h2><p>The handling of Apple events that are directly dispatched is the same whetherthe <code>AESend</code> specifies the mode as <code>kAEQueueReply</code> or <code>kAEWaitReply</code>. Neither the event nor the reply will be delivered through the event queue. Replies to directly dispatched events always appear in the reply descriptor.</p><p>The event source attribute of an event (a short) can be examined to determinethe kind of dispatch that was used.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre> pascal OSErr EventDirectFromSelf(AppleEvent * theAppleEventPtr, Boolean  directFlagPtr)  // Extract the event source attribute and check if it indicates that  // the event was directly dispatched.  {    short theEventSource;    DescType actualType;    Size actualSize;    OSErr retCode;    retCode = AEGetAttributePtr(theAppleEventPtr, keyEventSourceAttr,      typeShortInteger, &amp;actualType, (Ptr) &amp;theEventSource, sizeof(short),      &amp;actualSize);    if (retCode == noErr &amp;&amp; theEventSource == (short) kAEDirectCall)      *directFlagPtr = true;    else *directFlagPtr = false;    return retCode;  }  </pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><H2>Keeping Yourself in Suspense</h2><p>If the handling of an Apple event sent by an application to itself is suspendedby a call to <code>AESuspendTheCurrentEvent</code>, the Apple Event Manager willimmediately return from the AESend call with the error code <code>errAETimeout.</code> This will happen whether the event was sent with the mode <code>kAEQueueReply</code>, <code>kAEWaitReply</code>, or <code>kAENoReply</code>, even if the timeout parameter is set to <code>kNoTimeOut.</code> The routinecalling <code>AESend</code> should take the timeout error as confirmation that the event was sent. </p><p align="center"><img src="images/ic_01_002.gif" alt="AESend and suspension of AE handling" width=384 height=154></p><p align=center><b>Figure 2</b>. AESend and suspension of AE handling</p><p>As happens with other <code>AESend</code> calls that return with a timeout error,processing of the event by the handler will nevertheless proceed. The handler'sreply, if any, will be made available to the application in the reply eventwhen the handling has completed. There will be no notification that the replyis ready. If no data has yet been placed into the reply event, the Apple EventManager will return <code>errAEReplyNotArrived</code> when the application attemptsto extract data from the reply.</p><p>Unfortunately, the version of the Apple Event Manager present in systemsoftware versions 7.0 and 7.1 does not allow the reply to be extracted from thereply record, and continues to return <code>errAEReplyNotArrived</code>. Thisshould be fixed in a future release of the Apple Event Manager. For now,applications suspending directly dispatched events cannot retrieve the replymessage.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><H2>Getting Back to Business</h2><p>Apple event handlers that suspend an event should not immediately call<code>AEResumeTheCurrentEvent</code>. Instead, a handler should just return aftersuspending the event.</p><p>When <code>AEResumeTheCurrentEvent</code> is called for an event that was notdirectly dispatched, the event and reply will be disposed (just as<code>AEProcessAppleEvent</code> usually does when a handler returns.) Be certainthat all processing involving the event or the reply has completed beforecalling <code>AEResumeTheCurrentEvent</code>. Do not call <code>AEResumeTheCurrentEvent</code> for an event that was not suspended.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><H2>References</h2><P><i>Inside Macintosh</i>, Volume VI, Apple Event Manager</p>         <P><A HREF="#top">Back to top</A></P>                                    <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (112K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ic_01.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ic/ic_01.html%3Fid%3DDTS10002515-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ic/ic_01.html%3Fid%3DDTS10002515-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ic/ic_01.html%3Fid%3DDTS10002515-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>