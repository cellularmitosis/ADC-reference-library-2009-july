<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Detecting Changed Attributes</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.27.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.29.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="28639"> </A>Detecting Changed Attributes</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to find out what attributes have changed in an object before those changes are committed.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Description</H2><P CLASS="Body"><A NAME="pgfId=606104"> </A>By default, before an enterprise object modifies its state, it sends itself a <TT CLASS="Code">willChange</TT> message which, in turn, causes the <TT CLASS="Code">objectWillChange</TT> notification to be sent to all registered observers, particularly the object's editing context. In response, the editing context records a snapshot of the object's state before the modification takes place, allowing later comparisons against the modified object to determine precisely which modifications were made. However, the <TT CLASS="Code">objectWillChange</TT> notification is generic and does not specify the attribute of the object that is to be changed. </P><P CLASS="Body"><A NAME="pgfId=606105"> </A>With a simple technique, you can determine which attributes of an object have changed before these changes are committed to the database. First, as a delegate of EOEditingContext, implement a suitable delegate method such as <TT CLASS="Code">editingContextWillSaveChanges</TT>. In this method, assuming that your Enterprise Object descends either from NSObject (in Objective-C) or from the EOCustomObject class in Java, you can first determine the original snapshot using the following EOEditingContext method:</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607042"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=607046"> </A>- (NSDictionary *)committedSnapshotForObject:(id)object;</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607051"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607053"> </A>public native com.apple.yellow.foundation.NSDictionary committedSnapshotForObject (com.apple.yellow.eocontrol.EOEnterpriseObject);</PRE><P CLASS="Body"><A NAME="pgfId=614363"> </A></P><P CLASS="Body"><A NAME="pgfId=606112"> </A>You can next get all the changes to the object's original snapshot.</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607060"> </A>Objective-C</H4><PRE CLASS="Code"><A NAME="pgfId=607062"> </A>- (NSDictionary *)changesFromSnapshot:(NSDictionary *)snapshot;</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607067"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607069"> </A>public native com.apple.yellow.foundation.NSDictionary changesFromSnapshot (com.apple.yellow.foundation.NSDictionary);</PRE><P CLASS="Body"><A NAME="pgfId=614380"> </A></P><P CLASS="Body"><A NAME="pgfId=606118"> </A>The NSDictionary object returned from the <TT CLASS="Code">changesFromSnapshot</TT> method (in both languages) only contains the attribute names and their values that refer to uncommitted changes in the object. If there is a to-many attribute, the uncommitted value is an array of two arrays: uncommitted additions and uncommitted deletions. </P><P CLASS="Body"><A NAME="pgfId=608059"> </A>The following Java sample code gets the NSDictionaries reflecting the prior committed state of an object and its currently changed attributes, based on the API described above:</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607077"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607079"> </A>/* Assuming that myCustomObject descends from EOCustomObject and already exists */<A NAME="pgfId=607081"> </A>EOEditingContext ec = myCustomObject.editingContext();<A NAME="pgfId=607083"> </A>// The committedSnapshotForObject method expects to have<A NAME="pgfId=607085"> </A>// an EOEnterpriseObject as argument, so typecasting is necessary here.<A NAME="pgfId=607087"> </A>NSDictionary  originalSnapshot = ec.committedSnapshotForObject((EOEnterpriseObject)myCustomObject);<A NAME="pgfId=607089"> </A>NSDictionary changesDict = myCustomObject.changesFromSnapshot(originalSnapshot);</PRE><P CLASS="Body"><A NAME="pgfId=614393"> </A></P><P CLASS="Body"><A NAME="pgfId=606127"> </A>To view all changes recorded in the changed snapshot, you could use the following sample code:											</P></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607092"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607094"> </A>int count;<A NAME="pgfId=607096"> </A>count = changesDict.count();<A NAME="pgfId=607098"> </A>NSArray allKeys = changesDict.allKeys();<A NAME="pgfId=607100"> </A>java.util.Enumerator anEnum = changesDict.keyEnumerator();<A NAME="pgfId=607102"> </A>while (anEnum.hasMoreElements()) {<A NAME="pgfId=613437"> </A>&nbsp;&nbsp;&nbsp;&nbsp;String key = anEnum.nextElement();<A NAME="pgfId=613435"> </A>&nbsp;&nbsp;&nbsp;&nbsp;String value = changesDict.valueForKey(key);<A NAME="pgfId=607104"> </A>&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(&quot;Changes: Key &quot;<A NAME="pgfId=607106"> </A>	 + key + &quot;Value &quot;<A NAME="pgfId=607108"> </A>	+ value);<A NAME="pgfId=607110"> </A>}</PRE><P CLASS="Body"><A NAME="pgfId=614406"> </A></P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606137"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606138"> </A><A HREF="ProgrammingTopics.29.html#28036" CLASS="XRef">Saving Object Changes to the Database</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606141"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606142"> </A>	How do I determine which attributes have been modified before committing them to the database?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606143"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606144"> </A>Saving</LI><LI CLASS="Bulleted"><A NAME="pgfId=606145"> </A>EOCustomObject</LI><LI CLASS="Bulleted"><A NAME="pgfId=606146"> </A>Snapshot</LI><LI CLASS="Bulleted"><A NAME="pgfId=613507"> </A>Change</LI><LI CLASS="Bulleted"><A NAME="pgfId=618832"> </A>Attribute</LI><LI CLASS="Bulleted"><A NAME="pgfId=613508"> </A>Committing</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606148"> </A>Revision History</H2><P CLASS="Body-Text"><A NAME="pgfId=606149"> </A>14 July, 1998. Mai Nguyen. First Draft.</P><P CLASS="Body-Text"><A NAME="pgfId=613504"> </A>17 November, 1998. Terry Donoghue. Second Draft.</P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.27.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.29.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>