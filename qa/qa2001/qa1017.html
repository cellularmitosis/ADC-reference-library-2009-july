<HTML><HEAD>   <title>Technical Q&amp;A QA1017: Extracting DV Fields using QTNewGWorldFromPtr</title><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd">            <LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css">            <LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">            <meta name="keywords" content="QTNewGWorldFromPtr, DV, GWorlds, Video Fields">            <meta name="Description" content="Technical Q&amp;A QA1017: Describes using QTNewGWorldFromPtrto access individual fields contained within a frame of DVsource."><meta name="categories" content="QuickTime Performance and Compatibility and QuickTime"><meta name="week-posted" content="Mar 19, 2001 - Mar 23, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001571" title="Extracting DV Fields using QTNewGWorldFromPtr"></a><P><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxMovieBasics-date.html">Movie Basics</a> &gt; </p><!-- end_header_information --> <!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1017</div>
<div id="pageheadsub">Extracting DV Fields using QTNewGWorldFromPtr</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --></P><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <P><!-- begin_content -->                  <hr width=500 align=center>                  </P>                  <P id=p2>Q: I'm working with a 30 fps 720x480 DV movie and         I'd like to extract each field of each frame into something         I can add to a new file. Any ideas how to do this?</P>                  <P id=p4>A: Each field can be extracted by using MoviesTask         to draw each frame into a GWorld with movie play hints high         quality turned on. Both fields will be rendered in the same         GWorld, and alternate lines may then be extracted from the         source GWorld allowing access to each field.</P>                  <P id=p4>A quick way to extract alternate lines from a         GWorld is to use QTNewGWorldFromPtr.</P>                  <P id=p4>Using the technique outlined in Technical Q&amp;A         1014 Creating Sub GWorlds, create a 720x480 source GWorld in         which to draw the DV movie, then use QTNewGWorldFromPtr to         create two new 'field' GWorlds which address alternate lines         of the source GWorld.</P>                  <P id=p4>QTNewGWorldFromPtr allows you to create an         offscreen graphics world, which may have a non-Macintosh         pixel format, where you define the base address and row         bytes. Because the application is responsible for passing a         pointer that isn't going to change during the lifetime of         the GWorld, it should ensure the source GWorld pixels are         locked. The application is also responsible for disposing of         the pixel data when done.</P>                  <P id=p4>High quality play hints can be turned on by using         the SetMoviePlayHints API.</P>                  <P id=p4><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <pre>SetMoviePlayHints(theMovie, hintsHighQuality, hintsHighQuality);</pre>               </TD>            </TR>         </TABLE>         <BR>         Listing 1 demonstrates one way of creating the 'field'         GWorlds.</P>                  <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td align="left">                  <P><B>Listing 1</B>. MakeDVFieldGWorlds</P>               </TD>            </TR>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <pre> /*    MakeDVFieldGWorlds    This function returns two new GWorlds which point to    alternate lines of a main source GWorld. The QuickTime    DV codec draws both fields of a DV source in the same    GWorld when Movie Play Hints High Quality is turned on.    You can use this function to return two GWorlds which    will give you access to both separate fields.    In  inGWorld - source GWorld    Out outTopFieldGW - GWorld containing the top field                        of a DV frame        outBottomFieldGW  - GWorld containing the                            bottom field of a DV frame*/OSErr MakeDVFieldGWorlds(GWorldPtr inGWorld,                         GWorldPtr *outTopFieldGW,                         GWorldPtr *outBottomFieldGW){    PixMapHandle hPixMap = NULL;    long theRowBytes = 0L;    Ptr theBaseAddr = NULL;    OSType thePixelFormat;    Rect theBounds;    OSErr err = noErr;    if (NULL == inSrcGWorld || NULL == outTopFieldGW ||        NULL == outBottomFieldGW) return paramErr;    // get what we need from the source GWorld    hPixMap = GetGWorldPixMap(inGWorld);        /* must be locked as we are making two new GWorlds        that point to the pixels in this source GWorld */    if (!(GetPixelsState(hPixMap) &amp;&amp; pixelsLocked))        LockPixels(hPixMap);    theBaseAddr = GetPixBaseAddr(hPixMap);    theRowBytes = QTGetPixMapHandleRowBytes(hPixMap);    thePixelFormat = GETPIXMAPPIXELFORMAT(*hPixMap);    theBounds = (**hPixMap).bounds;    // should end up as 240 for NTSC DV    theBounds.bottom = theBounds.bottom / 2;    // create a new GWorld for the top field    // we use rowBytes * 2 because we want every other line    err = QTNewGWorldFromPtr(        outTopFieldGW,  // returned GWorld        thePixelFormat, // pixel format for new GWorld        &amp;theBounds, // boundary rectangle        (**hPixMap).pmTable, // color table        0, // GDevice handle        0, // flags        theBaseAddr, // address of the pixel data        theRowBytes * 2); // number of bytes per row     if (err) goto bail;    // create a new GWorld for the bottom field    err = QTNewGWorldFromPtr(        outBottomFieldGW,        thePixelFormat,        &amp;bounds,        (**hPixMap).pmTable,        0,        0,        (void *)(theBaseAddr + theRowBytes),        theRowBytes * 2);bail:    return err;}</pre>               </TD>            </TR>         </TABLE>         </CENTER>                  <P><BR>         After MoviesTask is used to draw into the main GWorld, the         individual fields can be accessed using the sub-GWorlds and         drawn with CopyBits.</P>                  <P>Depending on the source, the fields may or may not be         spatially coherent. If they are not, a filter should be         applied to move the top field down half a pixel and the         bottom field up half a pixel. Differences in the two fields         will only be noticeable if something in the source is moving         fast.<BR>         </P>                            <P><B>References:</B><BR><BR>          <A HREF="qa1014.html">Technical Q&amp;A QA1014, "Creating Sub GWorlds using QTNewGWorldFromPtr"</A><BR>          <A HREF="qa1007.html">Technical Q&amp;A QA1007, "LockPixels and DisposeGWorld with QTNewGWorldFromPtr"</A>          </P>         <P>                  <hr width=500 align=center>                  </P>                  <!-- begin_date --><H4><CENTER>[Mar 20 2001]</CENTER></H4><!-- end_date -->      </TD>   </TR></TABLE></CENTER><P><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1017.html%3Fid%3DDTS10001571-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1017.html%3Fid%3DDTS10001571-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1017.html%3Fid%3DDTS10001571-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></P></BODY></HTML>