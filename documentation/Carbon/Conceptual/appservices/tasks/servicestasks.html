<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Setting Up Your Carbon Application to Use the Services Menu: Application Services Tasks</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Application Services Tasks"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000993-CH206" title="Application Services Tasks"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../InterapplicationCommunication-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000451" target="_top">Interapplication Communication</a> &gt; <a href="../intro/servintro.html#//apple_ref/doc/uid/TP30000993-CH204-DontLinkElementID_15">Setting Up Your Carbon Application to Use the Services Menu</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../concepts/servconcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../appendixa/servicesappendixa.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_17" title="Application Services Tasks"></a><h1><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF101" title="Application Services Tasks"></a>Application Services Tasks</h1><p>This chapter shows you how add Services functionality to a Carbon application. The tasks covered in this chapter include:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGBHBJ">“Using a Service.”</a></span> Follow the steps in this section if you want to set up your application to use services provided by other applications.</p></li><li class="li"><p><span class="content_text"><a href="../concepts/servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF106">“Providing a Service.”</a></span> Read this section if you want to set up your application to provide one or more services to other applications. </p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGBHBJ">Using a Service</a>
				
			<br/>
			
        
			
			
				<a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF106">Providing a Service</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000993-CH206-CJBGBHBJ" title="Using a Service"></a><h2>Using a Service</h2><p>Mac OS X version 10.1 and later automatically adds a Services item to the application menu of a Carbon application. If you do nothing else, the items in your application’s Services submenu are dimmed and unavailable to users. If you want to enable the Services items appropriate to your application, you’ll need to set up your application to handle the appropriate services-related Carbon events. Specifically, you need to do the tasks described in the following sections:</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF103">“Declaring Services Events.”</a></span> You must declare the services-related Carbon events your application handles.</p></li><li class="li"><p><span class="content_text"><a href="../appendixa/servicesappendixa.html#//apple_ref/doc/uid/TP30000993-CH207-TPXREF102">“Specifying the Data Types Used by Your Application.”</a></span></p></li><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF104">“Handling Copy and Paste Events.”</a></span> You need to write a Carbon event handler that responds to each services-related Carbon event your application handles.</p></li><li class="li"><p><span class="content_text"><a href="../appendixa/servicesappendixa.html#//apple_ref/doc/uid/TP30000993-CH207-TPXREF105">“Installing a Carbon Event Handler.”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF103" title="Declaring Services Events"></a><h3>Declaring Services Events</h3><p>Services-related Carbon events are of event class <code>kEventClassService</code> and can be one of four event kinds, only three of which are relevant to applications that use, but do not provide, services. </p><ul class="spaceabove"><li class="li"><p><code>kEventServiceGetTypes</code>. Any application that wants to use a service must respond to this event. When you receive this event, you must provide the data types that can be pasted into or cut from your application. The operating system enables items in the Services menu for those services that operate on, or provide, those data types. </p></li><li class="li"><p><code>kEventServiceCopy</code>. A service that operates on data supplied by your application (such as the Mail To service provided by the Mail application) sends this kind of event to your application. Your application needs to respond to this event by copying the currently selected data to the scrap provided by the Carbon Event Manager.</p></li><li class="li"><p><code>kEventServicePaste</code>. A service that provides data to your application (such as the Grab Screen service provided by the Grab application) sends this kind of event to your application. Your application needs to respond to this event by copying the data on the scrap provided by the Carbon Event Manager to your application.</p></li></ul><p>A Carbon event type consists of an event class and an event kind that define an event. You use a structure of type <code>EventTypeSpec</code> to declare the Carbon events your application handles. <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGIAAC">Listing 3-1</a></span> shows how you’d declare an <code>EventTypeSpec</code> structure for your application. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_18" title="Listing 2-1Declaring an EventTypeSpec structure for services events"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBGIAAC" title="Listing 2-1Declaring an EventTypeSpec structure for services events"></a><strong>Listing 2-1&nbsp;&nbsp;</strong>Declaring an EventTypeSpec structure for services events</p><div class="codesample"><table><tr><td scope="row"><pre>const EventTypeSpec events[] ={<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServiceGetTypes },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServiceCopy },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServicePaste }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>It’s more likely that your application will be handling other Carbon events, in which case you’d just add the services-related Carbon event types to the <code>EventTypeSpec</code> structure you set up for your entire application, similar to what is shown in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBBEHAD">Listing 3-2</a></span>.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_19" title="Listing 2-2Declaring an EventTypeSpec structure for a variety of Carbon events "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBBEHAD" title="Listing 2-2Declaring an EventTypeSpec structure for a variety of Carbon events "></a><strong>Listing 2-2&nbsp;&nbsp;</strong>Declaring an EventTypeSpec structure for a variety of Carbon events </p><div class="codesample"><table><tr><td scope="row"><pre>const EventTypeSpec events[] ={<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServiceGetTypes },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServiceCopy },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassService, kEventServicePaste },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassKeyboard, kEventRawKeyDown },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassWindow, kEventWindowClickContentRgn },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassWindow, kEventWindowFocusAcquired },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassWindow, kEventWindowFocusRelinquish },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassWindow, kEventWindowBoundsChanging },<span></span></pre></td></tr><tr><td scope="row"><pre>        { kEventClassWindow, kEventWindowBoundsChanged }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF102" title="Specifying the Data Types Used by Your Application"></a><h3>Specifying the Data Types Used by Your Application</h3><p>When the user chooses Services from your application menu, the system sends a Carbon event of class <code>kEventClassService</code> and kind <code>kEventServiceGetTypes</code> to your application. You need to respond to this event by specifying the data types used by your application. One approach is to declare the data types as items in an array, similar to what’s shown in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBBBIGE">Listing 3-3</a></span>. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_20" title="Listing 2-3Declaring the data types used in an application"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBBBIGE" title="Listing 2-3Declaring the data types used in an application"></a><strong>Listing 2-3&nbsp;&nbsp;</strong>Declaring the data types used in an application</p><div class="codesample"><table><tr><td scope="row"><pre>static const OSType MyAppsDataTypes[] =<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    'TEXT',<span></span></pre></td></tr><tr><td scope="row"><pre>    'PICT',<span></span></pre></td></tr><tr><td scope="row"><pre>    'MooV',<span></span></pre></td></tr><tr><td scope="row"><pre>    'AIFF',<span></span></pre></td></tr><tr><td scope="row"><pre>    'utxt'<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div><p>When your application receives the service event of kind <code>kEventServiceGetTypes</code>, you can append the items from the array you declared to the arrays passed to your application in the Carbon event parameters <code>kEventParamServiceCopyTypes</code> and <code>kEventParamServicePasteTypes</code>. <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBCGBDD">Listing 3-4</a></span> show how to get the Carbon event parameters provided by the event kind <code>kEventServiceGetTypes</code> and then append your application’s data types to each of the arrays. A detailed explanation for each numbered line of code appears following the listing. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_21" title="Listing 2-4Supplying the data types used by your application"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBCGBDD" title="Listing 2-4Supplying the data types used by your application"></a><strong>Listing 2-4&nbsp;&nbsp;</strong>Supplying the data types used by your application</p><div class="codesample"><table><tr><td scope="row"><pre>Boolean             textSelection = !TXNIsSelectionEmpty (myTextObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>CFMutableArrayRef   copyTypes, pasteTypes;<span></span></pre></td></tr><tr><td scope="row"><pre>short               index, count;<span></span></pre></td></tr><tr><td scope="row"><pre>if (textSelection)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    GetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kEventParamServiceCopyTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>                        typeCFMutableArrayRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof (CFMutableArrayRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;copyTypes); <span>// 2</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>GetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kEventParamServicePasteTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>                    typeCFMutableArrayRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                    NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    sizeof (CFMutableArrayRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                    NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;pasteTypes); <span>// 3</span></pre></td></tr><tr><td scope="row"><pre>count = sizeof (MyAppsDataTypes) / sizeof (OSType);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>for ( index = 0; index &lt; count; index++ )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef type =<span></span></pre></td></tr><tr><td scope="row"><pre>                CreateTypeStringWithOSType (MyAppsDataTypes [index]);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    if (type)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (textSelection) CFArrayAppendValue (copyTypes, type); <span>// 6</span></pre></td></tr><tr><td scope="row"><pre>        CFArrayAppendValue (pasteTypes, type);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>        CFRelease (type); <span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>return noErr;<span>// 9</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Check to see whether there is any text selected. If there isn’t, then you won’t need to provide data types for copying, as there won’t be anything to copy. You can use whatever function is appropriate to check for selected text. The Multilingual Text Engine (MLTE) function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsSelectionEmpty" target="_top">TXNIsSelectionEmpty</a></code> returns a Boolean value that indicates whether or not anything is selected in an MLTE text object (<code>TXNObject</code>).</p></li><li class="li"><p>If text is selected, then use the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the array associated with the Carbon event parameter <code>kEventParamServiceCopyTypes</code>. You’ll fill this array with the data types the application can give to a service. </p></li><li class="li"><p>Use the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the array associated with the Carbon event parameter <code>kEventParamServicePasteTypes</code>. You’ll fill this array with the data types your application can accept from a service. </p></li><li class="li"><p>Recall that the array <code>MyAppsDataTypes</code> was declared in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBBBIGE">Listing 3-3</a></span>. This line of code figures out how many data types are in the array.</p></li><li class="li"><p>Use the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/CreateTypeStringWithOSType" target="_top">CreateTypeStringWithOSType</a></code> to create a <code>CFStringRef</code> object from the <code>OSType</code>. </p><p>Before your application can use services provided by other applications, your application must provide the data types it can handle to the Carbon Event Manager. The copy and paste arrays passed to your application by the Carbon Event Manager are arrays of <code>CFStringRef</code> objects. As a result, you must convert the <code>OSType</code> data types your application handles to the equivalent <code>CFStringRef</code> objects using the function <code>CreateTypeStringWithOSType</code>.</p></li><li class="li"><p>If text is selected, use the Core Foundation Collection Services function <code><a href="../../../../CoreFoundation/Reference/CFMutableArrayRef/Reference/reference.html#//apple_ref/doc/c_ref/CFArrayAppendValue" target="_top">CFArrayAppendValue</a></code> to add the data types that the application uses to the <code>copyTypes</code> array. This statement is in a <code>for</code> loop, so all the data types are appended by the time the loop is completed.</p></li><li class="li"><p>This statement is also in the <code>for</code> loop. Again, use the function <code><a href="../../../../CoreFoundation/Reference/CFMutableArrayRef/Reference/reference.html#//apple_ref/doc/c_ref/CFArrayAppendValue" target="_top">CFArrayAppendValue</a></code> to add the data types the application uses to the <code>pasteTypes</code> array.</p></li><li class="li"><p>Call the Core Foundation Base Services function <code>CFRelease</code> to release the <code>type</code> object.</p></li><li class="li"><p>Returns <code>noErr</code> to indicate to the event dispatching system that the event has been handled. If you return anything else, the services request does not complete because the system assumes that you are unable to handle this event.</p></li></ol><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF104" title="Handling Copy and Paste Events "></a><h3>Handling Copy and Paste Events </h3><p>After you’ve specified which data types your application handles, your application can receive the service events of kind <code>kEventServiceCopy</code> and <code>kEventServicePaste</code>. You need to respond to each event kind appropriately. </p><p>This section shows code segments that handle each event kind. The code segments are from a text editing application that uses Multilingual Text Engine (MLTE) to handle Unicode text editing. Your code needs to be tailored for your application.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF114" title="Handling a Copy Event"></a><h4>Handling a Copy Event</h4><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBHEFIF">Listing 3-5</a></span> shows a code segment from an event handler that handles the event kind <code>kEventServiceCopy</code>. Before you handle a copy event you should make sure there is data selected. You don’t need to do anything unless some data is selected. A detailed explanation for each numbered line of code follows the listing. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_22" title="Listing 2-5Handling a copy event"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBHEFIF" title="Listing 2-5Handling a copy event"></a><strong>Listing 2-5&nbsp;&nbsp;</strong>Handling a copy event</p><div class="codesample"><table><tr><td scope="row"><pre>case kEventServiceCopy:<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus        status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNOffset       startOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNOffset       endOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    ScrapRef        scrap;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle          textHandle;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    check (myTextObject);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    check (!TXNIsSelectionEmpty (myTextObject));<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    TXNGetSelection (myTextObject, &amp;startOffset, &amp;endOffset);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNGetData (myTextObject,<span></span></pre></td></tr><tr><td scope="row"><pre>                        startOffset, endOffset, &amp;textHandle);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetTXNData);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    require (textHandle != NULL, CantGetDataHandle);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetEventParameter (myEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kEventParamScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                                typeScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof (ScrapRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;scrap );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetCopyScrap);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    verify_noerr (ClearScrap (&amp;scrap));<span>// 9</span></pre></td></tr><tr><td scope="row"><pre>    status = PutScrapFlavor (scrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTXNUnicodeTextData,<span></span></pre></td></tr><tr><td scope="row"><pre>                            0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            GetHandleSize (textHandle),<span></span></pre></td></tr><tr><td scope="row"><pre>                            *textHandle );<span>// 10</span></pre></td></tr><tr><td scope="row"><pre>CantGetCopyScrap:<span></span></pre></td></tr><tr><td scope="row"><pre>    DisposeHandle (textHandle);<span>// 11</span></pre></td></tr><tr><td scope="row"><pre>CantGetDataHandle:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetTXNData:<span></span></pre></td></tr><tr><td scope="row"><pre>    result = status;<span>// 12</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>break;<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the macro <code>check</code> to make sure the text object is valid. The variable <code>myTextObject</code> is of type <code>TXNObject</code>. See the MLTE reference for more information. See Debugging.h for more information on the <code>check</code> macro.</p></li><li class="li"><p>Calls the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNIsSelectionEmpty" target="_top">TXNIsSelectionEmpty</a></code> to make sure there is something in the selection, otherwise it doesn’t make sense to copy. </p></li><li class="li"><p>Gets the absolute offsets of the selected text by calling the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetSelection" target="_top">TXNGetSelection</a></code>.</p></li><li class="li"><p>Calls the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code>to copy the selected text to a text handle.</p></li><li class="li"><p>Checks to make sure the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code> did not return an error. See Debugging.h for more information on the <code>require_noerr</code> macro.</p></li><li class="li"><p>Checks to make sure the text handle returned by the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code> is not <code>NULL</code>. See Debugging.h for more information on the <code>require</code> macro.</p></li><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to obtain the scrap associated with the copy event.</p></li><li class="li"><p>Calls the macro <code>require_noerr</code> to make sure the parameter is obtained without error.</p></li><li class="li"><p>Clears the scrap associated with the event, also calling the macro <code>verify_noerr</code> to check for errors. Clearing the scrap ensures you can safely copy data to it. See Debugging.h for more information on the <code>verify_noerr</code> macro. </p></li><li class="li"><p>Calls the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/PutScrapFlavor" target="_top">PutScrapFlavor</a></code> to place the selected text on the scrap.</p></li><li class="li"><p>Disposes of the text handle previously allocated by the function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetData" target="_top">TXNGetData</a></code>.</p></li><li class="li"><p>Sets <code>result</code> to <code>status</code>. This code listing does not show the complete event handling routine; only the switch statement that handles a copy event. Note that the event handler must return the <code>result</code> value. The value <code>noErr</code> indicates to the event dispatching system that the event has been handled. If you return anything else, the services request does not complete because the system assumes that you are unable to handle this event.</p></li></ol><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF115" title="Handling a Paste Event"></a><h4>Handling a Paste Event</h4><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGJHDD">Listing 3-6</a></span> shows a code segment from an event handler that handles the event kind <code>kEventServicePaste</code>. Unlike the copy event, you do not need to check for selected data, as your application is accepting data provided by a service. A detailed explanation for each numbered line of code follows the listing.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_23" title="Listing 2-6Handling a paste event"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBGJHDD" title="Listing 2-6Handling a paste event"></a><strong>Listing 2-6&nbsp;&nbsp;</strong>Handling a paste event</p><div class="codesample"><table><tr><td scope="row"><pre>case kEventServicePaste:<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSStatus    status = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    Size        unicodeTextSize;<span></span></pre></td></tr><tr><td scope="row"><pre>    UniChar*    unicodeText;<span></span></pre></td></tr><tr><td scope="row"><pre>    ScrapRef    scrap;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNOffset   startOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    TXNOffset   endOffset;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    check (myTextObject != NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetEventParameter (myEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kEventParamScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            typeScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof (ScrapRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;scrap);<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetPasteScrap );<span>// 2</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetScrapFlavorSize (scrap, kTXNUnicodeTextData,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 &amp;unicodeTextSize);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetDataSize);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    unicodeText = (UniChar*) malloc (unicodeTextSize);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>    require_action (unicodeText != NULL, CantCreateBuffer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                status = memFullErr);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = GetScrapFlavorData (scrap, kTXNUnicodeTextData,<span></span></pre></td></tr><tr><td scope="row"><pre>                                &amp;unicodeTextSize, unicodeText );<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>    require_noerr (status, CantGetScrapFlavorData);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    TXNGetSelection (myTextObject, &amp;startOffset, &amp;endOffset);<span>// 9</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    status = TXNSetData (myTextObject, kTXNTextData,<span></span></pre></td></tr><tr><td scope="row"><pre>                    unicodeText, unicodeTextSize,<span></span></pre></td></tr><tr><td scope="row"><pre>                    startOffset, endOffset );<span>// 10</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantGetScrapFlavorData:<span></span></pre></td></tr><tr><td scope="row"><pre>    free (unicodeText);<span>// 11</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CantCreateBuffer:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetDataSize:<span></span></pre></td></tr><tr><td scope="row"><pre>CantGetPasteScrap:<span></span></pre></td></tr><tr><td scope="row"><pre>    result = status;<span>// 12</span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Calls the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the scrap associated with the paste event. This scrap contains data provided by a service.</p></li><li class="li"><p>Calls the macro <code>require</code> to make sure the parameter contains data. See Debugging.h for more information on the <code>require</code> macro.</p></li><li class="li"><p>Gets the size of the data on the scrap by calling the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetScrapFlavorSize" target="_top">GetScrapFlavorSize</a></code>.</p></li><li class="li"><p>Calls the macro <code>require_noerr</code> to make sure the size of the data on the scrap is obtained without error. See Debugging.h for more information on the <code>require_noerr</code> macro.</p></li><li class="li"><p>Allocates a Unicode text buffer large enough to hold the data on the scrap.</p></li><li class="li"><p>Calls the macro <code>require_action</code> to make sure the Unicode text buffer is not <code>NULL</code>. See Debugging.h for more information on the <code>require_action</code> macro.</p></li><li class="li"><p>Obtains the data on the scrap by calling the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetScrapFlavorData" target="_top">GetScrapFlavorData</a></code>.</p></li><li class="li"><p>Calls the macro <code>require_noerr</code> to make sure the data is obtained without error.</p></li><li class="li"><p>Calls the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNGetSelection" target="_top">TXNGetSelection</a></code> to obtain the starting and ending offsets that define the range into which the data should be pasted.</p></li><li class="li"><p>Pastes the data from the scrap to the MLTE text object (<code>TXNObject</code>) by calling the MLTE function <code><a href="../../../Reference/Multilingual_Text_Engine/Reference/reference.html#//apple_ref/doc/c_ref/TXNSetData" target="_top">TXNSetData</a></code>.</p></li><li class="li"><p>Frees the memory allocated for the Unicode text buffer.</p></li><li class="li"><p>Sets <code>result</code> to <code>status</code>. This code listing does not show the complete event handling routine; only the switch statement that handles a paste event. Note that the event handler must return the <code>result</code> value. The value <code>noErr</code> indicates to the event dispatching system that the event has been handled. If you return anything else, the services request does not complete because the system assumes that you are unable to handle this event.</p></li></ol><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF105" title="Installing a Carbon Event Handler "></a><h3>Installing a Carbon Event Handler </h3><p>Once you’ve written a handler to take care of the services events, you need to install it by calling the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/InstallEventHandler" target="_top">InstallEventHandler</a></code> with the appropriate event target. You need to get the event target before you call the function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/InstallEventHandler" target="_top">InstallEventHandler</a></code>. For the text editing application used in the sample code, the event target is the document window. You can use code similar to the following to get a window event target:</p><div class="codesample"><table><tr><td scope="row"><pre>myEventTarget = GetWindowEventTarget (myDocumentWindow);<span></span></pre></td></tr></table></div><p>To install the event handler, your application should include a call similar to this:</p><div class="codesample"><table><tr><td scope="row"><pre>InstallEventHandler (myEventTarget,<span></span></pre></td></tr><tr><td scope="row"><pre>                        handlerUPP,<span></span></pre></td></tr><tr><td scope="row"><pre>                        numTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>                        typeList,<span></span></pre></td></tr><tr><td scope="row"><pre>                        userData,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;handlerRef);<span></span></pre></td></tr></table></div><p>where:</p><ul class="spaceabove"><li class="li"><p><code>myEventTarget</code> is an event target reference. </p></li><li class="li"><p><code>handlerUPP</code> is a pointer to your handler function.</p></li><li class="li"><p><code>numTypes</code> is the number of events for which you are registering the handler.</p></li><li class="li"><p><code>typeList</code> is a pointer to the array of events that contains the services events. </p></li><li class="li"><p><code>userData</code> is an optional value that is passed to your event handler when the handler is called. </p></li><li class="li"><p><code>handlerRef</code> is (on return) a value of type <code>EventHandlerRef</code>, which you can use later to remove the handler. You can pass <code>null</code> if you don’t want the reference. When the target is disposed of, the handler is removed as well. </p></li></ul><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF106" title="Providing a Service "></a><h2>Providing a Service </h2><p>To provide one or more services for other applications to use, you need to do the tasks described in the following sections</p><ol class="ol"><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBCGGHG">“Adding the NSServices Property to the Information Property List.”</a></span> Your application advertises the services it provides through the <code>NSServices</code> property.</p></li><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF116">“Making Sure There’s a Bundle Identifier Property.”</a></span> The <code>CFBundleIdentifier</code> property should already be in your application’s property list. If it isn’t, you need to add it.</p></li><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF110">“Handling the Service Perform Event.”</a></span> You must write code to handle the Carbon event kind <code>kEventServicePerform</code>. </p></li><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBFIEAH">“Installing a Carbon Event Handler.”</a></span> The event target for the handler should be the application.</p></li><li class="li"><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF112">“Registering the Service.”</a></span> Registration informs the system and other applications know about your service. </p></li></ol><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBCGGHG" title="Adding the NSServices Property to the Information Property List"></a><h3>Adding the NSServices Property to the Information Property List</h3><p>Applications must use their information property list to advertise the services they provide. You need to add the <code>NSServices</code> property, and it must have one dictionary entry for each service you provide. Each dictionary entry must have these keys: <code>NSMessage</code>, <code>NSPortName</code>, <code>NSMenuItem</code>, <code>NSSendTypes</code>, and <code>NSReturnTypes</code> and can optionally have these keys: <code>NSKeyEquivalent</code>, <code>NSUserData</code>, and <code>NSTimeout</code>. See <span class="content_text"><a href="../concepts/servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF104">“Services Properties”</a></span> for a description of each key and examples of the <code>NSServices</code> property in an information property list.</p><p>Services functionality in Mac OS X is implemented using Cocoa. This has implications for the values you assign to the <code>NSSendTypes</code> and <code>NSReturnTypes</code> arrays. Cocoa applications use <code>NSPasteboard</code> objects as interfaces to a pasteboard server that allows you to transfer data between applications, as in copy, cut, and paste operations. As a result, Cocoa applications can recognize only those services whose <code>NSSendTypes</code> and <code>NSReturnTypes</code> arrays contain <code>NSPasteboard</code> types.</p><p>Services is implemented to allow Carbon applications to recognize both <code>OSType</code> and <code>NSPasteboard</code> types. If you assign only <code>OSType</code> types to the <code>NSSendTypes</code> and <code>NSReturnTypes</code> arrays, Cocoa applications aren’t able to access your services.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_24" title="Note"></a><p><strong>Note:</strong>&nbsp; To make your services available to all applications, you should assign only <code>NSPasteboard</code> types (such as <code>NSStringPboardType</code>) to the <code>NSSendTypes</code> and <code>NSReturnTypes</code> arrays.</p></div><p>To add the <code>NSServices</code> property to the information property list for a service application or a standalone service do the following:</p><ol class="ol"><li class="li"><p>Open your services application or standalone services project in Project Builder.</p></li><li class="li"><p>Click the Targets tab, then click the appropriate target in the Targets list.</p></li><li class="li"><p>Click the Application Settings tab, then click Expert.</p></li><li class="li"><p>Click the New Sibling button.</p></li><li class="li"><p>Type <code>NSServices</code> in the Property List column.</p></li><li class="li"><p>Choose Array from the Class pop-up menu.</p></li><li class="li"><p>Click the disclosure triangle next to <code>NSServices</code>, then click the New Child button.</p><p>When you click the disclosure triangle, the New Sibling button changes to New Child.</p></li><li class="li"><p>Set the array element’s class to Dictionary.</p></li><li class="li"><p>Click the disclosure triangle next to the array element, then click the New Child button. </p></li><li class="li"><p>Type an <code>NSServices</code> keyword in the Property List column, make sure its class is set appropriately, then type or choose a value.</p><p>Click New Sibling to add the other required keywords to this array element.</p><p>See <span class="content_text"><a href="../concepts/servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-TPXREF104">“Services Properties”</a></span> for a discussion of keywords and their classes. </p><p>For each service you provide, you need to specify a string for the <code>NSMessage</code> property. You’ll use this string to determine which service you need to provide.</p></li></ol><p>You need to add an array element to the <code>NSServices</code> property for each service your application provides. To add another array element, click <code>NSServices</code>, click the New Child button, then follow steps 8 through 10. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF116" title="Making Sure There&acirc;&#128;&#153;s a Bundle Identifier Property"></a><h3>Making Sure There’s a Bundle Identifier Property</h3><p>The <code>CFBundleIdentifier</code> property is a unique identifier string for a bundle (such as an application bundle). All bundles created for Mac OS X should have this property in the information property list, as the system uses the identifier to locate the bundle at runtime and find out information about the bundle, such as what services are provided. </p><p>If you haven’t already added a bundle identifier to the information property list, do so now. The value of the <code>CFBundleIdentifier</code> property should be a string in the form of a Java-style package name (think of it as a reverse URL). For example, <code>com.mycompany.myGreatTextEditApp</code>. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF110" title="Handling the Service Perform Event "></a><h3>Handling the Service Perform Event </h3><p>The Carbon Event Manager requests a service by passing your application a services event of kind <code>kEventServicePerform</code>. You must do the following to handle this event:</p><ol class="ol"><li class="li"><p>Declare an <code>EventTypeSpec</code> structure that specifies the Carbon event class <code>kEventClassService</code> and event kind <code>kEventServicePerform</code>. See <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-TPXREF103">“Declaring Services Events”</a></span> for information on declaring an <code>EventTypeSpec</code> structure.</p></li><li class="li"><p>Write code to handle the event. The details for handling the event are in this section.</p></li></ol><p>When your application receives the event kind <code>kEventServicePerform</code>, you need to get the Carbon event parameters <code>kEventParamServiceMessageName</code>, <code>kEventParamScrapRef</code>, and (optionally) <code>kEventParamUserData</code> as shown in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBEJIGF">Listing 3-7</a></span>. You also need to set up some variables to receive the event parameters and to handle the scrap used to pass data between the service requestor and your service. A detailed explanation for the code in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBEJIGF">Listing 3-7</a></span> follows the listing.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_25" title="Listing 2-7Getting the Carbon event parameter for the event kind kEventServicePerform"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBEJIGF" title="Listing 2-7Getting the Carbon event parameter for the event kind kEventServicePerform"></a><strong>Listing 2-7&nbsp;&nbsp;</strong>Getting the Carbon event parameter for the event kind kEventServicePerform</p><div class="codesample"><table><tr><td scope="row"><pre>CFStringRef     message;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>CFStringRef     userData;<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>ScrapRef        specificScrap;<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>ScrapRef        currentScrap<span>// 4</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>GetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                kEventParamServiceMessageName,<span></span></pre></td></tr><tr><td scope="row"><pre>                typeCFStringRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                sizeof (CFStringRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;message);<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>GetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                kEventParamScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                typeScrapRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                sizeof (ScrapRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;specificScrap);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>GetEventParameter (inEvent,<span></span></pre></td></tr><tr><td scope="row"><pre>                kEventParamUserData,<span></span></pre></td></tr><tr><td scope="row"><pre>                typeCFStringRef,<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                sizeof (CFStringRef),<span></span></pre></td></tr><tr><td scope="row"><pre>                NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;userData);<span>// 7</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declare a variable to hold the <code>NSMessage</code> string that gets returned when you call the function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the Carbon event parameter <code>kEventParamServiceMessageName</code>. Recall that <code>NSMessage</code> is a property whose value identifies a service provided by your application. You use the string returned in the message <code>variable</code> to determine which service to invoke in response to the Carbon event. For example, if the Grab application gets the <code>timedSelection</code> string, it would call its function for taking a shot of the screen after a specified amount of time.</p></li><li class="li"><p>Declare the variable <code>userData</code> only if you’ve added an <code>NSUserData</code> property for the services offered by your application. </p></li><li class="li"><p>Declare a variable to hold the scrap passed by the Carbon Event Manager. The notion of having specific scraps in Carbon is new with Mac OS X version 10.1. You’ll write code later that moves data from this scrap to the Clipboard or the MLTE private scrap. </p></li><li class="li"><p>Declare a variable to hold the current scrap, otherwise known as the Clipboard.</p></li><li class="li"><p>Call the Carbon Event Manager function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the name of the service. It’s the string you assigned to the <code>NSMessage</code> property, and the string is returned in the <code>message</code> variable.</p></li><li class="li"><p>Get the scrap reference from the Carbon Event Manager. If the service requestor is providing data to your service, the scrap contains data. Otherwise, this is the scrap you use to pass data to the service requestor.</p></li><li class="li"><p>If you assigned a string to <code>NSUserData</code>, you need to call the function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/GetEventParameter" target="_top">GetEventParameter</a></code> to get the <code>userData</code> string.</p></li></ol><p>Once you retrieve the values of the <code>message</code> and the <code>scrap</code> variables, you can invoke the code to handle the service specified by the <code>message</code>. Next we’ll take a look at how to implement the code to handle a service.</p><p>When you write the code to handle a service, you need to determine how data moves between the application requesting a service and your service. The way data moves has implications for clearing the scrap and moving data between the specific scrap provided by the Carbon Event Manager, the current scrap (that is, the Clipboard), and, in the case of a text editing application, the MLTE private scrap. There are three possible scenarios.</p><ol class="ol"><li class="li"><p>Data is given to the service provider by the service requestor, but data is not returned to the service requestor. </p></li><li class="li"><p>Data is given to the service requestor by the service provider. The service requestor doesn’t give any data to the service provider. </p></li><li class="li"><p>Data is given to the service provider by the service requestor, and the service provider returns data to the service requestor. </p></li></ol><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBCJHCE">Figure 3-1</a></span> shows three services provided by the SimplerText application, a sample text editing application that uses MLTE. The Paste Text to Simpler Text service illustrates the first scenario. Get Inspirational Text illustrates the second scenario. Modify Selected Text illustrates the third scenario. The code segments in the following sections show how each service is implemented.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_26" title="Figure 2-1Three services provided by SimplerText"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBCJHCE" title="Figure 2-1Three services provided by SimplerText"></a><strong>Figure 2-1&nbsp;&nbsp;</strong>Three services provided by SimplerText</p><img src = "../art/simplerservices.gif" alt = "Three services provided by SimplerText" width="472" height="188"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF117" title="Data is Given to the Service Provider"></a><h4>Data is Given to the Service Provider</h4><p>Data is given to the service provider on the scrap and none is returned to the service requestor. The data is extracted from the scrap by the service provider and the provider does something with it. For example, the Stickies application provides a Make Sticky service that takes the current selection from an application, and pastes it into a new Sticky document.</p><p>Your application, as the service provider, must call the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearCurrentScrap" target="_top">ClearCurrentScrap</a></code> to clear the current scrap before putting data on it. Then you need to call the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetCurrentScrap" target="_top">GetCurrentScrap</a></code> to get a valid scrap reference. <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBEFEBF">Listing 3-8</a></span> show a code segment that implements the Paste Text to Simpler Text service. It gets text data from a service requestor and pastes it into a document. See the detailed explanation that follows the listing for each numbered line of code. </p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_27" title="Listing 2-8Getting data from the service requestor"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBEFEBF" title="Listing 2-8Getting data from the service requestor"></a><strong>Listing 2-8&nbsp;&nbsp;</strong>Getting data from the service requestor</p><div class="codesample"><table><tr><td scope="row"><pre>ClearCurrentScrap ();<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>GetCurrentScrap (&amp;currentScrap);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>count = sizeof (MyAppsDataTypes) / sizeof (OSType);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>for ( index = 0; index &lt; count; index++ )<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        Size        byteCount;<span></span></pre></td></tr><tr><td scope="row"><pre>        OSStatus    err;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        err = GetScrapFlavorSize (specificScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                            MyAppsDataTypes [index],<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;byteCount);<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( err == noErr )<span></span></pre></td></tr><tr><td scope="row"><pre>       {<span></span></pre></td></tr><tr><td scope="row"><pre>            void*   buffer = malloc (byteCount);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>           if (buffer != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>           {<span></span></pre></td></tr><tr><td scope="row"><pre>               err = GetScrapFlavorData (specificScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    TXNTypes [index],<span></span></pre></td></tr><tr><td scope="row"><pre>                                    &amp;byteCount,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>               if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>               {<span></span></pre></td></tr><tr><td scope="row"><pre>                      PutScrapFlavor (currentScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                                TXNTypes [index],<span></span></pre></td></tr><tr><td scope="row"><pre>                                0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                byteCount,<span></span></pre></td></tr><tr><td scope="row"><pre>                                buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>               }<span></span></pre></td></tr><tr><td scope="row"><pre>               free (buffer);<span></span></pre></td></tr><tr><td scope="row"><pre>           }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>TXNConvertFromPublicScrap ();<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>if (TXNIsScrapPastable())<span></span></pre></td></tr><tr><td scope="row"><pre>            TXNPaste (myTextObject);<span>// 6</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>When your application receives a request to copy text from the service requestor into your application, you must first clear the current scrap using the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearCurrentScrap" target="_top">ClearCurrentScrap</a></code>.</p></li><li class="li"><p>Get a reference to the current scrap.</p></li><li class="li"><p><code>MyAppsDataTypes</code> is an array that contains the <code>OSTypes</code> handled by your application. You need to declare this array. See <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBBBIGE">Listing 3-3</a></span> for an example.</p></li><li class="li"><p>The <code>for</code> loop copies the data from the scrap provided by the Carbon Event Manager. For each data type your application can handle, you call the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetScrapFlavorSize" target="_top">GetScrapFlavorSize</a></code> to see if the type of data on the scrap provided by the CEM matches. If it matches, allocate a buffer and get the data from the scrap using the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetScrapFlavorData" target="_top">GetScrapFlavorData</a></code>. Then use the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/PutScrapFlavor" target="_top">PutScrapFlavor</a></code> to copy the data to the Clipboard.</p></li><li class="li"><p>MLTE uses a private scrap, so you need to call the MLTE function to convert the current scrap to MLTE’s private scrap.</p></li><li class="li"><p>Make sure the data on MLTE’s scrap can be pasted. If so, then paste it into your document. </p></li></ol><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBDCAJH">Figure 3-2</a></span> illustrates what the code in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBEFEBF">Listing 3-8</a></span> does. The text provided by the service requestor is highlighted in the service requestor document window. The service provider gets the text from the scrap and pastes it into an untitled document. </p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_28" title="Figure 2-2Text provided by the service requestor"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBDCAJH" title="Figure 2-2Text provided by the service requestor"></a><strong>Figure 2-2&nbsp;&nbsp;</strong>Text provided by the service requestor</p><img src = "../art/datatoprovider.gif" alt = "Text provided by the service requestor" width="296" height="249"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF118" title="Data is Given to the Service Requestor"></a><h4>Data is Given to the Service Requestor</h4><p>Data is given to the service requestor by the service provider, but the service requestor doesn’t give any data to the service provider. For example, the Grab application provides a Grab Screen service that gives the client an image of the screen. </p><p>Your application, as the service provider, must call the Scrap Manager function <code>ClearScrap</code> to clear the scrap given to it by the Carbon Event Manager. Then it can put data on the scrap for the service requestor by calling the function <code>PutScrapFlavor</code>. <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGFBFF">Listing 3-9</a></span> shows a code segment that implements the Get Inspirational Text service. It gives a text string to the service requestor. See the detailed explanation that follows the listing for each numbered line of code.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_29" title="Listing 2-9Giving data to the service requestor"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBGFBFF" title="Listing 2-9Giving data to the service requestor"></a><strong>Listing 2-9&nbsp;&nbsp;</strong>Giving data to the service requestor</p><div class="codesample"><table><tr><td scope="row"><pre>char    string[] = "Buy low, sell high.";<span>// 1</span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>ClearScrap (&amp;specificScrap);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>PutScrapFlavor (specificScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>            'TEXT',<span></span></pre></td></tr><tr><td scope="row"><pre>            0,<span></span></pre></td></tr><tr><td scope="row"><pre>            strlen (string),<span></span></pre></td></tr><tr><td scope="row"><pre>            string);<span>// 3</span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declare a string. This is what you’ll give to the service requestor.</p></li><li class="li"><p>The function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearScrap" target="_top">ClearScrap</a></code> is new with Mac OS X version 10.1. Unlike the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearCurrentScrap" target="_top">ClearCurrentScrap</a></code>, which can only clear the Clipboard, <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearScrap" target="_top">ClearScrap</a></code> can clear any scrap passed to it. In this case, you need to pass a reference to the scrap provided to your application by the Carbon Event Manager in the parameter <code>kEventParamScrapRef</code>.</p></li><li class="li"><p>After you’ve cleared the scrap, put the string you want to pass to the service requestor on the scrap.</p></li></ol><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBJFHJH">Figure 3-3</a></span> illustrates what the code in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBGFBFF">Listing 3-9</a></span> does. The string defined in the listing is pasted into the service requestor’s document window.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_30" title="Figure 2-3Giving text to the service requestor"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBJFHJH" title="Figure 2-3Giving text to the service requestor"></a><strong>Figure 2-3&nbsp;&nbsp;</strong>Giving text to the service requestor</p><img src = "../art/datafromprovider.gif" alt = "Giving text to the service requestor" width="280" height="100"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF119" title="Data is Given to the Service Provider; Data is Returned to the Service Requestor"></a><h4>Data is Given to the Service Provider; Data is Returned to the Service Requestor</h4><p>The service requestor gives data to the service provider. The service provider modifies the data and returns the modified data to the service requestor. For example, a spell checker service takes text from the service requestor and returns text with corrected spelling.</p><p>Your application, as the service provider, must use the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/GetScrapFlavorData" target="_top">GetScrapFlavorData</a></code> to take the data from the scrap given by to it by the Carbon Event Manager. Then the scrap must be cleared, by calling the Scrap Manager function <code>ClearScrap</code>. Once the data is processed, you put it on the scrap by calling the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/PutScrapFlavor" target="_top">PutScrapFlavor</a></code>. </p><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBIBJAF">Listing 3-10</a></span> shows a code segment that implements the Modify Selected Text service. It gets text data from a service requestor, modifies it, and passes it back to the service requestor. See the detailed explanation that follows the listing for each numbered line of code.</p><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_31" title="Listing 2-10Modifying data from the service requestor"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBIBJAF" title="Listing 2-10Modifying data from the service requestor"></a><strong>Listing 2-10&nbsp;&nbsp;</strong>Modifying data from the service requestor</p><div class="codesample"><table><tr><td scope="row"><pre>OSStatus    err;<span>// 1</span></pre></td></tr><tr><td scope="row"><pre>Size        byteCount;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = GetScrapFlavorSize (specficScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                    'utxt',<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;byteCount);<span>// 2</span></pre></td></tr><tr><td scope="row"><pre>if (err == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UniChar*    buffer = (UniChar*) malloc (byteCount);<span>// 3</span></pre></td></tr><tr><td scope="row"><pre>    if (buffer != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        err = GetScrapFlavorData (specificScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                            'utxt',<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;byteCount,<span></span></pre></td></tr><tr><td scope="row"><pre>                            buffer);<span>// 4</span></pre></td></tr><tr><td scope="row"><pre>        if ( err == noErr &amp;&amp; byteCount > 1 )<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            buffer[0] = '!';<span>// 5</span></pre></td></tr><tr><td scope="row"><pre>            ClearScrap (&amp;specficScrap);<span>// 6</span></pre></td></tr><tr><td scope="row"><pre>            PutScrapFlavor (specificScrap,<span></span></pre></td></tr><tr><td scope="row"><pre>                        'utxt',<span></span></pre></td></tr><tr><td scope="row"><pre>                        0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        byteCount,<span></span></pre></td></tr><tr><td scope="row"><pre>                        buffer);<span>// 7</span></pre></td></tr><tr><td scope="row"><pre>            result = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        free (buffer);<span>// 8</span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here’s what the code does:</p><ol class="ol"><li class="li"><p>Declare variables for error checking and to get the number of bytes on the scrap.</p></li><li class="li"><p>Find out the size of the Unicode text data that’s on the scrap provided by the Carbon Event Manager. </p></li><li class="li"><p>Allocate a buffer to accommodate the size of the data.</p></li><li class="li"><p>Get the data from the scrap.</p></li><li class="li"><p>Replace the first character with an exclamation point.</p></li><li class="li"><p>Call the Scrap Manager function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearScrap" target="_top">ClearScrap</a></code> to clear the scrap given to your application by the Carbon Event Manager. Recall that the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearScrap" target="_top">ClearScrap</a></code> can clear any scrap passed to it, while the function <code><a href="../../../Reference/Scrap_Manager/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/doc/c_ref/ClearCurrentScrap" target="_top">ClearCurrentScrap</a></code> is limited to clearing the Clipboard.</p></li><li class="li"><p>Put the modified data back on the scrap for the Carbon Event Manager.</p></li><li class="li"><p>Free the memory allocated for the buffer.</p></li></ol><p><span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBBCFAF">Figure 3-4</a></span> illustrates what the code in <span class="content_text"><a href="servicestasks.html#//apple_ref/doc/uid/TP30000993-CH206-CJBIBJAF">Listing 3-10</a></span> does. The original text was <code>Buy low, sell high.</code> The service provider replaced the first letter of the selected text with an exclamation point.</p><br/><div><a name="//apple_ref/doc/uid/TP30000993-CH206-DontLinkElementID_32" title="Figure 2-4Modified text returned to the service requestor"></a><p><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBBCFAF" title="Figure 2-4Modified text returned to the service requestor"></a><strong>Figure 2-4&nbsp;&nbsp;</strong>Modified text returned to the service requestor</p><img src = "../art/datamodified.gif" alt = "Modified text returned to the service requestor" width="276" height="104"></div><br/><a name="//apple_ref/doc/uid/TP30000993-CH206-CJBFIEAH" title="Installing a Carbon Event Handler "></a><h3>Installing a Carbon Event Handler </h3><p>Once you’ve written a handler to take care of the services events, you need to install it by calling the Carbon Event Manager macro <code><!--a-->InstallApplicationEventHandler<!--/a--></code>. You can use this macro rather than the more general function <code><a href="../../../Reference/Carbon_Event_Manager_Ref/Reference/reference.html#//apple_ref/doc/c_ref/InstallEventHandler" target="_top">InstallEventHandler</a></code> when the event target is the application itself, which is the case for an application that provides services. </p><p>Your application should include a call similar to this:</p><div class="codesample"><table><tr><td scope="row"><pre>InstallApplicationEventHandler ( handlerUPP,<span></span></pre></td></tr><tr><td scope="row"><pre>                        numTypes,<span></span></pre></td></tr><tr><td scope="row"><pre>                        typeList,<span></span></pre></td></tr><tr><td scope="row"><pre>                        userData,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;handlerRef);<span></span></pre></td></tr></table></div><p>where:</p><ul class="spaceabove"><li class="li"><p><code>handlerUPP</code> is a pointer to your handler function.</p></li><li class="li"><p><code>numTypes</code> is the number of events for which you are registering the handler.</p></li><li class="li"><p><code>typeList</code> is a pointer to the array of events that contains the services events. </p></li><li class="li"><p><code>userData</code> is an optional value that is passed to your event handler when the handler is called. </p></li><li class="li"><p><code>&amp;handlerRef</code> is (on return) a value of type <code>EventHandlerRef</code>, which you can use later to remove the handler. You can pass <code>null</code> if you don’t want the reference. When the target is disposed of, the handler is removed as well. </p></li></ul><a name="//apple_ref/doc/uid/TP30000993-CH206-TPXREF112" title="Registering the Service"></a><h3>Registering the Service</h3><p>If you want to make sure your service gets registered and your code works, you’ll need to do the following.</p><ul class="spaceabove"><li class="li"><p>Install your application or standalone service in the appropriate location. See <span class="content_text"><a href="../concepts/servconcepts.html#//apple_ref/doc/uid/TP30000993-CH205-BAJGHDJA">“Installation Paths for Services.”</a></span></p></li><li class="li"><p>Log out and back in. Mac OS X searches for and assembles the list of available services only when a user logs in. </p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../concepts/servconcepts.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../appendixa/servicesappendixa.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2003 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2003-12-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/appservices/tasks/servicestasks.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/appservices/tasks/servicestasks.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/appservices/tasks/servicestasks.html%3Fid%3DTP30000993-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>