<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Specifying a Target Address(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING199></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-198.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-200.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-195.html"><B>Chapter 5 - Creating and Sending Apple Events</B></A> / <A HREF="IAC-196.html"><B>Creating an Apple Event</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING199-0></A>
<H2><A NAME=MARKER-9-51></A><A NAME=MARKER-21-52></A>Specifying a Target Address</H2>
 <A NAME=MARKER-2-17></A><A NAME=MARKER-2-18></A><A NAME=MARKER-2-19></A><A NAME=MARKER-2-230></A>When you create an Apple event, you must specify the address of the target. The <B>target</B> <B>address</B> identifies the particular application or process to which you want to send the Apple event. You can send Apple events to applications on the local computer or on remote computers on the network. <P>
 These are the descriptor types that identify the four methods of addressing an Apple event:
<TABLE BORDER="0" CELLPADDING=3><TD>typeApplSignature<TD>The application signature of the target<TR>
<TD>typeSessionID<TD>The session reference number of the target<TR>
<TD>typeTargetID<TD>The target ID record of the target<TR>
<TD>typeProcessSerialNumber<TD>The process serial number of the target<A NAME=MARKER-21-43></A><A NAME=MARKER-2-41></A></TABLE>
<P>
 To address an Apple event to a target on a remote computer on the network, you must use either the <CODE>typeSessionID</CODE> or <CODE>typeTargetID</CODE> descriptor type. <A NAME=MARKER-21-101></A><A NAME=MARKER-2-102></A><A NAME=MARKER-2-59></A><A NAME=MARKER-2-60></A> <A NAME=MARKER-2-342></A> <A NAME=MARKER-21-206></A><P>
 If your application sends an Apple event to itself, it should address the Apple event using a process serial number of <CODE>kCurrentProcess</CODE>. This is the fastest way for your application to send an Apple event to itself. For more information, see <A HREF=#MARKER-9-74>"Addressing an Apple Event for Direct Dispatching" on page 5-13</A>.<A NAME=MARKER-2-266></A><P>
 You can use any of the four address types when sending an Apple event to another application on the local computer. The chapter "Event Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> describes all four types of addresses. Your application can also use another address type if it provides a coercion handler that coerces the address type into one of the four address types that the Apple Event Manager recognizes. See <A HREF=IAC-125.html#MARKER-9-401>"Writing and Installing Coercion Handlers,"</A> which begins on <A HREF=IAC-125.html#MARKER-9-401>page 4-41</A>, for more information.<P>
 To allow the user to choose the target of an Apple event, use the <CODE>PPCBrowser</CODE> function. This function presents a standard user interface for choosing a target application, much as the Standard File Package provides a standard user interface for opening and saving files.<A NAME=MARKER-2-64></A> The <CODE>PPCBrowser</CODE> function returns, in a target ID record, information about the application the user chose. <A HREF=#MARKER-9-71>Listing 5-3 on page 5-12</A> shows how to use the <CODE>PPCBrowser</CODE> function to let the user choose a target. <P>
<A NAME=HEADING199-7></A>
<H3>Creating an Address Descriptor Record</H3>
 You specify the address using an address descriptor record (a descriptor record of data type <CODE>AEAddressDesc</CODE>). You must create a descriptor record of this type and then add it to the Apple event using the <CODE>AECreateAppleEvent</CODE> function.<A NAME=MARKER-2-267></A><A NAME=MARKER-2-292></A><P>
 You can use the <CODE>AECreateDesc</CODE> function to create address descriptor records for any of the four types of target addresses. <A HREF=#MARKER-9-67>Listing 5-2</A> shows four possible ways to create an address, each using a different address type.<P>
<B>Listing 5-2  <A NAME=MARKER-9-67></A><A NAME=MARKER-21-68></A>Creating a target address<A NAME=MARKER-2-213></A></B><P>
<PRE>
PROCEDURE MySetTargetAddresses(VAR targetAddress1, 
                               targetAddress2, targetAddress3, 
                               targetAddress4: AEAddressDesc; 
                               toTargetID: TargetID; 
                               thePSN: ProcessSerialNumber; 
                               theSignature: OSType; 
                               theSessionRef: PPCSessRefNum);
VAR
   myErr:   OSErr;
BEGIN
   myErr := AECreateDesc(typeTargetID, @toTargetID,
                         SizeOf(toTargetID), targetAddress1);
   myErr := AECreateDesc(typeProcessSerialNumber, @thePSN, 
                         SizeOf(thePSN), targetAddress2);
   myErr := AECreateDesc(typeApplSignature, @theSignature, 
                         SizeOf(theSignature), targetAddress3);
   myErr := AECreateDesc(typeSessionID, @theSessionRef, 
                         SizeOf(theSessionRef), targetAddress4);
   {add your own error checking}
END;
</PRE>
 To create an address descriptor record, specify the following as parameters to <CODE>AECreateDesc</CODE>: the descriptor type for the address, a pointer to the buffer containing the address, and the size of the buffer. The <CODE>AECreateDesc</CODE> function returns an address descriptor record with the specified characteristics.<P>
 After creating an address, you can specify it as a parameter to the <CODE>AECreateAppleEvent</CODE> function. See <A HREF=IAC-196.html#MARKER-9-24>"Creating an Apple Event,"</A> which begins on <A HREF=IAC-196.html#MARKER-9-24>page 5-3</A>, for an example using the <CODE>AECreateAppleEvent</CODE> function. <P>
 When you specify an address to the <CODE>AECreateAppleEvent</CODE> function, the Apple Event Manager stores the address in the <CODE>keyAddressAttr</CODE> attribute of the Apple event. <P>
 If you use the <CODE>PPCBrowser</CODE> function to allow the user to choose an Apple event's target, your application must create a target ID record based on the user's choice. <A HREF=#MARKER-9-71>Listing 5-3</A> shows how to create a target ID record using the information returned from the <CODE>PPCBrowser</CODE> function and create an address descriptor record using the <CODE>AECreateDesc</CODE> function.<A NAME=MARKER-21-294></A><P>
<B>Listing 5-3  <A NAME=MARKER-9-71></A><A NAME=MARKER-21-72></A>Specifying a target address in an Apple event by using the <CODE>PPCBrowser</CODE> function<A NAME=MARKER-2-308></A></B><P>
<PRE>
FUNCTION MyGetTargetAddress (myPrompt: Str255; myAppStr: Str255;
                              VAR myPortInfo: PortInfoRec; 
                              VAR targetAddress: AEAddressDesc; 
                              VAR toTargetID: targetID): OSErr;
VAR
   myErr:   OSErr;
BEGIN             
   {use PPCBrowser to let user choose the target}
   myErr := PPCBrowser(myPrompt, myAppStr, FALSE, 
                        toTargetID.location, 
                        myPortInfo, NIL, '');
   MyGetTargetAddress := myErr;
   IF myErr &lt;&gt; noErr THEN Exit(MyGetTargetAddress);

   toTargetID.name := myPortInfo.name;

   {create the descriptor record for the target address}
   MyGetTargetAddress := AECreateDesc(typeTargetID, @toTargetID, 
                                       SizeOf(toTargetID), 
                                       targetAddress);
END;
</PRE>
 See the chapter "Program-to-Program Communications Toolbox" in this book for more information on using the <CODE>PPCBrowser</CODE> function.<P>
<A NAME=HEADING199-19></A>
<H3><A NAME=MARKER-9-74></A>Addressing an Apple Event for Direct Dispatching</H3>
 <A NAME=MARKER-21-118></A><A NAME=MARKER-2-112></A><A NAME=MARKER-2-111></A>As described in the chapter "Recording Apple Events" in this book, a recordable application must send itself Apple events in response to user actions. Your application can send itself Apple events by using an address descriptor record of descriptor type <CODE>typeProcessSerialNumber</CODE> with the <CODE>lowLongOfPSN</CODE> field set to <CODE>kCurrentProcess</CODE> and the <CODE>highLongOfPSN</CODE> set to 0. The Apple Event Manager processes such Apple events immediately, executing the appropriate Apple event handler directly without going through the normal event-processing sequence. For this reason, your application will not appear to run more slowly when it sends Apple events to itself. <A NAME=MARKER-21-458></A> <A NAME=MARKER-2-119></A><P>
 Apple events your application sends to itself this way do not appear in your application's high-level event queue. This not only speeds up delivery of the event but also avoids situations in which an Apple event sent in response to a user action arrives in the event queue after some other event that really occurred later than the user action. For example, suppose a user chooses Cut from the Edit menu and then clicks in another window. If the Cut event arrives in the queue after the window activate event, a selection in the wrong window might be cut.<P>
 Your application can send events to itself using other forms of addressing, such as the true process serial number returned by <CODE>GetCurrentProcess</CODE>. Because direct dispatching avoids event sequence problems, applications should generally send events to themselves by using an address descriptor record of descriptor type <CODE>typeProcessSerialNumber</CODE> with the <CODE>kCurrentProcess</CODE> constant rather than using a true process serial number or an application signature. <A NAME=MARKER-2-106></A><A NAME=MARKER-2-148></A><A NAME=MARKER-2-81></A><A NAME=MARKER-21-83></A><A NAME=MARKER-2-84></A><A NAME=MARKER-21-109></A><P>
<DL>
<DT><B>IMPORTANT</B>
<DD>When Apple event recording has been turned on, the Apple Event Manager records every event that your application sends to itself unless you specify the <CODE>kAEDontRecord</CODE> flag in the <CODE>sendMode</CODE> parameter of the <CODE>AESend</CODE> function.<EM></EM> <A NAME=MARKER-2-103></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-198.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-200.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
