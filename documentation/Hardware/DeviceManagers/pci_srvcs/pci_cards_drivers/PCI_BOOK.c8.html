<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Replace and Superseded Routines</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c7.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c9.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H3.Heading3"><A NAME="pgfId=3955"> </A><A NAME="23666"> </A>Replace and Superseded Routines</H1><P CLASS="T1.Text1"><A NAME="pgfId=3956"> </A>Under certain conditions, it may be desirable to replace an installed driver. For example, a display card may use a temporary driver during system startup and then replace it with a better version from disk once the file system is running and initialized.</P><P CLASS="T1.Text1"><A NAME="pgfId=3957"> </A>Replacing an installed driver is a two-step process. First, the driver to be replaced is requested to give up control of the device. Second, the new driver is installed and directed to take over management of the device. Two native driver commands are reserved for these tasks.</P><P CLASS="T1.Text1"><A NAME="pgfId=3958"> </A>The <TT CLASS="cv">kSupersededCommand</TT> selector tells the outgoing driver to begin the replacement process. The command contents are the same as with <TT CLASS="cv">kFinalizeCommand</TT>. The outgoing driver should take the following actions:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3959"> </A>If it is a concurrent driver, it should wait for current I/O actions to finish.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3960"> </A>Place the device in a &quot;quiet&quot; state. The definition of this state is device specific, but it may involve such tasks as disabling device interrupts.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3961"> </A>Remove any installed interrupt handlers.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3962"> </A>Store the driver and the device state in the Name Registry as one or more properties attached to the device entry.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3963"> </A>Return <TT CLASS="cv">noErr</TT> to indicate that the driver is ready to be replaced.</LI></UL><P CLASS="T1.Text1"><A NAME="pgfId=3964"> </A>The <TT CLASS="cv">kReplaceCommand</TT> selector tells the incoming driver to assume control of the device. The command contents are the same as those of <TT CLASS="cv">kInitializeCommand</TT>. The incoming driver should take the following actions:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3965"> </A>Retrieve the state stored in the Name Registry and delete the properties stored by <TT CLASS="cv">kSupersededCommand</TT>.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3966"> </A>Install interrupt handlers.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3967"> </A>Place the device in an active state.</LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=3968"> </A>Return <TT CLASS="cv">noErr</TT> to indicate that the driver is ready to be used.</LI></UL><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=17233"> </A>Note</B></p><P CLASS="Note"><A NAME="pgfId=3969"> </A>When replacing concurrent generic drivers, the Device Manager halts new commands until the replacement process is complete. </P></blockquote></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.c2.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c7.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.c9.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>