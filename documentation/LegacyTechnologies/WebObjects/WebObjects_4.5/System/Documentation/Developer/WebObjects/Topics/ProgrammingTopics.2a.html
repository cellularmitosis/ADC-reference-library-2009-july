<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Choosing an Approach for Locking</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.29.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.2b.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606143"> </A><A NAME="15618"> </A>Choosing an Approach for Locking</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606144"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606145"> </A>Describes the different approaches for locking database records.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606146"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=606147"> </A>&quot;Locking&quot; is a term that denotes a technique for preventing users from overwriting other users' work. There are four principal ways to implement locking: optimistic, pessimistic, locking on a column, and application-level locking. Each of these has different strengths and weaknesses and you are likely to use a combination of these approaches in your applications.</P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606148"> </A>Optimistic Locking</H3><P CLASS="Body"><A NAME="pgfId=606149"> </A>Optimistic locking is the default locking mechanism for the Enterprise Objects Framework. With optimistic locking, database rows and objects are never actually locked. When an object is first read from the database, EOF makes a snapshot of that object. Before the data represented by the object is updated, the snapshot and database row are compared and if they are not the same, the update fails. The advantages of optimistic locking are the following:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606150"> </A>All databases support optimistic locking. </LI><LI CLASS="Bulleted"><A NAME="pgfId=606151"> </A>Optimistic locking is easy to use.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606152"> </A>Optimistic locking doesn't use any extra database resources.</LI></UL><P CLASS="Body"><A NAME="pgfId=616792"> </A>The disadvantages of optimistic locking are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606153"> </A>Users are not notified that someone else modified a record until they try to update it.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606154"> </A>Optimistic locking slows down updates.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606155"> </A>All applications that update a database must agree on the columns to lock on.</LI></UL></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606156"> </A>Pessimistic Locking</H3><P CLASS="Body"><A NAME="pgfId=606157"> </A>Pessimistic locking locks database rows at the database level. Locking can happen either when the row is selected or on demand. Depending on the database, a select on a locked row either fails or is blocked until the row is unlocked. Some databases support page-level locking. This means that whenever any row in a page is locked, a group of other rows is also locked. The advantages of pessimistic locking are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606158"> </A>Pessimistic locking can prevent users and applications from reading data that is being changed.</LI><LI CLASS="Bulleted"><A NAME="pgfId=616806"> </A>Users are notified immediately if they cannot access a database row.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606159"> </A>Pessimistic locking is easy to use.</LI></UL><P CLASS="Body"><A NAME="pgfId=616801"> </A>The disadvantages of pessimistic locking are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606160"> </A>Not all databases support this mechanism and the databases that do support it do so differently.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606161"> </A>Pessimistic locking uses extra database resources.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606162"> </A>Pessimistic locking can prevent other users from having read-only access to data.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606164"> </A>Pessimistic locking can cause deadlocks.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606165"> </A>Pessimistic locking can cause excessive locking.</LI></UL></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606166"> </A>Locking on a Column</H3><P CLASS="Body"><A NAME="pgfId=606167"> </A>One effective way to implement on-demand locking is to add a locked column to a database. An application can add a single column to a table and then change a value in the column to indicate whether an object is locked. This locked column can hold anything from a simple Boolean value to a user's name and a time stamp. The advantages of locking on a column are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606168"> </A>This method lets the application decide when a record should be locked. </LI><LI CLASS="Bulleted"><A NAME="pgfId=606169"> </A>This method enables users to see who locked the record and when it happened.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606170"> </A>You can give authorized users the capability to override the lock.</LI></UL><P CLASS="Body"><A NAME="pgfId=616901"> </A>The disadvantages of locking on a column are:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606171"> </A>This method allows users to lock a record and keep it locked indefinitely.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606172"> </A>If the database connection is lost, the lock is still enabled.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606173"> </A>Extra database space is needed for the column.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606174"> </A>An extra transaction is needed to set the lock.</LI></UL></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606175"> </A>Application-level Locking</H3><P CLASS="Body"><A NAME="pgfId=606176"> </A>Locking at the application level is perhaps the most powerful locking mechanism, but it is the most difficult to implement. To lock at the application level, you must keep a list of locked objects shared by all applications that update the database. The advantages to application-level locking are the following:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606177"> </A>This technique allows much flexibility in the way an object is locked. Objects can be locked on demand, on read, on change, or on any combination of these.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606178"> </A>It enables the application to warn other users as soon as anyone locks an object.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606179"> </A>It requires no extra processing at the database level.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606180"> </A>No extra space is needed in the database.</LI></UL><P CLASS="Body"><A NAME="pgfId=616947"> </A>The disadvantages of application-level locking are the following</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606181"> </A>It can be very difficult and slow to keep a list of objects in synchronization with multiple applications running. </LI></UL></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606182"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606183"> </A><A HREF="ProgrammingTopics.2c.html#18760" CLASS="XRef">Optimistic Locking</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606184"> </A><A HREF="ProgrammingTopics.2d.html#14326" CLASS="XRef">Pessimistic Locking</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606185"> </A><A HREF="ProgrammingTopics.2b.html#10467" CLASS="XRef">Locking on a Column</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606187"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606188"> </A>What is locking?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606189"> </A>What are the different locking approaches?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606190"> </A>How can I prevent users from overwriting the work of others?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606191"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606192"> </A>Locking</LI><LI CLASS="Bulleted"><A NAME="pgfId=606193"> </A>Optimistic</LI><LI CLASS="Bulleted"><A NAME="pgfId=606194"> </A>Pessimistic</LI><LI CLASS="Bulleted"><A NAME="pgfId=606195"> </A>Forced</LI><LI CLASS="Bulleted"><A NAME="pgfId=606196"> </A>Application-level</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606197"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606198"> </A>10 July, 1998. Paul Haddad. First Draft.</P><P CLASS="Body"><A NAME="pgfId=616989"> </A>18 November, 1998. Terry Donoghue. Second Draft.</P><P CLASS="Body-Text"><A NAME="pgfId=606199"> </A></P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.29.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.2b.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>