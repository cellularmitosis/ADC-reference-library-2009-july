<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Installing a VBL Task (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING82></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-81.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-83.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-74.html"><B>Chapter 4 - Vertical Retrace Manager</B></A> / <A HREF="Processes-81.html"><B>Using the Vertical Retrace Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING82-0></A>
<H2><A NAME=MARKER-9-83></A>Installing a VBL Task</H2>
 For any particular VBL task, you need to decide whether to install it as a system-based VBL task or as a slot-based VBL task. You need to install a task as a slot-based VBL task only if the execution of the task needs to be synchronized with the retrace rate of a particular external monitor. If the task performs no processing that is likely to affect the appearance of the screen or that depends on the state of an external monitor, it is probably safe to install the task as a system-based VBL task.<P>
<DL>
<DT><B>WARNING</B>
<DD>If you do decide that the execution of some VBL task needs to be synchronized with the retrace rate of a monitor, you should first check that the <CODE>SlotVInstall</CODE> function is available in the operating environment. You can do this by calling the <CODE>TrapAvailable</CODE> function defined in the chapter "Gestalt Manager" in <I><A HREF="../OSUtilities/OSUtilities-2.html">Inside Macintosh: Operating System Utilities</A></I>. If you call <CODE>SlotVInstall</CODE> and it is not available, your application will crash.<B></B>  <B>&#183;</B>
</DL>
 If you are uncertain whether to install a task as a system-based or as a slot-based VBL task, you should first install it as a system-based task (by calling <CODE>VInstall</CODE>). Then test your application on a modular Macintosh computer with an external monitor whose refresh rate is different from the refresh rate on a compact Macintosh computer (approximately 60.15 Hz). If any screen updating that occurs as a result of processing done by your VBL task has an unacceptable appearance, you probably need to install the task as a slot-based VBL task (by calling <CODE>SlotVInstall</CODE>). Remember, however, to check whether <CODE>SlotVInstall</CODE> is available before you call it; if it isn't available, call <CODE>VInstall</CODE>. You can determine whether <CODE>SlotVInstall</CODE> is available by calling the <CODE>SlotRoutinesAvailable</CODE> function defined in <A HREF=#MARKER-9-88>Listing 4-1</A>.<A NAME=MARKER-2-86></A><A NAME=MARKER-2-87></A><P>
<B>Listing 4-1  <A NAME=MARKER-9-88></A>Checking whether you can use slot-based VBL routines</B><P>
<PRE>
FUNCTION SlotRoutinesAvailable: Boolean;
CONST
   _SlotVInstall = $A06F;
BEGIN
   SlotRoutinesAvailable := TrapAvailable(_SlotVInstall);
END;
</PRE>
 If the slot-based routines are available and you want to use them, you need to know the slot number of the video device to whose retrace the VBL task is to be synchronized. <A HREF=#MARKER-9-89>Listing 4-2</A> illustrates a way to find the slot number of the main graphics device. To access the device control entry for the main graphics device, you must first find the device's reference number. Then<DFN> </DFN>you can cast the device control entry into type <CODE>AuxDCEHandle</CODE> and access the slot number directly. You can use a similar technique to find the slot number of some other graphics device.<P>
<B>Listing 4-2  <A NAME=MARKER-9-89></A>Determining the slot number of the main graphics device</B><P>
<PRE>
FUNCTION MainSlotNumber: Integer;
VAR
   mainDeviceRefNum: Integer;    {number of main graphics device}
BEGIN
   mainDeviceRefNum := GetMainDevice^^.gdRefNum;
   MainSlotNumber := 
      AuxDCEHandle(GetDCtlEntry(mainDeviceRefNum))^^.dCtlSlot;
END;
</PRE>
<DL>
<DT><B>Note</B>
<DD>For the sake of simplicity, the remainder of this chapter illustrates how to use the Vertical Retrace Manager to handle system-based VBL tasks only. Virtually all of the techniques shown here, however, can be used in connection with slot-based VBL tasks as well.<B></B>  <B>&#183;</B>
</DL>
 The <CODE>InstallVBL</CODE> function defined in <A HREF=#MARKER-9-90>Listing 4-3</A> shows how to fill in a VBL task record and install it in the system-based VBL queue. It assumes that the task record <CODE>gMyVBLTask</CODE> is a global variable of type <CODE>VBLTask</CODE> and that you have already defined the procedure <CODE>DoVBL</CODE>, the actual VBL task. That procedure is subject to all of the usual limitations on VBL and other interrupt tasks. Also, if <CODE>DoVBL</CODE> is to be executed recurrently, it must reset the <CODE>vblCount</CODE> field of the task record each time it is executed. The next section, <A HREF=Processes-83.html#MARKER-9-91>"Accessing a Task Record at Interrupt Time,"</A> describes how to do this.<P>
<B>Listing 4-3  <A NAME=MARKER-9-90></A>Initializing and installing a task record</B><P>
<PRE>
FUNCTION InstallVBL: OSErr;
CONST
   kInterval = 6;                {frequency in interrupts}
BEGIN
   WITH gMyVBLTask DO            {initialize the VBL task}
      BEGIN
         qType := ORD(vType);    {set queue type}
         vblAddr := @DoVBL;      {set address of VBL task}
         vblCount := kInterval;  {set task frequency}
         vblPhase := 0;          {no phase}
      END;

   InstallVBL := VInstall(@gMyVBLTask);
END;
</PRE>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-81.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-83.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
