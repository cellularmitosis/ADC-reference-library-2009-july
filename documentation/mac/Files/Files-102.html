<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Master Directory Blocks (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING102></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-101.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-103.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-99.html"><B>Data Organization on Volumes</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING102-0></A>
<H2><A NAME=MARKER-9-459></A>Master Directory Blocks</H2>
 <A NAME=MARKER-2-460></A>A <B>master directory block</B> (MDB)--also sometimes known as a <B>volume information block</B> (VIB)--contains information about the rest of the volume. This information is written into the MDB when the volume is initialized. Thereafter, whenever the volume is mounted, the File Manager reads the information in the MDB and copies some of that information into a volume control block (VCB). A VCB is a private data structure maintained in memory by the File Manager (in the VCB queue). The structure of a VCB is described in <A HREF=Files-109.html#MARKER-9-623>"Volume Control Blocks,"</A> later in this chapter.<A NAME=MARKER-2-461></A><A NAME=MARKER-2-462></A><A NAME=MARKER-2-463></A><P>
 Note in <A HREF=Files-100.html#MARKER-9-425>Figure 2-5</A> (<A HREF=Files-100.html#MARKER-9-425>page 2-56</A>) that a copy of the MDB is located in the next-to-last block in the volume. This copy is updated only when the extents overflow file or the catalog file grows larger. This alternate MBD is intended for use solely by disk utilities.<P>
 The <CODE>MDB</CODE> data type defines a master directory block record.<P>
<PRE>
TYPE MDB          =           {master directory block}
RECORD
   drSigWord:     Integer;    {volume signature}
   drCrDate:      LongInt;    {date and time of volume creation}
   drLsMod:       LongInt;    {date and time of last modification}
   drAtrb:        Integer;    {volume attributes}
   drNmFls:       Integer;    {number of files in root directory}
   drVBMSt:       Integer;    {first block of volume bitmap}
   drAllocPtr:    Integer;    {start of next allocation search}
   drNmAlBlks:    Integer;    {number of allocation blocks in volume}
   drAlBlkSiz:    LongInt;    {size (in bytes) of allocation blocks}
   drClpSiz:      LongInt;    {default clump size}
   drAlBlSt:      Integer;    {first allocation block in volume}
   drNxtCNID:     LongInt;    {next unused catalog node ID}
   drFreeBks:     Integer;    {number of unused allocation blocks}
   drVN:          String[27]; {volume name}
   drVolBkUp:     LongInt;    {date and time of last backup}
   drVSeqNum:     Integer;    {volume backup sequence number}
   drWrCnt:       LongInt;    {volume write count}
   drXTClpSiz:    LongInt;    {clump size for extents overflow file}
   drCTClpSiz:    LongInt;    {clump size for catalog file}
   drNmRtDirs:    Integer;    {number of directories in root directory}
   drFilCnt:      LongInt;    {number of files in volume}
   drDirCnt:      LongInt;    {number of directories in volume}
   drFndrInfo:    ARRAY[1..8] OF LongInt;
                              {information used by the Finder}
   drVCSize:      Integer;    {size (in blocks) of volume cache}
   drVBMCSize:    Integer;    {size (in blocks) of volume bitmap cache}
   drCtlCSize:    Integer;    {size (in blocks) of common volume cache}
   drXTFlSize:    LongInt;    {size of extents overflow file}
   drXTExtRec:    ExtDataRec; {extent record for extents overflow file}
   drCTFlSize:    LongInt;    {size of catalog file}
   drCTExtRec:    ExtDataRec; {extent record for catalog file}
END;
</PRE>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-464></A>drSigWord</CODE>
<DD> The volume signature. For HFS volumes, this field contains $4244; for the obsolete flat MFS volumes, this field contains $D2D7.<A NAME=MARKER-2-465></A><A NAME=MARKER-2-466></A><A NAME=MARKER-2-467></A><A NAME=MARKER-2-468></A>
<DT><CODE><A NAME=MARKER-2-469></A>drCrDate</CODE>
<DD> The date and time of volume creation (initialization).
<DT><CODE><A NAME=MARKER-2-470></A>drLsMod</CODE>
<DD> The date and time the volume was last modified. This is not necessarily when the volume was last flushed.
<DT><CODE><A NAME=MARKER-2-299></A>drAtrb</CODE>
<DD> Volume attributes. Currently the following bits are defined:<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>7<TD>Set if the volume is locked by hardware<TR>
<TD>&nbsp;<TD>8<TD>Set if the volume was successfully unmounted<TR>
<TD>&nbsp;<TD>9<TD>Set if the volume has had its bad blocks spared<TR>
<TD>&nbsp;<TD>15<TD>Set if the volume is locked by software</TABLE>
</CODE>
<DT><CODE><A NAME=MARKER-2-300></A>drNmFls</CODE>
<DD> The number of files in the root directory.
<DT><CODE><A NAME=MARKER-2-301></A>drVBMSt</CODE>
<DD> The first block of the volume bitmap. This field always contains 3 in the current implementation.
<DT><CODE><A NAME=MARKER-2-302></A>drAllocPtr</CODE>
<DD> The number of the allocation block at which the next allocation search will begin. Used internally.
<DT><CODE><A NAME=MARKER-2-303></A>drNmAlBlks</CODE>
<DD> The number of allocation blocks in the volume. Because the value in this field is an integer, a volume can contain at most 65,535 allocation blocks.
<DT><CODE><A NAME=MARKER-2-476></A>drAlBlkSiz</CODE>
<DD> The allocation block size (in bytes). This value must always be a multiple of 512 bytes.
<DT><CODE><A NAME=MARKER-2-304></A>drClpSiz</CODE>
<DD> The default clump size.
<DT><CODE><A NAME=MARKER-2-478></A>drAlBlSt</CODE>
<DD> The location of the first allocation block in the volume.
<DT><CODE><A NAME=MARKER-2-479></A>drNxtCNID</CODE>
<DD> The next unused catalog node ID (directory ID or file ID).
<DT><CODE><A NAME=MARKER-2-480></A>drFreeBks</CODE>
<DD> The number of unused allocation blocks on the volume.
<DT><CODE><A NAME=MARKER-2-481></A>drVN</CODE>
<DD> The volume name. This field consists of a length byte followed <BR>by 27 bytes. Note that the volume name can occupy at most <BR>27 characters; this is an exception to the normal file and directory name limit of 31 characters.
<DT><CODE><A NAME=MARKER-2-482></A>drVolBkUp</CODE>
<DD> The date and time of the last volume backup.
<DT><CODE><A NAME=MARKER-2-483></A>drVSeqNum</CODE>
<DD> Volume backup sequence number. Used internally.
<DT><CODE><A NAME=MARKER-2-484></A>drWrCnt</CODE>
<DD> The volume write count (that is, the number of times the volume has been written to).
<DT><CODE><A NAME=MARKER-2-485></A>drXTClpSize</CODE>
<DD> The clump size for the extents overflow file.
<DT><CODE><A NAME=MARKER-2-486></A>drCTClpSize</CODE>
<DD> The clump size for the catalog file.
<DT><CODE><A NAME=MARKER-2-487></A>drNmRtDirs</CODE>
<DD> The number of directories in the root directory.
<DT><CODE><A NAME=MARKER-2-488></A>drFilCnt</CODE>
<DD> The number of files on the volume.
<DT><CODE><A NAME=MARKER-2-489></A>drDirCnt</CODE>
<DD> The number of directories on the volume.
<DT><CODE><A NAME=MARKER-2-490></A>drFndrInfo</CODE>
<DD> Information used by the Finder. See the chapter "Finder Interface" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I> for details on <BR>Finder information.
<DT><CODE><A NAME=MARKER-2-491></A>drVCSize</CODE>
<DD> The size (in allocation blocks) of the volume cache. Used internally.
<DT><CODE><A NAME=MARKER-2-492></A>drVBMCSiz</CODE>e
<DD> The size (in allocation blocks) of the volume bitmap cache. <BR>Used internally.
<DT><CODE><A NAME=MARKER-2-493></A>drCtlCSize</CODE>
<DD> The size (in allocation blocks) of the common volume cache. <BR>Used internally.
<DT><CODE><A NAME=MARKER-2-494></A>drXTFlSize</CODE>
<DD> The size (in allocation blocks) of the extents overflow file.
<DT><CODE><A NAME=MARKER-2-495></A>drXTExtRec</CODE>
<DD> First extent record for the extents overflow file. An extent record is an array of three extents. See <A HREF=Files-106.html#MARKER-9-602>"Extents Overflow Files" on page 2-74</A> for a description of extents and extent records.
<DT><A NAME=MARKER-2-496></A>drCTFlSize
<DD> The size (in allocation blocks) of the catalog file.
<DT><CODE><A NAME=MARKER-2-497></A>drCTExtRec</CODE>
<DD> First extent record for the catalog file.
<DT><B>Note</B>
<DD>The values in the <CODE>drNmAlBlks</CODE> and <CODE>drFreeBks</CODE> fields should be interpreted as unsigned integers (that is, they can range from 0 to 65,535, not from -32,768 to 32,767). Pascal does not support unsigned data types, and so you need to use the technique illustrated in <A HREF=Files-96.html#MARKER-9-379>"Determining the Amount of Free Space on a Volume"</A> on <A HREF=Files-96.html#MARKER-9-379>page 2-46</A> to read the values in these fields correctly.<EM></EM><A NAME=MARKER-2-498></A>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-101.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-103.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
