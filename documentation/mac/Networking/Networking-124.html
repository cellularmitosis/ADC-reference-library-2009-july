<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>dspInit(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING124></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-123.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-125.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-98.html"><B>Chapter 5 - AppleTalk Data Stream Protocol (ADSP) </B></A> / <A HREF="Networking-115.html"><B>ADSP Reference</B></A><BR><DL><DD><A HREF="Networking-122.html"><B>Routines</B></A> / <A HREF="Networking-123.html"><B>Establishing and Terminating an ADSP Connection</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING124-0></A>
<H3><A NAME=MARKER-9-280></A>dspInit</H3>
 The <A NAME=MARKER-2-281></A><CODE>dspInit</CODE> routine establishes a connection end, that is, it assigns a specific socket for the ADSP connection end to use and initializes the variables that ADSP uses to maintain the connection. You<A NAME=MARKER-2-81></A> use the <CODE>PBControl</CODE> function to call the <CODE>dspInit</CODE> routine. See <A HREF=Networking-122.html#MARKER-9-273>"Routines" beginning on page 5-43</A> for a description of the <CODE>PBControl</CODE> function. <P>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The function result. <TR>
<TD>--><TD>ioCRefNum<TD>Integer<TD>The driver reference number.<TR>
<TD>--><TD>csCode<TD>Integer<TD>Always <CODE>dspInit</CODE> for this function.<TR>
<TD><--<TD>ccbRefNum<TD>Integer<TD>The CCB reference number.<TR>
<TD>--><TD>ccbPtr<TD>TPCCB<TD>A pointer to the CCB.<TR>
<TD>--><TD>userRoutine<TD>ProcPtr<TD>A pointer to a routine to call on <BR>connection events.<TR>
<TD>--><TD>sendQSize<TD>Integer<TD>The size in bytes of the send queue.<TR>
<TD>--><TD>sendQueue<TD>Ptr<TD>A pointer to the send queue.<TR>
<TD>--><TD>recvQSize<TD>Ptr<TD>The size in bytes of the receive queue.<TR>
<TD>--><TD>recvQueue<TD>Ptr<TD>A pointer to the receive queue.<TR>
<TD>--><TD>attnPtr<TD>Ptr<TD>A pointer to the buffer for incoming <BR>attention messages.<TR>
<TD><-><TD>localSocket<TD>Byte<TD>The DDP socket number for this <BR>connection end<EM><A NAME=MARKER-2-91></A>.</EM></TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE>csCode</CODE>
<DD> The routine selector, always equal to <CODE>dspInit</CODE> for this routine.
<DT><CODE>ccbRefNum</CODE>
<DD> The connection control block (CCB) reference number. The <CODE>dspInit</CODE> routine returns the CCB reference number for this connection end <BR>as the value of the <CODE>ccbRefNum</CODE> parameter. You must provide this number in all subsequent calls to this connection end.
<DT><CODE><A NAME=MARKER-2-283></A>ccbPtr</CODE>
<DD> A pointer to the CCB that you allocated to be used by this connection end. The CCB is 242 bytes in size and is described in <A HREF=Networking-117.html#MARKER-9-232>"The ADSP Connection Control Block Record" beginning on page 5-35</A>. See also <A HREF=Networking-109.html#MARKER-9-146>"Creating and Using a Connection Control Block" on page 5-12</A>. 
<DT><CODE><A NAME=MARKER-2-284></A>userRoutine</CODE>
<DD> A pointer to a routine that ADSP is to call each time the connection end receives an unsolicited connection event. Specify <CODE>NIL</CODE> for this parameter if you do not want to supply a user routine. Connection events and user routines are discussed in <A HREF=Networking-112.html#MARKER-9-190>"Writing a User Routine for Connection Events" beginning on page 5-26</A>. 
<DT><CODE>sendQSize</CODE>
<DD> The size in bytes of the send queue. A queue size of 600 bytes should work well for most applications. If you are using ADSP to send a continuous flow of data, a larger data buffer improves performance. If your application is sending the user's keystrokes, a smaller buffer should be adequate. The constant <CODE>minDSPQueueSize</CODE> indicates the minimum queue size that you can use.<A NAME=MARKER-2-134></A>
<DT><CODE>sendQueue</CODE>
<DD> A pointer to the send queue that you allocated. <A NAME=MARKER-2-95></A>
<DT><CODE>recvQSize</CODE>
<DD> The size in bytes of the receive queue. A queue size of 600 bytes should work well for most applications. If you are using ADSP to receive a continuous flow of data, a larger data buffer improves performance. If your application is receiving a user's keystrokes, a smaller buffer should be adequate. The constant <CODE>minDSPQueueSize</CODE> indicates the minimum queue size that you can use.<A NAME=MARKER-2-116></A>
<DT><CODE>recvQueue</CODE>
<DD> A pointer to the receive queue that you allocated.<A NAME=MARKER-2-127></A>
<DT><CODE><A NAME=MARKER-13-293></A>attnPtr</CODE>
<DD> A pointer to the attention-message buffer that you allocated. The attention-message buffer must be the size of the constant <CODE>attnBufSize</CODE>.<A NAME=MARKER-2-203></A><A NAME=MARKER-2-46></A>
<DT><CODE>localSocket</CODE>
<DD> The DDP socket number of the socket that you want ADSP to use for this connection end. Specify 0 for this parameter to cause ADSP to assign the socket; in this case, ADSP returns the socket number when the <CODE>dspInit</CODE> routine completes execution.<A NAME=MARKER-2-205></A>
</DL>
<A NAME=HEADING124-13></A>
<H5>DESCRIPTION</H5>
 The <CODE>dspInit</CODE> routine creates and initializes a connection end. The <CODE>dspInit</CODE> routine does not open the connection end or establish a connection with a remote connection end; you must follow the <CODE>dspInit</CODE> routine with the <CODE>dspOpen</CODE> routine to perform <BR>those tasks. <P>
 When you send bytes to a remote connection end, ADSP stores the bytes in a buffer called the <I>send queue.</I> Until the remote connection end acknowledges their receipt, ADSP keeps the bytes you sent in the send queue so that they are available to be retransmitted if necessary. When the local connection end receives bytes, it stores them in a buffer called the <I>receive queue</I> until you read them. <A NAME=MARKER-2-51></A><A NAME=MARKER-2-39></A><P>
 You must allocate memory for the send (<CODE>sendQueue</CODE>) and receive (<CODE>recvQSize</CODE>) queues and for a buffer (<CODE>attnPtr</CODE>) that holds incoming attention messages. You must also allocate a nonrelocatable block of memory (<CODE>ccbPtr</CODE>) for the CCB for this connection end<A NAME=MARKER-2-60></A>. <P>
<A NAME=HEADING124-17></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 You must allocate nonrelocatable memory for the CCB, the s<A NAME=MARKER-2-67></A>end queue, the receive queue, and the attention-message buffer, <A NAME=MARKER-2-302></A>and ensure that the memory remains locked until you explicitly remove the connection end by calling the <CODE>dspRemove</CODE> routine. Do not write any data to this memory except by calling ADSP routines. <P>
<A NAME=HEADING124-19></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <CODE>dspInit</CODE> routine from assembly language, call the <CODE>_Control</CODE> trap macro with a value of <CODE>dspInit</CODE> in the <CODE>csCode</CODE> field of the parameter block. <A NAME=MARKER-2-303></A><P>
<A NAME=HEADING124-21></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>ddpSktErr<TD>-91<TD>Error opening DDP socket<TR>
<TD>errDSPQueueSize<TD>-1274<TD>Send or receive queue is too small</TABLE>
</H5>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-123.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-125.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
