<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TE19: TextEdit Technicalities</title>                                       <meta name="categories" content="Text"><meta name="week-posted" content="Jan 29, 1990 - Feb 2, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002827" title="TextEdit Technicalities"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTextFonts-date.html">Text & Fonts</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/TextFonts/index.html" target="_blank">Reference Library > Text & Fonts</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TE19</div>
<div id="pageheadsub">TextEdit Technicalities</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">TextEdit in 6.0.5</A><BR><BR><A HREF="#Section2">The LineStarts Array and nLines</A><BR><BR><A HREF="#Section3">TESysJust</A><BR><BR><A HREF="#Section4">Forcing Text Direction</A><BR><BR><A HREF="#Section5">A Little More on Redraw in _TESetStyle</A><BR><BR><A HREF="#Section6">TEDispatchRec</A><BR><BR><A HREF="#Section7">Custom Word Breaks</A><BR><BR><A HREF="#Section8">Static and Editable Text</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Changes">Change History</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note discusses some areas in TextEdit that have not previouslybeen clearly documented.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>TextEdit in 6.0.5</h2><p>In addition to all the features of earlier versions, TextEdit 3.0 now allowsyou to take advantage of the Script Manager's handling of systems with morethan one script system installed.  TextEdit uses the Script Manager to supportsuch systems and now exhibits the correct behavior for editing and displayingtext in multiple styles and different scripts.  Multiple scripts can even existon a single line due to TextEdit's use of the Script Manager.  The new versionof TextEdit in 6.0.5:</p><ul type="disc">	<li>handles mixed-directional text</li>	<li>synchronizes keyboards and fonts</li>	<li>handles double-byte characters</li>	<li>determines word boundaries and line breaks</li>	<li>provides outline highlighting in the background</li>	<li>buffers text for performance improvements</li>	<li>permits left justification in right-to-left directional scripts</li>	<li>customizes word breaking</li>	<li>customizes measuring</li></ul><P>Refer to the TextEdit chapter in <i>Inside Macintosh</i>, Volume VI, fordetailed documentation on TextEdit 3.0.</p><P><A HREF="#top">Back to top</A></p><a name="Section2"></a><h2>The LineStarts Array and nLines</h2><p>The <code>LineStarts</code> array is a field in a TextEdit record that contains theoffset position of the first character of <b>each</b> line.  This array has thefollowing boundary conditions:</p><ul type="disc">	<li>It is a zero-based array.</li>	<li>The last entry in the array must have the same value as teLength.</li>	<li>The maximum number of entries is 16,000.</li></ul><p>To determine the length of a line you can use the information contained in the<code>lineStarts</code> array and <code>nLines</code>.  For example, if you want todetermine the length of line n, subtract the value contained in entry n of thearray from the value in the entry (n+1):</p><p>The terminating condition for this measurement is when <code>n = nLines + 1</code>.It is important not to change the information contained in the array.</p><P><A HREF="#top">Back to top</A></p><a name="Section3"></a><h2>TESysJust</h2><p><code>TESysJust</code> is a low-memory global that specifies the system justification.The default value of this global is normally based on the system script.  It is-1 when a system's default line direction is right to left, and 0 for a defaultleft-to-right line direction.  Applications may change the value using theScript Manager routine <code>SetSysJust</code>; however, these applications shouldsave the current value before using it and restore it before exiting theapplication or processing a MultiFinder suspend event.  The current value maybe obtained using the Script Manager routine <code>GetSysJust</code>.</p><P><A HREF="#top">Back to top</A></p><a name="Section4"></a><h2>Forcing Text Direction</h2><p>The original TextEdit documentation introduced <code>_TESetJust</code> with threepossible choices for justification:  <code>teJustLeft</code> (0),<code>teJustCenter</code> (1), and <code>teJustRight</code> (-1).  These choices areappropriate for script systems that are read from left to right.  However, inscript systems that are read from right to left, text is incorrectly displayedas left justified in dialog boxes and in other areas of applications whereusers cannot explicitly set the justification.  To fix this problem, thebehavior of <code>teJustLeft</code> has changed to match the line direction of thesystem in use, which is the value stored in <code>TESysJust</code>.  Anotherconstant has been added to allow an application to force left justification:<code>teForceLeft</code> (-2).  This constant has been available for some time, butit has not been documented until now.  If your application does not allow theuser to change the justification, then it should use <code>teJustLeft</code>; if itdoes, then it should use <code>teForceLeft</code> for left justification.</p><P><A HREF="#top">Back to top</A></p><a name="Section5"></a><h2>A Little More on Redraw in _TESetStyle</h2><p>If the <code>redraw</code> parameter used in <code>_TESetStyle</code> is<code>FALSE</code>, line breaks, line heights, and line ascents are notrecalculated.  Therefore a succeeding call to a routine using any of thisinformation does not reflect the new style information.  For example, a call to<code>_TEGetHeight</code> (which returns a total height between two specifiedlines) uses the line height set previous to the <code>_TESetStyle</code> call.  Acall to <code>_TECalText</code> is necessary to update this information.  If<code>redraw</code> is <code>TRUE</code>, the current style information is reflected.This behavior also holds for the <code>redraw</code> parameter in<code>_TEReplaceStyle</code>.</p><P><A HREF="#top">Back to top</A></p><a name="Section6"></a><h2>TEDispatchRec</h2><p>There is currently space reserved for four documented hooks in the<code>TEDispatchRec</code>:  <code>TEEolHook</code>, <code>TEWidthHook</code>,<code>TEDrawHook</code> and <code>TEHitTestHook</code>.  The space beyond these hooksis reserved, and any attempt to use this private area results in corruptedTextEdit data.</p><P><A HREF="#top">Back to top</A></p><a name="Section7"></a><h2>Custom Word Breaks</h2><p>A problem exists in one of TextEdit's advanced procedures,<code>SetWordBreak</code>.  The current glue code does not preserve the state ofthe registers correctly; however, the solution is fairly simple.  Instead ofcalling <code>SetWordBreak</code> and passing a pointer to your custom word breakroutine, pass the pointer to your external glue which should call your customword break routine.  Following is the glue code that correctly handles theregisters:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>WordBreakProc    PROC       EXPORT                 IMPORT     MYWORDBREAK        ;Must be uppercase here                 MOVEM.L    D1-D2/A1,-(SP)                 CLR.W      -(SP)              ;Space for result                 MOVE.L     A0,-(SP)           ;Move the ptr to stack                 MOVE.W     D0,-(SP)           ;Move the charpos to Stack                 JSR        MYWORDBREAK                 MOVE.W     (SP)+,D0           ;Set Z bit                 MOVEM.L    (SP)+,D1-D2/A1                 RTS</pre>	</TD></TR></TABLE></CENTER><p>An external declaration is also necessary:</p><p>as is the function itself.  One thing that should be noted is that it is notreally necessary to have <code>MyWordBreak</code> boolean, but rather to have the<code>Z</code> bit set properly.  The result of the function should be zero whenyou do not want a break; otherwise, a non-zero value indicates a break isdesired.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    FUNCTION MyWordBreak( text : Ptr; charPos : INTEGER ) : INTEGER;</pre>	</TD></TR></TABLE></CENTER><p>For more information, refer to the TextEdit chapter of <i>Inside Macintosh</i>,Volume I-380.</p><P><A HREF="#top">Back to top</A></p><a name="Section8"></a><h2>Static and Editable Text</h2><p>The Dialog Manager depends on TextEdit to display text in dialog boxes.  For aneditable text field, the Dialog Manager simply calls <code>_TEUpdate</code>.Before making this call, it may double the width of the rectangle to containthe text if the height of the rectangle is sufficient for only one line and theline direction specified by <code>TESysJust</code> is left to right.  In this case,the Dialog Manager extends the rectangle on the right.  Note, however, thisdoes not occur when your line direction is right to left.</p><p>For static text items, <code>_TextBox</code> is used instead.  When the displayrectangle is not large enough. <code>_TextBox</code> clips the text to the size ofthe specified rectangle.  To avoid the clipping problem, simply make thedisplay rectangle larger.  If your dialog box contains both static and editabletext items, the difference in the text handling may appear inconsistent.</p><P><A HREF="#top">Back to top</A></p><a name = "References"></a><h2>References</h2><P><i>Inside Macintosh</i>, Volumes I,V &amp; VI, TextEdit</p><P><i>Inside Macintosh</i>, Volume V, The Script Manager</p><P><i>Inside Macintosh,</i> Volume I, The Dialog Manager</p><P>M.TE.TestEditChanges</p><P><A NAME=changes></A></P>                  <H2>Change History</H2>                                   <TABLE BORDER=0 CELLPADDING=3 WIDTH=544>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-April-1990</P>               </TD>               <td align="left">                  <P>Added a note about the changes in TextEditfor System Software 6.0.5, documented the low-memory global <code>TESysJust,</code>clarified information about text direction and <code>_TESetJust</code>,discussed problems with the <code>SetWordBreak</code> routine along with a solutionto work around it, and described the differences in dialog text item behavior.</P>               </TD>            </TR>            <TR>               <td width=100 align=left>                  <P ALIGN=center>01-February-1990</P>               </TD>               <td align="left">                  <P>Originally written.</P>               </TD>            </TR>         </TABLE><a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/te_19.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/te/te_19.html%3Fid%3DDTS10002827-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/te/te_19.html%3Fid%3DDTS10002827-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/te/te_19.html%3Fid%3DDTS10002827-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>