<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>TextNameTool - /TNT.pl</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">TextNameTool</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">TextNameTool</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/TNT.pl</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/DrawUnicodeString.c</option>
<option value="listing2.html">/DrawUnicodeString.h</option>
<option value="listing3.html">/main.c</option>
<option value="listing4.html">/PixOps.c</option>
<option value="listing5.html">/PixOps.h</option>
<option value="listing6.html">/readme.txt</option>
<option value="listing7.html">/TextUtilities.c</option>
<option value="listing8.html">/TextUtilities.h</option>
<option value="listing9.html">/TNT.pl</option></select>
				</p>
				</form>
				<p><strong><a href="TextNameTool.zip">Download Sample</a></strong> (&#147;TextNameTool.zip&#148;, 114.0K)<BR>
<strong><a href="TextNameTool.dmg">Download Sample</a></strong> (&#147;TextNameTool.dmg&#148;, 178.7K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">#!/usr/bin/perl -w


# Description:
# 
# TextNameTool
# a tool for generating rasterized images of text using nice looking fonts.
# this file contains a number of utilities for the graphical titles
# 
# Copyright:   (c) Copyright 2003 Apple Computer, Inc. All rights reserved.
# 
# Disclaimer:  IMPORTANT:  This Apple software is supplied to you by
# Apple Computer, Inc.  (&quot;Apple&quot;) in consideration of your agreement to the
# following terms, and your use, installation, modification or
# redistribution of this Apple software constitutes acceptance of these
# terms.  If you do not agree with these terms, please do not use, install,
# modify or redistribute this Apple software.
# 
# In consideration of your agreement to abide by the following terms, and
# subject to these terms, Apple grants you a personal, non-exclusive
# license, under Apple's copyrights in this original Apple software (the
# &quot;Apple Software&quot;), to use, reproduce, modify and redistribute the
# Apple Software, with or without modifications, in source and/or binary
# forms; provided that if you redistribute the Apple Software in its
# entirety and without modifications, you must retain this notice and
# the following text and disclaimers in all such redistributions of
# the Apple Software.  Neither the name, trademarks, service marks or
# logos of Apple Computer, Inc. may be used to endorse or promote
# products derived from the Apple Software without specific prior
# written permission from Apple.  Except as expressly stated in this notice,
# no other rights or licenses, express or implied, are granted by Apple
# herein, including but not limited to any patent rights that may be
# infringed by your derivative works or by other works in which the Apple
# Software may be incorporated.
# 
# The Apple Software is provided by Apple on an &quot;AS IS&quot; basis.  APPLE MAKES NO
# WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION THE IMPLIED
# WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND OPERATION ALONE OR IN
# COMBINATION WITH YOUR PRODUCTS.
# 
# IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
# GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, MODIFICATION AND/OR
# DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED AND WHETHER UNDER THEORY
# OF CONTRACT, TORT (INCLUDING NEGLIGENCE), STRICT LIABILITY OR OTHERWISE,
# EVEN IF APPLE HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.



use strict;
use FileHandle;


########## I M P O R T A N T ##########
# set this variable to the path to the
# text name tool, where ever you happen to put it
# on your system.

my $tnt_path_to_tool = &quot;build/TextNameTool&quot;;



my %tnt_ascii_to_xml_table = (
  &quot;&gt;&quot; =&gt; &quot;gt&quot;,
  &quot;&lt;&quot; =&gt; &quot;lt&quot;,
  &quot;&amp;&quot; =&gt; &quot;amp&quot;,
  &quot;\&quot;&quot; =&gt; &quot;quot&quot;,
  &quot;\'&quot; =&gt; &quot;apos&quot;
);

my %tnt_xml_to_ascii_table = reverse %tnt_ascii_to_xml_table;


sub tnt_xml_entity_char ($) {
  my ($entity) = @_;
  my $thechar = $tnt_xml_to_ascii_table{$entity};
  unless ($thechar) {
    die &quot;unrecognized xml entity $entity&quot;;
  }
  return $thechar;
}

sub tnt_decode_xml_string ($) {
  my ($encodedstring) = @_;
  $encodedstring =~ s/\&amp;([a-zA-Z]+|\#[0-9]+)\;/tnt_xml_entity_char($1)/ge;
  return $encodedstring;
}



sub tnt_xml_char_entity ($) {
  my ($thechar) = @_;
  my $entity = $tnt_ascii_to_xml_table{$thechar};
  if ($entity) {
    return &quot;\&amp;$entity;&quot;;
  } else {
    return $thechar;
  }
}

sub tnt_encode_xml_string ($) {
  my ($encodedstring) = @_;
  $encodedstring =~ s/(.)/tnt_xml_char_entity($1)/ge;
  $encodedstring =~ s/\t/    /g;
  return $encodedstring;
}


sub tnt_get_xml_section ($$) {
  my ($textdata, $tagname) = @_;
  $tagname = quotemeta($tagname);
  if ($textdata =~ m/&lt;$tagname&gt;(.*?)&lt;\/$tagname&gt;/is) {
    my $data = $1;
    return $data ;
  } else {
    return &quot;&quot;;
  }
}

sub tnt_get_all_xml_sections ($$) {
  my ($textdata, $tagname) = @_;
  my @section_list;
  $tagname = quotemeta($tagname);
  @section_list = ($textdata =~ m/&lt;$tagname&gt;(.*?)&lt;\/$tagname&gt;/gis);
  return @section_list;
}




sub tnt_do_unix_command($) {
  my ($unix_command) = @_;
  my ($command_data, $inbuf);
  open(COMMANDFILEHANDLE, '-|', $unix_command) or die &quot;error piping from '$unix_command': $!&quot;;
  $command_data = &quot;&quot;;
  while (read(COMMANDFILEHANDLE, $inbuf, (1024*16)) != 0) {
    $command_data .= $inbuf;
  }
  close(COMMANDFILEHANDLE);
  return $command_data;
}




# returns the help text
sub tnt_help_text () {
    # query the tool for the dimensions
  my $xml = tnt_do_unix_command(&quot;$tnt_path_to_tool -h&quot;);
  if (tnt_get_xml_section($xml, 'status') eq 'ok') {
    return tnt_decode_xml_string(tnt_get_xml_section($xml, 'help'));
  } else {
    die(tnt_decode_xml_string(tnt_get_xml_section($xml, 'message')));
  }
}


# returns a list of the names of all of the fonts available
sub tnt_list_fonts () {
    # query the tool for the dimensions
  my $xml = tnt_do_unix_command(&quot;$tnt_path_to_tool -L&quot;);
  if (tnt_get_xml_section($xml, 'status') eq 'ok') {
    my $fontsxml = tnt_get_xml_section($xml, 'fonts');
    my @fontlist = tnt_get_all_xml_sections ($fontsxml, 'font');
    my ($nth, @fontnames);
    foreach $nth (@fontlist) {
      @fontnames = (@fontnames, tnt_decode_xml_string(tnt_get_xml_section($nth, 'name')));
    }
    return @fontnames;
  } else {
    die(tnt_decode_xml_string(tnt_get_xml_section($xml, 'message')));
  }
}


# returns the width and height of a graphics file
sub tnt_graphics_file_bounds ($) {
  my ($filename) = @_;
    # encode the file name
  my $qfilename = quotemeta($filename);
    # query the tool for the dimensions
  my $xml = tnt_do_unix_command(&quot;$tnt_path_to_tool -i $qfilename&quot;);
  if (tnt_get_xml_section($xml, 'status') eq 'ok') {
    my $imagexml = tnt_get_xml_section($xml, 'investigated-image');
    my $width = tnt_get_xml_section($imagexml, 'width');
    my $height = tnt_get_xml_section($imagexml, 'height');
    return ($width, $height);
  } else {
    die(tnt_decode_xml_string(tnt_get_xml_section($xml, 'message')));
  }
}


# creates an image file, returning the width and height as a list
# options are provided as a hash reference in the third parameter
# comments below explain what they are
sub tnt_make_image ($$$) {
  my ($filename, $titlestring, $options) = @_;
    # encode the file nameand message
  my $qfilename = quotemeta($filename);
  my $qtitlestring = quotemeta($titlestring);
  my $commandline = &quot;$tnt_path_to_tool -o $qfilename -m $qtitlestring&quot;;
    # add other options
  if ($$options{FONT}) { $commandline .= (&quot; -f &quot; . quotemeta($$options{FONT})); } # use one of the names returned by tnt_list_fonts
  if ($$options{SIZE}) { $commandline .= (&quot; -s &quot; . quotemeta($$options{SIZE})); }
  if ($$options{WIDTH}) { $commandline .= (&quot; -w &quot; . quotemeta($$options{WIDTH})); }
  if ($$options{BACKGROUND}) { $commandline .= (&quot; -r &quot; . quotemeta($$options{BACKGROUND})); } # path to file
  if ($$options{MEASURE}) { $commandline .= &quot; -t&quot;; } # don't make the file, just measure it
  if ($$options{LINESPACING}) { $commandline .= (&quot; -p &quot; . quotemeta($$options{LINESPACING})); }
  if ($$options{QUALITY}) { $commandline .= (&quot; -q &quot; . quotemeta($$options{QUALITY})); } # high, min, low, normal, high, max
  if ($$options{BORDER}) { $commandline .= (&quot; -b &quot; . quotemeta($$options{BORDER})); } # see help
  if ($$options{BOLD}) { $commandline .= &quot; -a b&quot;; }
  if ($$options{ITALIC}) { $commandline .= &quot; -a i&quot;; }
  if ($$options{UNDERLINE}) { $commandline .= &quot; -a u&quot;; }
  if ($$options{CONDENSE}) { $commandline .= &quot; -a c&quot;; }
  if ($$options{EXTEND}) { $commandline .= &quot; -a e&quot;; }
  if ($$options{ATTRIBUTES}) { $commandline .= (&quot; -a &quot; . quotemeta($$options{ATTRIBUTES})); } # font attributes
  if ($$options{FORMAT}) { $commandline .= (&quot; -k &quot; . quotemeta($$options{FORMAT})); } # jpg or png
  if ($$options{QUICKDRAW}) { $commandline .= &quot; -d&quot;; } # 4 bit quickdraw
  if ($$options{COLOR}) { $commandline .= (&quot; -c &quot; . quotemeta($$options{COLOR})); } # see help
  if ($$options{LINEBREAKS}) { $commandline .= &quot; -n &quot;; }
  if ($$options{HTML}) { $commandline .= &quot; -e &quot;; } # message is encoded as html text &amp;amp;, &amp;gt; and so forth...
    # query the tool for the dimensions
  my $xml = tnt_do_unix_command($commandline);
  if (tnt_get_xml_section($xml, 'status') eq 'ok') {
    my $imagexml = tnt_get_xml_section($xml, 'generated-image');
    my $width = tnt_get_xml_section($imagexml, 'width');
    my $height = tnt_get_xml_section($imagexml, 'height');
    return ($width, $height);
  } else {
    die(tnt_decode_xml_string(tnt_get_xml_section($xml, 'message')));
  }
}



# example, generating images for all fonts:
# 
# eval { # use eval to trap errors
# 
#     my @fonts = tnt_list_fonts();
#     my $nth;
#     foreach $nth (@fonts) {
#         tnt_make_image(
#             &quot;/Users/johnmont/document_index_tools/textnametool/fonts/$nth.jpg&quot;,
#             &quot;A quick brown fox jumps over the lazy dog.&quot;,
#             {FONT =&gt; $nth, SIZE =&gt; 46, BORDER =&gt; 'auto'});
#     }
# };
# if ($@) { # display any errors we trapped....
#     my $errtext = $@;
#     print &quot;error: $errtext\n&quot;;
# }
# 



1;

</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/TextNameTool/listing9.html%3Fid%3DDTS10000647-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/TextNameTool/listing9.html%3Fid%3DDTS10000647-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/TextNameTool/listing9.html%3Fid%3DDTS10000647-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>