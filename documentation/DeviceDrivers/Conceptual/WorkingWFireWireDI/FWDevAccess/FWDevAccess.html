<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>FireWire Device Interface Guide: Accessing FireWire Devices From Applications</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Accessing FireWire Devices From Applications"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000969-CH202" title="Accessing FireWire Devices From Applications"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../HardwareDrivers/index.html#//apple_ref/doc/uid/TP30000440-TP40003576" target="_top">Hardware &amp; Drivers</a> &gt; <a href="../../../../HardwareDrivers/FireWire-date.html#//apple_ref/doc/uid/TP30000440-TP40003576-TP30000511" target="_top">FireWire</a> &gt; <a href="../FWDevIntro/FWDevintro.html#//apple_ref/doc/uid/TP40000969-CH205-BABGJCGG">FireWire Device Interface Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../FWDevOverview/FWDevOverview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../FWDevInterfaces/FWChapter.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000969-CH202-TPXREF101" title="Accessing FireWire Devices From Applications"></a><h1>Accessing FireWire Devices From Applications</h1><p>The device interfaces the FireWire family provides are plug-ins that supply functions your application can call to communicate with or control a device. This chapter describes how to find a FireWire device and get one or more device interfaces to communicate with it.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHFHJDE">Device Matching for FireWire Devices</a>
				
			<br/>
			
        
			
			
				<a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHCIBDB">Finding FireWire Devices</a>
				
			<br/>
			
        
			
			
				<a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHEAIEE">Getting FireWire Device Interfaces</a>
				
			<br/>
			
        
			
			
				<a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHJACIJ">Getting Multiple FireWire Device Interfaces</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40000969-CH202-CCHFHJDE" title="Device Matching for FireWire Devices"></a><h2>Device Matching for FireWire Devices</h2><p>All user-level access of a device begins with a Mach port to communicate with the I/O Kit. You get a Mach port by calling the I/O Kit function <code>IOMasterPort</code>, as in the following example:</p><div class="codesample"><table><tr><td scope="row"><pre>kern_return_t   result;<span></span></pre></td></tr><tr><td scope="row"><pre>mach_port_t     masterPort;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = IOMasterPort( MACH_PORT_NULL, &amp;masterPort );<span></span></pre></td></tr></table></div><p>In order to find a device, you create a matching dictionary that describes the device or device type you’re interested in. The I/O Kit function <code>IOServiceMatching</code> creates a dictionary that matches on a given class name, as in this example:</p><div class="codesample"><table><tr><td scope="row"><pre>CFMutableDictionaryRef  matchingDictionary = IOServiceMatching<span></span></pre></td></tr><tr><td scope="row"><pre>                                                ( "IOFireWireDevice" );<span></span></pre></td></tr></table></div><p>In this example, you can use <code>matchingDictionary</code> to find all devices currently represented by an IOFireWireDevice object in the I/O Registry. <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHHCJCE">Table 2-1</a></span> lists the FireWire class names you can use to create a matching dictionary.</p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHHCJCE" title="Table 2-1FireWire class names"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>FireWire class names</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Class name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th></tr><tr><td  scope="row"><p>IOFireWireSBP2Target</p></td><td ><p>A unit in a device that is an SBP-2 target</p></td></tr><tr><td  scope="row"><p>IOFireWireSBP2LUN</p></td><td ><p>A LUN in an SBP-2 target</p></td></tr><tr><td  scope="row"><p>IOFireWireAVCUnit</p></td><td ><p>An AV/C unit in a device</p></td></tr><tr><td  scope="row"><p>IOFireWireUnit</p></td><td ><p>A unit in a device</p></td></tr><tr><td  scope="row"><p>IOFireWireDevice</p></td><td ><p>A device on the FireWire Bus</p></td></tr><tr><td  scope="row"><p>IOFireWireLocalNode</p></td><td ><p>The Macintosh itself</p></td></tr></table></div><p>If you do not need to perform a more specific search, the dictionary <code>IOServiceMatching</code> creates will be sufficient to find all devices of a particular class currently in the I/O Registry.</p><p>If you want to refine your search, you can add properties to the dictionary to describe a unique device. As described in <span class="content_text"><a href="../FWDevOverview/FWDevOverview.html#//apple_ref/doc/uid/TP40000969-CH201-BBIDHAFI">“In-Kernel FireWire Device Support,”</a></span> the IOFireWire family places properties that describe each device and unit into the objects that represent them in the I/O Registry. You can use any of these properties to narrow down your search for a specific device or unit. <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHHJHEG">Table 2-2</a></span> shows the properties available in each object. </p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHHJHEG" title="Table 2-2FireWire class properties"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-2&nbsp;&nbsp;</strong>FireWire class properties</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Class name</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property key</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Type</p></th></tr><tr><td rowspan="7"  scope="row"><p>IOFireWireDevice</p></td><td ><p><code>FireWire Node ID</code></p></td><td ><p>Current node ID </p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Vendor_ID</code></p></td><td ><p>Device vendor ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Device ROM</code></p></td><td ><p>Currently read contents of config ROM (may not contain entire ROM contents)</p></td><td ><p><code>CFData</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Vendor Name</code></p></td><td ><p>Device vendor name</p></td><td ><p><code>CFString</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Self IDs</code></p></td><td ><p>Self IDs received from device</p></td><td ><p><code>CFData</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Speed</code></p></td><td ><p>Current operating speed of device</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>GUID</code></p></td><td ><p>Globally unique ID of device</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td rowspan="6"  scope="row"><p>IOFireWireUnit</p></td><td ><p><code>Vendor_ID</code></p></td><td ><p>Device vendor ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Vendor Name</code></p></td><td ><p>Device vendor name</p></td><td ><p><code>CFString</code></p></td></tr><tr><td  scope="row"><p><code>GUID</code></p></td><td ><p>Globally unique ID of unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_Spec_ID</code></p></td><td ><p>Unit spec ID for this unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_SW_Version</code></p></td><td ><p>Unit software version of unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Product Name</code></p></td><td ><p>Product name of device</p></td><td ><p><code>CFString</code></p></td></tr><tr><td rowspan="9"  scope="row"><p>IOFireWireSBP2Target</p></td><td ><p><code>Command_Set</code></p></td><td ><p>SBP2 command set</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Command_Set_Revision</code></p></td><td ><p>SBP2 command set revision</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_Spec_ID</code></p></td><td ><p>Unit spec ID for FireWire unit provider of this SBP-2 target</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Command_Set_Spec_ID</code></p></td><td ><p>SBP-2 command set spec ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>GUID</code></p></td><td ><p>Globally unique ID for this device</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Vendor_ID</code></p></td><td ><p>Device vendor ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Device_Type</code></p></td><td ><p>SBP-2 device type</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Firmware_Revision</code></p></td><td ><p>SBP-2 firmware revision</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_SW_Version</code></p></td><td ><p>Unit software version for this unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td rowspan="7"  scope="row"><p>IOFireWireSBP2LUN</p></td><td ><p><code>Vendor_ID</code></p></td><td ><p>Device vendor ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Command_Set</code></p></td><td ><p>SBP-2 command set</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Command_Set_Spec_ID</code></p></td><td ><p>SBP-2 command set spec ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>GUID</code></p></td><td ><p>Globally unique ID for this device</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Device_Type</code></p></td><td ><p>SBP-2 device type</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Firmware_Revision</code></p></td><td ><p>SBP-2 firmware revision</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>IOUnit</code></p></td><td ><p>SBP-2 LUN number</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td rowspan="6"  scope="row"><p>IOFireWireAVCUnit</p></td><td ><p><code>Unit_Spec_ID</code></p></td><td ><p>Unit spec ID for this unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_Type</code></p></td><td ><p>AV/C unit type</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Vendor_ID</code></p></td><td ><p>Device vendor ID</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>GUID</code></p></td><td ><p>Globally unique ID for this device</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>Unit_SW_Version</code></p></td><td ><p>Unit software version for this unit</p></td><td ><p><code>CFNumber</code></p></td></tr><tr><td  scope="row"><p><code>FireWire Product Name</code></p></td><td ><p>Name of this product</p></td><td ><p><code>CFString</code></p></td></tr></table></div><p>To use these properties for matching, start with a dictionary from <code>IOServiceMatching</code> and use Core Foundation functions to add property key-value pairs to it. <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHIICII">Listing 2-1</a></span> shows a dictionary that matches on an IOFireWireUnit object with specific <code>Unit_Spec_ID</code> and <code>Unit_SW_Version</code> values:</p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHIICII" title="Listing 2-1A matching dictionary for an IOFireWireUnit object"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>A matching dictionary for an IOFireWireUnit object</p><div class="codesample"><table><tr><td scope="row"><pre>CFMutableDictionaryRef  matchingDictionary =<span></span></pre></td></tr><tr><td scope="row"><pre>                                    IOServiceMatching("IOFireWireUnit" );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>UInt32      value;<span></span></pre></td></tr><tr><td scope="row"><pre>CFNumberRef cfValue;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>value = myFireWireUnitSpecID;<span></span></pre></td></tr><tr><td scope="row"><pre>cfValue = CFNumberCreate( kCFAllocatorDefault, kCFNumberSInt32Type, &amp;value );<span></span></pre></td></tr><tr><td scope="row"><pre>CFDictionaryAddValue( matchingDictionary, CFSTR( "Unit_Spec_ID" ), cfValue );<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease( cfValue );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>value = myFireWireUnitSwVersionID;<span></span></pre></td></tr><tr><td scope="row"><pre>cfValue = CFNumberCreate( kCFAllocatorDefault, kCFNumberSInt32Type, &amp;value );<span></span></pre></td></tr><tr><td scope="row"><pre>CFDictionaryAddValue( matchingDictionary, CFSTR( "Unit_SW_Version" ),<span></span></pre></td></tr><tr><td scope="row"><pre>                        cfValue);<span></span></pre></td></tr><tr><td scope="row"><pre>CFRelease( cfValue );<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHCIBDB" title="Finding FireWire Devices"></a><h2>Finding FireWire Devices</h2><p>After setting up a matching dictionary that describes the device or device type you’re looking for, you pass it to the I/O Kit function <code>IOServiceGetMatchingServices</code>. This function searches the I/O Registry for objects that match the properties in the given dictionary and returns an iterator you can use to access each one:</p><div class="codesample"><table><tr><td scope="row"><pre>kern_return_t   result;<span></span></pre></td></tr><tr><td scope="row"><pre>io_iterator_t   iterator;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = IOServiceGetMatchingServices( masterPort, matchingDictionary,<span></span></pre></td></tr><tr><td scope="row"><pre>    &amp;iterator );<span></span></pre></td></tr></table></div><p>Next, pass the iterator to the I/O Kit function <code>IOIteratorNext</code>, which returns a reference to the first matching object. Each call to <code>IOIteratorNext</code> returns the next available object:</p><div class="codesample"><table><tr><td scope="row"><pre>io_object_t aDevice;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>while ( (aDevice = IOIteratorNext( iterator ) ) != 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    //get a device interface for the device<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You can also use I/O Kit functions to receive device hot-plug and unplug notifications. To do this, you first set up a notification port and add its run loop event source to your program’s run loop. Then, instead of calling <code>IOServiceGetMatchingServices</code>, you send the matching dictionary you created earlier to the I/O Kit function <code>IOServiceAddMatchingNotification</code> to get an iterator for matching device objects and install a notification request for new device objects that match. The function <code>myServiceMatchingCallback</code> is a function you supply to iterate over the matching devices and access each one. <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHEDEAJ">Listing 2-2</a></span> shows how to set up a notification.</p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHEDEAJ" title="Listing 2-2Setting up a device hot-plug notification"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Setting up a device hot-plug notification</p><div class="codesample"><table><tr><td scope="row"><pre>//global variables<span></span></pre></td></tr><tr><td scope="row"><pre>IONotificationPortRef   gNotifyPort;<span></span></pre></td></tr><tr><td scope="row"><pre>CFRunLoopSourceRef      gNotifySource;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//local variables<span></span></pre></td></tr><tr><td scope="row"><pre>io_iterator_t   iterator;<span></span></pre></td></tr><tr><td scope="row"><pre>kern_return_t   result;<span></span></pre></td></tr><tr><td scope="row"><pre>mach_port_t     masterPort;<span></span></pre></td></tr><tr><td scope="row"><pre>CFMutableDictionaryRef  matchingDictionary;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//The acquisition of the Mach port and the creation of the matching<span></span></pre></td></tr><tr><td scope="row"><pre>//dictionary are not shown here.<span></span></pre></td></tr><tr><td scope="row"><pre>gNotifyPort = IONotificationPortCreate( masterPort );<span></span></pre></td></tr><tr><td scope="row"><pre>gNotifySource = IONotificationPortGetRunLoopSource( gNotifyPort );<span></span></pre></td></tr><tr><td scope="row"><pre>CFRunLoopAddSource( CFRunLoopGetCurrent(), gNotifySource,<span></span></pre></td></tr><tr><td scope="row"><pre>    kCFRunLoopDefaultMode );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = IOServiceAddMatchingNotification( gNotifyPort,<span></span></pre></td></tr><tr><td scope="row"><pre>    kIOMatchedNotification, matchingDictionary,<span></span></pre></td></tr><tr><td scope="row"><pre>    myServiceMatchingCallback, NULL, &amp;iterator );<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//IOServiceAddMatchingNotification consumes a reference to the<span></span></pre></td></tr><tr><td scope="row"><pre>//matching dictionary so if you need to use the dictionary again<span></span></pre></td></tr><tr><td scope="row"><pre>//after this call, you must first call CFRetain on it.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//Execute your callback function to iterate over the set of matching<span></span></pre></td></tr><tr><td scope="row"><pre>//devices already present and to arm the notification for future devices.<span></span></pre></td></tr><tr><td scope="row"><pre>myServiceMatchingCallback( NULL, iterator );<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHEAIEE" title="Getting FireWire Device Interfaces"></a><h2>Getting FireWire Device Interfaces</h2><p>After you’ve gotten an iterator and used it to get a reference to each matching device, you need to get a device interface for it. Regardless of which FireWire device interface library you want to use, you first get a plug-in interface of type IOCFPlugInInterface. You use the device’s <code>io_object_t</code> reference you got from <code>IOIteratorNext</code> and the constant <code>kIOFireWireLibTypeID</code>, as in this example:</p><div class="codesample"><table><tr><td scope="row"><pre>IOCFPlugInInterface**   cfPlugInInterface = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>IOReturn                result;<span></span></pre></td></tr><tr><td scope="row"><pre>SInt32                  theScore;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = IOCreatePlugInInterfaceForService( aDevice, kIOFireWireLibTypeID,<span></span></pre></td></tr><tr><td scope="row"><pre>    kIOCFPlugInInterfaceID, &amp;cfPlugInInterface, &amp;theScore );<span></span></pre></td></tr></table></div><p>Then, you use the IOCFPlugInInterface <code>QueryInterface</code> function to get the specific device interface you need. You pass it the identifier of the primary device interface you want to use, for example, <code>kIOFireWireDeviceInterfaceID</code> or <code>kIOFireWireSBP2LibLUNInterfaceID</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>IOFireWireLibDeviceRef  fwDeviceInterface = 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>(*cfPlugInInterface)->QueryInterface( cfPlugInInterface, CFUUIDGetUUIDBytes(<span></span></pre></td></tr><tr><td scope="row"><pre>    kIOFireWireDeviceInterfaceID ), (void **) fwDeviceInterface );<span></span></pre></td></tr></table></div><p>There are three versions of the IOFireWireDeviceInterface you can use. Each version adds new services to the functionality of the previous version. Be sure to check the header files to make sure you’re running the version of Mac OS X that corresponds to the IOFireWireDeviceInterface version you want. If you try to get a later version of IOFireWireDeviceInterface than your version of Mac OS X supports, the <code>QueryInterface</code> function will fail. You can, however, get an earlier version of the interface than is currently supported by the version of Mac OS X you’re running.</p><p>You can also get instances of IOFireWireUnitInterface and IOFireWireNubInterface. These are synonymous with IOFireWireDeviceInterface and refer to the same object. Their only function is to provide you with a more descriptive name for IOFireWireDeviceInterface if you open it on a unit or the local node.</p><p>When you have the primary device interface in the library you want to use, you do not have to use the <code>IOCreatePlugInForService</code> and <code>QueryInterface</code> functions to get the additional interfaces that library provides. Each library provides its own functions to get its other interfaces.</p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHJACIJ" title="Getting Multiple FireWire Device Interfaces"></a><h2>Getting Multiple FireWire Device Interfaces</h2><p>When you open a device or unit using one of the device interface <code>open</code> functions, you have an exclusive connection to the object representing that device or unit in the kernel. Because the <code>open</code> function opens not only the object you call it on but also the objects that precede it in the stack, no other application can then open that device or unit. For example, if you open an AV/C unit with the IOFireWireAVCLibUnitInterface’s <code>open</code> function, you are automatically opening the IOFireWireUnit and IOFireWireDevice objects as well as the IOFireWireAVCUnit object.</p><p>Thus, if you want to use either the IOFireWireSBP2Lib or the IOFireWireAVCLib in cooperation with the IOFireWireLib, you must, in effect, open a device or unit object that is already open. In order to allow this, the IOFireWire family uses the concept of a session reference to refer to a particular connection to a device or unit object.</p><p>A session reference is like a key that allows you to override the exclusivity of the <code>open</code> function. If your application used a device interface <code>open</code> function to open an SBP-2 or AV/C unit, you can use the <code>GetSessionRef</code> function (available in both IOFireWireAVCLib and IOFireWireSBP2Lib) to get an <code>IOFireWireSessionRef</code> to open the IOFireWireUnit or IOFireWireDevice objects. The <code>GetSessionRef</code> function requires a pointer to the current device interface you hold so only your application can successfully use it.</p><p>You pass the <code>IOFireWireSessionRef</code> to the IOFireWireDeviceInterface function <code>openWithSessionRef</code>, opening the in-kernel device or unit object. You can then use the interfaces and functions of both libraries to communicate with your device or unit. <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHEACJF">Listing 2-3</a></span> shows how to use an IOFireWireAVCLibUnitInterface instance to open an AV/C unit and then get the session reference to open the device for an instance of IOFireWireDeviceInterface.</p><a name="//apple_ref/doc/uid/TP40000969-CH202-CCHEACJF" title="Listing 2-3Getting and using the session reference"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Getting and using the session reference</p><div class="codesample"><table><tr><td scope="row"><pre>IOFireWireSessionRef    session;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>result = (*avcInterface)->open( avcInterface );<span></span></pre></td></tr><tr><td scope="row"><pre>session = (*avcInterface)->getSessionRef( avcInterface );<span></span></pre></td></tr><tr><td scope="row"><pre>result = (*fwInterface)->openWithSessionRef( fwInterface, session );<span></span></pre></td></tr></table></div><p>Before you can use these device interfaces, however, you must first find the device you’re interested in. Device matching is the process of using I/O Kit functions to search the I/O Registry for particular devices (or units) or device types. This section provides general information on this process as it applies to FireWire devices. It supplies code fragments for common tasks such as searching the I/O Registry, setting up notifications for new devices, and getting the primary device interfaces in each FireWire device interface library. In addition, in <span class="content_text"><a href="FWDevAccess.html#//apple_ref/doc/uid/TP40000969-CH202-CCHJACIJ">“Getting Multiple FireWire Device Interfaces,”</a></span> it describes how to use the IOFireWireDeviceInterface in conjunction with either the IOFireWireSBP2LibLUNInterface or the IOFireWireAVCLibUnitInterface.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../FWDevOverview/FWDevOverview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../FWDevInterfaces/FWChapter.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-02-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeviceDrivers/Conceptual/WorkingWFireWireDI/FWDevAccess/FWDevAccess.html%3Fid%3DTP40000969-3.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeviceDrivers/Conceptual/WorkingWFireWireDI/FWDevAccess/FWDevAccess.html%3Fid%3DTP40000969-3.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeviceDrivers/Conceptual/WorkingWFireWireDI/FWDevAccess/FWDevAccess.html%3Fid%3DTP40000969-3.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>