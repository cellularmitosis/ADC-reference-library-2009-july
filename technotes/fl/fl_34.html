<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 01-August-01 --><!-- Includes revisions to graphics tags --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note FL34: VCBs and Drive Numbers : The Real Story</title><meta name="keywords" content="Mac OS 8 vcbDrvNum vcbDRefNum mounted volume offline ejected PBHGetVInfo"><meta name="Description" content="Technical Note FL34: This Technical Note clarifies informationdocumented in Inside Macintosh the File Manager page IV-178,about the vcbDRefNum and vcbDrvNum. Technical Note basicallydetails what happens to the vcb fields when a mounted volumeis placed offline or when a volume is ejected.">                                       <meta name="categories" content="Files"><meta name="week-posted" content="Dec 29, 1986 - Jan 2, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002460" title="VCBs and Drive Numbers : The Real Story"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxFileManagement-date.html" target="_blank">Carbon > File Management</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note FL34</div>
<div id="pageheadsub">VCBs and Drive Numbers : The Real Story</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					<A HREF="#Offline">Offline</a><BR><BR> 					<A HREF="#Ejected">Ejected</a><BR><BR> 					<A HREF="#Summary">Summary</a><BR><BR> <A HREF="#References">References</A><BR><BR>   <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">The top of page IV-178 in The File Manager chapter of <i>Inside Macintosh</i>in attempts to explain the behavior of two fields in a volume control blockwhen the corresponding disk is offline or ejected. Due to the fact that alittle bit is left unsaid, this paragraph is rather misleading. The two fieldsin question are <code>vcbDrvNum</code> and <code>vcbDRefNum</code> (referred to as<code>ioVDrvInfo</code> and <code>ioVDRefNum</code> in C and Pascal).<code>PBHGetVInfo</code> can be used to access these fields.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Jan 01 1987]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Offline"></a><h2>Offline</h2><p>When a mounted volume is placed offline, <code>vcbDrvNum</code> is cleared<b>and</b> <code>vcbDRefNum</code> is set to the two's complement of the drivenumber. Since drive numbers are assigned positive values (starting with one),this will be a negative number. If <code>vcbDrvNum</code> is zero <b>and</b><code>vcbDRefNum</code> is negative, you know that the volume is offline.</p><P><A HREF="#top">Back to top</A></P><a name="Ejected"></a><h2>Ejected</h2><p>When a volume is ejected, <code>vcbDrvNum</code> is cleared and <code>vcbDRefNum</code>is set to the positive drive number. If <code>vcbDrvNum</code> is zero and <code>vcbDRefNum</code> is positive, you know that the volume is ejected. Ejection implies being offline. There is no such thing as "premature ejection".</p><P><A HREF="#top">Back to top</A></P><a name="Summary"></a><h2>Summary</h2><p><u>online offline ejected</u></p><pre>vcbDrvNum            &gt;0 (DrvNum)        0            0vcbDRefNum            &lt;0 (DRefNum)        &lt;0 (-DrvNum)        &gt;0 (DrvNum)</pre><p>Please refrain from assuming anything about a VCB queue element beyond what isdocumented in <i>Inside Macintosh</i>, and don't expect it to always be 178 bytes in size. It grew when we went from MFS to HFS, and it may grow again. It's safest to use calls like <code>PBHGetVInfo</code> to get the information that you need.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><p>The File Manager</p><p>Technical Note M.DV.DrvQEl -- <u><A HREF = "../dv/dv_05.html">Drive Queue Element Format</a></u></p><P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/fl_34.pdf">Download</A></P>               </TD>            </TR></table><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/fl/fl_34.html%3Fid%3DDTS10002460-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/fl/fl_34.html%3Fid%3DDTS10002460-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/fl/fl_34.html%3Fid%3DDTS10002460-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML>