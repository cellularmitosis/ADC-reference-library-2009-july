<html><head><title>Mac OS X
 Manual Page For Encoding(3tcl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/3tcl/Encoding" title="Mac OS X
 Manual Page for Encoding(3tcl)"><a name="//apple_ref/doc/man/3/Encoding" title="Mac OS X
 Manual Page for Encoding(3tcl)"><!-- headerDoc=man; indexgroup=Section 3tcl; uid="//apple_ref/doc/man/3tcl/Encoding"; name=Encoding(3tcl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
Tcl_GetEncoding(3)                         Tcl Library Procedures                         <a href="Tcl_GetEncoding.3tcl.html#//apple_ref/doc/man/3/Tcl_GetEncoding">Tcl_GetEncoding(3)</a>



____________________________________________________________________________________________________________

<b>NAME</b>
       Tcl_GetEncoding,  Tcl_FreeEncoding,  Tcl_ExternalToUtfDString, Tcl_ExternalToUtf, Tcl_UtfToExternalD-<font color="#ffffff" class="whiteout">String,&nbsp;Tcl_UtfToExternalDString,</font>
       String, Tcl_UtfToExternal, Tcl_WinTCharToUtf, Tcl_WinUtfToTChar,  Tcl_GetEncodingName,  Tcl_SetSyste-<font color="#ffffff" class="whiteout">mEncoding,&nbsp;Tcl_SetSystemEncoding,</font>
       mEncoding,  Tcl_GetEncodingNames, Tcl_CreateEncoding, Tcl_GetDefaultEncodingDir, Tcl_SetDefaultEncod-<font color="#ffffff" class="whiteout">ingDir&nbsp;Tcl_SetDefaultEncodingDir</font>
       ingDir - procedures for creating and using encodings.

<b>SYNOPSIS</b>
       <b>#include</b> <b>&lt;tcl.h&gt;</b>

       Tcl_Encoding
       <b>Tcl_GetEncoding</b>(<u>interp,</u> <u>name</u>)

       void
       <b>Tcl_FreeEncoding</b>(<u>encoding</u>)

       char *
       <b>Tcl_ExternalToUtfDString</b>(<u>encoding,</u> <u>src,</u> <u>srcLen,</u> <u>dstPtr</u>)

       int
       <b>Tcl_ExternalToUtf</b>(<u>interp,</u> <u>encoding,</u> <u>src,</u> <u>srcLen,</u> <u>flags,</u> <u>statePtr,</u> <u>dst,</u> <u>dstLen,</u> <u>srcReadPtr,</u> <u>dstWrotePtr,</u>
            <u>dstCharsPtr</u>)

       char *
       <b>Tcl_UtfToExternalDString</b>(<u>encoding,</u> <u>src,</u> <u>srcLen,</u> <u>dstPtr</u>)

       int
       <b>Tcl_UtfToExternal</b>(<u>interp,</u> <u>encoding,</u> <u>src,</u> <u>srcLen,</u> <u>flags,</u> <u>statePtr,</u> <u>dst,</u> <u>dstLen,</u> <u>srcReadPtr,</u> <u>dstWrotePtr,</u>
            <u>dstCharsPtr</u>)

       char *
       <b>Tcl_WinTCharToUtf</b>(<u>tsrc,</u> <u>srcLen,</u> <u>dstPtr</u>)

       TCHAR *
       <b>Tcl_WinUtfToTChar</b>(<u>src,</u> <u>srcLen,</u> <u>dstPtr</u>)

       CONST char *
       <b>Tcl_GetEncodingName</b>(<u>encoding</u>)

       int
       <b>Tcl_SetSystemEncoding</b>(<u>interp,</u> <u>name</u>)

       void
       <b>Tcl_GetEncodingNames</b>(<u>interp</u>)

       Tcl_Encoding
       <b>Tcl_CreateEncoding</b>(<u>typePtr</u>)

       CONST char *
       <b>Tcl_GetDefaultEncodingDir</b>(<u>void</u>)

       void
       <b>Tcl_SetDefaultEncodingDir</b>(<u>path</u>)



<b>ARGUMENTS</b>
       Tcl_Interp          <u>*interp</u>        (in)      Interpreter to use for error reporting, or  NULL  if  no
                                                    error reporting is desired.

       CONST char          <u>*name</u>          (in)      Name of encoding to load.

       Tcl_Encoding        <u>encoding</u>       (in)      The encoding to query, free, or use for converting text.
                                                    If <u>encoding</u> is NULL,  the  current  system  encoding  is
                                                    used.

       CONST char          <u>*src</u>           (in)      For  the  <b>Tcl_ExternalToUtf</b> functions, an array of bytes
                                                    in the specified encoding that are to  be  converted  to
                                                    UTF-8.   For the <b>Tcl_UtfToExternal</b> and <b>Tcl_WinUtfToTChar</b>
                                                    functions, an array of UTF-8 characters to be  converted
                                                    to the specified encoding.

       CONST TCHAR         <u>*tsrc</u>          (in)      An  array  of  Windows  TCHAR  characters  to convert to
                                                    UTF-8.

       int                 <u>srcLen</u>         (in)      Length of <u>src</u> or <u>tsrc</u> in bytes.  If the length is  nega-<font color="#ffffff" class="whiteout">tive,&nbsp;negative,</font>
                                                    tive,  the  encoding-specific  length  of  the string is
                                                    used.

       Tcl_DString         <u>*dstPtr</u>        (out)     Pointer to an uninitialized or free <b>Tcl_DString</b> in which
                                                    the converted result will be stored.

       int                 <u>flags</u>          (in)      Various  flag  bits  OR-ed together.  TCL_ENCODING_START
                                                    signifies that the source buffer is the first block in a
                                                    (potentially multi-block) input stream, telling the con-<font color="#ffffff" class="whiteout">version&nbsp;conversion</font>
                                                    version routine to reset to an initial state and perform
                                                    any  initialization that needs to occur before the first
                                                    byte is converted.  TCL_ENCODING_END signifies that  the
                                                    source buffer is the last block in a (potentially multi-<font color="#ffffff" class="whiteout">block)&nbsp;multiblock)</font>
                                                    block) input stream, telling the conversion  routine  to
                                                    perform  any  finalization that needs to occur after the
                                                    last byte is converted and then to reset to  an  initial
                                                    state.  TCL_ENCODING_STOPONERROR signifies that the con-<font color="#ffffff" class="whiteout">version&nbsp;conversion</font>
                                                    version routine should return immediately upon reading a
                                                    source character that doesn't exist in the target encod-<font color="#ffffff" class="whiteout">ing;&nbsp;encoding;</font>
                                                    ing; otherwise a default fallback character  will  auto-<font color="#ffffff" class="whiteout">matically&nbsp;automatically</font>
                                                    matically be substituted.

       Tcl_EncodingState   <u>*statePtr</u>      (in/out)  Used  when  converting  a  (generally long or indefinite
                                                    length) byte stream in a piece by  piece  fashion.   The
                                                    conversion routine stores its current state in <u>*statePtr</u>
                                                    after <u>src</u> (the buffer containing the current piece)  has
                                                    been  converted;  that  state information must be passed
                                                    back when converting the next piece of the stream so the
                                                    conversion  routine  knows  what state it was in when it
                                                    left off at the end of the last piece.  May be NULL,  in
                                                    which  case the value specified for <u>flags</u> is ignored and
                                                    the source buffer is assumed  to  contain  the  complete
                                                    string to convert.

       char                <u>*dst</u>           (out)     Buffer in which the converted result will be stored.  No
                                                    more than <u>dstLen</u> bytes will be stored in <u>dst</u>.

       int                 <u>dstLen</u>         (in)      The maximum length of the output buffer <u>dst</u> in bytes.

       int                 <u>*srcReadPtr</u>    (out)     Filled with the number of bytes from <u>src</u> that were actu-<font color="#ffffff" class="whiteout">ally&nbsp;actually</font>
                                                    ally  converted.   This  may  be  less than the original
                                                    source length if there was  a  problem  converting  some
                                                    source characters.  May be NULL.

       int                 <u>*dstWrotePtr</u>   (out)     Filled  with  the  number  of  bytes  that were actually
                                                    stored in the output buffer as a result of  the  conver-<font color="#ffffff" class="whiteout">sion.&nbsp;conversion.</font>
                                                    sion.  May be NULL.

       int                 <u>*dstCharsPtr</u>   (out)     Filled  with the number of characters that correspond to
                                                    the number of bytes stored in the output buffer.  May be
                                                    NULL.

       Tcl_EncodingType    <u>*typePtr</u>       (in)      Structure that defines a new type of encoding.

       CONST char          <u>*path</u>          (in)      A path to the location of the encoding file.
____________________________________________________________________________________________________________

<b>INTRODUCTION</b>
       These  routines  convert between Tcl's internal character representation, UTF-8, and character repre-<font color="#ffffff" class="whiteout">sentations&nbsp;representations</font>
       sentations used by various operating systems or file systems, such as Unicode, ASCII,  or  Shift-JIS.
       When  operating  on  strings,  such  as such as obtaining the names of files or displaying characters
       using international fonts, the strings must be translated into one or possibly multiple formats  that
       the  various system calls can use.  For instance, on a Japanese Unix workstation, a user might obtain
       a filename represented in the EUC-JP file encoding and then translate the characters to the  jisx0208
       font  encoding  in order to display the filename in a Tk widget.  The purpose of the encoding package
       is to help bridge the translation gap.  UTF-8 provides an intermediate staging  ground  for  all  the
       various  encodings.   In  the  example  above, text would be translated into UTF-8 from whatever file
       encoding the operating system is using.  Then it would be translated from UTF-8  into  whatever  font
       encoding the display routines require.

       Some  basic encodings are compiled into Tcl.  Others can be defined by the user or dynamically loaded
       from encoding files in a platform-independent manner.

<b>DESCRIPTION</b>
       <b>Tcl_GetEncoding</b> finds an encoding given its <u>name</u>.  The name may refer to a builtin  Tcl  encoding,  a
       user-defined  encoding  registered  by calling <b>Tcl_CreateEncoding</b>, or a dynamically-loadable encoding
       file.  The return value is a token that represents the encoding and can be used in  subsequent  calls
       to  procedures such as <b>Tcl_GetEncodingName</b>, <b>Tcl_FreeEncoding</b>, and <b>Tcl_UtfToExternal</b>.  If the name did
       not refer to any known or loadable encoding, NULL is returned and an error  message  is  returned  in
       <u>interp</u>.

       The  encoding package maintains a database of all encodings currently in use.  The first time <u>name</u> is
       seen, <b>Tcl_GetEncoding</b> returns an encoding with a reference count of 1.  If the same <u>name</u> is requested
       further  times,  then  the  reference  count for that encoding is incremented without the overhead of
       allocating a new encoding and all its associated data structures.

       When an <u>encoding</u> is no longer needed, <b>Tcl_FreeEncoding</b> should be  called  to  release  it.   When  an
       <u>encoding</u>  is  no longer in use anywhere (i.e., it has been freed as many times as it has been gotten)
       <b>Tcl_FreeEncoding</b> will release all storage the encoding was using and delete it from the database.

       <b>Tcl_ExternalToUtfDString</b> converts a source buffer <u>src</u> from the specified <u>encoding</u>  into  UTF-8.   The
       converted  bytes  are  stored in <u>dstPtr</u>, which is then null-terminated.  The caller should eventually
       call <b>Tcl_DStringFree</b> to free any information stored in <u>dstPtr</u>.  When converting, if any of the  char-<font color="#ffffff" class="whiteout">acters&nbsp;characters</font>
       acters  in the source buffer cannot be represented in the target encoding, a default fallback charac-<font color="#ffffff" class="whiteout">ter&nbsp;character</font>
       ter will be used.  The return value is a pointer to the value stored in the DString.

       <b>Tcl_ExternalToUtf</b> converts a source buffer <u>src</u> from the specified <u>encoding</u> into UTF-8.  Up to  <u>srcLen</u>
       bytes  are  converted  from the source buffer and up to <u>dstLen</u> converted bytes are stored in <u>dst</u>.  In
       all cases, <u>*srcReadPtr</u> is filled with the number of bytes that were successfully converted  from  <u>src</u>
       and  <u>*dstWrotePtr</u>  is  filled  with  the  corresponding number of bytes that were stored in <u>dst</u>.  The
       return value is one of the following:

              <b>TCL_OK</b>                       All bytes of <u>src</u> were converted.

              <b>TCL_CONVERT_NOSPACE</b>          The destination buffer was not large enough for all of  the  con-<font color="#ffffff" class="whiteout">verted&nbsp;converted</font>
                                           verted  data;  as  many  characters  as  could fit were converted
                                           though.

              <b>TCL_CONVERT_MULTIBYTE</b>        The last fews bytes in the source buffer were the beginning of  a
                                           multibyte  sequence,  but more bytes were needed to complete this
                                           sequence.  A subsequent call to  the  conversion  routine  should
                                           pass  a  buffer containing the unconverted bytes that remained in
                                           <u>src</u> plus some further bytes from the source  stream  to  properly
                                           convert the formerly split-up multibyte sequence.

              <b>TCL_CONVERT_SYNTAX</b>           The  source buffer contained an invalid character sequence.  This
                                           may occur if the input stream has been damaged or  if  the  input
                                           encoding method was misidentified.

              <b>TCL_CONVERT_UNKNOWN</b>          The  source buffer contained a character that could not be repre-<font color="#ffffff" class="whiteout">sented&nbsp;represented</font>
                                           sented in the target encoding  and  TCL_ENCODING_STOPONERROR  was
                                           specified.

       <b>Tcl_UtfToExternalDString</b>  converts  a  source buffer <u>src</u> from UTF-8 into the specified <u>encoding</u>.  The
       converted bytes are stored in <u>dstPtr</u>, which is then terminated with the appropriate encoding-specific
       null.   The  caller  should eventually call <b>Tcl_DStringFree</b> to free any information stored in <u>dstPtr</u>.
       When converting, if any of the characters in the source buffer cannot be represented  in  the  target
       encoding,  a  default  fallback  character  will be used.  The return value is a pointer to the value
       stored in the DString.

       <b>Tcl_UtfToExternal</b> converts a source buffer <u>src</u> from UTF-8 into the specified <u>encoding</u>.  Up to  <u>srcLen</u>
       bytes  are  converted  from the source buffer and up to <u>dstLen</u> converted bytes are stored in <u>dst</u>.  In
       all cases, <u>*srcReadPtr</u> is filled with the number of bytes that were successfully converted  from  <u>src</u>
       and  <u>*dstWrotePtr</u>  is  filled  with  the  corresponding number of bytes that were stored in <u>dst</u>.  The
       return values are the same as the return values for <b>Tcl_ExternalToUtf</b>.

       <b>Tcl_WinUtfToTChar</b> and <b>Tcl_WinTCharToUtf</b> are Windows-only convenience functions for converting between
       UTF-8  and  Windows  strings.   On Windows 95 (as with the Macintosh and Unix operating systems), all
       strings exchanged between Tcl and the operating system are "char" based.  On Windows NT, some strings
       exchanged  between  Tcl and the operating system are "char" oriented while others are in Unicode.  By
       convention, in Windows a TCHAR is a character in the ANSI code page on Windows 95 and a Unicode char-<font color="#ffffff" class="whiteout">acter&nbsp;character</font>
       acter on Windows NT.

       If  you  planned to use the same "char" based interfaces on both Windows 95 and Windows NT, you could
       use <b>Tcl_UtfToExternal</b> and <b>Tcl_ExternalToUtf</b> (or their <b>Tcl_DString</b> equivalents) with  an  encoding  of
       NULL  (the  current system encoding).  On the other hand, if you planned to use the Unicode interface
       when running on Windows NT and the "char" interfaces when running on Windows 95, you  would  have  to
       perform the following type of test over and over in your program (as represented in pseudo-code):
              if (running NT) {
                  encoding &lt;- Tcl_GetEncoding("unicode");
                  nativeBuffer &lt;- Tcl_UtfToExternal(encoding, utfBuffer);
                  Tcl_FreeEncoding(encoding);
              } else {
                  nativeBuffer &lt;- Tcl_UtfToExternal(NULL, utfBuffer);
       <b>Tcl_WinUtfToTChar</b>  and  <b>Tcl_WinTCharToUtf</b>  automatically handle this test and use the proper encoding
       based on the current operating system.  <b>Tcl_WinUtfToTChar</b> returns a pointer to a  TCHAR  string,  and
       <b>Tcl_WinTCharToUtf</b>  expects  a  TCHAR  string  pointer  as the <u>src</u> string.  Otherwise, these functions
       behave identically to <b>Tcl_UtfToExternalDString</b> and <b>Tcl_ExternalToUtfDString</b>.

       <b>Tcl_GetEncodingName</b> is roughly the inverse of <b>Tcl_GetEncoding</b>.  Given an <u>encoding</u>, the  return  value
       is  the  <u>name</u> argument that was used to create the encoding.  The string returned by <b>Tcl_GetEncoding-</b>
       <b>Name</b> is only guaranteed to persist until the <u>encoding</u> is deleted.  The caller must  not  modify  this
       string.

       <b>Tcl_SetSystemEncoding</b>  sets  the default encoding that should be used whenever the user passes a NULL
       value for the <u>encoding</u> argument to any of the other encoding functions.  If <u>name</u> is NULL, the  system
       encoding  is reset to the default system encoding, <b>binary</b>.  If the name did not refer to any known or
       loadable encoding, TCL_ERROR is returned and an error message is left  in  <u>interp</u>.   Otherwise,  this
       procedure  increments  the reference count of the new system encoding, decrements the reference count
       of the old system encoding, and returns TCL_OK.

       <b>Tcl_GetEncodingNames</b> sets the <u>interp</u> result to a list consisting of the names of  all  the  encodings
       that  are  currently  defined  or can be dynamically loaded, searching the encoding path specified by
       <b>Tcl_SetDefaultEncodingDir</b>.  This procedure does not ensure  that  the  dynamically-loadable  encoding
       files contain valid data, but merely that they exist.

       <b>Tcl_CreateEncoding</b> defines a new encoding and registers the C procedures that are called back to con-<font color="#ffffff" class="whiteout">vert&nbsp;convert</font>
       vert between the encoding and UTF-8.  Encodings created by <b>Tcl_CreateEncoding</b> are thereafter  visible
       in  the  database  used  by  <b>Tcl_GetEncoding</b>.  Just as with the <b>Tcl_GetEncoding</b> procedure, the return
       value is a token that represents the encoding and can be used in subsequent calls to  other  encoding
       functions.   <b>Tcl_CreateEncoding</b>  returns an encoding with a reference count of 1. If an encoding with
       the specified <u>name</u> already exists, then its entry in the database is replaced with the new  encoding;
       the  token  for the old encoding will remain valid and continue to behave as before, but users of the
       new token will now call the new encoding procedures.

       The <u>typePtr</u> argument to <b>Tcl_CreateEncoding</b> contains information about the name of  the  encoding  and
       the procedures that will be called to convert between this encoding and UTF-8.  It is defined as fol-<font color="#ffffff" class="whiteout">lows:&nbsp;follows:</font>
       lows:

              typedef struct Tcl_EncodingType {
                CONST char *<u>encodingName</u>;
                Tcl_EncodingConvertProc *<u>toUtfProc</u>;
                Tcl_EncodingConvertProc *<u>fromUtfProc</u>;
                Tcl_EncodingFreeProc *<u>freeProc</u>;
                ClientData <u>clientData</u>;
                int <u>nullSize</u>;
              } Tcl_EncodingType;

       The <u>encodingName</u> provides a string name for the encoding, by which it can be referred in other proce-<font color="#ffffff" class="whiteout">dures&nbsp;procedures</font>
       dures  such  as  <b>Tcl_GetEncoding</b>.   The <u>toUtfProc</u> refers to a callback procedure to invoke to convert
       text from this encoding into UTF-8.  The <u>fromUtfProc</u> refers to a callback procedure to invoke to con-<font color="#ffffff" class="whiteout">vert&nbsp;convert</font>
       vert  text from UTF-8 into this encoding.  The <u>freeProc</u> refers to a callback procedure to invoke when
       this encoding is deleted.  The <u>freeProc</u> field may be NULL.  The <u>clientData</u> contains an arbitrary one-<font color="#ffffff" class="whiteout">word&nbsp;oneword</font>
       word  value passed to <u>toUtfProc</u>, <u>fromUtfProc</u>, and <u>freeProc</u> whenever they are called.  Typically, this
       is a pointer to a data structure containing encoding-specific information that can  be  used  by  the
       callback procedures.  For instance, two very similar encodings such as <b>ascii</b> and <b>macRoman</b> may use the
       same callback procedure, but use different values of <u>clientData</u> to control its behavior.   The  <u>null</u>-<font color="#ffffff" class="whiteout">Size&nbsp;nullSize</font>
       <u>Size</u>  specifies  the  number of zero bytes that signify end-of-string in this encoding.  It must be <b>1</b>
       (for single-byte or multi-byte encodings like ASCII or Shift-JIS) or  <b>2</b>  (for  double-byte  encodings
       like  Unicode).   Constant-sized  encodings with 3 or more bytes per character (such as CNS11643) are
       not accepted.

       The callback procedures <u>toUtfProc</u> and <u>fromUtfProc</u> should match the type <b>Tcl_EncodingConvertProc</b>:

              typedef int Tcl_EncodingConvertProc(
                ClientData <u>clientData</u>,
                CONST char *<u>src</u>,
                int <u>srcLen</u>,
                int <u>flags</u>,
                Tcl_Encoding *<u>statePtr</u>,
                char *<u>dst</u>,
                int <u>dstLen</u>,
                int *<u>srcReadPtr</u>,
                int *<u>dstWrotePtr</u>,
                int *<u>dstCharsPtr</u>);

       The <u>toUtfProc</u> and <u>fromUtfProc</u> procedures are called by  the  <b>Tcl_ExternalToUtf</b>  or  <b>Tcl_UtfToExternal</b>
       family  of  functions to perform the actual conversion.  The <u>clientData</u> parameter to these procedures
       is the same as the <u>clientData</u> field specified to <b>Tcl_CreateEncoding</b> when the  encoding  was  created.
       The  remaining  arguments to the callback procedures are the same as the arguments, documented at the
       top, to <b>Tcl_ExternalToUtf</b> or <b>Tcl_UtfToExternal</b>, with the following exceptions.  If the  <u>srcLen</u>  argu-<font color="#ffffff" class="whiteout">ment&nbsp;argument</font>
       ment  to  one  of  those high-level functions is negative, the value passed to the callback procedure
       will be the appropriate encoding-specific string length of <u>src</u>.   If  any  of  the  <u>srcReadPtr</u>,  <u>dst</u>-<font color="#ffffff" class="whiteout">WrotePtr,&nbsp;dstWrotePtr,</font>
       <u>WrotePtr</u>,  or  <u>dstCharsPtr</u>  arguments  to  one of the high-level functions is NULL, the corresponding
       value passed to the callback procedure will be a non-NULL location.

       The callback procedure <u>freeProc</u>, if non-NULL, should match the type <b>Tcl_EncodingFreeProc</b>:
              typedef void Tcl_EncodingFreeProc(
                ClientData <u>clientData</u>);

       This <u>freeProc</u> function is called when the encoding is deleted.  The <u>clientData</u> parameter is the  same
       as the <u>clientData</u> field specified to <b>Tcl_CreateEncoding</b> when the encoding was created.


       <b>Tcl_GetDefaultEncodingDir</b>  and  <b>Tcl_SetDefaultEncodingDir</b>  access  and  set the directory to use when
       locating the default encoding files.  If this value is  not  NULL,  the  <b>TclpInitLibraryPath</b>  routine
       appends  the  path to the head of the search path, and uses this path as the first place to look into
       when trying to locate the encoding file.


<b>ENCODING</b> <b>FILES</b>
       Space would prohibit precompiling into Tcl every possible encoding algorithm, so many  encodings  are
       stored  on disk as dynamically-loadable encoding files.  This behavior also allows the user to create
       additional encoding files that can be loaded using the same mechanism.  These encoding files  contain
       information  about  the  tables  and/or escape sequences used to map between an external encoding and
       Unicode.  The external encoding may consist of single-byte, multi-byte, or double-byte characters.

       Each dynamically-loadable encoding is represented as a text file.  The  initial  line  of  the  file,
       beginning  with  a ``#'' symbol, is a comment that provides a human-readable description of the file.
       The next line identifies the type of encoding file.  It can be one of the following letters:

       [1]   <b>S</b>
              A single-byte encoding, where one character is always one byte long in the encoding.  An exam-<font color="#ffffff" class="whiteout">ple&nbsp;example</font>
              ple is <b>iso8859-1</b>, used by many European languages.

       [2]   <b>D</b>
              A  double-byte  encoding,  where  one  character is always two bytes long in the encoding.  An
              example is <b>big5</b>, used for Chinese text.

       [3]   <b>M</b>
              A multi-byte encoding, where one character may be either one or two bytes long.  Certain bytes
              are  a  lead  bytes,  indicating that another byte must follow and that together the two bytes
              represent one character.  Other bytes are not lead bytes and represent themselves.  An example
              is <b>shiftjis</b>, used by many Japanese computers.

       [4]   <b>E</b>
              An escape-sequence encoding, specifying that certain sequences of bytes do not represent char-<font color="#ffffff" class="whiteout">acters,&nbsp;characters,</font>
              acters, but commands that describe how following bytes should be interpreted.

       The rest of the lines in the file depend on the type.

       Cases [1], [2], and [3] are collectively referred to as table-based encoding files.  The lines  in  a
       table-based  encoding  file  are  in the same format as this example taken from the <b>shiftjis</b> encoding
       (this is not the complete file):
              # Encoding file: shiftjis, multi-byte
              M
              003F 0 40
              00
              0000000100020003000400050006000700080009000A000B000C000D000E000F
              0010001100120013001400150016001700180019001A001B001C001D001E001F
              0020002100220023002400250026002700280029002A002B002C002D002E002F
              0030003100320033003400350036003700380039003A003B003C003D003E003F
              0040004100420043004400450046004700480049004A004B004C004D004E004F
              0050005100520053005400550056005700580059005A005B005C005D005E005F
              0060006100620063006400650066006700680069006A006B006C006D006E006F
              0070007100720073007400750076007700780079007A007B007C007D203E007F
              0080000000000000000000000000000000000000000000000000000000000000
              0000000000000000000000000000000000000000000000000000000000000000
              0000FF61FF62FF63FF64FF65FF66FF67FF68FF69FF6AFF6BFF6CFF6DFF6EFF6F
              FF70FF71FF72FF73FF74FF75FF76FF77FF78FF79FF7AFF7BFF7CFF7DFF7EFF7F
              FF80FF81FF82FF83FF84FF85FF86FF87FF88FF89FF8AFF8BFF8CFF8DFF8EFF8F
              FF90FF91FF92FF93FF94FF95FF96FF97FF98FF99FF9AFF9BFF9CFF9DFF9EFF9F
              0000000000000000000000000000000000000000000000000000000000000000
              0000000000000000000000000000000000000000000000000000000000000000
              81
              0000000000000000000000000000000000000000000000000000000000000000
              0000000000000000000000000000000000000000000000000000000000000000
              0000000000000000000000000000000000000000000000000000000000000000
              0000000000000000000000000000000000000000000000000000000000000000
              300030013002FF0CFF0E30FBFF1AFF1BFF1FFF01309B309C00B4FF4000A8FF3E
              FFE3FF3F30FD30FE309D309E30034EDD30053006300730FC20152010FF0F005C
              301C2016FF5C2026202520182019201C201DFF08FF0930143015FF3BFF3DFF5B
              FF5D30083009300A300B300C300D300E300F30103011FF0B221200B100D70000
              00F7FF1D2260FF1CFF1E22662267221E22342642264000B0203220332103FFE5
              FF0400A200A3FF05FF03FF06FF0AFF2000A72606260525CB25CF25CE25C725C6
              25A125A025B325B225BD25BC203B301221922190219121933013000000000000
              000000000000000000000000000000002208220B2286228722822283222A2229
              000000000000000000000000000000002227222800AC21D221D4220022030000
              0000000000000000000000000000000000000000222022A52312220222072261
              2252226A226B221A223D221D2235222B222C0000000000000000000000000000
              212B2030266F266D266A2020202100B6000000000000000025EF000000000000

       The third line of the file is three numbers.  The first number is the fallback character (in base 16)
       to use when converting from UTF-8 to this encoding.  The second number is a <b>1</b> if this file represents
       the encoding for a symbol font, or <b>0</b> otherwise.  The last number (in base 10) is how  many  pages  of
       data follow.

       Subsequent  lines  in  the  example  above  are pages that describe how to map from the encoding into
       2-byte Unicode.  The first line in a page identifies the page number.  Following it are  256  double-<font color="#ffffff" class="whiteout">byte&nbsp;doublebyte</font>
       byte numbers, arranged as 16 rows of 16 numbers.  Given a character in the encoding, the high byte of
       that character is used to select which page, and the low byte of that character is used as  an  index
       to  select  one  of the double-byte numbers in that page - the value obtained being the corresponding
       Unicode character.  By examination of the example above, one can see that  the  characters  0x7E  and
       0x8163 in <b>shiftjis</b> map to 203E and 2026 in Unicode, respectively.

       Following  the first page will be all the other pages, each in the same format as the first: one num-<font color="#ffffff" class="whiteout">ber&nbsp;number</font>
       ber identifying the page followed by 256 double-byte Unicode  characters.   If  a  character  in  the
       encoding  maps to the Unicode character 0000, it means that the character doesn't actually exist.  If
       all characters on a page would map to 0000, that page can be omitted.

       Case [4] is the escape-sequence encoding file.  The lines in an this type of file  are  in  the  same
       format as this example taken from the <b>iso2022-jp</b> encoding:
              # Encoding file: iso2022-jp, escape-driven
              E
              init           {}
              final          {}
              iso8859-1      \x1b(B
              jis0201        \x1b(J
              jis0208        \x1b$@
              jis0208        \x1b$B
              jis0212        \x1b$(D
              gb2312         \x1b$A
              ksc5601        \x1b$(C

       In  the  file,  the  first column represents an option and the second column is the associated value.
       <b>init</b> is a string to emit or expect before the first character is converted, while <b>final</b> is  a  string
       to  emit  or  expect after the last character.  All other options are names of table-based encodings;
       the associated value is the escape-sequence that marks that encoding.  Tcl syntax  is  used  for  the
       values;  in  the  above example, for instance, ``<b>{}</b>'' represents the empty string and ``<b>\x1b</b>'' repre-<font color="#ffffff" class="whiteout">sents&nbsp;represents</font>
       sents character 27.

       When <b>Tcl_GetEncoding</b> encounters an encoding <u>name</u> that has not been loaded, it  attempts  to  load  an
       encoding  file  called  <u>name</u><b>.enc</b>  from  the  <b>encoding</b> subdirectory of each directory specified in the
       library path <b>$tcl_libPath</b>.  If the encoding file exists, but is malformed, an error message  will  be
       left in <u>interp</u>.

<b>KEYWORDS</b>
       utf, encoding, convert






Tcl                                                  8.1                                  <a href="Tcl_GetEncoding.3tcl.html#//apple_ref/doc/man/3/Tcl_GetEncoding">Tcl_GetEncoding(3)</a>
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man3/Encoding.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man3/Encoding.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man3/Encoding.3tcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
