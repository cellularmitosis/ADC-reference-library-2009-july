<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Bitblitz - /Source/MainStuff.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; <A HREF="javascript:location.replace('index.html');">Bitblitz</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Bitblitz</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/MainStuff.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/LibHeaders/AlertDlogUtils.h</option>
<option value="listing2.html">/LibHeaders/AlrtDlogTools.h</option>
<option value="listing3.html">/LibHeaders/AutoCursor.h</option>
<option value="listing4.html">/LibHeaders/ColorTools.h</option>
<option value="listing5.html">/LibHeaders/MacHeaders.h</option>
<option value="listing6.html">/LibHeaders/MainUtils.h</option>
<option value="listing7.html">/LibHeaders/PictUtils.h</option>
<option value="listing8.html">/LibHeaders/WCenter.h</option>
<option value="listing9.html">/Resources/AlertDlogUtils.r</option>
<option value="listing10.html">/Resources/BitBlitz.r</option>
<option value="listing11.html">/Source/BitBlitz.c</option>
<option value="listing12.html">/Source/BitBlitz.h</option>
<option value="listing13.html">/Source/BlendUtils.c</option>
<option value="listing14.html">/Source/BlendUtils.h</option>
<option value="listing15.html">/Source/MainStuff.c</option>
<option value="listing16.html">/Source/MainStuff.h</option>
<option value="listing17.html">/Source/OffscreenUtils.c</option>
<option value="listing18.html">/Source/OffscreenUtils.h</option></select>
				</p>
				</form>
				<p><strong><a href="Bitblitz.zip">Download Sample</a></strong> (&#147;Bitblitz.zip&#148;, 92.9K)<BR>
<strong><a href="Bitblitz.dmg">Download Sample</a></strong> (&#147;Bitblitz.dmg&#148;, 169.3K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*--------------------------------------------------------------------------------------////  File:      MainStuff.c////  Contents:  Main event loop.  Only those portions needed for support of the tools //        features have been included.//////  By Georgiann (&quot;George&quot;) Delaney//  &copy;\xCA1989 - 1990, Apple Computer, Inc.////--------------------------------------------------------------------------------------*/#include &quot;MacHeaders.h&quot;#include &quot;BitBlitz.h&quot;#include &quot;MainStuff.h&quot;#pragma segment main/*======================================================================================*//*  Shell Global Variables   */Boolean    gFinished    = false;      /* Does the user want to quit the application?     */Boolean    gWNEAvailable;            /* Specifies if WaitNextEvent is available       */Boolean    gInBackground   = false;      /* Is the application in the background under MF    */ Handle    gtheMenuBar;            /* Handle to the tool menus             */MenuHandle  gtheMenus[kMenuCount+kHeirCount];  /* Structure holding the application menus       */  short    gCmdOn      = false;      /* Is the command key being pressed?         */Boolean    gDoubleClick  = false;      /* Determines if the user double-clicked       */long    gLastTime;Point    gLastPoint;              /*======================================================================================*//*  Setup Routines  *//*--------------------------------------------------------------------------------------*/void SetUpMenu()/*//  This procedure reads in all of the menu resources and builds the application //  menu.*/{  short  n;  InitMenus();    gtheMenus[kAppleMenu]   = GetMenu( kAppleMenuID );  AddResMenu(gtheMenus[kAppleMenu],'DRVR');    gtheMenus[kFileMenu]      = GetMenu(kFileMenuID);  gtheMenus[kEditMenu]      = GetMenu(kEditMenuID);  gtheMenus[kOptionsMenu]   = GetMenu(kOptionsMenuID);   gtheMenus[khCopyModeMenu] = GetMenu(khCopyModeMenuID);   gtheMenus[khClipRgnMenu]  = GetMenu(khClipRgnMenuID);   gtheMenus[khVisRgnMenu]   = GetMenu(khVisRgnMenuID);   gtheMenus[khMaskRgnMenu]  = GetMenu(khMaskRgnMenuID);   gtheMenus[khFGColorMenu]  = GetMenu(khFGColorMenuID);   gtheMenus[khBKColorMenu]  = GetMenu(khBKColorMenuID);   gtheMenus[khOPColorMenu]  = GetMenu(khOPColorMenuID);   gtheMenus[khHiliteMenu]   = GetMenu(khHiliteMenuID);    for ( n = 0; n &lt; kMenuCount; n++ )     InsertMenu(gtheMenus[n],0);    for ( n = n; n &lt; (kMenuCount+kHeirCount); n++ )     InsertMenu(gtheMenus[n], hierMenu);  gtheMenuBar = GetMenuBar();    DrawMenuBar();}/*--------------------------------------------------------------------------------------*/void InitAppMenus(){  if (!gColorAvail)  {     DisableItem(gtheMenus[kOptionsMenu], kSrcOr );     DisableItem(gtheMenus[kOptionsMenu], kSrcXor );     DisableItem(gtheMenus[kOptionsMenu], kSrcBic );     DisableItem(gtheMenus[kOptionsMenu], kNotSrcCopy );     DisableItem(gtheMenus[kOptionsMenu], kNotSrcOr );     DisableItem(gtheMenus[kOptionsMenu], kNotSrcXor );     DisableItem(gtheMenus[kOptionsMenu], kNotSrcBic );     DisableItem(gtheMenus[kOptionsMenu], kBlend );     DisableItem(gtheMenus[kOptionsMenu], kAddPin );     DisableItem(gtheMenus[kOptionsMenu], kAddOver );     DisableItem(gtheMenus[kOptionsMenu], kAddMin );     DisableItem(gtheMenus[kOptionsMenu], kAddMax );     DisableItem(gtheMenus[kOptionsMenu], kSubPin );     DisableItem(gtheMenus[kOptionsMenu], kSubOver );     DisableItem(gtheMenus[kOptionsMenu], kTransparent );     DisableItem(gtheMenus[kOptionsMenu], kHilite );     }  else    CheckItem  (gtheMenus[khCopyModeMenu],CopyMode2ModeMenuItem(gCopyMode),true);}/*--------------------------------------------------------------------------------------*/void InitMac()/*//  This procedure executes all Macintosh initialization functions. */{  EventRecord  theEvent;    MaxApplZone();  MoreMasters();  MoreMasters();  MoreMasters();  MoreMasters();  InitGraf(&amp;qd.thePort);  InitFonts();  InitWindows();  SetUpMenu();  TEInit();  InitDialogs(nil);  InitCursor();  InitAllPacks();        gWNEAvailable = myTrapAvailable(_WaitNextEvent, ToolTrap);  EventAvail(everyEvent,&amp;theEvent);  /* Force windows to front\xC9 (for MF) */}/*======================================================================================*//*  Main Loop and Event Management Routines  *//*--------------------------------------------------------------------------------------*/Boolean IsDAWindow( window )  WindowPtr  window;{  if ( window == nil )    return false;  else      return ( (WindowPeek) window)-&gt;windowKind &lt; 0;} /*--------------------------------------------------------------------------------------*/void AdjustMenusForDA(){  EnableItem (gtheMenus[kFileMenu], kNew);  EnableItem (gtheMenus[kFileMenu], kOpen);  EnableItem (gtheMenus[kFileMenu], kClose);  EnableItem (gtheMenus[kFileMenu], kSave);  EnableItem (gtheMenus[kFileMenu], kSaveAs);  EnableItem (gtheMenus[kFileMenu], kPageSetUp);  EnableItem (gtheMenus[kFileMenu], kPrint);  EnableItem (gtheMenus[kFileMenu], kQuit);  EnableItem (gtheMenus[kEditMenu], kUndo);  EnableItem (gtheMenus[kEditMenu], kCut);  EnableItem (gtheMenus[kEditMenu], kCopy);  EnableItem (gtheMenus[kEditMenu], kPaste);  EnableItem (gtheMenus[kEditMenu], kClear);  DisableItem(gtheMenus[kOptionsMenu], kSrcAttributes );  DisableItem(gtheMenus[kOptionsMenu], kMskAttributes );  DisableItem(gtheMenus[kOptionsMenu], kDstAttributes );    DisableItem(gtheMenus[kOptionsMenu], kTrapSelect);  DisableItem(gtheMenus[kOptionsMenu], kCopyModeSelect);  DisableItem(gtheMenus[kOptionsMenu], kMaskRgnSelect);} /*--------------------------------------------------------------------------------------*/void AdjustMenusForApp(){  DisableItem(gtheMenus[kFileMenu], kNew);  DisableItem(gtheMenus[kFileMenu], kOpen);  DisableItem(gtheMenus[kFileMenu], kClose);  DisableItem(gtheMenus[kFileMenu], kSave);  DisableItem(gtheMenus[kFileMenu], kSaveAs);  DisableItem(gtheMenus[kFileMenu], kPageSetUp);  DisableItem(gtheMenus[kFileMenu], kPrint);  EnableItem (gtheMenus[kFileMenu], kQuit);  DisableItem(gtheMenus[kEditMenu], kUndo);  DisableItem(gtheMenus[kEditMenu], kCut);  DisableItem(gtheMenus[kEditMenu], kCopy);  DisableItem(gtheMenus[kEditMenu], kPaste);  DisableItem(gtheMenus[kEditMenu], kClear);  EnableItem (gtheMenus[kOptionsMenu], kSrcAttributes );  EnableItem (gtheMenus[kOptionsMenu], kMskAttributes );  EnableItem (gtheMenus[kOptionsMenu], kDstAttributes );    EnableItem (gtheMenus[kOptionsMenu], kTrapSelect);      EnableItem (gtheMenus[kOptionsMenu],  kFGColor);  CheckItem  (gtheMenus[khFGColorMenu], gFGColor.menuIndex,  true);    EnableItem (gtheMenus[kOptionsMenu],  kBKColor);  CheckItem  (gtheMenus[khBKColorMenu], gBKColor.menuIndex,  true);  EnableItem (gtheMenus[kOptionsMenu],  kClipRgnSelect);  CheckItem  (gtheMenus[khClipRgnMenu], gRList[kClpRgn].type,  true);  EnableItem (gtheMenus[kOptionsMenu],  kVisRgnSelect);  CheckItem  (gtheMenus[khVisRgnMenu],  gRList[kVisRgn].type,  true);  EnableItem (gtheMenus[kOptionsMenu],  kUseScreenBits);  CheckItem  (gtheMenus[kOptionsMenu],  kUseScreenBits,        gUseScreenBits);  EnableItem (gtheMenus[kOptionsMenu],  kDither);  CheckItem  (gtheMenus[kOptionsMenu],  kDither,          gDither);    if (gColorAvail)  {    EnableItem (gtheMenus[kOptionsMenu], kOpColor);    CheckItem  (gtheMenus[khOPColorMenu],gOPColor.menuIndex,true);    EnableItem (gtheMenus[kOptionsMenu], kHiliteColor);    CheckItem  (gtheMenus[khHiliteMenu], gHiliteColor.menuIndex,true);    }  else  {    DisableItem(gtheMenus[khFGColorMenu], kCustomColor);    DisableItem(gtheMenus[khFGColorMenu], kCustomColor);    DisableItem(gtheMenus[kOptionsMenu], kOpColor);    DisableItem(gtheMenus[kOptionsMenu], kHiliteColor);    }    if ((gTrapSelect == kCopyDeepMask) || (gTrapSelect == kCopyBits))  {    EnableItem (gtheMenus[kOptionsMenu],  kCopyModeSelect);    EnableItem (gtheMenus[kOptionsMenu],  kMaskRgnSelect);    CheckItem  (gtheMenus[khMaskRgnMenu], gRList[kMskRgn].type,true);    if (gTrapSelect == kCopyBits)        DisableItem(gtheMenus[kOptionsMenu], kMskAttributes );    }  else {    DisableItem(gtheMenus[kOptionsMenu], kCopyModeSelect);    DisableItem(gtheMenus[kOptionsMenu], kMaskRgnSelect);    }} /*--------------------------------------------------------------------------------------*/void AdjustMenus()/*  AdjustMenus will properly activate/deactivate/update each menu item in each   of the menus to properly reflect the available selections with respect to the  currently active window.*/{  WindowPtr  theActiveWindow;    theActiveWindow = FrontWindow();        if (IsDAWindow(theActiveWindow))      AdjustMenusForDA();  else AdjustMenusForApp(); }/*--------------------------------------------------------------------------------------*/void DoMenuCommand(long  menuData){  short    theMenu;  short    theItem;  Str255    theName;  short    theRefNum;  Boolean    imageChanged = true;  OSErr    result     = noErr;    theMenu = HiWord(menuData);  theItem = LoWord(menuData);  switch (theMenu)  {      case kAppleMenuID:      switch ( theItem )  {        case kAboutBox:    AboutBitBlitz();    break;        default:          GetItem(GetMHandle(kAppleMenuID), theItem, theName);          theRefNum = OpenDeskAcc(theName);          break;        }      break;          case kFileMenuID:      switch ( theItem )  {        case kNew:      break;        case kOpen:      break;        case kClose:    break;        case kSave:      break;        case kSaveAs:    break;        case kPageSetUp:  break;        case kPrint:    break;        case kQuit:      gFinished = true;    break;        }      break;          case kEditMenuID:      switch ( theItem )  {        case kUndo:      break;        case kCut:      break;        case kCopy:      break;        case kPaste:    break;        case kClear:    break;        }      break;    case kOptionsMenuID:      switch ( theItem )  {        case kSrcAttributes:  ChangeWindowAttributes(kSrcWindow);  break;        case kMskAttributes:  ChangeWindowAttributes(kMskWindow);  break;        case kDstAttributes:  ChangeWindowAttributes(kDstWindow);  break;        case kTrapSelect:     SelectTrap();               break;        case kUseScreenBits:  gUseScreenBits = !gUseScreenBits;                    CheckItem (gtheMenus[kOptionsMenu],kUseScreenBits,gUseScreenBits);                    DrawBuffer(kBitWindow);                    DrawWindow(kBitWindow);                    break;        case kDither:        gDither = !gDither;                    CheckItem (gtheMenus[kOptionsMenu],kDither,gDither);                    if ((gCopyMode == srcCopy) || (gCopyMode == ditherCopy)) {                      if (gDither)                      gCopyMode = ditherCopy;                    else                      gCopyMode = srcCopy;                      }                    DrawBuffer(kBitWindow);                    DrawWindow(kBitWindow);                    break;        }      break;        case khCopyModeMenuID:         CheckItem(gtheMenus[khCopyModeMenu],CopyMode2ModeMenuItem(gCopyMode),false);      CheckItem(gtheMenus[khCopyModeMenu],theItem,true);      gCopyMode = ModeMenuItem2CopyMode(theItem);      DrawBuffer(kBitWindow);      DrawWindow(kBitWindow);      break;        case khClipRgnMenuID:         CheckItem (gtheMenus[khClipRgnMenu],gRList[kClpRgn].type,false);      SelectRgn (kClpRgn,theItem);        CheckItem (gtheMenus[khClipRgnMenu],gRList[kClpRgn].type,true);      break;        case khVisRgnMenuID:         CheckItem (gtheMenus[khVisRgnMenu],gRList[kVisRgn].type,false);      SelectRgn (kVisRgn,theItem);        CheckItem (gtheMenus[khVisRgnMenu],gRList[kVisRgn].type,true);      break;        case khMaskRgnMenuID:         CheckItem (gtheMenus[khMaskRgnMenu],gRList[kMskRgn].type,false);      SelectRgn (kMskRgn,theItem);        CheckItem (gtheMenus[khMaskRgnMenu],gRList[kMskRgn].type,true);      break;        case khFGColorMenuID:      CheckItem (gtheMenus[khFGColorMenu],gFGColor.menuIndex,false);      SelectFGColor(theItem);        CheckItem (gtheMenus[khFGColorMenu],gFGColor.menuIndex,true);      break;          case khBKColorMenuID:        CheckItem (gtheMenus[khBKColorMenu],gBKColor.menuIndex,false);      SelectBKColor(theItem);        CheckItem (gtheMenus[khBKColorMenu],gBKColor.menuIndex,true);      break;    case khOPColorMenuID:        CheckItem (gtheMenus[khOPColorMenu],gOPColor.menuIndex,false);      SelectOPColor(theItem);        CheckItem (gtheMenus[khOPColorMenu],gOPColor.menuIndex,true);      break;    case khHiliteMenuID  :        CheckItem (gtheMenus[khHiliteMenu],gHiliteColor.menuIndex,false);      SelectHiliteColor(theItem);        CheckItem (gtheMenus[khHiliteMenu],gHiliteColor.menuIndex,true);      break;    }  HiliteMenu(0);          }/*--------------------------------------------------------------------------------------*/void DoGrowWindow(WindowPtr  theWindow, EventRecord  *theEvent){  long  newSize;  Point  newDimen, oldDimen;      if (theWindow != FrontWindow())     SelectWindow(theWindow);  else    SetPort(theWindow);      newSize = GrowWindow(theWindow,theEvent-&gt;where,&amp;qd.screenBits.bounds);    if (newSize != 0)  {    SetCursor(*GetCursor(watchCursor));    newDimen.h = LoWord(newSize);    newDimen.v = HiWord(newSize);        if ((theWindow == gWList[kSrcWindow].window) || (theWindow == gWList[kMskWindow].window)) {      SetPort(gWList[kSrcWindow].window);      if (ResizeTestWindow(&amp;newDimen,kSrcWindow)) {         oldDimen.h = gWList[kSrcWindow].window-&gt;portRect.right  - gWList[kSrcWindow].window-&gt;portRect.left;        oldDimen.v = gWList[kSrcWindow].window-&gt;portRect.bottom - gWList[kSrcWindow].window-&gt;portRect.top;        SetPort(gWList[kMskWindow].window);        if (ResizeTestWindow(&amp;newDimen,kMskWindow))  {          SizeWindow(gWList[kMskWindow].window,newDimen.h,newDimen.v,false);          SizeWindow(gWList[kSrcWindow].window,newDimen.h,newDimen.v,false);          }        else {          SetPort(gWList[kSrcWindow].window);          ResizeTestWindow(&amp;oldDimen,kSrcWindow);          }        }      }    if ((theWindow == gWList[kDstWindow].window) || (theWindow == gWList[kBitWindow].window)) {      SetPort(gWList[kDstWindow].window);      if (ResizeTestWindow(&amp;newDimen,kDstWindow))  {        oldDimen.h = gWList[kDstWindow].window-&gt;portRect.right  - gWList[kDstWindow].window-&gt;portRect.left;        oldDimen.v = gWList[kDstWindow].window-&gt;portRect.bottom - gWList[kDstWindow].window-&gt;portRect.top;                SetPort(gWList[kBitWindow].window);        if (ResizeTestWindow(&amp;newDimen,kBitWindow))  {          SizeWindow(gWList[kBitWindow].window,newDimen.h,newDimen.v,false);          SizeWindow(gWList[kDstWindow].window,newDimen.h,newDimen.v,false);          UpdateRgnSettings();          }        else {          SetPort(gWList[kDstWindow].window);          ResizeTestWindow(&amp;oldDimen,kDstWindow);          }        }      }            SetPort(theWindow);                DrawBuffer(kBitWindow);    DrawWindow(kSrcWindow);    DrawWindow(kMskWindow);    DrawWindow(kDstWindow);    DrawWindow(kBitWindow);        InitCursor();    }}/*--------------------------------------------------------------------------------------*/short abs(short  a){  return((a&lt;0)?-a:a);}/*--------------------------------------------------------------------------------------*/Boolean AlmostEqualPt(Point *pt1, Point *pt2, short tolerance)/*//   AlmostEqualPt() determines if two points are equal within the specified tolerance.*/{  return ((abs(pt2-&gt;h - pt1-&gt;h) &lt; tolerance) &amp;&amp; (abs(pt2-&gt;v - pt1-&gt;v) &lt; tolerance));}/*--------------------------------------------------------------------------------------*/void DoMouseDown(EventRecord  *theEvent){  short    thePart;  WindowPtr  theWindow;  register  i;    gDoubleClick  = ((theEvent-&gt;when - gLastTime) &lt;= GetDblTime());  gDoubleClick  = ( (gDoubleClick) &amp;&amp; AlmostEqualPt(&amp;gLastPoint,&amp;theEvent-&gt;where,3));  thePart = FindWindow(theEvent-&gt;where, &amp;theWindow);  switch ( thePart )  {    case inMenuBar:         AdjustMenus();       DoMenuCommand(MenuSelect(theEvent-&gt;where));       break;           case inSysWindow:           SystemClick( theEvent, theWindow );       break;           case inContent:      if (theWindow != FrontWindow())         SelectWindow(theWindow);      else  {        SetPort(theWindow);        if (gDoubleClick)            for (i=kSrcWindow; i&lt;=kBitWindow;  i++)            if (theWindow == gWList[i].window)              if (i&lt;kBitWindow)                ChangeWindowAttributes(i);              else                SysBeep(10);        }         break;           case inDrag:              DragWindow(theWindow,theEvent-&gt;where,&amp;qd.screenBits.bounds);      if (gUseScreenBits)  {        for (i=kSrcWindow; i&lt;=kDstWindow;  i++)          DrawWindow(i);        DrawBuffer(kBitWindow);        DrawWindow(kBitWindow);        }      break;           case inGrow:      DoGrowWindow(theWindow, theEvent);         break;           case inZoomIn:    case inZoomOut:      if ( TrackBox(theWindow, theEvent-&gt;where, thePart) )          {        SetPort(theWindow);                ZoomWindow(theWindow, thePart, true);          InvalRect(&amp;theWindow-&gt;portRect);           }      break;    }      gLastTime  = theEvent-&gt;when;    gLastPoint = theEvent-&gt;where;}/*--------------------------------------------------------------------------------------*/void DoKeyDown( theEvent )  EventRecord  *theEvent;{  char    theKey;  gCmdOn  = ( theEvent-&gt;modifiers &amp; cmdKey );  theKey   = theEvent-&gt;message &amp; charCodeMask;  if ((gCmdOn) &amp;&amp; (theEvent-&gt;what == keyDown))  {    AdjustMenus();                DoMenuCommand( MenuKey(theKey) );    }}/*--------------------------------------------------------------------------------------*/void DoUpdate(EventRecord  *theEvent){  WindowPtr  theWindow;  theWindow   = (WindowPtr)theEvent-&gt;message;    if (theWindow != nil)  {    BeginUpdate(theWindow);        if (theWindow == gWList[kSrcWindow].window)      DrawWindow(kSrcWindow);    else if (theWindow == gWList[kMskWindow].window)       DrawWindow(kMskWindow);    else if (theWindow == gWList[kDstWindow].window)       DrawWindow(kDstWindow);    else if (theWindow == gWList[kBitWindow].window)       DrawWindow(kBitWindow);        EndUpdate(theWindow);    }}/*--------------------------------------------------------------------------------------*/void DoEvent(EventRecord  *theEvent){  switch (theEvent-&gt;what)  {    case nullEvent:      break;      case mouseDown:        DoMouseDown(theEvent);        break;          case keyDown:    case autoKey:        DoKeyDown(theEvent);      break;          case activateEvt:      InitCursor();      break;          case updateEvt:      DoUpdate(theEvent);       break;          case diskEvt:      break;    }} /*--------------------------------------------------------------------------------------*/void MainLoop(){  EventRecord    theEvent;  do  {    if (gWNEAvailable)      WaitNextEvent(everyEvent, &amp;theEvent, LONG_MAX, nil);    else  {      SystemTask();      GetNextEvent(everyEvent, &amp;theEvent);      }        DoEvent(&amp;theEvent);        } while (! gFinished);    }/*--------------------------------------------------------------------------------------*/main(){  SysEnvRec  theWorld;        /*  Perform standard mac initialization. */        InitMac();        SysEnvirons(1, &amp;theWorld);      if (theWorld.systemVersion &lt; 0x0700)  {    NeedSystem7Dlog();    ExitToShell();    }      InitTestGlobals();  InitAppMenus();              /*  Initialize all of the app's windows' structures. */        InitTestWindowAttributes();  InitColorSettings();  InitRgnSettings();        /*  If there is not enough memory to bring up windows exit. */        if (CreateTestWindows())       MainLoop();      DisposeRgnSettings();  DisposeTestWindows();  ExitToShell();}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Bitblitz/listing15.html%3Fid%3DDTS10000066-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Bitblitz/listing15.html%3Fid%3DDTS10000066-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Bitblitz/listing15.html%3Fid%3DDTS10000066-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>