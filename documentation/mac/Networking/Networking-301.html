<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>NetWrite(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING301></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-300.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-302.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-284.html"><B>Chapter 12 - Multinode Architecture</B></A> / <A HREF="Networking-291.html"><B>Multinode Architecture Reference</B></A><BR><DL><DD><A HREF="Networking-296.html"><B>Routines</B></A> / <A HREF="Networking-300.html"><B>Sending Datagrams Through Multinodes</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING301-0></A>
<H3><A NAME=MARKER-9-94></A>NetWrite</H3>
 You use the <CODE>NetWrite</CODE> routine to send a packet from a multinode to another multinode or socket-client application. You use the <CODE>PBControl</CODE> function to call the <CODE>NetWrite</CODE> routine. See <A HREF=Networking-296.html#MARKER-9-71>"Routines" on page 12-19</A> for a description of the <CODE>PBControl</CODE> call.<P>
<B>
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>ioCompletion<TD>ProcPtr<TD>A pointer to a completion routine.<TR>
<TD><--<TD>ioResult<TD>OSErr<TD>The result code.<TR>
<TD>--><TD>ioRefNum<TD>Integer<TD>The .MPP driver reference number. You <BR>must fill in this value.<TR>
<TD>--><TD>csCode<TD>Integer<TD>A routine selector. Always equal to 261 for this routine. You must fill in this value.<TR>
<TD>--><TD>checkSumFlag<TD>Byte<TD>A flag indicating whether the checksum should be calculated or the existing checksum left unmodified.<TR>
<TD>--><TD>wdsPointer<TD>Ptr<TD>A pointer to the write-data structure <BR>for the function.</TABLE>
</B><P>
<DL>
<H5>Field Description</H5>
<DT><CODE><A NAME=MARKER-2-95></A>ioCompletion</CODE>
<DD> A pointer to a <A NAME=MARKER-2-96></A>completion routine that you can provide. When you execute a function asynchronously, AppleTalk calls your completion routine when it completes execution of the function if you specify <BR>a pointer to the routine as the value of this field. Specify <CODE>NIL</CODE> for <BR>this field if you do not wish to provide a completion routine. <BR>If you execute a function synchronously, AppleTalk ignores the <CODE>ioCompletion</CODE> field. For information about completion routines, see the chapter "Introduction to AppleTalk" in this book. 
<DT><CODE><A NAME=MARKER-2-97></A>checkSumFlag</CODE>
<DD> A flag whose value you set to a nonzero number if you want the checksum for the datagram to be calculated and placed in the DDP header of the packet. If you do not want the current value in the packet header's checksum field to be altered, you set this field to 0.
<DT><CODE><A NAME=MARKER-2-98></A>wdsPointer</CODE>
<DD> A pointer to the <A NAME=MARKER-2-99></A>write-data structure that contains a series of length words and pointers that indicate the length and location of a portion of the data, including the header information, that constitutes the packet to be sent over the network. 
</DL>
<A NAME=HEADING301-6></A>
<H5>DESCRIPTION</H5>
 To send a packet over an AppleTalk network from a multinode, you must first prepare <BR>a write-data structure, and then call the <CODE>NetWrite</CODE> routine, passing it a pointer to the write-data structure. <P>
 The write-data structure that you create for multinodes differs slightly from the standard write-data structure that you create to send a DDP packet using the <CODE>PWriteDDP</CODE> function. For a multinode, you must specify both the source multinode address and the destination address in the packet header information data areas that you point to from the write-data structure. You can also set the checksum field of the write-data structure to 0 to direct AppleTalk to not calculate a checksum for this packet. <P>
 You specify the source network number and the source multinode ID of the multinode; the .MPP driver does not set these values for you in the header area of a packet sent from a multinode as it does for a standard DDP packet, although both packets are transmitted as DDP datagrams. <P>
 If you are sending the contents of an existing DDP packet through the <CODE>NetWrite</CODE> call, you can leave the value of the source socket field unchanged. The value in the source socket field should adhere to the conventions that the AppleTalk DDP protocol speci-<BR>fication describes for the use of sockets. The socket number value must fall within the defined user range as stated in the DDP protocol specification. (See <I>Inside AppleTalk,</I> second edition, for this information.) <P>
 The <CODE>checkSumFlag</CODE> parameter block field of the <CODE>NetWrite</CODE> routine relates to the standard DDP header checksum field. However, the multinode architecture uses this <BR>flag differently than the DDP interface uses it. <P>
<UL>
<LI>If you want the checksum for the datagram to be calculated and placed in the <BR>DDP header before the .MPP driver transmits the packet, you set this field to a nonzero number.
<LI>If you want the checksum field of the DDP packet header not to be modified, you <BR>set this field to 0, and the existing checksum value in the DDP header will not <BR>be changed. <P>
</UL>
 Note that if you want to send a packet that does not include a checksum, you must hardcode the value by setting to 0 the checksum field of the data structure that contains the packet header that you point to from the write-data structure.<P>
 All packets that you send using the <CODE>NetWrite</CODE> routine are built with the long DDP packet header to allow for inclusion of the source multinode address. The DDP packet header includes the source multinode address even when the destination and source nodes are on the same LocalTalk network.<P>
 Because the source multinode ID is associated with the application that sent the packet and the source user node ID is associated with the machine that transmitted the packet, the source user node ID in the frame header and the source multinode ID in the DDP packet header are always different values. <P>
<DL>
<DT><B>IMPORTANT</B>
<DD>Do not set the socket number to 0 ($00) for the source socket number that you specify in the data area pointed to by the write-data structure. You do this in the address block record socket field for the <CODE>AddNode</CODE> routine because the socket number does not apply when you are acquiring a multinode, but you must not do it for the <CODE>NetWrite</CODE> <BR>call because <CODE>NetWrite</CODE> causes the .MPP driver to build a DDP packet, and socket number 0 has special meaning to DDP that is outside the valid user socket range.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
<A NAME=HEADING301-18></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Memory used for the write-data structure belongs to the multinode implementation in the .MPP driver for the life of the <CODE>NetWrite</CODE> call and must be nonrelocatable. After the <CODE>NetWrite</CODE> call completes execution, you must release the memory that you used for <BR>the write-data structure. <P>
<A NAME=HEADING301-20></A>
<H5>ASSEMBLY-LANGUAGE INFORMATION</H5>
 To execute the <A NAME=MARKER-2-100></A><CODE>NetWrite</CODE> routine from assembly language, call the <CODE>_Control</CODE> trap macro with a value of 261 in the <CODE>csCode</CODE> field of the parameter block. <P>
<A NAME=HEADING301-22></A>
<H5>RESULT CODES
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>ddpLenErr<TD>-92<TD>Datagram is too long<TR>
<TD>noBridgeErr<TD>-93<TD>No router found<TR>
<TD>excessCollsns<TD>-95<TD>Excessive collisions on write </TABLE>
</H5>
<A NAME=HEADING301-23></A>
<H5>SEE ALSO</H5>
 See the section <A HREF=Networking-290.html#MARKER-9-43>"Preparing a Write-Data Structure" on page 12-13</A> for information on how to create the write-data <A NAME=MARKER-2-101></A>structure. <A NAME=MARKER-2-102></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-300.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-302.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
