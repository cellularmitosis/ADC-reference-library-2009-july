<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Model Object Implementation Guide: Key-Value Technology Compliance</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Key-Value Technology Compliance"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002138" title="Key-Value Technology Compliance"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../DesignGuidelines-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000556" target="_top">Design Guidelines</a> &gt; <a href="../index.html" target="_top">Model Object Implementation Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../cdAccessorMethods.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="moValidation.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40002138-SW2" title="Key-Value Technology Compliance"></a><hr /><H1>Key-Value Technology Compliance</H1><p>There are a number of ways you can ensure that your model objects are key-value coding (KVC) and key-value observing (KVO) compliant, typically and most easily by implementing suitable accessor methods as described in <span class="content_text"><a href="moAccessorMethods.html#//apple_ref/doc/uid/TP40002132-SW1">“Basic Accessor Methods.”</a></span> The main exception to this rule is Core Data, which imposes special constraints on the implementation of accessor methods. If you are using Core Data, you should read <span class="content_text"><a href="../cdAccessorMethods.html#//apple_ref/doc/uid/TP40002154-SW1" target="_self">Managed Object Accessor Methods</a></span> to learn how to ensure your managed object classes are KVC and KVO compliant.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="moIntegrating.html#//apple_ref/doc/uid/TP40002138-SW1">KVC Compliance</a>
				
			<br/>
			
        
			
			
				<a href="moIntegrating.html#//apple_ref/doc/uid/TP40002138-SW3">KVO Compliance</a>
				
			<br/>
			
        
			
			
				<a href="moIntegrating.html#//apple_ref/doc/uid/TP40002138-SW4">Dependent Values</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002138-SW1" title="KVC Compliance"></a><h2>KVC Compliance</h2><p>The key-value coding mechanism tries hard to find a value for a given key, so that it is actually difficult not to be KVC compliant for a given property. Although there are a number of ways to ensure compliance, it is recommended that you use accessor methods and follow standard naming conventions. The general requirements for KVC compliance are described in <span class="content_text"><a href="../../KeyValueCoding/Concepts/AccessorConventions.html#//apple_ref/doc/uid/20002174" target="_top">Key-Value Coding Accessor Methods</a></span> in <em><a href="../../KeyValueCoding/index.html#//apple_ref/doc/uid/10000107i" target="_top">Key-Value Coding Programming Guide</a></em>.</p><a name="//apple_ref/doc/uid/TP40002138-SW3" title="KVO Compliance"></a><h2>KVO Compliance</h2><p>There are two ways you can implement KVO compliance—using automatic notification, or, using manual notification. As the name implies, if you use automatic notification you don't have to do anything other than implement (and use) standard accessor methods as described in <span class="content_text"><a href="moAccessorMethods.html#//apple_ref/doc/uid/TP40002132-SW1">“Basic Accessor Methods.”</a></span> For most classes, automatic KVO notification is enabled by default, and there is typically no benefit in disabling automatic notification. The primary exception is in a subclass of <code>NSManagedObject</code>. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40002138-DontLinkElementID_4" title="Important:"></a><p><strong>Important:</strong>&nbsp;<code>NSManagedObject</code> <em>disables</em> automatic notification by default. Moreover, you cannot enable automatic notification for modeled properties. If you implement accessors for model properties, you <em>must</em> invoke the relevant change notification methods. You can, however, enable automatic notification for unmodeled properties using <code>automaticallyNotifiesObserversForKey:</code>.</p><p></p></div><p>If you want to disable automatic notification, you implement <code>automaticallyNotifiesObserversForKey:</code> and return <code>NO</code> for the keys for which you want to provide manual notifications. In your set accessors, for simple attributes you then invoke <code>willChangeValueForKey:</code> and <code>didChangeValueForKey:</code> respectively before and after the property key is changed. For a to-many relationship, you also need to invoke the relevant notification methods indicating the type of change and the indexes of the objects changed.</p><p>You can implement "bulk" modifiers that allow you to, for example, make a large number of additions to an array in a single method call rather than requiring an individual method call for each insertion. The following example shows a custom bulk modifier method for an ordered to-many relationship.</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)addObjectsToEmployeesFromArray:(NSArray *)otherArray<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([otherArray count] > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSRange range = NSMakeRange([employees count], [otherArray count]);<span></span></pre></td></tr><tr><td scope="row"><pre>        NSIndexSet *indexes = [NSIndexSet indexSetWithIndexesInRange:range];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        [self willChange:NSKeyValueChangeInsertion valuesAtIndexes:indexes<span></span></pre></td></tr><tr><td scope="row"><pre>                forKey:@"employees"];<span></span></pre></td></tr><tr><td scope="row"><pre>        [employees addObjectsFromArray:otherArray];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self didChange:NSKeyValueChangeInsertion valuesAtIndexes:indexes<span></span></pre></td></tr><tr><td scope="row"><pre>                forKey:@"employees"];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40002138-SW4" title="Dependent Values"></a><h2><a name="//apple_ref/doc/uid/TP40002135-SW1" title="Dependent Values"></a>Dependent Values</h2><p>There are many situations in which the value of one property depends on that of one or more other properties. If the value of one attribute changes, then the value of the derived property should also be flagged for change. How you ensure that key-value observing notifications are posted for these dependent properties depends on which version of Mac OS X you’re using.</p><a name="//apple_ref/doc/uid/TP40002138-SW6" title="Mac OS X v10.5 and later"></a><h3>Mac OS X v10.5 and later</h3><p>If you are targeting Mac OS X v10.5 and later, to trigger notifications automatically you should either override <code><!--a target="_top" -->keyPathsForValuesAffectingValueForKey:<!--/a--></code> or implement a suitable method that follows the pattern it defines for registering dependent keys.</p><p>For example, you could override <code><!--a target="_top" -->keyPathsForValuesAffectingValueForKey:<!--/a--></code> as shown in the following example:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSSet *)keyPathsForValuesAffectingValueForKey:(NSString *)key<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSSet *keyPaths = [super keyPathsForValuesAffectingValueForKey:key];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ([key isEqualToString:@"fullNameAndID"])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSSet *affectingKeys = [NSSet setWithObjects:@"lastName", @"firstName", @"employeeID", nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        keyPaths = [keyPaths setByAddingObjectsFromSet:affectingKeys];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return keyPaths;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Or, to achieve the same result, you could just implement <code>keyPathsForValuesAffectingFullNameAndID</code> as illustrated in the following example: </p><div class="codesample"><table><tr><td scope="row"><pre>+ (NSSet *)keyPathsForValuesAffectingFullNameAndID<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [NSSet setWithObjects:@"lastName", @"firstName", @"employeeID", nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="importantbox"><a name="//apple_ref/doc/uid/TP40002138-DontLinkElementID_5" title="Important:"></a><p><strong>Important:</strong>&nbsp;Note that you cannot set up dependencies on to-many relationships. For example, suppose you have an Order object with a to-many relationship (<code>orderItems</code>) to a collection of OrderItem objects, and OrderItem objects have a <code>price</code> attribute. You might want the Order object have a <code>totalPrice</code> attribute that is dependent upon the prices of all the OrderItem objects in the relationship. You can <em>not</em> do this by implementing <code>keyPathsForValuesAffectingValueForKey:</code> and returning <code>orderItems.price</code> as the keypath for <code>totalPrice</code>. You must observe the <code>price</code> attribute of each of the OrderItem objects in the <code>orderItems</code> collection and respond to changes in their values by updating <code>totalPrice</code> yourself.</p><p></p></div><a name="//apple_ref/doc/uid/TP40002138-SW5" title="Mac OS X v10.3 and later"></a><h3>Mac OS X v10.3 and later</h3><p>If you are targeting Mac OS X v10.3 and later, you should use <code><a href="../../../Reference/Foundation/Protocols/NSKeyValueObserving_Protocol/DeprecationAppendix/AppendixADeprecatedAPI.html#//apple_ref/occ/clm/NSObject/setKeys:triggerChangeNotificationsForDependentKey:" target="_top">setKeys:triggerChangeNotificationsForDependentKey:</a></code> to trigger notifications automatically. You set up the dependencies as illustrated in the following example:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (void)initialize<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray *keys = [NSArray arrayWithObjects:<span></span></pre></td></tr><tr><td scope="row"><pre>        @"firstName", @"lastName", nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setKeys:keys triggerChangeNotificationsForDependentKey:<span></span></pre></td></tr><tr><td scope="row"><pre>        @"fullName"];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="importantbox"><a name="//apple_ref/doc/uid/TP40002138-DontLinkElementID_6" title="Important:"></a><p><strong>Important:</strong>&nbsp;Note that you cannot set up dependencies on key <em>paths</em>. For example, suppose you have an Order object with a to-many relationship (<code>orderItems</code>) to a collection of OrderItem objects, and OrderItem objects have a <code>price</code> attribute. You might want the Order object have a <code>totalPrice</code> attribute that is dependent upon the prices of all the OrderItem objects in the relationship. You can <em>not</em> do this with <code>setKeys:triggerChangeNotificationsForDependentKey:</code> passing <code>orderItems.price</code> as the key. You must observe the <code>price</code> attribute of each of the OrderItem objects in the <code>orderItems</code> collection and respond to changes in their values by updating <code>totalPrice</code> yourself.</p><p></p></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../cdAccessorMethods.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="moValidation.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-02-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/ModelObjects/Articles/moIntegrating.html%3Fid%3DTP40001931-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/ModelObjects/Articles/moIntegrating.html%3Fid%3DTP40001931-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/ModelObjects/Articles/moIntegrating.html%3Fid%3DTP40001931-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
