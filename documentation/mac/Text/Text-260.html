<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>The Font Header Table(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING260></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-259.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-261.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-181.html"><B>Chapter 4 - Font Manager</B></A> / <A HREF="Text-209.html"><B>Font Manager Reference</B></A><BR><DL><DD><A HREF="Text-253.html"><B>The Outline Font ('sfnt') Resource</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING260-0></A>
<H3><A NAME=MARKER-9-488></A>The Font Header Table</H3>
 <A NAME=MARKER-2-350></A>The font header table, with a tag name of <CODE>'head'</CODE>, is shown in <A HREF=#MARKER-9-490>Figure 4-19</A>. This table contains global information about the font: the font version number; creation and modification dates; revision number; basic typographic data that applies to the font as a whole, such as the direction in which the font's glyphs are most likely to be written; and other information about the placement of glyphs in the em square.<P>
<B>Figure 4-19  <A NAME=MARKER-9-490></A>The font header table</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/FM-23.jpg">
 For a complete description of the individual fields in this table, see the <I>TrueType Font Format Specification</I>. Application developers may be interested in the following fields:<P>
<UL>
<LI>Version. The version number of the table, as a fixed-point value. This value is $00010000 if the version number is 1.0. 
<LI>Font revision. A fixed-point value set by the font designer. 
<LI>Checksum adjustment. The checksum of the font, as an unsigned long integer.
<LI>Units per em. This unsigned integer value represents a power of 2 that ranges from <BR>64 to 16,384. Apple's TrueType fonts use the value 2048.<A NAME=MARKER-2-73></A>
<LI>Creation date. The date this font was created. This is a long date-time value of data type <CODE>LongDateTime</CODE>, which is a 64-bit, signed representation of the number of seconds since Jan. 1, 1904.
<LI>Modification date. The date this font was last modified. This is a long date-time value of data type <CODE>LongDateTime</CODE>, which is a 64-bit, signed representation of the number of seconds since Jan. 1, 1904. 
<LI>Smallest readable size. The smallest readable size for the font, in pixels per em. <BR>The <CODE>RealFont</CODE> function, which is described in the section <A HREF=Text-226.html#MARKER-9-358>"RealFont" beginning on page 4-48</A>, returns <CODE>FALSE</CODE> for a TrueType font if the requested size is smaller than <BR>this value. 
<LI>Location table format. The format of the location table (tag name: <CODE>'loca'</CODE>), as an signed integer value. The table has two formats: if the value is 0, the table uses the short offset format; if the value is 1, the table uses the long offset format. The location table is described in the section <A HREF=Text-264.html#MARKER-9-503>"The Location Table" on page 4-79</A>.<P>
</UL>
 You can use the value of the checksum adjustment element to verify the integrity of the data in the font, to confirm that no data has been changed, or to compare two similar fonts. This value is the designer's checksum value for the font. The checksum value is an unsigned long word that you compute as follows:<P>
<OL>
<LI>Set the value of the checksum word to 0 (so that it does not factor into the value that you are computing).
<LI>Calculate the checksum for each table in the outline font resource and store the table's checksum in the table directory.
<LI>Now sum the entire font as an unsigned, 32-bit value.
<LI>Subtract the sum from $B1B0AFBA, which is a magic number for this checksum computation. Store the result.<P>
</OL>
 <A HREF=#MARKER-9-492>Listing 4-2</A> provides an example of a function to compute the checksum of a font. This example includes type declarations for the outline font header information and uses the <CODE>MyCalcTableChecksum</CODE> function (from <A HREF=#MARKER-9-492>Listing 4-2 on page 4-72</A>) to compute the checksum for each table.<P>
<A NAME=MARKER-9-492></A><B>Listing 4-3  Calculating the checksum of a font</B><P>
<PRE>
TYPE

DirectoryEntry =
RECORD
   tag: OSType;
   checksum: LongInt;
   offset: LongInt;
   lngth: LongInt;
END;

OffsetTable =
RECORD
   version: LongInt;
   numTables: Integer;
   searchRange: Integer;
   entrySelector: Integer;
   rangeShift: Integer;
   tableDir: ARRAY[1..1] OF DirectoryEntry;
                         { actually 1..numTables }
END;

SfntPtr = ^OffsetTable;
SfntHandle = ^SfntPtr;
HeaderTable =
RECORD
   version: LongInt;
   fontRevision: LongInt;
   checkSumAdjustment: LongInt;
   magicNumber: LongInt;
   flags: Integer;
   unitsPerEm: Integer;
   created: LongDateTime; { defined in Script.p }
   modified: LongDateTime;
   xMin: Integer;
   yMin: Integer;
   xMax: Integer;
   yMax: Integer;
   macStyle: Integer;
   lowestRecPPEM: Integer;
   fontDirectionHint: Integer;
   indexToLocFormat: Integer;
   glyphDataFormat: Integer;
END;

HeaderTablePtr = ^HeaderTable;

FUNCTION CalcSfntChecksum (sp: SfntPtr): LongInt;
CONST
   checkSumMagic = $B1B0AFBA;
VAR
   i: Integer;
   cs, sum, size: LongInt;
   htp: HeaderTableptr;
BEGIN
   sum := 0;
   FOR i := 1 TO sp^.numTables DO BEGIN
      IF sp^.tableDir[i].tag = 'head' THEN
         BEGIN
            htp := HeaderTablePtr(ord(sp) + 
                              sp^.tableDir[i].offset);
            htp^.checkSumAdjustment := 0;
            cs := CalcTableChecksum(LongPtr(htp), 
                              SizeOf(HeaderTable));
         END
      ELSE
         cs := MyCalcTableChecksum(
                     LongPtr(ord(sp) + sp^.tableDir[i].offset), 
                  sp^.tableDir[i].lngth);

      sp^.tableDir[i].checksum := cs;
      sum := sum + cs;
   END;
   size := SizeOf(OffsetTable) + 
            (sp^.numTables - 1) * SizeOf(DirectoryEntry);
   sum := sum + CalcTableChecksum(LongPtr(sp), size);
   CalcSfntChecksum := checkSumMagic - sum;
   { to be written into htp^.checkSumAdjustment }
END;   
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-259.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-261.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
