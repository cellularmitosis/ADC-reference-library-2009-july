<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>LLVM-GCC Release Notes: LLVM-GCC 4.2 Release Notes</title>
	<meta name="Generator" content="Gutenberg"/>
	<meta name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta name = "Copyright" content="Copyright 2009 AppleInc. All Rights Reserved."/>
	<meta name="IndexTitle" content="LLVM-GCC 4.2 Release Notes"/>
	<meta name="xcode-display" content="render"/>
	<meta id="RESOURCES" content="../../../documentation/Resources" />
	<link rel="stylesheet" type="text/css" href="../../../documentation/Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../documentation/Resources/JavaScript/pedia.js"></script>
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40007133" title="LLVM-GCC 4.2 Release Notes"></a>
        <a name="top"></a>
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000872" target="_top">Release Notes</a> &gt; <a href="../index.html#//apple_ref/doc/uid/TP30000872-TP30000436" target="_top">Tools</a> &gt; <a href="../idxCompilersDebuggers-date.html#//apple_ref/doc/uid/TP30000872-TP30000436-TP30001025">Compiling &amp; Debugging</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
                
        
        <a name="//apple_ref/doc/uid/TP40007133-SW9" title="LLVM-GCC 4.2 Release Notes"></a><h1>LLVM-GCC 4.2 Release Notes</h1><p>LLVM-GCC is a new compiler optimization technology based on the LLVM (Low-Level Virtual Machine) open source project. In Xcode 3.1.x, LLVM-GCC is manifested in the LLVM-GCC 4.2 compiler.</p><p>In LLVM-GCC, LLVM is used to provide an optimizer and code generator plug-in to GCC. This technology is used in the OpenGL software stack in Mac OS X v.10.5. You can take advantage of it in your projects.</p><p>You can learn more about LLVM at <span class="content_text"><a href="http://llvm.org/" target="_blank">http://llvm.org</a></span>.</p><p>To learn about the changes made to LLVM-GCC 4.2 in Xcode 3.1.1, see <span class="content_text">“Xcode 3.1.1 Additions”</span>.</p>
<!-- This template is being used for both PDF and HTML. -->
<!-- TopicBook.pm currently relies on the element name bmini_toc. -->

    <h4>Contents:</h4>
    
    <p class="blockquote">

        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW10" target="_top">LLVM-GCC 4.2 Overview</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW11" target="_top">LLVM-GCC 4.2 Installation</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW12" target="_top">Using LLVM-GCC 4.2 in Xcode Projects</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW13" target="_top">Using LLVM-GCC 4.2 in UNIX-Based Development Environments</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW14" target="_top">Link-Time Optimization</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW7" target="_top">GCC-4.2 Features Not Available in LLVM-GCC-4.2</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW16" target="_top">LLVM Open-Source Community Information</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-DontLinkElementID_1" target="_top">Submitting Feedback to Apple</a>
                
            <br/>
            
        
			
            
                <a href="index.html#//apple_ref/doc/uid/TP40007133-SW18" target="_top">Xcode 3.1.1 Additions</a>
                
            <br/>
            
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40007133-SW10" title="LLVM-GCC 4.2 Overview"></a><h2>LLVM-GCC 4.2 Overview</h2><p>LLVM-GCC 4.2 is a standalone compiler that combines the industry standard GCC 4.2 front end with the innovative LLVM optimizer and code generator. Therefore, you can use LLVM-GCC 4.2 as a replacement for GCC 4.2. The two compilers are largely compatible, supporting the same languages and using the same command-line option and architectures. Like GCC 4.2, LLVM-GCC 4.2 supports compilation of C, C++, Objective-C, and Objective-C++ on x86, x86-64, PowerPC, and PowerPC-64. See <span class="content_text">“GCC-4.2 Features Not Available in LLVM-GCC-4.2”</span> for a list of GCC 4.2 features that LLVM-GCC 4.2 does not support.</p><a name="//apple_ref/doc/uid/TP40007133-SW11" title="LLVM-GCC 4.2 Installation"></a><h2>LLVM-GCC 4.2 Installation</h2><p>The Xcode 3.1 installer places LLVM-GCC 4.2 in <code>&lt;Xcode>/usr/bin</code> (<code>&lt;Xcode></code> is the directory into which you installed Xcode, which the installer sets as <code>/Developer</code> by default).</p><a name="//apple_ref/doc/uid/TP40007133-SW12" title="Using LLVM-GCC 4.2 in Xcode Projects"></a><h2>Using LLVM-GCC 4.2 in Xcode Projects</h2><p>In Xcode projects, you use build rules to specify the compiler to use for particular source files. To use LLVM-GCC 4.2 instead of GCC 4.2 in an Xcode project:</p><ol class="ol"><li class="li"><p>Open the target editor by double-clicking the appropriate target.</p></li><li class="li"><p>In the Rules pane choose Rules Specific to Target from the pop-up menu.</p></li><li class="li"><p>Click the Add (+) button.</p></li><li class="li"><p>Configure the new rule:</p><ol class="ol"><li class="ol ol"><p>Chose the appropriate language form the Process pop-up menu.</p></li><li class="ol ol"><p>Choose “llvmgcc42” from the “using” pop-up menu.</p></li></ol></li></ol><a name="//apple_ref/doc/uid/TP40007133-SW13" title="Using LLVM-GCC 4.2 in UNIX-Based Development Environments"></a><h2>Using LLVM-GCC 4.2 in UNIX-Based Development Environments</h2><p>You use LLVM-GCC 4.2 in UNIX-based development environments just as you use GCC 4.2. The majority of such environments respect the <code>CC</code> and <code>CXX</code> environment variables. For example, the following listing shows one way to set LLVM-GCC 4.2 as the compiler for C source files.</p><div class="codesample"><table><tr><td scope="row"><pre>CC=&lt;Xcode>/usr/bin/llvm-gcc-4.2 make<span></span></pre></td></tr></table></div><p>Here, <code>&lt;Xcode></code> is the directory into which you installed Xcode.</p><p>If you have several copies of Xcode installed on your computer, may also use <code>`xcode-select -print-path`</code> in <code>CC</code>, <code>CXX</code>, or shell scripts to get the path to the Xcode release you have selected as the one to use for UNIX-based development.</p><div class="codesample"><table><tr><td scope="row"><pre>CC=`xcode-select -print-path`/usr/bin/llvm-gcc-4.2 make<span></span></pre></td></tr></table></div><p>See <code><a href="../../../documentation/Darwin/Reference/ManPages/man1/xcode-select.1.html#//apple_ref/doc/man/1/xcode-select" target="_top">xcode-select</a></code> for more information on this facility, but keep in mind that you cannot use all the features of <code>xcode-select</code> to locate Xcode directories on your file system. Only <code>xcode-select -print-path</code> is supported with LLVM-GCC 4.2.</p><a name="//apple_ref/doc/uid/TP40007133-SW14" title="Link-Time Optimization"></a><h2>Link-Time Optimization</h2><p>Traditionally, compilers optimize individual source files while building a project. However, this model does not allow compilers to take advantage of symbol information available in separate source files, but the linker collects this information during the link stage. Link-Time Optimization allows the optimizer to look across object files in your program and optimize across file boundaries. For example, one possible optimization is the inlining of a function defined in one file into a function defined in another file. See <span class="content_text">“sourcefile1.c: getNumber()”</span> and <span class="content_text">“sourcefile2.c: processNo(int)”</span>.</p><a name="//apple_ref/doc/uid/TP40007133-SW1" title="Listing 1-1sourcefile1.c: getNumber()"></a><p class="codesample"><strong>Listing 1-1&nbsp;&nbsp;</strong><code>sourcefile1.c</code>: <code>getNumber()</code></p><div class="codesample"><table><tr><td scope="row"><pre>int getNumber() {<span></span></pre></td></tr><tr><td scope="row"><pre>    return 42;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007133-SW2" title="Listing 1-2sourcefile2.c: processNo(int)"></a><p class="codesample"><strong>Listing 1-2&nbsp;&nbsp;</strong><code>sourcefile2.c</code>: <code>processNo(int)</code></p><div class="codesample"><table><tr><td scope="row"><pre>extern int getNumber();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int processNo(int i) {<span></span></pre></td></tr><tr><td scope="row"><pre>    return i * getNumber();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>During the link-time optimization stage, the function <code>getNumber()</code> (defined in <code>sourcefile1.c</code>) is inlined inside the function <code>processNo(int)</code> (defined in <code>sourcefile2.c</code>).</p><p>To turn on Link-Time Optimization use <code>-O4</code> command-line option or set the Optimization Level build setting to <code>4</code> in the build settings editor for the appropriate target.</p><p>LLVM-GCC 4.2 supports a wide range of interprocedural optimizations, including global variable optimization, inter modular inlining, interprocedural constant propagation and dead argument elimination.</p><a name="//apple_ref/doc/uid/TP40007133-SW6" title="Mixing LLVM Bitcode Files with Mach-O Files"></a><h3>Mixing LLVM Bitcode Files with Mach-O Files</h3><p>When Link-Time Optimization is turned on, the object files LLVM-GCC 4.2 generates are not Mach-O object files. Instead they are object files that use the LLVM bitcode file format (<span class="content_text"><a href="http://llvm.org/docs/BitCodeFormat.html" target="_blank">http://llvm.org/docs/BitCodeFormat.html</a></span>). These files contain LLVM bitcode that the linker optimizes using the LLVM optimizer. Specifically, the Xcode linker links LLVM files together. But it can also link LLVM bitcode files with Mach-O object files to generate an optimized Mach-O binary.</p><p>Let’s look at an example that illustrates how the linker links one LLVM bitcode file with a Mach-O object file. In this example, the source files <span class="content_text">“header.h”</span>, <span class="content_text">“sourcefile3.c”</span>, and <span class="content_text">“main.c”</span> are compiled and linked with <span class="content_text">“Compiling and linking sourcefile3.c and main.c”</span>.</p><a name="//apple_ref/doc/uid/TP40007133-SW3" title="Listing 1-3header.h"></a><p class="codesample"><strong>Listing 1-3&nbsp;&nbsp;</strong><code>header.h</code></p><div class="codesample"><table><tr><td scope="row"><pre>extern int fn1(void);<span></span></pre></td></tr><tr><td scope="row"><pre>extern void fn2(void);<span></span></pre></td></tr><tr><td scope="row"><pre>extern void fn4(void);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007133-SW5" title="Listing 1-4sourcefile3.c"></a><p class="codesample"><strong>Listing 1-4&nbsp;&nbsp;</strong><code>sourcefile3.c</code></p><div class="codesample"><table><tr><td scope="row"><pre>#include "header.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static signed int flag = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>void fn2(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    flag = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>static int fn3() {<span></span></pre></td></tr><tr><td scope="row"><pre>    fn4();<span></span></pre></td></tr><tr><td scope="row"><pre>    return 10;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int fn1(void) {<span></span></pre></td></tr><tr><td scope="row"><pre>    int data = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (flag &lt; 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        data = fn3();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    data = data + 42;<span></span></pre></td></tr><tr><td scope="row"><pre>    return data;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007133-SW4" title="Listing 1-5main.c"></a><p class="codesample"><strong>Listing 1-5&nbsp;&nbsp;</strong><code>main.c</code></p><div class="codesample"><table><tr><td scope="row"><pre>#include &lt;stdio.h><span></span></pre></td></tr><tr><td scope="row"><pre>#include "header.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void fn4() {<span></span></pre></td></tr><tr><td scope="row"><pre>    printf("Hi\n");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>int main() {<span></span></pre></td></tr><tr><td scope="row"><pre>    return fn1();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40007133-SW8" title="Listing 1-6Compiling and linking sourcefile3.c and main.c"></a><p class="codesample"><strong>Listing 1-6&nbsp;&nbsp;</strong>Compiling and linking <code>sourcefile3.c</code> and <code>main.c</code></p><div class="codesample"><table><tr><td scope="row"><pre>$ llvm-gcc-4.2 -O4 -c sourcefile3.c -o sourcefile3.o<span></span></pre></td></tr><tr><td scope="row"><pre>$ llvm-gcc-4.2 -c main.c -o main.o<span></span></pre></td></tr><tr><td scope="row"><pre>$ llvm-gcc-4.2 sourcefile3.o main.o -o main<span></span></pre></td></tr></table></div><p>The linker recognizes that <code>fn2()</code> is an externally visible symbol defined in LLVM bitcode but unused. This information helps the LLVM optimizer remove <code>fn2()</code>, which, in turn, allows the optimizer to prove that <code>flag</code> is always <code>0</code>. As a result, the optimizer removes the branch in <code>fn1()</code>, which results in the removal of <code>fn3()</code> because it’s now unused. With the removal of <code>fn3()</code>, the linker concludes that <code>fn4()</code> is also unused, which it then removes.</p><p>Note that <code>sourcefile3.o</code> is an LLVM bitcode file and <code>main.o</code> is a Mach-O object file. No additional linker command-line options are required to link them together and generate the optimized <code>main</code> executable.</p><a name="//apple_ref/doc/uid/TP40007133-SW15" title="Link-Time Optimization and Symbol Visibility"></a><h3>Link-Time Optimization and Symbol Visibility</h3><p>Link-Time Optimization respects symbol visibility. The link-time optimizer does not remove a symbol that is marked as externally visible while building a dynamic library, even if the optimizer determines that the symbol is unused. If a function is not marked as externally visible, the optimizer is free to change its signature by removing dead arguments or removing the function entirely, for example.</p><p>In a dynamic library, symbols are considered externally visible by default, but in a standalone executable, symbols other than <code>main()</code> are internal by default. This behavior allows the optimizer to remove <code>fn2()</code> in the example in <span class="content_text">“Mixing LLVM Bitcode Files with Mach-O Files”</span>. For more information on symbol visibility, see <span class="content_text"><a href="../../../documentation/DeveloperTools/Conceptual/CppRuntimeEnv/Articles/SymbolVisibility.html#//apple_ref/doc/uid/TP40001670" target="_top">Controlling Symbol Visibility</a></span>.</p><a name="//apple_ref/doc/uid/TP40007133-SW7" title="GCC-4.2 Features Not Available in LLVM-GCC-4.2"></a><h2>GCC-4.2 Features Not Available in LLVM-GCC-4.2</h2><p>These are GCC 4.2 features that are not available in LLVM-GCC 4.2:</p><ul class="ul"><li class="li"><p>Profile-guided optimization</p></li><li class="li"><p>Auto vectorization</p></li><li class="li"><p>Stack canaries</p></li><li class="li"><p>Inline assembly that uses x87 registers</p></li><li class="li"><p>Generating debug information for optimized code</p></li></ul><a name="//apple_ref/doc/uid/TP40007133-SW16" title="LLVM Open-Source Community Information"></a><h2>LLVM Open-Source Community Information</h2><p>LLVM is supported by an active open-source community, whose home is located at <span class="content_text"><a href="http://llvm.org/" target="_blank">http://llvm.org</a></span>. You can interact directly with LLVM developers through the mailing lists available at this website.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40007133-SW17" title="Reminder"></a><p><strong>Reminder:</strong>&nbsp;Please do not discuss Xcode information covered under your NDA with Apple in these mailing lists.</p></div><a name="//apple_ref/doc/uid/TP40007133-DontLinkElementID_1" title="Submitting Feedback to Apple"></a><h2>Submitting Feedback to Apple</h2><p>Apple Developer Connection members can submit bug reports and technical-support inquiries:</p><ul class="ul"><li class="li"><p>To submit bug reports, visit <span class="content_text"><a href="https://bugreport.apple.com" target="_blank">https://bugreport.apple.com</a></span>.</p></li><li class="li"><p>Send technical-support inquiries to <code>dts@apple.com</code>.</p></li></ul><p>If you’re not an ADC member, vist <span class="content_text"><a href="http://developer.apple.com" target="_top">http://developer.apple.com</a></span> to sign up.</p><p>For a list of Apple mailing lists, visit <span class="content_text"><a href="http://lists.apple.com" target="_blank">http://lists.apple.com</a></span>.</p><a name="//apple_ref/doc/uid/TP40007133-SW18" title="Xcode 3.1.1 Additions"></a><h2>Xcode 3.1.1 Additions</h2><p>These are the improvements made to LLVM-GCC 4.2 in Xcode 3.1.1:</p><ul class="ul"><li class="li"><p>OpenMP support (with the inclusion of atomic built-in functions)</p></li><li class="li"><p>Object-size checking; for example, <code>-D_FORTIFY_SOURCE=2</code></p></li><li class="li"><p>LLVM bitcode format change to align files to 16 bytes and to contain the CPU type to fix a problem with link-time optimization (LTO)</p></li><li class="li"><p>Several ABI fixes:</p><ul class="nested"><li class="nested li"><p>In the 64-bit ABI, nonfragile Objective-C instance-variable sizes are calculated at runtime instead of compile time.</p></li><li class="nested li"><p>Fixed problem in which some Objective-C metadata is incorrectly generated for nonoptimized code.</p></li><li class="nested li"><p>Fixed minor vector-related ABI mismatches between GCC 4.2 and LLVM-GCC 4.2 on the x86-64 architecture.</p></li><li class="nested li"><p>Fixed a problem in which the alignment of a structure of a field assumes the alignment of the base of the structure.</p></li><li class="nested li"><p>Fixed a problem in which explicit trailing padding bytes of a structure with a trailing union didn’t fill out the structure completely.</p></li></ul></li><li class="li"><p>Debugging improvements and bug fixes:</p><ul class="nested"><li class="nested li"><p>Improved compilation time when the <code>-O0</code> and <code>-g</code> flags are used:</p><ul class="nested"><li class="nested li"><p>Unreferenced static functions are no longer emitted</p></li><li class="nested li"><p>Explicit names for variables in LLVM bitcode files are not used</p></li><li class="nested li"><p>DWARF output improvements to prevent unnecessary information duplication</p></li><li class="nested li"><p>Reduction of the amount of unnecessary work the compiler does when compiling for debugging</p></li><li class="nested li"><p>Improvement of the compiler’s memory management</p></li></ul></li><li class="nested li"><p>Debug information is emitted for data-only files</p></li><li class="nested li"><p>The linker accepts some command-line options (such as <code>-mllvm</code>) to turn on LTO debugging, statistics dumping, and so on</p></li><li class="nested li"><p>Fixed memory corruption problem with precompiled headers (PCH)</p></li></ul></li></ul>

        <br/><br/> 
        
        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-09-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/releasenotes/DeveloperTools/RN-llvm-gcc/index.html%3Fid%3DTP40007133-1.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/releasenotes/DeveloperTools/RN-llvm-gcc/index.html%3Fid%3DTP40007133-1.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/releasenotes/DeveloperTools/RN-llvm-gcc/index.html%3Fid%3DTP40007133-1.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
</body>
</html>