<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Code Loading Programming Topics for Cocoa: Creating Plug-in Architectures</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating Plug-in Architectures"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001276" title="Creating Plug-in Architectures"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../ResourceManagement-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000458" target="_top">Resource Management</a> &gt; <a href="../index.html" target="_top">Code Loading Programming Topics for Cocoa</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="Componentizing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="NameConflicts.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20001276-CJBDDCAB" title="Creating Plug-in Architectures"></a><hr /><H1>Creating Plug-in Architectures</H1>

<p>Many applications benefit from having a plug-in architecture—a way to extend the application with new features without changing the main application code. This section describes how to create a plug-in architecture for a Cocoa application.</p>

<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-99584">Building the Architecture</a>
				
			<br/>
			
        
			
			
				<a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-100982">Loading Plug-ins</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001276-99584" title="Building the Architecture"></a><h2>Building the Architecture</h2>
<p>The first step in implementing a plug-in architecture is deciding what form you want plug-ins to take. For guidelines on how to decide which mechanism you want to use, read <span class="content_text"><a href="../Concepts/Plugins.html#//apple_ref/doc/uid/20001272-98794">“Plug-in Architecture Design.”</a></span></p>
<p>The Cocoa architecture naturally supports three choices:</p>
<ul class="ul"><li class="li"><p>Plug-ins implement a formal protocol</p></li>
<li class="li"><p>Plug-ins implement some number of methods from an informal protocol</p></li>
<li class="li"><p>Plug-ins inherit from an abstract or concrete base class</p></li></ul>
<p>In all three cases, you provide a standard interface to plug-in developers, and they write plug-in principal classes to match the interface. The most convenient way to do this is to provide the interface as a framework for plug-in developers to link against.</p>
<p>The following sections describe how to publish the three different types of plug-in interfaces.</p>
<a name="//apple_ref/doc/uid/20001276-100218" title="Publishing a Formal Protocol Plug-in Interface"></a><h3>Publishing a Formal Protocol Plug-in Interface</h3>
<p>To use a plug-in protocol you define, the plug-in developer only needs the header file containing the protocol definition. The easiest way to publish the interface is to simply distribute this header.</p>
<p>A protocol header for a graphics filter plug-in might look something like <span class="content_text">Listing 1</span>:</p>
<a name="//apple_ref/doc/uid/20001276-100234-CJBJCCAD" title="Listing 1Formal protocol for a plug-in architecture"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-100234" title="Listing 1Formal protocol for a plug-in architecture"></a><strong>Listing 1&nbsp;&nbsp;</strong>Formal protocol for a plug-in architecture</p>
<div class="codesample"><table><tr><td scope="row"><pre>/*<span></span></pre></td></tr><tr><td scope="row"><pre>   MyGreatImageApp<span></span></pre></td></tr><tr><td scope="row"><pre>   Graphics Filter Interface version 0<span></span></pre></td></tr><tr><td scope="row"><pre>   MyAppBitmapGraphicsFiltering.h<span></span></pre></td></tr><tr><td scope="row"><pre>*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@protocol MyGreatImageAppBitmapGraphicsFiltering<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Returns the version of the interface you're implementing.<span></span></pre></td></tr><tr><td scope="row"><pre>// Return 0 here or future versions may look for features you don't have!<span></span></pre></td></tr><tr><td scope="row"><pre>- (unsigned)interfaceVersion;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Returns what to display in the Filter menu.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSString *)menuItemString;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// The main worker bee: filters the bitmap and returns a modified version.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSBitmapImageRep *)filteredImageRep:(NSBitmapImageRep *)imageRep;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Returns the window controller for the settings configuration window.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSWindowController *)configurationWindowController;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<p>Notice that this example includes a version method so the application can identify the version of the interface being used. If you are just distributing a header file, this is the best way to ensure that future versions of your application avoid sending messages to old plug-ins that they can’t handle. You can also query the plug-in for what messages it responds to, as described in <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-102909">“Validating Plug-ins.”</a></span></p>
<a name="//apple_ref/doc/uid/20001276-100027" title="Publishing an Informal Protocol Plug-in Interface"></a><h3>Publishing an Informal Protocol Plug-in Interface</h3>
<p>Using an informal protocol for a plug-in architecture is somewhat trickier than using a formal protocol. Because the plug-in developer can choose which methods to implement, your application has to check before using a method if the plug-in actually implements it. If some methods are optional and some are required, be sure to make this clear in the documentation for the interface.</p>
<p>You can distribute a single header file to define an informal protocol, just as with a formal protocol. <span class="content_text">Listing 2</span> is an alternate implementation of <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-100234-CJBJCCAD">Listing 1</a></span>, using an informal protocol instead of a formal protocol, effectively making some methods optional. Like most informal protocols, this one is implemented as a category on NSObject.</p>
<a name="//apple_ref/doc/uid/20001276-100063-CJBEGGHD" title="Listing 2Informal protocol for a plug-in architecture"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-100063" title="Listing 2Informal protocol for a plug-in architecture"></a><strong>Listing 2&nbsp;&nbsp;</strong>Informal protocol for a plug-in architecture</p>
<div class="codesample"><table><tr><td scope="row"><pre>/*<span></span></pre></td></tr><tr><td scope="row"><pre>   MyGreatImageApp<span></span></pre></td></tr><tr><td scope="row"><pre>   Graphics Filter Interface version 0<span></span></pre></td></tr><tr><td scope="row"><pre>   MyAppBitmapGraphicsFiltering.h<span></span></pre></td></tr><tr><td scope="row"><pre>*/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface NSObject(MyGreatImageAppBitmapGraphicsFiltering)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// REQUIRED<span></span></pre></td></tr><tr><td scope="row"><pre>// Returns the version of the interface you're implementing.<span></span></pre></td></tr><tr><td scope="row"><pre>// Return 0 here or future versions may look for features you don't have!<span></span></pre></td></tr><tr><td scope="row"><pre>- (unsigned)interfaceVersion;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// OPTIONAL<span></span></pre></td></tr><tr><td scope="row"><pre>// Returns what to display in the Filter menu. Defaults to the plug-in<span></span></pre></td></tr><tr><td scope="row"><pre>// filename without the extension.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSString *)menuItemString;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// REQUIRED<span></span></pre></td></tr><tr><td scope="row"><pre>// The main worker bee: filters the bitmap and returns a modified version.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSBitmapImageRep *)filteredImageRep:(NSBitmapImageRep *)imageRep;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// OPTIONAL<span></span></pre></td></tr><tr><td scope="row"><pre>// Returns the window controller for the settings configuration window.<span></span></pre></td></tr><tr><td scope="row"><pre>// If this method is not implemented, no Settings option is provided.<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSWindowController *)configurationWindowController;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/20001276-100337" title="Publishing a Base Class Plug-in Interface"></a><h3>Publishing a Base Class Plug-in Interface</h3>
<p>If you want to provide shared functionality to all plug-ins, you may want to provide a base class for plug-in principal classes to inherit from. For example, the Mac OS X screen saver interface is provided as a framework containing the ScreenSaverView base class, which handles a number of management details for screen saver plug-ins. To distribute your base class, the best solution is to package it as a framework for plug-in developers to link against.</p>
<p><span class="content_text">Listing 3</span> shows the interface for a hypothetical embedding plug-in architecture, and <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-100593-CJBBBAJD">Listing 4</a></span> shows its implementation. Instead of a protocol, the interface is provided as a base class that provides some functionality, in this example a fairly simple subclass of NSView that returns version information, maintains a URL containing a data source, and draws a white background. Note that the class contains three reserved pointers. These allow the base class to add new member data without changing the size of the object, thus allowing the host application developer to add features without creating binary incompatibilities.</p>
<a name="//apple_ref/doc/uid/20001276-100384-CJBCDIJH" title="Listing 3Base class interface for a plug-in architecture"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-100384" title="Listing 3Base class interface for a plug-in architecture"></a><strong>Listing 3&nbsp;&nbsp;</strong>Base class interface for a plug-in architecture</p>
<div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface MyAppEmbeddingView : NSView<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>@private<span></span></pre></td></tr><tr><td scope="row"><pre>    NSURL *_URL;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *_reserved1;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *_reserved2;<span></span></pre></td></tr><tr><td scope="row"><pre>    void *_reserved3;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (id)initWithFrame:(NSRect)frameRect URL:(NSURL)URL;<span></span></pre></td></tr><tr><td scope="row"><pre>- (unsigned)interfaceVersion;<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSURL *)URL;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)setURL:(NSURL *)URL;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/20001276-100593-CJBBBAJD" title="Listing 4Base class implementation for a plug-in architecture"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-100593" title="Listing 4Base class implementation for a plug-in architecture"></a><strong>Listing 4&nbsp;&nbsp;</strong>Base class implementation for a plug-in architecture</p>
<div class="codesample"><table><tr><td scope="row"><pre>#import "MyAppEmbeddingView.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@implementation MyAppEmbeddingView<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (id)initWithFrame:(NSRect)frameRect URL:(NSURL)URL<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    self = [self initWithFrame:frameRect];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setURL:URL];<span></span></pre></td></tr><tr><td scope="row"><pre>    return self<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (unsigned)interfaceVersion<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)drawRect:(NSRect)rect<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSEraseRect(rect);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (NSURL *)URL<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return _URL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)setURL:(NSURL *)URL<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [URL retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    [_URL release];<span></span></pre></td></tr><tr><td scope="row"><pre>    _URL = URL;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>
<p>Once you have finished your base class, you should package the compiled implementation with the header file in a framework for plug-in developers to use. To build a framework, use Xcode’s Cocoa Framework project template. Make sure you designate private and public header files as you intend in the Build Phases > Headers section of the Target Settings pane. For more information about building frameworks, see “Creating Frameworks and Libraries” in Xcode Help.</p>
<a name="//apple_ref/doc/uid/20001276-100982" title="Loading Plug-ins"></a><h2>Loading Plug-ins</h2>
<p>To use plug-ins, your application needs to go through this process:</p>
<ol class="ol"><li class="li"><p>Find available plug-ins in standard locations</p></li>
<li class="li"><p>Load the executable code for each plug-in</p></li>
<li class="li"><p>Validate conformance of each plug-in to the plug-in interface</p></li>
<li class="li"><p>Instantiate valid plug-ins</p></li></ol>
<p>The specific details of finding, loading, and instantiating plug-ins are the same as described in <span class="content_text"><a href="LoadingBundles.html#//apple_ref/doc/uid/20001273-99488">“Loading Cocoa Bundles with NSBundle.”</a></span> The additional step for plug-in architectures is to validate that each plug-in conforms to the interface you published for plug-in developers to use.</p>
<p>Validation is slightly different depending on whether your plug-in architecture uses a formal protocol, an informal protocol, or a base class.</p>
<a name="//apple_ref/doc/uid/20001276-102909" title="Validating Plug-ins"></a><a name="//apple_ref/doc/uid/20001276-102909-CJBHGAFG" title="Validating Plug-ins"></a><h3>Validating Plug-ins</h3>
<p>For a formal protocol, you query the class to see if it implements the protocol. To be safe, you should also perform a reality check to see that it indeed implements the methods it claims to implement. <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-102948-CJBGAGDE">Listing 5</a></span> shows the implementation for a method that checks if a plug-in’s principal class conforms to the <code>MyGreatImageAppBitmapFiltering</code> protocol defined in <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-100234-CJBJCCAD">Listing 1</a></span>, and additionally checks to make sure that it implements all the necessary instance methods.</p>
<a name="//apple_ref/doc/uid/20001276-102948-CJBGAGDE" title="Listing 5Plug-in validation (formal protocol)"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-102948" title="Listing 5Plug-in validation (formal protocol)"></a><strong>Listing 5&nbsp;&nbsp;</strong>Plug-in validation (formal protocol)</p>
<div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)plugInClassIsValid:(Class)plugInClass<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if([plugInClass<span></span></pre></td></tr><tr><td scope="row"><pre>        conformsToProtocol:@protocol(MyGreatImageAppBitmapFiltering)])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if([plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                        @selector(interfaceVersion)] &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>           [plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                        @selector(menuItemString)] &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>           [plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                        @selector(filteredImageRep)] &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>           [plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                        @selector(configurationWindowController])<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return NO;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>For an informal protocol, you <em>must</em> query the class to see which methods it implements. Typically, host application developers define certain methods as required, and others as optional, so a validation method should distinguish between the two properly. <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-103097-CJBFDEEF">Listing 6</a></span> gives the implementation for an informal version of the plug-in validation method. The method makes sure that the plug-in implements all the required methods from the informal version of <code>MyGreatImageAppBitmapFiltering</code> given in <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-100063-CJBEGGHD">Listing 2</a></span>. You can check for optional methods as they are needed elsewhere in the application.</p>
<a name="//apple_ref/doc/uid/20001276-103097-CJBFDEEF" title="Listing 6Plug-in validation (informal protocol)"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-103097" title="Listing 6Plug-in validation (informal protocol)"></a><strong>Listing 6&nbsp;&nbsp;</strong>Plug-in validation (informal protocol)</p>
<div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)plugInClassIsValid:(Class)plugInClass<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if([plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                    @selector(interfaceVersion)] &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>       [plugInClass instancesRespondToSelector:<span></span></pre></td></tr><tr><td scope="row"><pre>                    @selector(filteredImageRep)])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return NO;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>A plug-in that inherits from a base class is the easiest to validate. You simply query the plug-in’s principal class to see if it is a subclass of the base class, as shown in <span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-103191-CJBFHBCH">Listing 7</a></span>.</p>
<a name="//apple_ref/doc/uid/20001276-103191-CJBFHBCH" title="Listing 7Plug-in validation (base class)"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-103191" title="Listing 7Plug-in validation (base class)"></a><strong>Listing 7&nbsp;&nbsp;</strong>Plug-in validation (base class)</p>
<div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)plugInClassIsValid:(Class)plugInClass<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if([plugInClass isSubclassOfClass:[MyAppEmbeddingView class]])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return NO;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/20001276-103254" title="Loading Plug-ins: Example Code"></a><h3>Loading Plug-ins: Example Code</h3>
<p><span class="content_text"><a href="UsingPlugins.html#//apple_ref/doc/uid/20001276-103283-CJBHCBEJ">Listing 8</a></span> is a slightly modified version of <span class="content_text"><a href="LoadingBundles.html#//apple_ref/doc/uid/20001273-100792-BCIFCIIB">Listing 1</a></span> that validates plug-ins before adding them, indicated by the margin comment  <code>// Validation</code>. For a full description of how the code works, see the original version.</p>
<a name="//apple_ref/doc/uid/20001276-103283-CJBHCBEJ" title="Listing 8Implementation for plug-in loading methods"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001276-103283" title="Listing 8Implementation for plug-in loading methods"></a><strong>Listing 8&nbsp;&nbsp;</strong>Implementation for plug-in loading methods</p>
<div class="codesample"><table><tr><td scope="row"><pre>NSString *ext = @"plugin";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString *appSupportSubpath = @"Application Support/KillerApp/PlugIns";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// ...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)loadAllPlugins<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray *instances;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray *bundlePaths;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSEnumerator *pathEnum;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *currPath;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSBundle *currBundle;<span></span></pre></td></tr><tr><td scope="row"><pre>    Class currPrincipalClass;<span></span></pre></td></tr><tr><td scope="row"><pre>    id currInstance;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    bundlePaths = [NSMutableArray array];<span></span></pre></td></tr><tr><td scope="row"><pre>    if(!instances)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        instances = [[NSMutableArray alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [bundlePaths addObjectsFromArray:[self allBundles]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    pathEnum = [bundlePaths objectEnumerator];<span></span></pre></td></tr><tr><td scope="row"><pre>    while(currPath = [pathEnum nextObject])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        currBundle = [NSBundle bundleWithPath:currPath];<span></span></pre></td></tr><tr><td scope="row"><pre>        if(currBundle)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            currPrincipalClass = [currBundle principalClass];<span></span></pre></td></tr><tr><td scope="row"><pre>            if(currPrincipalClass &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>               [self plugInClassIsValid:currPrincipalClass])  // Validation<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                currInstance = [[currPrincipalClass alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>                if(currInstance)<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    [instances addObject:[currInstance autorelease]];<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (NSMutableArray *)allBundles<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray *librarySearchPaths;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSEnumerator *searchPathEnum;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *currPath;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray *bundleSearchPaths = [NSMutableArray array];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableArray *allBundles = [NSMutableArray array];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    librarySearchPaths = NSSearchPathForDirectoriesInDomains(<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLibraryDirectory, NSAllDomainsMask - NSSystemDomainMask, YES);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    searchPathEnum = [librarySearchPaths objectEnumerator];<span></span></pre></td></tr><tr><td scope="row"><pre>    while(currPath = [searchPathEnum nextObject])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [bundleSearchPaths addObject:<span></span></pre></td></tr><tr><td scope="row"><pre>            [currPath stringByAppendingPathComponent:appSupportSubpath]];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [bundleSearchPaths addObject:<span></span></pre></td></tr><tr><td scope="row"><pre>        [[NSBundle mainBundle] builtInPlugInsPath]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    searchPathEnum = [bundleSearchPaths objectEnumerator];<span></span></pre></td></tr><tr><td scope="row"><pre>    while(currPath = [searchPathEnum nextObject])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSDirectoryEnumerator *bundleEnum;<span></span></pre></td></tr><tr><td scope="row"><pre>        NSString *currBundlePath;<span></span></pre></td></tr><tr><td scope="row"><pre>        bundleEnum = [[NSFileManager defaultManager]<span></span></pre></td></tr><tr><td scope="row"><pre>            enumeratorAtPath:currPath];<span></span></pre></td></tr><tr><td scope="row"><pre>        if(bundleEnum)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            while(currBundlePath = [bundleEnum nextObject])<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                if([[currBundlePath pathExtension] isEqualToString:ext])<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                 [allBundles addObject:[currPath<span></span></pre></td></tr><tr><td scope="row"><pre>                           stringByAppendingPathComponent:currBundlePath]];<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return allBundles;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="Componentizing.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="NameConflicts.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-08-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/LoadingCode/Tasks/UsingPlugins.html%3Fid%3D10000052i-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/LoadingCode/Tasks/UsingPlugins.html%3Fid%3D10000052i-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/LoadingCode/Tasks/UsingPlugins.html%3Fid%3D10000052i-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
