<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Folder Watching - /FW Receiver/AppleEvents.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxInterapplicationCommunication-date.html">Interapplication Communication</a> &gt; <A HREF="javascript:location.replace('index.html');">Folder Watching</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Folder Watching</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/FW Receiver/AppleEvents.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Folder Watcher FBA/FBA.c</option>
<option value="listing2.html">/Folder Watcher FBA/FBA.h</option>
<option value="listing3.html">/Folder Watcher FBA/FBAAppleEvents.c</option>
<option value="listing4.html">/Folder Watcher FBA/FBAAppleEvents.h</option>
<option value="listing5.html">/Folder Watcher FBA/FBALists.c</option>
<option value="listing6.html">/Folder Watcher FBA/FBALists.h</option>
<option value="listing7.html">/Folder Watcher FBA/FBATask.c</option>
<option value="listing8.html">/Folder Watcher FBA/FBATask.h</option>
<option value="listing9.html">/FW Receiver/AppleEvents.c</option>
<option value="listing10.html">/FW Receiver/BareBones.c</option>
<option value="listing11.html">/FW Receiver/BareBones.h</option>
<option value="listing12.html">/FW Receiver/Events.c</option>
<option value="listing13.html">/FW Receiver/Initialize.c</option>
<option value="listing14.html">/FW Receiver/Lists.c</option>
<option value="listing15.html">/FW Receiver/Menus.c</option>
<option value="listing16.html">/FW Receiver/PatchListLDEF.c</option>
<option value="listing17.html">/FW Receiver/Prototypes.h</option>
<option value="listing18.html">/FW Receiver/Utilities.c</option>
<option value="listing19.html">/FW Receiver/Windows.c</option></select>
				</p>
				</form>
				<p><strong><a href="Folder_Watching.zip">Download Sample</a></strong> (&#147;Folder_Watching.zip&#148;, 73.2K)<BR>
<strong><a href="Folder_Watching.dmg">Download Sample</a></strong> (&#147;Folder_Watching.dmg&#148;, 132.1K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    AppleEvents.c  Contains:  The main routine  Written by: Chris White    Copyright:  Copyright &copy; 1995-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/21/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1                  26/01/96  GS        FW Receiver                      Added ability to accept and act on Apple events from                      Folder Watcher FBA application.        12/18/95  CW        First release        */// System Includes#ifndef __APPLEEVENTS__  #include &lt;AppleEvents.h&gt;#endif#include &lt;ASRegistry.h&gt;#include &lt;Notification.h&gt;#include &lt;Icons.h&gt;#include &lt;Resources.h&gt;#ifndef __SOUND__  #include &lt;Sound.h&gt;#endif#include &lt;TextUtils.h&gt;// Application includes#ifndef __BAREBONES__  #include &quot;BareBones.h&quot;#endif#ifndef __PROTOTYPES__  #include &quot;Prototypes.h&quot;#endif#include &lt;Resources.h&gt; typedef struct MyNotificationRecord{  NMRec   notification;  Str255  notificationString;} MyNotificationRecord, *MyNotificationPtr;        // The events sent by the Folder Watcher FBA#define  kFolderWatcherSuite    'wFWS'enum{  kTypeFileAdded = 'wTFA', kTypeFileRemoved = 'wTFR', kTypeFileModified = 'wTFC'};const short    ChangeSTRs = 200;enum{  kAddedStr = 1, kRemovedStr, kModifiedStr};const short    SubroutineSTRs = 300;enum{  kAddedSub = 1, kRemovedSub, kModifiedSub};const short    NotificationIcon = 501;  // Prototypespascal OSErr HandleOpenApplication( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleQuitApplication( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleOpenDocuments( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandlePrintDocuments( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleFileAdded( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleFileRemoved( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleFileModified( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );pascal OSErr HandleASSubroutine( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon );void    DisplayChange( AEDesc* theDesc, short theChange );void    DisplayChangeDesc( AEDesc* theDesc, short theChange );void    AppendPStr( StringPtr sourceStr, StringPtr destStr );OSErr    GetDescriptorData( const AEDesc* theDesc, Ptr destPtr, Size maxSize );OSErr    FSSpecIsDirectory( FSSpec* theSpec, Boolean* theResult );OSErr    GetParentDirectoryName( FSSpec* theSpec, StringPtr theName );void    InitNotification( void );OSErr    Notify( Boolean fSound, short iconID, StringPtr message );OSErr    InstallNotification( Boolean fSound, short iconID, StringPtr message );OSErr    RemoveNotification( void );short    PositiveRandom( void );  // GlobalsStr255        gAddedSubroutineName;Str255        gRemovedSubroutineName;Str255        gModifiedSubroutineName;NMUPP        gMyNMProcPtr = NULL;Boolean        gRemoveNotification;MyNotificationPtr  gNotificationPtr;short        gNumberSounds;SndChannelPtr    gSoundChannel;#pragma segment InitializeOSErr InstallAppleEventHandlers ( void ){  short err;    InitNotification( );  gAddedSubroutineName[0] = 0;  gRemovedSubroutineName[0] = 0;  gModifiedSubroutineName[0] = 0;    err = AEInstallEventHandler ( kCoreEventClass, kAEOpenApplication,            NewAEEventHandlerProc( HandleOpenApplication ), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEQuitApplication,            NewAEEventHandlerProc( HandleQuitApplication ), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEOpenDocuments,            NewAEEventHandlerProc (HandleOpenDocuments ), 0L, false );  if (noErr != err) goto done;  err = AEInstallEventHandler ( kCoreEventClass, kAEPrintDocuments,            NewAEEventHandlerProc( HandlePrintDocuments ), 0L, false );  if (noErr != err) goto done;                        // Events from Folder Watcher FBA              err = AEInstallEventHandler ( kFolderWatcherSuite, kTypeFileAdded,            NewAEEventHandlerProc( HandleFileAdded ), 0L, false );  if (noErr != err) goto done;              err = AEInstallEventHandler ( kFolderWatcherSuite, kTypeFileRemoved,            NewAEEventHandlerProc( HandleFileRemoved ), 0L, false );  if (noErr != err) goto done;              err = AEInstallEventHandler ( kFolderWatcherSuite, kTypeFileModified,            NewAEEventHandlerProc( HandleFileModified ), 0L, false );  if (noErr != err) goto done;              // Events from Script Application  err = AEInstallEventHandler ( kASAppleScriptSuite, kASSubroutineEvent,            NewAEEventHandlerProc( HandleASSubroutine ), 0L, false );  if (noErr != err) goto done;done:      return err;}  // InstallAppleEventHandlers#pragma segment Corepascal OSErr HandleOpenApplication( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, reply, refcon )#endif  return noErr;}pascal OSErr HandleQuitApplication( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, reply, refcon )#endif  OSErr  err;  if ( gSoundChannel )  {    err = SndDisposeChannel( gSoundChannel, true );    gSoundChannel = NULL;  }  gQuit = true;  return noErr;}pascal OSErr HandleOpenDocuments( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, reply, refcon )#endif  return errAEEventNotHandled;}pascal OSErr HandlePrintDocuments( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused (theAppleEvent, reply, refcon )#endif  return errAEEventNotHandled;}pascal OSErr HandleFileAdded( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused ( reply, refcon )#endif  AEDesc    aDesc = { typeNull, NULL };  OSErr    err;    err = AEGetParamDesc( theAppleEvent, keyDirectObject, typeWildCard, &amp;aDesc );  if ( noErr != err) goto done;  DisplayChange( &amp;aDesc, kAddedStr );done:  AEDisposeDesc( &amp;aDesc );  return err;}pascal OSErr HandleFileRemoved( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused ( reply, refcon )#endif  AEDesc    aDesc = { typeNull, NULL };  OSErr    err;    err = AEGetParamDesc( theAppleEvent, keyDirectObject, typeWildCard, &amp;aDesc );  if ( noErr != err) goto done;  DisplayChange( &amp;aDesc, kRemovedStr );done:  AEDisposeDesc( &amp;aDesc );  return err;}pascal OSErr HandleFileModified( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused ( reply, refcon )#endif  AEDesc    aDesc = { typeNull, NULL };  OSErr    err;    err = AEGetParamDesc( theAppleEvent, keyDirectObject, typeWildCard, &amp;aDesc );  if ( noErr != err) goto done;  DisplayChange( &amp;aDesc, kModifiedStr );done:  AEDisposeDesc( &amp;aDesc );  return err;}// AppleScript will send this type of event if you structure your call like a subroutine.// This way you can accept the events without AppleScript checking out your terminology// through the 'aete' resource.pascal OSErr HandleASSubroutine( AppleEvent *theAppleEvent, AppleEvent *reply, long refcon ){#ifdef __MWERKS__  #pragma unused ( reply, refcon )#endif  Str255    subroutineStr;  DescType  typeCode;  Size    actualSize;  AEDesc    aDesc = { typeNull, NULL };  OSErr    err;      err = AEGetParamPtr( theAppleEvent, keyASSubroutineName, typeChar,                  &amp;typeCode, &amp;subroutineStr[1], 255, &amp;actualSize );  if ( noErr != err ) goto done;  subroutineStr[0] = actualSize;    err = AEGetParamDesc( theAppleEvent, keyDirectObject, typeWildCard, &amp;aDesc );  if ( noErr != err ) goto done;          // Check we've read the resources in  if ( ! gAddedSubroutineName[0] )    GetIndString( gAddedSubroutineName, SubroutineSTRs, kAddedSub );  if ( ! gRemovedSubroutineName[0] )    GetIndString( gRemovedSubroutineName, SubroutineSTRs, kRemovedSub );  if ( ! gModifiedSubroutineName[0] )    GetIndString( gModifiedSubroutineName, SubroutineSTRs, kModifiedSub );  if ( EqualString( subroutineStr, gAddedSubroutineName , false, false ))    DisplayChange( &amp;aDesc, kAddedStr );  else if ( EqualString( subroutineStr, gRemovedSubroutineName , false, false ))    DisplayChange( &amp;aDesc, kRemovedStr );  else if ( EqualString( subroutineStr, gModifiedSubroutineName , false, false ))    DisplayChange( &amp;aDesc, kModifiedStr );done:  AEDisposeDesc( &amp;aDesc );  return err;}// This routine takes care of listsvoid  DisplayChange( AEDesc* theDesc, short theChange ){  AEDesc    aDesc = { typeNull, NULL };  long    aCount,        anIndex;  AEKeyword  anAEKeyword;  OSErr    err;  switch ( theDesc-&gt;descriptorType )  {    case typeAEList:    // Handle lists      err = AECountItems( theDesc, &amp;aCount );      if ( noErr != err ) goto done;            for (anIndex = 1; anIndex &lt;= aCount; anIndex++ )      {        err = AEGetNthDesc( theDesc, anIndex, typeWildCard, &amp;anAEKeyword, &amp;aDesc );        if ( noErr != err ) goto done;                DisplayChange( &amp;aDesc, theChange );              (void)AEDisposeDesc( &amp;aDesc );      }      break;          default:      DisplayChangeDesc( theDesc, theChange );  }  done:  (void)AEDisposeDesc( &amp;aDesc );}// Add the change to our list and notify user of change.void  DisplayChangeDesc( AEDesc* theDesc, short theChange ){  Str255      displayStr,          tempStr;  AEDesc      anFSSpecDesc = { typeNull, NULL };  FSSpec      anFSSpec;  Boolean      fDirectory;  unsigned long  now;  OSErr      err;    err = AECoerceDesc( theDesc, typeFSS, &amp;anFSSpecDesc );  if ( noErr != err ) goto done;    err = GetDescriptorData( &amp;anFSSpecDesc, (Ptr)&amp;anFSSpec, sizeof( anFSSpec ) );  if ( noErr != err ) goto done;    err = FSSpecIsDirectory( &amp;anFSSpec, &amp;fDirectory);  if ( noErr != err ) goto done;  displayStr[0] = 0;  // Empty the string    if ( ! fDirectory )    // If it isn't a directory then add   {            // the directory name before it.    err = GetParentDirectoryName( &amp;anFSSpec, tempStr );    if ( noErr != err ) goto done;    AppendPStr( tempStr, displayStr );    AppendPStr( &quot;\p:&quot;, displayStr );  }    AppendPStr( anFSSpec.name, displayStr );  // Add the folder/file name  if ( fDirectory )    AppendPStr( &quot;\p:&quot;, displayStr );    // If a directory show by sticking colon after  GetIndString( tempStr, ChangeSTRs, theChange );  AppendPStr( &quot;\p\t&quot;, displayStr );      // Add a tab  AppendPStr( tempStr, displayStr );      // Add Added/Removed/Modified    GetDateTime( &amp;now );  TimeString( now, false, tempStr, NULL );  AppendPStr( &quot;\p\t&quot;, displayStr );      // Add a tab  AppendPStr( tempStr, displayStr );      // Add Time    DateString( now, abbrevDate, tempStr, NULL );  AppendPStr( &quot;\p\t&quot;, displayStr );      // Add a tab  AppendPStr( tempStr, displayStr );      // Add Date    AddToListContent( displayStr );    Notify( true, NotificationIcon, NULL );  done:  AEDisposeDesc( &amp;anFSSpecDesc );}// Just a pascal string concatenation routine.// Doesn't check for 255 character limit.void  AppendPStr( StringPtr sourceStr, StringPtr destStr ){  BlockMoveData( &amp;sourceStr[1], &amp;destStr[1] + destStr[0], sourceStr[0] );  destStr[0] += sourceStr[0];}// Get the data out of the data handle of the descriptor.OSErr  GetDescriptorData( const AEDesc* theDesc, Ptr destPtr, Size maxSize ){  Size  copySize;  OSErr  err = noErr;    if ( typeNull == theDesc-&gt;descriptorType || ! theDesc-&gt;dataHandle )    return( errAENotAEDesc );  copySize = GetHandleSize( (Handle)theDesc-&gt;dataHandle );  if ( copySize &lt;= maxSize )  {    HLock( (Handle)theDesc-&gt;dataHandle );    BlockMoveData( *theDesc-&gt;dataHandle, destPtr, copySize );    HUnlock( (Handle)theDesc-&gt;dataHandle );  }  else    err = errAECorruptData;    return err;} // GetDescriptorData// Check to see if FSSpec is for a directory.OSErr  FSSpecIsDirectory( FSSpec* theSpec, Boolean* theResult ){  CInfoPBRec     aPB;  OSErr       err;  aPB.dirInfo.ioNamePtr = theSpec-&gt;name;  aPB.dirInfo.ioVRefNum = theSpec-&gt;vRefNum;  aPB.dirInfo.ioDrDirID = theSpec-&gt;parID;  aPB.dirInfo.ioFDirIndex = 0;  // Use ioNamePtr and ioDirID  aPB.dirInfo.ioACUser = 0;    // Clear it before calling GetCatInfo  err = PBGetCatInfo( &amp;aPB, false );    if ( noErr == err )    *theResult = ( aPB.dirInfo.ioFlAttrib &amp; ioDirMask );  return err;}// Get parent directory name for an FSSpec.OSErr  GetParentDirectoryName( FSSpec* theSpec, StringPtr theName ){  CInfoPBRec     aPB;  OSErr       err;  aPB.dirInfo.ioNamePtr = theName;  aPB.dirInfo.ioVRefNum = theSpec-&gt;vRefNum;  aPB.dirInfo.ioDrDirID = theSpec-&gt;parID;  aPB.dirInfo.ioFDirIndex = -1;  // Get info about the directory  aPB.dirInfo.ioACUser = 0;  // Clear it before calling GetCatInfo  err = PBGetCatInfo( &amp;aPB, false );  return err;} // Call this once during application initializationvoid  InitNotification( void ){  OSErr  err;  gRemoveNotification = false;  GetDateTime( (unsigned long *)&amp;qd.randSeed );  gNumberSounds = Count1Resources( soundListRsrc );  gSoundChannel = NULL;  err = SndNewChannel( &amp;gSoundChannel, 0, 0, NULL );}// This routine checks whether or not the notification// is already displayed. If it isn't then it puts up// a notification.OSErr  Notify( Boolean fSound, short iconID, StringPtr message ){  Handle    sndHandle;  OSErr     err = noErr;    fSound = ( fSound &amp;&amp; ( gNumberSounds &gt; 0 ) );    if ( gRemoveNotification &amp;&amp; fSound)  {              // We'll still play the sounds because I like it.                // Note that this may drive the user crazy.    sndHandle = Get1IndResource( soundListRsrc, ( PositiveRandom( ) % gNumberSounds ) + 1 );    HNoPurge( sndHandle );    err = SndPlay( gSoundChannel, (SndListHandle)sndHandle, true );  }  else    err = InstallNotification( true, iconID, message );      return err;}OSErr  InstallNotification( Boolean fSound, short iconID, StringPtr message ){  Handle    anIconSuite;  Handle    ics8Handle,        ics4Handle,        icsBWHandle;  Handle    sndHandle;  OSErr     err;  gNotificationPtr = (MyNotificationPtr)NewPtrClear( sizeof( MyNotificationRecord ) );  err = MemError( );  if (noErr != err || ! gNotificationPtr ) goto done;  gNotificationPtr-&gt;notification.qType = nmType;  gNotificationPtr-&gt;notification.nmMark = 1;    // Put a mark next to our application                          // in the application menu.  if ( iconID )  {    err = NewIconSuite(&amp;anIconSuite);    if (noErr != err ) goto done;        ics8Handle = Get1Resource( kSmall8BitData, NotificationIcon );    HNoPurge( ics8Handle );    err = AddIconToSuite( ics8Handle, anIconSuite, kSmall8BitData );    if (noErr != err ) goto done;      ics4Handle = Get1Resource( kSmall4BitData, NotificationIcon );    HNoPurge( ics4Handle );    err = AddIconToSuite( ics4Handle, anIconSuite, kSmall4BitData );    if (noErr != err ) goto done;      icsBWHandle = Get1Resource( kSmall1BitMask, NotificationIcon );    HNoPurge( icsBWHandle );    err = AddIconToSuite( icsBWHandle, anIconSuite, kSmall1BitMask );    if (noErr != err ) goto done;      gNotificationPtr-&gt;notification.nmIcon = anIconSuite;  }  else    gNotificationPtr-&gt;notification.nmIcon = NULL;    // handle to sound record  if ( fSound )  {    sndHandle = Get1IndResource( soundListRsrc, ( PositiveRandom( ) % gNumberSounds ) + 1 );    HNoPurge( sndHandle );    gNotificationPtr-&gt;notification.nmSound = sndHandle;  }  else    gNotificationPtr-&gt;notification.nmSound = NULL;    // string to appear in alert  if ( message )  // Send NULL StringPtr if no alert wanted  {    BlockMoveData( message, gNotificationPtr-&gt;notificationString, message[0] + 1 );    gNotificationPtr-&gt;notification.nmStr = gNotificationPtr-&gt;notificationString;  }  else    gNotificationPtr-&gt;notification.nmStr = NULL;        // pointer to response routine  gNotificationPtr-&gt;notification.nmResp = NULL;  // gMyNMProcPtr;  gNotificationPtr-&gt;notification.nmRefCon = 0;  // SetCurrentA5( );  // Copy current A5  err = NMInstall( (NMRecPtr)gNotificationPtr );  if ( noErr == err )    gRemoveNotification = true;done:  if ( noErr != err )    // If there was an error then clean up the memory  {    if ( gNotificationPtr-&gt;notification.nmIcon )      err = DisposeIconSuite( gNotificationPtr-&gt;notification.nmIcon, false );        DisposePtr( (Ptr)gNotificationPtr );    gNotificationPtr = NULL;  }  return err;}// If there is a notification running then this routine removes it// and disposes of the associated memory. OSErr  RemoveNotification( void ){  OSErr   err = noErr;    if ( gRemoveNotification )  {    err = NMRemove( (NMRecPtr)gNotificationPtr );    if ( gNotificationPtr-&gt;notification.nmIcon )      err = DisposeIconSuite( gNotificationPtr-&gt;notification.nmIcon, false );    DisposePtr( (Ptr)gNotificationPtr );    gNotificationPtr = NULL;        gRemoveNotification = false;    // Reset the flag  }  return err;} // RemoveNotificationshort  PositiveRandom( void ){  short  aRandom = Random( );    if ( aRandom &gt;= 0 )    return aRandom;  else    return aRandom * -1;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Folder_Watching/listing9.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Folder_Watching/listing9.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Folder_Watching/listing9.html%3Fid%3DDTS10000667-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>