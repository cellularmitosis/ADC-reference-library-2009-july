<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html><head>
<!-- BEGIN META TAG INFO -->
<link rel="home" href="http://developer.apple.com/">
<link rel="find" href="http://developer.apple.com/search/">
<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
<script language="JavaScript" type="text/javascript" src="../../documentation/js/busnav.js"></script>
<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<!-- END META TAG INFO -->
<!-- BEGIN TITLE -->
<title>Technical Note TN2139: Debugging Dashboard Widgets</title>
<!-- END TITLE -->
</head>
<!-- BEGIN BODY OPEN -->
<body bgcolor="#ffffff"><a name="//apple_ref/doc/uid/DTS10003525" title="Debugging Dashboard Widgets"></a>
<!--END BODY OPEN -->
<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->
<a name="top"></a>
<!-- BEGIN LOGO AND SEARCH -->
<!--#include virtual="/includes/adcnavbar"-->
<!-- END LOGO AND SEARCH -->
<!-- START BREADCRUMB -->
<div id="breadcrumb"><table width="680" border="0" cellpadding="0" cellspacing="0"><tr>
<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
<td><img width="340" height="10" src="images/1dot.gif" alt=""></td></tr><tr valign="middle"><td align="left" colspan="2">
<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/AppleApplications/index.html">Apple Applications</a> &gt; <a href="../../technicalnotes/AppleApplications/idxDashboard-date.html">Dashboard</a> &gt; 
</td></tr><tr><td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td></tr></table></div>
<!-- END BREADCRUMB -->

<!-- START MAIN CONTENT -->
<!-- START TITLE GRAPHIC AND INTRO-->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top">
<td><h1>
<div id="pagehead">Technical Note TN2139</div>
<div id="pageheadsub">Debugging Dashboard Widgets</div>
</h1></td></tr></table>
<!-- END TITLE GRAPHIC AND INTRO -->
<!-- BEGIN WIDE COLUMN -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td align="left" width="680">
<!-- BEGIN CONTENTS -->
<table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td><p>This Technical Note covers common problems and errors encountered during the development of a Dashboard widget, along with techniques for discovering and preventing such problems.  It is targeted at developers working with Dashboard on Mac OS X Tiger.</p></td></tr><tr><td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><table width="680" border="0" cellpadding="0" cellspacing="0"><tr align="left" valign="top"><td width="680"><ul><li><a href="#TNTAG1">Introduction</a></li><li><a href="#TNTAG2">Developing in Safari</a></li><li><a href="#TNTAG3">Printing Debug Information</a></li><li><a href="#TNTAG13">Activating Development Mode</a></li><li><a href="#TNTAG4">Widgets That Don't Launch</a><ul><li><a href="#TNTAG21">Dashboard Never Appears</a></li><li><a href="#TNTAG22">Default Image, No Content</a></li><li><a href="#TNTAG23">Kicked out of the (Widget) Bar</a></li></ul></li><li><a href="#TNTAG25">Failure of Specific Features</a><ul><li><a href="#TNTAG28">Web Content: Networking, Embeds, File I/O, and Java</a></li><li><a href="#TNTAG26">Widget Preferences</a></li></ul></li><li><a href="#TNTAG5">Widget Plug-ins</a><ul><li><a href="#TNTAG8">Where's my Plug-in?</a></li><li><a href="#TNTAG11">Calling a Plug-in</a></li><li><a href="#TNTAG12">Crashing Plug-ins</a><ul><li><a href="#TNTAG14">Attaching gdb to a Plug-in </a><li><a href="#TNTAG15">Catching a Crash on Startup</a></li></ul></li></ul></li><li><a href="#TNT_HISTORY_TAG">Document Revision History</a></li></ul></td></tr><tr><td colspan="3" scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br><img height="1" width="680" src="images/1dot_919699.gif" alt=""><br><img width="680" height="20" src="images/1dot.gif" alt=""></td></tr></table><A NAME="TNTAG1"></A><H2>Introduction</H2><p>Dashboard widgets are not difficult to create, but they can be challenging to work with once something goes wrong.  Developers used to working with languages like Objective-C or Java may be used to more control and feedback during the development process than what is provided from the web-based technologies used to create a widget.  This Technical Note discusses effective methods to obtain such control and feedback, hopefully making better use of your development time.</p><p>This Technical Note is meant to be a supplement to the <A HREF="../../documentation/AppleApplications/Conceptual/Dashboard_Tutorial/">Dashboard Programming Guide</A>.  Developers interested in learning how to create a Dashboard widget should first read that document; the basics of widget development are not covered here.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG2"></A><H2>Developing in Safari</H2><p>One of the most important things to keep in mind when developing a widget is the fact that it is, in many ways, just a web page.  Dashboard widgets use the same Web Kit rendering engine as Safari, so you can do almost all of your development inside Safari and not be concerned with bundling, property lists, default images and icons, all of which add their own complexity (these are discussed later).</p><p>If you've already bundled your widget, simply Control-click on the <code>.wdgt</code> bundle and select Show Package Contents to view all your content from the Finder.  You then open your main HTML file in Safari to view its content without the additional variables of the Dashboard runtime.</p><p>Testing your content in Safari is particularly essential in the area of JavaScript errors.  Dashboard will report JavaScript errors to the Console application, but it is difficult to block execution from inside a widget in order to narrow down the source of an error.  Working in Safari will also help you isolate calls to the <code>widget</code> object and force the good habit of wrapping such calls with <code>if (window.widget)</code> checks.</p><p>The first important step for debugging in Safari is enabling the Debug menu.  This is accomplished by typing the Terminal command shown in Listing 1:</p><p class="smalltext"><strong>Listing 1:</strong> Enabling the Debug Menu in Safari.</p><pre class="sourcecodebox">
l337_d3v$ defaults write com.apple.Safari IncludeDebugMenu 1
</pre><p>The next time you launch Safari, you should see the Debug menu to the right of the Help menu.  Be sure to select the Log JavaScript Exceptions item, to get as much feedback as possible.  A new feature in Mac OS X v10.4 is the JavaScript Console, which can also be enabled from the Debug menu.  Once the JavaScript console is active, you're ready to work.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG3"></A><H2>Printing Debug Information</H2><p>The most basic and universal debugging aid in JavaScript programming is the <code>alert</code> statement. It takes a single argument (usually a string) and displays it in a modal dialog.  The blocking nature of the dialog can be used to make &quot;breakpoints&quot; in your JavaScript in order to narrow down exactly when during execution a given error appears in Safari's JavaScript Console.</p><p>While the <code>alert</code> function's modal behavior can be a blessing, it can also be a curse.  It doesn't take long to build up a large number of <code>alert</code> statements, and before you know it, you're clicking 30 times whenever you refresh your content.  This can become cumbersome, and may create a functional problem for code that is running in a <code>setInterval</code> timer.  That code may be depending on a certain amount of time to elapse, but if you're busy closing dialogs, the page will take much longer than usual to load and the time elapsed before a single iteration of the timer even got around to executing.</p><p>When running in Dashboard, <code>alert</code> statements are simply printed to the Console, avoiding any of these issues.  To get the best of both worlds, create a debug element in your web page appending your debug information to it when in Safari.  This debug element allows you to make logging statements that are much less intrusive than modal alerts.</p><p>Declaring a debug element is as simple as inserting a <code>div</code> tag anywhere in your page and providing CSS properties to position it.  Listing 1 demonstrates the insertion of a debug <code>div</code> into a webpage.  JavaScript methods to show, hide and print to the <code>div</code> are also defined.</p><p class="smalltext"><strong>Listing 2:</strong> Inserting a debug div into existing content</p><pre class="sourcecodebox">&lt;html&gt;
     &lt;head&gt;
     &lt;style type=&quot;text/css&quot;&gt;
          #debugDiv {
               border-style: dotted;
               border-color: black;
               background: gray;
               position: absolute;
               bottom: 0px;
               left: 0px;
               height: 200px;
               width: 90%;
               overflow: scroll;
               display:none;
          }
     &lt;/style&gt;
     &lt;script language=&quot;JavaScript&quot; type=&quot;text/javascript&quot;&gt;
          var debugMode = false;

          // Write to the debug div when in Safari.
          // Send a simple alert to Console when in Dashboard.
          function DEBUG(str) {
               if (debugMode) {
                    if (window.widget) {
                         alert(str);
                    } else {
                         var debugDiv = document.getElementById('debugDiv');
                         debugDiv.appendChild(document.createTextNode(str));
                         debugDiv.appendChild(document.createElement(&quot;br&quot;));
                         debugDiv.scrollTop = debugDiv.scrollHeight;
                    }
               }
          }

          // Toggle the debugMode flag, but only show the debugDiv in Safari
          function toggleDebug() {
               debugMode = !debugMode;
               if (debugMode == true &amp;&amp; !window.widget) {
                    document.getElementById('debugDiv').style.display = 'block';
               } else {
                    document.getElementById('debugDiv').style.display = 'none';
               }
          }
     &lt;/script&gt;
     &lt;/head&gt;

     &lt;body onload='toggleDebug();DEBUG(&quot;loaded!&quot;);'&gt;

          &lt;!-- All our existing content... --&gt;
          Hello World!
          &lt;!-- Declare the debug div anywhere.  CSS handles the positioning --&gt;
          &lt;div id='debugDiv'&gt;&lt;/div&gt;

     &lt;/body&gt;
&lt;/html&gt;
</pre><p>Figure 1 demonstrates what the above page looks like in Safari.  Note the &quot;loaded!&quot; string that is passed to <code>DEBUG</code> appears in the <code>div</code> at the bottom.</p><p class="caption"><strong>Figure 1:</strong> A simple web page with a debug/log div.</p><p><img  src="images/tn2139_debugDiv.png" width="538" height="377" alt="Figure 1, A simple web page with a debug/log div."></p><p>An alternate technique is to create a new window using <code>window.open</code>, and write your logging statements directly to that window's <code>document</code> object. This would not require any CSS or HTML declarations, but it would require popup blocking to be turned off in Safari.</p><p>This document does not discuss the basics of JavaScript debugging.  A great article about the basics of JavaScript debugging can be found at <A HREF="http://javascript.internet.com/debug-guide.html">The JavaScript Source</A>.  The article is dated and does not cover some of the newer features of JavaScript and DHTML, but much of the information and common caveats are still applicable.  In particular, the <code>debugDiv</code> demonstrated above can replaces <code>document.write</code> and <code>alert</code> calls used in the article. The JavaScript Console in Safari plays the role of the &quot;warning box.&quot;</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG13"></A><H2>Activating Development Mode</H2><p>When the time comes to test your widget in bundled form, it can be quite cumbersome to repeatedly show and hide the Dashboard to switch between your widget and other Desktop apps, such as Console, or the editor you're using to make changes.  To minimize the number of times you show and hide Dashboard, you can place Dashboard in Development Mode.  This allows you to keep a widget on screen at all times \x97 even when Dashboard is not shown.  To enable Development Mode:</p><ul><li><p>Type the following in Terminal: <code>defaults write com.apple.dashboard devmode YES</code></p></li><li><p>Logout/login (or restart) to reload Dashboard with the new setting</p></li><li><p>Load your widget into Dashboard</p></li><li><p>Drag your widget a short distance; do <strong>not</strong> release the mouse</p></li><li><p>With the mouse still held down, hide Dashboard; your widget should now be hovering over the desktop</p></li></ul><p>Viewing output, making changes, and reloading will be a much smoother process with your widget permanently visible.</p><div class="notebox"><p><strong>Note:</strong> To reload a widget, make sure it is focused and press Command-R on your keyboard.  You should see a &quot;swirl&quot; animation, indicating that the widget's content has been reloaded.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG4"></A><H2>Widgets That Don't Launch</H2><p>So you've dropped all your content into a <code><code>.wdgt</code></code> bundle and are ready to start testing in Dashboard.  You pull your widget from the Widget Bar or double-click your bundle in the Finder and nothing happens.  Either the widget doesn't show up or it shows up for a split second and vanishes.  There are a number of potential reasons for this, categorized below by the accompanying symptoms.</p><A NAME="TNTAG21"></A><H3>Dashboard Never Appears</H3><p>Double-clicking a functional widget from the Finder should result in the Dashboard being shown and the widget being loaded.  If you double-click your widget and the Dashboard never shows itself, your bundle is probably missing one of the following items:</p><ul><li><p><strong>Default image</strong>.  The top level of your widget bundle must contain an image file in PNG format named <code>Default.png</code>.  This image is displayed while Dashboard loads your regular content.  If this file is missing, malformed, or misnamed, the widget will not load.  To ensure the image is in the correct format, open it with Preview and select Get Info from the Tools menu.  If the info window does not report a Document type of &quot;Portable Network Graphics Image&quot; it is most likely not a valid Default image.</p></li><li><p><strong><code>Info.plist</code> file</strong>.  Perhaps you forgot to include an <code>Info.plist</code> file at the top level of your widget bundle.  The Dashboard Programming Guide covers all the required keys, but the most important are covered below.</p></li><li><p><strong>CFBundleIdentifier key</strong>.  A unique <code>CFBundleIdentifier</code> value in your <code>Info.plist</code> is essential to any application on Mac OS X; Dashboard widgets are no exception. Widgets do not load without this key defined.</p></li><li><p><strong>MainHTML key</strong>.  The <code>MainHTML</code> key defines what content is loaded by the widget.  If the key is not present, the widget is not loaded.  Remember that the value of this key is case-sensitive.  Make sure the value matches the filename exactly.</p></li></ul><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG22"></A><H3>Default Image, No Content</H3><p>If your widget successfully displays in Dashboard, you should see its default image on the screen while the main content loads.  If the default image vanishes and nothing replaces it, it most likely means your <code>MainHTML</code> key does not match the actual HTML filename in the top level of your widget bundle.</p><div class="notebox"><p><strong>Note:</strong> If this happens to you, it may be difficult to close the widget.  The easiest thing to do in this case is to show the Widget Bar; this reveals the closeboxes for every widget on screen.</p></div><p>Content that shows itself but is not responsive likely threw a error in JavaScript code stemming from the <code>onload</code> handler.  Check the Console for errors.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG23"></A><H3>Kicked out of the (Widget) Bar</H3><p>In order for your widget to appear in the Widget Bar, it must be placed in either <code>/Library/Widgets</code> or <code>~/Library/Widgets</code>.  Widgets without an <code>Icon.png</code> image file at the top level of the widget bundle will appear in the Widget Bar but with a generic icon.</p><p>Widgets added to one of the two installation directories should appear the next time you show Dashboard.  If yours does not, cycle through all the lists in the Widget Bar in case it is just off-screen.  The Widget Bar is organized alphabetically based on each widget's localized <code>CFBundleDisplayName</code>.</p><div class="notebox"><p><strong>Note:</strong> Like the rest of Mac OS X, the Widget Bar gives precedence to filenames that do not match the localized <code>CFBundleDisplayName</code>.  If your widget bundle is renamed in the Finder, or <code>CFBundleDisplayName</code> is not defined, the filename is shown.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG25"></A><H2>Failure of Specific Features</H2><A NAME="TNTAG28"></A><H3>Web Content: Networking, Embeds, File I/O, and Java</H3><p>As described in the Security section of the Dashboard Programming Guide, certain web content features require special <code>Info.plist</code> keys to function in a Dashboard widget.  These features include:</p><ul><li><p>Network Access: document location changes, hypertext links XMLHttpRequest objects, any other items that reach across the network</p></li><li><p>Internet Plug-Ins: Web (not widget) plug-ins via the EMBED tag (to display QuickTime content, for example)</p></li><li><p>File Access: Attempts to touch the filesystem outside of the <code>.wdgt</code> bundle, via absolute or relative paths</p></li><li><p>Java Applets: Using the APPLET tag to embed Java content</p></li></ul><p>If content falling under any of these categories is in your widget without the appropriate <code>Info.plist</code> key, the content will not be evaluated or rendered.  See the Security section of the Dashboard Programming Guide for more information on the restrictions applied to Dashboard widgets.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG26"></A><H3>Widget Preferences</H3><p>A common mistake when writing out widget preferences is a reversal of the required parameters.  The <code>widget.setPreferenceForKey</code> function is defined with a Cocoa-style parameter ordering: parameters are passed in the order the function names them.  When calling this function, be sure that you pass the preference value first and the key second.  If you're more familiar with Java or JavaScript APIs, you may be expecting to pass the key first, which will persist the information backwards.  Subsequent calls to <code>widget.preferenceForKey</code> will then likely return null, since the preference was not actually stored correctly.</p><p>It is also important to persist both preference values and keys as Strings.  Primitive values or objects may not be persisted into preferences successfully; attempting to do so will typically yield an error in Console resembling Listing 3.</p><p class="smalltext"><strong>Listing 3:</strong> Typical widget preferences write error.</p><pre class="sourcecodebox">
DashboardClient[869] CFLog (15): Could not generate XML data for property list
</pre><p>It is worth mentioning that widget preferences are also a mechanism for saving widget state.  Remember that at any time, the user may log out or restart the computer, at which point your widget's process will be terminated.  If you wish to have any transient state restored when the user logs back in and shows Dashboard again, that state needs to be written out as widget preferences as soon as it changes, and fetched when the widget instance is reloaded.</p><div class="notebox"><p><strong>Note:</strong> Killing a <code>DashboardClient</code> process is not the same as widget removal - the user action which triggers the <code>onremove</code> event handler.  Widget removal is only triggered by the user clicking on the closebox.  Any widget instance whose <code>DashboardClient</code> process was killed will be reloaded the next time the current user logs in.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG5"></A><H2>Widget Plug-ins</H2><p>The concept behind a widget plug-in is simple: providing JavaScript access to native code and APIs.  This section covers common problems when developing a plug-in, how to recognize them, and how to solve and prevent them.  The basics to developing a widget plug-in are covered in the Dashboard Programming Guide, and are not discussed here.</p><A NAME="TNTAG8"></A><H3>Where's my Plug-in?</H3><p>The most common problem with widget plug-ins is that they just don't show up.  This problem is usually accompanied by an error in the Console like the one in Listing 3.</p><p class="smalltext"><strong>Listing 4:</strong> Typical error due to a missing widget plug-in.</p><pre class="sourcecodebox">
DashboardClient[123] (com.mycompany.MyWidget) undefined: Can't find variable:MyWidgetPlugin (line: 0)
</pre><p>This is actually a generic &quot;undefined variable&quot; error from JavaScript; what's unique about it is that the variable in question is the name of your widget plug-in.  This error is seen every time your JavaScript code attempts to reference the plug-in and is an indication that the widget does not recognize this variable as your plug-in.  This usually happens for one of the following reasons:</p><ul><li><p><strong>The plug-in is missing or misnamed</strong>.  Widget plug-ins should be at the top-level of the widget bundle with a <code>.widgetplugin</code> filename extension and a filename matching the <code>Plugin</code> entry in your widget's <code>Info.plist</code> file.  The value of the <code>Plugin</code> key must also include the <code>.widgetplugin</code> extension.  If any of these requirements are not met, the plug-in is not loaded.</p><p>After adding the <code>Plugin</code> key to your <code>Info.plist</code>, launching the widget should bring up a confirmation dialog before loading all of the content.  This is a good way of confirming that the <code>DashboardClient</code> at least recognizes your <code>Plugin</code> key.  It does not, however, guarantee that the plug-in is present or loaded.</p></li><li><p><strong>A correct implementation of initWithWebView is missing</strong>.  The <code>initWithWebView:</code> method is a critical piece of code in your widget plug-in.  If it is missing, the signature is incorrect, or it produces an error, your plug-in fails to load, usually throwing a <code>selector not recognized</code> error in Console.</p></li><li><p><strong>The JavaScript name does not match the native name</strong>.  In your plug-in's <code>windowScriptObjectAvailable:</code> method, you must register a key/name with the <code>WebScriptObject</code> that was passed.  This name must match the variable name you are using on the JavaScript side; if it does not, JavaScript does not know to treat the variable as a widget plug-in.</p></li><li><p><strong>The bundle internals are mismatched</strong>.  Many developers tend to rename targets in Xcode from time to time.  If you rename your widget plug-in's Xcode target, or any of its products, view the Info window for the target and make sure the <strong>Product Name</strong> property under the Build tab matches the <strong>Executable</strong> field under the Properties tab.  In the built product, this ensures that the name of the compiled binary in your plug-in's Contents/MacOS folder matches the <code>CFBundleExecutable</code> value in your plug-in's (not your widget's) <code>Info.plist</code> file.  If these names do not match, the plug-in's binary is not located and the plug-in does not load.  Figure 2 shows the relevant settings in Xcode.</p></li></ul><p class="caption"><strong>Figure 2:</strong> Product Name and Executable properties in Xcode target settings.</p><p><img  src="images/tn2139_XcodeShots.png" width="480" height="318" alt="Figure 2, Product Name and Executable properties in Xcode target settings."></p><p>The easiest way to ensure your plug-in is actually loaded (as opposed to your <code>Plugin</code> key being recognized) is to include an <code>NSLog</code> statement in your <code>initWithWebView:</code> method, as shown in Listing 4:</p><p class="smalltext"><strong>Listing 5:</strong> Reporting the loading of a widget plug-in.</p><pre class="sourcecodebox">
- (id) initWithWebView:(WebView*)webview {
     NSLog(@&quot;I'm in!&quot;);
     // initialize...
     return self;
}
</pre><div class="notebox"><p><strong>Note:</strong> Remember to comment out or remove <code>NSLog</code> statements from your plugin when deploying your widget.  In a production scenario, log statements should be reserved for errors and exceptions.</p></div><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG11"></A><H3>Calling a Plug-in</H3><p>A widget plug-in's methods are exposed to JavaScript as soon as you bind it to the <code>WebScriptObject</code> that was passed to <code>windowScriptObjectAvailable:</code>.  However, you can choose to provide custom JavaScript signatures for any of your plug-in's methods via the <code>webScriptNameForSelector:</code> method.  If you choose to do this, take extra care to make sure the signature registered here matches the calls you are making from JavaScript.</p><p>It is also important to make sure you have not defined methods you are trying to call or members you are trying to reference inside the <code>isSelectorExcludedFromWebScript:</code> or <code>isKeyExcludedFromWebScript:</code> methods.  These methods, as their names imply, bar access to the specified selectors/keys from JavaScript.</p><p>Calls to a plug-in method blocked by either of these mechanisms results in a Console error resembling that shown in Listing 5.</p><p class="smalltext"><strong>Listing 6:</strong> Typical method-not-found error from JavaScript..</p><pre class="sourcecodebox">
Value undefined (result of expression MyPlugin.MyMethod) is not object. (line: 10)
</pre><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG12"></A><H3>Crashing Plug-ins</H3><p>Depending on the complexity of your plug-in, it may end up crashing or hanging during the course of development and use.  If the crash is indeed in your code, this should become evident when viewing a crash log from the <code>DashboardClient</code> process that loaded your widget.  However, the crash log may only tell you so much.  If the methods in question are large, it may not be immediately evident what code is crashing, so further isolation is necessary. This is where gdb comes in.</p><p>This document only discusses how to best use gdb with a widget plug-in.  To learn about general use of gdb, see <A HREF="../tn/tn2032.html">Getting Started With gdb</A> or <A HREF="../../documentation/DeveloperTools/gdb/gdb/gdb_toc.html">Debugging With gdb</A>.</p><A NAME="TNTAG14"></A><H4>Attaching gdb to a Plug-in </H4><p>In order to attach to your widget, you need the process ID of the <code>DashboardClient</code> tied to it.  This can be found using Activity Monitor.  As Figure 3 demonstrates, the process behind your widget can be identified in Activity Monitor by your widget's <code>CFBundleName</code>.  From here, you can acquire the pid and attach to your widget's <code>DashboardClient</code> from gdb, set breakpoints, and catch crashes.</p><p class="caption"><strong>Figure 3:</strong> Dashboard widgets inside Activity Monitor.</p><p><img  src="images/tn2139_activityMonitor.png" width="545" height="480" alt="Figure 3, Dashboard widgets inside Activity Monitor."></p><p>Also note that an <code>NSLog</code> statement contains the pid of your widget's <code>DashboardClient</code> process.  Therefore, if you are already making log statements in your plug-in, looking in Activity Monitor is not necessary.  Again, remember to remove any unnecessary log statements before shipping your widget.</p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNTAG15"></A><H4>Catching a Crash on Startup</H4><p>If your plug-in crashes as soon as it is loaded, the <code>DashboardClient</code> process does not stay up long enough for you to get the pid and attach.  Since it is not possible to load a widget from gdb, you need a way to catch the <code>DashboardClient</code> between the time it launches and the time it crashes.  The simplest way to do this is to insert a loop into your plug-in as early as possible.  The best place is inside <code>initWithWebView:</code>, the first message your plug-in receives.  Listing 6 demonstrates what this might look like.</p><p class="smalltext"><strong>Listing 7:</strong> Using a loop to stop a widget plug-in.</p><pre class="sourcecodebox">
-(id)initWithWebView: (WebView*) w {
     NSLog(@&quot;initWithWebView&quot;);

     // spin before doing anything serious
     // this will buy us time to attach with gdb
     int spin = 1;
     while (spin == 1) {
          usleep(1000);
     }

     self = [super init];
     return self;
}
</pre><p>This should hang your widget up and allow you to attach with gdb before a crash occurs.  You get the pid from the <code>NSLog</code> statement in Console.</p><p>Once you've obtained the pid, you can attach to the process and change your loop condition, allowing execution to continue as expected.  Figure 4 shows a simple example of this.</p><p class="caption"><strong>Figure 4:</strong> Breaking a spin loop from gdb.</p><p><img  src="images/tn2139_gdbSpin.png" width="581" height="336" alt="Figure 4, Breaking a spin loop from gdb."></p><p><a href="#top">Back to Top</a>&nbsp;<a href="#top"><img src="images/arrow_linkup.gif" height="7" width="10" border="0" alt=""></a></p><A NAME="TNT_HISTORY_TAG"></A><H2>Document Revision History</H2><table cellspacing="0" class="graybox" width="680"><tr><th width="100">Date</th><th width="580">Notes</th></tr><tr><td scope="row">2005-09-07</td><td>Added clarification on Default images.</td></tr><tr><td scope="row">2005-05-02</td><td>Dashboard widget troubleshooting techniques, from start to finish.</td></tr></table><p><b>Posted:</b> 2005-09-07</p>
<!-- END CONTENTS -->
</td></tr></table>
<!-- END WIDE COLUMN -->
<!-- END MAIN CONTENT -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn2005/tn2139.html%3Fid%3DDTS10003525-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn2005/tn2139.html%3Fid%3DDTS10003525-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn2005/tn2139.html%3Fid%3DDTS10003525-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

<!-- START BOTTOM APPLE NAVIGATION -->
<!--#include virtual="/includes/footer"-->
<!-- END BOTTOM APPLE NAVIGATION -->
<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->
</body></html>