<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>QuickTime Kit Programming Guide: Extending the QTKitPlayer Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Extending the QTKitPlayer Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001245-CH209" title="Extending the QTKitPlayer Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../../Cocoa-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000495" target="_top">Cocoa</a> &gt; <a href="../Chapter01/Introduction.html#//apple_ref/doc/uid/TP40001245-CH202-TPXREF101">QuickTime Kit Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Chapter03/03BuildingQTKItSimpleApp.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Chapter05/AddingToQTKitPlayer.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40001245-CH209-TPXREF101" title="Extending the QTKitPlayer Application"></a><h1>Extending the QTKitPlayer Application</h1><p>If you’ve built the simple QTKitPlayer application described in the previous chapter, you are now ready to extend its functionality by following the steps outlined in this chapter. If you skipped the previous chapter, you may want to familiarize yourself with the section <span class="content_text"><a href="../Chapter03/03BuildingQTKItSimpleApp.html#//apple_ref/doc/uid/TP40001245-CH204-BCIFHFIF">“Working With the QTKit Palette,”</a></span> which introduces the new Cocoa-QTKit palette available in the QuickTime Kit framework. This chapter assumes that, at very least, you have:</p><ul class="ul"><li class="li"><p>A basic knowledge of Cocoa development as well as the fundamentals of the Objective-C programming language</p></li><li class="li"><p>An understanding of Xcode, Interface Builder, and the QTKit palette </p></li></ul><p>When completed, your extended QTKitKPlayer application will allow you not only to open and play QuickTime movies, but also to import and export them, as shown in <span class="content_text">Figure 3-1</span>. </p><p>This added capability means that your application will be able to import and display a wide range of media types that QuickTime understands and supports in Mac OS X, including but not restricted to MP4 clips, JPEG images, and audio files, as you can see in the illustration in <span class="content_text"><a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-BBCBBIFD">Figure 3-2</a></span>. In so doing, your application moves beyond a simple media player and provides useful functionality for handling a variety of media types and playback tasks. </p><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCDDAJA" title="Figure 3-1The completed QTKitPlayer application with extended import and export capabilities"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>The completed QTKitPlayer application with extended import and export capabilities</p><img src = "../Art/qtkit_file_import.jpg" alt = "The completed QTKitPlayer application with extended import and export capabilities" ></div><br/><p>You’ll be able to accomplish all of this by working with Interface Builder to construct the QTKitPlayer user interface and then adding several hundred lines of code to your Xcode project.</p><p>Note that the QTKitPlayer application runs in both Mac OS X v10.4 and Mac OS X v10.3. You need QuickTime Player 7 (the latest version) installed on your system, however, to take full advantage of the new QuickTime Kit framework capabilities. </p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40001245-CH209-DontLinkElementID_3" title="Important:"></a><p><strong>Important:</strong>&nbsp;The complete source code for the extended QTKitPlayer application is available for Mac OS X v10.4 in the folder Developer > Examples > QuickTime > QTKit > QTKitPlayer. You may find it useful to build and compile the QTKitPlayer project in Xcode after you have worked through the steps in this programming guide. The QuickTime Kit Reference, which documents all the classes and methods in the QTKit framework, is also available in Developer > Examples > QuickTime > QTKit > QTKitObjC.pdf. The reference document is periodically updated at <span class="content_text"><a href="http://developer.apple.com/referencelibrary/QuickTime/index.html" target="_top">http://developer.apple.com/referencelibrary/QuickTime/index.html</a></span> as new methods and classes are added. </p><p></p></div><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCBBIFD" title="Figure 3-2The completed QTKitPlayer application with an MP4 movie, an MP3 audio clip, and a JPEG still image displayed"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong>The completed QTKitPlayer application with an MP4 movie, an MP3 audio clip, and a JPEG still image displayed</p><img src = "../Art/qtkit_import_types.jpg" alt = "The completed QTKitPlayer application with an MP4 movie, an MP3 audio clip, and a JPEG still image displayed" ></div><br/><p>Beyond importing and exporting of QuickTime-supported media types, your completed QTKitPlayer application will also include editing capabilities more extensive than just cut, copy, and paste. You’ll add editing features such as add, add scaled, replace, and trim, all of which are supported by the QTKit framework in Mac OSX 10.4. These features will enable you to edit QuickTime movies with greater control and precision, as described in <span class="content_text">Table 3-1</span>. If you look at the illustration shown in <span class="content_text">Figure 3-3</span>, you’ll see the Edit menu in the QTKitPlayer with the additional commands available.</p><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHHIED" title="Table 3-1Edit commands added to the QTKitPlayer application"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 3-1&nbsp;&nbsp;</strong>Edit commands added to the QTKitPlayer application</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Edit Command</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p>Add</p></td><td ><p>Adds a new chunk to a movie in one or more new tracks––on top of what’s already there––instead of inserting it as the Paste command does.</p></td></tr><tr><td  scope="row"><p>Add Scaled</p></td><td ><p>Scales the chunk being pasted in time, and the chunk becomes stretched or compressed so that it plays for the same duration as the current selection in the receiving movie, which can result in slow-motion or fast-motion effects.</p></td></tr><tr><td  scope="row"><p>Replace</p></td><td ><p>Replaces the current selection in the receiving movie. If there is no current selection, the command will replace the entire movie.</p></td></tr><tr><td  scope="row"><p>Trim</p></td><td ><p>Deletes everything in the current movie except the current selection.</p></td></tr></table></div><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCIFBHE" title="Figure 3-3The added editing capabilities in your QTKitPlayer project"></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>The added editing capabilities in your QTKitPlayer project</p><img src = "../Art/qtkit_edit_options.jpg" alt = "The added editing capabilities in your QTKitPlayer project" ></div><br/><p>Following the steps in this chapter, you’ll also be able to provide more extensive control of movie playback and display, as shown in the Movie menu commands (<span class="content_text">Figure 3-4</span>), including looping and cloning of your QuickTime movies. </p><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCDIDBI" title="Figure 3-4The Movie menu commands for movie control and playback"></a><p><strong>Figure 3-4&nbsp;&nbsp;</strong>The Movie menu commands for movie control and playback</p><img src = "../Art/qtkit_movie_options.jpg" alt = "The Movie menu commands for movie control and playback" ></div><br/>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-TPXREF135">Creating the Extended QTKitPlayer Project</a>
				
			<br/>
			
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-SW7">Adding Code to the MovieDocument Class Interface</a>
				
			<br/>
			
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-SW8">Adding Code to MovieDocument.m</a>
				
			<br/>
			
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-SW9">Modifying the Info.plist File</a>
				
			<br/>
			
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-SW10">Running and Building Your QTKitPlayer</a>
				
			<br/>
			
        
			
			
				<a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-SW11">What’s Ahead?</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001245-CH209-TPXREF135" title="Creating the Extended QTKitPlayer Project"></a><h2>Creating the Extended QTKitPlayer Project</h2><p>Before you get started with your extended QTKitPlayer project, be sure that you are running either Mac OS X v10.4 or Mac OS X v10.3 and have the following items installed on your system:</p><ul class="ul"><li class="li"><p>Xcode 2.0 or later and Interface Builder 2.5 or later. Note that you can use Xcode 1.1 or Xcode 1.5 to build your project, but to take full advantage of the new programming and navigational features available, such as class model visualization, you’ll want to use Xcode 2.0. </p></li><li class="li"><p>The QuickTime Kit framework, which is in the Mac OS X <code>/System/Library/Frameworks</code> directory as <code>QTKit.framework</code></p></li><li class="li"><p>The new QuickTime palette, which resides in the <code>/Developer/Extras/Palettes</code> directory as <code>QTKit.palette</code>. If you are running Mac OS X v10.4, the palette is installed automatically. If you are running Mac OS X v10.3, you will have to install it manually into the <code>/Developer/Palettes</code> directory, so that it appears in the Interface Builder palettes toolbar when you start up Interface Builder.</p></li><li class="li"><p>QuickTime Player version 7</p></li></ul><div class="notebox"><a name="//apple_ref/doc/uid/TP40001245-CH209-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp; To create the QTKitPlayer project, you can either develop on Mac OS X v10.4 or Mac OSX v10.3. If you’re using Xcode 2.0 or later as your IDE, you’ll want to develop your project on Mac OSX 10.4.</p></div><p>Now that you’ve verified you have all these items, let’s get cooking. </p><a name="//apple_ref/doc/uid/TP40001245-CH209-SW2" title="Getting Started"></a><h3>Getting Started</h3><p>You’ll want to set aside the QTKitPlayer application you built following the steps in the previous chapter and start fresh with a new Xcode project. </p><p>There are a number of reasons for this, but suffice to say, you’ll find it easier to extend your media player application by starting from scratch. You’ll still be using the new QTKit palette to drag a QTMovieView object into a window in Interface Builder. The steps you take beyond that will nonetheless be different from those described in the previous chapter. </p><p>Note again that the QTKit palette resides in the <code>/Developer/Extras/Palettes</code> directory. To access the palette, you can either double-click its icon to launch it in Interface Builder, or drag the palette into the <code>/Developer/Palettes</code> directory, in which case it will appear among the palettes in the toolbar shown in <span class="content_text"><a href="04ExtendingSimpleQTKitApp.html#//apple_ref/doc/uid/TP40001245-CH209-BABCJCGE">Figure 3-6</a></span> when Interface Builder starts up.</p><p>To create the project, follow these steps:</p><ol class="ol"><li class="li"><p>Launch Xcode and choose File > New Project.</p></li><li class="li"><p>When the new project window appears, select Cocoa Document-based Application. Click Next.</p></li><li class="li"><p>Name the project <code>QTKitPlayer</code> and place it in the directory of your choice. Note that you’re naming the project the same as the project you built in the previous chapter, so you should place it in another directory.</p></li><li class="li"><p>Next, you need to add the QuickTime Kit framework to your QTKitPlayer project. Choose Project > Add to Project.</p></li><li class="li"><p>The QTKit framework resides in the <code>System/Library/Frameworks/QTKit.framework</code> directory. Select the framework, and click Add to add it to your QTKitPlayer project.</p></li><li class="li"><p>In the Add To Targets sheet, click the Add button.</p></li><li class="li"><p>Now you need to rename the nib, declaration, and implementation files with the Rename command in the File menu. Select each file in turn and rename  <code>MyDocument.h</code> to <code>MovieDocument.h</code>, and <code>MyDocument.m</code> to <code>MovieDocument.m</code>. To rename the nib file, you need to open the <code>MyDocument.nib</code> in Interface Builder and save it as <code>MovieDocument.nib</code>, then delete the <code>MyDocument.nib</code>.Using Xcode 2.1, you won't be able to rename the nib from the File > Rename menu item, which is grayed out when you click a nib in the Project window. </p></li><li class="li"><p>The Xcode project window appears as shown in <span class="content_text">Figure 3-5</span>, with your files renamed accordingly. Verify that the files shown in the illustration are the same as those in your project. Note that you won’t have to rename the <code>MainMenu.nib</code> file.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCECJAB" title="Figure 3-5The QTKitPlayer project in Xcode with nib, declaration, and implementation files renamed"></a><p><strong>Figure 3-5&nbsp;&nbsp;</strong>The QTKitPlayer project in Xcode with nib, declaration, and implementation files renamed</p><img src = "../Art/xcode_files_renamed.jpg" alt = "The QTKitPlayer project in Xcode with nib, declaration, and implementation files renamed" ></div></li></ol><a name="//apple_ref/doc/uid/TP40001245-CH209-SW3" title="Creating the QTMovieView Object with Outlets and Actions"></a><h3>Creating the QTMovieView Object with Outlets and Actions</h3><p>In this next sequence of steps, you’ll work with the QTKit palette and add outlets and actions in Interface Builder to your Xcode project.</p><ol class="ol"><li class="li"><p>Open Interface Builder by double-clicking <code>MovieDocument.nib</code> in your Xcode project window and select the blue QuickTime icon in the toolbar, as shown in <span class="content_text">Figure 3-6</span>. Note that the QuickTime icon in this palette looks like the one available in the Cocoa-GraphicsViews palette, but they are different. The one in the QTKit palette gives you the QTMovieView object rather than an NSMovieView object. Be sure that you select the item in the Cocoa-QTKit palette.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABCJCGE" title="Figure 3-6The Cocoa-QTKit palette"></a><p><strong>Figure 3-6&nbsp;&nbsp;</strong>The Cocoa-QTKit palette</p><img src = "../Art/new_qtkit_palette.jpg" alt = "The Cocoa-QTKit palette" ></div></li><li class="li"><p>Delete the text “Your document contents here” in the window object. </p></li><li class="li"><p>Drag the QuickTime icon from the QTKit palette to the bottom-left corner of the project window.</p></li><li class="li"><p>You now have a QuickTime movie view object with a control bar in the bottom-left corner of the window. Drag the upper-right handle of the movie view object to the upper-right corner of the window, filling the entire window, so the movie view object with its control bar is visible, as shown in <span class="content_text">Figure 3-7</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABGAIDC" title="Figure 3-7The QuickTime movie view object dragged to fill the entire contents of the window"></a><p><strong>Figure 3-7&nbsp;&nbsp;</strong>The QuickTime movie view object dragged to fill the entire contents of the window</p><img src = "../Art/qtpal_changed_to_qtmovie.jpg" alt = "The QuickTime movie view object dragged to fill the entire contents of the window" ></div></li><li class="li"><p>Click the QuickTime movie object in the window, then press Command-1 to open the QTMovieView Info window. The Attributes pane appears with the default fill color of black and the Show Controller item selected. Note that the field that lets you select a movie from a list of files by clicking the File button is initially blank. Don’t click the File button to open a QuickTime movie that will be displayed in your window. </p></li><li class="li"><p>Leave the Show Controller item selected.</p></li><li class="li"><p>If you want to change the fill color of the movie view, click the Fill Color box and choose a new color. <span class="content_text">Figure 3-8</span> shows the window with a fill color of blue.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABJCJIB" title="Figure 3-8The QTMovieView Info pane with a blue fill color selected for the QTMovieView object window"></a><p><strong>Figure 3-8&nbsp;&nbsp;</strong>The QTMovieView Info pane with a blue fill color selected for the QTMovieView object window</p><img src = "../Art/blue_fill_color.jpg" alt = "The QTMovieView Info pane with a blue fill color selected for the QTMovieView object window" ></div></li><li class="li"><p>Next, you want to add outlets to your QTKitPlayer project. Double-click File’s Owner in your <code>MovieDocument.nib</code> window.</p></li><li class="li"><p>Enter <code>mMovieView</code> and <code>QTMovieView</code>, and <code>mMovieWindow</code> and <code>NSWindow</code> in their respective fields of the Connections pane, as shown in <span class="content_text">Figure 3-9</span>. The illustration shows the Export view object in the <code>MovieDocument.nib</code> window, as well as the outlet <code>mExportAccessoryView</code> and its destination as <code>NSView</code>, and the outlet <code>mExportTypePopUpButton</code> and its destination as <code>NSPopUpButton</code>. You’ll enter these in a later step. </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABGIFBH" title="Figure 3-9The File&acirc;&#128;&#153;s Owner connections to various outlets, with actions specified"></a><p><strong>Figure 3-9&nbsp;&nbsp;</strong>The File’s Owner connections to various outlets, with actions specified</p><img src = "../Art/file_ow_connections.jpg" alt = "The File’s Owner connections to various outlets, with actions specified" ></div></li><li class="li"><p>Select the File’s Owner icon and press the Control key. A wire appears with a small square at one end. Make sure the square lands on the File Owner’s icon. You want to hook up the File’s Owner to the QTMovieView object. Select the outlet <code>mMovieView</code> and click Connect to wire up the File’s Owner with the QTMovieView object, as shown in <span class="content_text">Figure 3-9</span>. </p></li><li class="li"><p>Repeat the same step to connect the File’s Owner icon to the NSWindow object. Choose the outlet <code>mMovieWindow</code> and click Connect to wire up the File’s Owner with the NSWindow object.</p></li></ol><a name="//apple_ref/doc/uid/TP40001245-CH209-SW4" title="Creating the Export View Object"></a><h3>Creating the Export View Object</h3><p>In this sequence of steps, you want to create an Export view object in Interface Builder, as shown in <span class="content_text">Figure 3-10</span>. This will enable your application to display a dialog and pop-up menu when you want to export a QuickTime movie to another file type.</p><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BABBIJHA" title="Figure 3-10The export view pop-up menu constructed in Interface Builder"></a><p><strong>Figure 3-10&nbsp;&nbsp;</strong>The export view pop-up menu constructed in Interface Builder</p><img src = "../Art/export_view_construct.jpg" alt = "The export view pop-up menu constructed in Interface Builder" ></div><br/><ol class="ol"><li class="li"><p>In the Interface Builder palette toolbar, choose Cocoa-Containers and drag the CustomView container to your <code>MovieDocument.nib</code> window. It appears as a View object. </p></li><li class="li"><p>Rename the View object <code>Export view</code>.</p></li><li class="li"><p>Now you want to add a pop-up menu labeled Export to the Export view object. Drag a pop-up menu from the Cocoa-Controls palette into the Export view window. In the Attributes pane of the NSPopUpButton Info window, type <code>QuickTime Movie</code> in the Title field, as shown in <span class="content_text">Figure 3-11</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABCHGCE" title="Figure 3-11The export view object with the NSPopUpButton Info window displayed and various attributes specified"></a><p><strong>Figure 3-11&nbsp;&nbsp;</strong>The export view object with the NSPopUpButton Info window displayed and various attributes specified</p><img src = "../Art/export_view_popup.jpg" alt = "The export view object with the NSPopUpButton Info window displayed and various attributes specified" ></div></li><li class="li"><p>To add a label for the pop-up menu, drag a text field from the Cocoa-Text palette and position it to the left of the pop-up menu as shown in <span class="content_text">Figure 3-12</span>. In the Attributes pane of the NSTextField Info window, type <code>Export:</code> in the Title field. In the Options section, deselect the Editable option and the Selectable option.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHFIFE" title="Figure 3-12The export view object with the NSTextField Info window displayed and various attributes specified"></a><p><strong>Figure 3-12&nbsp;&nbsp;</strong>The export view object with the NSTextField Info window displayed and various attributes specified</p><img src = "../Art/export_view.jpg" alt = "The export view object with the NSTextField Info window displayed and various attributes specified" ></div></li><li class="li"><p>Now you are ready to wire up the Export view object. Select the File’s Owner icon and press the Control key. You want to hook up the File’s Owner to the Export view object. Choose the outlet <code>exportAccessoryView</code> and click Connect to wire up the File’s Owner with the NSView object. Select the outlet <code>exportTypePopUpButton</code> and click Connect to wire up the File’s Owner with the NSPopUpButton object. </p></li></ol><a name="//apple_ref/doc/uid/TP40001245-CH209-SW5" title="Adding Outlets and Actions to The MovieView Object"></a><h3>Adding Outlets and Actions to The MovieView Object</h3><p>Now you want to add outlets and actions to the MovieView object.</p><ol class="ol"><li class="li"><p>In the MovieDocument.nib window, double-click the File’s Owner icon. The MovieDocument Class Info window Attributes pane appears with four outlets selected and one deselected. </p></li><li class="li"><p>To add actions to the MovieDocument class, click the Actions tab, click Add, and type <code>doClone:</code>. Repeat for the following actions: <code>doExport:</code>, <code>doLoop:</code>, <code>doLoopPalindrome:</code>, <code>doPreservesAspectRatio:</code>, <code>doSetFillColor:</code>, <code>doSetFillColorPanel:</code>, <code>doSetPosterTime:</code>, and <code>doShowController:</code>. These are some of the actions that you want to add to your QTKitPlayer through various menu items.</p></li><li class="li"><p>Now you want to add more actions to your QTMovieView object using Interface Builder. In the MovieDocument.nib window, click the Classes tab, scroll down the list, and select the NSResponder class. From the list of subclasses, select NSView. Scroll down again and select QTMovieView, as shown in <span class="content_text">Figure 3-13</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABFAHFH" title="Figure 3-13The QTMovieView subclass selected in MovieDocument nib file"></a><p><strong>Figure 3-13&nbsp;&nbsp;</strong>The QTMovieView subclass selected in MovieDocument nib file</p><img src = "../Art/subclass_nsview.jpg" alt = "The QTMovieView subclass selected in MovieDocument nib file" ></div></li><li class="li"><p>Press Command-1 to open the QTMovieView Class Info window. This displays the attributes of your QTMovieView object, deselected in grayed out text. You want to add these actions: <code>add:</code>, <code>addScaled:</code>, <code>copy:</code>, <code>cut:</code>, <code>delete:</code>, <code>gotoBeginning:</code>, <code>gotoEnd:</code>, <code>gotoPosterFrame:</code>, <code>paste:</code>, <code>replace:</code>, <code>stepBackward:</code>, <code>stepForward:</code>, and <code>trim:</code>. </p><p>To add these actions, you need to parse the QTMovieView header file. In Interface Builder, select Classes > Read Files... A dialog opens. Select System > Library > Frameworks > QTKit.framework > Headers > QTMovieView.h. Click Parse. The QTMovieView window now shows the actions hilighted and added(<span class="content_text">Figure 3-14</span>). </p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABCHACA" title="Figure 3-14The QTMovieView Class Attributes pane with list of actions added to the QTMovieView object"></a><p><strong>Figure 3-14&nbsp;&nbsp;</strong>The QTMovieView Class Attributes pane with list of actions added to the QTMovieView object</p><img src = "../Art/qtmovieclass_add_out_action.jpg" alt = "The QTMovieView Class Attributes pane with list of actions added to the QTMovieView object" ></div></li></ol><a name="//apple_ref/doc/uid/TP40001245-CH209-SW6" title="Wiring Up The MainMenu.nib"></a><h3>Wiring Up The MainMenu.nib</h3><p>In this next sequence of steps, you want to change the NSApplication menu title in the MainMenu.nib - MainMenu file to QTKitPlayer and add items to each of the menu choices. You’ll also want to modify the attributes of each NSMenuItem.</p><ol class="ol"><li class="li"><p>In the MainMenu.nib - MainMenu file, you want to change the NSApplication menu title to QTKitPlayer. Select the menu title so that the item is highlighted. Then, double-click the item and enter the new text <code>QTKitPlayer</code>. Do this for the About, Hide, and Quit menu items in the MainMenu.nib window, so that each item refers to the QTKitPlayer, as shown in <span class="content_text">Figure 3-15</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHBHGI" title="Figure 3-15The MainMenu nib file with changes to the application menu "></a><p><strong>Figure 3-15&nbsp;&nbsp;</strong>The MainMenu nib file with changes to the application menu </p><img src = "../Art/about_attrib.jpg" alt = "The MainMenu nib file with changes to the application menu" ></div></li><li class="li"><p>In the MainMenu.nib - MainMenu file, add to the File menu the items Import and Export, so your File menu appears as shown in <span class="content_text">Figure 3-16</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHACIG" title="Figure 3-16The MainMenu nib file additions to the File menu"></a><p><strong>Figure 3-16&nbsp;&nbsp;</strong>The MainMenu nib file additions to the File menu</p><img src = "../Art/new_menu_attrib.jpg" alt = "The MainMenu nib file additions to the File menu" ></div></li><li class="li"><p>In the File menu, select the Import menu item and press Command-2 to open the Connections pane of the NSMenuItem Info window. Press Control and hook up the Import menu item to First Responder. Scroll down the list of the actions for First Responder and select openDocument, as shown in <span class="content_text">Figure 3-17</span>. Click the Connect button.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABGGAIB" title="Figure 3-17The MainMenu nib file with the Import menu item hooked up to First Responder and the openDocument action connected"></a><p><strong>Figure 3-17&nbsp;&nbsp;</strong>The MainMenu nib file with the Import menu item hooked up to First Responder and the openDocument action connected</p><img src = "../Art/import_menu_wiring.jpg" alt = "The MainMenu nib file with the Import menu item hooked up to First Responder and the openDocument action connected" ></div></li><li class="li"><p>In the MainMenu.nib - MainMenu file, add to the Edit menu the items shown in <span class="content_text">Figure 3-18</span>. These items include Undo, Redo, Cut, Copy, Paste, Delete, Select All, Add, Add Scaled, Replace, and Trim.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABGCJHI" title="Figure 3-18The MainMenu nib file with additions to the Edit menu"></a><p><strong>Figure 3-18&nbsp;&nbsp;</strong>The MainMenu nib file with additions to the Edit menu</p><img src = "../Art/edit_undo_attrib.jpg" alt = "The MainMenu nib file with additions to the Edit menu" ></div></li><li class="li"><p>Before you hook up these items to actions in First Responder, you need to double-click the First Responder icon in the MainMenu.nib. The info panel brings up a list of the attributes available. Select the Actions tab. Now you want to add the following actions: <code>add:</code>, <code>addScaled:</code>, <code>copy:</code>,<code>cut:</code>, <code>delete:</code>, <code>gotoBeginning:</code>, <code>gotoEnd:</code>, <code>gotoPosterFrame:</code>, <code>paste:</code>, <code>replace:</code>, <code>stepBackward:</code>, <code>stepForward:</code>, and <code>trim:</code> Enter each action and click Add.</p><p>Now you want to hook up these items to actions in First Responder. In the Edit menu, select each of the new menu items and connect it to the appropriate action in the actions list for First Responder, as shown in <span class="content_text">Figure 3-19</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHJGIB" title="Figure 3-19The MainMenu nib file with the Replace menu item selected and its connection specified"></a><p><strong>Figure 3-19&nbsp;&nbsp;</strong>The MainMenu nib file with the Replace menu item selected and its connection specified</p><img src = "../Art/edit_menu_replace_actions.jpg" alt = "The MainMenu nib file with the Replace menu item selected and its connection specified" ></div></li><li class="li"><p>In the MainMenu.nib - MainMenu file, add the Movie menu and those items shown in <span class="content_text">Figure 3-20</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABHGBAE" title="Figure 3-20The MainMenu nib file with additions to the Movie menu"></a><p><strong>Figure 3-20&nbsp;&nbsp;</strong>The MainMenu nib file with additions to the Movie menu</p><img src = "../Art/start_movie_attrib_panel.jpg" alt = "The MainMenu nib file with additions to the Movie menu" ></div></li><li class="li"><p>Hook up these items to actions in First Responder. In the Movie menu, select each item and connect it to the appropriate action. Rename Start to <code>play:</code> and Stop to <code>pause:</code>, as shown in  <span class="content_text">Figure 3-21</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40001245-CH209-BABGFFAJ" title="Figure 3-21The MainMenu nib file with the Start menu item selected and its connection specified"></a><p><strong>Figure 3-21&nbsp;&nbsp;</strong>The MainMenu nib file with the Start menu item selected and its connection specified</p><img src = "../Art/movie_menu_start.jpg" alt = "The MainMenu nib file with the Start menu item selected and its connection specified" ></div></li><li class="li"><p>Save your <code>MainMenu.nib</code> file and quit Interface Builder. </p></li></ol><p>You’ve now completed the first part of your project. In the next part, you’ll add the Cocoa code that makes your QTKitPlayer application work and perform like a champion.</p><a name="//apple_ref/doc/uid/TP40001245-CH209-SW7" title="Adding Code to the MovieDocument Class Interface"></a><h2>Adding Code to the MovieDocument Class Interface</h2><p>In this next sequence of steps, you’ll be adding a small amount of code to your <code>MovieDocument.h</code> class interface file. </p><p>To begin, open the <code>MovieDocument.h</code> declaration file in your Xcode project and delete any existing code in the file. Now follow these steps:</p><ol class="ol"><li class="li"><p>Insert the following import code at the beginning of your file:</p><div class="codesample"><table><tr><td scope="row"><pre>#import &lt;Cocoa/Cocoa.h><span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QTKit/QTKit.h><span></span></pre></td></tr></table></div></li><li class="li"><p>Add the following declaration code after your import statements:</p><div class="codesample"><table><tr><td scope="row"><pre>@interface MovieDocument : NSDocument<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> // movie window<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet NSWindow *mMovieWindow;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet QTMovieView *mMovieView;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> // export<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet NSView *mExportAccessoryView;<span></span></pre></td></tr><tr><td scope="row"><pre>    IBOutlet NSPopUpButton *mExportTypePopUpButton;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> // movie document<span></span></pre></td></tr><tr><td scope="row"><pre>    QTMovie         *mMovie;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The first line defines the MovieDocument class and specifies that it inherits from the NSDocument class. The first four statements declare the outlets you set up and connected in Interface Builder. The <code>movieWindow</code> instance variable, for example, points to the NSWindow object while the <code>movieView</code> instance variable points to the QTMovieView object. The last line declares that the <code>mMovie</code> instance variable points to the QTMovie object. </p></li><li class="li"><p>Define a class method with the following line of code:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (id)movieDocumentWithMovie:(QTMovie *)movie;<span></span></pre></td></tr></table></div></li><li class="li"><p>To initialize movies, add this code line:</p><div class="codesample"><table><tr><td scope="row"><pre>- (id)initWithMovie:(QTMovie *)movie;<span></span></pre></td></tr></table></div></li><li class="li"><p>For the NSMenu validation protocol, which returns a <code>BOOL</code> value, as it validates the menu items in your project, add this:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)validateMenuItem:(NSMenuItem *)menuItem;<span></span></pre></td></tr></table></div></li><li class="li"><p>The following line of code, which enables you to set a movie to the QTMovie object using the <code>setMovie:</code> method, is one of the most common you’ll use in building projects with the QuickTime Kit framework. Add it:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)setMovie:(QTMovie *)movie;<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following block of action method declarations in your <code>MovieDocument.h</code> file: </p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)doExport:(id)sender; // run the export sheet<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doSetFillColorPanel:(id)sender; // update the fill color<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doSetFillColor:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doSetPosterTime:(id)sender;<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doShowController:(id)sender;//toggle controller visibility<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doPreserveAspectRatio:(id)sender;// toggle aspect ratio<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doLoop:(id)sender; // toggle looping<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doLoopPalindrome:(id)sender; // toggle palindrome looping<span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doClone:(id)sender;<span></span></pre></td></tr></table></div></li><li class="li"><p>To handle NSDocument overrides, add the following lines of code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSString *)windowNibName;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)windowControllerDidLoadNib:(NSWindowController*)windowController;<span></span></pre></td></tr><tr><td scope="row"><pre>- (NSData *)dataRepresentationOfType:(NSString *)docType;<span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)writeWithBackupToFile:(NSString *)fullDocumentPath ofType:(NSString *)type saveOperation:(NSSaveOperationType)saveOperation;<span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)readFromFile:(NSString *)fileName ofType:(NSString *)type;<span></span></pre></td></tr><tr><td scope="row"><pre>- (void)printShowingPrintPanel:(BOOL)showPanels;<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following method before the <code>@end</code> directive in the file:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)createMovieDocumentWithFile:(NSString *)fileName asData:(BOOL)asData;<span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p> To save your NSSavePanel delegate, which handles your export dialog, insert these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)exportPanelDidEnd:(NSSavePanel *)sheet returnCode:(int)returnCode contextInfo:(void *)contextInfo;<span></span></pre></td></tr></table></div></li><li class="li"><p>Save your <code>MovieDocument.h</code> file (Command-S).</p></li></ol><p>This completes the first part of code additions to your Xcode project. </p><a name="//apple_ref/doc/uid/TP40001245-CH209-SW8" title="Adding Code to MovieDocument.m"></a><h2>Adding Code to MovieDocument.m</h2><p>In this next sequence of steps, you’ll be adding a larger chunk of code to your <code>MovieDocument.m</code> implementation file. </p><p>To begin, open the <code>MovieDocument.m</code> file in your Xcode project and delete any existing code in the file. Now follow these steps:</p><ol class="ol"><li class="li"><p>Insert the following import code at the beginning of your file:</p><div class="codesample"><table><tr><td scope="row"><pre>#import "MovieDocument.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#import &lt;QTKit/QTKit.h><span></span></pre></td></tr></table></div></li><li class="li"><p>Following your import statements, you want to define a constant for movies that are not necessarily visual––that is, audio files. Specify the width as 320. Insert these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>#define  kDefaultWidthForNonvisualMovies  320<span></span></pre></td></tr><tr><td scope="row"><pre>@implementation MovieDocument<span></span></pre></td></tr></table></div></li><li class="li"><p>Now you want to add the following class method and deal with memory allocation. Note that this is just a convenience method if you want to create a document given a movie. By calling <code>autorelease</code>, you auto release the movie. Add these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>+ (id)movieDocumentWithMovie:(QTMovie *)movie<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [[(MovieDocument *)[self alloc] initWithMovie:movie] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Next, you need to add initialization code to initialize a MovieDocument instance and set the file type. Setting the movie to <code>nil</code> will release it. Add these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>- (id)initWithMovie:(QTMovie *)movie<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [super init];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setFileType:@"MovieDocument"];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setMovie:movie];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (mMovie == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [self release];<span></span></pre></td></tr><tr><td scope="row"><pre>        self = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return self;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following code to handle deallocation of memory and notifications:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)dealloc<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSNotificationCenter defaultCenter] removeObserver:self];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setMovie:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    [super dealloc];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>To deal with NSMenu validations for enabling and disabling of menu items, insert this chunk of code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)validateMenuItem:(NSMenuItem *)menuItem<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL valid = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    SEL action;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    action = [menuItem action];<span></span></pre></td></tr><tr><td scope="row"><pre>    // validate<span></span></pre></td></tr><tr><td scope="row"><pre>    if (action == @selector(doExport:))<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = (mMovie != nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    else if (action == @selector(doSetFillColorPanel:))<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = YES;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    else if (action == @selector(doShowController:))<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [menuItem setState:([mMovieView isControllerVisible] ? NSOnState : NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if (action == @selector(doPreserveAspectRatio:))<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [menuItem setState:([mMovieView preservesAspectRatio] ? NSOnState : NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = (mMovie != nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if ((action == @selector(doLoop:)) &amp;&amp; mMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [menuItem setState:([[mMovie attributeForKey:QTMovieLoopsAttribute] boolValue] ? NSOnState : NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if ((action == @selector(doLoopPalindrome:)) &amp;&amp; mMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if ([[mMovie attributeForKey:QTMovieLoopsAttribute] boolValue])<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            [menuItem setState:([[mMovie attributeForKey:QTMovieLoopsBackAndForthAttribute] boolValue] ? NSOnState : NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>            valid = YES;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    else if (action == @selector(doClone:))<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = (mMovie != nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        valid = [super validateMenuItem:menuItem];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return valid;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>To set the instance variable of the movie (one of the most common operations in the QuickTime Kit framework), add the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)setMovie:(QTMovie *)movie<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [movie retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovie release];<span></span></pre></td></tr><tr><td scope="row"><pre>     mMovie = movie;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>The next block of code is a bit more complicated. You want to set the movie window size to fit the movie, so that it is the “natural” movie size. (Natural size is the size of the movie when it was first created. After opening the movie, you can resize it.) The code here sets the coordinates, specifying that the movie window appears in the top-left corner of the window. Otherwise, the movie appears in the bottom-left corner. The code lets you move the movie around, but pegs it initially to the top-left corner. Insert the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)sizeWindowToMovie:(NSNotification *)notification<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRect   currWindowBounds, newWindowBounds;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSPoint  topLeft;<span></span></pre></td></tr><tr><td scope="row"><pre>    static BOOL nowSizing = NO;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (nowSizing)<span></span></pre></td></tr><tr><td scope="row"><pre>        return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    nowSizing = YES;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSSize contentSize = [[mMovie attributeForKey:QTMovieCurrentSizeAttribute] sizeValue];<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([mMovieView isControllerVisible])<span></span></pre></td></tr><tr><td scope="row"><pre>        contentSize.height += [mMovieView controllerBarHeight];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// get the current location and size of the movie window, so we can keep // the top-left corner pegged, i.e. fixed<span></span></pre></td></tr><tr><td scope="row"><pre>    currWindowBounds = [[mMovieView window] frame];<span></span></pre></td></tr><tr><td scope="row"><pre>    topLeft.x = currWindowBounds.origin.x;<span></span></pre></td></tr><tr><td scope="row"><pre>    topLeft.y = currWindowBounds.origin.y + currWindowBounds.size.height;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (contentSize.width == 0)<span></span></pre></td></tr><tr><td scope="row"><pre>        contentSize.width = currWindowBounds.size.width;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    newWindowBounds = [[mMovieView window] frameRectForContentRect:NSMakeRect(0, 0, contentSize.width, contentSize.height)];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [[mMovieView window] setFrame:NSMakeRect(topLeft.x, topLeft.y - newWindowBounds.size.height, newWindowBounds.size.width, newWindowBounds.size.height) display:YES];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    nowSizing = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>To deal with NSDocument overrides, add these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSString *)windowNibName<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return @"MovieDocument";<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>To set up the movie view and set the editable state of the controller, you need to add this chunk of code. You also want to “listen” for any movie size changes, so notifications are added here. Insert the following:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)windowControllerDidLoadNib:(NSWindowController *)windowController<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set up the movie view<span></span></pre></td></tr><tr><td scope="row"><pre>    if (mMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSSize contentSize = [[mMovie attributeForKey:QTMovieNaturalSizeAttribute] sizeValue];<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovieView setMovie:mMovie];<span></span></pre></td></tr><tr><td scope="row"><pre>        if ([mMovieView isControllerVisible])<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            contentSize.height += [mMovieView movieControllerBounds].size.height;<span></span></pre></td></tr><tr><td scope="row"><pre>            if (contentSize.width == 0)<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                contentSize.width = kDefaultWidthForNonvisualMovies;<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        [[mMovieView window] setContentSize:contentSize];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        [mMovieView setMovie:[QTMovie movie]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set the editable state<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovie setAttribute:[NSNumber numberWithBool:YES] forKey:QTMovieEditableAttribute];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // watch for movie resizings<span></span></pre></td></tr><tr><td scope="row"><pre>    if (mMovie)<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(sizeWindowToMovie:) name:QTMovieSizeDidChangeNotification object:mMovie];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>To write to handle updates and saves, add the following code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)writeWithBackupToFile:(NSString *)fullDocumentPath ofType:(NSString *)type saveOperation:(NSSaveOperationType)saveOperation<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL success = NO;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // update/save<span></span></pre></td></tr><tr><td scope="row"><pre>    if (saveOperation == NSSaveOperation)<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [mMovie updateMovieFile];<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        success = [super writeWithBackupToFile:fullDocumentPath ofType:type saveOperation:saveOperation];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return success;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add these lines of code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSData *)dataRepresentationOfType:(NSString *)docType<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return [mMovie movieFormatRepresentation];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add these lines to handle reading the movie from a file:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)readFromFile:(NSString *)fileName ofType:(NSString *)type<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL  success = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSData  *data;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // read the movie<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([QTMovie canInitWithFile:fileName])<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        if ([type isEqualTo:@"MovieDocumentData"])<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            data = [NSData dataWithContentsOfFile:fileName];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            [self setMovie:((QTMovie *)[QTMovie movieWithFile:fileName])];<span></span></pre></td></tr><tr><td scope="row"><pre>            success = (mMovie != nil);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return success;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>The following chunk of code is intended to deal with opening movies and other media that QuickTime “understands” using an instance method and setting a flag. Add these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>- (id)openDocumentWithContentsOfFile:(NSString *)fileName display:(BOOL)displayFlag<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // first check whether we already have a document for this file<span></span></pre></td></tr><tr><td scope="row"><pre>    NSDocumentController *sharedDocController = [NSDocumentController sharedDocumentController];<span></span></pre></td></tr><tr><td scope="row"><pre>    MovieDocument *movieDocument = [sharedDocController documentForFileName:fileName];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (movieDocument)<span></span></pre></td></tr><tr><td scope="row"><pre>    {// we've got one, just bring it forward<span></span></pre></td></tr><tr><td scope="row"><pre>        if (displayFlag)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            [movieDocument showWindows];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {// we must create a new document.<span></span></pre></td></tr><tr><td scope="row"><pre>        // we always create a movie document regardless of type<span></span></pre></td></tr><tr><td scope="row"><pre>        // init<span></span></pre></td></tr><tr><td scope="row"><pre>        movieDocument = [[[MovieDocument allocWithZone:[self zone]] initWithContentsOfFile:fileName ofType:@"mov"] autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // set up the document<span></span></pre></td></tr><tr><td scope="row"><pre>        if (movieDocument)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // add the document<span></span></pre></td></tr><tr><td scope="row"><pre>            [sharedDocController addDocument:movieDocument];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>            // set up the document<span></span></pre></td></tr><tr><td scope="row"><pre>            if ([sharedDocController shouldCreateUI])<span></span></pre></td></tr><tr><td scope="row"><pre>            {<span></span></pre></td></tr><tr><td scope="row"><pre>                [movieDocument makeWindowControllers];<span></span></pre></td></tr><tr><td scope="row"><pre>                if (displayFlag)<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    [movieDocument showWindows];<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return movieDocument;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the following code to locate the file to be opened:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)panel:(id)sender shouldShowFilename:(NSString *)filename<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL isDir = NO;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSFileManager defaultManager] fileExistsAtPath:filename isDirectory:&amp;isDir];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (isDir)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        return [QTMovie canInitWithFile:filename];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add this code to filter files through an Open dialog and display them:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)openDocument:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSOpenPanel *openPanel = [NSOpenPanel openPanel];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [openPanel setDelegate:self];<span></span></pre></td></tr><tr><td scope="row"><pre>    [openPanel setAllowsMultipleSelection:NO];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // files are filtered through the panel:shouldShowFilename: method above<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([openPanel runModalForTypes:nil] == NSOKButton) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [self openDocumentWithContentsOfFile:[[openPanel filenames] lastObject] display:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add the following lines of code:</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)application:(NSApplication *)theApplication openFile:(NSString *)filename<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return (nil != [self openDocumentWithContentsOfFile:filename display:YES]);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Insert the following code to display the Print dialog:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)printShowingPrintPanel:(BOOL)showPanels<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSPrintOperation *printOperation;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    printOperation = [NSPrintOperation printOperationWithView:mMovieView printInfo:[self printInfo]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [printOperation setShowPanels:showPanels];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // print<span></span></pre></td></tr><tr><td scope="row"><pre>    [self runModalPrintOperation:printOperation delegate:nil didRunSelector:nil contextInfo:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>You add the following code to handle the NSSavePanel delegate for the export sheet. Note that you use an NSArray to list export types, such as <code>mpg4</code>, <code>bmpf</code>, <code>aiff</code>, and so on. These types are hard-coded here. You can add to the list if you want to and include, for example, <code>3gpp</code> or <code>mpg3</code>. </p><div class="codesample"><table><tr><td scope="row"><pre>- (void)exportPanelDidEnd:(NSSavePanel *)sheet returnCode:(int)returnCode contextInfo:(void *)contextInfo<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int             selectedItem;<span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableDictionary*settings = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    static NSArray *exportTypes = nil;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    if (exportTypes == nil)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        exportTypes = [[NSArray arrayWithObjects:<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSNumber numberWithLong:'AIFF'], [NSNumber numberWithLong:'BMPf'], [NSNumber numberWithLong:'dvc!'],<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSNumber numberWithLong:'FLC '], [NSNumber numberWithLong:'mpg4'], [NSNumber numberWithLong:'MooV'],<span></span></pre></td></tr><tr><td scope="row"><pre>            [NSNumber numberWithLong:'embd'], nil] retain];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // export<span></span></pre></td></tr><tr><td scope="row"><pre>    if (returnCode == NSOKButton)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // init<span></span></pre></td></tr><tr><td scope="row"><pre>        selectedItem = [mExportTypePopUpButton indexOfSelectedItem];<span></span></pre></td></tr><tr><td scope="row"><pre>        settings = [NSMutableDictionary dictionaryWithCapacity:5];<span></span></pre></td></tr><tr><td scope="row"><pre>        [settings setObject:[NSNumber numberWithBool:YES] forKey:QTMovieExport];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if ((selectedItem >= 0) &amp;&amp; (selectedItem &lt; [exportTypes count]))<span></span></pre></td></tr><tr><td scope="row"><pre>            [settings setObject:[exportTypes objectAtIndex:selectedItem] forKey:QTMovieExportType];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // export<span></span></pre></td></tr><tr><td scope="row"><pre>        if (![mMovie writeToFile:[sheet filename] withAttributes:settings])<span></span></pre></td></tr><tr><td scope="row"><pre>            NSRunAlertPanel(@"Error", @"Error exporting movie.", nil, nil, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p> Add the following actions to your file:</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)doExport:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSSavePanel *savePanel;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    savePanel = [NSSavePanel savePanel];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // run the export sheet<span></span></pre></td></tr><tr><td scope="row"><pre>    [savePanel setAccessoryView:mExportAccessoryView];<span></span></pre></td></tr><tr><td scope="row"><pre>    [savePanel beginSheetForDirectory:nil file:[[self fileName] lastPathComponent] modalForWindow:mMovieWindow modalDelegate:self<span></span></pre></td></tr><tr><td scope="row"><pre>        didEndSelector:@selector(exportPanelDidEnd: returnCode: contextInfo:) contextInfo:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doSetFillColorPanel:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSColorPanel *colorPanel;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    colorPanel = [NSColorPanel sharedColorPanel];<span></span></pre></td></tr><tr><td scope="row"><pre>    [colorPanel setAction:@selector(doSetFillColor:)];<span></span></pre></td></tr><tr><td scope="row"><pre>    [colorPanel setTarget:self];<span></span></pre></td></tr><tr><td scope="row"><pre>    [colorPanel setColor:[mMovieView fillColor]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // run the panel<span></span></pre></td></tr><tr><td scope="row"><pre>    [colorPanel makeKeyAndOrderFront:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doSetFillColor:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // update the fill color<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovieView setFillColor:[sender color]];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doShowController:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // toggle the controller visibility<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovieView setControllerVisible:([sender state] == NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doPreserveAspectRatio:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // toggle the aspect ratio preservation<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovieView setPreservesAspectRatio:([sender state] == NSOffState)];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doLoop:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // toggle looping<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovie setAttribute:[NSNumber numberWithBool:([sender state] == NSOffState)] forKey:QTMovieLoopsAttribute];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doLoopPalindrome:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // toggle palindrome looping<span></span></pre></td></tr><tr><td scope="row"><pre>    [mMovie setAttribute:[NSNumber numberWithBool:([sender state] == NSOffState)] forKey:QTMovieLoopsBackAndForthAttribute];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (IBAction)doClone:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    MovieDocument *movieDocument;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // init<span></span></pre></td></tr><tr><td scope="row"><pre>    movieDocument = [MovieDocument movieDocumentWithMovie:[[mMovie copy] autorelease]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set up the document<span></span></pre></td></tr><tr><td scope="row"><pre>    if (movieDocument)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // add the document<span></span></pre></td></tr><tr><td scope="row"><pre>        [[NSDocumentController sharedDocumentController] addDocument:movieDocument];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // set up the document<span></span></pre></td></tr><tr><td scope="row"><pre>        [movieDocument makeWindowControllers];<span></span></pre></td></tr><tr><td scope="row"><pre>        [movieDocument showWindows];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div></li><li class="li"><p>Save your <code>MovieDocument.m</code> file (Command-S).</p></li></ol><p>This completes the steps for adding code to your <code>MovieDocument.m</code> implementation file. There is only one more step, described in the next section, before you can run and build your QTKitPlayer application. </p><a name="//apple_ref/doc/uid/TP40001245-CH209-SW9" title="Modifying the Info.plist File"></a><h2>Modifying the Info.plist File</h2><p>The is the last step to complete before you can build and run your QTKitPlayer application.</p><ol class="ol"><li class="li"><p>In your Xcode project, double-click the <code>Info.plist</code> file to open it.</p></li><li class="li"><p>Delete the existing contents of the <code>Info.plist</code> file.</p></li><li class="li"><p>Replace the contents of the file with the following:</p></li></ol><div class="codesample"><table><tr><td scope="row"><pre>&lt;?xml version="1.0" encoding="UTF-8"?><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;plist version="1.0"><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleDevelopmentRegion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>English&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleDocumentTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeExtensions&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>mov&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>MovieDocument&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeOSTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>MooV&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeRole&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>Editor&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSDocumentClass&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>MovieDocument&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;dict><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeExtensions&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>mov&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>MovieDocumentData&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeOSTypes&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;array><span></span></pre></td></tr><tr><td scope="row"><pre>                &lt;string>????&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>CFBundleTypeRole&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>Viewer&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;key>NSDocumentClass&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;string>MovieDocument&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/array><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleExecutable&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>QTKitPlayer&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleGetInfoString&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>QTKitPlayer 1.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleIdentifier&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>com.apple.QTKitPlayer&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleInfoDictionaryVersion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>6.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleName&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>QTKitPlayer&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundlePackageType&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>APPL&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleShortVersionString&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>1.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleSignature&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>????&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>CFBundleVersion&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>1.0&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>NSMainNibFile&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>MainMenu&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;key>NSPrincipalClass&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;string>NSApplication&lt;/string><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/dict><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/plist><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40001245-CH209-SW10" title="Running and Building Your QTKitPlayer"></a><h2>Running and Building Your QTKitPlayer</h2><p>If you’ve followed correctly all the steps described in this chapter, you’ll be ready to build and run the QTKitPlayer application. In Xcode, simply click the hammer icon with the play button on top, or press Command-R, as you would if you were compiling any other Xcode project. </p><p>The QTKitPlayer appears with the blue default movie displayed. Now you can open and import other media, export them to different formats, edit the contents of that media, and control movie playback and display, such as showing or not showing the movie controller.</p><p>You’ll also be able to perform a variety of movie-editing operations discussed earlier in this chapter, such as trimming (shown in <span class="content_text">Figure 3-22</span>). </p><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCEACEF" title="Figure 3-22The Apple 1984-2004 QuickTime movie with the editing trim feature enabled"></a><p><strong>Figure 3-22&nbsp;&nbsp;</strong>The Apple 1984-2004 QuickTime movie with the editing trim feature enabled</p><img src = "../Art/edit_menu_trim.jpg" alt = "The Apple 1984-2004 QuickTime movie with the editing trim feature enabled" ></div><br/><p>Again, the Add command lets you add a new chunk to a movie in one or more new tracks––on top of what’s already there––instead of inserting it like you would do using the Paste command. The Add Scaled command scales the chunk you are pasting in time, and the chunk becomes stretched or compressed so that it plays for the same duration as the current selection in the receiving movie, which can result in a slow-motion or fast-motion effects. The Trim command deletes everything in the current movie except the current selection</p><p>If you want to export your movie to another media format, such as MPEG-4, choose the Export command in the Edit menu, as shown in <span class="content_text">Figure 3-23</span>, and the export sheet (<span class="content_text">Figure 3-24</span>) will appear. </p><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCIJFBA" title="Figure 3-23Exporting the Apple 1984-2004 QuickTime movie in your QTKitPlayer application"></a><p><strong>Figure 3-23&nbsp;&nbsp;</strong>Exporting the Apple 1984-2004 QuickTime movie in your QTKitPlayer application</p><img src = "../Art/export_menu.jpg" alt = "Exporting the Apple 1984-2004 QuickTime movie in your QTKitPlayer application" ></div><br/><br/><div><a name="//apple_ref/doc/uid/TP40001245-CH209-BBCDDBAG" title="Figure 3-24The export sheet for exporting a QuickTime movie to MPEG-4"></a><p><strong>Figure 3-24&nbsp;&nbsp;</strong>The export sheet for exporting a QuickTime movie to MPEG-4</p><img src = "../Art/export_sheet.jpg" alt = "The export sheet for exporting a QuickTime movie to MPEG-4" ></div><br/><a name="//apple_ref/doc/uid/TP40001245-CH209-SW11" title="What&acirc;&#128;&#153;s Ahead?"></a><h2>What’s Ahead?</h2><p>By working through the example code in this chapter and building the extended QTKitPlayer project, you’ve laid the foundation for an even more powerful and robust media player application to come. </p><p>In the next chapters of this tutorial, you’ll move into a more advanced learning phase. You’ll add new features and capabilities to your QTKitPlayer, such as the ability to open QuickTime streaming movies from URLs. You’ll also learn how to implement a Cocoa drawer with a timer that updates synchronously in real time the rate at which a QuickTime movie is displayed. In later chapters, you’ll extend the QTKitPlayer to handle more robust play back of multimedia content, with up to six movies, video streams, and QuickTime virtual reality movies playing at the same time. </p><p>Each chapter is intended to demonstrate, step by step, how you can enhance your QTKitPlayer application—and in the process, learn how to tap into the awesome power of Apple’s QTKit framework.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Chapter03/03BuildingQTKItSimpleApp.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Chapter05/AddingToQTKitPlayer.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-11-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/Conceptual/QTKitProgrammingGuide/Chapter04/04ExtendingSimpleQTKitApp.html%3Fid%3DTP40001245-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/Conceptual/QTKitProgrammingGuide/Chapter04/04ExtendingSimpleQTKitApp.html%3Fid%3DTP40001245-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/Conceptual/QTKitProgrammingGuide/Chapter04/04ExtendingSimpleQTKitApp.html%3Fid%3DTP40001245-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>