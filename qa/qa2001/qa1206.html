<HTML><!--This file created 10/28/02 10:43 AM by Claris Home Page version 3.0--><HEAD>   <title>Technical Q&amp;A QA1206: Video Output Components - Implementing QTVideoOutputGetIndSoundOutput on Mac OS X</title>   <META NAME=GENERATOR CONTENT="Claris Home Page 3.0">   <X-CLARIS-WINDOW TOP=42 BOTTOM=972 LEFT=4 RIGHT=838>   <X-CLARIS-TAGVIEW MODE=minimal><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><meta name="keywords" content="QTVideoOutputGetIndSoundOutput  video output components coreaudio sound output"><meta name="Description" content="Technical Q&amp;A QA1206: This Q&amp;A describes how to support theQTVideoOutputGetIndSoundOutput api in Mac OS X."><meta name="categories" content="QuickTime Components"><meta name="week-posted" content="Oct 28, 2002 - Nov 1, 2002"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10001731" title="Video Output Components - Implementing QTVideoOutputGetIndSoundOutput on Mac OS X"></a><P><!-- top_of_header_marker_comment --> <!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalqas/index.html">Technical Q&As</a> &gt; <a href="../../technicalqas/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalqas/QuickTime/idxQuickTimeComponentCreation-date.html">QuickTime Component Creation</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --> <!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Q&amp;A QA1206</div>
<div id="pageheadsub">Video Output Components - Implementing QTVideoOutputGetIndSoundOutput on Mac OS X</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --></P><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600>   <TR>      <td align="left">         <P><!-- begin_content -->                  <hr width=500 align=center>                  </P>                  <P id=p2>Q: How do I implement         <CODE>QTVideoOutputGetIndSoundOutput</CODE> on Mac OS X? I         have a Core Audio driver not a Sound Output Component. Where         do I get the Sound Output Component from?</P>                  <P id=p4>A: The Carbon Sound Manager will register Sound         Output Components with the subType         <CODE>kHALCustomComponentSubType</CODE> for each Core Audio         device driver on Mac OS X. To find the Sound Output         Component corresponding to your Core Audio device follow         these steps:</P>                  <OL id=p4>            <LI>Find your driver's Unique ID (UID) using Core            Audio.</LI>                        <LI>Initialize the Sound Manager - this can be done using            an inexpensive call such as            <CODE>SndManagerStatus</CODE>.</LI>                        <LI>Iterate over the Sound Output Components using            <CODE>FindNextComponent</CODE>, and for each Sound Output            Component found call <CODE>SoundComponentGetInfo</CODE>            using the <CODE>siHALAudioDeviceUniqueID </CODE>selector.            This will also return a UID.</LI>                        <LI>Match your driver's UID returned from Core Audio with            the UID returned from            <CODE>SoundComponentGetInfo</CODE>.</LI>                        <LI>If the UIDs match you've found the Sound Output            Component. Return it and you're done.</LI>         </OL>                  <P id=p4>Listing 1 demonstrates one possible implementation         supporting a single Sound Output Component.</P>                  <P><BR>         </P>                  <CENTER><TABLE BORDER=0 CELLPADDING=4 WIDTH=550>            <TR>               <td bgcolor="#E6E6E6" align=left>                  <pre>#define kMaxStringSize 1024// CopyMyAudioDriverUID//      Find your drivers UID and return it in// a CFString you are responsible for releasing.OSStatus CopyMyAudioDriverUID(CFStringRef *outUID){    UInt32          theSize;    char            theString[kMaxStringSize];    UInt32          theNumberDevices;    AudioDeviceID   *theDeviceList = NULL;    UInt32          theDeviceIndex;    CFStringRef     theCFString = NULL;    OSStatus        theStatus = noErr;    // this is our driver    const char      *nameString = "BrownSound audio controller";    const char      *manufacturerString = "Eddie";    *outUID = NULL;    // device list size    theSize = 0;    theStatus = AudioHardwareGetPropertyInfo(kAudioHardwarePropertyDevices, &amp;theSize, NULL);    if (theStatus) goto done;    theNumberDevices = theSize / sizeof(AudioDeviceID);    // allocate the device list    theDeviceList = (AudioDeviceID*)malloc(theNumberDevices * sizeof(AudioDeviceID));    // get the device list    theSize = theNumberDevices * sizeof(AudioDeviceID);    theStatus = AudioHardwareGetProperty(kAudioHardwarePropertyDevices, &amp;theSize, theDeviceList);    // iterate through the device list, find our device and return the UID    for(theDeviceIndex = 0; theDeviceIndex &lt; theNumberDevices; ++theDeviceIndex)    {        // get name        theSize = kMaxStringSize;        theStatus = AudioDeviceGetProperty(theDeviceList[theDeviceIndex],                                      0, 0, kAudioDevicePropertyDeviceName, &amp;theSize, theString);        if (theStatus) goto done;        // is it me?        if (strncmp(theString, nameString, strlen(nameString)) == 0) {            // get manufacturer            theSize = kMaxStringSize;            theStatus = AudioDeviceGetProperty(theDeviceList[theDeviceIndex], 0, 0,                                     kAudioDevicePropertyDeviceManufacturer, &amp;theSize, theString);            if (theStatus) goto done;            // is it really me?            if (strncmp(theString, manufacturerString, strlen(manufacturerString)) == 0) {                // get device UID                theSize = sizeof(CFStringRef);                theStatus = AudioDeviceGetProperty(theDeviceList[theDeviceIndex],                                 0, 0, kAudioDevicePropertyDeviceUID, &amp;theSize, &amp;theCFString);                if (theStatus) goto done;                *outUID = theCFString;                break;            }        }    }    // we didn't find ourselves, that's bad!    if (NULL == *outUID) theStatus = badComponentType;done:    // free the device list    if (theDeviceList) free(theDeviceList);    return theStatus;}// QTVideoOutputGetIndSoundOutput//      Return the sound output component associated with the video output component// specified by the index parameter. The index of the first component should be 1.pascal ComponentResult MyVOut_GetIndSoundOutput(MyVOutGlobalsPtr storage,                                                 long index, Component *outputComponent){    Component            c = 0;    ComponentDescription cd = { kSoundOutputDeviceType, kHALCustomComponentSubType, 0, 0, 0 };    CFStringRef          myUID = NULL;    CFStringRef          halUID = NULL;    SMStatus             ignore;    ComponentResult      err;    *outputComponent = NULL;    // we only have one Sound Output Component so,    // if index is anything other than 1 it's an error    if (index != 1) return paramErr;    // already have it, we're done    if (storage-&gt;soundOutput) {        *outputComponent = storage-&gt;soundOutput;        return noErr;    }    // find our audio drivers UID using core audio    err = CopyMyAudioDriverUID(&amp;myUID);    if (err) goto bail;    // cheaply init the Sound Manager - must be done so the Sound Manager will    // synthesize Sound Output Components for each Core Audio Driver on the system    SndManagerStatus(sizeof(SMStatus), &amp;ignore);    // find our synthesized Sound Output Component    while (c = FindNextComponent(c, &amp;cd)) {        // don't release the returned CFString        err = SoundComponentGetInfo(c, 0, siHALAudioDeviceUniqueID, &amp;halUID);        if (err) goto bail;        // if it's us, we're done        if (CFEqual(myUID, halUID)) {            *outputComponent = c;            storage-&gt;soundOutput = c;            break;        }    }    // we didn't find the corresponding sDev, that's bad!    if (NULL == *outputComponent) err = badComponentType;bail:    if (myUID) CFRelease(myUID);    return err;}                </pre>               </TD>            </TR>            <TR>               <td align="left">                  <P><B>Listing 1</B>.</P>               </TD>            </TR>         </TABLE>         <BR>         </CENTER>                  <P><B>Note</B>: You must first initialize the Carbon Sound         Manager so it can register Sound Output Components for each         Core Audio driver on the system. An inexpensive way to         perform this initialization is to call         <CODE>SndManagerStatus</CODE> before any calls to         <CODE>SoundComponentGetInfo</CODE>.</P>                  <P>                  <hr width=500 align=center>                  </P>                  <!-- begin_date --><H4><CENTER>[Oct 29 2002]</CENTER></H4><!-- end_date -->      </TD>   </TR></TABLE></CENTER><P><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/qa/qa2001/qa1206.html%3Fid%3DDTS10001731-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/qa/qa2001/qa1206.html%3Fid%3DDTS10001731-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/qa/qa2001/qa1206.html%3Fid%3DDTS10001731-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></P></BODY></HTML>