<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>ISp SampleOld - /Source/MemoryHandler.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGames-date.html">Games</a> &gt; <A HREF="javascript:location.replace('index.html');">ISp SampleOld</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Games/index.html" target="_blank">Reference Library > Games</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">ISp SampleOld</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/MemoryHandler.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Resources/AppShell.r</option>
<option value="listing2.html">/Resources/ISp_Sample.r</option>
<option value="listing3.html">/Source/AboutBox.c</option>
<option value="listing4.html">/Source/AboutBox.h</option>
<option value="listing5.html">/Source/AppleEventHandler.c</option>
<option value="listing6.html">/Source/AppleEventHandler.h</option>
<option value="listing7.html">/Source/AppShellResources.h</option>
<option value="listing8.html">/Source/CModalDialog.cp</option>
<option value="listing9.html">/Source/CModalDialog.h</option>
<option value="listing10.html">/Source/ErrorAlert.c</option>
<option value="listing11.html">/Source/ErrorAlert.h</option>
<option value="listing12.html">/Source/EventHandler.cp</option>
<option value="listing13.html">/Source/EventHandler.h</option>
<option value="listing14.html">/Source/ISp_Sample.c</option>
<option value="listing15.html">/Source/ISp_Sample.h</option>
<option value="listing16.html">/Source/ISp_SampleResources.h</option>
<option value="listing17.html">/Source/main.c</option>
<option value="listing18.html">/Source/MainWindow.cp</option>
<option value="listing19.html">/Source/MainWindow.h</option>
<option value="listing20.html">/Source/MemoryHandler.c</option>
<option value="listing21.html">/Source/MemoryHandler.h</option>
<option value="listing22.html">/Source/MenuHandler.cp</option>
<option value="listing23.html">/Source/MenuHandler.h</option>
<option value="listing24.html">/Source/ShellWindow.cp</option>
<option value="listing25.html">/Source/ShellWindow.h</option>
<option value="listing26.html">/Source/ToolboxUtils.c</option>
<option value="listing27.html">/Source/ToolboxUtils.h</option></select>
				</p>
				</form>
				<p><strong><a href="ISp_SampleOld.zip">Download Sample</a></strong> (&#147;ISp_SampleOld.zip&#148;, 90.2K)<BR>
<strong><a href="ISp_SampleOld.dmg">Download Sample</a></strong> (&#147;ISp_SampleOld.dmg&#148;, 147.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    MemoryHandler.c  Contains:  xxx put contents here xxx  Version:  xxx put version here xxx  Copyright:  &copy; 1999 by Apple Computer, Inc., all rights reserved.  File Ownership:    DRI:        xxx put dri here xxx    Other Contact:    xxx put other contact here xxx    Technology:      xxx put technology here xxx  Writers:    (BWS)  Brent Schorsch  Change History (most recent first):     &lt;SP1&gt;    7/1/99  BWS    first checked in*//*  These memory routines are kinda handy and solve a lot of problems on the Mac when dealing  with memory.  For instance, people often call DisposeHandle() when they mean to call  ReleaseResource() and it screws up their resource chain.  DisposeHandleZ() checks to see  if the handle is locked or not, and whether it's a resource or not and takes the appropriate  action.    All functions ending in 'Z' take the ADDRESS of the Ptr/Handle and set it to nil when it  disposes of the memory.  This is handy because you can then do things like this:      foo = NewPtr();    DisposePtrZ(&amp;foo);      ...      ...          if (foo)      ...    Probably the most useful of all this stuff are the tagged Ptr and tagged Handle functions.  Basically what they do is add 12 bytes to the beginning of every block of memory that you  allocate.  The first four bytes are the value kBlockTag.  The second is an OSType that  you provide.  The 3rd group of four bytes is a refcon that you provide.  This is really  usefull when working with ZoneRanger or other memory watching tool because when you view  a block of memory you can see your type and refcon and get a clue as to what the memory  is.  It's really great when you have a memory leak and can't tell what's not getting  deallocated.  Another use is for tracking resources.  Pass in the resource type as the  OSType field and the resource number in the refcon.  Then in ZoneRanger you can see  exactly which resource and number a handle is.    Another use is for reference counting list of similar objects.  If you allocate 200 foos  then set the OSType to 'foo ' and make the refcon the index of which foo it is.  This is  helpful for finding off-by-one loop errors when deallocating lists and arrays.    One other thing that has come in really handy is to set the OSType to some identifier saying  which source file the block was allocated in and setting the refcon to the line number in  that source file.  That way in ZoneRanger you can tell exactly where that mystery block  came from.*///*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Includes#include &lt;Dialogs.h&gt;#include &lt;Resources.h&gt;#include &lt;Windows.h&gt;#include &lt;string.h&gt;#include &quot;MemoryHandler.h&quot;//*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Private Definitions#define kBlockTag          &quot;TBLK&quot;//*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Private Types//*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Private Variablesstatic UInt32  gAllocatedRam = 0U;//*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Private Functions//*  &Ntilde;&Ntilde;\xD1\xD1\xD1\xD1\xD1\xD1\xD1\xD1  Public Variables//*  &Ntilde;\xD1\xD1\xD1\xD1  IsResourceHandleBooleanIsResourceHandle(Handle theHandle){SInt8  memState;  memState = HGetState(theHandle);    //*  Check the resource bit in the handle info  if (memState &amp; 0x20)    return (true);      return (false);}//*  &Ntilde;\xD1\xD1\xD1\xD1  IsLockedHandleBooleanIsLockedHandle(Handle theHandle){SInt8  memState;  //*  Check the lock bit in the handle info  memState = HGetState(theHandle);    if (memState &amp; 0x80)    return (true);      return (false);}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeControlZvoidDisposeControlZ(ControlHandle *theControl){  if (! (**theControl))    return;  if (IsLockedHandle((Handle) *theControl))    HUnlock((Handle) *theControl);  DisposeControl(*theControl);  *theControl = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeWindowZvoidDisposeWindowZ(WindowPtr *theWindow){  if (nil == theWindow)    return;      if (nil == *theWindow)    return;  DisposeWindow(*theWindow);  *theWindow = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeDialogZvoidDisposeDialogZ(DialogPtr *theWindow){  if (! *theWindow)    return;  DisposeDialog(*theWindow);  *theWindow = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeGWorldZvoidDisposeGWorldZ(GWorldPtr *theGWorld){  if (! *theGWorld)    return;  if (IsLockedHandle((Handle) GetGWorldPixMap(*theGWorld)))    UnlockPixels(GetGWorldPixMap(*theGWorld));      DisposeGWorld(*theGWorld);  *theGWorld = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposePaletteZvoidDisposePaletteZ(PaletteHandle *thePal){  if (! *thePal)    return;  if (IsResourceHandle((Handle) *thePal))    ReleaseResource((Handle) *thePal);  else    DisposePalette(*thePal);      *thePal = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  KillPictureZvoidKillPictureZ(PicHandle *thePicture){  if (! (**thePicture))    return;  if (IsLockedHandle((Handle) *thePicture))    HUnlock((Handle) *thePicture);  if (IsResourceHandle((Handle) *thePicture))    ReleaseResource((Handle) *thePicture);  else    KillPicture(*thePicture);      *thePicture = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposePtrZvoidDisposePtrZ(Ptr *thePtr){  if (! *thePtr)    return;  DisposePtr(*thePtr);  *thePtr = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeHandleZvoidDisposeHandleZ(Handle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle(*theHandle))    HUnlock(*theHandle);      if (IsResourceHandle(*theHandle))    ReleaseResource(*theHandle);  else    DisposeHandle(*theHandle);      *theHandle = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  TEDisposeZvoidTEDisposeZ(TEHandle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle((Handle) *theHandle))    HUnlock((Handle) *theHandle);      if (IsResourceHandle((Handle) *theHandle))    ReleaseResource((Handle) *theHandle);  else    TEDispose(*theHandle);}//*  &Ntilde;\xD1\xD1\xD1\xD1  LDisposeZvoidLDisposeZ(ListHandle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle((Handle) *theHandle))    HUnlock((Handle) *theHandle);      if (IsResourceHandle((Handle) *theHandle))    ReleaseResource((Handle) *theHandle);  else    LDispose(*theHandle);}//*  &Ntilde;\xD1\xD1\xD1\xD1  PurgeAndCompactMemvoidPurgeAndCompactMem(){Size  growSize;  MaxMem(&amp;growSize);}//*  &Ntilde;\xD1\xD1\xD1\xD1  NewTaggedPtrPtrNewTaggedPtr(Size size, OSType tag, UInt32 refCon){Ptr  thePtr;  size += 12;  thePtr = NewPtr(size);  if (! thePtr)    return (nil);  BlockMoveData(kBlockTag, thePtr, 4);  BlockMoveData(&amp;tag, thePtr + 4, 4);  BlockMoveData(&amp;refCon, thePtr + 8, 4);  gAllocatedRam += size;  return (thePtr + 12);}//*  &Ntilde;\xD1\xD1\xD1\xD1  NewTaggedPtrClearPtrNewTaggedPtrClear(Size size, OSType tag, UInt32 refCon){Ptr  thePtr;  size += 12;  thePtr = NewPtrClear(size);  if (! thePtr)    return (nil);  BlockMoveData(kBlockTag, thePtr, 4);  BlockMoveData(&amp;tag, thePtr + 4, 4);  BlockMoveData(&amp;refCon, thePtr + 8, 4);  gAllocatedRam += size;  return (thePtr + 12);}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeTaggedPtrvoidDisposeTaggedPtr(Ptr thePtr){Ptr    ptr2;Size  size;  if (! thePtr)    return;  ptr2 = thePtr - 12;  size = GetPtrSize(ptr2);    //*  Confirm that this is one of our tagged blocks first  if (strncmp(kBlockTag, ptr2, 4) == 0)  {    DisposePtr(ptr2);    gAllocatedRam -= size;  }  else  {    DisposePtr(thePtr);  }}//*  &Ntilde;\xD1\xD1\xD1\xD1  DisposeTaggedPtrZvoidDisposeTaggedPtrZ(Ptr *thePtr){Ptr    ptr2;Size  size;  if (! *thePtr)    return;  ptr2 = (*thePtr) - 12;  size = GetPtrSize(ptr2);    if (strncmp(kBlockTag, ptr2, 4) == 0)  {    DisposePtr(ptr2);    gAllocatedRam -= size;  }  else  {    DisposePtr(*thePtr);  }      *thePtr = nil;}//*  &Ntilde;\xD1\xD1\xD1\xD1  GetAllocatedRamUInt32GetAllocatedRam(void){  return (gAllocatedRam);}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/ISp_SampleOld/listing20.html%3Fid%3DDTS10000056-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/ISp_SampleOld/listing20.html%3Fid%3DDTS10000056-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/ISp_SampleOld/listing20.html%3Fid%3DDTS10000056-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>