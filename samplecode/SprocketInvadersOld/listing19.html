<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>SprocketInvadersOld - /Source/MemoryHandler.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxGames-date.html">Games</a> &gt; <A HREF="javascript:location.replace('index.html');">SprocketInvadersOld</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Games/index.html" target="_blank">Reference Library > Games</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">SprocketInvadersOld</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Source/MemoryHandler.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/Resources/Art.r</option>
<option value="listing2.html">/Source/AboutBox.c</option>
<option value="listing3.html">/Source/AboutBox.h</option>
<option value="listing4.html">/Source/Blitter.c</option>
<option value="listing5.html">/Source/Blitter.h</option>
<option value="listing6.html">/Source/CD_Utils.c</option>
<option value="listing7.html">/Source/CD_Utils.h</option>
<option value="listing8.html">/Source/CommonStuff.c</option>
<option value="listing9.html">/Source/CommonStuff.h</option>
<option value="listing10.html">/Source/ErrorHandler.c</option>
<option value="listing11.html">/Source/ErrorHandler.h</option>
<option value="listing12.html">/Source/EventHandler.c</option>
<option value="listing13.html">/Source/EventHandler.h</option>
<option value="listing14.html">/Source/GameObject.c</option>
<option value="listing15.html">/Source/GameObject.h</option>
<option value="listing16.html">/Source/Graphics.c</option>
<option value="listing17.html">/Source/Graphics.h</option>
<option value="listing18.html">/Source/main.c</option>
<option value="listing19.html">/Source/MemoryHandler.c</option>
<option value="listing20.html">/Source/MemoryHandler.h</option>
<option value="listing21.html">/Source/MenuHandler.c</option>
<option value="listing22.html">/Source/MenuHandler.h</option>
<option value="listing23.html">/Source/MoviePlayback.c</option>
<option value="listing24.html">/Source/MoviePlayback.h</option>
<option value="listing25.html">/Source/NetSprocketSupport.c</option>
<option value="listing26.html">/Source/NetSprocketSupport.h</option>
<option value="listing27.html">/Source/ObjectActions.c</option>
<option value="listing28.html">/Source/ObjectActions.h</option>
<option value="listing29.html">/Source/Particles.c</option>
<option value="listing30.html">/Source/Particles.h</option>
<option value="listing31.html">/Source/SIResources.h</option>
<option value="listing32.html">/Source/SIâ€¢Prefix.h</option>
<option value="listing33.html">/Source/SoundHandler.c</option>
<option value="listing34.html">/Source/SoundHandler.h</option>
<option value="listing35.html">/Source/SpaceInvaders.c</option>
<option value="listing36.html">/Source/Sprite.c</option>
<option value="listing37.html">/Source/Sprite.h</option>
<option value="listing38.html">/Source/SprocketInvaders.c</option>
<option value="listing39.html">/Source/SprocketInvaders.h</option></select>
				</p>
				</form>
				<p><strong><a href="SprocketInvadersOld.zip">Download Sample</a></strong> (&#147;SprocketInvadersOld.zip&#148;, 178.4K)<BR>
<strong><a href="SprocketInvadersOld.dmg">Download Sample</a></strong> (&#147;SprocketInvadersOld.dmg&#148;, 235.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">//*  ------------------------------------------------------------------------------------------  *//*//*  Copyright &copy; 1996 Apple Computer, Inc., All Rights Reserved//*//*//*    You may incorporate this sample code into your applications without//*    restriction, though the sample code has been provided &quot;AS IS&quot; and the//*    responsibility for its operation is 100% yours.  However, what you are//*    not permitted to do is to redistribute the source as &quot;DSC Sample Code&quot;//*    after having made changes. If you're going to re-distribute the source,//*    we require that you make it clear in the source that the code was//*    descended from Apple Sample Code, but that you've made changes.//*//*    Authors://*      Chris De Salvo//*//*  ------------------------------------------------------------------------------------------  */*  These memory routines are kinda handy and solve a lot of problems on the Mac when dealing  with memory.  For instance, people often call DisposeHandle() when they mean to call  ReleaseResource() and it screws up their resource chain.  DisposeHandleZ() checks to see  if the handle is locked or not, and whether it's a resource or not and takes the appropriate  action.    All functions ending in 'Z' take the ADDRESS of the Ptr/Handle and set it to nil when it  disposes of the memory.  This is handy because you can then do things like this:      foo = NewPtr();    DisposePtrZ(&amp;foo);      ...      ...          if (foo)      ...    Probably the most useful of all this stuff are the tagged Ptr and tagged Handle functions.  Basically what they do is add 12 bytes to the beginning of every block of memory that you  allocate.  The first four bytes are the value kBlockTag.  The second is an OSType that  you provide.  The 3rd group of four bytes is a refcon that you provide.  This is really  usefull when working with ZoneRanger or other memory watching tool because when you view  a block of memory you can see your type and refcon and get a clue as to what the memory  is.  It's really great when you have a memory leak and can't tell what's not getting  deallocated.  Another use is for tracking resources.  Pass in the resource type as the  OSType field and the resource number in the refcon.  Then in ZoneRanger you can see  exactly which resource and number a handle is.    Another use is for reference counting list of similar objects.  If you allocate 200 foos  then set the OSType to 'foo ' and make the refcon the index of which foo it is.  This is  helpful for finding off-by-one loop errors when deallocating lists and arrays.    One other thing that has come in really handy is to set the OSType to some identifier saying  which source file the block was allocated in and setting the refcon to the line number in  that source file.  That way in ZoneRanger you can tell exactly where that mystery block  came from.*///*  ------------------------------  Includes#include &lt;Resources.h&gt;#include &lt;string.h&gt;#include &quot;MemoryHandler.h&quot;//*  ------------------------------  Private Definitions#define kBlockTag          &quot;TBLK&quot;//*  ------------------------------  Private Types//*  ------------------------------  Private Variables//*  ------------------------------  Private Functions//*  ------------------------------  Public Variables//*  --------------------  IsResourceHandleBooleanIsResourceHandle(Handle theHandle){SInt8  memState;  memState = HGetState(theHandle);    //*  Check the resource bit in the handle info  if (memState &amp; 0x20)    return (true);      return (false);}//*  --------------------  IsLockedHandleBooleanIsLockedHandle(Handle theHandle){SInt8  memState;  //*  Check the lock bit in the handle info  memState = HGetState(theHandle);    if (memState &amp; 0x80)    return (true);      return (false);}//*  --------------------  DisposeControlZvoidDisposeControlZ(ControlHandle *theControl){  if (! (**theControl))    return;  if (IsLockedHandle((Handle) *theControl))    HUnlock((Handle) *theControl);  DisposeControl(*theControl);  *theControl = nil;}//*  --------------------  DisposeWindowZvoidDisposeWindowZ(WindowRef *theWindow){  if (! *theWindow)    return;  DisposeWindow(*theWindow);  *theWindow = nil;}//*  --------------------  DisposeDialogZvoidDisposeDialogZ(DialogPtr *theWindow){  if (! *theWindow)    return;  DisposeDialog(*theWindow);  *theWindow = nil;}//*  --------------------  DisposeGWorldZvoidDisposeGWorldZ(GWorldPtr *theGWorld){  if (! *theGWorld)    return;  if (IsLockedHandle((Handle) GetGWorldPixMap(*theGWorld)))    UnlockPixels(GetGWorldPixMap(*theGWorld));      DisposeGWorld(*theGWorld);  *theGWorld = nil;}//*  --------------------  DisposePaletteZvoidDisposePaletteZ(PaletteHandle *thePal){  if (! *thePal)    return;  if (IsResourceHandle((Handle) *thePal))    ReleaseResource((Handle) *thePal);  else    DisposePalette(*thePal);      *thePal = nil;}//*  --------------------  KillPictureZvoidKillPictureZ(PicHandle *thePicture){  if (! (**thePicture))    return;  if (IsLockedHandle((Handle) *thePicture))    HUnlock((Handle) *thePicture);  if (IsResourceHandle((Handle) *thePicture))    ReleaseResource((Handle) *thePicture);  else    KillPicture(*thePicture);      *thePicture = nil;}//*  --------------------  DisposePtrZvoidDisposePtrZ(Ptr *thePtr){  if (! *thePtr)    return;  DisposePtr(*thePtr);  *thePtr = nil;}//*  --------------------  DisposeHandleZvoidDisposeHandleZ(Handle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle(*theHandle))    HUnlock(*theHandle);      if (IsResourceHandle(*theHandle))    ReleaseResource(*theHandle);  else    DisposeHandle(*theHandle);      *theHandle = nil;}//*  --------------------  TEDisposeZvoidTEDisposeZ(TEHandle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle((Handle) *theHandle))    HUnlock((Handle) *theHandle);      if (IsResourceHandle((Handle) *theHandle))    ReleaseResource((Handle) *theHandle);  else    TEDispose(*theHandle);}//*  --------------------  LDisposeZvoidLDisposeZ(ListHandle *theHandle){  if (! (**theHandle))    return;  if (IsLockedHandle((Handle) *theHandle))    HUnlock((Handle) *theHandle);      if (IsResourceHandle((Handle) *theHandle))    ReleaseResource((Handle) *theHandle);  else    LDispose(*theHandle);}//*  --------------------  PurgeAndCompactMemvoidPurgeAndCompactMem(){Size  growSize;  MaxMem(&amp;growSize);}//*  --------------------  NewTaggedPtrPtrNewTaggedPtr(Size size, OSType tag, UInt32 refCon){Ptr  thePtr;  size += 12;  thePtr = NewPtr(size);  if (! thePtr)    return (nil);  BlockMoveData(kBlockTag, thePtr, 4);  BlockMoveData(&amp;tag, thePtr + 4, 4);  BlockMoveData(&amp;refCon, thePtr + 8, 4);    return (thePtr + 12);}//*  --------------------  NewTaggedPtrClearPtrNewTaggedPtrClear(Size size, OSType tag, UInt32 refCon){Ptr  thePtr;  size += 12;  thePtr = NewPtrClear(size);  if (! thePtr)    return (nil);  BlockMoveData(kBlockTag, thePtr, 4);  BlockMoveData(&amp;tag, thePtr + 4, 4);  BlockMoveData(&amp;refCon, thePtr + 8, 4);    return (thePtr + 12);}//*  --------------------  DisposeTaggedPtrvoidDisposeTaggedPtr(Ptr thePtr){Ptr  ptr2;  if (! thePtr)    return;  ptr2 = thePtr - 12;    //*  Confirm that this is one of our tagged blocks first  if (strncmp(kBlockTag, ptr2, 4) == 0)    DisposePtr(ptr2);  else    DisposePtr(thePtr);}//*  --------------------  DisposeTaggedPtrZvoidDisposeTaggedPtrZ(Ptr *thePtr){Ptr  ptr2;  if (! *thePtr)    return;  ptr2 = (*thePtr) - 12;  if (strncmp(kBlockTag, ptr2, 4) == 0)    DisposePtr(ptr2);  else    DisposePtr(*thePtr);      *thePtr = nil;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/SprocketInvadersOld/listing19.html%3Fid%3DDTS10000061-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/SprocketInvadersOld/listing19.html%3Fid%3DDTS10000061-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/SprocketInvadersOld/listing19.html%3Fid%3DDTS10000061-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>