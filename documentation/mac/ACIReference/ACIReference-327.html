<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyCMMatchPixMap(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING327></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-326.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-328.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-314.html"><B>Chapter 4 - ColorSync Manager Reference for Color Management Modules</B></A> / <A HREF="ACIReference-322.html"><B>Optional CMM-Defined Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B></B></A> / <A HREF="ACIReference-317.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING327-0></A>
<H3><A NAME=MARKER-9-56></A>MyCMMatchPixMap</H3>
 Handles the <CODE>kCMMMatchPixMap</CODE> request by matching the colors of the specified pixel map image to the destination profile's color gamut.<P>
 A CMM should respond <A NAME=MARKER-2-57></A>to the <CODE>kCMMMatchPixMap</CODE> request code, but it is not required to do so. The ColorSync Manager sends this request code to your CMM on behalf of an application that called the <CODE>CWMatchPixMap</CODE> function or high-level QuickDraw operations. The ColorSync Manager dispatches this request to the Component Manager, which calls your CMM to service the request. A CMM typically responds to the <CODE>kCMMMatchPixMap</CODE> request code by calling a CMM-defined function (for example, <A NAME=MARKER-11-58></A><CODE>MyCMMatchPixMap</CODE>) to handle the request. <P>
 The MyCMMatchPixMap function is a color management module-defined subroutine.<P>
<PRE>
pascal CMError MyCMMatchPixMap(
ComponentInstance CMSession,
PixMap *myPixMap,
CMBitmapCallBackUPP progressProc,
void *refCon);
</PRE>
<DL>
<DT><CODE>CMsession</CODE>
<DD> A handle to your CMM's storage for the instance of your component associated with the calling application or device driver.
<DT><CODE>myPixMap</CODE>
<DD> A pointer to the pixel map to match. A pixel map is a QuickDraw structure describing pixel data. The pixel map is stored in nonrelocatable memory. Your function replaces the original colors of the pixel image with the matched colors corresponding to the color gamut of the destination device. 
<DT><CODE>progressProc</CODE>
<DD> A pointer to a callback function, supplied by the calling application or device driver, that monitors the color-matching progress or terminates the operation as your function matches the pixel map colors. Your <CODE>MyCMMatchPixMap</CODE> function must call this function at regular intervals to allow it to report progress to the user. 
<DT><CODE>refCon</CODE>
<DD> A reference constant passed from the calling application or driver, which your <CODE>MyCMMatchPixMap</CODE> function must pass through as a parameter to calls it makes to the <CODE>MyCMBitmapCallBackProc</CODE> function.
<DT><I>function result</I>
<DD> A result code of type CMError. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-172)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING327-10></A>
<H5>DISCUSSION</H5>
 If your CMM supports this request code, your <CODE>MyCMMatchPixMap</CODE> function should be prepared to receive any of the pixel map types defined by QuickDraw.Your <CODE>MyCMMatchPixMap</CODE> function must match the colors of the pixel map image pointed to by <CODE>myPixMap</CODE> parameter to the destination profile's color gamut, replacing the original pixel colors with their corresponding colors as specified in the data color space of the destination device's color gamut. <P>
 Before the Component Manager calls your CMM with a ColorSync request to match the colors of a pixel map, it calls your CMM with a <CODE>kNCMMInit</CODE> or <CODE>kCMMConcatInit</CODE> request. Your CMM sets up the destination profile information during initialization in response to the <CODE>kNCMMInit</CODE> or <CODE>kCMMConcatInit</CODE> request code. <P>
 When the Component Manager calls your CMM with the <CODE>kCMMMatchPixMap</CODE> request code, it passes to your CMM in the <CODE>session</CODE> parameter a handle to your CMM's private storage for the calling applications's component instance. Your <CODE>MyCMMatchPixMap</CODE> function should use the profile data you set in your storage for this component instance to perform the color matching. If you used some other method to store profile data for this component instance when you initialized the session, you should obtain the profile data you require for the color matching from that storage. <P>
 Your <CODE>MyCMMatchPixMap</CODE> function must call the progress function supplied by the calling application or device driver at regular intervals to allow it to report progress to the user on the color-matching session. Your <CODE>MyCMMatchPixMap</CODE> function should monitor the progress function for a returned value of <CODE>true</CODE>, which indicates that the user interrupted the color-matching process. In this case, you should terminate the color-matching process. The Apple-supplied CMM calls the progress function approximately every half-second, unless color matching takes less time; this happens when there is a small amount of data to match. <P>
 Here is the prototype for the <CODE>MyCMBitmapCallBackProc</CODE> function pointed to by the <CODE>progressProc</CODE> parameter:<P>
<PRE>
pascal Boolean MyCMBitmapCallBackProc (
                     long progress, 
                     void *refCon);
</PRE>
 Each time your <CODE>MyCMMatchPixMap</CODE> function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, it must pass to the function any data stored in the reference constant. When the Component Manager called your CMM with the <CODE>kCMMMatchPixMap</CODE> request code, it passed to your CMM the reference constant from the calling program. <P>
 Each time your function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, your function must pass it a byte count in the <CODE>progress</CODE> parameter identifying the remaining number of bytes. The last time your <CODE>MyCMMatchPixMap</CODE> function calls the <CODE>MyCMBitmapCallBackProc</CODE> function, it must pass a byte count of 0 to indicate the completion of the matching process, signaling the progress function to perform any cleanup operations it requires. <P>
 The data color space of a pixel map is implicitly RGB. If the source and destination profiles' data color spaces (<CODE>dataColorSpace</CODE> field) are not also RGB, your function should not perform the color matching. Instead, it should return an error. <P>
 If your CMM does not support a pixel map type that you receive, you can return an unimplemented error. In this case, the ColorSync Manager unpacks the colors of the pixel map and calls your <CODE>MyCMMatchColors</CODE> function, passing it the pixel map colors in a color list. You should avoid defaulting to this behavior, if possible, because it incurs overhead and slows down performance. <P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-326.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-328.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
