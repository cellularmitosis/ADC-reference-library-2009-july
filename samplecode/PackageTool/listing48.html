<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>PackageTool - /Sample Package/HTMLSample sources/SampleUtils.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">PackageTool</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">PackageTool</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/Sample Package/HTMLSample sources/SampleUtils.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/PackageTool.c</option>
<option value="listing2.html">/PackageTool.h</option>
<option value="listing3.html">/PackageTool.r</option>
<option value="listing4.html">/PackageUtils.c</option>
<option value="listing5.html">/PackageUtils.h</option>
<option value="listing6.html">/PackageWindow.c</option>
<option value="listing7.html">/PackageWindow.h</option>
<option value="listing8.html">/Sample Package/HTMLSample/HTMLSample Help/buttons.html</option>
<option value="listing9.html">/Sample Package/HTMLSample/HTMLSample Help/index.html</option>
<option value="listing10.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/display.html</option>
<option value="listing11.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/drawing.html</option>
<option value="listing12.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/generalroutines.html</option>
<option value="listing13.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/index.html</option>
<option value="listing14.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/intro.html</option>
<option value="listing15.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/types.html</option>
<option value="listing16.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/userdefined.html</option>
<option value="listing17.html">/Sample Package/HTMLSample/HTMLSample Pages/docs/utilities.html</option>
<option value="listing18.html">/Sample Package/HTMLSample/HTMLSample Pages/error.html</option>
<option value="listing19.html">/Sample Package/HTMLSample/HTMLSample Pages/index.html</option>
<option value="listing20.html">/Sample Package/HTMLSample Package Guide/index.html</option>
<option value="listing21.html">/Sample Package/HTMLSample Package Guide/tn1188/tn1188.html</option>
<option value="listing22.html">/Sample Package/HTMLSample sources/AboutBox.c</option>
<option value="listing23.html">/Sample Package/HTMLSample sources/AboutBox.h</option>
<option value="listing24.html">/Sample Package/HTMLSample sources/CIconButtons.c</option>
<option value="listing25.html">/Sample Package/HTMLSample sources/CIconButtons.h</option>
<option value="listing26.html">/Sample Package/HTMLSample sources/CWDefines.h</option>
<option value="listing27.html">/Sample Package/HTMLSample sources/debugf.c</option>
<option value="listing28.html">/Sample Package/HTMLSample sources/debugf.h</option>
<option value="listing29.html">/Sample Package/HTMLSample sources/History.c</option>
<option value="listing30.html">/Sample Package/HTMLSample sources/History.h</option>
<option value="listing31.html">/Sample Package/HTMLSample sources/HTMLSample Help/buttons.html</option>
<option value="listing32.html">/Sample Package/HTMLSample sources/HTMLSample Help/index.html</option>
<option value="listing33.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/display.html</option>
<option value="listing34.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/drawing.html</option>
<option value="listing35.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/generalroutines.html</option>
<option value="listing36.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/index.html</option>
<option value="listing37.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/intro.html</option>
<option value="listing38.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/types.html</option>
<option value="listing39.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/userdefined.html</option>
<option value="listing40.html">/Sample Package/HTMLSample sources/HTMLSample Pages/docs/utilities.html</option>
<option value="listing41.html">/Sample Package/HTMLSample sources/HTMLSample Pages/error.html</option>
<option value="listing42.html">/Sample Package/HTMLSample sources/HTMLSample Pages/index.html</option>
<option value="listing43.html">/Sample Package/HTMLSample sources/HTMLSample.c</option>
<option value="listing44.html">/Sample Package/HTMLSample sources/HTMLSample.h</option>
<option value="listing45.html">/Sample Package/HTMLSample sources/HTMLSample.r</option>
<option value="listing46.html">/Sample Package/HTMLSample sources/RenderingWindow.c</option>
<option value="listing47.html">/Sample Package/HTMLSample sources/RenderingWindow.h</option>
<option value="listing48.html">/Sample Package/HTMLSample sources/SampleUtils.c</option>
<option value="listing49.html">/Sample Package/HTMLSample sources/SampleUtils.h</option>
<option value="listing50.html">/SimplePrefs.c</option>
<option value="listing51.html">/SimplePrefs.h</option>
<option value="listing52.html">/Utilities.c</option>
<option value="listing53.html">/Utilities.h</option></select>
				</p>
				</form>
				<p><strong><a href="PackageTool.zip">Download Sample</a></strong> (&#147;PackageTool.zip&#148;, 631.7K)<BR>
<strong><a href="PackageTool.dmg">Download Sample</a></strong> (&#147;PackageTool.dmg&#148;, 919.8K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  file SampleUtils.c    Description:  This file contains a number of utility routines used by the  HTMLSampleApplication.  These routines have been moved  here to a separate file to simplify the example.    HTMLSample is an application illustrating how to use the new  HTMLRenderingLib services found in Mac OS 9. HTMLRenderingLib  is Apple's light-weight HTML rendering engine capable of  displaying HTML files.  by John Montbriand, 1999.  Copyright: &copy; 1999 by Apple Computer, Inc.  All rights reserved.    Disclaimer:  You may incorporate this sample code into your applications without  restriction, though the sample code has been provided &quot;AS IS&quot; and the  responsibility for its operation is 100% yours.  However, what you are  not permitted to do is to redistribute the source as &quot;DSC Sample Code&quot;  after having made changes. If you're going to re-distribute the source,  we require that you make it clear in the source that the code was  descended from Apple Sample Code, but that you've made changes.    Change History (most recent first):  10/16/99 created by John Montbriand*/#include &quot;SampleUtils.h&quot;#include &lt;Processes.h&gt;#include &lt;string.h&gt;#include &lt;QuickDraw.h&gt;#include &lt;Gestalt.h&gt;#include &lt;Palettes.h&gt;#include &lt;Resources.h&gt;#include &lt;TextUtils.h&gt;#include &lt;HTMLRendering.h&gt;/* SUstrlen Sample Utilities strlen.  Here so we don't have to link  with the standard C libraries. */long SUstrlen(char const* stt) {  long count;  char const* rover;  for (count = 0, rover = stt; *rover; rover++, count++)    /* empty loop */;  return count;}/* SUstrcmp Sample Utilities strcmp.  Here so we don't have to link  with the standard C libraries. */long SUstrcmp(char const* a, char const* b) {  long res;  char const *aa, *bb;  aa = a;  bb = b;  while (*aa &amp;&amp; *bb)    if ((res = (*aa++ - *bb++)) != 0)      return res;  return (*aa - *bb);}/* SetWindowStandardStateSize sets the window's standard state rectangle  to a rectangle of the size suggested in the width and height parameters.  In the end, it may set the standard size to something smaller than the  width and height parameters so the entire window remains visible.  The  standard rectangle is also centered on the main screen.  The window's  standard state rectangle is used by ZoomWindow whenever when it  is called with the inZoomOut partcode. */void SetWindowStandardStateSize(WindowPtr window, short width, short height) {  Rect standard, stdRect, global, device, c, s, diffs;  RgnHandle tempRgn;  GDHandle theDevice;  CGrafPtr wport;  Point origin;    /* make the window's port the current port */  wport = GetWindowPort(window);  SetPort(wport);  SetPt(&amp;origin, 0, 0);  LocalToGlobal(&amp;origin);    /* find the window's global coordinates */  GetPortBounds(wport, &amp;global);  OffsetRect(&amp;global, origin.h, origin.v);    /* get the maximum intersecting screen */  theDevice = GetMaxDevice(&amp;global);  device = (**theDevice).gdRect;    /* if it's the main screen, adjust it for the menu bar height */  if (theDevice == GetMainDevice())    device.top += GetMBarHeight();    /* calculate the difference between the window's content rectangle and its frame */  tempRgn = NewRgn();  GetWindowRegion(window, kWindowContentRgn, tempRgn);  GetRegionBounds(tempRgn, &amp;c);  GetWindowRegion(window, kWindowStructureRgn, tempRgn);  GetRegionBounds(tempRgn, &amp;s);  DisposeRgn(tempRgn);  SetRect(&amp;diffs, c.left - s.left + 2, c.top - s.top + 2, s.right - c.right + 2, s.bottom - c.bottom + 2);    /* calculate the maximum bounds for the standard rectangle */  SetRect(&amp;standard, device.left + diffs.left, device.top + diffs.top, device.right - diffs.right, device.bottom - diffs.bottom);    /* set up our 'desired' rectangle */  SetRect(&amp;stdRect, 0, 0, width, height);  OffsetRect(&amp;stdRect, standard.left, standard.top);    /* fit it inside of the maximum allowable rectangle */  SectRect(&amp;stdRect, &amp;standard, &amp;stdRect);    /* center it in the maximum allowable rectangle */  OffsetRect(&amp;stdRect, (standard.right - stdRect.right)/2, (standard.bottom - stdRect.bottom)/2);    /* set the standard state rectangle */  SetWindowStandardState(window, &amp;stdRect);}/* GetApplicationFolder returns a URL referring to the folder  containing the application.  If successful, *url is set  to a new handle containing the URL.  It is the caller's  responsibility to dispose of this handle. */OSStatus GetApplicationFolderURL(Handle *url) {  OSStatus err;  FSSpec spec;  Handle theURL;    /* set up locals to a known state */  theURL = NULL;    /* find the application's folder */   err = GetApplicationFolder(&amp;spec);  if (err != noErr) goto bail;    /* create a new handle for storing the URL */  theURL = NewHandle(0);  if (theURL == NULL) { err = memFullErr; goto bail; }    /* ask the HTML rendering library to convert    the FSSpec into a URL */  err = HRUtilGetURLFromFSSpec(&amp;spec, theURL);  if (err != noErr) goto bail;      /* add a slash at the end of the name, if one is not there */  if ( (*theURL)[GetHandleSize(theURL) - 1] != '/')    Munger(theURL, (GetHandleSize(theURL) - 1), NULL, 0, &quot;/&quot;, 1);    /* return the URL */  *url = theURL;  return noErr;bail:  if (theURL != NULL) DisposeHandle(theURL);  return err;}/* GetApplicationFolder returns the volume reference number and  directory id of the folder containing the application. */OSStatus GetApplicationFolder(FSSpec *spec) {  OSStatus err;  FCBPBRec fcpb;  Str255 name;  CInfoPBRec cat;  Handle h;    h = GetResource('vTeZ', 0);  if (h == NULL) return resNotFound;    BlockZero(&amp;fcpb, 0);  fcpb.ioVRefNum = 0;  fcpb.ioNamePtr = name;  fcpb.ioFCBParID = 0;  fcpb.ioRefNum = HomeResFile(h);  fcpb.ioFCBIndx = 0;  if ((err = PBGetFCBInfoSync(&amp;fcpb)) != noErr) return err;    BlockZero(&amp;cat, 0);  cat.dirInfo.ioNamePtr = name;  cat.dirInfo.ioVRefNum = fcpb.ioFCBVRefNum;  cat.dirInfo.ioFDirIndex = -1;  cat.dirInfo.ioDrDirID = fcpb.ioFCBParID;  err = PBGetCatInfoSync(&amp;cat);  if (err != noErr) return err;    err = FSMakeFSSpec(fcpb.ioFCBVRefNum, cat.dirInfo.ioDrParID, name, spec);  if (err != noErr) return err;    return noErr;}/* DrawGrowIconWithoutScrollLines draws the grow icon in the bottom  right corner of the frontmost window without drawing the scroll bar  lines.  It does this by setting the clip region to the bottom right corner  before calling DrawGrowIcon. */void DrawGrowIconWithoutScrollLines(WindowPtr window) {  RgnHandle clip;  CGrafPtr wport;  Rect r = { 0, 0, 16, 16 }, pbox;    /* set the window to the current port */  wport = GetWindowPort(window);  SetPort(wport);  GetPortBounds(wport, &amp;pbox);    /* save the old clipping region */  clip = NewRgn();  if (clip == NULL) return;  GetClip(clip);    /* set the clipping region to the bottom right corner of the window */  OffsetRect(&amp;r, pbox.right-15, pbox.bottom-15);  ClipRect(&amp;r);    /* draw the grow icon */  DrawGrowIcon(window);  SetPort(wport);  SetClip(clip);  DisposeRgn(clip);}/* GrayOutBox grays out an area of the screen in the current grafport.    *theBox is in local coordinates in the current grafport. This routine  is for direct screen drawing only.  */void GrayOutBox(Rect *theBox) {  long response;  Rect globalBox;  GDHandle maxDevice;  RGBColor rgbWhite = {0xFFFF, 0xFFFF, 0xFFFF}, rgbBlack = {0, 0, 0}, sForground, sBackground;  PenState penSave;  Pattern qdgray, qdblack;    /* save the current drawing state */  GetPenState(&amp;penSave);    /* if no color quickdraw, fail...*/  if (Gestalt(gestaltQuickdrawVersion, &amp;response) != noErr) response = 0;  if (response &gt;= gestalt8BitQD) {      /* get the device for the rectangle */    globalBox = *theBox;    LocalToGlobal((Point*) &amp;globalBox.top);    LocalToGlobal((Point*) &amp;globalBox.bottom);    maxDevice = GetMaxDevice(&amp;globalBox);    if (maxDevice != NULL) {        /* calculate the best gray */      if ( GetGray(maxDevice, &amp;rgbWhite, &amp;rgbBlack)) {          /* draw over the area in gray using addMax transfer mode */        GetForeColor(&amp;sForground);        GetBackColor(&amp;sBackground);        RGBForeColor(&amp;rgbBlack);        RGBBackColor(&amp;rgbWhite);        PenMode(addMax);        PenPat(GetQDGlobalsBlack(&amp;qdblack));        PaintRect(theBox);        RGBForeColor(&amp;sForground);        RGBBackColor(&amp;sBackground);          /* restore the pen state and leave */        SetPenState(&amp;penSave);        return;      }    }  }    /* fall through to using the gray pattern */  GetQDGlobalsGray(&amp;qdgray);  PenPat(&amp;qdgray);  PenMode(notPatBic);  PaintRect(theBox);  SetPenState(&amp;penSave);}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/PackageTool/listing48.html%3Fid%3DDTS10000599-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/PackageTool/listing48.html%3Fid%3DDTS10000599-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/PackageTool/listing48.html%3Fid%3DDTS10000599-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>