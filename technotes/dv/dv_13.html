<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><!--Includes revisions to code listings--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note DV13: _PBClose the Barn Door</title><meta name="keywords" content="Mac OS 8 device drivers _PBClose routine A/UX interrupts"><meta name="Description" content="Technical Note DV13: This Technical Note discusses the needfor Macintosh device drivers to implement _PBClose. Thisis very important when the operating system goes away, whichoccurs with A/UX. Therefore Technical Note demonstrates whya driver needs to have a close routine and what should bein that close routine when the A/UX Startup application issuesa PBClose call.">                                       <meta name="categories" content="Devices"><meta name="week-posted" content="May 28, 1990 - Jun 1, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002403" title="_PBClose the Barn Door"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Darwin/idxHardwareDrivers-date.html" target="_blank">Darwin > Hardware & Drivers</a></li>
		<li><a href="../../referencelibrary/HardwareDrivers/idxAccessibility-date.html" target="_blank">Hardware & Drivers > Accessibility</a></li>
		<li><a href="../../referencelibrary/HardwareDrivers/idxSCSI-date.html" target="_blank">Hardware & Drivers > SCSI</a></li>
		<li><a href="../../referencelibrary/HardwareDrivers/idxMassStorageDevices-date.html" target="_blank">Hardware & Drivers > Storage</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note DV13</div>
<div id="pageheadsub">_PBClose the Barn Door</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Section1">Introduction</a><BR><BR><a href="#Section2">Transformations</a><BR><BR><a href="#references">References</a><BR><BR><A href="#downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>		<td width=300 valign="top" align=left>	<!-- begin_intro_text --><P id = "introtext">This Technical Note discusses the need for Macintosh device drivers toimplement <code>_PBClose</code>.</p><!-- end_intro_text --><!-- begin_date --><h3>Updated: [June 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content --><a name="Section1"></a><h2>Introduction</h2><p>You may get the idea when implementing device drivers that <code>_PBClose</code> issuperfluous.  After all, if you have a resident driver for a NuBus(TM) videoboard, the only time your driver is not needed is if the operating system isgoing away.  It might seem that nothing important can happen after theoperating system goes away, so why bother with <code>_PBClose</code>?  Well, itturns out a lot can happen, and this Note tells you why it is important toimplement a <code>Close</code> (<code>_PBClose</code>) routine.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>Transformations</h2><p>The problem with your driver not being needed when the operating system isgoing away is that there is more than one way for the operating system to goaway.  Besides the user choosing Restart or Shutdown from the Special menu, itis possible for the Macintosh operating system to be transformed into anentirely new operating system.  This is exactly what happens when A/UX starts.</p><p>The A/UX Startup application (Sash in the pre-A/UX 2.0 days) attempts to shutdown the Macintosh operating system as much as possible, including closing alldrivers, loading A/UX, and starting it running.  It does not perform a<code>RESET</code>, so if you have not disabled interrupts in your <code>Close</code>routine, A/UX may get up and running and find itself receiving interrupts for aboard about which it knows nothing--a situation which makes it very unhappy.</p><p>In summary, A/UX Startup issues a <code>_PBClose</code> call to your driver, soyour driver <b>must</b> implement a <code>Close</code> routine and it <b>must</b>accomplish the following (even if you never intend to support your board under A/UX):</p><ul type="circle">	<li>Disable all interrupts for your device.<br><br></li>	<li>Remove your interrupt handler, replacing any changed interrupt vectors.<br><br></li>	<li>Release any private data storage held by your driver.<br><br></li></ul><P><A HREF="#top">Back to top</A></P><a name="references"></a><h2>References</h2><P><i>Inside Macintosh</i>, Volumes II, IV, &amp; V, The Device Manager</p><P><i>Designing Cards and Drivers for the Macintosh Family</i>, Second Edition</p><p>NuBus is a trademark of Texas Instruments.</p><P><A HREF="#top">Back to top</A></P>         <a name="downloads"></a>         <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center>                                    <img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (36K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/dv_13.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/dv/dv_13.html%3Fid%3DDTS10002403-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/dv/dv_13.html%3Fid%3DDTS10002403-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/dv/dv_13.html%3Fid%3DDTS10002403-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML>