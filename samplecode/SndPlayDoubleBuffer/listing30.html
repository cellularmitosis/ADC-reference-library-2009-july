<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>SndPlayDoubleBuffer - /_source/WAVE.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">SndPlayDoubleBuffer</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">SndPlayDoubleBuffer</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/_source/WAVE.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/_headers/DBFF.h</option>
<option value="listing2.html">/_headers/DBFF_Errors.h</option>
<option value="listing3.html">/_headers/Defines.h</option>
<option value="listing4.html">/_headers/DoubleBufferFromFile.h</option>
<option value="listing5.html">/_headers/Interrupt_Routines.h</option>
<option value="listing6.html">/_headers/LDandFix.h</option>
<option value="listing7.html">/_headers/MungeBuffer.h</option>
<option value="listing8.html">/_headers/MyAIFF.h</option>
<option value="listing9.html">/_headers/MyGestalt.h</option>
<option value="listing10.html">/_headers/Private_DBFFFunctions.h</option>
<option value="listing11.html">/_headers/ReadResource.h</option>
<option value="listing12.html">/_headers/SetupDBHeader.h</option>
<option value="listing13.html">/_headers/SimpleApp_Sound.h</option>
<option value="listing14.html">/_headers/SND.h</option>
<option value="listing15.html">/_headers/SoundStruct.h</option>
<option value="listing16.html">/_headers/ULAW.h</option>
<option value="listing17.html">/_headers/WAVE.h</option>
<option value="listing18.html">/_source/AIFF.c</option>
<option value="listing19.html">/_source/DoubleBufferFromFile.c</option>
<option value="listing20.html">/_source/Interrupt_Routines.c</option>
<option value="listing21.html">/_source/LDandFix.c</option>
<option value="listing22.html">/_source/MungeBuffer.c</option>
<option value="listing23.html">/_source/MyGestalt.c</option>
<option value="listing24.html">/_source/Private_DBFFFunctions.c</option>
<option value="listing25.html">/_source/ReadResource.c</option>
<option value="listing26.html">/_source/SetupDBHeader.c</option>
<option value="listing27.html">/_source/SimpleApp_Sound.c</option>
<option value="listing28.html">/_source/SND.c</option>
<option value="listing29.html">/_source/ULAW.c</option>
<option value="listing30.html">/_source/WAVE.c</option>
<option value="listing31.html">/SAL Æ’/SAL_Public.h</option></select>
				</p>
				</form>
				<p><strong><a href="SndPlayDoubleBuffer.zip">Download Sample</a></strong> (&#147;SndPlayDoubleBuffer.zip&#148;, 185.7K)<BR>
<strong><a href="SndPlayDoubleBuffer.dmg">Download Sample</a></strong> (&#147;SndPlayDoubleBuffer.dmg&#148;, 253.5K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    WAVE.c  Contains:  Routines demonstrating how to parse Microsoft's WAVE sound files.  Written by: Mark Cookson    Copyright:  Copyright &copy;1996-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        8/31/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        */#include &quot;WAVE.h&quot;/* Please note that this code was written in less than 6 hours, does very little error checking   and probably will not work for all files.  I have tested it with the WAVE files at my   disposal and it worked with them.  Your milage may vary.   I do know that it will probably be impossible to get the Mac's IMA decompressor to   decompress IMA (and ADPCM) compressed WAVE files because the Mac's IMA has a different   file format from the WAVE file and the decompressor cannot correctly decompress WAVE files.   The Mac IMA compressed file has predictor bytes in the data stream that the WAVE files   do not have.*//* Given an WAVE File gets the sample rate and other relavent pieces of information.   This has been modified from its orignal form found in the Develop 11 MultiBuffer source. *//*-----------------------------------------------------------------------*/    OSErr  ASoundGetWAVEHeader    (SoundInfoPtr theSoundInfo,                    long *dataStart,                    long *length)/*-----------------------------------------------------------------------*/{  WAVETemplatePtr      WAVETemplate;          /* ...for ease of access */  long          filePosition    = kInit,              byteCount      = kInit;  short          format        = kInit;  unsigned short      chunkFlags      = kInit;  /* remember chunks we've seen */  OSErr          err          = noErr;  char          chunkBuffer[kWAVEChunkBufferSize];  *dataStart = kInit;  /*  Now for the fun part!  We're going to assume that these are generic, non-compressed      WAVE files and parse accordingly... */  do {    /*  Position ourselves at the beginning of the next chunk and read in      a hunk-o-data... */    err = SetFPos (theSoundInfo-&gt;refNum, fsFromStart, filePosition);    if (err != noErr) {      DebugPrint (&quot;\pSetFPos failed!&quot;);      break;    }    byteCount = kWAVEChunkBufferSize;    err = FSRead (theSoundInfo-&gt;refNum, &amp;byteCount, chunkBuffer);                        /* read a chunk */    if ((err != noErr) &amp;&amp; (err != eofErr)) {      DebugPrint (&quot;\pFSRead failed!&quot;);      break;    }    /*  Now, position the template over the data... */    WAVETemplate = (WAVETemplatePtr) chunkBuffer;    /* assume a failure and break out of the do {} while loop if the next case isn't found.       if the case is found and no other error is detected, then each case needs to set noErr */    err = kBadWAVEFileFormat;                    switch (WAVETemplate-&gt;generic.ckID) {      case WAVEFORMID:        chunkFlags |= kWAVEFORMID;                                /* otherwise mark it found */        filePosition += 12;        err = noErr;        break;      case FormatID:        chunkFlags |= kFormatID;                                /* otherwise mark it found */        format = SwapShort (WAVETemplate-&gt;fmt.wFormatTag);        theSoundInfo-&gt;needsMasking = false;        switch (format) {          case WAVE_FORMAT_PCM:            err = SetupDBHeader (theSoundInfo,                      SwapLong (WAVETemplate-&gt;fmt.dwSamplesPerSec),                      ((SwapShort (WAVETemplate-&gt;fmt.wBlockAlign) / SwapShort (WAVETemplate-&gt;fmt.wChannels)) * 8),                      SwapShort (WAVETemplate-&gt;fmt.wChannels),                      notCompressed,                      NoneType);            break;          case WAVE_FORMAT_MULAW:          case IBM_FORMAT_MULAW:            err = SetupDBHeader (theSoundInfo,                      SwapLong (WAVETemplate-&gt;fmt.dwSamplesPerSec),                      ((SwapShort (WAVETemplate-&gt;fmt.wBlockAlign) / SwapShort (WAVETemplate-&gt;fmt.wChannels)) * 8),                      SwapShort (WAVETemplate-&gt;fmt.wChannels),                      fixedCompression,                      kULawCompression);            filePosition += 2;  /* This is here because the only &micro;law compressed file I ever saw needed it. */            break;          default:            DebugPrint (&quot;\pCan't deal with this file format&quot;);            err = kUnknownFormat;            break;        }        filePosition += 24;        break;      case WAVEDataID:        chunkFlags |= kWAVEDataID;        *length = ReverseLong (WAVETemplate-&gt;waveData.ckSize);        filePosition += 8;        *dataStart = filePosition;        err = noErr;        break;      /* We don't care about any of these, and my handling of them is probably not correct */      case WAVEID:        err = noErr;        filePosition += 4;        break;      case WAVEListID:        err = noErr;        filePosition += 4;        break;      case SilenceID:        err = noErr;        filePosition += 4;        break;      case CueID:        err = noErr;        filePosition += 24;        break;      case FactID:        err = noErr;        filePosition += 4;        break;      case PlaylistID:        err = noErr;        filePosition += 12;        break;      case AssocDataID:        err = noErr;        filePosition += 32;        break;      case LabelID:        err = noErr;        filePosition += 4;        break;      case NoteID:        err = noErr;        filePosition += 4;        break;      case TextWithLenID:        err = noErr;        filePosition += 16;        break;      case EmbededFileID:        err = noErr;        filePosition += 8;        break;      default:        //DebugPrint (&quot;\pSaw a field we didn't know about, this doesn't have to be bad&quot;);        /* Start walking through the file looking for an ID we know about.           This could get ugly, but what the heck... */        filePosition += 1;        err = noErr;        break;    }  } while (stillMoreDataWAVEToRead);  if (err != noErr) {    DebugPrint (&quot;\pError in ASoundGetWAVEHeader&quot;);  }  return err;}/* These are here for the endian conversion required to parse the header.   The endian conversion used when playing a WAVE file is much better, don't worry. */short SwapShort (const short theShort) {  char  tempChar  = kInit;  short  newShort  = kInit;  tempChar = ((char *)&amp;theShort)[0];  ((char *)&amp;newShort)[0] = ((char *)&amp;theShort)[1];  ((char *)&amp;newShort)[1] = tempChar;  return newShort;}long SwapLong (const long theLong) {  short  tempShort  = kInit;  long  newLong    = kInit;  tempShort = SwapShort (((short *)&amp;theLong)[0]);  ((short *)&amp;newLong)[0] = tempShort;  tempShort = SwapShort (((short *)&amp;theLong)[1]);  ((short *)&amp;newLong)[1] = tempShort;  return newLong;}long ReverseLong (const long theLong) {  char  tempChar  = kInit,      i      = kInit;  long  newLong    = kInit;  for (i = nil; i &lt; 2; i++) {    tempChar = ((char *)&amp;theLong)[i];    ((char *)&amp;newLong)[i] = ((char *)&amp;theLong)[3-i];    ((char *)&amp;newLong)[3-i] = tempChar;  }  return newLong;}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/SndPlayDoubleBuffer/listing30.html%3Fid%3DDTS10000371-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/SndPlayDoubleBuffer/listing30.html%3Fid%3DDTS10000371-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/SndPlayDoubleBuffer/listing30.html%3Fid%3DDTS10000371-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>