<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Sherlock Channels (Legacy): Trigger Examples</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Trigger Examples"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001090" title="Trigger Examples"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../../LegacyTechnologies/InternetWeb-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000526" target="_top">Internet &amp; Web</a> &gt; <a href="../index.html" target="_top">Sherlock Channels (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CreatingWebServices.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
Sherlock is unsupported in Mac OS X v10.5 and later.</p></div></div></div>
        <a name="//apple_ref/doc/uid/20001090-SW1" title="Trigger Examples"></a><hr /><H1><a name="//apple_ref/doc/uid/20001090-BCIIDJDC" title="Trigger Examples"></a>Trigger Examples</H1><p>This article includes some sample triggers from the Yellow Pages channel that comes with Sherlock. These examples use a combination of JavaScript and XQuery code to perform searches for the user. </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="TriggerExamples.html#//apple_ref/doc/uid/20001090-111228">Initiating a Search Using a URL</a>
				
			<br/>
			
        
			
			
				<a href="TriggerExamples.html#//apple_ref/doc/uid/20001090-111147">Initiating a Search From a Button Click</a>
				
			<br/>
			
        
			
			
				<a href="TriggerExamples.html#//apple_ref/doc/uid/20001090-113343">Opening a New Channel From a Trigger</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/20001090-111228" title="Initiating a Search Using a URL"></a><h2>Initiating a Search Using a URL</h2><p>The following example shows some code from the Yellow Pages channel that handles URL-based search requests. If the user clicks a Sherlock link in an HTML browser, the browser sends the URL text to Sherlock for processing. By the time a URL reaches a specific trigger, Sherlock has parsed the URL text and determined which trigger to call. </p><p>In this example, the trigger responds to the path <code>URL.complete</code>, which Sherlock calls after it has parsed the URL attributes. The trigger expects the URL request to contain some other attributes and values, in this case a query string and either a <code>zip</code> attribute or a <code>city</code> and <code>state</code> attribute. It populates the data store with these values and then initiates the query. Because the same data store fields are used to store values entered into the controls of the channel’s interface by the user, the behavior is the same as if the user had entered the values and clicked the search button.</p><div class="codesample"><table><tr><td scope="row"><pre> &lt;trigger language="JavaScript" path="URL.complete"><span></span></pre></td></tr><tr><td scope="row"><pre>/* this trigger handles sherlock url query */<span></span></pre></td></tr><tr><td scope="row"><pre>query = DataStore.Get("URL.query");<span></span></pre></td></tr><tr><td scope="row"><pre>DataStore.Set("YellowPages.MainQueryField.objectValue", query);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>zip = DataStore.Get("URL.zip");<span></span></pre></td></tr><tr><td scope="row"><pre>if (zip)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    DataStore.Set("YellowPages.CityStateZipField.objectValue", zip);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    city = DataStore.Get("URL.city");<span></span></pre></td></tr><tr><td scope="row"><pre>    state = DataStore.Get("URL.state");<span></span></pre></td></tr><tr><td scope="row"><pre>    if (city != null &amp;amp;&amp;amp; state != null)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        cityAndState = city + ", " + state;<span></span></pre></td></tr><tr><td scope="row"><pre>        DataStore.Set("YellowPages.CityStateZipField.objectValue",<span></span></pre></td></tr><tr><td scope="row"><pre>                cityAndState);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>DataStore.Notify("YellowPages.SearchButton.action");<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/20001090-111147" title="Initiating a Search From a Button Click"></a><h2>Initiating a Search From a Button Click</h2><p>The following example shows how the Yellow Pages channel responds to the user clicking the search button from the channel interface. The code for initiating a search from a URL click also calls this code to begin the search. </p><p>The following two triggers show the initial search setup. In the first trigger, clicking the button sends a new notification to perform the actual setup. The second trigger uses XQuery code to return a dictionary of paths and values. Upon return from the second trigger, Sherlock assigns each value to the path specified by its key, generating appropriate notifications for each assignment. </p><div class="codesample"><table><tr><td scope="row"><pre> &lt;trigger language="JavaScript" path="YellowPages.SearchButton.action"><span></span></pre></td></tr><tr><td scope="row"><pre>DataStore.Notify("YellowPages.action.yellowPagesSearchSetUp");<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;trigger language="XQuery" path="YellowPages.action.yellowPagesSearchSetUp"<span></span></pre></td></tr><tr><td scope="row"><pre>            notify="YellowPages.action.yellowPagesSearch"><span></span></pre></td></tr><tr><td scope="row"><pre>dictionary(<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.dataValue", ()),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.selectedRows", -1),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.NetworkArrows.animating", true())<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr></table></div><p>Once the search parameters are set up, the final notification sent from the <code>yellowPagesSearchSetup</code> trigger is to the <code>YellowPages.action.yellowPagesSearch</code> path to perform the search. The trigger that responds to this path is shown in the following code listing. The <code>yellowPagesSearch</code> trigger performs the search using the web service <code>YellowPagesSearch</code> and puts a subset of the results in the channel’s results table. It then sets several other properties, storing old search data and keeping track of the current location in the search result set. The <code>yellowPagesSearchComplete</code> trigger performs some late housekeeping tasks to indicate to the user that the search is complete. </p><div class="codesample"><table><tr><td scope="row"><pre> &lt;trigger language="XQuery" path="YellowPages.action.yellowPagesSearch"<span></span></pre></td></tr><tr><td scope="row"><pre>            inputs="csz=YellowPages.CityStateZipField.objectValue,<span></span></pre></td></tr><tr><td scope="row"><pre>            query=YellowPages.MainQueryField.objectValue,<span></span></pre></td></tr><tr><td scope="row"><pre>            lastCsz=YellowPages.data.lastCityStateZip,<span></span></pre></td></tr><tr><td scope="row"><pre>            lastQuery=YellowPages.data.lastQuery,<span></span></pre></td></tr><tr><td scope="row"><pre>            moreString=YellowPages.clickAgainString,<span></span></pre></td></tr><tr><td scope="row"><pre>            attemptNum=YellowPages.data.attemptNumber,<span></span></pre></td></tr><tr><td scope="row"><pre>            lastResults=YellowPages.data.lastResults"><span></span></pre></td></tr><tr><td scope="row"><pre>let $attemptNum := if (not($attemptNum)) then 0 else $attemptNum<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>let $newQuery := if (($query != $lastQuery) or ($csz != $lastCsz) or<span></span></pre></td></tr><tr><td scope="row"><pre>            ($attemptNum = 0)) then 1 else 0<span></span></pre></td></tr><tr><td scope="row"><pre>let $cityStateZip := string-replace($csz, "/", ", ")<span></span></pre></td></tr><tr><td scope="row"><pre>let $resultsToSave := if ($newQuery) then YellowPagesSearch($cityStateZip,<span></span></pre></td></tr><tr><td scope="row"><pre>            $query) else $lastResults<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>let $resultsCount := count($resultsToSave)<span></span></pre></td></tr><tr><td scope="row"><pre>let $newResultsStart := 1+($attemptNum * 10)<span></span></pre></td></tr><tr><td scope="row"><pre>let $resultsEndMax := $newResultsStart + 9<span></span></pre></td></tr><tr><td scope="row"><pre>let $resultsEnd := if ($resultsCount &amp;lt; $resultsEndMax) then $resultsCount<span></span></pre></td></tr><tr><td scope="row"><pre>            else $resultsEndMax<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>let $resultsToShow := sublist($resultsToSave, 1, $resultsEnd)<span></span></pre></td></tr><tr><td scope="row"><pre>let $moreResults := if ($resultsCount &amp;gt; $resultsEnd) then 1 else 0<span></span></pre></td></tr><tr><td scope="row"><pre>let $labelText := if ($moreResults) then $moreString else " "<span></span></pre></td></tr><tr><td scope="row"><pre>let $attempt := if ($moreResults) then $attemptNum+1 else 0<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>return dictionary(<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.dataValue", $resultsToShow),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.lastResults", $resultsToSave),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.action.yellowPagesSearchComplete", unique-id()),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.highlightedColumn", "distance"),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.columns.distance.indicatorImage",<span></span></pre></td></tr><tr><td scope="row"><pre>            "../shared/Ascending.tiff"),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.sortColumn", "distance"),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.sortOrder", "ascending"),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ClickAgainText.stringValue", $labelText),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.lastCityStateZip", $csz),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.lastQuery", $query),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.data.attemptNumber", $attempt)<span></span></pre></td></tr><tr><td scope="row"><pre>)<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;trigger language="XQuery"<span></span></pre></td></tr><tr><td scope="row"><pre>        path="YellowPages.action.yellowPagesSearchComplete"><span></span></pre></td></tr><tr><td scope="row"><pre>dictionary(<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.ResultsTable.selectedRows", 0),<span></span></pre></td></tr><tr><td scope="row"><pre>    ("YellowPages.NetworkArrows.animating", false()) )<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/20001090-113343" title="Opening a New Channel From a Trigger"></a><h2>Opening a New Channel From a Trigger</h2><p>If your channel wants to redirect the user to another channel to handle some task, you can do so programmatically from your channel’s controls. To open another channel, simply ask Sherlock to open a URL that is prefaced with the sherlock web scheme identifier (<code>sherlock://</code>). When opening a channel, you can specify a URL with the location of the channel’s main XML file. For channels that are already registered with Sherlock, you can specify the channel identifier instead of a file URL. The following example opens a new Sherlock window for the Internet channel using the channel identifier. The example uses the <code>new_window</code> identifier to open the channel in a new window. </p><div class="codesample"><table><tr><td scope="row"><pre>&lt;trigger language="JavaScript" path="MyChannel.MyButton.action"><span></span></pre></td></tr><tr><td scope="row"><pre>    System.OpenURL("sherlock://com.apple.internet?new_window");<span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/trigger><span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CreatingWebServices.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-04-09<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleApplications/Conceptual/Sherlock/Tasks/TriggerExamples.html%3Fid%3D10000121i-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleApplications/Conceptual/Sherlock/Tasks/TriggerExamples.html%3Fid%3D10000121i-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleApplications/Conceptual/Sherlock/Tasks/TriggerExamples.html%3Fid%3D10000121i-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
