<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of Multinode Architecture(IM:N)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING302></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Networking-301.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-303.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Networking-2.html"><B>Networking</B></A> / <BR><DD><A HREF="Networking-284.html"><B>Chapter 12 - Multinode Architecture</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING302-0></A>
<H1>Summary of Multinode Architecture</H1>
 The multinode architecture MPP parameter block data structure and symbolic constants for routines and result codes are not defined in the MPW interface files. (The write-data structure and the address block record are defined in the MPW interface files for use with other protocols, but you can use them for multinode also.) <P>
 You must declare the MPP parameter block for multinode in your application. If you want to use the symbolic constants for the routines and result codes, you need to declare them also. <P>
 You use the Device Manager's <CODE>PBControl</CODE> function to call the <CODE>RemoveNode</CODE> and <CODE>NetWrite</CODE> routines from the Pascal and C languages. You must issue the <CODE>AddNode</CODE> routine as an immediate synchronous control call from the Pascal and C languages. You must define a function as part of your application. (See <A HREF=Networking-287.html#MARKER-9-24>Listing 12-1 on page 12-8</A> for an example of how to do this in Pascal.) From assembly language, you can directly make an <CODE>immed _Control</CODE> trap macro call.<P>
<A NAME=HEADING302-4></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING302-5></A>
<H3>Constants</H3>
 (Declare the following constants in your application.)<P>
<PRE>
CONST
   {csCodes}
   netWrite    = 261;               {send packet through multinode}
   addNode     = 262;               {request a multinode}
   removeNode  = 263;               {remove multinode}
</PRE>
<A NAME=HEADING302-8></A>
<H3>Data Types</H3>
<A NAME=HEADING302-9></A>
<H4>The Write-Data Structure</H4>
<PRE>
TYPE  WDSElement = 
   RECORD
      entryLength:   Integer;
      entryPtr:      Ptr;
   END;
</PRE>
<A NAME=HEADING302-11></A>
<H4>The Address Block Record </H4>
<PRE>
TYPE AddrBlock = 
   PACKED RECORD
      aNet:          Integer;    {network number for multinode}
      aNode:         Byte;       {multinode ID}
      aSocket:       Byte;       {socket number; always 0}
   END;
</PRE>
<A NAME=HEADING302-13></A>
<H4>The Multinode Parameter Block </H4>
 (Declare this data type in your application.)<P>
<PRE>
TYPEMNParmType = (AddNodeParm,RemoveNodeParm);
TYPE MNParamBlock = 
   PACKED RECORD
      qLink:         QElemPtr;         {reserved}
      qType:         Integer;          {reserved}
      ioTrap:        Integer;          {reserved}
      ioCmdAddr:     Ptr;              {reserved}
      ioCompletion:  ProcPtr;          {completion routine}
      ioResult:      OSErr;            {result code}
      ioNamePtr:     StringPtr;        {reserved}
      ioVRefNum:     Integer;          {reserved}
      ioRefNum:      Integer;          {driver reference number}
      csCode:        Integer;          {call command code}
         filler1:       Byte;          {reserved}
         checkSumFlag:  Byte;          {perform checksum on datagram}
         wdsPointer:    Ptr;           {pointer to write-data structure}
         filler2:       Integer;       {reserved}
         CASE MNParmType OF
            AddNodeParm:
            (reqNodeAddr:  AddrBlock;     {preferred address requested}
             actNodeAddr:  AddrBlock;     {actual node address returned}
             recvRoutine:  ProcPtr;       {pointer to packet receive routine}
             reqCableLo:   Integer;       {preferred network range for the }
             reqCableHi:   Integer;       { node being acquired}
             reserved:     PACKED ARRAY[1..70] OF Byte);
            RemoveNodeParm:
            (nodeAddr:     AddrBlock);    {node address to be deleted}
END;
MNParmBlkPtr = ^MNParamBlock;
</PRE>
<A NAME=HEADING302-17></A>
<H2>C Summary</H2>
<A NAME=HEADING302-18></A>
<H3>Constants</H3>
 (Declare the following constants in your application.)<P>
<PRE>
/*csCodes*/
enum {
   netWrite       = 261,               /*send packet through multinode*/
   addNode        = 262,               /*request a multinode*/
   removeNode     = 263                /*remove multinode*/
};
</PRE>
<A NAME=HEADING302-21></A>
<H3>Data Types</H3>
<A NAME=HEADING302-22></A>
<H4>The Write-Data Structure</H4>
<PRE>
struct   WDSElement { 
   short    entryLength;
   Ptr      entryPtr;
} WDSElement;
</PRE>
<A NAME=HEADING302-24></A>
<H4>The Address Block Record </H4>
<PRE>
struct AddrBlock { 
      short             aNet;          /*network number for multinode*/
      unsigned char     aNode;         /*multinode ID*/
      unsigned char     aSocket;       /*socket number; always 0*/
};

typedef struct AddrBlock AddrBlock;
</PRE>
<A NAME=HEADING302-26></A>
<H4>The MPP Parameter Block for Multinode</H4>
 (Declare this data type in your application.)<P>
<PRE>
typedef struct {
   MPPATPHeader
      char              filler1;       /*reserved*/
      unsigned char     checkSumFlag;  /*perform checksum on datagram*/
      Ptr               wdsPointer;    /*pointer to write-data structure*/
      char              filler2[2];    /*reserved*/
      union {
         AddrBlock      reqNodeAddr;   /*preferred address requested*/
         AddrBlock      nodeAddr;      /*node address to be deleted*/
               } MNaddrs;
      AddrBlock      actNodeAddr;      /*actual node address acquired*/
      Ptr            recvRoutine;      /*address of packet receive routine*/
      short          reqCableLo;       /*preferred network range for the */
      short          reqCableHi;       /* node being acquired*/
      char           reserved[70];
} MNParamBlock;
typedef MNParamBlock*MNParmBlkPtr;
</PRE>
<A NAME=HEADING302-30></A>
<H2>Assembly-Language Summary </H2>
<A NAME=HEADING302-31></A>
<H4>MPP Parameter Block Common Fields for Multinode Routines
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>qLink<TD>long<TD>reserved<TR>
<TD>4<TD>qType<TD>word<TD>reserved<TR>
<TD>6<TD>ioTrap<TD>word<TD>reserved<TR>
<TD>8<TD>ioCmdAddr<TD>long<TD>reserved<TR>
<TD>12<TD>ioCompletion<TD>long<TD>address of completion routine<TR>
<TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>18<TD>ioNamePtr<TD>long<TD>reserved<TR>
<TD>22<TD>ioVRefNum<TD>word<TD>reserved<TR>
<TD>24<TD>ioRefNum<TD>word<TD>driver reference number</TABLE>
</H4>
<A NAME=HEADING302-32></A>
<H4>AddNode 
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>routine selector; always 262 for this routine<TR>
<TD>36<TD>reqNodeAddr<TD>long<TD>requested multinode address<TR>
<TD>40<TD>actNodeAddr<TD>long<TD>actual multinode address assigned<TR>
<TD>44<TD>recvRoutine<TD>long<TD>address of the application's receive routine<TR>
<TD>48<TD>reqCableLo<TD>word<TD>beginning of requested network number range <BR>for the multinode<TR>
<TD>50<TD>reqCableHi <TD>word<TD>end of the requested network number range for the multinode<TR>
<TD>52<TD>reserved<TD>array<TD>70 reserved bytes required by the .MPP driver</TABLE>
Parameter Variant</H4>
 (Note that to execute the <CODE>AddNode</CODE> routine from assembly language, you call the <CODE>_Control</CODE> trap macro and issue the routine request as an immediate call.)<P>
<A NAME=HEADING302-34></A>
<H4>RemoveNode 
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>routine selector; always 263 for this routine <TR>
<TD>36<TD>nodeAddr<TD>long<TD>actual multinode address assigned</TABLE>
Parameter Variant</H4>
<A NAME=HEADING302-35></A>
<H4>NetWrite 
<TABLE BORDER="0" CELLPADDING=3><TD>26<TD>csCode<TD>word<TD>routine selector; always 261 for this routine<TR>
<TD>29<TD>checkSumFlag<TD>byte<TD>a flag indicating whether the checksum should be calculated or the existing checksum left unmodified<TR>
<TD>30<TD>wdsPointer<TD>long<TD>a pointer to the write-data structure for this routine</TABLE>
Parameter Variant</H4>
<A NAME=HEADING302-36></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>paramErr<TD>-50<TD>Bad parameter value<TR>
<TD>ddpLenErr<TD>-92<TD>Datagram is too long<TR>
<TD>noBridgeErr<TD>-93<TD>No router found<TR>
<TD>excessCollsns<TD>-95<TD>Excessive collisions on write<TR>
<TD>tryAddNodeAgainErr<TD>-1021<TD>The .MPP driver was not able to add node; try again<TR>
<TD>mnNotSupported<TD>-1022<TD>Multinode is not supported by the current AppleTalk connection file of type <CODE>'adev'</CODE><TR>
<TD>noMoreMultiNodes<TD>-1023<TD>No node address is available on the network</TABLE>
</H2>
</BLOCKQUOTE><P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Networking-301.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Networking-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Networking-304.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt= "Book Index"></A> <A HREF="Networking-303.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Networking-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
