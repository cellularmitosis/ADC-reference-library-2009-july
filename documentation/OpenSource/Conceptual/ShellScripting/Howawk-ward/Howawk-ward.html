<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shell Scripting Primer: How AWK-ward</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How AWK-ward"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40004268-TP40003518" title="How AWK-ward"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP40003594" target="_top">Open Source</a> &gt; <a href="../../../Scripting-date.html#//apple_ref/doc/uid/TP30000440-TP40003594-TP30000569" target="_top">Scripting &amp; Automation</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40004268-TP40003516-SW1">Shell Scripting Primer</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../RegularExpressionsUnfettered/RegularExpressionsUnfettered.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PortingScriptstoMacOSX/PortingScriptstoMacOSX.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW10" title="How AWK-ward"></a><h1>How AWK-ward</h1><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_184"></a>This chapter is a primer to help you learn how to use the AWK programming language and the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter. The <code>awk</code> interpreter, much like <code><a href="../../../../Darwin/Reference/ManPages/man1/sed.1.html#//apple_ref/doc/man/1/sed" target="_top">sed</a></code>, <code><a href="../../../../Darwin/Reference/ManPages/man1/grep.1.html#//apple_ref/doc/man/1/grep" target="_top">grep</a></code>, and <code><a href="../../../../Darwin/Reference/ManPages/man1/perl.1.html#//apple_ref/doc/man/1/perl" target="_top">perl</a></code>, is a commonly used text processing tool based on regular expressions.</p><p>For more detailed reference material, see the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code>, the GNU AWK manual (<span class="content_text"><a href="http://www.gnu.org/software/gawk/manual/" target="_blank">http://www.gnu.org/software/gawk/manual/</a></span>), and Brian Kernighan’s book, <em>The AWK Programming Language</em>.</p><p>This chapter uses the file <code>poem.txt</code> from <span class="content_text"><a href="../RegularExpressionsUnfettered/RegularExpressionsUnfettered.html#//apple_ref/doc/uid/TP40004268-CH238-SW7">“Regular Expressions Unfettered”</a></span> as the basis for most of its examples. Be sure to create that file before attempting any of these examples.</p><p>These examples are tested primarily on the Mac OS X version of AWK, which is derived from <span class="content_text"><a href="http://www.cs.princeton.edu/~bwk/btl.mirror/" target="_blank">"The One True AWK”</a></span> by Brian Kernighan. Please report any compatibility problems with other versions of AWK using the feedback links at the bottom of each page.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW18">What Is AWK?</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW9">A Simple AWK Script</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW5">Conditional Filter Rules in AWK</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW3">Changing the Record and Field Separators in AWK Scripts</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW11">Control Statements in AWK</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW8">Functions in AWK</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW1">Working with Arrays in AWK</a>
				
			<br/>
			
        
			
			
				<a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW17">File Input and Output</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW18" title="What Is AWK?"></a><h2>What Is AWK?</h2><p>AWK is a language designed primarily for processing structured data records containing text. This language is executed by the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter.</p><p>The design of AWK centers around dividing the input text into records, each one containing a number of fields. Each time the <code>awk</code> interpreter encounters a record separator, it begins a new record. By default, the record separator is a newline character, though you can change this as described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW3">“Changing the Record and Field Separators in AWK Scripts.”</a></span></p><p>After the <code>awk</code> interpreter has read a complete record from the input, it divides that record into fields. The fields are delimited by a field separator, similar to the field separators described in <span class="content_text"><a href="../shell_scripts/shell_scripts.html#//apple_ref/doc/uid/TP40004268-CH237-SW9">“Variable Expansion and Field Separators.”</a></span></p><p>An AWK script is divided into a series of rules. Once the <code>awk</code> interpreter has divided a record into fields, it executes these rules in sequence. Each rule has access to variables that contain the record as a whole and the individual fields of that record. The rules can then perform various modifications to that data, print the data, and so on.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW9" title="A Simple AWK Script"></a><h2>A Simple AWK Script</h2><p>At its most basic, the <a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_185"></a>syntax of an AWK script is very similar to C. The major differences are:</p><ul class="ul"><li class="li"><p>It is an interpreted language, so it is not as fast as C.</p></li><li class="li"><p>Semicolons at the end of a statement are generally optional. (They are required only if you need to put more than one statement on a single line).</p></li><li class="li"><p>A newline (line break) ends a statement. Much like shell scripts or C preprocessor macros, if you put a backslash at the end of one line, the statement continues onto the next line.</p></li><li class="li"><p>Instead of having a <code><!--a-->main<!--/a--></code> function, the main body of code is divided into a series of filter actions surrounded by curly braces. These filters are applied sequentially for <em>each record</em> in an input file. This means that the code between curly braces may execute more than once.</p></li><li class="li"><p>Variables are all in the global scope except for parameters to functions. (Function-local variables are described more in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW8">“Functions in AWK.”</a></span>)</p></li><li class="li"><p>Variables maintain their value across multiple records and files. They are set until explicitly cleared.</p></li></ul><p>Unlike shell scripts (but like C), variables in AWK scripts are not preceded by dollar signs when you use them. This means that they cannot be inserted in the middle of strings.</p><p>There are a few special <a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_186"></a>variables that are preceded by a dollar sign, however. The variable <code>$0</code> represents an entire record read from the input file. Similarly, AWK divides each record up into fields, which are represented by special variables starting with <code>$1</code> and numbering upwards.</p><p>Here is a simple AWK script:</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        a=$0;<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is a test: a is " a;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Save this file as <code>01_simple.awk</code>, then <a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_187"></a>run it by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 01_simple.awk poem.txt<span></span></pre></td></tr></table></div><p>This executes the AWK script <code>01_simple.awk</code> and passes the file <code>poem.txt</code> as its input. For each record (a single line, by default) in the file, this will print the following:</p><div class="codesample"><table><tr><td scope="row"><pre>This is a test: a is <em>line from file</em><span></span></pre></td></tr></table></div><p>You should notice four things about this script:</p><ul class="ul"><li class="li"><p>Strings separated by spaces are concatenated automatically just as they are in C.</p></li><li class="li"><p>The <code><!--a-->print<!--/a--></code> statement is much like the <code>print</code> statement in Perl. (The AWK language also supports <a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_188"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_189"></a><code><!--a-->printf<!--/a--></code>, whose syntax is like the command-line version, <code><a href="../../../../Darwin/Reference/ManPages/man1/printf.1.html#//apple_ref/doc/man/1/printf" target="_top">printf</a></code>, except that the arguments are separated by commas instead of spaces.)</p></li><li class="li"><p>The <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter always requires an input file even if your script does not actually read anything from it. If you want <code>awk</code> to read from standard input, you must pass a hyphen (<code>-</code>) as the filename.</p></li><li class="li"><p>The <code>awk</code> interpreter can take either a string of raw code or a file to execute. If you pass in a string of code as the first argument, that code is executed. If you want <code>awk</code> to execute code from a file, you must pass the <code>-f</code> flag followed by the path of the script file.</p></li></ul><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW5" title="Conditional Filter Rules in AWK"></a><h2>Conditional Filter Rules in AWK</h2><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_190"></a><p>You don’t always want to take an action based on every record in a file. Adding a pattern to a filter action is the most efficient way to limit its scope. In AWK scripts, the action specified by such a conditional filter occurs only if the specified pattern matches the record in question.</p><p>The format for a conditional filter rule is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre><em>pattern</em> { <em>action</em> }<span></span></pre></td></tr></table></div><p>The <em>action</em> here is a series of statements just like any other filter rule. The <em>pattern</em> can be blank (in which case it matches every record), or it can contain any combination of regular expressions or relational expressions. These two types of expressions are briefly explained in the following sections.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW4" title="Regular Expressions in AWK"></a><h3>Regular Expressions in AWK</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_191"></a><p>Conditional filter rules in AWK scripts may contain one or more regular expressions. These expressions <em>must</em> be a simple search-style regular expression (beginning and ending with a slash). It cannot include a command switch or modifier switches. For example, the following will not work the way you might expect:</p><ul class="simple"><li><p><code>/mary/i</code>—Case-insensitive match for “mary” will actually match either the word “mary” or the letter “i”, which is probably not what you want.</p></li><li><p><code>s/lamb//</code>—Substitutions are not allowed here and will cause a syntax error.</p></li></ul><p>The following AWK script will print every line that contains “lamb”.</p><div class="codesample"><table><tr><td scope="row"><pre>/lamb/ {<span></span></pre></td></tr><tr><td scope="row"><pre>        a=$0;<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is a test: a is " a;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Save this file as <code>02_conditional_regex.awk</code>, then run it using the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 02_conditional_regex.awk poem.txt<span></span></pre></td></tr></table></div><p>As with conditionals in C, you can combine multiple regular expressions with the Boolean operators <code>!</code> (not), <code>||</code> (or), and <code>&amp;&amp;</code> (and). For example, the following rule searches for any line that contains “Mary” but contains neither “lamb” nor “had”:</p><div class="codesample"><table><tr><td scope="row"><pre>/Mary/ &amp;&amp; !(/lamb/ || /had/){<span></span></pre></td></tr><tr><td scope="row"><pre>        a=$0;<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is a test: a is " a;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Save this file as <code>03_conditional_multiregex.awk</code>, then run it by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 03_conditional_multiregex.awk poem.txt<span></span></pre></td></tr></table></div><p>It prints the following text:</p><div class="codesample"><table><tr><td scope="row"><pre>This is a test: a is and everywhere that Mary went,<span></span></pre></td></tr><tr><td scope="row"><pre>This is a test: a is What about Mary, Mary, and Mary?<span></span></pre></td></tr></table></div><p>For more information about regular expressions, read <span class="content_text"><a href="../RegularExpressionsUnfettered/RegularExpressionsUnfettered.html#//apple_ref/doc/uid/TP40004268-CH238-SW7">“Regular Expressions Unfettered.”</a></span></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_192"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW19" title="Expression Ranges in awk"></a><h3>Expression Ranges in awk</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_193"></a><p>In AWK scripts, when you combine two expressions with a comma (<code>,</code>), the action is applied to all records beginning with a record that matches the first pattern and continuing through a record that matches the second one.</p><p>Consider the following <code>awk</code> script:</p><div class="codesample"><table><tr><td scope="row"><pre>/married/,/lowercase/{ print $0; }<span></span></pre></td></tr></table></div><p>Save this file as <code>05_conditional_range.awk</code>, then run it by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 05_conditional_range.awk poem.txt<span></span></pre></td></tr></table></div><p>The <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter prints every line in the poem file beginning with the line containing “married” and ending with the line containing “lowercase”.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW20" title="Note"></a><p><strong>Note:</strong>&nbsp;For examples using arrays, see <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW1">“Working with Arrays in AWK.”</a></span></p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_194"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW6" title="Relational Expressions in AWK"></a><h3>Relational Expressions in AWK</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_195"></a><p>In addition to regular expressions, AWK scripts support relational expressions. You can use relational expressions to perform more fine-grained matching, such as matching based on the content of a particular field or variable.</p><p>AWK scripts support five basic forms of relational expression:</p><ul class="spaceabove"><li class="li"><p><em>expression</em><code> ~ /</code><em>regexp</em><code>/</code>—Expression matches the regular expression.</p></li><li class="li"><p><em>expression</em><code> !~ /</code><em>regexp</em><code>/</code>—Expression does not match the regular expression.</p></li><li class="li"><p><em>expression</em><em> comparison_operator </em><em>expression</em>—Basic string or numeric comparison between two expressions.</p></li><li class="li"><p><em>expression</em><code> in </code><em>array_name</em>—Expression is a key in the specified array. (See <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW1">“Working with Arrays in AWK”</a></span> for more information on working with arrays.)</p></li></ul><p>The <em>comparison_operator</em> can be any of the standard C comparison operators, such as <code>==</code>, <code>!=</code>, and so on.</p><p>The <em>expression</em> is generally either one of the fields or the result of an operation on one of the fields. For example, the following AWK filter rules show, respectively, how to compare the first field to “mary” in a case-insensitive fashion, how to match all records that do not contain “Mary”, and how to do an exact comparison of the first field against “Mary”:</p><div class="codesample"><table><tr><td scope="row"><pre>tolower($1) ~ /mary/ { print "CI Record: " $0; }<span></span></pre></td></tr><tr><td scope="row"><pre>$0 !~ /Mary/ { print "Not Mary: " $0; }<span></span></pre></td></tr><tr><td scope="row"><pre>$1 == "Mary" { print "Mary Record: " $0; }<span></span></pre></td></tr></table></div><p>Save this file as <code>04_conditional_insensitive.awk</code>, then run it with the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 04_conditional_insensitive.awk poem.txt<span></span></pre></td></tr></table></div><p>The script outputs a series of lines beginning with the following:</p><div class="codesample"><table><tr><td scope="row"><pre>CI Record: Mary had a little lamb,<span></span></pre></td></tr><tr><td scope="row"><pre>Mary Record: Mary had a little lamb,<span></span></pre></td></tr><tr><td scope="row"><pre>Not Mary: its fleece was white as snow,<span></span></pre></td></tr><tr><td scope="row"><pre>Mary Record: Mary fleece was white as snow,<span></span></pre></td></tr><tr><td scope="row"><pre>Mary Record: Mary everywhere that Mary went,<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_196"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW2" title="Special Patterns in AWK:BEGIN and END"></a><h3>Special Patterns in AWK:BEGIN and END</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_197"></a><p>AWK scripts support two special patterns:<code>BEGIN</code> and <code>END</code>.</p><p>Any action associated with the <code>BEGIN</code> pattern executes before the first record is read from the file. You should, for example, make any changes to the record or field separators in a <code>BEGIN</code> action, as described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW3">“Changing the Record and Field Separators in AWK Scripts.”</a></span></p><p>Similarly, any action associated with the <code>END</code> pattern executes after the last record is read and processed. You could use this to output a special end of data record, for example.</p><p>The following example shows the use of <code>BEGIN</code> and <code>END</code> patterns.</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN { print "Here is the line we care about."; }<span></span></pre></td></tr><tr><td scope="row"><pre>/chocolate/ { print "Mmm.  Chocolate.  " $0; }<span></span></pre></td></tr><tr><td scope="row"><pre>END { print "That's all that matters."; }<span></span></pre></td></tr></table></div><p>Save this file as <code>06_beginend.awk</code>, then run it with the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter by typing:</p><div class="codesample"><table><tr><td scope="row"><pre>awk -f 06_beginend.awk poem.txt<span></span></pre></td></tr></table></div><p>It prints the following:</p><div class="codesample"><table><tr><td scope="row"><pre>Here is the line we care about.<span></span></pre></td></tr><tr><td scope="row"><pre>Mmm.  Chocolate.  I want chocolate for Valentine's day.<span></span></pre></td></tr><tr><td scope="row"><pre>That's all that matters.<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW21" title="Note"></a><p><strong>Note:</strong>&nbsp;The position of the <code>BEGIN</code> and <code>END</code> rules is not important. In this example, they were placed at the beginning and end for ease of readability. You can have as many <code>BEGIN</code> or <code>END</code> rules as needed. The <code>awk</code> tool executes these rules in the order in which they appear in the file.</p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_198"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW12" title="Conditional Pattern Matching with Variables"></a><h3>Conditional Pattern Matching with Variables</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_199"></a><p>In addition to matching against input fields, AWK scripts also allow you to use arbitrary variables in conditional pattern matches. Consider the following script:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN { lastwasmary = 0; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) ~ /mary/ &amp;&amp; !lastwasmary) { print "Mary appeared."; lastwasmary = 1; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) ~ /mary/ &amp;&amp; lastwasmary) { print "Mary appeared again"; lastwasmary = 1; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) !~ /mary/ &amp;&amp; lastwasmary) { print "No Mary."; lastwasmary = 0; }<span></span></pre></td></tr></table></div><p>This script prints the words “Mary appeared” on the first line in which “Mary” is the first word, but performs the matching in a case-insensitive fashion<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_200"></a>. It prints “Mary appeared again” for each consecutive line in which “Mary” appears as the first word.</p><p>If “Mary” does not appear as the first word in a line, it prints “No Mary” and the variable <code>lastwasmary</code> is reset to zero. Thus, the next time “Mary” appears after that, it prints “Mary appeared” instead of “Mary appeared again”.</p><p>Of course, in this particular case, you may be better off conditionalizing the pattern using an <code>if</code>/<code>then</code> statement as described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW11">“Control Statements in AWK.”</a></span></p><p>You can also use variables to store the pattern for matching by replacing the entire pattern (including slashes) with the name of a variable. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN { maryword = "mary"; keyword=maryword "lamb"; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) ~ keyword) { print "Mary appeared."; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) !~ keyword) { print "No mary."; }<span></span></pre></td></tr></table></div><p>This searches for any string in which “marylamb” appears as the first word (in a case-insensitive comparison).</p><p>You should notice that strings (and variables containing strings) separated by a space are concatenated automatically in the assignment statement. This effectively allows you to synthesize patterns containing variables.</p><p>You can also do the concatenation inline if desired. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN { maryword = "mary"; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) ~ maryword "lamb" ) { print "Mary appeared."; }<span></span></pre></td></tr><tr><td scope="row"><pre>(tolower($1) !~ maryword "lamb" ) { print "No mary."; }<span></span></pre></td></tr></table></div><p>This code behaves identically to the previous example, but without the intermediate variable assignment.<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_201"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_202"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW3" title="Changing the Record and Field Separators in AWK Scripts"></a><h2>Changing the Record and Field Separators in AWK Scripts</h2><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_203"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_204"></a><p>In AWK scripts, the default record separator is a newline, but you can change this by modifying the regular expression stored in the  variable <code>RS</code>. Likewise, the default field separator, stored in the variable <code>FS</code>, is a regular expression that matches spaces and tabs.</p><p>Unless you are doing something particularly unusual, you should generally change the record separator <em>before</em> the first record is read. To do this, you use the special pattern <code>BEGIN</code>, as described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW2">“Special Patterns in AWK:BEGIN and END.”</a></span></p><p>By the time any other filter rule executes, the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter has already read the first record and divided it into fields, using whatever record and field separators were in place at the time. Thus, if you change the record or field separator in a normal rule, that new record separator is not active until the <em>next</em> record is processed.</p><p>For example, the following script sets the record separator to the letter “i” and then prints each record:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {RS="i"; FS=/r/}<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        print "Record is: " $0;<span></span></pre></td></tr><tr><td scope="row"><pre>        print "First field is " $1;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>BEGIN</code> filter rule is evaluated before the first record in the file, thus setting the record separator to the letter “i” and the field separator to the letter “r”. Then, after the first record is read, the second filter rule is evaluated against it based on the altered record separator.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW22" title="Note"></a><p><strong>Note:</strong>&nbsp;Both <code>RS</code> and <code>FS</code> can contain either a regular expression or a literal string if desired.</p></div><p>The AWK language also supports separate output separators for both records and fields. The output record and field separator variables are <code>ORS</code> and <code>OFS</code>, respectively.</p><p>The output field separator is automatically printed between fields whenever you print the value of <code>$0</code> (the “whole record” variable), and the output record separator is similarly printed at the end of <code>$0</code>.<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_205"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_206"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW11" title="Control Statements in AWK"></a><h2>Control Statements in AWK</h2><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_207"></a><p>Control statements in AWK scripts are syntactically almost identical to C control statements.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW13" title="The if Statement"></a><h3>The if Statement</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_208"></a>As in C, the <code>if</code> statement looks like this:</p><div class="codesample"><table><tr><td scope="row"><pre>if (<em>expression</em>) <em>statement</em>;<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW23" title="Note"></a><p><strong>Note:</strong>&nbsp;The expression format is described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW6">“Relational Expressions in AWK.”</a></span></p></div><p>Just as in C, you can create compound statements by wrapping them in curly braces. For example, if you want to execute two statements when a given record contains the word Mary, you might write an AWK script that looks like this:</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        if ($0 ~ /Mary/) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print "Mary is in this line:";<span></span></pre></td></tr><tr><td scope="row"><pre>                print $0;<span></span></pre></td></tr><tr><td scope="row"><pre>        } else {<span></span></pre></td></tr><tr><td scope="row"><pre>                print "NOMATCH: " $0;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_209"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW27" title="The while Statement"></a><h3>The while Statement</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_210"></a>The <code>while</code> statement looks just like the <code>if</code> statement. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        i=4<span></span></pre></td></tr><tr><td scope="row"><pre>        if ($0 ~ /Mary/) {<span></span></pre></td></tr><tr><td scope="row"><pre>                while (i) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        print i ":" $0;<span></span></pre></td></tr><tr><td scope="row"><pre>                        i--;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>As in C, you can skip the remaining code in the body of a <code>while</code> loop by calling the <code>continue</code> function.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_211"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW28" title="The for Statement"></a><h3>The for Statement</h3><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_212"></a>The <code>for</code> statement syntax has aspects of both the C syntax and the shell script syntax. The C language form of the <code>for</code> statement is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>for (<em>pre_expression</em>; <em>while_expression</em>; <em>post_expression</em>) <em>statement</em><span></span></pre></td></tr></table></div><p>This statement is equivalent to the following:</p><div class="codesample"><table><tr><td scope="row"><pre><em>pre_expression</em>;<span></span></pre></td></tr><tr><td scope="row"><pre>while (<em>while_expression</em>) {<span></span></pre></td></tr><tr><td scope="row"><pre>                    <em>statement</em>;<span></span></pre></td></tr><tr><td scope="row"><pre>                <em>post_expression</em>;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The first expression, which executes before entering the <code>while</code> loop, usually initializes one or more loop iterators. The second expression is then tested for truth. While it is true, the statement executes. After each iteration through the loop, the third expression executes. This usually increments or decrements the loop iterator.</p><p>As in C, you can skip the remaining code in the body of a <code>for</code> loop by calling the <code>continue</code> function.</p><p>For example, the following code prints each line that matches “Mary” three times. These are numbered 1, 2, and 4. It skips the case where <code>i==2</code>, and thus the number 3 is never printed.</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        if ($0 ~ /Mary/) {<span></span></pre></td></tr><tr><td scope="row"><pre>                for (i=0; i&lt;4; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        if (i==2) continue;<span></span></pre></td></tr><tr><td scope="row"><pre>                        print i+1 ":" $0;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In addition, AWK supports a shell-like (really, Perl-like) version of the <code>for</code> loop, in which it acts as an array iterator. The array iteration syntax is:</p><div class="codesample"><table><tr><td scope="row"><pre>for (<em>key_variable</em> in <em>array</em>) <em>statement</em><span></span></pre></td></tr></table></div><p>This syntax is described in more detail in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW1">“Working with Arrays in AWK.”</a></span></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_213"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW29" title="Skipping Records and Files"></a><h3>Skipping Records and Files</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_214"></a><p>At any point in your filter rules, you can skip processing of all remaining rules (effectively skipping to the next record) by using the <code><!--a-->next<!--/a--></code> statement. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>if (i > 4) next;<span></span></pre></td></tr></table></div><p>Likewise, at any time, you can skip processing of the remainder of an input file by using the <code><!--a-->nextfile<!--/a--></code> statement. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>if (i > 4) nextfile;<span></span></pre></td></tr></table></div><p>The <code>if</code> statement syntax is described in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW11">“Control Statements in AWK.”</a></span></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_215"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_216"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW8" title="Functions in AWK"></a><h2>Functions in AWK</h2><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_217"></a><p>In addition to providing a number of standard functions (described in the manual page for <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code>), the AWK language allows you to define your own custom functions. The syntax for a function declaration is:</p><div class="codesample"><table><tr><td scope="row"><pre>function <em>function_name</em>(<em>parameter1</em> [, <em>parameter2</em>, ...]) {<span></span></pre></td></tr><tr><td scope="row"><pre>                    <em>action</em><span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Because variables are in the global scope except for function parameters, if you want to define a local variable in a function, you <em>must</em> declare it as an extra parameter to the function. You do not have to pass in a value. If you do not declare the variable as a parameter, it affects execution outside of the function and its value is persistent across multiple invocations of the function.</p><p>For example, this function takes two parameters, subtracts them, and then adds one (<code>1</code>):</p><div class="codesample"><table><tr><td scope="row"><pre>function subtractAndAddOne(a, b, c) {<span></span></pre></td></tr><tr><td scope="row"><pre>        c = 1<span></span></pre></td></tr><tr><td scope="row"><pre>        return (a-b+c);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        print subtractAndAddOne(3, 2);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="importantbox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_18" title="Important:"></a><p><strong>Important:</strong>&nbsp;<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_218"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_219"></a>When you call a function, you must not put a space before the opening parenthesis. In AWK scripts, a space is used for string concatenation, so adding a space is likely to cause a syntax error. However, it might instead result in rather strange behavior in certain contexts.</p><p></p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_220"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW1" title="Working with Arrays in AWK"></a><h2>Working with Arrays in AWK</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_221"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_222"></a>Arrays in AWK scripts are syntactically very similar to arrays in C. Don’t let that fool you, though. Under the hood, they behave very differently.</p><p>Arrays in AWK scripts are associative. This means that each array element is stored as a key-value pair, resulting in three major differences when compared to C:</p><ul class="ul"><li class="li"><p>Arrays are allocated and grow dynamically as space is needed.</p></li><li class="li"><p>Arrays can be sparse; you can have an array with a value at index <code>711</code> and a value at index <code>1116</code> with nothing between them.</p></li><li class="li"><p>You cannot populate an array in a single operation except by splitting a string.</p></li></ul><p>There are two ways to create an array. The first is by simply using it. The second is by using the <code>split</code> function. These methods are described in the sections that follow, along with useful tips about working with arrays.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW7" title="Array Basics"></a><h3>Array Basics</h3><p>The following code creates and prints an array called <code>my_array</code> containing the values “Partridge”, “tree”, “pear”, and “Cassidy”:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[0] = "Partridge";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[1] = "pear";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[2] = "tree";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array["David"] = "Cassidy";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for ( my_index in my_array ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print my_index "=" my_array[my_index];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The first thing you will notice is that the array is not printed in order. In fact, it is printed in the order in which the underlying data is stored internally. If you want to print the values in key order, you must walk through the index numerically instead.</p><p>The second thing you will notice is that the <code>for</code> statement can be used to iterate through all of the keys in the array. In this usage, the <code>for</code> statement in AWK scripts is like the <code>for</code> statement in a shell script. The <code>for</code> statement array-iterator usage is:</p><div class="codesample"><table><tr><td scope="row"><pre>for (<em>key_variable</em> in <em>array_name</em>) <em>statement</em><span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW24" title="Note"></a><p><strong>Note:</strong>&nbsp;Unlike the <code>for</code> or <code>foreach</code> statements in most other languages, the array-iterator-style <code>for</code> statement in AWK scripts iterates through the array <em>keys</em> (indices) rather than through the array values. Thus, it is similar to the following Perl statement:</p><div class="codesample"><table><tr><td scope="row"><pre>foreach my $<em>key_variable</em> (keys <em>%assoc_array</em>) { ... }<span></span></pre></td></tr></table></div>Because <em>key_variable</em> contains the key from each key-value pair rather than the value, you must explicitly use the key as an array index if you want to to obtain the values in the array.<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_223"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_224"></a> For example:</p><div class="codesample"><table><tr><td scope="row"><pre>for ( i in arr ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        print arr[i];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></div><p>The third thing you will notice is that, unlike C, array elements can take arbitrary strings as their key (array index). If you need to iterate through the array in key order, however, you should limit yourself to numeric keys.</p><p>As a side effect, the keys are <em>always</em> stored as a string even if they only contain numbers. Thus, if you want to compare them numerically to each other (for example, to find the smallest key for which a value exists), you must add zero (0) to the key prior to making the comparison.<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_225"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_226"></a></p><p>For example, the following code iterates through this sparse array in key order by finding the minimum and maximum key values and then iterating from the minimum to the maximum:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[0] = "Partridge";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[1] = "pear";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[2] = "tree";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array[13] = "Cassidy";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        min = 0; max = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>        for ( my_index in my_array ) {<span></span></pre></td></tr><tr><td scope="row"><pre>                if (my_index+0 &lt; min) min = my_index;<span></span></pre></td></tr><tr><td scope="row"><pre>                if (my_index+0 > max) max = my_index;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        for (i=min; i&lt;= max; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>                if (i in my_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        print i "=" my_array[i];<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>                if (!(i in my_array)) {<span></span></pre></td></tr><tr><td scope="row"><pre>                        print i " is unset.";<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In this example, you should note the <code>if</code> statement syntax near the end. Before printing an array value, the example checks to see if a value has ever been stored for that key value:</p><div class="codesample"><table><tr><td scope="row"><pre>if (i in my_array) { ... }<span></span></pre></td></tr></table></div><p>As with any expression, you can invert matching with an exclamation point. For example, to check to see if a particular index has never been stored in an array, you could write the following:</p><div class="codesample"><table><tr><td scope="row"><pre>if (!(i in my_array)) { ... }<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW25" title="Note"></a><p><strong>Note:</strong>&nbsp;Generally speaking, the AWK language is designed under the assumption that you will do any array sorting externally (after the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter has finished) using the <code><a href="../../../../Darwin/Reference/ManPages/man1/sort.1.html#//apple_ref/doc/man/1/sort" target="_top">sort</a></code> tool or similar tools; for performance reasons, you should generally do so.</p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW14" title="Creating Arrays with split"></a><h3>Creating Arrays with split</h3><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_227"></a><p>Assigning array elements individually can be very tedious. A more common (read “less painful”) way to create an array is with the <code>split</code> function. The <code>split</code> syntax is as follows:</p><div class="codesample"><table><tr><td scope="row"><pre><em>count</em> = split( <em>string</em>, <em>array_name</em>, <em>regexp</em> );<span></span></pre></td></tr></table></div><p>For example, the following code splits the string “Mary lamb freezer” into words separated by spaces.</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        arr_len = split( "Mary lamb freezer", my_array, / / );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The result is that <code>arr_len</code> contains the number three (<code>3</code>). The variable <code>my_array[1]</code> contains “Mary”, <code>my_array[2]</code> contains “lamb”, and so on.</p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_228"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW15" title="Copying and Joining an Array"></a><h3>Copying and Joining an Array</h3><p>The AWK language does not support assignment of arrays. Thus, to copy an array, you must copy the individual values from one array to the next. For example, the following code initializes <code>my_array</code> and then copies its contents to <code>copy_array</code> before printing the array:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        arr_len = split( "Mary lamb freezer", my_array, / / );<span></span></pre></td></tr><tr><td scope="row"><pre>        for (word in my_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                copy_array[word] = my_array[word];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        for (word in copy_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print copy_array[word];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Similarly, the AWK language does not provide functions to join an array. To join an array, you should write a simple function like this one:</p><div class="codesample"><table><tr><td scope="row"><pre>function join(input_array, separator) {<span></span></pre></td></tr><tr><td scope="row"><pre>        string = "";<span></span></pre></td></tr><tr><td scope="row"><pre>        first = 1;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        # Note: the array items are in no particular<span></span></pre></td></tr><tr><td scope="row"><pre>        # order when joined with this function.<span></span></pre></td></tr><tr><td scope="row"><pre>        for (i in input_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                if (first) first = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                else string = string separator;<span></span></pre></td></tr><tr><td scope="row"><pre>                string = string input_array[i];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return string;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        arr_len = split( "foo bar baz", my_array, / /);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for (word in my_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print my_array[word];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        print join(my_array, " ");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Like all array functions written using the array-iterator form of the <code>for</code> statement, this join does not occur in any particular order. If you need to join the array values in a particular order, you must write your own custom <code>join</code> function either using a numeric iterator or a manually specified list of fields. For example:</p><div class="codesample"><table><tr><td scope="row"><pre>function count_elements(input_array)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    counter=0;<span></span></pre></td></tr><tr><td scope="row"><pre>    for (word in input_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>        counter++;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return counter;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>function join(input_array, separator) {<span></span></pre></td></tr><tr><td scope="row"><pre>        string = "";<span></span></pre></td></tr><tr><td scope="row"><pre>        first = 1;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        # Note: this preserves order, but does not<span></span></pre></td></tr><tr><td scope="row"><pre>        # work with nonnumeric or sparse arrays.<span></span></pre></td></tr><tr><td scope="row"><pre>        for (i=1; i&lt;=count_elements(input_array); i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>                if (first) first = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                else string = string separator;<span></span></pre></td></tr><tr><td scope="row"><pre>                string = string input_array[i];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return string;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        arr_len = split( "foo bar baz", my_array, / /);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for (word in my_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print my_array[word];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        print join(my_array, " ");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW30" title="Compatibility Note"></a><p><strong>Compatibility Note:</strong>&nbsp;<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_229"></a>Previous versions of this script used the built-in <code>length</code> function to obtain the number of elements in an array (instead of the <code>count_elements</code> function). While this technique works in most versions of AWK released since 2002, it does not work in GNU AWK or its derivatives within the context of a function if the array was passed as one of the function’s arguments.</p>Although this bug has been fixed in the official GNU AWK source repository and should be fixed in versions of GNU AWK after version 3.1.6, for maximum portability, you should still avoid using the <code>length</code> function in this way.</p></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW16" title="Deleting Array Elements"></a><h3>Deleting Array Elements</h3><p>As you saw in <span class="content_text"><a href="Howawk-ward.html#//apple_ref/doc/uid/TP40004268-TP40003518-SW7">“Array Basics,”</a></span> you can add values to an array using arbitrary keys. You can also check to see if a value exists for a given key using the <code>if (key in array)</code> syntax.</p><p>If you need to delete a key-value pair,  you could assign an empty value. However, the <code>if (key in array)</code> syntax still evaluates to true because there is still a value for that key (albeit an empty value). Thus, you probably want to remove the key entirely.</p><p>The AWK programming language solves this problem with the <code><!--a-->delete<!--/a--></code> function. The syntax for <code><!--a-->delete<!--/a--></code> is:</p><div class="codesample"><table><tr><td scope="row"><pre>delete <em>array_name</em>[<em>key</em>];<span></span></pre></td></tr></table></div><p>For example, the following script prints only the key-value pairs “purple = Partridge” and “majesties = tree”.</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array["purple"] = "Partridge";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array["mountain"] = "pear";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array["majesties"] = "tree";<span></span></pre></td></tr><tr><td scope="row"><pre>        my_array["fruited"] = "Cassidy";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        mykey = "fruited";<span></span></pre></td></tr><tr><td scope="row"><pre>        delete my_array["mountain"];<span></span></pre></td></tr><tr><td scope="row"><pre>        delete my_array[mykey];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        for (i in my_array) {<span></span></pre></td></tr><tr><td scope="row"><pre>                print i "=" my_array[i];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>If you need to clear all values from an array simultaneously, though, you don’t have to delete them one at a time. Instead, you can simply do the following:</p><div class="codesample"><table><tr><td scope="row"><pre>delete <em>array_name</em>;<span></span></pre></td></tr></table></div><p>This statement leaves the array specified by <em>array_name</em> empty for future use. You might do this if, for example, you want an array to be reset for each record.<a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_230"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_231"></a></p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW17" title="File Input and Output"></a><h2>File Input and Output</h2><p><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_232"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_233"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_234"></a>The AWK programming language was primarily intended as a filter between one or more input files (or standard input) and standard output. However, it does provide some basic input and output capability.</p><p>As in shell scripts, any print statement can be written to a file using the redirection (<code>></code>) operator (which destroys any previous contents of the file) or concatenated onto the end of an existing file using the concatenation (<code>>></code>) operator.</p><p>Also, as in shell scripts, any print statement can be piped to an outside tool using the pipe (<code>|</code>) operator.</p><p>Pipes and redirections, however, behave differently in AWK scripts than in shell scripts; they <a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_235"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_236"></a>remain open for future use until you explicitly close them or <code>awk</code> exits. This means, among other things, that the concatenation (<code>>></code>) operator is only necessary if you want to retain an existing file and is not necessary to continue adding to a file that you create in <code>awk</code>.</p><p>For example, this script does the following:</p><ul class="ul"><li class="li"><p>Sends two strings to <code>/bin/tail -n 1</code>. The <code><a href="../../../../Darwin/Reference/ManPages/man1/tail.1.html#//apple_ref/doc/man/1/tail" target="_top">tail</a></code> tool prints the last line sent (which contains the second string). This demonstrates that the first two print statements both sent their output to the same instance of <code>tail</code>.</p></li><li class="li"><p>Closes the output to that pipe and sends another message to tail. This shows that a new instance of <code>tail</code> processed this command (because otherwise, the previous line would not have been printed).</p></li><li class="li"><p>Writes two lines to the file <code>/tmp/testfile-awk</code>. If this file exists, it is overwritten. By using the redirect operator, the script demonstrates that additional output (after the first redirect) is appended to the file until the file is closed (regardless of whether you use the redirect or concatenation operator).</p></li></ul><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is a test." | "/usr/bin/tail -n 1";<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is only a test." | "/usr/bin/tail -n 1";<span></span></pre></td></tr><tr><td scope="row"><pre>        close("/usr/bin/tail -n 1");<span></span></pre></td></tr><tr><td scope="row"><pre>        print "Yikes!" | "/usr/bin/tail -n 1";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is another test" > "/tmp/testfile-awk"<span></span></pre></td></tr><tr><td scope="row"><pre>        print "This is yet another test entirely" > "/tmp/testfile-awk"<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40004268-TP40003518-SW26" title="Note"></a><p><strong>Note:</strong>&nbsp;In AWK scripts (unlike in shell scripts), paths for redirects and pipes are considered strings. Thus, paths should be surrounded by double quotes so that they do not resemble regular expressions.</p></div><p>In a similar way, you can read input from a file using the redirection or pipe operator by combining the operator with the <code>getline</code> function. The <code>getline</code> reads a record from an outside file or pipe under programmatic control.</p><p>When you call <code>getline</code>, the <code><a href="../../../../Darwin/Reference/ManPages/man1/awk.1.html#//apple_ref/doc/man/1/awk" target="_top">awk</a></code> interpreter sets the variable <code>$0</code> to the next record from the specified file. The function returns <code>1</code> if a record was read, <code>0</code> if the end of file was reached, or <code>-1</code> if an error occurred (for example, if the file does not exist).</p><p>The following AWK script reads a record from <code>/tmp/testfile-awk</code>, and then reads a record from the output of the <code>echo</code> command:</p><div class="codesample"><table><tr><td scope="row"><pre>BEGIN {<span></span></pre></td></tr><tr><td scope="row"><pre>        getline &lt; "/tmp/testfile-awk";<span></span></pre></td></tr><tr><td scope="row"><pre>        print "The record was " $0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        "/bin/echo 'This is a test line'" | getline<span></span></pre></td></tr><tr><td scope="row"><pre>        print "The second record was " $0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_19" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;The <code>getline</code> function overwrites any value of <code>$0</code> read from the input file. Be sure you don’t need it again before you call this function.</p><p></p><div class="clear"></div></div><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_237"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_238"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_239"></a><a name="//apple_ref/doc/uid/TP40004268-TP40003518-DontLinkElementID_240"></a>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../RegularExpressionsUnfettered/RegularExpressionsUnfettered.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../PortingScriptstoMacOSX/PortingScriptstoMacOSX.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-04-08<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/OpenSource/Conceptual/ShellScripting/Howawk-ward/Howawk-ward.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/OpenSource/Conceptual/ShellScripting/Howawk-ward/Howawk-ward.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/OpenSource/Conceptual/ShellScripting/Howawk-ward/Howawk-ward.html%3Fid%3DTP40004268-5.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>