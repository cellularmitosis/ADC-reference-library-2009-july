<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Interrupt Dispatching</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.16b.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.170.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.172.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=4223"> </A><A NAME="25712"> </A>Interrupt Dispatching</H1><P CLASS="T1.Text1"><A NAME="pgfId=4226"> </A><A NAME="marker=4224"> </A>ISRs do all of the actual processing to service a hardware <A NAME="interrupts"> </A>interrupt. When a device generates a hardware interrupt request, the interrupt dispatching process designates the root member of the IST the <I CLASS="italics">current parent member</I> and invokes its ISR routine. The ISR decides which of the root member's child members should be designated as the current parent member for continued categorization of the interrupt and returns the <TT CLASS="cv">InterruptMemberNumber</TT> value of that child member. As each subsequent child member is designated as the current parent member, its ISR is invoked to decide which of its child members should next be designated in the same way. Ultimately a leaf member is reached, which represents the specific interrupt source. When the leaf member's ISR is invoked, it services the specific requesting interrupt source. It then signals that processing for the interrupt is completed by returning the <TT CLASS="cv">kIsrIsComplete</TT> constant. If there is no ISR attached to the leaf member, the interrupt request is dismissed as a spurious interrupt and system error is returned.</P><P CLASS="T1.Text1"><A NAME="pgfId=4230"> </A>Consider an example using the simplified IST diagrammed in <A HREF="PCI_BOOK.16f.html#29885" CLASS="XRef">Figure&nbsp;11-2</A>. Assume that the interrupt source represented by the IST member set D, <TT CLASS="cv">InterruptMemberNumber</TT> value 1, requests an interruption. Interrupt dispatching begins by invoking the ISR of member set A, <TT CLASS="cv">InterruptMemberNumber</TT> value 1, which returns an <TT CLASS="cv">InterruptMemberNumber</TT> value of 2. This invokes the ISR of member set B, <TT CLASS="cv">InterruptMemberNumber</TT> value 2, which returns an <TT CLASS="cv">InterruptMemberNumber</TT> value of 3. The ISR of member set C, <TT CLASS="cv">InterruptMemberNumber</TT> 3 is then invoked, and it returns an <TT CLASS="cv">InterruptMemberNumber</TT> of 1. Finally, the ISR of IST member set D, <TT CLASS="cv">InterruptMemberNumber</TT> 1, is invoked, which tries to service the requesting device. The ISR returns <TT CLASS="cv">kIsrIsComplete</TT> if the device was successfully serviced and <TT CLASS="cv">kIsrIsNotComplete</TT> if it was not successfully serviced. </P><P CLASS="T1.Text1"><A NAME="pgfId=7140"> </A>Mac OS expects an ISR to return a value of <TT CLASS="cv">kIsrIsComplete</TT> if it believes that the hardware associated with the ISR caused, or may have caused the interrupt. Only if an ISR is certain that its hardware did not cause the interrupt, should it return a value of <TT CLASS="cv">kIsrIsNotComplete</TT>. This is true for all ISRs, unless a driver has created its own sub-tree that would allow the children of that tree to return whatever is desired by the parent node in that tree. The parent of that sub-tree is still required to follow the aforementioned rules regarding what the Mac OS expects from an ISR. </P><P CLASS="T1.Text1"><A NAME="pgfId=4231"> </A>At this point the dispatching process is not complete; the tree must now be traversed back to the root. This must be done because each interrupt member set can have dispatching options attached to the set that modifies dispatching behavior. Once a leaf member's ISR has been invoked, the traversal path must be retraced toward the root to see if any parent members on the path belong to an interrupt set with dispatching options. These options can take two forms:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=4232"> </A>reinvoke a child's parent ISR function when the child member returns <TT CLASS="cv">kIsrIsComplete</TT></LI><LI CLASS="B1.Bullet1"><A NAME="pgfId=4233"> </A>reinvoke a child's parent ISR function when the child member returns <TT CLASS="cv">kIsrIsNotComplete</TT></LI></UL><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.172.html#pgfId=4234" CLASS="Hypertext">Using kIsrIsComplete</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.173.html#pgfId=4237" CLASS="Hypertext">Using kIsrIsNotComplete</A></H2><H2 CLASS="H3.Heading3TOC"><A HREF="PCI_BOOK.174.html#pgfId=4242" CLASS="Hypertext">Interrupt Priority</A></H2><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.16b.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.170.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.172.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>