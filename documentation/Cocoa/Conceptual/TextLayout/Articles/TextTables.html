<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Text Layout Programming Guide for Cocoa: Using Text Tables</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using Text Tables"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40001900" title="Using Text Tables"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../index.html" target="_top">Text Layout Programming Guide for Cocoa</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Tasks/CountLines.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40001900-SW8" title="Using Text Tables"></a><hr /><H1>Using Text Tables</H1><p><a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_15"></a> The Cocoa text system supports text tables <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_16"></a> in Mac OS X version 10.4 and later. The main classes involved are <code>NSTextTable</code>, which represents a table, <code>NSTextTableBlock</code>, which represents a block of text appearing as a cell in the table, and its superclass, <code>NSTextBlock</code>. This article explains how to add table support to your application.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="TextTables.html#//apple_ref/doc/uid/TP40001900-DontLinkElementID_1">Adding the Text Table Panel</a>
				
			<br/>
			
        
			
			
				<a href="TextTables.html#//apple_ref/doc/uid/TP40001900-DontLinkElementID_2">Supporting Text Tables Programmatically</a>
				
			<br/>
			
        
			
			
				<a href="TextTables.html#//apple_ref/doc/uid/TP40001900-DontLinkElementID_3">The Text Table Model</a>
				
			<br/>
			
        
			
			
				<a href="TextTables.html#//apple_ref/doc/uid/TP40001900-DontLinkElementID_4">Controlling Text Block Appearance</a>
				
			<br/>
			
        
			
			
				<a href="TextTables.html#//apple_ref/doc/uid/TP40001900-DontLinkElementID_5">Table Layout Process</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_1" title="Adding the Text Table Panel"></a><h2>Adding the Text Table Panel</h2><p><code>NSTextView</code> has built-in support for text tables, which provides the easiest way to add table support to your text view. This table support is in the form of the action method <code><a href="../../../Reference/ApplicationKit/Classes/NSTextView_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextView/orderFrontTablePanel:" target="_top">orderFrontTablePanel:</a></code>. <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_17"></a> This method inserts a table into the text view and opens a modeless utility window that floats over the application windows. This table panel enables the user to manipulate attributes of a table while the cursor or selection is in the table. The table panel is shown in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW7">“Text table panel.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP40001900-GB4049473" title="Figure 1Text table panel"></a><p><a name="//apple_ref/doc/uid/TP40001900-SW7" title="Figure 1Text table panel"></a><strong>Figure 1&nbsp;&nbsp;</strong>Text table panel</p><img src = "Art/tablepanel.gif" alt = "Text table panel" width="255" height="337"></div><br/><p>The user can change other aspects of the table, such as cell size and contents, by direct manipulation with the cursor.</p><p>To make the text table panel available in your text view, use Interface Builder to add the <code>orderFrontTablePanel:</code> action method to your first responder and connect it to a menu item, as shown in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW6">“Connecting the action method.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP40001900-GB3380593" title="Figure 2Connecting the action method"></a><p><a name="//apple_ref/doc/uid/TP40001900-SW6" title="Figure 2Connecting the action method"></a><strong>Figure 2&nbsp;&nbsp;</strong>Connecting the action method</p><img src = "Art/actionmethod.gif" alt = "Connecting the action method" width="678" height="404"></div><br/><p><code>NSTextView</code> defines similar action methods for opening list, link, and paragraph spacing panels.</p><a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_2" title="Supporting Text Tables Programmatically"></a><h2>Supporting Text Tables Programmatically</h2><p>If you don’t want to use the text table panel, you can support tables programmatically by using <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_18"></a> <code>NSTextTable</code> and related classes directly. The basic class in this group is <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_19"></a> <code>NSTextBlock</code>, which represents a block of text laid out in a subregion of a text container. When working with tables, you use its subclass, <code>NSTextTableBlock</code>, which represents a text block that appears as a cell in a table. The table itself is represented by a separate class, <code>NSTextTable</code>. All of the <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_20"></a> <code>NSTextTableBlock</code> objects, representing the cells in the table, refer to the <code>NSTextTable</code> object, which controls their size and positioning.</p><p>Text blocks appear as attributes on paragraphs, as part of the paragraph style. An <code>NSParagraphStyle</code> object can have an array of text blocks representing the table cells that contain the paragraph. The paragraph style uses an array because table cells can be nested, and the text blocks are ordered in the array from outermost to innermost. For example, if block1 contains four paragraphs, and the middle two are also in inner block2, then the text blocks array for first and fourth paragraphs is (block1) which the array for the second and third paragraphs is (block1, block2). </p><p>You add text blocks to a paragraph style object using the <code>NSMutableParagraphStyle</code> method <code>setTextBlocks:</code> , and the <code>NSParagraphStyle</code> method <code>textBlocks</code> returns the array.</p><p>To implement a text table programmatically, use the following sequence of steps:</p><ol class="ol"><li class="li"><p>Create an attributed string for the table.</p></li><li class="li"><p>Create the table object, setting the number of columns.</p></li><li class="li"><p>Create the text table block for the first cell of the row, referring to the table object.</p></li><li class="li"><p>Set the attributes for the text block.</p></li><li class="li"><p>Create a paragraph style object for the cell, setting the text block as an attribute (along with any other paragraph attributes, such as alignment).</p></li><li class="li"><p>Create an attributed string for the cell, adding the paragraph style as an attribute. The cell string must end with a paragraph marker, such as a newline character.</p></li><li class="li"><p>Append the cell string to the table string.</p></li><li class="li"><p>Repeat steps 3–7 for each cell in the table.</p></li></ol><p>The methods shown in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW3">“Table creation method”</a></span> and <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW4">“Table cell creation method”</a></span> perform the steps from the preceding list. (All of the example methods in this article are defined in the <code>NSDocument</code> subclass of a document-based application, but they could as easily belong to another object, such as a text view.)  <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW4">“Table cell creation method”</a></span> performs steps 3–6 for each cell in the table, using fat borders and contrasting colors for illustrative purposes.</p><a name="//apple_ref/doc/uid/TP40001900-GB76305377" title="Listing 1Table creation method"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001900-SW3" title="Listing 1Table creation method"></a><strong>Listing 1&nbsp;&nbsp;</strong>Table creation method</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSMutableAttributedString *) tableAttributedString<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // tableString is an ivar declared in the header file as NSMutableAttributedString *tableString;<span></span></pre></td></tr><tr><td scope="row"><pre>    tableString = [[NSMutableAttributedString alloc] initWithString:@"\n\n"];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTextTable *table = [[NSTextTable alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    [table setNumberOfColumns:2];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [tableString appendAttributedString:[self tableCellAttributedStringWithString:@"Cell1\n"<span></span></pre></td></tr><tr><td scope="row"><pre>        table:table<span></span></pre></td></tr><tr><td scope="row"><pre>        backgroundColor:[NSColor greenColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        borderColor:[NSColor magentaColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        row:0<span></span></pre></td></tr><tr><td scope="row"><pre>        column:0]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [tableString appendAttributedString:[self tableCellAttributedStringWithString:@"Cell2\n"<span></span></pre></td></tr><tr><td scope="row"><pre>        table:table<span></span></pre></td></tr><tr><td scope="row"><pre>        backgroundColor:[NSColor yellowColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        borderColor:[NSColor blueColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        row:0<span></span></pre></td></tr><tr><td scope="row"><pre>        column:1]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [tableString appendAttributedString:[self tableCellAttributedStringWithString:@"Cell3\n"<span></span></pre></td></tr><tr><td scope="row"><pre>        table:table<span></span></pre></td></tr><tr><td scope="row"><pre>        backgroundColor:[NSColor lightGrayColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        borderColor:[NSColor redColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        row:1<span></span></pre></td></tr><tr><td scope="row"><pre>        column:0]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [tableString appendAttributedString:[self tableCellAttributedStringWithString:@"Cell4\n"<span></span></pre></td></tr><tr><td scope="row"><pre>        table:table<span></span></pre></td></tr><tr><td scope="row"><pre>        backgroundColor:[NSColor cyanColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        borderColor:[NSColor orangeColor]<span></span></pre></td></tr><tr><td scope="row"><pre>        row:1<span></span></pre></td></tr><tr><td scope="row"><pre>        column:1]];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    [table release];<span></span></pre></td></tr><tr><td scope="row"><pre>    return [tableString autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40001900-GB76070849" title="Listing 2Table cell creation method"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40001900-SW4" title="Listing 2Table cell creation method"></a><strong>Listing 2&nbsp;&nbsp;</strong>Table cell creation method</p><div class="codesample"><table><tr><td scope="row"><pre>- (NSMutableAttributedString *) tableCellAttributedStringWithString:(NSString *)string<span></span></pre></td></tr><tr><td scope="row"><pre>        table:(NSTextTable *)table<span></span></pre></td></tr><tr><td scope="row"><pre>        backgroundColor:(NSColor *)backgroundColor<span></span></pre></td></tr><tr><td scope="row"><pre>        borderColor:(NSColor *)borderColor<span></span></pre></td></tr><tr><td scope="row"><pre>        row:(int)row<span></span></pre></td></tr><tr><td scope="row"><pre>        column:(int)column<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTextTableBlock *block = [[NSTextTableBlock alloc]<span></span></pre></td></tr><tr><td scope="row"><pre>        initWithTable:table<span></span></pre></td></tr><tr><td scope="row"><pre>        startingRow:row<span></span></pre></td></tr><tr><td scope="row"><pre>        rowSpan:1<span></span></pre></td></tr><tr><td scope="row"><pre>        startingColumn:column<span></span></pre></td></tr><tr><td scope="row"><pre>        columnSpan:1];<span></span></pre></td></tr><tr><td scope="row"><pre>    [block setBackgroundColor:backgroundColor];<span></span></pre></td></tr><tr><td scope="row"><pre>    [block setBorderColor:borderColor];<span></span></pre></td></tr><tr><td scope="row"><pre>    [block setWidth:4.0 type:NSTextBlockAbsoluteValueType forLayer:NSTextBlockBorder];<span></span></pre></td></tr><tr><td scope="row"><pre>    [block setWidth:6.0 type:NSTextBlockAbsoluteValueType forLayer:NSTextBlockPadding];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableParagraphStyle *paragraphStyle =<span></span></pre></td></tr><tr><td scope="row"><pre>        [[NSParagraphStyle defaultParagraphStyle] mutableCopy];<span></span></pre></td></tr><tr><td scope="row"><pre>    [paragraphStyle setTextBlocks:[NSArray arrayWithObjects:block, nil]];<span></span></pre></td></tr><tr><td scope="row"><pre>    [block release];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    NSMutableAttributedString *cellString =<span></span></pre></td></tr><tr><td scope="row"><pre>        [[NSMutableAttributedString alloc] initWithString:string];<span></span></pre></td></tr><tr><td scope="row"><pre>    [cellString addAttribute:NSParagraphStyleAttributeName<span></span></pre></td></tr><tr><td scope="row"><pre>        value:paragraphStyle<span></span></pre></td></tr><tr><td scope="row"><pre>        range:NSMakeRange(0, [cellString length])];<span></span></pre></td></tr><tr><td scope="row"><pre>    [paragraphStyle release];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return [cellString autorelease];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The code in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW3">“Table creation method”</a></span> and <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW4">“Table cell creation method”</a></span> produces the table shown in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW5">“Table output.”</a></span></p><br/><div><a name="//apple_ref/doc/uid/TP40001900-SW1" title="Figure 3Table output"></a><p><a name="//apple_ref/doc/uid/TP40001900-SW5" title="Figure 3Table output"></a><strong>Figure 3&nbsp;&nbsp;</strong>Table output</p><img src = "Art/table.gif" alt = "Table output" width="367" height="173"></div><br/><p>To insert the table in text displayed in a text view, implement an action method such as the one shown in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW2">Listing 3</a></span>. This method inserts the table string constructed in <span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW3">“Table creation method”</a></span> in the text view, replacing the current selection (or at the insertion point, if there's no selection), and ensures that the proper notifications and delegate messages are sent. <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_21"></a></p><a name="//apple_ref/doc/uid/TP40001900-SW2" title="Listing 3Table insertion action method"></a><p class="codesample"><strong>Listing 3&nbsp;&nbsp;</strong>Table insertion action method</p><div class="codesample"><table><tr><td scope="row"><pre>- (void) insertMyTable:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    NSRange charRange = [myTextView rangeForUserTextChange];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSTextStorage *myTextStorage = [myTextView textStorage];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ([myTextView isEditable] &amp;&amp; charRange.location != NSNotFound)<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            NSMutableAttributedString *attrStringToInsert = [self tableAttributedString];<span></span></pre></td></tr><tr><td scope="row"><pre>            if ([myTextView shouldChangeTextInRange:charRange replacementString:nil])<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    [myTextStorage replaceCharactersInRange:charRange<span></span></pre></td></tr><tr><td scope="row"><pre>                        withAttributedString:attrStringToInsert];<span></span></pre></td></tr><tr><td scope="row"><pre>                    [myTextView setSelectedRange:NSMakeRange(charRange.location, 0)<span></span></pre></td></tr><tr><td scope="row"><pre>                        affinity:NSSelectionAffinityUpstream stillSelecting:NO];<span></span></pre></td></tr><tr><td scope="row"><pre>                    [myTextView didChangeText];<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p><code>NSAttributedString</code> has the following convenience methods you can use to determine the range in the string that is covered by a text block or table:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/rangeOfTextBlock:atIndex:" target="_top">rangeOfTextBlock:atIndex:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/rangeOfTextTable:atIndex:" target="_top">rangeOfTextTable:atIndex:</a></code></p><p>If the given location is not in the specified block or table, these methods return a range of <code>(NSNotFound, 0)</code> .</p><a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_3" title="The Text Table Model"></a><h2>The Text Table Model</h2><p>The Cocoa text table model is derived primarily from the table model defined by <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_22"></a> HTML and <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_23"></a> CSS, in which tables are built up from rows of cells. For a description of the CSS table model, refer to the following URL:</p><p><span class="content_text"><a href="http://www.w3.org/TR/CSS21/tables.html" target="_blank">http://www.w3.org/TR/CSS21/tables.html</a></span></p><p>This affinity provides another way to create tables in text. You can define a table in HTML and use that data to initialize an attributed string. The attributes of that string then define the table for rendering by the Cocoa text system. You can use the following <code>NSAttributedString</code> initialization methods for this purpose:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/initWithHTML:documentAttributes:" target="_top">initWithHTML:documentAttributes:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/initWithHTML:options:documentAttributes:" target="_top">initWithHTML:options:documentAttributes:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/initWithHTML:baseURL:documentAttributes:" target="_top">initWithHTML:baseURL:documentAttributes:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSAttributedString_AppKitAdditions/Reference/Reference.html#//apple_ref/occ/instm/NSAttributedString/initWithData:options:documentAttributes:error:" target="_top">initWithData:options:documentAttributes:error:</a></code></p><a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_4" title="Controlling Text Block Appearance"></a><h2>Controlling Text Block Appearance</h2><p>The position of a text block is determined by its text container or containing block. In the case of a text table block, which represents a cell in a table, size and position are controlled by the text table and the block’s relation to other blocks in the table. When you initialize an <code>NSTextTableBlock</code> object, you specify its row and column position as a cell within its table, and you also specify whether it spans multiple rows or columns. The <code>NSTextTable</code> initialization method is:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextTableBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextTableBlock/initWithTable:startingRow:rowSpan:startingColumn:columnSpan:" target="_top">initWithTable:startingRow:rowSpan:startingColumn:columnSpan:</a></code></p><p><span class="content_text"><a href="TextTables.html#//apple_ref/doc/uid/TP40001900-SW4">“Table cell creation method”</a></span> shows this method in use.</p><p>In addition, you can specify the value of a number of dimensions for each block, either as an absolute value or as a percentage of the containing block. These dimensions include the following:</p><ul class="ul"><li class="li"><p>Width</p></li><li class="li"><p>Height</p></li><li class="li"><p>Minimum width</p></li><li class="li"><p>Minimum height</p></li><li class="li"><p>Maximum width</p></li><li class="li"><p>Maximum height</p></li><li class="li"><p>Padding width for each of the four sides. Padding is space surrounding the content area of the block, extending to the border.</p></li><li class="li"><p>Border width for each of the four sides. A border is space between the padding and the margin, typically colored to present a visible boundary.</p></li><li class="li"><p>Margin width for each of the four sides. The margin is space surrounding the border.</p></li></ul><p>The default value for each of these dimensions is <code>0</code> , indicating no padding, border, or margin, and the natural width and height. Natural width and height of a single text block extend to the width and height of its containing block (or text container); natural width and height of multiple blocks divide the space of their containing block evenly.</p><p>The following methods specify or return values associated with these dimensions:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setValue:type:forDimension:" target="_top">setValue:type:forDimension:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/valueForDimension:" target="_top">valueForDimension:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/valueTypeForDimension:" target="_top">valueTypeForDimension:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setWidth:type:forLayer:" target="_top">setWidth:type:forLayer:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setWidth:type:forLayer:edge:" target="_top">setWidth:type:forLayer:edge:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/widthForLayer:edge:" target="_top">widthForLayer:edge:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/widthValueTypeForLayer:edge:" target="_top">widthValueTypeForLayer:edge:</a></code></p><p>In these methods, the value type refers to absolute or percentage values. The dimension refers to minimum, maximum, and full width and height of the block. The layer refers to padding, border, and margin. These parameters are specified by constants described in <code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/cl/NSTextBlock" target="_top">NSTextBlock.</a></code></p><p><code>NSTextBlock</code> provides the following methods to specify and return the background and border color of the block:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/backgroundColor" target="_top">backgroundColor</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setBackgroundColor:" target="_top">setBackgroundColor:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/borderColorForEdge:" target="_top">borderColorForEdge:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setBorderColor:forEdge:" target="_top">setBorderColor:forEdge:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/setBorderColor:" target="_top">setBorderColor:</a></code></p><p>By default the color values are <code>nil</code> , meaning no color. Note that a border with no color is invisible.</p><p></p><a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_5" title="Table Layout Process"></a><h2>Table Layout Process</h2><p>During <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_24"></a> text layout, the typesetter works with <code>NSTextBlock</code> to determine the layout rectangles for the text block. If the text block is an instance of <code>NSTextTableBlock</code>, it calls its containing <code>NSTextTable</code> instance to perform the calculations. The typesetter stores the results of these calculations in its layout manager. There are methods in <code>NSTextBlock</code>, <code>NSTextTable</code>, and <code>NSLayoutManager</code> specific to this layout process that you can use if you need to intervene in the process.</p><p>To begin the text block layout process, the typesetter proposes a large rectangle within which the text block should fit. For the outermost block, this is determined by the text container; for inner blocks, it is determined by the containing block. The block object then decides what area within the proposed rectangle it should actually occupy.</p><p>The text block actually determines two rectangles: first, the layout rectangle, within which the text in the block is to be laid out; second, the bounds rectangle, which contains additional space for padding, borders, border decoration, and margins. The text block calculates the layout rectangle immediately before the typesetter lays out the first glyph because it is needed for all subsequent layout of text in the block. The layout rectangle is often quite tall because, at this point, the height of the text to be laid out has not yet been determined. The text block calculates the bounds rectangle immediately after the last glyph in the block has been laid out, and it is based on the actual rectangle used for the text within the block. Under some circumstances, the bounds rectangle may be adjusted subsequently as additional blocks in the same table are laid out.</p><p>To find the layout and bounds rectangles, the typesetter calls the following <code>NSTextBlock</code> methods:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/rectForLayoutAtPoint:inRect:textContainer:characterRange:" target="_top">rectForLayoutAtPoint:inRect:textContainer:characterRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/boundsRectForContentRect:inRect:textContainer:characterRange:" target="_top">boundsRectForContentRect:inRect:textContainer:characterRange:</a></code></p><p>An <code>NSTextTableBlock</code> object, in turn, calls its <code>NSTextTable</code> object to perform these calculations, using the following methods:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextTable_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextTable/rectForBlock:layoutAtPoint:inRect:textContainer:characterRange:" target="_top">rectForBlock:layoutAtPoint:inRect:textContainer:characterRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextTable_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextTable/boundsRectForBlock:contentRect:inRect:textContainer:characterRange:" target="_top">boundsRectForBlock:contentRect:inRect:textContainer:characterRange:</a></code></p><p>The typesetter stores the results of these methods in the layout manager using the following methods:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/setLayoutRect:forTextBlock:glyphRange:" target="_top">setLayoutRect:forTextBlock:glyphRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/setBoundsRect:forTextBlock:glyphRange:" target="_top">setBoundsRect:forTextBlock:glyphRange:</a></code></p><p>The typesetter uses the following <code>NSLayoutManager</code> methods when it needs to determine the space used by previously laid text blocks: </p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/layoutRectForTextBlock:glyphRange:" target="_top">layoutRectForTextBlock:glyphRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/layoutRectForTextBlock:atIndex:effectiveRange:" target="_top">layoutRectForTextBlock:atIndex:effectiveRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/boundsRectForTextBlock:glyphRange:" target="_top">boundsRectForTextBlock:glyphRange:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/boundsRectForTextBlock:atIndex:effectiveRange:" target="_top">boundsRectForTextBlock:atIndex:effectiveRange:</a></code></p><p>The preceding methods cause glyph generation but do not force layout. This avoids an infinite recursion when the methods are called during layout. For the same reason, the following variants of existing <code>NSLayoutManager</code> methods have an option to prevent them from causing layout:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/lineFragmentRectForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:" target="_top">lineFragmentRectForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/lineFragmentUsedRectForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:" target="_top">lineFragmentUsedRectForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:</a></code></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSLayoutManager_Class/Reference/Reference.html#//apple_ref/occ/instm/NSLayoutManager/textContainerForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:" target="_top">textContainerForGlyphAtIndex:effectiveRange:withoutAdditionalLayout:</a></code></p><p>If no rectangle has been set, the preceding methods return <code>NSZeroRect</code> .</p><p>At display time the text is drawn as usual, as described in “<span class="content_text"><a href="../Concepts/LayoutManager.html#//apple_ref/doc/uid/20001805-BBCFEBHA">“The Layout Manager,”</a></span>” except that the text block draws background and border decoration while glyph backgrounds are being drawn, using the following method:</p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextBlock_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextBlock/drawBackgroundWithFrame:inView:characterRange:layoutManager:" target="_top">drawBackgroundWithFrame:inView:characterRange:layoutManager:</a></code></p><p>If the text block is an <code>NSTextTableBlock</code> object, it calls its text table for this purpose, using the following <code>NSTextTable</code> method: <a name="//apple_ref/doc/uid/TP40001900-DontLinkElementID_25"></a></p><p><code><a href="../../../Reference/ApplicationKit/Classes/NSTextTable_Class/Reference/Reference.html#//apple_ref/occ/instm/NSTextTable/drawBackgroundForBlock:withFrame:inView:characterRange:layoutManager:" target="_top">drawBackgroundForBlock:withFrame:inView:characterRange:layoutManager:</a></code></p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Tasks/CountLines.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/TextLayout/Articles/TextTables.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/TextLayout/Articles/TextTables.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/TextLayout/Articles/TextTables.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
