<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Handling Object Picking</TITLE></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><H1 CLASS="H2.Heading2"><A NAME="pgfId=3496"> </A>Handling Object Picking</H1><P CLASS="T1.Text1"><A NAME="pgfId=3500"> </A><A HREF="qd3dpicking.8.htm#38058" CLASS="XRef">Listing&nbsp;5</A> illustrates how to create, use, and dispose of pick objects. It defines a function, <TT CLASS="cv">MyHandleClickInWindow</TT>, that takes a window pointer and an event record and handles mouse clicks in that window.</P><P CLASS="L.Listing"><A NAME="pgfId=3502"> </A>Listing&nbsp;5<A NAME="38058"> </A>Picking objects</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16240"> </A>TQ3Status MyHandleClickInWindow (CGrafPtr myWindow, EventRec myEvent)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3WindowPointPickData&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3PickObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myPickObject;<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myNumHits;<BR>&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myIndex;<BR>&nbsp;&nbsp;&nbsp;&nbsp;Point&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myPoint;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3Point2D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my2DPoint;<BR>&nbsp;&nbsp;&nbsp;&nbsp;TQ3ViewObject&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myView;<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16246"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Get the window coordinates of a mouse click.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;SetPort(myWindow);<BR>&nbsp;&nbsp;&nbsp;&nbsp;myPoint = myEvent.where;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*get location of mouse click*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;GlobalToLocal(&amp;myPoint);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*convert to window coordinates*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;my2DPoint.x = myPoint.h;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*configure a 2D point*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;my2DPoint.y = myPoint.v;<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16252"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Set up picking data structures.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;/*Set sorting type: objects nearer to pick origin are returned first.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.data.sort = kQ3PickSortNearToFar;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.data.mask = kQ3PickDetailMaskPickID | kQ3PickDetailMaskXYZ | <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kQ3PickDetailMaskObject;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.data.numHitsToReturn = kQ3ReturnAllHits;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.point = my2DPoint;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.vertexTolerance = 2.0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myWPPickData.edgeTolerance = 2.0;<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16258"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Create a new window-point pick object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;myPickObject = Q3WindowPointPick_New(&amp;myWPPickData);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16264"> </A>&nbsp;&nbsp;&nbsp;&nbsp;myView = MyGetViewFromWindow(myWindow);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*increments reference count*/<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16270"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Pick a group object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3View_StartPicking(myView, myPickObject);<BR>&nbsp;&nbsp;&nbsp;&nbsp;do {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3DisplayGroup_Submit(gGroup, myView);<BR>&nbsp;&nbsp;&nbsp;&nbsp;} while (Q3View_EndPicking(myView) == kQ3ViewStatusRetraverse);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16276"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*See whether any hits occurred.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;if (Q3Pick_GetNumHits(myPickObject, &amp;myNumHits) == kQ3Failure || myNumHits==0) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(myPickObject);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16282"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/* Process each hit */<BR>&nbsp;&nbsp;&nbsp;&nbsp;for (myIndex = 0; myIndex = myNumHits; myIndex++) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TQ3Point3D&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xyzPoint;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned long&nbsp;&nbsp;&nbsp;pickID;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TQ3Object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object;<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16288"> </A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Get validMask first */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (Q3Pick_GetPickDetailValidMask(myPickObject, myIndex, &amp;validMask) <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== kQ3Failure) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16294"> </A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (! ((validMask &amp; kQ3PickDetailMaskXYZ)     &amp;&amp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   (validMask &amp; kQ3PickDetailMaskPickID)  &amp;&amp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   (validMask &amp; kQ3PickDetailMaskObject))) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16300"> </A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Get world space intersection, pick ID, and geometry object reference */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object = NULL;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status = Q3Pick_GetPickDetailData (myPickObject, myIndex,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kQ3PickDetailMaskXYZ, &amp;xyzPoint);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status = Q3Pick_GetPickDetailData (myPickObject, myIndex,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kQ3PickDetailMaskPickID, &amp;pickID);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;status = Q3Pick_GetPickDetailData (myPickObject, myIndex,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kQ3PickDetailMaskObject, &amp;object);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16306"> </A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/* Operate on xyzPoint, pickID, and object */<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16312"> </A>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (object != NULL) {<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(object);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16318"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Dispose of all hits in the hit list.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3Pick_EmptyHitList(myPickObject);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16324"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Dispose of the pick object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(myPickObject);<BR></CODE><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=16330"> </A>&nbsp;&nbsp;&nbsp;&nbsp;/*Dispose of the view object.*/<BR>&nbsp;&nbsp;&nbsp;&nbsp;Q3Object_Dispose(myView);<BR>}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=3506"> </A><A NAME="marker=16332"> </A>Note that the call to <TT CLASS="cv">Q3Pick_EmptyHitList</TT> is redundant, because disposing of a pick object (by calling <TT CLASS="cv">Q3Object_Dispose</TT>) also disposes of its associated hit list. The call is included in <A HREF="qd3dpicking.8.htm#38058" CLASS="XRef">Listing&nbsp;5</A> simply to illustrate how to call <TT CLASS="cv">Q3Pick_EmptyHitList</TT>. You would, however, need to call to <TT CLASS="cv">Q3Pick_EmptyHitList</TT> if you wanted to reuse the associated pick object in another pick operation.</P><hr>&#169; 1997 Apple Computer, Inc.</DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>