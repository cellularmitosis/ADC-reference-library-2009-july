<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>CustomPutSuffix - /CustomPutSuffix.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; <A HREF="javascript:location.replace('index.html');">CustomPutSuffix</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxFileManagement-date.html" target="_blank">Carbon > File Management</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">CustomPutSuffix</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/CustomPutSuffix.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/CustomPutSuffix.c</option>
<option value="listing2.html">/InitMac.c</option>
<option value="listing3.html">/InitMac.h</option></select>
				</p>
				</form>
				<p><strong><a href="CustomPutSuffix.zip">Download Sample</a></strong> (&#147;CustomPutSuffix.zip&#148;, 17.9K)<BR>
<strong><a href="CustomPutSuffix.dmg">Download Sample</a></strong> (&#147;CustomPutSuffix.dmg&#148;, 77.9K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  File:    CustomPutSuffix.c  Contains:  This demonstrates a CustomPutDialog with an Save button that checks        to see if several files (with the name filename+suffix) already exist.        a dialog hook procedure is responsible for presenting separate &quot;Replace?&quot;           dialogs.  When the Save button is hit and, if the user allows the save,        the Save action is map to a Cancel action but the reply is marked as good.  Written by: David Hayward    Copyright:  Copyright &copy; 1993-1999 by Apple Computer, Inc., All Rights Reserved.        You may incorporate this Apple sample source code into your program(s) without        restriction. This Apple sample source code has been provided &quot;AS IS&quot; and the        responsibility for its operation is yours. You are not permitted to redistribute        this Apple sample source code as &quot;Apple sample source code&quot; after having made        changes. If you're going to re-distribute the source, we require that you make        it clear in the source that the code was descended from Apple sample source        code, but that you've made changes.  Change History (most recent first):        7/1/1999  Karl Groethe  Updated for Metrowerks Codewarror Pro 2.1        5/12/95            updated project for Metrowerks        5/3/93            first draft*/#include &lt;stddef.h&gt;#include &lt;QuickDraw.h&gt;#include &lt;Memory.h&gt;#include &lt;Files.h&gt;#include &lt;Errors.h&gt;#include &lt;Fonts.h&gt;#include &lt;Resources.h&gt;#include &lt;StandardFile.h&gt;#include &lt;Files.h&gt;#include &lt;Dialogs.h&gt;#include &lt;TextUtils.h&gt;#include &quot;InitMac.h&quot;/**\|**| ==============================================================================|**| DEFINES|**| ==============================================================================\**/#define  outputDlogID    128#define  outputQuit      1#define  outputAgain      2#define  replaceDlogID    6045#define  replaceCancel    1#define  replaceOK      2#define  SuffixID      128/**\|**| ==============================================================================|**| TYPEDEFS|**| ==============================================================================\**//*------------------------------------------------------------------------------*\  myData *------------------------------------------------------------------------------*    the 'myData' structure is passed to CustomPutFile() so that     MyDlgHook() can access the list of suffixes and return the results \*------------------------------------------------------------------------------*/typedef struct myData{  StandardFileReply    *replyPtr;  /* we also need to pass in the SFR so that */                    /* MyDlgHook() knows what user specified in */                    /* the CustomPutFile dialog */  short          num;    /* the number of entries in the array */    struct  {                  /* struct for each suffix to check */    Str63  suffix;          /* suffix string to append */    FSSpec spec;          /* FSSpec for the file */    FInfo  info;          /* returned info and err just in case */    OSErr  err;            /* we need this information later */  }            files[];  /* variable length array of the above */} myData, *myDataPtr;/**\|**| ==============================================================================|**| FUNCTION PROTOTYPES|**| ==============================================================================\**/void      AppendStrToStr    ( StringPtr dst, StringPtr src, unsigned char maxDstLen );void      AppendStrToHdl    ( Handle dst, StringPtr src );pascal short  MyDlgHook      ( short item, DialogPtr theDialog, void *data );short      myReplaceAlert    ( myDataPtr dataPtr );short      outputDlog      ( myDataPtr dataPtr );void      initializeData    ( myDataPtr *dataPtr, StandardFileReply *replyPtr );void      main        ( void );/*------------------------------------------------------------------------------*\  AppendStrToStr() *------------------------------------------------------------------------------*    utility function to append one string to another    this function should be improved to handle errors\*------------------------------------------------------------------------------*/void AppendStrToStr ( StringPtr dst, StringPtr src, unsigned char maxDstLen ){  short    offset = dst[0]+1;  short    size   = src[0];    if ( dst[0] + src[0] &gt; maxDstLen)      // make sure were not too big    size = maxDstLen - dst[0];        // you should return a warning here  BlockMove( src+1, dst+offset, size);  dst[0] += size;}  /*------------------------------------------------------------------------------*\  AppendStrToHdl() *------------------------------------------------------------------------------*    utility function to append a string to a handle    this function should be improved to handle errors\*------------------------------------------------------------------------------*/void AppendStrToHdl ( Handle dst, StringPtr src ){  short    size = src[0];  PtrAndHand( src+1, dst, size);}  /*------------------------------------------------------------------------------*\  MyDlgHook() *------------------------------------------------------------------------------*    the dialog hook procedure responsible for presenting my own &quot;Replace?&quot;     dialogs when the Save button is hit and, if the user allows the save,    then map the Save action to a Cancel action but mark the reply as good.\*------------------------------------------------------------------------------*/pascal short MyDlgHook ( short item, DialogPtr theDialog, void *data ){  long            refCon;  short            r;  refCon = GetWRefCon((WindowPtr)theDialog);      /* get the refCon of the current dialog */  if (refCon == sfMainDialogRefCon)          /* if its the &quot;Save As&quot; dialog */  {    if (item == sfItemOpenButton)          /* if user hit Save button */    {      r = myReplaceAlert((myDataPtr)data);    /* present my &quot;Replce? dialogs */      if ( r == replaceCancel )          /* if user hit a Cancel button */        item = sfHookNullEvent;          /* then do nothing */      else                    /* if user hit replace button */      {                      /* then user wants to save so...*/        item  = sfItemCancelButton;        /* change to Cancel action but */         ((myDataPtr)data)-&gt;replyPtr-&gt;sfGood = 1;/* mark reply as good */      }    }  }    return item;}/*------------------------------------------------------------------------------*\  myReplaceAlert() *------------------------------------------------------------------------------*    this routine, called from MyDlgHook(), presents a &quot;Replce? dialog    for any filename+suffix that already exist.  If one of these    dialogs is canceles then this procedure returns 'cancel'\*------------------------------------------------------------------------------*/short myReplaceAlert ( myDataPtr dataPtr ){  short    i, item;  OSErr    err;  FSSpec    spec;  FInfo    info;    for (i=0; i&lt;dataPtr-&gt;num; i++)            /* loop thru each suffix in dataPtr ... */  {    spec = dataPtr-&gt;replyPtr-&gt;sfFile;        /* spec starts out as the FSSpec (vRefNum, */                            /* parID &amp; name) the user specified in the */                            /* CustomPutFile dialog  */        AppendStrToStr( spec.name,            dataPtr-&gt;files[i].suffix, 63);  /* append suffix to filename */    err = FSpGetFInfo(&amp;spec, &amp;info);        /* try to get info for this spec */        dataPtr-&gt;files[i].spec = spec;          /* save the spec, info &amp; err for this */    dataPtr-&gt;files[i].info = info;          /* file in dataPtr just in case we need  */    dataPtr-&gt;files[i].err = err;          /* this information later */     if (err == 0)                  /* filename+suffix already exists so.. */     {      ParamText( spec.name, nil, nil, nil);    /* setup param text for &quot;Replace?&quot; alert*/      item = Alert(replaceDlogID,nil);      /* put up alert */      if (item == replaceCancel)          /* if user hit cancel button */        return replaceCancel;          /* then stop and return 'cancel' */    }    else if (err == fnfErr)              /* if filename+suffix doesn't exist */    {      /* all you need to do in here is make sure that filename+suffix */      /* isn't a directory and put up an an alert if it is */    }    else                      /* if some other err was returned ... */    {      /* here you need to handle other errors such as 'badNamErr' */    }  }  return replaceOK;}/*------------------------------------------------------------------------------*\  outputDlog() *------------------------------------------------------------------------------*    output vital stats of the StandardFileReply to an dialog box\*------------------------------------------------------------------------------*/short outputDlog ( myDataPtr dataPtr ){  DialogPtr  dlg;  Rect    iRect;  Handle    iHndl;  short    iType;  short    item;  short    i;    dlg = GetNewDialog(outputDlogID, nil, (WindowPtr)-1);    GetDialogItem( dlg, 3, &amp;iType, &amp;iHndl, &amp;iRect );      /* get handle to static text field */  if (dataPtr-&gt;replyPtr-&gt;sfGood == 0)          /* if reply is not good */    AppendStrToHdl (iHndl, &quot;\pUser canceled.&quot;);  else  {    for (i=0; i&lt;dataPtr-&gt;num; i++)          /* loop thru each suffix in dataPtr ... */    {      AppendStrToHdl( iHndl, dataPtr-&gt;files[i].spec.name);   /* append filename */            if ( dataPtr-&gt;files[i].err == 0)      /* if filename+suffix already exists */        AppendStrToHdl( iHndl, &quot;\p (exists)&quot;);  /* append (exists) */      else if ( dataPtr-&gt;files[i].err != fnfErr)        AppendStrToHdl( iHndl, &quot;\p (error)&quot;);  /* append (error) */        AppendStrToHdl( iHndl, &quot;\p\r&quot;);        /* append CR */    }  }    ShowWindow( dlg );    do  {    ModalDialog(0,&amp;item);  } while ( (item != outputAgain) &amp;&amp; (item != outputQuit));    DisposeDialog(dlg);    return item;}/*------------------------------------------------------------------------------*\  initializeData() *------------------------------------------------------------------------------*    initialize data stucture to be passed to CustomPutFile    this means alocating a pointer of the right size and filling     in the suffix strings from the apps resource fork \*------------------------------------------------------------------------------*/void initializeData ( myDataPtr *dataPtr, StandardFileReply *replyPtr ){  short  i=0, num=0;  Str255  temp;    do                        /* figure out how many suffixes */   {                        /* are in the apps resource fork */    GetIndString( temp, SuffixID, num+1);    num++;  } while (temp[0] !=0);              /* if temp[0]==0 then no more */  num--;                      /* counted 1 too many so decrement */                            /* allocate myDataPtr stucture */  *dataPtr = (myDataPtr) NewPtrClear ( offsetof(myData,files[num]) );    (**dataPtr).replyPtr = replyPtr;        /* fill in StandardFileReply ptr */   (**dataPtr).num = num;              /* fill in num of suffixes */   for (i=0; i&lt;num; i++)              /* fill in suffix strings */       GetIndString( (**dataPtr).files[i].suffix, SuffixID, i+1);}/*------------------------------------------------------------------------------*\  main() *------------------------------------------------------------------------------*    initialize mamagers and the keep doing     CustomPutFile until the user has had enough    the structure 'dataPtr' is passed to CustomPutFile() so that     MyDlgHook() can access the list of suffixes and return the results \*------------------------------------------------------------------------------*/void main ( void ){  myDataPtr      dataPtr;  StandardFileReply  reply;  Point        where = {-1,-1};      /* center dialog on main screen */    InitToolBox(2);    initializeData (&amp;dataPtr, &amp;reply);    do  {    CustomPutFile(  &quot;\pSave files as:&quot;,      /* the prompt string */            &quot;\pUntitled&quot;,        /* the default filename */            &amp;reply,            /* the StandardFileReply structure */            0,              /* the default dialog */            where,            /* position of dialog on screen */            NewDlgHookYDProc(MyDlgHook),/* the Dialog Hook procedure */            nil,            /* no modal dialog filterProc */            nil,            /* no activeListPtr */            nil,            /* no activateProc */            dataPtr            /* pass in myDataPtr struct so that */            );              /* dlgHook() can access its contents */  }                                while (outputDlog(dataPtr)==outputAgain);    /* repeat until user has had enough */    DisposePtr( (Ptr)dataPtr);}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/CustomPutSuffix/listing1.html%3Fid%3DDTS10000046-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/CustomPutSuffix/listing1.html%3Fid%3DDTS10000046-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/CustomPutSuffix/listing1.html%3Fid%3DDTS10000046-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>