<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Interactive Movies: Authoring Wired Movies and Sprite Animations</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Authoring Wired Movies and Sprite Animations"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40000883-CH208" title="Authoring Wired Movies and Sprite Animations"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../index.html#//apple_ref/doc/uid/TP30000440-TP30000433" target="_top">QuickTime</a> &gt; <a href="../../WiredMoviesandSprites-date.html#//apple_ref/doc/uid/TP30000440-TP30000433-TP30000594" target="_top">Wired Movies and Sprites</a> &gt; <a href="../preface/QT_Interactive_preface.html#//apple_ref/doc/uid/TP40000883-CH204-DontLinkElementID_69">Interactive Movies</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../spritemediahandler/3-Sprite-Media-Handler.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../usingspriteanimation/5-Using-Sprite-Anim.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_4" title="Authoring Wired Movies and Sprite Animations"></a><h1><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIDCFEG" title="Authoring Wired Movies and Sprite Animations"></a>Authoring Wired Movies and Sprite Animations</h1><p>This chapter describes how you can author wired movies and sprite animations using the sprite media handler. You need to be familiar with the material in the previous two chapters, <span class="content_text"><a href="../introwiredsprites/2-Intro-Wired-Sprites.html#//apple_ref/doc/uid/TP40000883-CH206-BAJFCHFE">“Chapter 2, QuickTime Sprites, Sprite Animation and Wired Movies,”</a></span> and <span class="content_text"><a href="../spritemediahandler/3-Sprite-Media-Handler.html#//apple_ref/doc/uid/TP40000883-CH207-CJBEEIFB">“Chapter 3, Sprite Media Handler,”</a></span> in order to take advantage of the techniques described in this chapter. </p><p>You use the functions provided by the sprite media handler to create and manipulate a sprite animation as a track in a QuickTime movie. You can also use the functions provided by the sprite media handler to create and manipulate a wired sprite movie, with various types of user interactivity. The chapter is illustrated with code snippets from the sample program, <code>QTWiredSprites.c</code>, which is listed in full in <span class="content_text"><a href="../samplecodeappendix/Appendix-A-sample-code.html#//apple_ref/doc/uid/TP40000883-CH214-CJBJFHCE">Appendix A</a></span> of this book. </p><p>The chapter is divided into the following major sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCICCBBC">“Authoring Movies With the Sprite Media Handler”</a></span> describes how you use the functions provided by the sprite media handler to create and manipulate a sprite animation as a track in a QuickTime movie.</p></li><li class="li"><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIBEAB">“Authoring Wired Movies”</a></span> discusses how you use the sprite media handler to create and manipulate a wired sprite movie, with various types of user interactivity. </p></li><li class="li"><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIHEABA">“Authoring Movies With External Movie Targets”</a></span> describes how QuickTime enables you to author movies with external movie targets, using two target atoms that were introduced in QuickTime 4. </p></li><li class="li"><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIHJAG">“Wiring a Movie by Adding an HREF Track”</a></span> describes how you can wire a QuickTime movie by adding an HREF track to it. An HREF track is a specially named text track that contains hypertext references (HREFs), which are in the form of URLs and can point to any kind of data that a URL can specify, such as a Web page, a QuickTime movie, or a JavaScript script.</p></li><li class="li"><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIICIJF">“Adding Hypertext Links to a QuickTime Movie With a Text Track”</a></span> explains how you can add a few wired actions to a movie that has a text track simply by adding a text atom extension of the type <code>kHyperTextTextAtomType</code> to the end of the sample. The programming task is outlined in a series of steps.</p></li></ul><p>For API reference information about the constants and functions available to your application, refer to the <em>QuickTime API Reference</em>, which is available at </p><div class="codesample"><table><tr><td scope="row"><pre>http://developer.apple.com/documentation/Quicktime/QuickTime.html<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-BCICCBBC" title="Authoring Movies With the Sprite Media Handler"></a><h2>Authoring Movies With the Sprite Media Handler</h2><p>The sprite media handler provides functions that allow an application to create and manipulate a sprite animation as a track in a QuickTime movie.</p><p>The following sections are illustrated with code from the sample program <code>QTWiredSprites.c</code>, which creates a 320 by 240 pixel QuickTime movie with one sprite track. The sprite track contains six sprites, including two penguins and four buttons. The sample program, which takes advantage of wired sprites, is explained in greater detail <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIBEAB">“Authoring Wired Movies.”</a></span> A partial code listing is available in <span class="content_text"><a href="../samplecodeappendix/Appendix-A-sample-code.html#//apple_ref/doc/uid/TP40000883-CH214-CJBJFHCE">Appendix A</a></span>. You can download the full sample code at QuickTime website at </p><p><code>http://www.apple.com/quicktime/developers/samplecode.html#sprites</code>. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF101" title="Defining a Key Frame Sample"></a><h3>Defining a Key Frame Sample</h3><p>To create a sprite track in a QuickTime movie, you must first create the movie itself, a track to contain the sprites, and the track’s media. </p><p>After doing this, you can define a key frame sample. A key frame sample defines the number of sprites, their initial property values, and the shared image data used by the sprites in the key frame sample and in all override samples that follow the key frame sample. The sample code discussed in this section creates a single key frame sample and shows how to add images for other sprites, as well as actions for other sprites. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIEDBGD" title="Creating the Movie, Sprite Track, and Media"></a><h4>Creating the Movie, Sprite Track, and Media</h4><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIHACGF">Listing 4-1</a></span> shows a code fragment from the sample code <code>QTWiredSprites.c</code>. This sample code, which is available in <span class="content_text"><a href="../samplecodeappendix/Appendix-A-sample-code.html#//apple_ref/doc/uid/TP40000883-CH214-CJBJFHCE">Appendix A</a></span>, illustrates how you can create a new movie file that calls a sample code function, <code>AddSpriteTrackToMovie</code>, which is responsible for creating a sprite track and adding it to the movie.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_5" title="Listing 4-1Creating a sprite track movie"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIHACGF" title="Listing 4-1Creating a sprite track movie"></a><strong>Listing 4-1&nbsp;&nbsp;</strong>Creating a sprite track movie</p><div class="codesample"><table><tr><td scope="row"><pre>// Create a QuickTime movie containing a wired sprites track<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>.<span></span></pre></td></tr><tr><td scope="row"><pre>    // create a new movie file and set its controller type<span></span></pre></td></tr><tr><td scope="row"><pre>    // ask the user for the name of the new movie file<span></span></pre></td></tr><tr><td scope="row"><pre>    StandardPutFile("\pSprite movie file name:", "\pSprite.mov",<span></span></pre></td></tr><tr><td scope="row"><pre>                    &amp;myReply);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!myReply.sfGood)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // create a movie file for the destination movie<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = CreateMovieFile(&amp;myReply.sfFile, FOUR_CHAR_CODE('TVOD'), 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myFlags, &amp;myResRefNum, &amp;myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // select the "no controller" movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>    myType = EndianU32_NtoB(myType);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetUserDataItem(GetMovieUserData(myMovie), &amp;myType, sizeof(myType),<span></span></pre></td></tr><tr><td scope="row"><pre>                    kUserDataMovieControllerType, 1);<span></span></pre></td></tr></table></div><p>The following code fragment from <code>AddSpriteTrackToMovie</code> (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIEJEHB">Listing 4-2</a></span>) creates a new track and new media, and creates an empty key frame sample. <code>AddSpriteTrackToMovie</code> then calls <code>BeginMediaEdits</code> (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIGHFJD">Listing 4-4</a></span>) to prepare to add samples to the track’s media.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_6" title="Listing 4-2Creating a track and media"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIEJEHB" title="Listing 4-2Creating a track and media"></a><strong>Listing 4-2&nbsp;&nbsp;</strong>Creating a track and media</p><div class="codesample"><table><tr><td scope="row"><pre>// create the sprite track and media<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myTrack = NewMovieTrack(myMovie, ((long)kSpriteTrackWidth &lt;&lt; 16),<span></span></pre></td></tr><tr><td scope="row"><pre>                            ((long)kSpriteTrackHeight &lt;&lt; 16), kNoVolume);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMedia = NewTrackMedia(myTrack, SpriteMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kSpriteMediaTimeScale, NULL, 0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// create a new, empty key frame sample<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;mySample);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.red = 0xffff;    // white<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.green = 0xffff;<span></span></pre></td></tr><tr><td scope="row"><pre>    myKeyColor.blue = 0xffff;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF102" title="Adding Images to the Key Frame Sample"></a><h4>Adding Images to the Key Frame Sample</h4><p>The <code>AddPICTImageToKeyFrameSample</code> function (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIDDEBB">Listing 4-3</a></span>) adds images to the key frame sample.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_7" title="Listing 4-3Adding images to the key frame sample"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIDDEBB" title="Listing 4-3Adding images to the key frame sample"></a><strong>Listing 4-3&nbsp;&nbsp;</strong>Adding images to the key frame sample</p><div class="codesample"><table><tr><td scope="row"><pre>// add images to the key frame sample<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToBeginningButtonUp,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToBeginningButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToBeginningButtonDown,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;myKeyColor, kGoToBeginningButtonDownIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kGoToEndButtonUp, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kGoToEndButtonUpIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinForward, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kPenguinForwardIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinLeft, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kPenguinLeftIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinRight, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kPenguinRightIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, kPenguinClosed, &amp;myKeyColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    kPenguinClosedIndex, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (myIndex = kPenguinDownRightCycleStartIndex, myResID =<span></span></pre></td></tr><tr><td scope="row"><pre>            kWalkDownRightCycleStart;<span></span></pre></td></tr><tr><td scope="row"><pre>         myIndex &lt;= kPenguinDownRightCycleEndIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>         myIndex++, myResID++)<span></span></pre></td></tr><tr><td scope="row"><pre>    AddPICTImageToKeyFrameSample(mySample, myResID, &amp;myKeyColor, myIndex,<span></span></pre></td></tr><tr><td scope="row"><pre>                                 NULL, NULL);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF103" title="Adding More Images for Other Sprites"></a><h4>Adding More Images for Other Sprites</h4><p>To add more images to other sprites, you assign group IDs to those images, using the <code>AssignImageGroupIDsToKeyFrame</code> function. You then create the sprite track, add it to <code>theMovie</code>, and then begin to add samples to the tracks’ media, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIGHFJD">Listing 4-4</a></span>. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_8" title="Listing 4-4Adding more images to other sprites and specifying button actions"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIGHFJD" title="Listing 4-4Adding more images to other sprites and specifying button actions"></a><strong>Listing 4-4&nbsp;&nbsp;</strong>Adding more images to other sprites and specifying button actions</p><div class="codesample"><table><tr><td scope="row"><pre>// assign group IDs to the images<span></span></pre></td></tr><tr><td scope="row"><pre>    AssignImageGroupIDsToKeyFrame(mySample);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add samples to the sprite track's media<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    BeginMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // go to beginning button with no actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(&amp;myBeginButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (1 * kSpriteTrackWidth / 8) - (kStartEndButtonWidth<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (4 * kSpriteTrackHeight / 5) -<span></span></pre></td></tr><tr><td scope="row"><pre>                                    (kStartEndButtonHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    isVisible       = false;<span></span></pre></td></tr><tr><td scope="row"><pre>    myLayer         = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex         = kGoToBeginningButtonUpIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = SetSpriteData(myBeginButton, &amp;myLocation, &amp;isVisible,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myLayer, &amp;myIndex, NULL, NULL, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF104" title="Adding Sprites to the Key Frame Sample"></a><h4>Adding Sprites to the Key Frame Sample</h4><p>The <code>AddSpriteTrackToMovie</code> function adds the sprites with their initial property values to the key frame sample, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCICIBCB">Listing 4-5</a></span>. The key frame contains four buttons and two penguins. </p><p>If the <code>withBackgroundPicture</code> parameter is <code>true</code>, the function adds a background sprite. The function initializes the background sprite’s properties, including setting the layer property to <code>kBackgroundSpriteLayerNum</code> to indicate that the sprite is a background sprite. The function calls <code>SetSpriteData</code> (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIDCFAH">Listing 4-6</a></span>), which adds the appropriate property atoms to the <code>spriteData</code> atom container. Then, <code>AddSpriteTrackToMovie</code> calls <code>AddSpriteToSample</code> (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIHAAHH">Listing 4-7</a></span>) to add the atoms in the <code>spriteData</code> atom container to the key frame sample atom container.</p><p><code>AddSpriteTrackToMovie</code> adds the other sprites to the key frame sample and then calls <code>AddSpriteSampleToMedia</code> (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIEJIE">Listing 4-8</a></span>) to add the key frame sample to the media.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_9" title="Listing 4-5Creating more key frame sprite media"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCICIBCB" title="Listing 4-5Creating more key frame sprite media"></a><strong>Listing 4-5&nbsp;&nbsp;</strong>Creating more key frame sprite media</p><div class="codesample"><table><tr><td scope="row"><pre>// add actions to the six sprites<span></span></pre></td></tr><tr><td scope="row"><pre>    //<span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to beginning button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myBeginButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myBeginActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kGoToBeginningButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL, kGoToBeginningButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieGoToBeginningAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kGoToBeginningSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myBeginActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to prev button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPrevButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPrevActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kGoToPrevButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClickEnd, 0, NULL, 0, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL, kGoToPrevButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddMovieStepBackwardAction(myPrevActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClickEndTriggerButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseEnter, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myPrevActionButton, kGoToPrevSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myPrevActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to next button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myNextButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myNextActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr></table></div><p>For each new property value that is passed into it as a parameter, the <code>SetSpriteData</code> function (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIDCFAH">Listing 4-6</a></span>) calls <code>QTFindChildByIndex</code> to find the appropriate property atom. If the property atom already exists in the QT atom container, <code>SetSpriteData</code> calls <code>QTSetAtomData</code> to update the property’s value. If the property atom does not exist in the container, <code>SetSpriteData</code> calls <code>QTInsertChild</code> to insert a new property atom.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_10" title="Listing 4-6The SetSpriteData function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIDCFAH" title="Listing 4-6The SetSpriteData function"></a><strong>Listing 4-6&nbsp;&nbsp;</strong>The <code>SetSpriteData</code> function</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr SetSpriteData (QTAtomContainer sprite, Point *location,<span></span></pre></td></tr><tr><td scope="row"><pre>    short *visible, short *layer, short *imageIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr   err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom  propertyAtom;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (location) {<span></span></pre></td></tr><tr><td scope="row"><pre>        MatrixRecordmatrix;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // set up the value for the matrix property<span></span></pre></td></tr><tr><td scope="row"><pre>        SetIdentityMatrix (&amp;matrix);<span></span></pre></td></tr><tr><td scope="row"><pre>        matrix.matrix[2][0] = ((long)location->h &lt;&lt; 16);<span></span></pre></td></tr><tr><td scope="row"><pre>        matrix.matrix[2][1] = ((long)location->v &lt;&lt; 16);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // if no matrix atom is in the container, insert a new one<span></span></pre></td></tr><tr><td scope="row"><pre>        if ((propertyAtom = QTFindChildByIndex (sprite, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>            kSpritePropertyMatrix, 1, nil)) == 0)<span></span></pre></td></tr><tr><td scope="row"><pre>            FailOSErr (QTInsertChild (sprite, 0, kSpritePropertyMatrix,<span></span></pre></td></tr><tr><td scope="row"><pre>                1, 0, sizeof(MatrixRecord), &amp;matrix, nil))<span></span></pre></td></tr><tr><td scope="row"><pre>        // otherwise, replace the atom’s data else<span></span></pre></td></tr><tr><td scope="row"><pre>            FailOSErr (QTSetAtomData (sprite, propertyAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>                sizeof(MatrixRecord), &amp;matrix));<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // ...<span></span></pre></td></tr><tr><td scope="row"><pre>    // handle other properties in a similar fashion<span></span></pre></td></tr><tr><td scope="row"><pre>    // ...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>AddSpriteToSample</code> function (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIHAAHH">Listing 4-7</a></span>) checks to see whether a sprite has already been added to a sample. If not, the function calls <code>QTInsertChild</code> to create a new sprite atom in the atom container that represents the sample. Then, <code>AddSpriteToSample</code> calls <code>QTInsertChildren</code> to insert the atoms in the sprite atom container as children of the newly created atom in the sample container.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_11" title="Listing 4-7The AddSpriteToSample function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIHAAHH" title="Listing 4-7The AddSpriteToSample function"></a><strong>Listing 4-7&nbsp;&nbsp;</strong>The <code>AddSpriteToSample</code> function</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr AddSpriteToSample (QTAtomContainer theSample,<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer theSprite, short spriteID)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom newSpriteAtom;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    FailIf (QTFindChildByID (theSample, 0, kSpriteAtomType, spriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>                                nil), paramErr);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    FailOSErr (QTInsertChild (theSample, 0, kSpriteAtomType, spriteID,<span></span></pre></td></tr><tr><td scope="row"><pre>                                0, 0, nil, &amp;newSpriteAtom)); // index of<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    // zero means append<span></span></pre></td></tr><tr><td scope="row"><pre>    FailOSErr (QTInsertChildren (theSample, newSpriteAtom, theSprite));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The <code>AddSpriteSampleToMedia</code> function, shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIEJIE">Listing 4-8</a></span>, calls <code>AddMediaSample</code> to add either a key frame sample or an override sample to the sprite media.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_12" title="Listing 4-8The AddSpriteSampleToMedia function"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIEJIE" title="Listing 4-8The AddSpriteSampleToMedia function"></a><strong>Listing 4-8&nbsp;&nbsp;</strong>The <code>AddSpriteSampleToMedia</code> function</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr AddSpriteSampleToMedia (Media theMedia, QTAtomContainer sample,<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue duration, Boolean isKeyFrame)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    SampleDescriptionHandle sampleDesc = nil;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    FailMemErr (sampleDesc = (SampleDescriptionHandle) NewHandleClear(<span></span></pre></td></tr><tr><td scope="row"><pre>                                sizeof(SampleDescription)));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    FailOSErr (AddMediaSample (theMedia, (Handle) sample, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                GetHandleSize(sample), duration,<span></span></pre></td></tr><tr><td scope="row"><pre>                                sampleDesc, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                isKeyFrame ? 0 : mediaSampleNotSync,<span></span></pre></td></tr><tr><td scope="row"><pre>                                nil));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (sampleDesc)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle ((Handle)sampleDesc);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF105" title="Adding More Actions to Other Sprites"></a><h4>Adding More Actions to Other Sprites</h4><p>To set the movie’s looping mode to palindrome, you add an action that is triggered when the key frame is loaded, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCICAACG">Listing 4-9</a></span>. This action is triggered every time the key frame is reloaded. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_13" title="Listing 4-9Adding more actions to other sprites"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCICAACG" title="Listing 4-9Adding more actions to other sprites"></a><strong>Listing 4-9&nbsp;&nbsp;</strong>Adding more actions to other sprites</p><div class="codesample"><table><tr><td scope="row"><pre>        loopingFlags = loopTimeBase | palindromeLoopTimeBase;<span></span></pre></td></tr><tr><td scope="row"><pre>        FailOSErr( AddMovieSetLoopingFlagsAction( sample,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kQTEventFrameLoaded, loopingFlags ) )<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF106" title="Adding Sample Data in Compressed Form"></a><h4>Adding Sample Data in Compressed Form</h4><p>To add the sample data in a compressed form, you use a QuickTime DataCodec to perform the compression, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIEAGDJ">Listing 4-10</a></span>. You replace the sample utility <code><!--a-->AddSpriteSampleToMedia<!--/a--></code> call with a call to the sample utility <code><!--a-->AddCompressedSpriteSampleToMedia<!--/a--></code>. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_14" title="Listing 4-10Adding the key frame sample in compressed form"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIEAGDJ" title="Listing 4-10Adding the key frame sample in compressed form"></a><strong>Listing 4-10&nbsp;&nbsp;</strong><code>Adding the key frame sample in compressed form</code></p><div class="codesample"><table><tr><td scope="row"><pre>/* AddSpriteSampleToMedia(myMedia, mySample, kSpriteMediaFrameDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>            true, NULL);    */<span></span></pre></td></tr><tr><td scope="row"><pre>AddCompressedSpriteSampleToMedia(myMedia, mySample,<span></span></pre></td></tr><tr><td scope="row"><pre>            kSpriteMediaFrameDuration, true, zlibDataCompressorSubType,<span></span></pre></td></tr><tr><td scope="row"><pre>            NULL);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF107" title="Defining Override Samples"></a><h3>Defining Override Samples</h3><p>Once you have defined a key frame sample for the sprite track, you can add any number of override samples to modify sprite properties.</p><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIEBBEE">Listing 4-11</a></span> shows the portion of the <code>AddSpriteTrackToMovie</code> function that adds override samples to the sprite track to make the first penguin sprite appear to waddle and move across the screen. For each override sample, the function modifies the first penguin sprite’s image index and location. The function calls <code>SetSpriteData</code> to update the appropriate property atoms in the sprite atom container. Then, the function calls <code>AddSpriteToSample</code> to add the sprite atom container to the sample atom container. After all of the modifications have been made to the override sample, the function calls <code><!--a-->AddSpriteSampleToMedia<!--/a--></code> to add the override sample to the media.</p><p>After adding all of the override samples to the media, <code>AddSpriteTrackToMovie</code> calls <code>EndMediaEdits</code> to indicate that it is done adding samples to the media. Then, <code>AddSpriteTrackToMovie</code> calls <code>InsertMediaIntoTrack</code> to insert the new media segment into the track.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_15" title="Listing 4-11Adding override samples to move penguin one and change its image index"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIEBBEE" title="Listing 4-11Adding override samples to move penguin one and change its image index"></a><strong>Listing 4-11&nbsp;&nbsp;</strong>Adding override samples to move penguin one and change its image index</p><div class="codesample"><table><tr><td scope="row"><pre>// original penguin one location<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.h    = (3 * kSpriteTrackWidth / 8) - (kPenguinWidth / 2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myLocation.v    = (kSpriteTrackHeight / 4) - (kPenguinHeight / 2);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myDelta = (kSpriteTrackHeight / 2) / kNumOverrideSamples;<span></span></pre></td></tr><tr><td scope="row"><pre>    myIndex = kPenguinDownRightCycleStartIndex;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    for (i = 1; i &lt;= kNumOverrideSamples; i++) {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTRemoveChildren(mySample, kParentAtomIsContainer);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTNewAtomContainer(&amp;myPenguinOneOverride);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        myLocation.h += myDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>        myLocation.v += myDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>        myIndex++;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myIndex > kPenguinDownRightCycleEndIndex)<span></span></pre></td></tr><tr><td scope="row"><pre>            myIndex = kPenguinDownRightCycleStartIndex;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        SetSpriteData(myPenguinOneOverride, &amp;myLocation, NULL, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myIndex, NULL, NULL, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        AddSpriteToSample(mySample, myPenguinOneOverride,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kPenguinOneSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>        AddSpriteSampleToMedia(myMedia, mySample,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kSpriteMediaFrameDuration, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myPenguinOneOverride);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    EndMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the media to the track<span></span></pre></td></tr><tr><td scope="row"><pre>    InsertMediaIntoTrack(myTrack, 0, 0, GetMediaDuration(myMedia),<span></span></pre></td></tr><tr><td scope="row"><pre>                            fixed1);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF108" title="Setting Properties of the Sprite Track"></a><h3>Setting Properties of the Sprite Track</h3><p>Besides adding key frame samples and override samples to the sprite track, you may want to set one or more global properties of the sprite track. For example, if you want to define a background color for your sprite track, you must set the sprite track’s background color property. You do this by creating a leaf atom of type <code>kSpriteTrackPropertyBackgroundColor</code> whose data is the desired background color.</p><p>After adding the override samples, <code>AddSpriteTrackToMovie</code> adds a background color to the sprite track, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIECIC">Listing 4-12</a></span>. The function calls <code>QTNewAtomContainer</code> to create a new atom container for sprite track properties. <code>AddSpriteTrackToMovie</code> adds a new atom of type <code>kSpriteTrackPropertyBackgroundColor</code> to the container and calls <code>SpriteMediaSetSpriteProperty</code> to set the sprite track’s property. </p><p>After adding a background color, <code>AddSpriteTrackToMovie </code>notifies the movie controller that the sprite track has actions. If the <em>hasActions</em> parameter is <code>true</code>, this function calls <code><a href="../../Reference/QTRef_MovieToolkit/Reference/reference.html#//apple_ref/doc/c_ref/QTNewAtomContainer" target="_top">QTNewAtomContainer</a></code> to create a new atom container for sprite track properties. <code>AddSpriteTrackToMovie</code> adds a new atom of type <code>kSpriteTrackPropertyHasActions</code> to the container and calls <code>SpriteMediaSetSpriteProperty</code> to set the sprite track’s property. </p><p>Finally, after specifying that the sprite track has actions, <code>AddSpriteTrackToMovie</code> notifies the sprite track to generate <code>QTIdleEvents</code> by adding a new atom of type <code>kSpriteTrackPropertyQTIdleEventsFrequency</code> to the container. This new atom specifies the frequency of <code>QTEvent</code> occurrences. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_16" title="Listing 4-12Adding sprite track properties, including a background color, actions, and frequency"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIECIC" title="Listing 4-12Adding sprite track properties, including a background color, actions, and frequency"></a><strong>Listing 4-12&nbsp;&nbsp;</strong>Adding sprite track properties, including a background color, actions, and frequency</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>        QTAtomContainer     myTrackProperties;<span></span></pre></td></tr><tr><td scope="row"><pre>        RGBColor            myBackgroundColor;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // add a background color to the sprite track<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.red = EndianU16_NtoB(0x8000);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.green = EndianU16_NtoB(0);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.blue = EndianU16_NtoB(0xffff);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTNewAtomContainer(&amp;myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyBackgroundColor, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(RGBColor), &amp;myBackgroundColor, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // tell the movie controller that this sprite track has actions<span></span></pre></td></tr><tr><td scope="row"><pre>        hasActions = true;<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyHasActions, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(hasActions), &amp;hasActions, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // tell the sprite track to generate QTIdleEvents<span></span></pre></td></tr><tr><td scope="row"><pre>        myFrequency = EndianU32_NtoB(60);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kSpriteTrackPropertyQTIdleEventsFrequency, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(myFrequency), &amp;myFrequency, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        myErr = SetMediaPropertyAtom(myMedia, myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF109" title="Retrieving Sprite Data From a Modifier Track"></a><h3>Retrieving Sprite Data From a Modifier Track</h3><p>The sample program <code>AddReferenceTrack.c</code> illustrates how you can modify a movie to use a modifier track for a sprite’s image data. The sample program prompts the user for a movie that contains a single sprite track. Then, it adds a track from a second movie to the original movie as a modifier track. The modifier track overrides the image data for a selected image index.</p><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIIHBC">Listing 4-13</a></span> shows the first part of the main function of the sample program. It performs the following tasks:</p><ul class="spaceabove"><li class="li"><p>It loads the movie containing the sprite track.</p></li><li class="li"><p>It calls <code>GetMovieTrackCount</code> to determine the total number of tracks in the sprite track movie.</p></li><li class="li"><p>It loads the movie containing the modifier track (<code>movieB</code>).</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_17" title="Listing 4-13Loading the movies"></a><br/><br/><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIIHBC" title="Listing 4-13Loading the movies"></a><strong>Listing 4-13&nbsp;&nbsp;</strong>Loading the movies</p><div class="codesample"><table><tr><td scope="row"><pre>OSErr               err;<span></span></pre></td></tr><tr><td scope="row"><pre>short               movieResID = 0, resFref, resID = 0, resRefNum;<span></span></pre></td></tr><tr><td scope="row"><pre>StandardFileReply   reply;<span></span></pre></td></tr><tr><td scope="row"><pre>SFTypeList          types;<span></span></pre></td></tr><tr><td scope="row"><pre>Movie               m;<span></span></pre></td></tr><tr><td scope="row"><pre>FSSpec              fss;<span></span></pre></td></tr><tr><td scope="row"><pre>Movie               movieB;<span></span></pre></td></tr><tr><td scope="row"><pre>long                origTrackCount;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// prompt for a movie containing a sprite track and load it<span></span></pre></td></tr><tr><td scope="row"><pre>types[0] = MovieFileType;<span></span></pre></td></tr><tr><td scope="row"><pre>StandardGetFilePreview (nil, 1, types, &amp;reply);<span></span></pre></td></tr><tr><td scope="row"><pre>if (!reply.sfGood) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = OpenMovieFile (&amp;reply.sfFile, &amp;resFref, fsRdPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>if (err) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = NewMovieFromFile (&amp;m, resFref, &amp;movieResID, (StringPtr)nil,<span></span></pre></td></tr><tr><td scope="row"><pre>    newMovieActive, ni);<span></span></pre></td></tr><tr><td scope="row"><pre>if (err) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CloseMovieFile (resFref);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// get the number of tracks<span></span></pre></td></tr><tr><td scope="row"><pre>origTrackCount = GetMovieTrackCount (m);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// load the movie to be used as a modifier track<span></span></pre></td></tr><tr><td scope="row"><pre>FSMakeFSSpec (reply.sfFile.vRefNum, reply.sfFile.parID, "\pAdd Me",<span></span></pre></td></tr><tr><td scope="row"><pre>    &amp;fss);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = OpenMovieFile (&amp;fss, &amp;resFref, fsRdPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>if (err) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>err = NewMovieFromFile (&amp;movieB, resFref, &amp;resID, (StringPtr)nil, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    nil);<span></span></pre></td></tr><tr><td scope="row"><pre>if (err) return;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>CloseMovieFile (resFref);<span></span></pre></td></tr></table></div></li></ul><p>Once the two movies have been loaded, the sample program retrieves the first track, which is the sprite track, from the original movie, and sets the selection to the start of the movie (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIBEGJI">Listing 4-14</a></span>). The sample program iterates through all the tracks in the modifier movie, disposing of all non-video tracks. </p><p>Next, the sample program calls <code>AddMovieSelection</code> to add the modifier track to the original movie. Finally, the sample program calls <code>AddTrackReference</code> to associate the modifier track with the sprite track it will modify. <code>AddTrackReference</code> returns an index of the added reference in the <code>referenceIndex</code> variable.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_18" title="Listing 4-14Adding the modifier track to the movie"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIBEGJI" title="Listing 4-14Adding the modifier track to the movie"></a><strong>Listing 4-14&nbsp;&nbsp;</strong>Adding the modifier track to the movie</p><div class="codesample"><table><tr><td scope="row"><pre>Movie           m;<span></span></pre></td></tr><tr><td scope="row"><pre>TimeValue       oldDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>Movie           movieB;<span></span></pre></td></tr><tr><td scope="row"><pre>long            i, origTrackCount, referenceIndex;<span></span></pre></td></tr><tr><td scope="row"><pre>Track           newTrack, spriteTrack;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// get the first track in original movie and position at the start<span></span></pre></td></tr><tr><td scope="row"><pre>spriteTrack = GetMovieIndTrack (m, 1);<span></span></pre></td></tr><tr><td scope="row"><pre>SetMovieSelection (m, 0 ,0);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// remove all tracks except video in modifier movie<span></span></pre></td></tr><tr><td scope="row"><pre>for (i = 1; i &lt;= GetMovieTrackCount (movieB); i++)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Track t = GetMovieIndTrack (movieB, i);<span></span></pre></td></tr><tr><td scope="row"><pre>    OSType aType;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetMediaHandlerDescription (GetTrackMedia(t), &amp;aType, nil, nil);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (aType != VideoMediaType)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeMovieTrack (t);<span></span></pre></td></tr><tr><td scope="row"><pre>        i--;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// add the modifier track to original movie<span></span></pre></td></tr><tr><td scope="row"><pre>oldDuration = GetMovieDuration (m);<span></span></pre></td></tr><tr><td scope="row"><pre>AddMovieSelection (m, movieB);<span></span></pre></td></tr><tr><td scope="row"><pre>DisposeMovie (movieB);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// truncate the movie to the length of the original track<span></span></pre></td></tr><tr><td scope="row"><pre>DeleteMovieSegment (m, oldDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>    GetMovieDuration (m) - oldDuration);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// associate the modifier track with the original sprite track<span></span></pre></td></tr><tr><td scope="row"><pre>newTrack = GetMovieIndTrack (m, origTrackCount + 1);<span></span></pre></td></tr><tr><td scope="row"><pre>AddTrackReference (spriteTrack, newTrack, kTrackModifierReference,<span></span></pre></td></tr><tr><td scope="row"><pre>    &amp;referenceIndex);<span></span></pre></td></tr></table></div><p>Besides adding a reference to the modifier track, the sample program must update the sprite media’s input map to describe how the modifier track should be interpreted by the sprite track. The sample program performs the following tasks (<span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIGHACC">Listing 4-15</a></span>):</p><ul class="spaceabove"><li class="li"><p>It retrieves the sprite track’s media by calling <code>GetTrackMedia. </code></p></li><li class="li"><p>It calls <code>GetMediaInputMap</code> to retrieve the media’s input map.</p></li><li class="li"><p>It adds a parent atom to the input map of type <code>kTrackModifierInput</code>. The ID of the atom is the reference index retrieved by the <code>AddTrackReference</code> function.</p></li><li class="li"><p>It adds two child atoms, one that specifies that the input type of the modifier track is of type kTrackModifierTypeImage, and one that specifies the index of the sprite image to override.</p></li><li class="li"><p>It calls <code>SetMediaInputMap</code> to update the media’s input map.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_19" title="Listing 4-15Updating the media&acirc;&#128;&#153;s input map"></a><br/><br/><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIGHACC" title="Listing 4-15Updating the media&acirc;&#128;&#153;s input map"></a><strong>Listing 4-15&nbsp;&nbsp;</strong>Updating the media’s input map</p><div class="codesample"><table><tr><td scope="row"><pre>#define kImageIndexToOverride 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>Movie           m, movieB;<span></span></pre></td></tr><tr><td scope="row"><pre>long            referenceIndex, imageIndexToOverride;<span></span></pre></td></tr><tr><td scope="row"><pre>Track           spriteTrack;<span></span></pre></td></tr><tr><td scope="row"><pre>QTAtomContainer inputMap;<span></span></pre></td></tr><tr><td scope="row"><pre>QTAtom          inputAtom;<span></span></pre></td></tr><tr><td scope="row"><pre>OSType          inputType;<span></span></pre></td></tr><tr><td scope="row"><pre>Media           spriteMedia;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// get the sprite media’s input map<span></span></pre></td></tr><tr><td scope="row"><pre>spriteMedia = GetTrackMedia (spriteTrack);<span></span></pre></td></tr><tr><td scope="row"><pre>GetMediaInputMap (spriteMedia, &amp;inputMap);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// add an atom for a modifier track<span></span></pre></td></tr><tr><td scope="row"><pre>QTInsertChild (inputMap, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>    kTrackModifierInput, referenceIndex, 0, 0, nil, &amp;inputAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// add a child atom to specify the input type<span></span></pre></td></tr><tr><td scope="row"><pre>inputType = kTrackModifierTypeImage;<span></span></pre></td></tr><tr><td scope="row"><pre>QTInsertChild (inputMap, inputAtom, kTrackModifierType, 1, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    sizeof(inputType), &amp;inputType, nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// add a second child atom to specify index of image to override<span></span></pre></td></tr><tr><td scope="row"><pre>imageIndexToOverride = kImageIndexToOverride;<span></span></pre></td></tr><tr><td scope="row"><pre>QTInsertChild (inputMap, inputAtom, kSpritePropertyImageIndex, 1, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>    sizeof(imageIndexToOverride), &amp;imageIndexToOverride, nil);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// update the sprite media’s input map<span></span></pre></td></tr><tr><td scope="row"><pre>SetMediaInputMap (spriteMedia, inputMap);<span></span></pre></td></tr><tr><td scope="row"><pre>QTDisposeAtomContainer (inputMap);<span></span></pre></td></tr></table></div></li></ul><p>Once the media’s input map has been updated, the application can save the movie. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIBEAB" title="Authoring Wired Movies"></a><h2>Authoring Wired Movies</h2><p>In addition to providing functions that allow you to create and manipulate a sprite animation as a track in a QuickTime movie, the sprite media handler also provides functions that allow your application to create and manipulate a wired sprite movie, with various types of user interactivity. </p><p>The following sections are illustrated, as with the previous section, with code from the sample program <code>QTWiredSprites.c</code>, which shows how to create a sample wired sprite movie containing one sprite track. (A partial code listing is available in <span class="content_text"><a href="../samplecodeappendix/Appendix-A-sample-code.html#//apple_ref/doc/uid/TP40000883-CH214-CJBJFHCE">Appendix A</a></span>. You can download the full sample code at QuickTime Web site at <code>http://www.apple.com/quicktime/developers/samplecode.html#sprites</code>.) </p><p>The sample code creates a 320 by 240 pixel wired movie with one sprite track that contains six sprites, two of which are penguins and four of which are buttons. <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIIHCEI">Figure 4-1</a></span> shows two penguins at the outset of the movie, with the buttons invisible. </p><br/><div><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_20" title="Figure 4-1Two penguins from a sample program"></a><p><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIHCEI" title="Figure 4-1Two penguins from a sample program"></a><strong>Figure 4-1&nbsp;&nbsp;</strong>Two penguins from a sample program</p><img src = "../art/qt_wired1.gif" alt = "Two penguins from a sample program" width="342" height="278"></div><br/><p>Initially, the four buttons in the wired movie are invisible. When the mouse enters or “rolls over” a button, it appears, as shown in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIICHIH">Figure 4-2</a></span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_21" title="Figure 4-2Two penguins and four buttons, indicating various directions in the movie "></a><p><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIICHIH" title="Figure 4-2Two penguins and four buttons, indicating various directions in the movie "></a><strong>Figure 4-2&nbsp;&nbsp;</strong>Two penguins and four buttons, indicating various directions in the movie </p><img src = "../art/qt_wired2.gif" alt = "Two penguins and four buttons, indicating various directions in the movie" width="343" height="277"></div><br/><p>When the mouse is clicked inside a button, its images change to its “pressed” image. When the mouse is released, its image is changed back to its “unpressed” image. If the mouse is released inside the button, it triggers an action. The buttons perform the following set of actions: </p><ul class="ul"><li class="li"><p>go to beginning of movie</p></li><li class="li"><p>step backwards</p></li><li class="li"><p>step forwards</p></li><li class="li"><p>go to end of movie</p></li></ul><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF110" title="Actions of the First Penguin"></a><h3>Actions of the First Penguin</h3><p>The first penguin shows all of the buttons when the mouse enters it, and hides them when the mouse exits. The first penguin is the only sprite which has properties that are overriden by the override sprite samples. These samples override its matrix in order to move it, and its image index in order to make it waddle.</p><p>When you mouse-click on the second penguin, the penguin changes its image index to its “eyes closed” image. When the mouse is released, it changes back to its normal image. This makes the penguin’s eyes appear to blink when clicked on. When the mouse is released over the penguin, several other actions are triggered. Both penguins’ graphics states are toggled between <code>copyMode</code> and <code>blendMode</code>, and the movie’s rate is toggled between 0 and 1.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF111" title="Actions of the Second Penguin"></a><h3>Actions of the Second Penguin</h3><p>The second penguin moves once per second. This occurs whether the movie’s rate is currently 0 or 1  because it is being triggered by a QuickTime idle event. When the penguin receives the idle event, it changes its matrix using an action which uses min, max, delta, and wraparound options.</p><p>The movie’s looping mode is set to palindrome by a <code>kQTEventFrameLoaded</code> event.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF112" title="Creating a Wired Sprite Movie"></a><h3>Creating a Wired Sprite Movie</h3><p>The following tasks are performed in order to create the wired sprite movie:</p><ul class="spaceabove"><li class="li"><p>You create a new movie file with a single sprite track, as explained in the section <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIEDBGD">“Creating the Movie, Sprite Track, and Media.”</a></span> </p></li><li class="li"><p>You assign the “no controller” movie controller to the movie.</p></li><li class="li"><p>You set the sprite track’s background color, idle event frequency, and <code>hasActions</code> properties. </p></li><li class="li"><p>You convert PICT resources to animation codec images with transparency. </p></li><li class="li"><p>A key frame sample containing six sprites and all of their shared images is created. The sprites are assigned initial property values. A <code>frameLoaded</code> event is created for the key frame.</p></li><li class="li"><p>You create some override samples which override the matrix and image index properties of the first penguin sprite. </p></li></ul><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF113" title="Assigning the No Controller to the Movie"></a><h4>Assigning the No Controller to the Movie</h4><p>The following code fragment (in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIEGABH">Listing 4-16</a></span>) assigns the “no controller” movie controller to the movie. You make this assignment if you don’t want the standard QuickTime movie controller to appear. In this code sample, you want to create a set of sprite buttons in order to control user interaction with the penguins in the movie. </p><p>There may also be other occasions when it is useful to make a “no controller” assignment. For example, if you are creating non-linear movies—such as Hypercard stacks where you access the cards in the stack by clicking on buttons by sprites—you may wish to create your own sprite buttons. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_22" title="Listing 4-16Assigning the no controller movie controller"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIEGABH" title="Listing 4-16Assigning the no controller movie controller"></a><strong>Listing 4-16&nbsp;&nbsp;</strong>Assigning the no controller movie controller</p><div class="codesample"><table><tr><td scope="row"><pre>    // select the "no controller" movie controller<span></span></pre></td></tr><tr><td scope="row"><pre>    myType = EndianU32_NtoB(myType);<span></span></pre></td></tr><tr><td scope="row"><pre>    SetUserDataItem(GetMovieUserData(myMovie), &amp;myType, sizeof(myType),<span></span></pre></td></tr><tr><td scope="row"><pre>                        kUserDataMovieControllerType, 1);<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF114" title="Setting Up the Sprite Track&acirc;&#128;&#153;s Properities"></a><h4>Setting Up the Sprite Track’s Properities</h4><p><span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIFGCBG">Listing 4-17</a></span> shows a code fragment that sets the sprite track’s background color, idle event frequency and its <code>hasActions</code> properties.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_23" title="Listing 4-17Setting the background color, idle event frequency and hasActions properties of the sprite track "></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIFGCBG" title="Listing 4-17Setting the background color, idle event frequency and hasActions properties of the sprite track "></a><strong>Listing 4-17&nbsp;&nbsp;</strong>Setting the background color, idle event frequency and hasActions properties of the sprite track </p><div class="codesample"><table><tr><td scope="row"><pre>// set the sprite track properties<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        QTAtomContainer     myTrackProperties;<span></span></pre></td></tr><tr><td scope="row"><pre>        RGBColor            myBackgroundColor;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // add a background color to the sprite track<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.red = EndianU16_NtoB(0x8000);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.green = EndianU16_NtoB(0);<span></span></pre></td></tr><tr><td scope="row"><pre>        myBackgroundColor.blue = EndianU16_NtoB(0xffff);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTNewAtomContainer(&amp;myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyBackgroundColor, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                        sizeof(RGBColor), &amp;myBackgroundColor, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// tell the movie controller that this sprite track has actions<span></span></pre></td></tr><tr><td scope="row"><pre>        hasActions = true;<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyHasActions, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                    sizeof(hasActions), &amp;hasActions, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // tell the sprite track to generate QTIdleEvents<span></span></pre></td></tr><tr><td scope="row"><pre>        myFrequency = EndianU32_NtoB(60);<span></span></pre></td></tr><tr><td scope="row"><pre>        QTInsertChild(myTrackProperties, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kSpriteTrackPropertyQTIdleEventsFrequency, 1, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            sizeof(myFrequency), &amp;myFrequency, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>        myErr = SetMediaPropertyAtom(myMedia, myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        QTDisposeAtomContainer(myTrackProperties);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF115" title="Adding an Event Handler to the Penguin"></a><h4>Adding an Event Handler to the Penguin</h4><p>The <code>AddPenguinTwoConditionalActions</code> routine adds logic to our penguin. Using this routine, you can transform the penguin into a two-state button that plays/pauses the movie. </p><p>We are relying on the fact that a <code>GetVariable</code> for a variableID which has never been set will return 0. If we need another default value, we could initialize it using the <code>frameLoaded</code> event.</p><p>A higher level description of the logic is:</p><div class="codesample"><table><tr><td scope="row"><pre>    On MouseUpInside<span></span></pre></td></tr><tr><td scope="row"><pre>       If (GetVariable(DefaultTrack, 1) = 0)<span></span></pre></td></tr><tr><td scope="row"><pre>          SetMovieRate(1)<span></span></pre></td></tr><tr><td scope="row"><pre>          SetSpriteGraphicsMode(DefaultSprite, { blend, grey } )<span></span></pre></td></tr><tr><td scope="row"><pre>          SetSpriteGraphicsMode(GetSpriteByID(DefaultTrack, 5), {<span></span></pre></td></tr><tr><td scope="row"><pre>                                ditherCopy, white } )<span></span></pre></td></tr><tr><td scope="row"><pre>          SetVariable(DefaultTrack, 1, 1)<span></span></pre></td></tr><tr><td scope="row"><pre>       ElseIf (GetVariable(DefaultTrack, 1) = 1)<span></span></pre></td></tr><tr><td scope="row"><pre>          SetMovieRate(0)<span></span></pre></td></tr><tr><td scope="row"><pre>          SetSpriteGraphicsMode(DefaultSprite, { ditherCopy, white })<span></span></pre></td></tr><tr><td scope="row"><pre>          SetSpriteGraphicsMode(GetSpriteByID(DefaultTrack, 5), { blend,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                    grey })<span></span></pre></td></tr><tr><td scope="row"><pre>          SetVariable(DefaultTrack, 1, 0)<span></span></pre></td></tr><tr><td scope="row"><pre>       Endif<span></span></pre></td></tr><tr><td scope="row"><pre>    End<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF116" title="Adding a Series of Actions to the Penguins"></a><h4>Adding a Series of Actions to the Penguins</h4><p>The following code fragment in <span class="content_text"><a href="4-Authoring-Wired-Movies.html#//apple_ref/doc/uid/TP40000883-CH208-BCIBFABA">Listing 4-18</a></span> shows how you can add a key frame with four buttons, enabling our penguins to move through a series of actions. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_24" title="Listing 4-18Adding a key frame with four buttons, enabling a series of actions for our two penguins"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIBFABA" title="Listing 4-18Adding a key frame with four buttons, enabling a series of actions for our two penguins"></a><strong>Listing 4-18&nbsp;&nbsp;</strong>Adding a key frame with four buttons, enabling a series of actions for our two penguins</p><div class="codesample"><table><tr><td scope="row"><pre>// add actions to the six sprites<span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to beginning button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myBeginButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myBeginActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParentAtomIsContainer, kQTEventMouseClick, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                    0, 0, NULL, kGoToBeginningButtonDownIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myBeginActionButton,<span></span></pre></td></tr><tr><td scope="row"><pre>                    kParentAtomIsContainer, kQTEventMouseClickEnd, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                    NULL, 0, 0, NULL, kGoToBeginningButtonUpIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myPrevActionButton, kGoToPrevSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>                        NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteToSample(mySample, myNextActionButton, kGoToNextSpriteID);<span></span></pre></td></tr><tr><td scope="row"><pre>    QTDisposeAtomContainer(myNextActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>. . .<span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to end button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myEndButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myEndActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre>        kParentAtomIsContainer, kQTEventMouseExit, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>            false,<span></span></pre></td></tr><tr><td scope="row"><pre>. . .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add penguin one<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPenguinOne, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPenguinOneAction);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myBeginActionButton, goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // show the buttons on mouse enter and hide them on mouse exit<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseEnter, 0, NULL, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kTargetSpriteID, (void<span></span></pre></td></tr><tr><td scope="row"><pre>                                *)kGoToBeginningSpriteID, true, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetVisibleAction(myPenguinOneAction, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseExit, 0, NULL, 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kTargetSpriteID, (void<span></span></pre></td></tr><tr><td scope="row"><pre>                                *)kGoToBeginningSpriteID, false, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>. . .<span></span></pre></td></tr><tr><td scope="row"><pre>    // add penguin two<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myPenguinTwo, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myPenguinTwoAction);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // blink when clicked on<span></span></pre></td></tr><tr><td scope="row"><pre>    AddSpriteSetImageIndexAction(myPenguinTwoAction,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kQTEventMouseClick, 0, NULL, 0, 0, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                kPenguinClosedIndex, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>. . .<span></span></pre></td></tr><tr><td scope="row"><pre>    // add go to next button<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTCopyAtom(myNextButton, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                        &amp;myNextActionButton);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF117" title="Important Things to Note in the Sample Code"></a><h4>Important Things to Note in the Sample Code</h4><p>You should note the following in <code>MakeActionSpriteMovie.c</code> sample code:</p><ul class="spaceabove"><li class="li"><p>There are event types other than mouse-related events (for example, <code>Idle</code> and <code>frameLoaded</code>).</p></li><li class="li"><p>Idle events are independent of the movie’s rate, and can be gated, so they are sent at most every <code>n</code> ticks. (The second penguin moves when the movie’s rate is 0, and moves only once per second because of the value of the sprite tracks <code>idleEventFrequency</code> property.)</p></li><li class="li"><p>Multiple actions may be executed in response to a single event (for example, rolling over the first penguin shows and hides four different buttons). </p></li><li class="li"><p>Actions may target any sprite or track in the movie (for example, clicking on one penguin changes the graphics mode of the other). </p></li><li class="li"><p>Conditional and looping control structures are supported. (The second penguin uses the “case statement” action.)</p></li><li class="li"><p>Sprite track variables that have not been set have a default value of 0. (The second penguin’s conditional code relies on this.)</p></li></ul><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIHEABA" title="Authoring Movies With External Movie Targets"></a><h2>Authoring Movies With External Movie Targets</h2><p>QuickTime enables you to author movies with external movie targets. To accomplish this, two target atoms were introduced in QuickTime 4, as explained in the following section. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF118" title="Specifying an External Movie Target for an Action"></a><h3>Specifying an External Movie Target for an Action</h3><p>In order to specify that an action is to target an element of an external movie, the external movie must be identified by either its name or its ID. To do this, two new target atom types have been introduced; these atoms are used in addition to the existing target atoms, which may specify that the element is a particular Track or object within a Track such as a Sprite.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_25" title="Note"></a><p><strong>Note:</strong>&nbsp;A movie ID may be specified by an expression. </p></div><p>The additional target atoms provided in QuickTime 4:</p><div class="codesample"><table><tr><td scope="row"><pre>[(ActionTargetAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;kActionTarget><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetMovieName><span></span></pre></td></tr><tr><td scope="row"><pre>            [Pstring MovieName]<span></span></pre></td></tr><tr><td scope="row"><pre>        OR<span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;kTargetMovieID><span></span></pre></td></tr><tr><td scope="row"><pre>            [long MovieID]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>            [(kExpressionAtoms)]<span></span></pre></td></tr></table></div><p>To tag a movie with a name or ID, you add a user data item of type '<code>plug</code>' to the movie’s user data. The index of the user data does not matter. The data specifies the name or ID. </p><p>You add a user data item of type '<code>plug</code>' to the movie’s user data with its data set to </p><div class="codesample"><table><tr><td scope="row"><pre>"Movieid=MovieName"<span></span></pre></td></tr></table></div><p>where <code>MovieName</code> is the name of the movie. </p><p>You add a user data item of type<code></code>'<code>plug</code>' to the movie’s user data with its data set to </p><div class="codesample"><table><tr><td scope="row"><pre>"Movieid=MovieID"<span></span></pre></td></tr></table></div><p>where the ID is a signed long integer.</p><p>The QuickTime plug-in additionally supports EMBED tag parameters, which allow you to override a movie’s name or ID within an HTML page. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF119" title="Target Atoms for Embedded Movies"></a><h3>Target Atoms for Embedded Movies</h3><p>Target atoms accommodate embedded movies. These target atoms allow for paths to be specified in a hierarchical movie tree.</p><p>Target movies may be an external movie, the default movie, or any movie embedded within another movie. Targets are specified by using a movie path that may include parent and child movie relationships, and may additionally include track and track object target atoms as needed.</p><p>By using embedded <code>kActionTarget</code> atoms along with parent and child movie target atoms, you can build up paths for movie targets. QuickTime looks for these embedded <code>kActionTarget </code>atoms only when evaluating a movie target, and any movie target type may contain a sibling <code>kActionTarget </code>atom.</p><p>Paths begin from the current movie, which is the movie containing the object that is handling an event. You may go up the tree using a <code>kTargetParentMovie</code> atom, or down the tree using one of five new child movie atoms. You may use a <code>kTargetRootMovie</code> atom as a shortcut to get to the top of the tree containing an embedded movie and may use the <code>movieByName</code> and <code>movieByID</code> atoms to specify a root external movie.</p><p>The <a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_129"></a><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_130"></a>target atoms are </p><ul class="spaceabove"><li class="li"><p><code>kTargetRootMovie</code><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_131"></a> (leaf atom, no data). This is the root movie containing the action handler.</p></li><li class="li"><p><code>kTargetParentMovie</code><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_132"></a>  (leaf atom, no data). This is the parent movie.</p></li></ul><p>There are five ways to specify an <a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_133"></a>embedded child movie. Three of them specify movie track properties. Two specify properties of the currently loaded movie in a movie track.</p><ul class="spaceabove"><li class="li"><p><code>kTargetChildMovieTrackName.</code> A child movie track specified by track name. </p></li><li class="li"><p><code>kTargetChildMovieTrackID</code>. A child movie track specified by track ID.</p></li><li class="li"><p><code>kTargetChildMovieTrackIndex</code>. A child movie track specified by track index.</p></li><li class="li"><p><code>kTargetChildMovieMovieName</code>. A child movie specified by the currently loaded movie’s movie name. The child movie must contain <code>movieName</code> user data with the specified name.</p></li><li class="li"><p><code>kTargetChildMovieMovieID</code>. A child movie specified by the currently loaded movie’s movie ID. The child movie must contain <code>movieID</code> user data with the specified ID.</p></li></ul><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF120" title="Supporting External Movie Targets"></a><h3>Supporting External Movie Targets</h3><p>If you want your application to support external movie targets, you need to resolve the movie names or IDs to actual movie references. This is accomplished by installing a Movie Controller filter proc for each Movie Controller that filters for the <code>mcActionGetExternalMovie</code> action.</p><p>The parameter to the <code>mcActionGetExternalMovie</code> Movie Controller action is a pointer to a <code>QTGetExternalMovieRecord</code>.</p><p>First, you look at the <code>targetType</code> field. If it is set to <code>kTargetMovieName</code>, then return the movie and Movie Controller for the movie named by the <code>MovieName</code> field. If it is set to <code>kTargetMovieID</code>, then return the movie and Movie Controller for the movie with ID equal to the <code>MovieID</code> field.</p><p>If you cannot find a matching movie, then set <code>theMovie</code> and <code>theController</code> to <code>nil</code>.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF121" title="Specifying String Parameters to  Actions and Operands"></a><h3>Specifying String Parameters to  Actions and Operands</h3><p>While QuickTime 3 supported only leaf data constants for string parameters, QuickTime 4 lets you can specify string parameters using leaf data constants, a numeric expression, or a sprite track variable. </p><p>Expressions are converted to strings, as are sprite track variable s if they contain a floating-point number instead of a string. Note that although string variables are stored as C strings, they will be automatically converted to Pascal strings as needed.</p><p>This applies to the following action and operand parameters:</p><div class="codesample"><table><tr><td scope="row"><pre>    C String Parameters<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionGoToURL, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionStatusString, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionAddChannelSubscription, 2<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionAddChannelSubscription, 3<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionRemoveChannelSubscription, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kOperandSubscribedToChannel, 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Pascal String Parameters<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionMovieGoToTimeByName, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionMovieSetSelectionByName, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionMovieSetSelectionByName, 2<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionPushCurrentTimeWithLabel, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionPopAndGotoLabeledTime, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionDebugStr, 1<span></span></pre></td></tr><tr><td scope="row"><pre>        kActionAddChannelSubscription, 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    Extended Grammar:<span></span></pre></td></tr><tr><td scope="row"><pre>        [(C String Parameter)] =<span></span></pre></td></tr><tr><td scope="row"><pre>                [CString]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>                [(ExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>                [(SpriteTrackVariableOperandAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        [(Pascal String Parameter)] =<span></span></pre></td></tr><tr><td scope="row"><pre>                [Pascal String]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>                [(ExpressionAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>            OR<span></span></pre></td></tr><tr><td scope="row"><pre>                [(SpriteTrackVariableOperandAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        [(SpriteTrackVariableOperandAtoms)] =<span></span></pre></td></tr><tr><td scope="row"><pre>            &lt;kOperandSpriteTrackVariable>, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>                [(ActionTargetAtoms)]<span></span></pre></td></tr><tr><td scope="row"><pre>                kActionParameter, 1, 1<span></span></pre></td></tr><tr><td scope="row"><pre>                    [(spriteVariableID)]<span></span></pre></td></tr><tr><td scope="row"><pre>                    OR<span></span></pre></td></tr><tr><td scope="row"><pre>                    [(ExpressionAtoms)]<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIIHJAG" title="Wiring a Movie by Adding an HREF Track"></a><h2>Wiring a Movie by Adding an HREF Track</h2><p>QuickTime enables you to wire a movie by adding an HREF track to it. An HREF track is a specially named text track that contains hypertext references (HREFs). These references are in the form of URLs and can point to any kind of data that a URL can specify, such as a Web page, a QuickTime movie, or a JavaScript script. </p><p>A URL can be invoked automatically when the movie plays, or it can be invoked interactively when the user clicks the mouse inside a movie. The URL can be targeted to a particular frame, or to the QuickTime movie itself, or it can be untargeted, in which case it will load in the default browser window.</p><p>You can only add one HREF track per movie. If you add more than one HREF track to a movie, QuickTime uses the first one it finds and ignore any others.</p><p>The syntax for an HREF track sample is:</p><div class="codesample"><table><tr><td scope="row"><pre>[nn:nn:nn.n]<span></span></pre></td></tr><tr><td scope="row"><pre>A&lt;URL> T&lt;frame><span></span></pre></td></tr></table></div><p>where <code>[nn:nn:nn.n]</code> is a timestamp in hours:minutes:seconds.timeunits and where timeunits are in the time scale of the track. The URL becomes active at the time specified and remains active until the next timestamp. If there is no following timestamp, the URL remains active. The URL is active even if the movie is not playing.</p><p><code>A&lt;URL></code> specifies the URL. If the <code>A</code> is omitted, the user must click inside the movie during the period when the URL is active to cause the URL to load. If the <code>A</code> is present, the URL loads automatically when the movie is played.</p><p>The URL can be absolute or relative to the movie.</p><div class="importantbox"><a name="//apple_ref/doc/uid/TP40000883-CH208-DontLinkElementID_26" title="Important:"></a><p><strong>Important:</strong>&nbsp;A relative URL is relative to the movie, not the Web page that contains the movie. If the movie and its parent Web page are in the same directory, this is the same thing, but if the movie and the Web page are not in the same directory, the difference is crucial. </p><p></p></div><p>The URL can include an internal anchor name as well as a path and filename (for example, “../HTML/Page1.htm#StepOne”).</p><p><code>T&lt;frame></code> is an optional parameter. If a target frame is specified, the URL is targeted to that frame. If the frame does not exist, it is created.</p><p>If no target frame is specified, the URL will load in the default browser frame. If the movie is playing in a Web page, the Web page is replaced by the specified URL. If the movie is playing in an application such as QuickTime Player, the URL loads in the default browser (which will be invoked if it is not already running).</p><p>If the target frame “myself” is specified, the URL is opened by QuickTime within the application playing the movie, such as the QuickTime plug-in or QuickTime Player. This works properly only if the URL points to a file that QuickTime can handle directly, such as a QuickTime movie or an AIFF audio file.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF122" title="Creating an HREF Track"></a><h3>Creating an HREF Track</h3><p>An HREF track can be created using a text editor and imported using a movie import component, or it can be created programmatically. </p><p>You create an HREF track programmatically by creating a text track, adding the URLs as text samples, then setting the name of the track to “HREFTrack”. The track name is stored in the user data atom. The following code snippet shows how to change the name of a text track to “HREFTrack”.</p><div class="codesample"><table><tr><td scope="row"><pre>Str255  trackNameStr = “HREFTrack”<span></span></pre></td></tr><tr><td scope="row"><pre>UserDat ud = GetTrackUserData(theTrack);<span></span></pre></td></tr><tr><td scope="row"><pre>OSType  dataType = FOUR_CHAR_CODE('name');<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>RemoveUserData(ud, dataType, 1);    // remove existing name, if any<span></span></pre></td></tr><tr><td scope="row"><pre>SetUserDataItem(ud, &amp;trackNameStr[1], trackNameStr[0], dataType, 0);<span></span></pre></td></tr></table></div><p>Because the HREF track is a text track, it will display its samples as on-screen text while the movie plays. This is normally desirable during debugging. To turn the text off, you disable the track by calling the <code>SetTrackEnabled</code> function. </p><p>When flattening a movie that contains an HREF track, be careful not to accidentally delete the disabled text track by calling <code>FlattenMovie</code> with the <code>flattenActiveTracksOnly</code> flag.</p><a name="//apple_ref/doc/uid/TP40000883-CH208-BCIICIJF" title="Adding Hypertext Links to a QuickTime Movie  With a Text Track"></a><h2>Adding Hypertext Links to a QuickTime Movie  With a Text Track</h2><p>This section illustrates how you can add a few wired actions to a movie that has a text track. In particular, it adds two go-to-URL actions to parts of the text track. </p><p>A text media sample is a 16-bit length word followed by the text of that sample. Optionally, one or more atoms of additional data (called text atom extensions) may follow the text in the sample. The length word specifies the total number of bytes in the text and in any text atom extensions that follow the text. These text atom extensions are organized as “classic” atom structures: a 32-bit length field, followed by a 32-bit type field, followed by the data in the atom. Here, the length field specifies the total length of the atom (that is, 8 plus the number of bytes in the data.) All the data in the text extension atom must be in big-endian format.</p><p>To add hypertext actions to a text sample, you simply add a text atom extension of the type <code>kHyperTextTextAtomType</code> to the end of the sample; the data of the text atom extension is the container that holds the information about the actions. The programming tasks are outlined in these steps. </p><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF123" title="Step #1&acirc;&#128;&#147;&acirc;&#128;&#147;Creating a Movie With a Text Track  and Hypertext Links"></a><h3>Step #1––Creating a Movie With a Text Track  and Hypertext Links</h3><p>You create a text movie with hypertext links. </p><div class="codesample"><table><tr><td scope="row"><pre>    if (myReply.sfGood) {<span></span></pre></td></tr><tr><td scope="row"><pre>        myErr = AddHTAct_CreateTextMovie(&amp;myReply.sfFile);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (myErr == noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>            myErr = AddHTAct_AddHyperTextToTextMovie(&amp;myReply.sfFile);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr></table></div><p>To create a movie with a text track, you call <code>AddHTAct_CreateTextMovie</code>.</p><div class="codesample"><table><tr><td scope="row"><pre>static OSErr AddHTAct_CreateTextMovie (FSSpec *theFSSpec)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short           myResRefNum = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    short           myResID = movieInDataForkResID;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie           myMovie = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track           myTrack = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media           myMedia = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    MediaHandler    myHandler = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Rect            myTextBox;<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor        myTextColor =   {0x6666, 0xCCCC, 0xCCCC};<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor        myBackColor =   {0x3333, 0x6666, 0x6666};<span></span></pre></td></tr><tr><td scope="row"><pre>    RGBColor        myHiliteColor = {0x0000, 0x0000, 0x0000};<span></span></pre></td></tr><tr><td scope="row"><pre>    long            myDisplayFlags = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    short           myHiliteStart = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    short           myHiliteEnd = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue       myNewMediaTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue       myScrollDelay = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>#if TARGET_OS_MAC<span></span></pre></td></tr><tr><td scope="row"><pre>    char            myText[] = "\rPlease take me to Apple or CNN";<span></span></pre></td></tr><tr><td scope="row"><pre>#else<span></span></pre></td></tr><tr><td scope="row"><pre>    char            myText[] = "\nPlease take me to Apple or CNN";<span></span></pre></td></tr><tr><td scope="row"><pre>#endif<span></span></pre></td></tr><tr><td scope="row"><pre>    long            myFlags = createMovieFileDeleteCurFile | createMovieFileDontCreateResFile | newMovieActive;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           myErr = noErr;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF124" title="Step #2&acirc;&#128;&#147;&acirc;&#128;&#147;Creating a New Text Movie"></a><h3>Step #2––Creating a New Text Movie</h3><p>Now you create a new text movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    myErr = CreateMovieFile(theFSSpec, FOUR_CHAR_CODE(‘TVOD’), 0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            myFlags, &amp;myResRefNum, &amp;myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myTrack = NewMovieTrack(myMovie, FixRatio(kWidth320, 1),<span></span></pre></td></tr><tr><td scope="row"><pre>                            FixRatio(kHeight240, 1), kTrackVolumeZero);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myMedia = NewTrackMedia(myTrack, TextMediaType, kTimeScale600, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((myTrack == NULL) || (myMedia == NULL))<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = BeginMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myHandler = GetMediaHandler(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF125" title="Step #3&acirc;&#128;&#147;&acirc;&#128;&#147;Adding a Text Sample to the Movie"></a><h3>Step #3––Adding a Text Sample to the Movie</h3><p>You add a text sample to the movie, as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>    MacSetRect(&amp;myTextBox, 0, 0, kWidth320, kHeight240);<span></span></pre></td></tr><tr><td scope="row"><pre>    MacInsetRect(&amp;myTextBox, kTextBoxInset, kTextBoxInset);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = (OSErr)TextMediaAddTextSample(  myHandler,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            myText,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            strlen(myText),<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kFontIDSymbol,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kSize48,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kFacePlain,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myTextColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myBackColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            teCenter,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myTextBox,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            myDisplayFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            myScrollDelay,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            myHiliteStart,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            myHiliteEnd,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myHiliteColor,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            kTimeScale600,<span></span></pre></td></tr><tr><td scope="row"><pre>                                            &amp;myNewMediaTime);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = EndMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the media to the track, at time 0<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = InsertMediaIntoTrack(myTrack, kTrackStartTimeZero,<span></span></pre></td></tr><tr><td scope="row"><pre>                                myNewMediaTime, kTimeScale600, fixed1);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add the movie resource<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddMovieResource(myMovie, myResRefNum, &amp;myResID, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myResRefNum != -1)<span></span></pre></td></tr><tr><td scope="row"><pre>        CloseMovieFile(myResRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myMovie != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeMovie(myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return(myErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You call <code>AddHTAct_CreateHyperTextActionContainer</code>, which returns, through the theActions parameter, an atom container that contains some hypertext actions.</p><div class="codesample"><table><tr><td scope="row"><pre>static OSErr AddHTAct_CreateHyperTextActionContainer (QTAtomContainer *theActions)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myEventAtom = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myActionAtom = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myHyperTextAtom = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtom          myWiredObjectsAtom = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            myAction;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            mySelStart1 = 19;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            mySelEnd1 = 24;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            mySelStart2 = 28;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            mySelEnd2 = 31;<span></span></pre></td></tr><tr><td scope="row"><pre>    long            myValue;<span></span></pre></td></tr><tr><td scope="row"><pre>    char            myAppleURL[64] = "\pwww.apple.com\0";<span></span></pre></td></tr><tr><td scope="row"><pre>    char            myCnnURL[64] = "\pwww.cnn.com\0";<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr           myErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTNewAtomContainer(theActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    // create a wired objects atom<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, kParentAtomIsContainer,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kTextWiredObjectsAtomType, kIndexOne,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexZero, kZeroDataLength, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myWiredObjectsAtom);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF126" title="Step #4&acirc;&#128;&#147;&acirc;&#128;&#147;Adding a Hypertext Link"></a><h3>Step #4––Adding a Hypertext Link</h3><p>Now you add a hypertext link to the wired objects atom: ID 1</p><div class="codesample"><table><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myWiredObjectsAtom, kHyperTextItemAtomType, kIDOne, kIndexZero, kZeroDataLength, NULL, &amp;myHyperTextAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myValue = EndianS32_NtoB(mySelStart1);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kRangeStart,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIDOne, kIndexZero, sizeof(long), &amp;myValue,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myValue = EndianS32_NtoB(mySelEnd1);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kRangeEnd,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIDOne, kIndexZero, sizeof(long), &amp;myValue,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add an event atom to the hypertext atom;<span></span></pre></td></tr><tr><td scope="row"><pre>    // the event type can be any of the five mouse events: down, up,<span></span></pre></td></tr><tr><td scope="row"><pre>    // trigger, enter, exit<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kQTEventType,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kQTEventMouseClick, kIndexZero,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kZeroDataLength, NULL, &amp;myEventAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myEventAtom, kAction, kIndexOne,<span></span></pre></td></tr><tr><td scope="row"><pre>                        kIndexOne, kZeroDataLength, NULL, &amp;myActionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myAction = EndianS32_NtoB(kActionGoToURL);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myActionAtom, kWhichAction,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexOne, kIndexOne, sizeof(long),<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myAction, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myActionAtom, kActionParameter,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexOne, kIndexOne, myAppleURL[0] + 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myAppleURL[1], NULL);<span></span></pre></td></tr></table></div><p>Now we add a hypertext link to the wired objects atom: ID 2</p><div class="codesample"><table><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myWiredObjectsAtom,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kHyperTextItemAtomType, kIDTwo, kIndexZero,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kZeroDataLength, NULL, &amp;myHyperTextAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myValue = EndianS32_NtoB(mySelStart2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kRangeStart,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIDOne, kIndexZero, sizeof(long), &amp;myValue,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myValue = EndianS32_NtoB(mySelEnd2);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kRangeEnd,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIDOne, kIndexZero, sizeof(long), &amp;myValue,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add an event atom to the hypertext atom;<span></span></pre></td></tr><tr><td scope="row"><pre>    // the event type can be any of the five mouse events: down, up,<span></span></pre></td></tr><tr><td scope="row"><pre>    // trigger, enter, exit<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myHyperTextAtom, kQTEventType,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kQTEventMouseClick, kIndexZero,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kZeroDataLength, NULL, &amp;myEventAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myEventAtom, kAction, kIndexOne,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexOne, kZeroDataLength, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myActionAtom);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myAction = EndianS32_NtoB(kActionGoToURL);<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myActionAtom, kWhichAction,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexOne, kIndexOne, sizeof(long),<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myAction, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = QTInsertChild(*theActions, myActionAtom, kActionParameter,<span></span></pre></td></tr><tr><td scope="row"><pre>                            kIndexOne, kIndexOne, myCnnURL[0] + 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myCnnURL[1], NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF127" title="Step #5&acirc;&#128;&#147;&acirc;&#128;&#147;Adding a Specified Atom Container"></a><h3>Step #5––Adding a Specified Atom Container</h3><p>You call <code>AddHTAct_AddHyperActionsToSample</code> to add the specified atom container to the end of the specified media sample.</p><p>Hypertext actions are stored at the end of the sample as a normal text atom extension. In this case, the text atom type is <code>kHyperTextTextAtomType</code> and the data is the container data.</p><div class="codesample"><table><tr><td scope="row"><pre>static OSErr AddHTAct_AddHyperActionsToSample (Handle theSample, QTAtomContainer theActions)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    Ptr         myPtr = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        myHandleLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        myContainerLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    long        myNewLength;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr       myErr = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myHandleLength = GetHandleSize(theSample);<span></span></pre></td></tr><tr><td scope="row"><pre>    myContainerLength = GetHandleSize((Handle)theActions);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myNewLength = (long)(sizeof(long) + sizeof(OSType) +<span></span></pre></td></tr><tr><td scope="row"><pre>                    myContainerLength);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    SetHandleSize(theSample, (myHandleLength + myNewLength));<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = MemError();<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    HLock(theSample);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // get a pointer to the beginning of the new block of space added to<span></span></pre></td></tr><tr><td scope="row"><pre>    // the sample by the previous call to SetHandleSize; we need to<span></span></pre></td></tr><tr><td scope="row"><pre>    // format that space as a text atom extension<span></span></pre></td></tr><tr><td scope="row"><pre>    myPtr = *theSample + myHandleLength;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set the length of the text atom extension<span></span></pre></td></tr><tr><td scope="row"><pre>    *(long *)myPtr = EndianS32_NtoB((long)(sizeof(long) + sizeof(OSType)<span></span></pre></td></tr><tr><td scope="row"><pre>                                    + myContainerLength));<span></span></pre></td></tr><tr><td scope="row"><pre>    myPtr += (sizeof(long));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set the type of the text atom extension<span></span></pre></td></tr><tr><td scope="row"><pre>    *(OSType *)myPtr = EndianS32_NtoB(kHyperTextTextAtomType);<span></span></pre></td></tr><tr><td scope="row"><pre>    myPtr += (sizeof(OSType));<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // set the data of the text atom extension;<span></span></pre></td></tr><tr><td scope="row"><pre>    // we assume that this data is already in big-endian format<span></span></pre></td></tr><tr><td scope="row"><pre>    HLock((Handle)theActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    BlockMove(*theActions, myPtr, myContainerLength);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    HUnlock((Handle)theActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    HUnlock(theSample);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>To add some hypertext actions to the specified text movie, you call <code><!--a-->AddHTAct_AddHyperTextToTextMovie<!--/a--></code>.</p><div class="codesample"><table><tr><td scope="row"><pre>static OSErr AddHTAct_AddHyperTextToTextMovie (FSSpec *theFSSpec)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    short                           myResID = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                           myResRefNum = -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    Movie                           myMovie = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Track                           myTrack = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Media                           myMedia = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue                       myTrackOffset;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue                       myMediaTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue                       mySampleDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue                       mySelectionDuration;<span></span></pre></td></tr><tr><td scope="row"><pre>    TimeValue                       myNewMediaTime;<span></span></pre></td></tr><tr><td scope="row"><pre>    TextDescriptionHandle           myTextDesc = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    Handle                          mySample = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    short                           mySampleFlags;<span></span></pre></td></tr><tr><td scope="row"><pre>    Fixed                           myTrackEditRate;<span></span></pre></td></tr><tr><td scope="row"><pre>    QTAtomContainer                 myActions = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                           myErr = noErr;<span></span></pre></td></tr></table></div><p>At this point you open the movie file and get the first text track from the movie and then find the first text track in the movie. </p><div class="codesample"><table><tr><td scope="row"><pre>    myErr = OpenMovieFile(theFSSpec, &amp;myResRefNum, fsRdWrPerm);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = NewMovieFromFile(&amp;myMovie, myResRefNum, &amp;myResID, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                                newMovieActive, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myTrack = GetMovieIndTrackType(myMovie, kIndexOne, TextMediaType,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    movieTrackMediaType);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myTrack == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF128" title="Step #6&acirc;&#128;&#147;&acirc;&#128;&#147;Getting the First Media Sample"></a><h3>Step #6––Getting the First Media Sample</h3><p>Now you get the first media sample in the text track. </p><div class="codesample"><table><tr><td scope="row"><pre>    myMedia = GetTrackMedia(myTrack);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myTrackOffset = GetTrackOffset(myTrack);<span></span></pre></td></tr><tr><td scope="row"><pre>    myMediaTime = TrackTimeToMediaTime(myTrackOffset, myTrack);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // allocate some storage to hold the sample description for the text<span></span></pre></td></tr><tr><td scope="row"><pre>    // track<span></span></pre></td></tr><tr><td scope="row"><pre>    myTextDesc = (TextDescriptionHandle)NewHandle(4);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myTextDesc == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    mySample = NewHandle(0);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (mySample == NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = GetMediaSample(myMedia, mySample, 0, NULL, myMediaTime, NULL,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;mySampleDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            (SampleDescriptionHandle)myTextDesc, NULL, 1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            NULL, &amp;mySampleFlags);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myErr != noErr)<span></span></pre></td></tr><tr><td scope="row"><pre>        goto bail;<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF129" title="Step #7&acirc;&#128;&#147;&acirc;&#128;&#147;Adding Hypertext Actions"></a><h3>Step #7––Adding Hypertext Actions</h3><p>Now you add hypertext actions to the first media sample. </p><div class="codesample"><table><tr><td scope="row"><pre>    // create an action container for hypertext actions<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddHTAct_CreateHyperTextActionContainer(&amp;myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // add hypertext actions actions to sample<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddHTAct_AddHyperActionsToSample(mySample, myActions);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF130" title="Step #8&acirc;&#128;&#147;&acirc;&#128;&#147;Replacing the Sample"></a><h3>Step #8––Replacing the Sample</h3><p>Now you replace sample in the media. </p><div class="codesample"><table><tr><td scope="row"><pre>    myTrackEditRate = GetTrackEditRate(myTrack, myTrackOffset);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    GetTrackNextInterestingTime(myTrack, nextTimeMediaSample |<span></span></pre></td></tr><tr><td scope="row"><pre>                                nextTimeEdgeOK, myTrackOffset, fixed1,<span></span></pre></td></tr><tr><td scope="row"><pre>                                NULL, &amp;mySelectionDuration);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = DeleteTrackSegment(myTrack, myTrackOffset,<span></span></pre></td></tr><tr><td scope="row"><pre>                                mySelectionDuration);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = BeginMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = AddMediaSample( myMedia,<span></span></pre></td></tr><tr><td scope="row"><pre>                            mySample,<span></span></pre></td></tr><tr><td scope="row"><pre>                            0,<span></span></pre></td></tr><tr><td scope="row"><pre>                            GetHandleSize(mySample),<span></span></pre></td></tr><tr><td scope="row"><pre>                            mySampleDuration,<span></span></pre></td></tr><tr><td scope="row"><pre>                            (SampleDescriptionHandle)myTextDesc,<span></span></pre></td></tr><tr><td scope="row"><pre>                            1,<span></span></pre></td></tr><tr><td scope="row"><pre>                            mySampleFlags,<span></span></pre></td></tr><tr><td scope="row"><pre>                            &amp;myNewMediaTime);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = EndMediaEdits(myMedia);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    // add the media to the track<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = InsertMediaIntoTrack(myTrack, myTrackOffset, myNewMediaTime,<span></span></pre></td></tr><tr><td scope="row"><pre>                                    mySelectionDuration,myTrackEditRate);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40000883-CH208-TPXREF131" title="Step #9&acirc;&#128;&#147;&acirc;&#128;&#147;Updating the Movie Resource"></a><h3>Step #9––Updating the Movie Resource</h3><p>Finally, you update the movie resource. </p><div class="codesample"><table><tr><td scope="row"><pre>    myErr = UpdateMovieResource(myMovie, myResRefNum, myResID, NULL);<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre>    .<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // close the movie file<span></span></pre></td></tr><tr><td scope="row"><pre>    myErr = CloseMovieFile(myResRefNum);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>bail:<span></span></pre></td></tr><tr><td scope="row"><pre>    if (myActions != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        (void)QTDisposeAtomContainer(myActions);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (mySample != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle(mySample);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myTextDesc != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeHandle((Handle)myTextDesc);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (myMovie != NULL)<span></span></pre></td></tr><tr><td scope="row"><pre>        DisposeMovie(myMovie);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return(myErr);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../spritemediahandler/3-Sprite-Media-Handler.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../usingspriteanimation/5-Using-Sprite-Anim.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2002 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2002-10-01<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/QuickTime/IQ_InteractiveMovies/authoringwiredmovies/4-Authoring-Wired-Movies.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/QuickTime/IQ_InteractiveMovies/authoringwiredmovies/4-Authoring-Wired-Movies.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/QuickTime/IQ_InteractiveMovies/authoringwiredmovies/4-Authoring-Wired-Movies.html%3Fid%3DTP40000883-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>