<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Initializing and Releasing Cyberdog Objects(Cyberdog)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING24></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Cyberdog-23.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-25.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Cyberdog-2.html"><B>Cyberdog Programmer's Kit</B></A> / <A HREF="Cyberdog-20.html"><B>Part 2 - Programming in Cyberdog</B></A><BR><DD><A HREF="Cyberdog-21.html"><B>Chapter 3 - Adding Cyberdog Features to an OpenDoc Part</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING24-0></A>
<H1><A NAME=MARKER-9-25></A>Initializing and Releasing Cyberdog Objects</H1>
 Your part must take several actions when it is created or destroyed to support Cyberdog and its menus. When your part is created, it must call the <CODE>InitCyberdog</CODE> function to initialize Cyberdog. It should also set up Cyberdog's menus. Before your part is released or destroyed, it must delete the Cyberdog service menu object and release the Cyberdog item, if it exists.<P>
 In the button part, the initialization is performed by the <CODE>InitPart</CODE> method, shown in <A HREF=Cyberdog-25.html#MARKER-9-34>Listing 3-5</A> <A HREF=Cyberdog-25.html#MARKER-9-34>(page 97)</A>, and the <CODE>InitPartFromStorage</CODE> method (not shown). These methods call the <CODE>Initialize</CODE> method (<A HREF=#MARKER-9-27>Listing 3-2</A>) to actually perform the required initialization. The <CODE>Initialize</CODE> method obtains the OpenDoc session and calls the <A NAME=MARKER-2-26></A>InitCyberdog function to initialize Cyberdog. It calls the CreateMenus method to create the menus; for more information, see <A HREF=Cyberdog-26.html#MARKER-9-55>"Displaying Cyberdog Menus" (page 105)</A>.<P>
<DL>
<DT><B>Note</B>
<DD>In this example, a Cyberdog item is created initially by the <CODE>InitPart</CODE> method. For information about creating Cyberdog items, see <A HREF=Cyberdog-25.html#MARKER-9-30>"Creating a Cyberdog Item From a URL" (page 97)</A>. <EM>u</EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<B>Listing 3-2  <A NAME=MARKER-9-27></A>Initializing the button part</B><P>
<PRE>
void CybTxtBtn::Initialize( Environment* ev, ODStorageUnit* storageUnit)
{
   ...
   // Initialize Cyberdog.
   ODSession* session = ODGetSession(ev,fSelf);
   OSErr err = InitCyberdog(ev, session);
   ...
   CreateMenus(ev);
   ...}
</PRE>
 When a part is destroyed, its <CODE>ReleaseAll</CODE> method is called. This method is a good place to delete the Cyberdog item and the Cyberdog service menu object and release the menu bar with which the menu object is associated. <A HREF=#MARKER-9-28>Listing 3-3</A> shows how the button part handles these actions.<P>
<B>Listing 3-3  <A NAME=MARKER-9-28></A>The button part's <CODE>ReleaseAll</CODE> method</B><P>
<PRE>
void CybTxtBtn::ReleaseAll( Environment* ev )
{
   TRY
      if (fCyberServiceMenu != kODNULL)
      {
         delete fCyberServiceMenu;
         fCyberServiceMenu = kODNULL;
      }
      if (fMenuBar != kODNULL)
      {
         fMenuBar-&gt;Release(ev);
         fMenuBar = kODNULL;
      }
      if (fCyberItem != kODNULL)
      {
         fCyberItem-&gt;Release(ev);
         fCyberItem = kODNULL;
      }
      ...
   CATCH_ALL
      RERAISE; 
   ENDTRY
}
</PRE>
 The destructor for your part class should release any objects that the part still references. You should release the Cyberdog item. Releasing the item decrements its reference count and causes it to be deleted. <A HREF=#MARKER-9-29>Listing 3-4</A> shows the destructor for the CybTxtBtn part class.<P>
<B>Listing 3-4  <A NAME=MARKER-9-29></A>The <CODE>CybTxtBtn</CODE> destructor</B><P>
<PRE>
CybTxtBtn::~CybTxtBtn()
{
   Environment* ev = somGetGlobalEnvironment();
   if (fCyberItem != kODNULL)
   {
      TRY
         fCyberItem-&gt;Release(ev);
      CATCH_ALL
      ENDTRY
      
      fCyberItem = kODNULL;
   }
}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Cyberdog-23.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Cyberdog-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Cyberdog-319.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Cyberdog-25.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Cyberdog-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>   
