<html><head><title>Mac OS X
 Manual Page For icmp(4)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/4/icmp" title="Mac OS X
 Manual Page for icmp(4)"><!-- headerDoc=man; indexgroup=Section 4; uid="//apple_ref/doc/man/4/icmp"; name=icmp(4) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
ICMP(4)                  BSD Kernel Interfaces Manual                  ICMP(4)

<b>NAME</b>
     <b>icmp</b> -- Internet Control Message Protocol

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/socket.h&gt;</b>
     <b>#include</b> <b>&lt;netinet/in.h&gt;</b>

     <u>int</u>
     <b>socket</b>(<u>AF</u><b>_</b><u>INET</u>, <u>SOCK</u><b>_</b><u>RAW</u>, <u>proto</u>);

<b>DESCRIPTION</b>
     ICMP is the error and control message protocol used by IP and the Internet protocol family.  It may be
     accessed through a ``raw socket'' for network monitoring and diagnostic functions.  The <u>proto</u> parameter
     to the socket call to create an ICMP socket is obtained from <a href="../man3/getprotobyname.3.html#//apple_ref/doc/man/3/getprotobyname">getprotobyname(3)</a>.  ICMP sockets are con-<font color="#ffffff" class="whiteout">nectionless,&nbsp;connectionless,</font>
     nectionless, and are normally used with the sendto and recvfrom calls, though the <a href="../man2/connect.2.html#//apple_ref/doc/man/2/connect">connect(2)</a> call may
     also be used to fix the destination for future packets (in which case the <a href="../man2/read.2.html#//apple_ref/doc/man/2/read">read(2)</a> or <a href="../man2/recv.2.html#//apple_ref/doc/man/2/recv">recv(2)</a> and
     <a href="../man2/write.2.html#//apple_ref/doc/man/2/write">write(2)</a> or <a href="../man2/send.2.html#//apple_ref/doc/man/2/send">send(2)</a> system calls may be used).

     Outgoing packets automatically have an IP header prepended to them (based on the destination address).
     Incoming packets are received with the IP header and options intact.  Note that the ip_off and ip_len
     fields are in host byte order.  For more information about the IP header structure, see <a href="ip.4.html#//apple_ref/doc/man/4/ip">ip(4)</a>.

   <b>Non-privileged</b> <b>ICMP</b>
     ICMP sockets can be opened with the SOCK_DGRAM socket type without requiring root privileges. The syn-<font color="#ffffff" class="whiteout">opsis&nbsp;synopsis</font>
     opsis is the following:

     <b>socket</b>(<u>AF</u><b>_</b><u>INET</u>, <u>SOCK</u><b>_</b><u>DGRAM</u>, <u>IPPROTO</u><b>_</b><u>ICMP</u>)

     Datagram oriented ICMP sockets offer a subset of the functionality available to raw ICMP sockets. Only
     IMCP request messages of the following types can be sent: ICMP_ECHO, ICMP_TSTAMP or ICMP_MASKREQ.  The
     code field must be the value zero (0).  The minimal length of an ICMP message request is eight (8)
     octets.

     The advantage of using datagram oriented ICMP sockets is that even a non-privileged process can use
     ICMP echo requests to gauge the quality of the connectivity to a host, or to receive ICMP destination
     unreachable message for path MTU discovery, or to receive time exceeded messages for traceroute.

     The following IP level option can be used with datagram oriented ICMP sockets:

         IP_OPTIONS
         IP_HDRINCL
         IP_TOS
         IP_TTL
         IP_RECVOPTS
         IP_RECVRETOPTS
         IP_RECVDSTADDR
         IP_RETOPTS
         IP_MULTICAST_IF
         IP_MULTICAST_TTL
         IP_MULTICAST_LOOP
         IP_ADD_MEMBERSHIP
         IP_DROP_MEMBERSHIP
         IP_MULTICAST_VIF
         IP_PORTRANGE
         IP_RECVIF
         IP_IPSEC_POLICY
         IP_STRIPHDR

     When the IP option IP_HDRINCL is used, the provided IP header must obey the following rules:

         ip_v       Must be IPVERSION (4);
         ip_hl      Between 5 and 10 (inclusive);
         ip_tos     Any value;
         ip_len     Must be the total length of IP datagram (IP header + ICMP message);
         ip_id      Must be zero, will be automatically set;
         ip_off     Must be zero, will be automatically set;
         ip_ttl     Any value;
         ip_p       Must be IPPROTO_IP;
         ip_sum     Value ignored, will be automatically set;
         ip_src     Must be an IP address currently assigned to one of the local interface or INADDR_ANY;
         ip_dst     Any address;
         ip_opts    Any option.

     The maximum length of a IMCP message that can be sent is controlled by the sysctl variable
     net.inet.raw.maxdgram.

<b>DIAGNOSTICS</b>
     A socket operation may fail with one of the following errors returned:

     [EISCONN]        when trying to establish a connection on a socket which already has one, or when try-<font color="#ffffff" class="whiteout">ing&nbsp;trying</font>
                      ing to send a datagram with the destination address specified and the socket is
                      already connected;

     [ENOTCONN]       when trying to send a datagram, but no destination address is specified, and the
                      socket hasn't been connected;

     [ENOBUFS]        when the system runs out of memory for an internal data structure;

     [EADDRNOTAVAIL]  when an attempt is made to create a socket with a network address for which no network
                      interface exists;

     [EINVAL]         when an invalid value is used with IMCP datagram socket for a field of the IP or ICMP
                      header.

<b>SEE</b> <b>ALSO</b>
     <a href="../man2/recv.2.html#//apple_ref/doc/man/2/recv">recv(2)</a>, <a href="../man2/send.2.html#//apple_ref/doc/man/2/send">send(2)</a>, <a href="inet.4.html#//apple_ref/doc/man/4/inet">inet(4)</a>, <!-- a -->intro(4)<!-- /a -->, <a href="ip.4.html#//apple_ref/doc/man/4/ip">ip(4)</a>

<b>HISTORY</b>
     The <b>icmp</b> protocol appeared in 4.3BSD.

4.3 Berkeley Distribution        June 19, 2002       4.3 Berkeley Distribution
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man4/icmp.4.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man4/icmp.4.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man4/icmp.4.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
