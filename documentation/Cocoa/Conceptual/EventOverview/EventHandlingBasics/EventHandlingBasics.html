<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Cocoa Event-Handling Guide: Event Handling Basics</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Event Handling Basics"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/10000060i-CH5" title="Event Handling Basics"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../EventsOtherInput-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000447" target="_top">Events &amp; Other Input</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/10000060i-CH1-SW1">Cocoa Event-Handling Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../EventObjectsTypes/EventObjectsTypes.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../HandlingMouseEvents/HandlingMouseEvents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/10000060i-CH5-SW11" title="Event Handling Basics"></a><h1>Event Handling Basics</h1><p>Some tasks found in event-handling code are common to events of more than one type. The following sections describe these basic event-handling tasks. Some of the information presented in this chapter is discussed at length, but using different examples, in the “<span class="content_text"><a href="../../CocoaViewsGuide/SubclassingNSView/SubclassingNSView.html#//apple_ref/doc/uid/TP40002978-CH7" target="_top">Creating a Custom View</a></span>“ chapter of <em><a href="../../CocoaViewsGuide/index.html#//apple_ref/doc/uid/TP40002978" target="_top">View Programming Guide for Cocoa</a></em>.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW14">Preparing a Custom View for Receiving Events</a>
				
			<br/>
			
        
			
			
				<a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW20">Implementing Action Methods</a>
				
			<br/>
			
        
			
			
				<a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW15">Getting the Location of an Event</a>
				
			<br/>
			
        
			
			
				<a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW16">Testing for Event Type and Modifier Flags</a>
				
			<br/>
			
        
			
			
				<a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW22">Responder-Related Tasks</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/10000060i-CH5-SW14" title="Preparing a Custom View for Receiving Events"></a><h2>Preparing a Custom View for Receiving Events</h2><p>Although any type of responder object can handle events, <code><a href="../../../Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> objects are by far the most common recipient of events. They are typically the first objects to respond to both mouse events and key events, often changing their appearance in reaction to those events. Many Application Kit classes are implemented to handle events, but by itself <code><a href="../../../Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> does not. When you create your own custom view and you want it to respond to events, you have to add event-handling capabilities to it. </p><p>The bare-minimum steps required for this are few:</p><ul class="ul"><li class="li"><p>If your custom view should be first responder for key events or action messages, override <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/acceptsFirstResponder" target="_top">acceptsFirstResponder</a></code>.</p></li><li class="li"><p>Implement one or more <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/cl/NSResponder" target="_top">NSResponder</a></code> methods to handle events of particular types.</p></li><li class="li"><p>If your view is to handle action messages passed to it via the responder chain, implement the appropriate action methods. </p></li></ul><p>A view that is first responder accepts key events and action messages before other objects in a window. It also typically takes part in the key loop (see <span class="content_text"><a href="../HandlingKeyEvents/HandlingKeyEvents.html#//apple_ref/doc/uid/10000060i-CH7-SW9">“Keyboard Interface Control”</a></span>). By default, view objects refuse first-responder status by returning <code>NO</code> in <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/acceptsFirstResponder" target="_top">acceptsFirstResponder</a></code>. If you want your custom view to respond to key events and actions, your class must override this method to return <code>YES</code>:</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW1"></a><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)acceptsFirstResponder {<span></span></pre></td></tr><tr><td scope="row"><pre>    return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/10000060i-CH5-SW19" title="Note"></a><p><strong>Note:</strong>&nbsp;A view that becomes first responder in order to respond to key events or action messages should reflect this status by drawing a focus ring around itself. The focus ring indicates that the object is the current first responder for key events.</p></div><p>The second item in the list above—overriding an <code>NSResponder</code> method to handle an event—is of course a large subject and what most remaining chapters in this document are about. But there are a few basic guidelines to consider for event messages: </p><ul class="ul"><li class="li"><p>If necessary, examine the passed-in <code>NSEvent</code> object to verify that it’s an event you handle and, if so, find out how to handle it.</p><p>Call the appropriate  <code>NSEvent</code> methods to help make this determination. For example, you might see which modifier keys were pressed (<code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/modifierFlags" target="_top">modifierFlags</a></code>), find out whether a mouse-down event is a double- or triple-click (<code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/clickCount" target="_top">clickCount</a></code>), or, for key events, get the associated characters (<code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/characters" target="_top">characters</a></code> and <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/charactersIgnoringModifiers" target="_top">charactersIgnoringModifiers</a></code>).</p></li><li class="li"><p>If your implementation of an <code>NSResponder</code> method such as <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/mouseDown:" target="_top">mouseDown:</a></code> completely handles an event it should not invoke the superclass implementation of that method.</p><p><code>NSView</code> inherits the <code>NSResponder</code> implementations of the methods for handling mouse events; in these methods, <code>NSResponder</code> simply passes the message up the responder chain. One of these objects in the responder chain can implement a method in a way that ensures your custom view won’t see subsequent related mouse events. Because of this, custom <code>NSView</code> objects should not invoke <code>super</code> in their implementations of <code>NSResponder</code> mouse-event-handling methods such as <code>mouseDown:</code>, <code>mouseDragged:</code> and <code>mouseUp:</code> unless it is known that the inherited implementation provides some needed functionality. </p></li><li class="li"><p>If you do not handle the event, pass it on up the responder chain. Although you can directly forward the message to the next responder, it’s generally better to forward the message to your superclass. If your superclass doesn’t handle the event, it forwards the message to its superclass, and so on, until <code>NSResponder</code> is reached. By default <code>NSResponder</code> passes all event messages up the responder chain. For example, instead of this:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)mouseDown:(NSEvent *)theEvent {<span></span></pre></td></tr><tr><td scope="row"><pre>    // determine if I handle theEvent<span></span></pre></td></tr><tr><td scope="row"><pre>    // if not...<span></span></pre></td></tr><tr><td scope="row"><pre>    [[self nextResponder] mouseDown:theEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>do this:</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)mouseDown:(NSEvent *)theEvent {<span></span></pre></td></tr><tr><td scope="row"><pre>    // determine if I handle theEvent<span></span></pre></td></tr><tr><td scope="row"><pre>    // if not...<span></span></pre></td></tr><tr><td scope="row"><pre>    [super mouseDown:theEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>If your subclass needs to handle particular events some of the time—only some typed characters, perhaps—then it must override the event method to handle the cases it’s interested in and to invoke the superclass implementation otherwise. This allows a superclass to catch the cases it’s interested in, and ultimately allows the event to continue on its way along the responder chain if it isn’t handled.</p></li><li class="li"><p>If you deliberately want to bypass the superclass implementation of an <code>NSResponder</code> method—say your superclass is <code>NSForm</code>—and yet pass an event up the responder chain, resend the message to <code>[self nextResponder]</code>.</p></li></ul><a name="//apple_ref/doc/uid/10000060i-CH5-SW20" title="Implementing Action Methods"></a><h2>Implementing Action Methods</h2><p>Action messages are typically sent by <code><a href="../../../Reference/ApplicationKit/Classes/NSMenuItem_Class/Reference/Reference.html#//apple_ref/occ/cl/NSMenuItem" target="_top">NSMenuItem</a></code> objects or by <code><a href="../../../Reference/ApplicationKit/Classes/NSControl_Class/Reference/Reference.html#//apple_ref/occ/cl/NSControl" target="_top">NSControl</a></code> objects. The latter objects usually work together with one or more <code><a href="../../../Reference/ApplicationKit/Classes/NSCell_Class/Reference/NSCell.html#//apple_ref/occ/cl/NSCell" target="_top">NSCell</a></code> objects. The cell object stores a method selector identifying the action message to be sent and a reference to the target object. (A menu item encapsulates its own action and target data.) When a menu item or control object is clicked or otherwise manipulated, it gets the action selector and target object—in the control’s case, from one of its cells—and sends the message to the target. </p><div class="notebox"><a name="//apple_ref/doc/uid/10000060i-CH5-SW21" title="Note"></a><p><strong>Note:</strong>&nbsp;For more on the target-action mechanism and action methods, see the appropriate sections in “<span class="content_text"><a href="../../CocoaFundamentals/CommunicatingWithObjects/CommunicateWithObjects.html#//apple_ref/doc/uid/TP40002974-CH7" target="_top">Communicating With Objects</a></span>" and “<span class="content_text"><a href="../../CocoaFundamentals/CoreAppArchitecture/CoreAppArchitecture.html#//apple_ref/doc/uid/TP40002974-CH8" target="_top">The Core Application Architecture on Mac OS X</a></span>“ in <em><a href="../../CocoaFundamentals/index.html#//apple_ref/doc/uid/TP40002974" target="_top">Cocoa Fundamentals Guide</a></em>. Also, for information about untargeted action messages and the path they take up the responder chain, see <span class="content_text"><a href="../EventArchitecture/EventArchitecture.html#//apple_ref/doc/uid/10000060i-CH3-SW7">“Action Messages”</a></span> and <span class="content_text"><a href="../EventArchitecture/EventArchitecture.html#//apple_ref/doc/uid/10000060i-CH3-SW9">“Responder Chain for Action Messages.”</a></span>  </p></div><p>You can set the action selector and target programmatically using, respectively, the methods <code><a href="../../../Reference/ApplicationKit/Classes/NSActionCell_Class/Reference/Reference.html#//apple_ref/occ/instm/NSActionCell/setAction:" target="_top">setAction:</a></code> and <code><a href="../../../Reference/ApplicationKit/Classes/NSActionCell_Class/Reference/Reference.html#//apple_ref/occ/instm/NSActionCell/setTarget:" target="_top">setTarget:</a></code> (declared by <code>NSActionCell</code>, <code>NSMenuItem</code>, and other classes). However, you typically specify these in Interface Builder. In this application, you connect a control object to another object (the target) in the nib file by Control-dragging from the control object to the target and then selecting the action method of the target to invoke. If you want the action message to be untargeted, you can either set the target to <code>nil</code> programmatically or, in Interface Builder, make a connection between the menu item or control and the First Responder icon in the nib file window, as shown in <span class="content_text">Figure 3-1</span>. </p><br/><div><a name="//apple_ref/doc/uid/10000060i-CH5-SW7" title="Figure 3-1Connecting an untargeted action in Interface Builder"></a><p><strong>Figure 3-1&nbsp;&nbsp;</strong>Connecting an untargeted action in Interface Builder</p><img src = "../Art/connect_1st_responder.jpg" alt = "Connecting an untargeted action in Interface Builder" ></div><br/><p>From Interface Builder you can generate a header file and implementation file for your Xcode project that include a declaration and skeletal implementation, respectively, for each action method defined for a class. These Interface Builder–defined methods have a return “value” of <code>IBAction</code>, which acts as a tag to indicated that the target-action connection is archived in a nib file. You can also add the declarations and skeletal implementations of action methods yourself; in this case, the return type is <code>void</code>.) The remaining required part of the signature is a single parameter typed as <code>id</code> and named (by convention) <code>sender</code>.</p><p><span class="content_text">Listing 3-1</span> illustrates a straightforward implementation of an action method that toggles a clock’s AM-PM indicator when a user clicks a button.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW8" title="Listing 3-1Simple implementation of an action method"></a><p class="codesample"><strong>Listing 3-1&nbsp;&nbsp;</strong>Simple implementation of an action method</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)toggleAmPm:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre>    [self incrementHour:12 andMinute: 0];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Action methods, unlike <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/cl/NSResponder" target="_top">NSResponder</a></code> event methods, don’t have default implementations, so responder subclasses shouldn’t blindly forward action messages to <code>super</code>. The passing of action messages up the responder chain in the Application Kit is predicated merely on whether an object responds to the method, unlike with the passing of event messages. Of course, if you know that a superclass does in fact implement the method, you can pass it on up from your subclass, but otherwise don’t.  </p><p>An important feature of action messages is that you can send messages back to <code>sender</code> to get further information or associated data. For example, the menu items in a given menu might have represented objects assigned to them; for example, a menu item with a title of “Red” might have a represented object that is an <code><a href="../../../Reference/ApplicationKit/Classes/NSColor_Class/Reference/Reference.html#//apple_ref/occ/cl/NSColor" target="_top">NSColor</a></code> object. You can access this object by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSMenuItem_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMenuItem/representedObject" target="_top">representedObject</a></code> to <code>sender</code>.   </p><p>You can take the messaging-back feature of action methods one step further by using it to dynamically change <code>sender</code>’s target, action, title, and similar attributes. Here is a simple test case: You want to control a progress indicator (an <code><a href="../../../Reference/ApplicationKit/Classes/NSProgressIndicator_Class/Reference/Reference.html#//apple_ref/occ/cl/NSProgressIndicator" target="_top">NSProgressIndicator</a></code> object) with a single button; one click of the button starts the indicator and changes the button’s title to “Stop”, and then the next click stops the indicator and changes the title to back to “Start”. <span class="content_text">Listing 3-2</span> shows one way to do this.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW9" title="Listing 3-2Resetting target and action of sender&acirc;&#128;&#148;good implementation"></a><p class="codesample"><strong>Listing 3-2&nbsp;&nbsp;</strong>Resetting target and action of <code>sender</code>—good implementation</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)controlIndicator:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [[sender cell] setTarget:indicator]; // indicator is NSProgressIndicator<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( [[sender title] isEqualToString:@"Start"] ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [[sender cell] setAction:@selector(startAnimation:)];<span></span></pre></td></tr><tr><td scope="row"><pre>        [sender setTitle:@"Stop"];<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        [[sender cell] setAction:@selector(stopAnimation:)];<span></span></pre></td></tr><tr><td scope="row"><pre>        [sender setTitle:@"Start"];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [[sender cell] performClick:self];<span></span></pre></td></tr><tr><td scope="row"><pre>    // set target and action back to what they were<span></span></pre></td></tr><tr><td scope="row"><pre>    [[sender cell] setAction:@selector(controlIndicator:)];<span></span></pre></td></tr><tr><td scope="row"><pre>    [[sender cell] setTarget:self];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>However, this implementation requires that the target and action information be set back to what they were after the redirected action message is sent via <code><a href="../../../Reference/ApplicationKit/Classes/NSCell_Class/Reference/NSCell.html#//apple_ref/occ/instm/NSCell/performClick:" target="_top">performClick:</a></code>. You could simplify this implementation by invoking directly <code><a href="../../../Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/NSApplication/sendAction:to:from:" target="_top">sendAction:to:from:</a></code>, the method used by the application object (<code>NSApp</code>) to dispatch action messages (see <span class="content_text">Listing 3-3</span>). </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW10" title="Listing 3-3Resetting target and action of sender&acirc;&#128;&#148;better implementation"></a><p class="codesample"><strong>Listing 3-3&nbsp;&nbsp;</strong>Resetting target and action of <code>sender</code>—better implementation</p><div class="codesample"><table><tr><td scope="row"><pre>- (IBAction)controlIndicator:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    SEL theSelector;<span></span></pre></td></tr><tr><td scope="row"><pre>    if ( [[sender title] isEqualToString:@"Start"] ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        theSelector = @selector(startAnimation:);<span></span></pre></td></tr><tr><td scope="row"><pre>        [sender setTitle:@"Stop"];<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        theSelector = @selector(stopAnimation:);<span></span></pre></td></tr><tr><td scope="row"><pre>        [sender setTitle:@"Start"];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    [NSApp sendAction:theSelector to:indicator from:sender];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>In keyboard action messages, an action method is invoked as a result of a particular key-press being interpreted through the key bindings mechanism. Because such messages are so closely connected to specific key events, the implementation of the action method can get the event by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/NSApplication/currentEvent" target="_top">currentEvent</a></code> to <code>NSApp</code> and then query the <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/cl/NSEvent" target="_top">NSEvent</a></code> object for details. <span class="content_text"><a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW3">Listing 3-7</a></span> gives an example of this technique. See <span class="content_text"><a href="../EventArchitecture/EventArchitecture.html#//apple_ref/doc/uid/10000060i-CH3-SW10">“The Path of Key Events”</a></span> for a summary of keyboard action messages; also see <span class="content_text"><a href="../TextDefaultsBindings/TextDefaultsBindings.html#//apple_ref/doc/uid/20000468-611005">“Key Bindings”</a></span> for a description of that mechanism.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW15" title="Getting the Location of an Event"></a><h2>Getting the Location of an Event</h2><p>You can get the location of a mouse or tablet-pointer event by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/locationInWindow" target="_top">locationInWindow</a></code> to an <code>NSEvent</code> object. But, as the name of the method denotes, this location (an <code><a href="../../../Reference/Foundation/Miscellaneous/Foundation_DataTypes/Reference/reference.html#//apple_ref/c/tdef/NSPoint" target="_top">NSPoint</a></code> structure) is in the base coordinate system of a window, not in the coordinate system of the view that typically handles the event. Therefore a view must convert the point to its own coordinate system using the method <code><a href="../../../Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/instm/NSView/convertPoint:fromView:" target="_top">convertPoint:fromView:</a></code>, as shown in <span class="content_text">Listing 3-4</span>. </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW5" title="Listing 3-4Converting a mouse-dragged location to be in a view&acirc;&#128;&#153;s coordinate system"></a><p class="codesample"><strong>Listing 3-4&nbsp;&nbsp;</strong>Converting a mouse-dragged location to be in a view’s coordinate system</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)mouseDragged:(NSEvent *)event {<span></span></pre></td></tr><tr><td scope="row"><pre>    NSPoint eventLocation = [event locationInWindow];<span></span></pre></td></tr><tr><td scope="row"><pre>    center = [self convertPoint:eventLocation fromView:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self setNeedsDisplay:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The second parameter of <code>convertPoint:fromView:</code> is <code>nil</code> to indicate that the conversion is from the window’s base coordinate system. </p><p>Keep in mind that the <code>locationInWindow</code> method is not appropriate for key events, periodic events, or any other type of event other than mouse and tablet-pointer events.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW16" title="Testing for Event Type and Modifier Flags"></a><h2>Testing for Event Type and Modifier Flags</h2><p>On occasion you might need to discover the type of an event. However, you do not need to do this within an event-handling method of <code>NSResponder</code> because the type of the event is apparent from the method name: <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/rightMouseDragged:" target="_top">rightMouseDragged:</a></code>, <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/keyDown:" target="_top">keyDown:</a></code>, <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/tabletProximity:" target="_top">tabletProximity:</a></code>, and so on. But from elsewhere in an application you can always obtain the currently handled event by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/NSApplication/currentEvent" target="_top">currentEvent</a></code> to <code>NSApp</code>. To find out what type of event this is, send <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/type" target="_top">type</a></code> to the <code>NSEvent</code> object and then compare the returned value with one of the <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/c/tdef/NSEventType" target="_top">NSEventType</a></code> constants. <span class="content_text">Listing 3-5</span> gives an example of this.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW18" title="Listing 3-5Testing for event type"></a><p class="codesample"><strong>Listing 3-5&nbsp;&nbsp;</strong>Testing for event type</p><div class="codesample"><table><tr><td scope="row"><pre>NSEvent *currentEvent = [NSApp currentEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>NSPoint mousePoint = [controlView convertPoint: [currentEvent locationInWindow] fromView:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>switch ([currentEvent type]) {<span></span></pre></td></tr><tr><td scope="row"><pre>    case NSLeftMouseDown:<span></span></pre></td></tr><tr><td scope="row"><pre>    case NSLeftMouseDragged:<span></span></pre></td></tr><tr><td scope="row"><pre>        [self doSomethingWithEvent:currentEvent];<span></span></pre></td></tr><tr><td scope="row"><pre>        break;<span></span></pre></td></tr><tr><td scope="row"><pre>    default:<span></span></pre></td></tr><tr><td scope="row"><pre>        // If we find anything other than a mouse down or dragged we are done.<span></span></pre></td></tr><tr><td scope="row"><pre>         return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>A common test performed in event-handling methods is finding out whether specific modifier keys were pressed at the same moment as a keypress, mouse click, or similar user action. The modifier key usually imparts special significance to the event. The code example in <span class="content_text">Listing 3-6</span> shows an implementation of <code>mouseDown:</code> that determines whether the Command key was pressed while the mouse was clicked. If it was, it rotates the receiver (a view) 90 degrees. The identification of modifier keys requires the event handler to send <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/occ/instm/NSEvent/modifierFlags" target="_top">modifierFlags</a></code> to the passed-in event object and then perform a bitwise-AND operation on the returned value using one or more of the modifier mask constants declared in <code>NSEvent.h</code>. </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW4" title="Listing 3-6Testing for modifier keys pressed&acirc;&#128;&#148;event method"></a><p class="codesample"><strong>Listing 3-6&nbsp;&nbsp;</strong>Testing for modifier keys pressed—event method</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)mouseDown:(NSEvent *)theEvent {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    //  if Command-click rotate 90 degrees<span></span></pre></td></tr><tr><td scope="row"><pre>    if ([theEvent modifierFlags] &amp; NSCommandKeyMask) {<span></span></pre></td></tr><tr><td scope="row"><pre>        [self setFrameRotation:[self frameRotation]+90.0];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self setNeedsDisplay:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You can test an event object to find out if any from a set of modifier keys was pressed by performing a bitwise-OR with the modifier-mask constants, as in <span class="content_text">Listing 3-7</span>. (Note also that this example shows the use of the <code>currentEvent</code> method in a keyboard action method.) </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW3" title="Listing 3-7Testing for modifier keys pressed&acirc;&#128;&#148;action method"></a><p class="codesample"><strong>Listing 3-7&nbsp;&nbsp;</strong>Testing for modifier keys pressed—action method</p><div class="codesample"><table><tr><td scope="row"><pre>- (void)moveLeft:(id)sender {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Use left arrow to decrement the time.  If a shift key is down, use a big step size.<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL shiftKeyDown = ([[NSApp currentEvent] modifierFlags] &amp;<span></span></pre></td></tr><tr><td scope="row"><pre>        (NSShiftKeyMask | NSAlphaShiftKeyMask)) !=0;<span></span></pre></td></tr><tr><td scope="row"><pre>    [self incrementHour:0 andMinute:-(shiftKeyDown ? 15 : 1)];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Further, you can look for certain modifier-key combinations by linking the individual modifier-key tests together with the logical AND operator (<code>&amp;&amp;</code>). For example, if the example method in <span class="content_text"><a href="EventHandlingBasics.html#//apple_ref/doc/uid/10000060i-CH5-SW4">Listing 3-6</a></span> were to look for Command-Shift-click rather than Command-click, the complete test would be the following:</p><div class="codesample"><table><tr><td scope="row"><pre>    if ( ( [theEvent modifierFlags] &amp; NSCommandKeyMask ) &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>        ( [theEvent modifierFlags] &amp; NSShiftKeyMask ) )<span></span></pre></td></tr></table></div><p>In addition to testing an <code>NSEvent</code> object for individual event types, you can also restrict the events fetched from the event queue to specified types. You can perform this filtering of event types in the <code><a href="../../../Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/NSApplication/nextEventMatchingMask:untilDate:inMode:dequeue:" target="_top">nextEventMatchingMask:untilDate:inMode:dequeue:</a></code> method (<code>NSApplication</code> and <code>NSWindow</code>) or the <code><a href="../../../Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/nextEventMatchingMask:" target="_top">nextEventMatchingMask:</a></code> method of <code>NSWindow</code>. The second parameter of all these methods takes one or more of the event-type mask constants declared in <code>NSEvent.h</code>—for example <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSLeftMouseDraggedMask" target="_top">NSLeftMouseDraggedMask</a></code>, <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSFlagsChangedMask" target="_top">NSFlagsChangedMask</a></code>, and <code><a href="../../../Reference/ApplicationKit/Classes/NSEvent_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSTabletProximityMask" target="_top">NSTabletProximityMask</a></code>. You can either specify these constants individually or perform a bitwise-OR on them.</p><p>Because the <code><a href="../../../Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/occ/instm/NSApplication/nextEventMatchingMask:untilDate:inMode:dequeue:" target="_top">nextEventMatchingMask:untilDate:inMode:dequeue:</a></code>  method is used almost exclusively in closed loops for processing a related series of mouse events, the use of it is described in <span class="content_text"><a href="../HandlingMouseEvents/HandlingMouseEvents.html#//apple_ref/doc/uid/10000060i-CH6-SW1">“Handling Mouse Events.”</a></span> </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW22" title="Responder-Related Tasks"></a><h2>Responder-Related Tasks</h2><p>The following sections describe tasks related to the first-responder status of objects.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW23" title="Determining First-Responder Status"></a><h3>Determining First-Responder Status</h3><p>Usually an <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/cl/NSResponder" target="_top">NSResponder</a></code> object can always determine if it's currently the first responder by asking its window (or itself, if it's an <code><a href="../../../Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/cl/NSWindow" target="_top">NSWindow</a></code> object) for the first responder and then comparing itself to that object. You ask an <code>NSWindow</code> object for the first responder by sending it a <code><a href="../../../Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/firstResponder" target="_top">firstResponder</a></code> message. For an <code><a href="../../../Reference/ApplicationKit/Classes/NSView_Class/Reference/NSView.html#//apple_ref/occ/cl/NSView" target="_top">NSView</a></code> object, this comparison would look like the following bit of code:</p><div class="codesample"><table><tr><td scope="row"><pre>if ([[self window] firstResponder] == self) {<span></span></pre></td></tr><tr><td scope="row"><pre>      // do something based upon first-responder status<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>A complication of this simple scenario occurs with text fields. When a text field has input focus, it is not the first responder. Instead, the field editor for the window is the first responder; if you send <code>firstResponder</code> to the <code>NSWindow</code> object, an <code><a href="../../../Reference/ApplicationKit/Classes/NSTextView_Class/Reference/Reference.html#//apple_ref/occ/cl/NSTextView" target="_top">NSTextView</a></code> object (the field editor) is what is returned.  To determine if a given <code>NSTextField</code> is currently active, retrieve the first responder from the window and find out it is an <code>NSTextView</code> object and if its delegate is equal to the <code>NSTextField</code> object. <span class="content_text">Listing 3-8</span> shows how you might do this.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW17" title="Listing 3-8Determining if a text field is first responder"></a><p class="codesample"><strong>Listing 3-8&nbsp;&nbsp;</strong>Determining if a text field is first responder</p><div class="codesample"><table><tr><td scope="row"><pre>if ( [[[self window] firstResponder] isKindOfClass:[NSTextView class]] &amp;&amp;<span></span></pre></td></tr><tr><td scope="row"><pre>   [window fieldEditor:NO forObject:nil] != nil ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSTextField *field = [[[self window] firstResponder] delegate];<span></span></pre></td></tr><tr><td scope="row"><pre>        if (field == self) {<span></span></pre></td></tr><tr><td scope="row"><pre>            // do something based upon first-responder status<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The control that a field editor is editing is always the current delegate of the field editor, so (as the example shows) you can obtain the text field by asking for the field editor's delegate. For more on the field editor, see "<span class="content_text"><a href="../../UITextView/TextFieldsAndViews.html#//apple_ref/doc/uid/20001799" target="_top">Text Fields, Text Views, and the Field Editor</a></span>." </p><a name="//apple_ref/doc/uid/10000060i-CH5-SW2" title="Setting the First Responder"></a><h3>Setting the First Responder</h3><p>You can programmatically change the first responder by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/makeFirstResponder:" target="_top">makeFirstResponder:</a></code> to an <code>NSWindow</code> object; the argument of this message must be a responder object (that is, an object that inherits from <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/cl/NSResponder" target="_top">NSResponder</a></code>). This message initiates a kind of protocol in which one object loses its first responder status and another gains it.</p><ol class="ol"><li class="li"><p><code>makeFirstResponder:</code> always asks the current first responder if it is ready to resign its status by sending it <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/resignFirstResponder" target="_top">resignFirstResponder</a></code>. </p></li><li class="li"><p> If the current first responder returns <code><a href="../../../Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/doc/c_ref/NO" target="_top">NO</a></code> when sent this message, <code>makeFirstResponder:</code> fails and likewise returns <code><a href="../../../Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/doc/c_ref/NO" target="_top">NO</a></code>.</p><p>A view object or other responder may decline to resign first responder status for many reasons, such as when an action is incomplete.</p></li><li class="li"><p>If the current first responder returns <code><a href="../../../Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/doc/c_ref/YES" target="_top">YES</a></code> to <code>resignFirstResponder</code>, then the new first responder is sent a <code><a href="../../../Reference/ApplicationKit/Classes/NSResponder_Class/Reference/Reference.html#//apple_ref/occ/instm/NSResponder/becomeFirstResponder" target="_top">becomeFirstResponder</a></code> message to inform it that it can be the first responder. </p></li><li class="li"><p>This object can return <code><a href="../../../Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/doc/c_ref/NO" target="_top">NO</a></code> to reject the assignment, in which case the <code>NSWindow</code> itself becomes the first responder.</p></li></ol><p><span class="content_text">Figure 3-2</span> and <span class="content_text">Figure 3-3</span> illustrate two possible outcomes of this protocol.</p><br/><div><a name="//apple_ref/doc/uid/10000060i-CH5-SW12" title="Figure 3-2Making a view a first responder&acirc;&#128;&#148;current view refuses to resign status"></a><p><strong>Figure 3-2&nbsp;&nbsp;</strong>Making a view a first responder—current view refuses to resign status</p><img src = "../Art/become_first_responder1.gif" alt = "Making a view a first responder—current view refuses to resign status" width="523" height="136"></div><br/><br/><div><a name="//apple_ref/doc/uid/10000060i-CH5-SW13" title="Figure 3-3Making a view a first responder&acirc;&#128;&#148;new view becomes first responder"></a><p><strong>Figure 3-3&nbsp;&nbsp;</strong>Making a view a first responder—new view becomes first responder</p><img src = "../Art/become_first_responder2.gif" alt = "Making a view a first responder—new view becomes first responder" width="580" height="191"></div><br/><p><span class="content_text">Listing 3-9</span> shows a custom <code><a href="../../../Reference/ApplicationKit/Classes/NSCell_Class/Reference/NSCell.html#//apple_ref/occ/cl/NSCell" target="_top">NSCell</a></code> class (in this case a subclass of <code><a href="../../../Reference/ApplicationKit/Classes/NSActionCell_Class/Reference/Reference.html#//apple_ref/occ/cl/NSActionCell" target="_top">NSActionCell</a></code>) implementing <code>resignFirstResponder</code> and <code>becomeFirstResponder</code> to manipulate the keyboard focus ring of its superclass.</p><a name="//apple_ref/doc/uid/10000060i-CH5-SW6" title="Listing 3-9Resigning and becoming first responder"></a><p class="codesample"><strong>Listing 3-9&nbsp;&nbsp;</strong>Resigning and becoming first responder</p><div class="codesample"><table><tr><td scope="row"><pre>- (BOOL)becomeFirstResponder {<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL okToChange = [super becomeFirstResponder];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (okToChange) [self setKeyboardFocusRingNeedsDisplayInRect: [self bounds]];<span></span></pre></td></tr><tr><td scope="row"><pre>    return okToChange;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)resignFirstResponder {<span></span></pre></td></tr><tr><td scope="row"><pre>    BOOL okToChange = [super resignFirstResponder];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (okToChange) [self setKeyboardFocusRingNeedsDisplayInRect: [self bounds]];<span></span></pre></td></tr><tr><td scope="row"><pre>    return okToChange;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>You can also set the <em>initial</em> first responder for a window—that is, the first responder set when the window is first placed onscreen. You can set the initial first responder programmatically by sending <code><a href="../../../Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/setInitialFirstResponder:" target="_top">setInitialFirstResponder:</a></code> to an <code>NSWindow</code> object. You can also set it when you create a user interface in Interface Builder. To do this, complete the following steps.  </p><ol class="ol"><li class="li"><p>Control-drag from the window icon in the nib file window to an <code>NSView</code> object in the user interface.</p></li><li class="li"><p>In the Connections pane of the inspector, select the <code>initialFirstResponder</code> outlet and click Connect.</p></li></ol><p>After <code>awakeFromNib</code> is called for all objects in a nib file, <code>NSWindow</code> makes the first responder whatever was set as initial first responder in the nib file.  Note that you should not send <code>setInitialFirstResponder:</code> to an <code>NSWindow</code> object in <code>awakeFromNib</code> and expect the message to be effective. </p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../EventObjectsTypes/EventObjectsTypes.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../HandlingMouseEvents/HandlingMouseEvents.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/EventOverview/EventHandlingBasics/EventHandlingBasics.html%3Fid%3D10000060i-5.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/EventOverview/EventHandlingBasics/EventHandlingBasics.html%3Fid%3D10000060i-5.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/EventOverview/EventHandlingBasics/EventHandlingBasics.html%3Fid%3D10000060i-5.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>