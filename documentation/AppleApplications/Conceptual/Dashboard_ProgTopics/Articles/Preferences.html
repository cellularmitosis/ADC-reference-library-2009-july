<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Dashboard Programming Topics: Widget Backs and Preferences</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Widget Backs and Preferences"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40003043" title="Widget Backs and Preferences"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000418" target="_top">Apple Applications</a> &gt; <a href="../../../Dashboard-date.html#//apple_ref/doc/uid/TP30000440-TP30000418-TP40001366" target="_top">Dashboard</a> &gt; <a href="../index.html" target="_top">Dashboard Programming Topics</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="AppleButton.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="SyncingWidgets.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40003043-SW3" title="Widget Backs and Preferences"></a><hr /><H1>Widget Backs and Preferences</H1><p>Widgets have the ability to display, record, and retrieve preferences. This allows users to customize your widget based on options you provide. Preferences should be displayed on the back of your widget. The section <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW1">“Displaying a Back Side”</a></span> discusses how to set up your widget for sides and how to provide the appropriate buttons and animations. <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW2">“Providing Preferences”</a></span> discusses saving and retrieving preferences.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003043-DontLinkElementID_108" title="Note"></a><p><strong>Note:</strong>&nbsp;Most of the code in this chapter can be found in the <em><a href="../../../../../samplecode/GoodbyeWorld/index.html#//apple_ref/doc/uid/DTS10003695" target="_top">Goodbye World</a></em> sample project. </p><img src = "../Art/goodbye_world.gif" alt = "The Goodbye World Widget" width="230" height="130"></p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW2">Providing Preferences</a>
				
			<br/>
			
        
			
			
				<a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW1">Displaying a Back Side</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40003043-SW2" title="Providing Preferences"></a><h2>Providing Preferences</h2><p>In Dashboard you can have preferences that persist through restarts and logins. You use the following two methods:</p><ul class="ul"><li class="li"><p><code>widget.setPreferenceForKey(preference, key)</code></p></li><li class="li"><p><code>widget.preferenceForKey(key)</code></p></li></ul><p>The first of these allows you to set a preference for an arbitrary key that you provide:</p><div class="codesample"><table><tr><td scope="row"><pre>if(window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    widget.setPreferenceForKey("Goodbye, World!","worldString");<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Passing in <code>null</code> clears its current value. Do this when your widget’s preferences should not persist after it is closed.</p><p>The second method, <code>widget.preferenceForKey(key)</code>, retrieves the preference for the provided key, or returns <code>undefined</code> if no entry exists for the key:</p><div class="codesample"><table><tr><td scope="row"><pre>if(window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var worldString = widget.preferenceForKey("worldString");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (worldString &amp;&amp; worldString.length > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        worldText.innerText = worldString;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here, a preference is retrieved and placed in the widget. Include this code in a function that is called when your widget is opened.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003043-DontLinkElementID_109" title="Note"></a><p><strong>Note:</strong>&nbsp;Even if you don’t want your widget to remember its preferences after it is closed, you need to consider that the user may log out or restart while your widget is open. When the user logs back in, Dashboard automatically opens your widget and the user may expect that your widget be exactly as they left it. Use preferences to save your state for cases such as this and clear them when your widget is consciously closed.</p></div><p>Strings saved and retrieved through this mechanism are stored as clear text and therefore are not secure and not recommended for saving passwords or other sensitive information.</p><a name="//apple_ref/doc/uid/TP40003043-SW1" title="Displaying a Back Side"></a><h2>Displaying a Back Side</h2><p>You may find it prudent to provide an interface for setting preferences or displaying information about your widget. When introducing a back to your widget, you need to design your widget with the back in mind, include an Apple Info Button, and provide for the transition to the preferences and the return to the widget’s main interface. </p><a name="//apple_ref/doc/uid/TP40003043-SW7" title="In Your HTML File"></a><h3>In Your HTML File</h3><p>First, in the HTML body of your widget, you need to have two <code>&lt;div></code> layers in place: one for the front part of your widget and one for the back (which should be hidden via CSS). You also need to include a <code>&lt;div></code> for the <code>AppleInfoButton</code>, placed on the widget's front, and a <code>&lt;div></code> for a Done button, placed on the widget's back. The code sample below provides a skeleton including all of these elements:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;body onload='setup();'><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;div id="front"><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;!-- Your widget’s front side here --><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;div id='infoButton'>&lt;/div><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/div><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;div id="back"><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;!-- Your widget’s back side here --><span></span></pre></td></tr><tr><td scope="row"><pre>        &lt;div id="doneButton">&lt;/div><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;/div><span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/body><span></span></pre></td></tr></table></div><p>Of note is the <code>onload</code> handler, <code>setup()</code>. In the section <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW5">“In Your JavaScript File,”</a></span> <code>setup()</code> creates objects that provide an <code>AppleInfoButton</code>, used to flip your widget to its back, and an <code>AppleGlassButton</code>, used when the user is done setting preferences. In order for the <code>setup()</code> function to work correctly (meaning that the info and glass buttons are properly constructed), you need to include these classes in your widget's HTML:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;script type='text/javascript' src='/System/Library/WidgetResources/AppleClasses/AppleInfoButton.js' charset='utf-8'/><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;script type='text/javascript' src='/System/Library/WidgetResources/AppleClasses/AppleAnimator.js' charset='utf-8'/><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;script type='text/javascript' src='/System/Library/WidgetResources/AppleClasses/AppleButton.js' charset='utf-8'/><span></span></pre></td></tr></table></div><p>The required Apple Classes are present on Mac OS X 10.4.3 and newer. If you are targeting your widget for earlier versions of Mac OS X 10.4, read <span class="content_text"><a href="AppleClasses.html#//apple_ref/doc/uid/TP40003186-SW1">“Introduction to the Apple Classes”</a></span> to learn how to include these classes with backward compatibility in mind.</p><a name="//apple_ref/doc/uid/TP40003043-SW5" title="In Your JavaScript File"></a><h3>In Your JavaScript File</h3><p>The JavaScript portion of your widget needs to include code that flips your widget between its sides and constructs the Info and Done glass buttons.</p><a name="//apple_ref/doc/uid/TP40003043-SW6" title="Constructing the Apple Info and Glass Buttons"></a><h4>Constructing the Apple Info and Glass Buttons</h4><p>The <code>setup()</code> function, declared as the widget's <code>onload</code> handler in its HTML file, is called when the widget's HTML, CSS, and JavaScript files are loaded.  In this function, the constructors for the info and Done button are called:</p><div class="codesample"><table><tr><td scope="row"><pre>var gDoneButton;<span></span></pre></td></tr><tr><td scope="row"><pre>var gInfoButton;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>function setup()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    gDoneButton = new AppleGlassButton(document.getElementById("doneButton"), "Done", hidePrefs);<span></span></pre></td></tr><tr><td scope="row"><pre>    gInfoButton = new AppleInfoButton(document.getElementById("infoButton"), document.getElementById("front"), "white", "white", showPrefs);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Notice that, in addition to the <code>setup()</code> function, two global variables are declared. These variables correspond to the two buttons being created. Usually, you want to keep the buttons stored as global objects so that you can interact with them later.</p><p>Next, the <code>setup()</code> function calls the constructors for an <code>AppleInfoButton</code> and an <code>AppleGlassButton</code>. Recall that your HTML file included the necessary classes to instantiate these buttons; <code>setup()</code> is called after the classes are loaded, and the <code>new</code> call creates new instances of each class. The functions that follow the new call, <code>AppleGlassButton()</code>and <code>AppleInfoButton()</code> are constructors that take in parameters, like the DOM element where the button should be placed or the event handler for a click on that button. The last parameter in both constructors are the handlers that flip the widget over; the handlers are defined in the next section, <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW4">“Flipping Sides.”</a></span> The constructor returns a reference to an object that represents the button. The resulting objects are assigned into the global variables specified earlier. Now that the buttons are created, you can use the previously declared global variables to interact with them at any time. for instance, you could change the color of the <code>AppleInfoButton</code> at any point by calling:</p><div class="codesample"><table><tr><td scope="row"><pre>gInfoButton.setStyle("black","black");<span></span></pre></td></tr></table></div><p>For more on the methods available for <code>AppleGlassButton</code>, read <span class="content_text"><a href="AppleButton.html#//apple_ref/doc/uid/TP40003185-SW4">“The Apple Glass Button Subclass.”</a></span></p><a name="//apple_ref/doc/uid/TP40003043-SW4" title="Flipping Sides"></a><h4>Flipping Sides</h4><p>The following function switches your widget to its back. It is designated as the Apple Info Button's event handler in the button's constructor in the prior section, <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW6">“Constructing the Apple Info and Glass Buttons”</a></span>:</p><div class="codesample"><table><tr><td scope="row"><pre>function showPrefs()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var front = document.getElementById("front");<span></span></pre></td></tr><tr><td scope="row"><pre>    var back = document.getElementById("back");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>        widget.prepareForTransition("ToBack");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    front.style.display="none";<span></span></pre></td></tr><tr><td scope="row"><pre>    back.style.display="block";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>        setTimeout ('widget.performTransition();', 0);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Clicking the Info button (defined as <code>&lt;div id='infoButton'></code> in your HTML and constructed in your JavaScript) calls this function, which causes the back to be displayed. In the function, the front and back layers are obtained and assigned to local variables. Next, <code>widget.prepareForTransition("ToBack")</code> freezes the current interface, meaning that any changes to your widget’s user interface after this point are not shown. The front is then hidden and the back is made active. Finally, the transition is run that flips your widget, with the frozen user interface on the front of the transition and the currently active user interface on the back. </p><p>(As an aside, you may have noticed that <code>setTimeout()</code> is used to call <code>performTransition()</code>. By setting the timeout to <code>0</code>, the transition is performed on the next event loop, allowing for the sides to be swapped before the transition is run. This is an optimization that ensures that both sides of the flip look correct.)</p><p>Hiding the preferences and returning to your main user interface follows a similar procedure; note that this function was assigned to the Done button in its constructor in the previous section, <span class="content_text"><a href="Preferences.html#//apple_ref/doc/uid/TP40003043-SW6">“Constructing the Apple Info and Glass Buttons”</a></span>:</p><div class="codesample"><table><tr><td scope="row"><pre>function hidePrefs()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var front = document.getElementById("front");<span></span></pre></td></tr><tr><td scope="row"><pre>    var back = document.getElementById("back");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>        widget.prepareForTransition("ToFront");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    back.style.display="none";<span></span></pre></td></tr><tr><td scope="row"><pre>    front.style.display="block";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (window.widget)<span></span></pre></td></tr><tr><td scope="row"><pre>        setTimeout ('widget.performTransition();', 0);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This time, however, the back layer is hidden and the front layer is shown. The method <code>widget.prepareForTransition("ToFront"</code>) freezes the current user interface and ensures that the flip transition occurs in the opposite direction as when the preferences were shown.</p><a name="//apple_ref/doc/uid/TP40003043-DontLinkElementID_46" title="In Your CSS File"></a><h3>In Your CSS File</h3><p>Now that you have the front and back parts defined for the widget, as well as the Info button’s parts, you need to use CSS to position them, set their visibility, and set other parameters:</p><div class="codesample"><table><tr><td scope="row"><pre>#infoButton {<span></span></pre></td></tr><tr><td scope="row"><pre>    position:absolute;<span></span></pre></td></tr><tr><td scope="row"><pre>    bottom:12px;<span></span></pre></td></tr><tr><td scope="row"><pre>    right:40px;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#front {<span></span></pre></td></tr><tr><td scope="row"><pre>    display:block;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#back {<span></span></pre></td></tr><tr><td scope="row"><pre>    display:none;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#doneButton {<span></span></pre></td></tr><tr><td scope="row"><pre>    position:absolute;<span></span></pre></td></tr><tr><td scope="row"><pre>    bottom:20px;<span></span></pre></td></tr><tr><td scope="row"><pre>    left:82px;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The first style relates to the Info button. It places the button at the bottom right corner of the widget. </p><p>Also of note here are the <code>front</code> and <code>back</code> styles, since they set the visibility of the widget sides. When a widget is first opened, its front side is the viewable side, so the back needs to be hidden. The styles set the front <code>&lt;div></code> to be visible and hides the back <code>&lt;div></code>. The viewable <code>&lt;div></code> is changed using the JavaScript code in the next section.</p><p>Finally, a style placing the Done button is included.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="AppleButton.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="SyncingWidgets.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/Preferences.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/Preferences.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/Preferences.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
