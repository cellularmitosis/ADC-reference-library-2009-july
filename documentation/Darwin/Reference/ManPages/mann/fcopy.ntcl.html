<html><head><title>Mac OS X
 Manual Page For fcopy(ntcl)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/ntcl/fcopy" title="Mac OS X
 Manual Page for fcopy(ntcl)"><a name="//apple_ref/doc/man/n/fcopy" title="Mac OS X
 Manual Page for fcopy(ntcl)"><!-- headerDoc=man; indexgroup=Section ntcl; uid="//apple_ref/doc/man/ntcl/fcopy"; name=fcopy(ntcl) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
fcopy(n)                                    Tcl Built-In Commands                                   fcopy(n)



____________________________________________________________________________________________________________

<b>NAME</b>
       fcopy - Copy data from one channel to another.

<b>SYNOPSIS</b>
       <b>fcopy</b> <u>inchan</u> <u>outchan</u> ?<b>-size</b> <u>size</u>? ?<b>-command</b> <u>callback</u>?
____________________________________________________________________________________________________________


<b>DESCRIPTION</b>
       The  <b>fcopy</b>  command  copies  data  from one I/O channel, <u>inchan</u> to another I/O channel, <u>outchan</u>.  The
       <b>fcopy</b> command leverages the buffering in the Tcl I/O system  to  avoid  extra  copies  and  to  avoid
       buffering  too  much  data  in main memory when copying large files to slow destinations like network
       sockets.

       The <b>fcopy</b> command transfers data from <u>inchan</u> until end of file or <u>size</u> bytes have  been  transferred.
       If  no  <b>-size</b> argument is given, then the copy goes until end of file.  All the data read from <u>inchan</u>
       is copied to <u>outchan</u>.  Without the <b>-command</b> option, <b>fcopy</b> blocks  until  the  copy  is  complete  and
       returns the number of bytes written to <u>outchan</u>.

       The  <b>-command</b>  argument  makes <b>fcopy</b> work in the background.  In this case it returns immediately and
       the <u>callback</u> is invoked later when the copy completes.  The <u>callback</u> is called with one or two  addi-<font color="#ffffff" class="whiteout">tional&nbsp;additional</font>
       tional  arguments that indicates how many bytes were written to <u>outchan</u>.  If an error occurred during
       the background copy, the second argument is the error string associated with the error.  With a back-<font color="#ffffff" class="whiteout">ground&nbsp;background</font>
       ground  copy,  it is not necessary to put <u>inchan</u> or <u>outchan</u> into non-blocking mode; the <b>fcopy</b> command
       takes care of that automatically.  However, it is necessary to enter the  event  loop  by  using  the
       <b>vwait</b> command or by using Tk.

       You  are not allowed to do other I/O operations with <u>inchan</u> or <u>outchan</u> during a background fcopy.  If
       either <u>inchan</u> or <u>outchan</u> get closed while the copy is in progress, the current copy  is  stopped  and
       the  command  callback is <u>not</u> made.  If <u>inchan</u> is closed, then all data already queued for <u>outchan</u> is
       written out.

       Note that <u>inchan</u> can become readable during a background copy.  You should  turn  off  any  <b>fileevent</b>
       handlers  during  a  background  copy  so  those  handlers  do  not interfere with the copy.  Any I/O
       attempted by a <b>fileevent</b> handler will get a "channel busy" error.

       <b>Fcopy</b> translates end-of-line sequences in <u>inchan</u> and <u>outchan</u> according to the <b>-translation</b> option for
       these  channels.   See  the  manual entry for <b>fconfigure</b> for details on the <b>-translation</b> option.  The
       translations mean that the number of bytes read from <u>inchan</u> can be different than the number of bytes
       written  to  <u>outchan</u>.   Only the number of bytes written to <u>outchan</u> is reported, either as the return
       value of a synchronous <b>fcopy</b> or as the argument to the callback for an asynchronous <b>fcopy</b>.

       <b>Fcopy</b> obeys the encodings configured for the channels. This means that the  incoming  characters  are
       converted  internally  first UTF-8 and then into the encoding of the channel <b>fcopy</b> writes to. See the
       manual entry for <b>fconfigure</b> for details on the <b>-encoding</b> option. No conversion is done if both  chan-<font color="#ffffff" class="whiteout">nels&nbsp;channels</font>
       nels  are set to encoding "binary". If only the output channel is set to encoding "binary" the system
       will write the internal UTF-8 representation of the incoming characters. If only the input channel is
       set  to  encoding  "binary" the system will assume that the incoming bytes are valid UTF-8 characters
       and convert them according to the output encoding. The behaviour of the system for  bytes  which  are
       not valid UTF-8 characters is undefined in this case.


<b>EXAMPLE</b>
       This  first example shows how the callback gets passed the number of bytes transferred.  It also uses
       vwait to put the application into the event loop.  Of course, this simplified example could  be  done
       without the command callback.

              proc Cleanup {in out bytes {error {}}} {
                  global total
                  set total $bytes
                  close $in
                  close $out
                  if {[string length $error] != 0} {
                   # error occurred during the copy
                  }
              }
              set in [open $file1]
              set out [socket $server $port]
              fcopy $in $out -command [list Cleanup $in $out]
              vwait total



       The second example copies in chunks and tests for end of file in the command callback

              proc CopyMore {in out chunk bytes {error {}}} {
                  global total done
                  incr total $bytes
                  if {([string length $error] != 0) || [eof $in] {
                   set done $total
                   close $in
                   close $out
                  } else {
                   fcopy $in $out -command [list CopyMore $in $out $chunk] \
                       -size $chunk
                  }
              }
              set in [open $file1]
              set out [socket $server $port]
              set chunk 1024
              set total 0
              fcopy $in $out -command [list CopyMore $in $out $chunk] -size $chunk
              vwait done




<b>SEE</b> <b>ALSO</b>
       <a href="eof.ntcl.html#//apple_ref/doc/man/n/eof">eof(n)</a>, <a href="fblocked.ntcl.html#//apple_ref/doc/man/n/fblocked">fblocked(n)</a>, <a href="fconfigure.ntcl.html#//apple_ref/doc/man/n/fconfigure">fconfigure(n)</a>


<b>KEYWORDS</b>
       blocking, channel, end of line, end of file, nonblocking, read, translation



Tcl                                                  8.0                                            fcopy(n)
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/mann/fcopy.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/mann/fcopy.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/mann/fcopy.ntcl.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
