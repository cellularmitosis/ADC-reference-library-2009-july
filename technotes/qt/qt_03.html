<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../style.css" TYPE="text/css"><title>Technical Note QT03: Movies `LOOP' Atom and Friends</title><meta name="keywords" content="Mac OS 8 User data atoms quicktime movie looping GetUserData"><meta name="Description" content="Technical Note QT03: This Technical Note discusses entertaininguses for QuickTime user data atoms, Apple defined and otherwise.Technical Note mainly describes how to preserve the windowstate and looping position of a movie using data atoms.">                                       <meta name="categories" content="QuickTime"><meta name="week-posted" content="Oct 26, 1992 - Nov 6, 1992"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002745" title="Movies `LOOP' Atom and Friends"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/QuickTime/idxMovieBasics-date.html" target="_blank">QuickTime > Movie Basics</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QT03</div>
<div id="pageheadsub">Movies `LOOP' Atom and Friends</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">User Data Types</A><BR><BR><A HREF="#Section3">Sample Code</A><BR><BR><A HREF="#Section3">Inside the User Data Atom</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introect">This Technical Note discusses entertaining uses for QuickTime user data atoms, Apple defined and otherwise.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Nov 01 1992]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><H2>Introduction</h2><p>It is often desirable for an application to preserve the window position andlooping state of a movie.  This Technical Note describes the "Apple Sanctified"method of doing this using user data atoms.</p><p>User data atoms allow applications to store custom information which can beeasily accessed using QuickTime Movie Toolbox calls.  These user data atoms aretext or data which can be associated and stored in any movie, track, or media.A reference to the list of user data atoms for each of these locations can beaccessed with the following routines: <code>GetMovieUserData(), GetTrackUserData()</code>,and <code>GetMediaUserData()</code>.  Once a reference to a list of user data atoms isobtained, an application can store, retrieve, and manage items in the listusing the following routines:  <code>GetNextUserDataType(), CountUserDataType(),AddUserData(), GetUserData(), RemoveUserData(), AddUserDataText(),GetUserDataText,</code> and <code>RemoveUserDataText()</code>.  A complete description of theseroutines can be found in Inside Macintosh: QuickTime in the "Working With MovieUser Data" section of chapter 2.</p><a name="Section2"></a><P><A HREF="#top">Back to top</A></p><H2>User Data Types</h2><p>Every user data atom carries a type identifier.  This identifier is stored in along integer, similar to a Resource Manager type.  Apple has reserved alllowercase user data types values.  Applications are free to use types valuescontaining at least one uppercase letter.</p><p>In addition, since there is a differentiation between user data atoms which arehandles to data and handles to text, Apple recommends that all text user dataatoms begin with the (c) character (Option-G).</p><p>The following user data types containing text data are currently defined:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    '(c)cpy'    Copyright statement    '(c)day'    Date the movie content was created    '(c)dir'    Name of the movie's director    '(c)ed1' to '(c)ed9'    Edit dates and descriptions    '(c)fmt'    Indication of the movie format     (computer-generated, digitized, and so on)    '(c)inf'    Information about the movie    '(c)nam'    Name of track or movie    '(c)prd'    Name of the writer movie's producer    '(c)prf'    Name of the performers    '(c)req'    Special hardware or software requirements    '(c)src'    Credits for those who provided the movie source content    '(c)wrt'    Name of the movie's</pre>	</TD></TR></TABLE></CENTER><p><b>Getting 'LOOP'-y</b></p><p>MoviePlayer(TM) has also defined two movie data atoms which are used toindicate looping and window location which applications can implement forcompatibility with MoviePlayer(TM).  They are:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>'LOOP' If this 4 byte user data atom exists in the movie's user data list,then looping is performed according to its value: 0 for normal looping and 1 forpalindrome looping'WLOC' Handle to a point record indicating the last saved window position</pre>	</TD></TR></TABLE></CENTER><p>Another variation on this which originated before MoviePlayer(TM) thatapplications should be aware of, is the following:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    'LOOP'    If this zero length data atom exists in the movie's user data list,</pre>	</TD></TR></TABLE></CENTER><p>In summary, if a <code>'LOOP'</code> atom exists, then looping should be performed.  If thereturned data is a long integer of value 1, then palindrome looping should beperformed.  Normal looping should be performed if data returned is of zerolength or if the returned data is a long integer of value 0.</p><a name="Section3"></a><P><A HREF="#top">Back to top</A></p><H2>Sample Code</h2><p>The following example demonstrates how to get looping information from a movie:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>short loopInfo; //  0=no looping,1=normal looping,2=palindrome looping    Handle       theLoop;    Movie        theMovie;    UserData     theUserData;    loopInfo = 0;    theLoop = NewHandle(0);    theUserData = GetMovieUserData(theMovie);    if (CountUserDataType(theUserData, 'LOOP')) {        loopInfo = 1;        GetUserData(theUserData, theLoop, 'LOOP', 1);        if (GetHandleSize(theLoop))            if ((** (long **) theLoop) == 1)                loopInfo = 2;    }</pre>	</TD></TR></TABLE></CENTER><p>The following example demonstrates how to add a looping atom to a movie toindicate that user has selected looping:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Handle       theLoop;    Movie        theMovie;    UserData     theUserData;    short        theCount;    theLoop = NewHandle(sizeof(long));    (** (long **) theLoop) = 0;    theUserData = GetMovieUserData(theMovie);    theCount = CountUserDataType(theUserData, 'LOOP');    while (theCount--)        RemoveUserData(theUserData, 'LOOP', 1);    AddUserData(theUserData, theLoop, 'LOOP');</pre>	</TD></TR></TABLE></CENTER><p>The following example demonstrates how to remove a looping atom from a movie toindicate that looping is not selected:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>Movie       theMovie;    UserData     theUserData;    short        theCount;    theUserData = GetMovieUserData(theMovie);    theCount = CountUserDataType(theUserData, 'LOOP');    while (theCount--)        RemoveUserData(theUserData, 'LOOP', 1);</pre>	</TD></TR></TABLE></CENTER><a name="Section4"></a><P><A HREF="#top">Back to top</A></p><H2>Inside the User Data Atom</h2><p>Those of you who parse user data atoms directly by accessing the <code>'moov'</code> handlerather than with the appropriate movie toolbox calls, will notice a trailinglong integer of value 0 after all user data atoms in the list.  This isrequired for backward compatibility with QuickTime 1.0 which has a bug thatrequires the trailer.  The size of the <code>'udta'</code> atom does reflect this extratrailing long integer.  QuickTime 1.0 and future versions will automaticallyhandle this when manipulating user data atoms with the movie toolbox calls.</p><a name="References"></a><P><A HREF="#top">Back to top</A></p><H2>References</h2><P><i>Inside Macintosh: QuickTime,</i> Movie Toolbox Reference</p>         <a name="Downloads"></a>       <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qt_03.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qt/qt_03.html%3Fid%3DDTS10002745-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qt/qt_03.html%3Fid%3DDTS10002745-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qt/qt_03.html%3Fid%3DDTS10002745-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>