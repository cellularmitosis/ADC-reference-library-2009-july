<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shark User Guide: Custom Configurations</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Custom Configurations"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005233-CH8" title="Custom Configurations"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000436" target="_top">Tools</a> &gt; <a href="../../../Performance-date.html#//apple_ref/doc/uid/TP30000440-TP30000436-TP30000901" target="_top">Performance</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_6">Shark User Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005233-CH8-SW1" title="Custom Configurations"></a><h1>Custom Configurations</h1><p>Up until now, you have been using the configuration menu in Shark’s main window (in <span class="content_text">Figure 7-1</span>) to select from various built-in sampling methods. Each of these sampling methods is called a <em>configuration</em> (abbreviated as “configs"), and Shark saves each configuration as a separate configuration file (which is also often called a “config”). Each config file describes a variety of settings for Shark which enable it to sample or profile your application in a particular way, plus a summary of any hardware requirements that are necessary to use it.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW2" title="Figure 7-1Main Configuration Menu"></a><p><strong>Figure 7-1&nbsp;&nbsp;</strong>Main Configuration Menu</p><img src = "../Art/MainConfigMenu.jpg" alt = "Main Configuration Menu" ></div><br/><p>Once you have gained some experience with Shark, you might want to change some of the settings or adjust some of the types of data Shark collects when a particular config is active. For example, you might adjust the default sample rate of the Time Profiling config to sample more often, if your examinations routinely need higher sampling resolution. This chapter gives an overview as to how this can be accomplished using Shark’s sophisticated <em>Configuration Editor</em>.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW13">The Config Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW12">Simple Timed Samples and Counters Config Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW21">Malloc Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW22">Static Analysis Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW23">Java Trace Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW24">Sampler Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW19">System Trace Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW25">All Thread States Data Source PlugIn Editor</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW26">Analysis and Viewer PlugIn Summary</a>
				
			<br/>
			
        
			
			
				<a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW18">Counter Spreadsheet Analysis PlugIn Editor</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005233-CH8-SW13" title="The Config Editor"></a><h2>The Config Editor</h2><p>The <em>Configuration Editor</em> lets you individually modify settings for any of Shark’s modules, which are called <em>PlugIns</em>. The properties available in each PlugIn differ depending on the nature of the work that particular PlugIn is designed to do. Shark uses three types of PlugIns: </p><ul class="ul"><li class="li"><p><strong>Data Source</strong> – These are responsible for collecting and/or generating session data. Many user-modifiable parameters are typically available to control the sampling or profiling performed by these modules.</p></li><li class="li"><p><strong>Analysis</strong> – These process raw data and produce intermediate results that are typically shared by more than one viewer. Only a few settings are available for these modules.</p></li><li class="li"><p><strong>Viewer</strong> – These display analysis results and performance data. Because users typically want immediate feedback to viewer adjustments, options for these are set by interacting directly with the visible display or through the <em>Advanced Settings Drawer</em> (see <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW9">“Advanced Settings Drawer”</a></span>) attached to each analysis window, instead of here in the Configuration Editor.</p></li></ul><p>Once you have decided that the built-in configs are not sufficient for the work that you are doing, the first step to creating or editing your own configurations is to start the <em>Configuration Editor</em> using one of two techniques:</p><ul class="ul"><li class="li"><p>Select the <em>Config→New...</em> (<em>Command-N</em>) command to start a new config from scratch.</p></li><li class="li"><p>Select <em>Config→Edit...</em> (<em>Command-Option-Shift-C</em>) to modify the current config.</p></li></ul><p>Either technique will bring up the <em>Configuration Editor</em> dialog box, which allows you to examine and modify any part of a configuration. <span class="content_text">“Adding Shortcut Equations”</span> points out the four main major parts of this editor:</p><ol class="ol"><li class="li"><p><strong>The Config Listing</strong> — This contains an entry for every configuration Shark knows about. This includes documents stored in <code>/System/Library/Application Support/Shark/Configs</code> folder, and any custom config documents stored in <code>$USER/Library/Application Support/Shark/Configs</code> in your home folder. Some config file names may be dimmed in the list. This means they are not compatible with the system Shark is currently running on, and therefore cannot be enabled for sampling or profiling, but you can still select and modify them here in the Configuration Editor. The rest of the Configuration Editor controls always modify the selected entry in this list.</p><p>Next to the main listing, various controls support basic file operations to manage these config files: </p><ul class="ul"><li class="li"><p>You can <em>Duplicate</em> any config in the list. This is usually the best way to begin making a custom config. In fact, selecting “New...“ from the Config Menu just makes a duplicate of the current config in order to provide a starting baseline.</p></li><li class="li"><p>You can <em>Delete</em> any custom config in the list, but not built-in config files. A verification message will appear when you click the Delete button. A deleted config will be erased from the appropriate Configs folder when you finally press the OK button.</p></li><li class="li"><p>You can <em>Rename</em> any custom config in the list, but not built-in config files. A renamed config will be changed in the appropriate Configs folder immediately.</p></li><li class="li"><p>You can <em>Import</em> any config that you may have saved on your system or a mounted fileserver. Imported configs are copied to your home <code>$USER/Library/Application Support/Shark/Configs</code> folder. You can also perform this function without invoking the Configuration Editor by using the <em>Config→Import...</em> menu command.</p></li><li class="li"><p>You can <em>Export</em> any listed config to an arbitrary file on your system or a fileserver. This is a great way to share configs between computers or user accounts. You can also perform this function without invoking the Configuration Editor by using the <em>Config→Export...</em> menu command.</p></li></ul></li><li class="li"><p><strong>The Summary</strong> — Explains the details of the selected config and all the PlugIn settings that will be used to collect data.</p></li><li class="li"><p><strong>The PlugIn List</strong> — Each PlugIn type in the configuration may optionally provide an editor for its properties in the configuration. You can select the PlugIn to edit by clicking on the desired PlugIn name here.  You can also enable or disable PlugIns using the checkboxes.</p><p>The order of the plugins has a different meaning depending upon on the type of plugin. For data source plugins, the vertical order of the enabled plugins indicates the order in which data sources will be started and stopped. Analysis plugin order indicates the order of their creation, and viewer plugin order determines the order of viewer tabs in the resulting Shark session window. The position of a plugin can be changed using the <em>Up</em> and <em>Down</em> arrow buttons to the lower left of the <em>PlugIn List</em>.</p></li><li class="li"><p><strong>The PlugIn Property Editor</strong> — This displays user-tunable options, if any, for the PlugIn currently selected in the <em>PlugIn List</em>. Some PlugIns have no or only a few controls, while other PlugIns (such as the “Timed Samples &amp; Counters” Data Source plugin) have many properties, and require multiple tabbed window panes to organize all the various settings available.</p></li><li class="li"><p><strong>The Property View Pop-up</strong>: Each plugin’s property editor can optionally support two modes of operation: <em>Simple</em> (the default) and <em>Advanced</em>. This menu allows you to select between them, if they are both present. In addition, this control modifies the <em>PlugIn List</em> as follows:</p><ul class="ul"><li class="li"><p>In <em>Simple</em> mode, only plugins enabled by the currently selected config that have property editors are listed.</p></li><li class="li"><p>In <em>Advanced</em> mode, all of the available plugins are listed with a checkbox next to each indicating whether or not it is enabled in the current config.</p></li></ul></li></ol><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW20" title="Figure 7-2Config Editor"></a><p><strong>Figure 7-2&nbsp;&nbsp;</strong>Config Editor</p><img src = "../Art/ConfigEditor.jpg" alt = "Config Editor" ></div><br/><p>The remainder of this chapter describes Shark’s wide variety of PlugIn editors that are controllable through the <em>Configuration Editor</em>. In addition, because it is very complex, the “Advanced” mode of the “Timed Samples and Counters” config editor is described in <span class="content_text"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html#//apple_ref/doc/uid/TP40005233-CH10-SW1">“Hardware Counter Configuration.”</a></span></p><a name="//apple_ref/doc/uid/TP40005233-CH8-SW12" title="Simple Timed Samples and Counters Config Editor"></a><h2>Simple Timed Samples and Counters Config Editor</h2><p>The Timed Samples and Counters data source is used for collecting system-wide time and performance count profiles. This is used for several default configurations, including the Time Profiling one described in <span class="content_text"><a href="../TimeProfiling/TimeProfiling.html#//apple_ref/doc/uid/TP40005233-CH3-SW1">“Time Profiling.”</a></span> In <em>Simple</em> mode, there are two types of settings that can be modified in the editor:</p><ul class="ul"><li class="li"><p><strong>Sampling Tab</strong> – The controls on this tab (see <span class="content_text">Figure 7-3</span>) determine when to start and stop recording samples.</p><ol class="ol"><li class="li"><p><strong>Windowed Time Facility</strong>— If enabled, Shark will collect samples until you explicitly stop it. However, it will only store the last N samples, where N is the number entered into the sample history field (10,000 by default). This mode is also described in <span class="content_text"><a href="../SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW1">“Windowed Time Facility (WTF).”</a></span></p></li><li class="li"><p><strong>Start Delay</strong>— Amount of time to wait after the user selects “Start” before data collection actually begins. This helps prevent Shark from sampling itself.</p></li><li class="li"><p><strong>Time Limit</strong>— The maximum amount of time to record samples. This is ignored if WTF mode is enabled.</p></li><li class="li"><p><strong>Sample Interval</strong>— Determines the sampling rate. The interval can be a time period (1 ms default), CPU performance event count, or OS performance event count . If no performance counters (CPU or OS) are configured as triggers, the sample interval is assumed to be a  time interval, and hence only the time entry field is enabled.</p></li></ol><div class="item_figure"><a name="//apple_ref/doc/uid/TP40005233-CH8-SW3" title="Figure 7-3Simple Timed Samples and Counters Data Source - Sampling Tab"></a><p><strong>Figure 7-3&nbsp;&nbsp;</strong>Simple Timed Samples and Counters Data Source - Sampling Tab</p><img src = "../Art/SimpleSamplingTab.jpg" alt = "CHUD Data Source - Simple Sampling Settings" ></div></li><li class="li"><p><strong>Counters Tab</strong>— This tab (see <span class="content_text">Figure 7-4</span>) presents a fast and simple way to search and configure the <em>Processor</em> (CPU), <em>Operating System</em> (OS), and <em>Northbridge</em> (MEM) performance counters. Enter an event keyword or partial description in the search field to see a list of matching counter events. Use the <em>Mode</em> column to select the performance counter mode (<strong>None</strong>, <strong>Counter</strong>, or <strong>Trigger</strong>). Only a small subset of possible counter options are available here. For more, you will have to use the Advanced settings, described in <span class="content_text"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html#//apple_ref/doc/uid/TP40005233-CH10-SW1">“Hardware Counter Configuration.”</a></span></p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40005233-CH8-SW4" title="Figure 7-4Simple Timed Samples and Counters Data Source - Counter Settings"></a><p><strong>Figure 7-4&nbsp;&nbsp;</strong>Simple Timed Samples and Counters Data Source - Counter Settings</p><img src = "../Art/SimplePMCTab.jpg" alt = "CHUD Data Source - Simple Counter Settings" ></div></li></ul><a name="//apple_ref/doc/uid/TP40005233-CH8-SW21" title="Malloc Data Source PlugIn Editor"></a><h2>Malloc Data Source PlugIn Editor</h2><p>The Malloc data source is used for the Malloc Trace config described in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW16">“Malloc Trace.”</a></span> It is used for collecting a memory allocation profile from a particular executable. All of its configurable controls are contained in a single tab (see <span class="content_text">Figure 7-5</span>), which modifies the timing of starting and stopping of memory allocation recording behavior:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW5" title="Figure 7-5Malloc Data Source - Sampling Settings"></a><p><strong>Figure 7-5&nbsp;&nbsp;</strong>Malloc Data Source - Sampling Settings</p><img src = "../Art/MallocTracingPlugIn.jpg" alt = "Malloc Data Source - Sampling Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Record Only Active Blocks</strong>— If enabled, Shark will collect samples only in memory regions that were allocated during a profile and not released. Otherwise, any allocation or deallocation that takes place is recorded.</p></li><li class="li"><p><strong>Time Limit</strong>— The maximum amount of time to record samples.</p></li><li class="li"><p><strong>Start Delay</strong>— Amount of time to wait after the user selects “Start” before data collection actually begins.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW22" title="Static Analysis Data Source PlugIn Editor"></a><h2>Static Analysis Data Source PlugIn Editor</h2><p>The Static Analysis data source is used by the Static Analysis default configuration, described in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW19">“Static Analysis.”</a></span> It is used to search for potential performance issues by looking for problems that might crop up through some other (as yet untested) code path. All of its configurable controls are contained in a single tab (see <span class="content_text">Figure 7-6</span>), which modifies the type and severity of potential problems that can be identified using the mechanism:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW6" title="Figure 7-6Static Analysis Data Source -  Settings"></a><p><strong>Figure 7-6&nbsp;&nbsp;</strong>Static Analysis Data Source -  Settings</p><img src = "../Art/StaticAnalysisPlugIn.jpg" alt = "Static Analysis Data Source -  Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Target Selection</strong>— These options allow you to narrow down the area of memory examined by Shark.</p><ul class="ul"><li class="li"><p><em>Application</em>— Looks for potential performance issues in the main text segment of the target process</p></li><li class="li"><p><em>Frameworks</em>— Looks for potential performance issues in the frameworks that are dynamically loaded by the target 
process.</p></li><li class="li"><p><em>Dyld Stubs</em>— Looks for any potential performance or behavior anomalies in the glue code inserted into the binary by the link phase of application building.</p></li></ul></li><li class="li"><p><strong>Analysis Options</strong>— These allow you to enable or disable analysis.</p><ul class="ul"><li class="li"><p><em>Browse Functions</em>— Gives each function in the text image of a process a reference count of one. This allows you to browse all of the functions of a given process with Shark’s code browser. No analysis (or problem weighting) is performed.</p></li><li class="li"><p><em>Look For Problems </em>— search all functions in the text image of a process for problems of at least the level of severity specified by the Problem Severity slider. Any address with a problem instruction or code is given a reference count equivalent to its severity.</p></li></ul></li><li class="li"><p><strong>Problem Severity Slider</strong>— This slider acts as a filter, adjusting the minimum “importance” of problems to report using a predefined problem weighting built into Shark. The further to the right the slider, the less output is generated, as more and more potential problems are ignored because their “importance” is not high enough.</p></li><li class="li"><p><strong>Processor Settings</strong>— Shark needs to know which model of processor is your target before it can examine code and find potential problems. Separate menus are provided for PowerPC and Intel processors because it can analyze for one model of each processor family simultaneously.</p><ul class="ul"><li class="li"><p><em>PowerPC Model</em>— Selects the PowerPC model to use when searching for and assigning problem severities .</p></li><li class="li"><p><em>Intel Model</em>— Selects the Intel model to use when searching for and assigning problem severities .</p></li></ul></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW23" title="Java Trace Data Source PlugIn Editor"></a><h2>Java Trace Data Source PlugIn Editor</h2><p>The Java Trace data source supports three types of Java tracing: <em>Time</em>, <em>Alloc</em>, and <em>Method</em>. All of these have default configurations described in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW22">“Java Tracing Techniques.”</a></span> These types of tracing only work on a single Java process at a time, as there is no systemwide Java tracing. The controls on the tab (see <span class="content_text">Figure 7-7</span>) determine what type of Java Tracing to perform, and the time between samples for a Java Time Trace. </p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW7" title="Figure 7-7Java Trace Data Source - Sampling Settings"></a><p><strong>Figure 7-7&nbsp;&nbsp;</strong>Java Trace Data Source - Sampling Settings</p><img src = "../Art/JavaTracePlugin.jpg" alt = "Java Trace Data Source - Sampling Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Trace Type PopUp Menu</strong>— Chooses one of the four types of Java tracing available:</p><ul class="ul"><li class="li"><p><em>Timed Samples</em>— Selects the Java <em>Time Trace</em> mode. This is similar to a regular Time Profile. It periodically stops the Java process and takes samples of the running threads.</p></li><li class="li"><p><em>Memory Allocations</em>— Selects the Java <em>Alloc Trace</em> mode. Memory allocations and the sizes of the objects allocated are recorded.</p></li><li class="li"><p><em>Method Trace</em>— This type of Java tracing is still under development, and should not be used yet.</p></li><li class="li"><p><em>Call Trace</em>— Selects the Java <em>Call Trace</em> mode. This records each entry into every method during the execution of your program. Hence, this is an exact trace of the methods called (within the limitations of the Java VM).</p></li></ul></li><li class="li"><p><strong>Interval field</strong>— Enter the time between samples here, for the <em>Timed Samples</em> mode.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW24" title="Sampler Data Source PlugIn Editor"></a><h2>Sampler Data Source PlugIn Editor</h2><p>The Sampler data source provides the same functionality as the separate <em>Sampler</em> application and command-line tool. It is not used for any of the default configurations provided with Shark, as most of its functionality has been superseded by features of the much more sophisticated “Timed Samples and Counters” PlugIn. All configurable features can be modified on a single tab (see <span class="content_text">Figure 7-8</span>), which adjusts basic timing parameters:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW8" title="Figure 7-8Sampler Data Source - Settings"></a><p><strong>Figure 7-8&nbsp;&nbsp;</strong>Sampler Data Source - Settings</p><img src = "../Art/SamplerPlugin.jpg" alt = "Sampler Data Source - Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Sample Interval</strong>— Determines the sampling rate. The interval is a time period (10 ms default).</p></li><li class="li"><p><strong>Start Delay</strong>— Amount of time to wait after the user selects “Start” before data collection actually begins.</p></li><li class="li"><p><strong>Time Limit</strong>— The maximum amount of time to record samples.</p></li><li class="li"><p><strong>Sample Limit </strong>— The maximum number of samples to record. Specifying a maximum of <em>N</em> samples will result in at most <em>N</em> samples being taken, even on a multi-processor system, so this should be scaled up as larger systems are sampled.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW19" title="System Trace Data Source PlugIn Editor"></a><h2>System Trace Data Source PlugIn Editor</h2><p>This data source collects data for the <em>System Trace</em> default configuration, described in <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW12">“System Tracing.”</a></span> All configurable features can be modified on a single tab (see <span class="content_text">Figure 7-9</span>), which adjusts basic timing parameters:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW9" title="Figure 7-9System Trace Data Source - Settings"></a><p><strong>Figure 7-9&nbsp;&nbsp;</strong>System Trace Data Source - Settings</p><img src = "../Art/SystemTracePlugIn.jpg" alt = "Kernel Debug Data Source - Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Sample Limit </strong>— The maximum number of samples to record. Specifying a maximum of <em>N</em> samples will result in at most <em>N</em> samples being taken, even on a multi-processor system, so this should be scaled up as larger systems are sampled.  On the other hand, you may need to reduce the sample limit if Shark runs out of memory when you attempt to start a system trace, because it must be able to allocate a buffer in RAM large enough to hold this number of samples. When the sample limit is reached, data collection automatically stops, unless the <em>Windowed Time Facility</em> is enabled (see below). The Sample Limit is always enforced, and cannot be disabled.</p></li><li class="li"><p><strong>Time Limit</strong>— The maximum amount of time to record samples. This is ignored if <em>Windowed Time Facility</em> is enabled, or if Sample Limit is reached before the time limit expires.</p></li><li class="li"><p><strong>Start Delay</strong>— Amount of time to wait after the user selects “Start” before data collection actually begins.</p></li><li class="li"><p><strong>Record Callstacks</strong>— When enabled, Shark will collect the function backtrace along with the program counter value for each sample. This should normally be enabled, but can be disabled if you need to record longer traces with a limited amount of memory or if the performance impact of recording the callstacks is too high.</p></li><li class="li"><p><strong>Windowed Time Facility</strong>— If enabled, Shark will collect samples until you explicitly stop it. However, it will only store the last N samples, where N is the number entered into the Sample Limit field. This mode is also described in <span class="content_text"><a href="../SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW1">“Windowed Time Facility (WTF).”</a></span></p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW25" title="All Thread States Data Source PlugIn Editor"></a><h2>All Thread States Data Source PlugIn Editor</h2><p>This data source collects data for the <em>Time Profile (All Thread States)</em> default configuration, described in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW18">“Time Profile (All Thread States),”</a></span> which samples the callstacks of all threads on the system simultaneously, whether they are running or blocked. All configurable features can be modified on a single tab (see <span class="content_text">Figure 7-10</span>), which adjusts basic timing parameters:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW10" title="Figure 7-10All Thread States Data Source - Settings"></a><p><strong>Figure 7-10&nbsp;&nbsp;</strong>All Thread States Data Source - Settings</p><img src = "../Art/StackSnapShotPlugIn.jpg" alt = "Stack Snapshot Data Source - Settings" ></div><br/><ol class="ol"><li class="li"><p><strong>Sample Interval</strong>— Determine the trigger for taking a sample. The interval is a time period (10 ms default).</p></li><li class="li"><p><strong>Start Delay</strong>— Amount of time to wait after the user selects “Start” before data collection actually begins.</p></li><li class="li"><p><strong>Time Limit</strong>— The maximum amount of time to record samples. This is ignored if Sample Limit is enabled and reached before the time limit expires.</p></li><li class="li"><p><strong>Sample Limit </strong>— The maximum number of samples to record. Specifying a maximum of <em>N</em> samples will result in at most <em>N</em> samples being taken, even on a multi-processor system, so this should be scaled up as larger systems are sampled. When the sample limit is reached, data collection automatically stops. This is ignored if the <em>Time Limit </em> is enabled and expires first.</p></li><li class="li"><p><strong>Prefer User Callstacks</strong>— When enabled, Shark will ignore and discard any samples from threads running exclusively in the kernel. This can eliminate spurious samples from places such as idle threads and interrupt handlers, if your program is not affected by these.</p></li><li class="li"><p><strong>Trim Supervisor Callstacks</strong>— When enabled, Shark will automatically trim the recorded callstacks for threads calling into the kernel down to the kernel entry points, and discarding the parts of the stack from within the kernel itself. These shortened stacks are usually sufficient, since most performance problems in your programs can be debugged without knowing about how the kernel is running internally. You just need to know how and when your code is blocking, and not how Mac OS X is actually processing the blocking operation itself.</p></li></ol><a name="//apple_ref/doc/uid/TP40005233-CH8-SW26" title="Analysis and Viewer PlugIn Summary"></a><h2>Analysis and Viewer PlugIn Summary</h2><p>All Data Source PlugIns include configuration editors. However, most of the analysis and viewer editors do not. While you generally will not need to spend much time worrying about these plugins during the configuration process, you will still need to enable or disable the correct PlugIns in your configuration in order to be able to see your results in the way you expect. The lists in this section give you an overview of when to enable or disable various PlugIns.</p><p>There are only a few analysis PlugIns. They just need to be matched to the data source and viewer PlugIns used before and after them, since they connect these PlugIns together:</p><ul class="ul"><li class="li"><p><strong>Standard Profile and Counters</strong>— This should be enabled for all configurations except ones that use “System Trace” or “Timed Samples and Counters” configurations that only use the “Counter Spreadsheet” viewer.</p></li><li class="li"><p><strong>Counter Spreadsheet</strong>— This can only be used with the “Timed Samples and Counters” data source and the matching “Counter Spreadsheet” viewer. Unlike the rest of the analysis and viewer PlugIns, it actually has an editor for configuring a preset list of “shortcut equations.” See <span class="content_text"><a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW18">“Counter Spreadsheet Analysis PlugIn Editor,”</a></span> below, for details.</p></li><li class="li"><p><strong>System Trace</strong>— This can only be used with the “System Trace” data source and any of the four “System Trace” viewers.</p></li></ul><p>There are several viewer PlugIns. When these are enabled, the matching tabs will appear across the top of any session windows made with these configurations, in the order that the configurations are listed in the <em>Configuration Editor</em>. Like the analysis PlugIns, you can only enable these usefully when other PlugIns are also enabled, as we note below.</p><ul class="ul"><li class="li"><p><strong>Standard Profile Browser</strong>— This is the standard tabular browser view of symbols and sample counts used by most configurations, as is described in <span class="content_text"><a href="../TimeProfiling/TimeProfiling.html#//apple_ref/doc/uid/TP40005233-CH3-SW19">“Profile Browser.”</a></span> To use it, you need to enable the “Standard Profile and Counters” analysis PlugIn.</p></li><li class="li"><p><strong>Callstack &amp; Counters Chart</strong>— This is the the <em>Chart View</em> used by many configurations to graphically display the callstacks of samples over time, as is described in <span class="content_text"><a href="../TimeProfiling/TimeProfiling.html#//apple_ref/doc/uid/TP40005233-CH3-SW21">“Chart View .”</a></span> To use it, you need to enable the “Standard Profile and Counters” analysis PlugIn.</p></li><li class="li"><p><strong>Counter Spreadsheet</strong>— This presents the counter spreadsheet view described in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW7">“Timed Counters: The Performance Counter Spreadsheet.”</a></span> To use it, you must have the “Timed Samples and Counters” data source enabled and the “Counter Spreadsheet” analysis PlugIn enabled.</p></li><li class="li"><p><strong>System Trace: Summary</strong>— This can only be used with the “System Trace” data source and analysis PlugIns. It displays the Summary tab used by System Trace and described in <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW31">“Summary View In-depth.”</a></span></p></li><li class="li"><p><strong>System Trace: Trace</strong>— This can only be used with the “System Trace” data source and analysis PlugIns. It displays the Trace tab used by System Trace and described in <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW11">“Trace View In-depth.”</a></span></p></li><li class="li"><p><strong>System Trace: Timeline</strong>— This can only be used with the “System Trace” data source and analysis PlugIns. It displays the Timeline tab used by System Trace and described in <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW4">“Timeline View In-depth.”</a></span></p></li><li class="li"><p><strong>System Trace: Raw</strong>— This can only be used with the “System Trace” data source and analysis PlugIns. It displays raw and unprocessed samples recorded by System Trace, and is normally not used by end users.</p></li></ul><a name="//apple_ref/doc/uid/TP40005233-CH8-SW18" title="Counter Spreadsheet Analysis PlugIn Editor"></a><h2>Counter Spreadsheet Analysis PlugIn Editor</h2><p>When PMCs are active during sampling, this analysis plugin can be enabled. The controls on this editor allow you to create new results equations called <em>shortcuts</em>. The shortcuts will show up in the counter spreadsheet as extra columns of data that you can plot in the counter spreadsheet’s chart view. With these shortcuts, you can effectively create new types of results data that use the event counts from the sampling to derive new information about the way the event counts may relate to each other, without forcing you to first export the data into another application, such as a spreadsheet. These derivative results can then be viewed just as if they were any other bit of “raw” counter data sampled by Shark.</p><a name="//apple_ref/doc/uid/TP40005233-CH8-SW14" title="Using the Editor"></a><h3>Using the Editor</h3><p>When using the editor, you will first be presented with the view shown in <span class="content_text">Figure 7-11</span>:</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW11" title="Figure 7-11Counter Spreadsheet Analysis"></a><p><strong>Figure 7-11&nbsp;&nbsp;</strong>Counter Spreadsheet Analysis</p><img src = "../Art/CounterSpreadsheetAdvanced.jpg" alt = "../Art/CounterSpreadsheetAdvanced.png" ></div><br/><p>This view contains the following constituent parts:</p><ol class="ol"><li class="li"><p><strong>PMC Sumary Table</strong> – This table summarizes all the performance counters (PMCs) that are currently selected and enabled in the Timed Samples and Counters data source.</p><ul class="ul"><li class="li"><p><em>PMC column</em>— This is a short description of the counter and the device in which this performance monitor counter is found.</p></li><li class="li"><p><em>Mode column</em>— The counter’s current mode. This is typically <em>counter</em>, because <em>unused</em> and <em>trigger</em> PMCs are filtered out and not listed in this table.</p></li><li class="li"><p><em>Symbol column</em>— This display’s the counter’s <em>term</em>. This is the algebraic symbol that represents the counter in the shortcut equations .</p></li><li class="li"><p><em>PMC Description column</em>— The name of the event type currently being counted by the selected PMC, which is also used as the header for the results column for this PMC in the Counter Spreadsheet.</p></li></ul></li><li class="li"><p><strong>Shortcut Equation Table</strong> – This table will list any equations that you have defined to generate extra results in the counter spreadsheet viewer. You can edit the names of the shortcut equations in the left column, and their formulas in the right.</p></li><li class="li"><p><strong>Add Button</strong> – Creates a new shortcut equation.</p></li><li class="li"><p><strong>Delete Button</strong>– Erases the existing shortcut equation that you are currently editing.</p></li></ol><p>If you decide that you would like to combine the existing counter results into a new, derivative result, then simply click the <em>Add</em> button. A new line will be added to the <em>Shortcut Equation Table</em>, where you can type a name in the left column and the equation itself in the right. The name can be whatever you like, but the equation must follow a proscribed format consisting of input terms (using the notation in the table below) combined together using basic four-function math symbols (+ for addition, - for subtraction, * for multiplication, and / for division) and using parenthesis to order the operations, if necessary. You may also include numeric constants at any point in an equation. These are most often used when you need to convert between different types of units.</p><p>Once created, each shortcut equation is applied to each row of results (i.e. on a per-sample basis). Shark adds a new column titled with the shortcut name to its “spreadsheet” of counter results in order to hold the newly calculated values.</p><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Shortcut Equation Terms</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description </p></th></tr><tr><td  scope="row"><p><strong>pXcY</strong></p></td><td ><p> Represents <strong>p</strong>rocessor-<em>X</em>, <strong>c</strong>ounter-<em>Y</em>. For example: <code>p2c1</code> is the term that represents counter #1 on processor #2.</p><p> <em>X</em> = CPU number, numbered 1, 2, 3, ...</p><p> <em>Y</em> = PMC number, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>pNcY</strong></p></td><td ><p> Represents a summation of results from all processors on <strong>c</strong>ounter-<em>Y</em>. For example: <code>pNc1</code> is the term that represents event count samples for every active processor’s counter #1, all added together. You could get the same effect with an equation of your own like <code>(p1c1+p2c1+p3c1+p4c1)</code>, but this would only work correctly on a four processor system. On a two processor system, it would fail, since processors 3 and 4 do not exist, while on an eight processor system it would get incorrect results because it would miss results from processors 5–8.</p><p><em>Y</em> = PMC number, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>mXcY</strong></p></td><td ><p> Represents <strong>m</strong>emory Controller-<em>X</em>, <strong>c</strong>ounter-<em>Y</em>. For example: <code>m1c1</code> is the term that represents counter #1 on memory controller #1.</p><p><em>X</em> = Memory controller number, numbered 1, 2, 3, ... (At present, there are no Macs with more than one memory controller.)</p><p><em>Y</em> = PMC number, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>oXcY</strong></p></td><td ><p> Represents <strong>o</strong>perating System-<em>X</em>, <strong>c</strong>ounter-Y. For example: <code>o1c1</code> is the term that represents counter #1 in operating system image #1.</p><p> <em>X</em> = OS image number, numbered 1, 2, 3, ... (At present, there are no Macs with multiple operating system images.)</p><p><em>Y</em> = PMC number, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>aXcY</strong></p></td><td ><p> Represents <strong>a</strong>pple Processor Interface-<em>X</em>, <strong>c</strong>ounter-Y. For example: <code>a1c1</code> is the term that represents counter #1 in API #1.</p><p><em>X</em> = Apple Processor Interface (API) number, numbered 1, 2, 3, ... (At present, there are no Macs with multiple APIs.)</p><p><em>Y</em> = PMC number, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>tbX</strong></p></td><td ><p> Represents <strong>t</strong>imebase Register in core <em>X</em>. For example: <code>tb1</code> is the term that represents the timebase register in core #1.</p><p><em>X</em> = Core to take the timebase from, numbered 1, 2, 3, ...</p></td></tr><tr><td  scope="row"><p><strong>eqX</strong></p></td><td ><p> Represents <strong>e</strong>quation-<em>X</em> . For example: <code>eq01</code> is the term that represents the result already calculated by the first shortcut equation in the results table. In this way, new equations can be built using results already calculated.</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW27" title="Spreadsheet Configuration Example"></a><h3>Spreadsheet Configuration Example</h3><p>Because this editor is very flexible and powerful, an example can be helpful to illustrate how it might be used. Starting with a predefined config, we will add some performance counter events, and activate the <em>Performance Counter Spreadsheet</em> plugins. Last, we will add some shortcut equations to the analysis.</p><p>Select the configuration named “Processor Bandwidth (Intel Core 2)” (<span class="content_text">Figure 7-12</span>).</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW15" title="Figure 7-12Choosing a counter-based starting configuration"></a><p><strong>Figure 7-12&nbsp;&nbsp;</strong>Choosing a counter-based starting configuration</p><img src = "../Art/SpreadsheetExample1X.jpg" alt = "Config Editor: L2 Data Cache Miss Profile Config" ></div><br/><p>Click the <em>Duplicate button</em>. Change the name of the new configuration to be “Core CPI (Intel Core 2).”</p><p>Make sure that “Simple” is selected in the <em>View popup</em>. Now click the <em>Counters</em> tab in the <em>Config Editor</em> window. Add the following two performance counter events to the profile config:</p><ol class="ol"><li class="li"><p>Find the entry in the performance counter event list that reads “CPU_CLK_UNHALTED.CORE.” Select “Counter” in the <em>Mode column</em>. The event name will change color (blue) to indicate that the selected event is to be used as a counter.</p></li><li class="li"><p>Next search the list by typing “INST” into the search field, as is shown in <span class="content_text">Figure 7-13</span>. Select the “INST_RETIRED” entry and change the mode to “Counter” as with the first event.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40005233-CH8-SW16" title="Figure 7-13Enabling two performance counters"></a><p><strong>Figure 7-13&nbsp;&nbsp;</strong>Enabling two performance counters</p><img src = "../Art/SpreadsheetExample3X.jpg" alt = "Config Editor: Two Performance Counter Events" ></div></li></ol><p>Click on the <em>Counter Spreadsheet</em> line in the list of PlugIns to see the <em>Performance Counter Spreadsheet</em>. You will see the editor described previously in <span class="content_text"><a href="CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW14">“Using the Editor.”</a></span> To add a new equation to the Shortcut Equation table click the <em>Add button</em>. Enter a shortcut name (e.g. “CPI” – this equation will compute the average number of CPU cycles per instruction for each sample).</p><p>Next, enter the equation <code>pNc3/pNc2</code>, as is shown in <span class="content_text">Figure 7-14</span>. This will automatically calculate the number of cycles per completed instruction, or CPI, and allow you to display it alongside the “raw” counts of CPU cycles, instructions completed, and the bus bandwidths already calculated by the original “Processor Bandwidth” configuration.</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH8-SW17" title="Figure 7-14Performance Spreadsheet: Shortcut Equation"></a><p><strong>Figure 7-14&nbsp;&nbsp;</strong>Performance Spreadsheet: Shortcut Equation</p><img src = "../Art/SpreadsheetExample4.jpg" alt = "Config Editor: Shortcut Equation" ></div><br/>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-04-14<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/CustomConfigurations/CustomConfigurations.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/CustomConfigurations/CustomConfigurations.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/CustomConfigurations/CustomConfigurations.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>