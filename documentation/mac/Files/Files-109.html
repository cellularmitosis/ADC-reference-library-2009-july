<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Volume Control Blocks (IM: F)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING109></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Files-108.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-110.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Files-2.html"><B>Files</B></A> / <BR><DD><A HREF="Files-72.html"><B>Chapter 2 - File Manager</B></A> / <A HREF="Files-107.html"><B>Data Organization in Memory</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING109-0></A>
<H2><A NAME=MARKER-9-623></A>Volume Control Blocks</H2>
 <A NAME=MARKER-2-624></A>Each time a volume is mounted, the File Manager reads its volume information from the master directory block and uses the information to build a new volume control block (VCB) in the volume control block queue (unless an ejected or offline volume is being remounted). The File Manager also creates a volume buffer in the system heap. When a volume is placed offline, its buffer is released. When a volume is unmounted, its VCB is removed from the VCB queue as well.<P>
<DL>
<DT><B><A NAME=MARKER-9-625></A>Assembly-Language Note</B>
<DD>The global variable <CODE>VCBQHdr</CODE> contains the header of the VCB queue. The global variable <CODE>DefVCBPtr</CODE> points to the VCB of the default volume.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
<DT><B>WARNING</B>
<DD>The size and structure of a VCB may be different in future versions of Macintosh system software. To ensure that you are reading the correct version of a VCB, check the <CODE>vcbSigWord</CODE> field; it should contain the value $4244.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 The <B>volume control block queue</B> is a standard Operating System queue that's maintained in the system heap. It contains a volume control block for each mounted volume. A <B>volume control block</B> is a nonrelocatable block that contains volume-specific information. The structure of a volume control block is defined by the <CODE>VCB</CODE> data type.<A NAME=MARKER-2-626></A><P>
<PRE>
TYPE VCB             =           {volume control block}
RECORD
   qLink:            QElemPtr;   {next queue entry}
   qType:            Integer;    {queue type}
   vcbFlags:         Integer;    {volume flags}
   vcbSigWord:       Integer;    {volume signature}
   vcbCrDate:        LongInt;    {date and time of volume creation}
   vcbLsMod:         LongInt;    {date and time of last modification}
   vcbAtrb:          Integer;    {volume attributes}
   vcbNmFls:         Integer;    {number of files in root directory}
   vcbVBMSt:         Integer;    {first block of volume bitmap}
   vcbAllocPtr:      Integer;    {start of next allocation search}
   vcbNmAlBlks:      Integer;    {number of allocation blocks in volume}
   vcbAlBlkSiz:      LongInt;    {size (in bytes) of allocation blocks}
   vcbClpSiz:        LongInt;    {default clump size}
   vcbAlBlSt:        Integer;    {first allocation block in volume}
   vcbNxtCNID:       LongInt;    {next unused catalog node ID}
   vcbFreeBks:       Integer;    {number of unused allocation blocks}
   vcbVN:            String[27]; {volume name}
   vcbDrvNum:        Integer;    {drive number}
   vcbDRefNum:       Integer;    {driver reference number}
   vcbFSID:          Integer;    {file-system identifier}
   vcbVRefNum:       Integer;    {volume reference number}
   vcbMAdr:          Ptr;        {used internally}
   vcbBufAdr:        Ptr;        {used internally}
   vcbMLen:          Integer;    {used internally}
   vcbDirIndex:      Integer;    {used internally}
   vcbDirBlk:        Integer;    {used internally}
   vcbVolBkUp:       LongInt;    {date and time of last backup}
   vcbVSeqNum:       Integer;    {volume backup sequence number}
   vcbWrCnt:         LongInt;    {volume write count}
   vcbXTClpSiz:      LongInt;    {clump size for extents overflow file}
   vcbCTClpSiz:      LongInt;    {clump size for catalog file}
   vcbNmRtDirs:      Integer;    {number of directories in root dir.}
   vcbFilCnt:        LongInt;    {number of files in volume}
   vcbDirCnt:        LongInt;    {number of directories in volume}
   vcbFndrInfo:      ARRAY[1..8] OF LongInt;
                                 {information used by the Finder}
   vcbVCSize:        Integer;    {used internally}
   vcbVBMCSiz:       Integer;    {used internally}
   vcbCtlCSiz:       Integer;    {used internally}
   vcbXTAlBks:       Integer;    {size of extents overflow file}
   vcbCTAlBks:       Integer;    {size of catalog file}
   vcbXTRef:         Integer;    {ref. num. for extents overflow file}
   vcbCTRef:         Integer;    {ref. num. for catalog file}
   vcbCtlBuf:        Ptr;        {ptr. to extents and catalog caches}
   vcbDirIDM:        LongInt;    {directory last searched}
   vcbOffsM:         Integer;    {offspring index at last search}
END;
</PRE>
<DL>
<DT><B>Note</B>
<DD>The values in the <CODE>vcbNmAlBlks</CODE> and <CODE>vcbFreeBks</CODE> fields are unsigned integers (that is, they can range from 0 to 65,535, not from -32,768 to 32,767). Because Pascal does not support unsigned data types, you need to use the technique illustrated in <A HREF=Files-96.html#MARKER-9-379>"Determining the Amount of Free Space on a Volume" on page 2-46</A> to read the values in these fields correctly.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
<H5>Field Description</H5>
<DT><CODE>qLink</CODE>
<DD> A pointer to the next entry in the VCB queue. You can get a pointer to the header of the VCB queue by calling the File Manager utility function <CODE>GetVCBQHdr</CODE>.
<DT><CODE>qType</CODE>
<DD> The queue type. When the volume is mounted and the VCB is created, this field is cleared. Thereafter, bit 7 of this field is set whenever a file on that volume is opened.
<DT><CODE><A NAME=MARKER-2-629></A>vcbFlags</CODE>
<DD> Volume flags. Bit 15 is set if the volume information has been changed by a File Manager call since the volume was last affected by a <CODE>FlushVol</CODE> call.<A NAME=MARKER-2-630></A>
<DT><CODE><A NAME=MARKER-2-631></A>vcbSigWord</CODE>
<DD> The volume signature. For HFS volumes, this field contains $4244.
<DT><CODE><A NAME=MARKER-2-632></A>vcbCrDate</CODE>
<DD> The date and time of volume creation (initialization).
<DT><CODE><A NAME=MARKER-2-633></A>vcbLsMod</CODE>
<DD> The date and time of last modification. This is not necessarily when the volume was last flushed.
<DT><CODE><A NAME=MARKER-2-634></A>vcbAtrb</CODE>
<DD> Volume attributes. The bits have these meanings:<CODE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>&nbsp;<TH>Bit<TH>Meaning<TR>
<TD>&nbsp;<TD>0-5<TD>Reserved<TR>
<TD>&nbsp;<TD>6<TD>Set if the volume is busy (one or more files are open)<TR>
<TD>&nbsp;<TD>7<TD>Set if the volume is locked by hardware<TR>
<TD>&nbsp;<TD>8-14<TD>Reserved<TR>
<TD>&nbsp;<TD>15<TD>Set if the volume is locked by software</TABLE>
</CODE>
<DT><CODE><A NAME=MARKER-2-635></A>vcbNmFls</CODE>
<DD> The number of files in the root directory.
<DT><CODE><A NAME=MARKER-2-636></A>vcbVBMSt</CODE>
<DD> The first block of the volume bitmap.
<DT><CODE><A NAME=MARKER-2-637></A>vcbAllocPtr</CODE>
<DD> The start block of the next allocation search. Used internally.
<DT><CODE><A NAME=MARKER-2-638></A>vcbNmAlBlks</CODE>
<DD> The number of allocation blocks in the volume.
<DT><CODE><A NAME=MARKER-2-639></A>vcbAlBlkSiz</CODE>
<DD> The allocation block size (in bytes). This value must always be a multiple of 512 bytes.
<DT><CODE><A NAME=MARKER-2-640></A>vcbClpSiz</CODE>
<DD> The default clump size.
<DT><CODE><A NAME=MARKER-2-641></A>vcbAlBlSt</CODE>
<DD> The first allocation block in the volume.
<DT><CODE><A NAME=MARKER-2-642></A>vcbNxtCNID</CODE>
<DD> The next unused catalog node ID (directory ID or file ID).
<DT><CODE><A NAME=MARKER-2-643></A>vcbFreeBks</CODE>
<DD> The number of unused allocation blocks on the volume.
<DT><CODE><A NAME=MARKER-2-644></A>vcbVN</CODE>
<DD> The volume name. This field consists of a length byte followed <BR>by 27 bytes. Note that the volume name can occupy at most <BR>27 characters; this is an exception to the normal file and directory name limit of 31 characters.
<DT><CODE><A NAME=MARKER-2-645></A>vcbDrvNum</CODE>
<DD> The drive number of the drive on which the volume is located. When a mounted volume is placed offline or ejected, <CODE>vcbDrvNum</CODE> is set to 0.
<DT><CODE><A NAME=MARKER-2-646></A>vcbDRefNum</CODE>
<DD> The driver reference number of the driver used to access the volume. When a volume is ejected, <CODE>vcbDRefNum</CODE> is set to the previous value of <CODE>vcbDrvNum</CODE> (and hence is a positive number). When a volume is placed offline, <CODE>vcbDRefNum</CODE> is set to the <BR>negative of the previous value of <CODE>vcbDrvNum</CODE> (and hence is <BR>a negative number).
<DT><CODE><A NAME=MARKER-2-647></A>vcbFSID</CODE>
<DD> An identifier for the file system handling the volume; it's zero for volumes handled by the File Manager and nonzero for volumes handled by other file systems.
<DT><CODE><A NAME=MARKER-2-648></A>vcbVRefNum</CODE>
<DD> The volume reference number.
<DT><CODE><A NAME=MARKER-2-649></A>vcbMAdr</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-650></A>vcbBufAdr</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-651></A>vcbMLen</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-652></A>vcbDirIndex</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-653></A>vcbDirBlk</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-654></A>vcbVolBkUp</CODE>
<DD> The date and time of the last volume backup.
<DT><CODE><A NAME=MARKER-2-655></A>vcbVSeqNum</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-656></A>vcbWrCnt</CODE>
<DD> The volume write count.
<DT><CODE><A NAME=MARKER-2-657></A>vcbXTClpSiz</CODE>
<DD> The clump size of the extents overflow file.
<DT><CODE><A NAME=MARKER-2-658></A>vcbCTClpSiz</CODE>
<DD> The clump size of the catalog file.
<DT><CODE><A NAME=MARKER-2-659></A>vcbNmRtDirs</CODE>
<DD> The number of directories in the root directory.
<DT><CODE><A NAME=MARKER-2-660></A>vcbFilCnt</CODE>
<DD> The number of files on the volume.
<DT><CODE><A NAME=MARKER-2-661></A>vcbDirCnt</CODE>
<DD> The number of directories on the volume.
<DT><CODE><A NAME=MARKER-2-662></A>vcbFndrInfo</CODE>
<DD> Information used by the Finder.
<DT><CODE><A NAME=MARKER-2-663></A>vcbVCSize</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-664></A>vcbVBMCSiz</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-665></A>vcbCtlCSiz</CODE>
<DD> Used internally.
<DT><CODE><A NAME=MARKER-2-666></A>vcbXTAlBks</CODE>
<DD> The size (in blocks) of the extents overflow file.
<DT><CODE><A NAME=MARKER-2-667></A>vcbCTAlBks</CODE>
<DD> The size (in blocks) of the catalog file.
<DT><CODE><A NAME=MARKER-2-668></A>vcbXTRef</CODE>
<DD> The path reference number for the extents overflow file.
<DT><CODE><A NAME=MARKER-2-669></A>vcbCTRef</CODE>
<DD> The path reference number for the catalog file.
<DT><CODE><A NAME=MARKER-2-670></A>vcbCtlBuf</CODE>
<DD> A pointer to the extents and catalog caches.
<DT><CODE><A NAME=MARKER-2-671></A>vcbDirIDM</CODE>
<DD> The directory last searched.
<DT><CODE><A NAME=MARKER-2-672></A>vcbOffsM</CODE>
<DD> The offspring index at the last search.<A NAME=MARKER-2-673></A>
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Files-108.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Files-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Files-390.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Files-110.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Files-3.html">&copy; Apple Computer, Inc.</A><br>2 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
