<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Creating Adaptor Sublayer Objects and Connecting Them to the Server</TITLE></HEAD><body bgcolor="#ffffff"><!--start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>Programming Topics</font><br><br><!--end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.30.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.32.html"><img src="next.gif" border="0" width="49" height="16"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606144"> </A><A NAME="17565"> </A>Creating Adaptor Sublayer Objects and Connecting Them to the Server</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=629539"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606145"> </A>Discusses how to create adaptor sublayer objects without using higher level objects. Presents a robust way to connect to the database server.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606146"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=629559"> </A>Not all applications require higher level objects to drive the adaptor sublayer. For example, you might bypass the database sublayer and control layer entirely if you're writing an application, such as a report writer, that is concerned only with raw data and not with the methods that an enterprise object couples to that data. At the adaptor sublayer, each database row is returned as a dictionary. An application that bypasses higher level database sublayer and control layer objects must create its own adaptor sublayer objects.</P><P CLASS="Body"><A NAME="pgfId=629560"> </A>You normally create an adaptor with the method <TT CLASS="Code">adaptorWithModel</TT>, specifying an existing EOModel object (see the EOModel class specification for information on loading a model file). The model contains the name of the adaptor bundle that corresponds to the type of database server you are using. It also contains database connection information specifying the values, such as user name and password, needed to connect to the database server.  The connection information is stored in a dictionary whose keys identify the information the server expects, and whose values are the values that the adaptor will try when connecting. Each adaptor uses different keys; see your adaptor's documentation for keys it uses. The dictionary may contain incomplete connection information. In such cases, the user must specify the remaining information at runtime.</P><P CLASS="Body"><A NAME="pgfId=629561"> </A>A newly created adaptor has no adaptor contexts; to create a new context send your adaptor a <TT CLASS="Code">createAdaptorContext</TT> message. In Objective-C, an EOAdaptorContext retains its adaptor when created and an EOAdaptorChannel retains its context, so when you create a set of these objects, you need only retain the channel for all objects to remain valid.</P><P CLASS="Body"><A NAME="pgfId=629568"> </A>You can create a connection dictionary and assign it to your adaptor with the <TT CLASS="Code">setConnectionDictionary</TT> method. When you ask an adaptor to validate its connection dictionary with an <TT CLASS="Code">assertConnectionDictionaryIsValid</TT> message, it briefly forms a connection to confirm that the server will accept the values in the dictionary. An adaptor doesn't form a lasting connection to the database server until one of its channels receives an <TT CLASS="Code">openChannel</TT> message.</P><P CLASS="Body"><A NAME="pgfId=629572"> </A>The following code excerpt shows one way to set up a suite of adaptor objects, given a model that's already loaded:</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629648"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=629657"> </A>EOModel *myModel;    /* Assume this exists. */<A NAME="pgfId=630750"> </A>EOAdaptor *myAdaptor;<A NAME="pgfId=630751"> </A>EOAdaptorContext *myContext;<A NAME="pgfId=630752"> </A>EOAdaptorChannel *myChannel;<A NAME="pgfId=630753"> </A><A NAME="pgfId=630754"> </A>myAdaptor = [EOAdaptor adaptorWithModel:myModel];<A NAME="pgfId=630755"> </A>myContext = [myAdaptor createAdaptorContext];<A NAME="pgfId=630756"> </A>myChannel = [myContext createAdaptorChannel];<A NAME="pgfId=630757"> </A>NS_DURING<A NAME="pgfId=630758"> </A>    [myAdaptor assertConnectionDictionaryIsValid];<A NAME="pgfId=630759"> </A>NS_HANDLER<A NAME="pgfId=630760"> </A>    /* Get database login information from the user */<A NAME="pgfId=629658"> </A>NS_ENDHANDLER<A NAME="pgfId=630763"> </A><A NAME="pgfId=630764"> </A>[myChannel openChannel];</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=629671"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=629685"> </A>EOModel myModel;    /* Assume this exists. */<A NAME="pgfId=630765"> </A>EOAdaptor myAdaptor;<A NAME="pgfId=630766"> </A>EOAdaptorContext myContext;<A NAME="pgfId=630767"> </A>EOAdaptorChannel myChannel;<A NAME="pgfId=630768"> </A><A NAME="pgfId=630769"> </A>myAdaptor = EOAdaptor.adaptorWithModel(myModel);<A NAME="pgfId=630770"> </A>myContext = myAdaptor.createAdaptorContext();<A NAME="pgfId=630771"> </A>myChannel = myContext.createAdaptorChannel();<A NAME="pgfId=630772"> </A>try {<A NAME="pgfId=630773"> </A>    myAdaptor.assertConnectionDictionaryIsValid();<A NAME="pgfId=630774"> </A>catch (NSException exception) {<A NAME="pgfId=630775"> </A>    /* Get database login information from the user */<A NAME="pgfId=629686"> </A>}<A NAME="pgfId=630778"> </A><A NAME="pgfId=630779"> </A>myChannel.openChannel();</PRE><P CLASS="Body"><A NAME="pgfId=629578"> </A>The <TT CLASS="Code">assertConnectionDictionaryIsValid</TT> invocation verifies that the adaptor has the information needed to log in to the server. This method raises an exception if it's unable to connect to the database server. Thus, it's invoked within an exception handling domain (bracketed by <TT CLASS="Code">NS_DURING</TT> and <TT CLASS="Code">NS_HANDLER</TT> macros in Objective-C, and in the <TT CLASS="Code">try</TT> clause in Java). If the connection dictionary contains invalid information (for example, it's common to leave the user name and password unspecified in the model file), <TT CLASS="Code">assertConnectionDictionaryIsValid</TT> raises an exception. As a result, the local exception handler (bracketed by <TT CLASS="Code">NS_HANDLER</TT> and <TT CLASS="Code">NS_ENDHANDLER</TT> macros in Objective-C, and in the <TT CLASS="Code">catch</TT> clause in Java) invokes code<TT CLASS="Code"> </TT>to allow the user to enter the necessary connection information. The invocation of <TT CLASS="Code">openChannel</TT> at the end of the excerpt causes the application to form a connection to the database.</P><P CLASS="Body"><A NAME="pgfId=629751"> </A>If you don't have a model, you can also create the EOAdaptor sublayer objects using the EOAdaptor <TT CLASS="Code">adaptorWithName</TT> method. See the programming topic <A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A> for an example.</P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=624378"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=629750"> </A><A HREF="ProgrammingTopics.33.html#24267" CLASS="XRef">Accessing Schema Information from the Database Server</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=629733"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=629734"> </A>How do I create adaptor sublayer objects?</LI><LI CLASS="Bulleted"><A NAME="pgfId=629749"> </A>How do I use the adaptor sublayer without using higher level objects?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=629737"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606217"> </A>Adaptor</LI><LI CLASS="Bulleted"><A NAME="pgfId=630830"> </A>EOAdaptorChannel</LI><LI CLASS="Bulleted"><A NAME="pgfId=629504"> </A>Login</LI><LI CLASS="Bulleted"><A NAME="pgfId=629500"> </A>Connection Dictionary</LI><LI CLASS="Bulleted"><A NAME="pgfId=629716"> </A>EOModel</LI><LI CLASS="Bulleted"><A NAME="pgfId=630835"> </A>Database Server</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606225"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=602450"> </A>8 February, 1999. Clif Liu. First Draft.</P></DIV><HR>&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.30.html"><img src="previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.32.html"><img src="next.gif" border="0" width="49" height="16"></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></BODY></HTML>