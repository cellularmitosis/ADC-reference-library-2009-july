<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1064: Inside Macintosh: Operating System Utilities: Addendum to Chapter 4 - Determining If Daylight Savings Time is in Effect</title>    <meta name="keywords" content="Mac OS 8 programmatically daylight savings time determining dlsDelta gmtDelta ">    <meta name="Description" content="Technical Note TN1064: This Technical Note describes a methodfor programmatically determining the state of Daylight SavingsTime on a computer.">                                       <meta name="categories" content="Inside Macintosh Addenda and Operating System"><meta name="week-posted" content="Aug 26, 1996 - Sep 6, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002905" title="Inside Macintosh: Operating System Utilities: Addendum to Chapter 4 - Determining If Daylight Savings Time is in Effect"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxCarbon-date.html">Carbon</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Carbon/idxTextFonts-date.html" target="_blank">Carbon > Text & Fonts</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1064</div>
<div id="pageheadsub">Inside Macintosh: Operating System Utilities: Addendum to Chapter 4 - Determining If Daylight Savings Time is in Effect</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --> <table width="600" cellpadding="0" cellspacing="0" border="0">	<tr>		<td width=300 valign="top" align=left scope="row">			<table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>				</tr>				<tr bgcolor="#e6e6e6">					<td background="images/tnmenubody.gif" width=300 align=left>						<span id="menutitle">							CONTENTS                             <br>                            <br>						</span>					</td>				</tr>				<tr bgcolor="#e6e6e6">					<td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><p id="menutext"><A HREF="#Section1">Using the dlsDelta field</a><BR> <BR><A HREF="#Section2">Preserving the 3-Byte Value</a><BR> <BR><A HREF="#Section3">A Routine That Checks the State</a><BR> <BR><A HREF="#Summary">Summary</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Changes">Change History</A><BR><BR><A HREF="#Downloads">Downloadables</A></p>                  <!-- end_toc --> 								</td>				</tr>				<tr>					<td width=300 align=left scope="row">						<img src="images/tnmenubottom.gif" alt="" width=300 height=16>					</td>				</tr>			</table>		</td>		<td width=300 valign="top" align=left>			<!-- begin_intro_text -->            <P id = "introtext">While you can set the Daylight Savings Time state from the Date &amp; TimeControl Panel and determine what the state is by checking the checkbox in theControl Panel, you can also figure out the state from within your program. ThisTechnote shows you how.</p><P id = "introtext"><i>Inside Macintosh: Operating System Utilities</i>, Chapter 4, does not directlyexplain how you can find out if daylight savings time is in effect. With the<code>MachineLocation</code> data structure <code>dlsDelta</code> field, you can find out how the timewould have changed, but the field does not tell you whether daylight savingstime is in effect.</p><P id = "introtext">This Technote is aimed at Macintosh developers who must deal with date andtime programming issues.</p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Sep 01 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_header_box --> <BR><BR><hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name="Section1"></a><H2>Using the dlsDelta field</H2><p>The Daylight Savings Time state is stored in the <code>gmtDelta</code> field of the<code>MachineLocation</code> structure. The API to access this structure is the ScriptManager call <code>ReadLocation</code>. Unfortunately, there is not enough documentation onthe <code>MachineLocation</code> structure in general and no official standards on the useof the <code>gmtDelta</code> field.</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><H2>Preserving the 3-Byte Value</H2><P>Currently, the <code>dlsDelta</code> field is not being used by Macintosh system software,nor is its meaning defined. It may be used in the future, so it'simportant that you preserve its current value if you ever use <code>WriteLocation</code> toset the value of <code>gmtDelta</code>.</p><p>The top byte of the <code>gmtDelta</code> should be masked off and preserved  when writing: it's reserved for future extension. The <code>gmtDelta</code> is really a 3-byte value, soyou must take care to get and set  it properly, as in the following C codeexamples: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#include &lt;OSUtils.h&gt;    long GetGmtDelta(MachineLocation myLocation)    {        long    internalGMTDelta;        internalGMTDelta = myLocation.gmtDelta &amp; 0x00ffffff;        if ( (internalGMTDelta &gt;&gt; 23) &amp; 1 ) // need to sign extend            internalGmtDelta = internalGmtDelta | 0xff000000;        return (internalGmtDelta);    }    void SetGmtDelta(MachineLocation *myLocation, long myGmtDelta)    {        char    tempSignedByte;        tempSignedByte = myLocation-&gt;dlsDelta;    // save away high byte        myLocation-&gt;gmtDelta = myGmtDelta;    // make sure not overwritten        myLocation-&gt;dlsDelta = tempSignedByte;    // restore high byte    }</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><H2>A Routine That Checks the State</H2><p>The following routine shows exactly what you need to do in order to determineif the daylight savings time is on. It is important to note that the <code>dlsDelta</code>field is declared to be signed char. If this is not declared, the if conditionwill always return false, even if the daylight savings time is set to true.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>#include &lt;OSUtils.h&gt;int IsDaylightSavingsOn(){    int retVal = 0;    MachineLocation    theLocation;    ReadLocation(&amp;theLocation);    if (theLocation.u.dlsDelta == (signed char) 0x80) {        retVal = 1;    }    return(retVal);}</pre>	</TD></TR></TABLE></CENTER><P>Versions of the Date &amp; Time Control Panel greater than 7.1 set the high bitof the high byte if Daylight Savings is checked "on" in the CDEV. The Map CDEFhas not yet been revised to use this field. Future versions of Map or Date&amp; Time may use the byte differently, so be sure to use it with caution.</p><H2>References</H2><p><I>Inside Macintosh: Operating System Utilities</I></p><p><I><a href="../te/te_510.html">Technote TE 510 - International Resource Q&amp;As</a></I></p><p><I>Develop 14 : Q&amp;As</I>. Download this article's <a href="http://developer.apple.com/cgi-bin/ftpchooser.pl?partialURL=Periodicals/develop/develop14/develop_Issue_14/Macintosh_Q-A.sit.hqx">Acrobat version</A> (344K).</p><P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="500">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (68K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1064.pdf">Download</A></P>               </TD>            </TR></TABLE><P><A HREF="#top">Back to top</A></P></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1064.html%3Fid%3DDTS10002905-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1064.html%3Fid%3DDTS10002905-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1064.html%3Fid%3DDTS10002905-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>