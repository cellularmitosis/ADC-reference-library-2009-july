<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note PT27: MPW: {$LOAD}; _DataInit;%_MethTables</title>                                       <meta name="categories" content="Platforms and Tools"><meta name="week-posted" content="Oct 27, 1986 - Nov 7, 1986"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002681" title="MPW: {$LOAD}; _DataInit;%_MethTables"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTools-date.html">Tools</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/DeveloperTools/idxCompilersDebuggers-date.html" target="_blank">Tools > Compiling & Debugging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note PT27</div>
<div id="pageheadsub">MPW: {$LOAD}; _DataInit;%_MethTables</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">{$LOAD}</A><BR><BR><A HREF="#Section2">The _DataInit Segment</A><BR><BR><A HREF="#Section3">%_MethTables and %_SelProcs</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This technical note discusses the Pascal <code>{$LOAD}</code> directive as well ashow to unload the <code>_DataInit</code> and <code>%_MethTables</code> segments.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Nov 01 1986]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>{$LOAD}</h2><p>MPW Pascal has a <code>{$LOAD}</code> directive that can dramatically speed upcompiles.</p><p>will combine symbol tables of all units following this directive (until another<code>{$LOAD}</code> directive is encountered), and dump them out to<code>HD:MPW:PLibraries:PasSymDump</code>. In order to avoid using fully specifiedpathnames, you can use <code>{$LOAD}</code> in conjunction with the <code>-k</code>option for Pascal:</p><p>combined with the following lines in <code>myfile</code>:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    USES        {$LOAD PasSymDump}            MemTypes,QuickDraw, OSIntf, ToolIntf, PackIntf,        {$LOAD} {This &quot;turns off&quot; $LOAD for the next unit}            NonOptimized,        {$LOAD MyLibDump}</pre>	</TD></TR></TABLE></CENTER><p>will do the following: the first time a program containing these lines iscompiled, two symbol table dump files (in this case <code>PasSymDump</code> and<code>MyLibDump)</code> will be created in the directory specified by the<code>-k</code> option (in this case <code>{PLibraries})</code>. No dump file will begenerated for the unit <code>NonOptimized</code>. The compiler will compile<code>MemTypes, QuickDraw,</code> <code>OSIntf,</code> <code>ToolIntf,</code><code>PackIntf</code> (quite time consuming) and dump those units' symbols to<code>PasSymDump</code> and it will compile the interface to <code>MyLib</code> anddump its symbols to <code>MyLib</code>. For subsequent compiles of this program (orany program that uses the same dump file(s)), the interface files won't berecompiled, the compiler will simply read in the symbol table.</p><p>Compiling a sample five line program on a Macintosh Plus/HD20SC takes 62seconds without using the <code>{$LOAD}</code> directive. The same program takes 10seconds to compile using the <code>{$LOAD}</code> directive (once the dump fileexists). For further details about this topic, please see the <i>MPW PascalReference Manual</i> .</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>If any of the units that are dumped into a dump file change, youneed to make sure that the dump file is deleted, so that it can be regeneratedby the Pascal compiler with the correct information. The best way to do this isto use a makefile to check the dump file against the files it depends on, anddelete the dump file if it is out of date with respect to any of the units thatit contains. An excellent (and well commented) example of doing this is in the<i>MPW Workshop Manual</i>.</P></TD></TR></TABLE></CENTER><BR> <a name="Section2"></a><P><A HREF="#top">Back to top</A></p><h2>The _DataInit Segment</h2><p>The Linker will generate a segment whose resource name is <code>%A5Init</code> forany program compiled by the C or Pascal compilers. This segment is called by aprogram's main segment. This segment is loaded into the application heap andlocked in place. It is up to your program to unload this segment (otherwise, itwill remain locked in memory, possibly causing heap fragmentation). To do thisfrom Pascal, use the following lines:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    PROCEDURE _DataInit;EXTERNAL;    ...    BEGIN     {main PROGRAM}    UnloadSeg(@_DataInit);    {remove data initialization code before any allocations}</pre>	</TD></TR></TABLE></CENTER><p>From C, use the following lines:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    extern _DataInit();    ...    { /* main */        UnloadSeg(_DataInit);        /*remove data initialization code before any allocations*/</pre>	</TD></TR></TABLE></CENTER><p>For further details about Data Initialization, see the <i>MPW ReferenceManual</i>.</p> <P><A HREF="#top">Back to top</A></p> <a name="Section3"></a><h2>%_MethTables and %_SelProcs</h2><p>Object use in Pascal produces two segments which can cause heap problems. Theseare <code>%_MethTables</code> and <code>%_SelProcs</code> which are used when methodcalls are made. MacApp deals with them correctly, so this only applies toObject Pascal programs that don't use MacApp. You can make the segments lockedand preloaded (probably the easiest route), so they will be loaded low in theheap, or you can unload them temporarily while you are doing heapinitialization. In the latter case, make sure there are no method calls whilethey are unloaded. To reload <code>%_MethTables</code> and <code>%_SelProcs</code>,call the dummy procedure <code>%_InitObj</code>. <code>%_InitObj</code> loads<code>%MethTables </code>--calling any method will then load <code>%_SelProcs</code>.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Reminder:</B><BR>The linker is case sensitive when dealing with module names. Pascalconverts all module names to upper-case (unless a routine is declared to be a Croutine). The Assembler default is the same as the Pascal default, though itcan be changed with the CASE directive. C preserves the case of module names(unless a routine is declared to be <code>pascal</code>, in which case the modulename is converted to upper- case letters).</P></TD></TR></TABLE></CENTER><BR> <P>Make sure that any external routines that you reference are capitalized thesame in both the external routine and the external declaration (especially inC). If the capitalization differs, you will get the following link error(library routine = <code>findme</code>, program declaration = <code>externFindMe();</code>):</p><a name="References"></a> <P><A HREF="#top">Back to top</A></p><h2>References</h2><P>   MPW Reference Manuals</p>         <a name=Downloads></A><P><A HREF="#top">Back to top</A></p><h2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/pt_27.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/pt/pt_27.html%3Fid%3DDTS10002681-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/pt/pt_27.html%3Fid%3DDTS10002681-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/pt/pt_27.html%3Fid%3DDTS10002681-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>