<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects Java Client Programming Guide (Legacy): Enhancing the Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Enhancing the Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	<meta name="ROBOTS" content="NOINDEX"/>
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30001017-CH303" title="Enhancing the Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../LegacyTechnologies/index.html#//apple_ref/doc/uid/TP30000440-TP30000470" target="_top">Legacy Documents</a> &gt; <a href="../../../LegacyTechnologies/Tools-date.html#//apple_ref/doc/uid/TP30000440-TP30000470-TP30000463" target="_top">Tools</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30001017-CH297-TP1">WebObjects Java Client Programming Guide (Legacy)</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DistributionLayer/DistributionLayer.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../NonDirectJavaClient/NonDirectJavaClient.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        <script type="text/javascript" language="JavaScript">placeWatermark()</script>
<div id="legacyOuterWrapper"><div align="center" id="watermark">
<div class="legacybox">
<h1>Legacy Document<span class="closebutton"><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>
        <a name="//apple_ref/doc/uid/TP30001017-CH303-TP1" title="Enhancing the Application"></a><h1>Enhancing the Application</h1><p>In this chapter you’ll further customize the application you created in the basic tutorial. You’ll learn how to</p><ul class="ul"><li class="li"><p>add custom business logic to your application</p></li><li class="li"><p>use NSValidation to validate data</p></li><li class="li"><p>use remote method invocations</p></li><li class="li"><p>subclass controller classes to customize applications</p></li><li class="li"><p>use rules to change application behavior</p></li><li class="li"><p>add custom actions to the client application</p></li></ul>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF117">Customization Techniques</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF105">Enhance the EOModel</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF106">Add Custom Business Logic</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF19">Controller Hierarchy</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF135">Using Rules in the Rule System</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF22">Additional Actions</a>
				
			<br/>
			
        
			
			
				<a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF35">Debugging</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF117" title="Customization Techniques"></a><h2>Customization Techniques</h2><p>This tutorial uses some of the Direct to Java Client customization techniques. Before teaching you how to implement them, however, this section provides a summary of all the customization techniques available in Direct to Java Client, including their costs and appropriate usage.</p><p><span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF119">Table 6-1</a></span> compares the five customization techniques using several criteria.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF119" title="Table 6-1Consequences of each customization technique"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-1&nbsp;&nbsp;</strong>Consequences of each customization technique</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p></p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Synchronization with data model</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Maintainability</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Source code writing</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Localization</p></th></tr><tr><td  scope="row"><p>Assistant</p></td><td ><p>Mostly automatic</p></td><td ><p>Easy</p></td><td ><p>None</p></td><td ><p>Easy</p></td></tr><tr><td  scope="row"><p>Custom rules</p></td><td ><p>Easy</p></td><td ><p>Easy</p></td><td ><p>None</p></td><td ><p>Easy</p></td></tr><tr><td  scope="row"><p>Freezing XML</p></td><td ><p>More difficult</p></td><td ><p>Moderate</p></td><td ><p>Minimal</p></td><td ><p>More difficult</p></td></tr><tr><td  scope="row"><p>Freezing interface files</p></td><td ><p>More difficult</p></td><td ><p>Moderate to difficult</p></td><td ><p>Minimal</p></td><td ><p>Moderately easy, using rule system</p></td></tr><tr><td  scope="row"><p>Custom controller classes</p></td><td ><p>Not applicable</p></td><td ><p>Difficult</p></td><td ><p>Much</p></td><td ><p>Easy, using EOUserDefaults</p></td></tr></table></div><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_223"></a>The first customization tool is the Direct to Java Client Assistant, which you’ve already used in <span class="content_text"><a href="../BasicTutorial/BasicTutorial.html#//apple_ref/doc/uid/TP30001017-CH300-TP9">“Building a Simple Application”</a></span> It allows you to</p><ul class="ul"><li class="li"><p>change an entity’s type (main, enumeration, or other)</p></li><li class="li"><p>change the properties that are displayed in any of the four tasks (form, query, list, and identify)</p></li><li class="li"><p>add new property keys</p></li><li class="li"><p>change the widget type of property keys</p></li><li class="li"><p>make basic customizations to the client application, such as changing the window titles and setting window sizes</p></li></ul><p>The <a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_224"></a>costs of using Assistant are very low: If you make changes to your data model, in most cases the rule system picks them up. (Some changes you make in Assistant, such as changing entity types, may not guarantee that changes in your model are picked up by the rule system.) You should do as much customization as possible within Assistant before moving on to more advanced customization techniques, which make synchronizing the user interface with the data model more complicated.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_225"></a>The second customization tool is writing custom rules. You do this in the Rule Editor<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_226"></a> application. The look and behavior of Direct to Java Client applications is defined by rules that work with the WebObjects rule system. The rule system is an integral part of the two WebObjects rapid development solutions, Direct to Web and Direct to Java Client. You can learn more about it in <span class="content_text"><a href="../InsideTheRuleSystem/InsideTheRuleSystem.html#//apple_ref/doc/uid/TP30001017-CH306-TP1">“Inside the Rule System”</a></span></p><p>Using custom rules is more difficult than just using Assistant, but the costs of using the rules are no higher than using Assistant (Assistant simply writes rules based on the customizations you make within it.) Many custom rules apply to specific entities, so if you change the entities in your model, you may invalidate some rules. But this is easily fixed by changing the argument in the rule that references a particular entity.</p><p>A simple rule is to specify the minimum width for all windows in an application:</p><dl class="table-display"><dt>Left-Hand Side:</dt><dd><code>(controllerType='windowController')</code></dd><dt>Key:</dt><dd><code>minimumWidth</code></dd><dt>Value:</dt><dd><code>512</code></dd><dt>Priority:</dt><dd><code>50</code></dd></dl><p class="clear"></p><p>You can define this characteristic for windows throughout your application programmatically, but it’s much easier and more maintainable to just write a rule. Rules are very abstract, and once you learn their syntax and semantics, you’ll find them to be a powerful customization technique.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_227"></a>The next customization technique is freezing XML, which allows you to explicitly state the result of a rule system request. The dynamically generated user interfaces Direct to Java Client produces are described in XML<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_228"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_229"></a>. In Assistant, the XML pane shows the XML description for each task for each entity for each window type in your application. Usually you start with this generated XML and customize it to suit your needs. This technique is fully explained in the chapter <span class="content_text"><a href="../T6FreezeXML/T6FreezeXML.html#//apple_ref/doc/uid/TP30001017-CH313-TP1">“Freezing XML User Interfaces.”</a></span></p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_230"></a>Freezing XML incurs more costs than writing custom rules or using Assistant since the user interface description is static. If you make changes to your data model, you’ll have to manually find and update any specific references to the entities and attributes in the user interface description. Since the XML descriptions are very abstract, this task is not too difficult. But, you should use Assistant as much as possible to customize your application before moving on to frozen XML.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_231"></a>In addition to using frozen XML, you can use frozen interface files created in Interface Builder. Although this gives you more control over the user interface, it makes maintenance more difficult, it makes platform-specific layout and localization much harder, and it makes data model synchronization more challenging. <span class="content_text"><a href="../T7MixingStaticAndDyn/T7MixingStaticAndDyn.html#//apple_ref/doc/uid/TP30001017-CH314-TP1">“Mixing Static and Dynamic User Interfaces”</a></span> teaches you to how freeze interface files and integrate them in dynamically generated user interfaces.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_232"></a>Among the most advanced techniques is writing custom controller classes. These are usually subclasses of EOController, and they can include any Swing component or any component written in Java. For instance, if you’d like a <code>JPasswordField</code> widget somewhere in your application, you’d have to write a custom controller class since this widget isn’t provided for you by default. Then, in the XML description for the window or modal dialog, you’d specify the custom controller class using the <code>className</code> attribute.</p><p>Using custom controller classes provides you with total control over the user interface, but it incurs high costs. It requires you to write source code (an inherently buggy process), which makes data model synchronization quite difficult, especially if you use the custom controller class with frozen XML<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_233"></a>.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF105" title="Enhance the EOModel"></a><h2>Enhance the EOModel</h2><p>The application in the basic tutorial uses a rather simple data model that offers little opportunity to customize applications that use it. A more advanced model will better demonstrate the customization features of Direct to Java Client. Since you’ll be modifying the model, however, it’s kept rather simple so you won’t have to spend too much time editing it.</p><ol class="ol"><li class="li"><p>Open the <code>Admissions.eomodeld</code> file from within the Admissions project.</p></li><li class="li"><p> Add these attributes to the Student entity:</p><ul class="ul"><li class="li"><p>Name: <code>act</code>; Column: ACT; External Type: <code>int</code>; Internal Data Type: <code>Integer</code>.</p></li><li class="li"><p>Name: <code>sat</code>; Column: SAT; External Type: <code>int</code>; Internal Data Type: <code>Integer</code>.</p></li><li class="li"><p>Name: <code>firstContact</code>; Column: FIRST_CONTACT; External Type: <code>date</code>; Internal Data Type: <code>Date</code>. <em>Don’t lock on this attribute: Deselect the lock icon in the attribute’s row.</em></p></li></ul><p>Make all the new attributes client-side class properties. By default, they should also be set as server-side class properties, so make sure the diamond icon is present for all the new attributes.</p></li><li class="li"><p>Since you added attributes to the entity, you must synchronize the model and the database schema. Refer to <span class="content_text"><a href="../BasicTutorial/BasicTutorial.html#//apple_ref/doc/uid/TP30001017-CH300-TPXREF32">“Using the Application”</a></span> and <span class="content_text"><a href="../BasicTutorial/BasicTutorial.html#//apple_ref/doc/uid/TP30001017-CH300-TPXREF65">Figure 3-21</a></span> for a reminder.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_67" title="Note"></a><p><strong>Note:</strong>&nbsp;You may receive an exception when synchronizing the schema in this step. Schema synchronization can be a useful feature but you probably don’t want to use it on a production database that holds important data.</p></div></li></ol><p>The Student entity should now resemble <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF114">Figure 6-1</a></span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF114" title="Figure 6-1The updated Student entity"></a><p><strong>Figure 6-1&nbsp;&nbsp;</strong>The updated Student entity</p><img src = "../Art/studententity.gif" alt = "The updated Student entity" width="412" height="117"></div><br/><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF106" title="Add Custom Business Logic"></a><h2>Add Custom Business Logic</h2><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_234"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_235"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_236"></a><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_237"></a>As the basic tutorial illustrates, you can go far in developing a Direct to Java Client application without writing any code. However, the real power of a Java Client application is in the enterprise objects you create and customize. The behavior or business logic you add to enterprise objects brings stored data to life.</p><p>By default, EOModeler assigns new entities the class EOGenericRecord. EOGenericRecord is sufficient when all you want the entity to do is get and set properties. However, when you want to add custom behavior to a class (for example, to assign default values when you create new objects or to perform validation), you need to implement a custom enterprise objects class. This class includes the default behavior provided by EOGenericRecord as well as the custom behavior you implement.</p><p>To use custom business logic in your application, you assign custom classes to the entities in your model. </p><ol class="ol"><li class="li"><p>In EOModeler, select the Admissions model root (top of the tree). Make sure you’re in table mode. If the Client-Side Class Name column is not visible, choose Client-Side Class Name from the Add Column pop-up menu at the bottom of the window.</p></li><li class="li"><p>Double-click the Class Name cell for Student in the table and enter <code>businesslogic.server.Student</code>.</p></li><li class="li"><p>Double-click the Client-Side Class Name cell for Student and change <code>server</code> to <code>client</code> so it reads <code>businesslogic.client.Student</code>.</p></li><li class="li"><p>Repeat these steps for the Activity entity, substituting <code>Activity</code> for <code>Student</code> in the package name.</p><div class="item_figure"><img src = "../Art/customclassineom.gif" alt = "image: ../Art/customclassineom.gif" width="501" height="55"></div></li><li class="li"><p>Save the model.</p></li></ol><p>The recommended naming convention of custom class names is to adhere to Java package syntax.</p><p>By giving both the Class Name (server) attribute and the Client-Side Class Name (client) attribute custom class names, you are telling the model to use custom classes on both the client and the server. But this isn’t required—you can implement a class only on the server or only the client, depending on your needs. See <span class="content_text"><a href="../DistributionLayer/DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TPXREF32">“Design Recommendations”</a></span> for more information.</p><p>Once you specify a custom class for an entity in EOModeler, you can generate Java source files for that entity. Before doing that should prepare your project to handle the new files.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF107" title="Prepare the Project for Custom Logic"></a><h3>Prepare the Project for Custom Logic</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_238"></a><p>Project Builder stores most of a project’s files at the top level of the project directory in the file system even though it organizes files in logical groupings inside the project itself. It’s a good idea to separate your business logic files from other WebObjects files both in the project directory in the file system and in logical groupings inside the Project Builder project.</p><p>Follow this step to create a <code>BusinessLogic</code> directory with subdirectories in the file system, and to create a <code>BusinessLogic</code> group in the project:</p><p>Create the following directories at the top level of your project directory (do this in the file system, not in Project Builder): <code>BusinessLogic</code><code>BusinessLogic/Client</code><code>BusinessLogic/Server</code></p><p>The directory structure should look like <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-BCIBHCFC">Figure 6-2</a></span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIBHCFC" title="Figure 6-2Directory structure for custom business logic"></a><p><strong>Figure 6-2&nbsp;&nbsp;</strong>Directory structure for custom business logic</p><img src = "../Art/blogicinfinder.gif" alt = "Directory structure for custom business logic" width="580" height="309"></div><br/><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF108" title="Generate Source Files"></a><h3>Generate Source Files</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_239"></a><p>EOModeler can generate Java files for your model. You’ll use these source files to add custom business logic to your enterprise objects.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_68" title="Note"></a><p><strong>Note:</strong>&nbsp;In WebObjects 5.1 with certain versions of Mac OS X and the developer tools, EOModeler does not prompt you for a location for the class files it generates. Rather, it attempts to save files in the model’s directory. To work around this bug, you’ll have to manually move the generated class files to the correct directories. The bug is fixed in WebObjects 5.2.</p></div><p>Follow these steps to generate Java files for the client:</p><ol class="ol"><li class="li"><p>In EOModeler, select the Student entity.</p></li><li class="li"><p>Choose Property > Generate Client Java Files.</p></li><li class="li"><p>Select the <code>Client</code> directory inside the <code>BusinessLogic</code> directory in the project, as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-BCIEIABF">Figure 6-3</a></span>. </p></li><li class="li"><p>Click Save. </p></li><li class="li"><p>Repeat the process for the Activity entity.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIEIABF" title="Figure 6-3Save Client Java files in BusinessLogic/Client"></a><p><strong>Figure 6-3&nbsp;&nbsp;</strong>Save Client Java files in BusinessLogic/Client</p><img src = "../Art/blogicclientdir.gif" alt = "Save Client Java files in BusinessLogic/Client" width="346" height="329"></div></li></ol><p>Follow these steps to generate Java files for the server:</p><ol class="ol"><li class="li"><p>In EOModeler, select the Student entity.</p></li><li class="li"><p>Choose Property > Generate Java Files.</p></li><li class="li"><p>Select the <code>Server</code> directory inside the <code>BusinessLogic</code> directory in the project. </p></li><li class="li"><p>Click Save.</p></li><li class="li"><p>Repeat the process for the Activity entity.</p></li></ol><p>The Java class files generated by EOModeler include the necessary import declarations as well as constructors and accessor methods derived from the properties of the entity defined in the model file. </p><p>Although you told EOModeler where to put the generated files, Project Builder did not automatically add them to the project.</p><p>Follow these steps to import the generated files into Project Builder:</p><ol class="ol"><li class="li"><p>Select the Classes group in the Files list of Project Builder (click the Files tab if this list isn’t visible).</p></li><li class="li"><p>Choose Project > Add Files.</p></li><li class="li"><p>Select the <code>BusinessLogic</code> directory and click Open. This creates a new group and imports the <code>BusinessLogic</code> directory and its subdirectories into the group.</p></li><li class="li"><p>Select Application Server as the target as shown in <span class="content_text">Figure 6-4</span>. Also make sure that “Recursively create groups for any added folders” is selected.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIGCCAI" title="Figure 6-4Import BusinessLogic directory"></a><p><strong>Figure 6-4&nbsp;&nbsp;</strong>Import BusinessLogic directory</p><img src = "../Art/importblogicdir.gif" alt = "Import BusinessLogic directory" width="324" height="281"></div></li><li class="li"><p>Click Add. The new files should appear in the Files list as illustrated in <span class="content_text">Figure 6-5</span>.</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_240"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_241"></a>After the import, change the target for the files in <code>BusinessLogic/Client</code> to Web Server. Do this by changing the target to Web Server in the target’s pop-up menu and selecting the checkbox to the left of each file in the <code>BusinessLogic/Client</code> group. Refer to <span class="content_text">Figure 6-5</span> for clarity.</p><p>Make sure you also disassociate the files in <code>BusinessLogic/Client</code> from the Application Server target by switching to that target and deselecting the checkbox to the left of each file in that group. The client Java files must be built as part of the Web Server target rather than as part of the Application Server target.</p><p>Make sure that Admissions is the target selected in the targets pop-up menu after you’ve correctly associated the imported files with their targets.</p></li></ol><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-BCICDEDC" title="Figure 6-5BusinessLogic group with imported files and associated targets"></a><p><strong>Figure 6-5&nbsp;&nbsp;</strong>BusinessLogic group with imported files and associated targets</p><img src = "../Art/targetfiles.gif" alt = "BusinessLogic group with imported files and associated targets" width="553" height="265"></div><br/><p>Now the project uses custom classes for the Student and Activity enterprise objects instead of EOGenericRecord. These class files can be edited to implement custom behavior.</p><p>If you examine the code in any of the imported classes, you’ll notice that the class generated by EOModeler does not have actual instance variables or fields. Rather, the methods to access the attributes of the custom enterprise objects are implemented using key-value coding.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF109" title="Behind the Steps"></a><h4>Behind the Steps</h4><p>Step 4: You were instructed to assign all the imported classes to the Application Server target for convenience. You could also import the files in <code>BusinesssLogic/Client</code> and <code>BusinessLogic/Server</code> separately and assign them to the correct target at that time.</p><p>Step 6: As an alternative to importing all the custom Java classes at once and then changing the target accordingly, you can also import the server and client classes separately and assign them to the appropriate target at that time. </p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF118" title="Prepare Application for Business Logic"></a><h3>Prepare Application for Business Logic</h3><p>The business logic you’ll add is quite simple: It calculates a rating for a student by aggregating the three scores in the database: ACT, SAT, and GPA. You can use Assistant to prepare the application for this new business logic.</p><p>Here’s how:</p><ol class="ol"><li class="li"><p>Build and run the application and open Assistant. You have to build the application again since you changed the model.</p></li><li class="li"><p>In the Properties pane, add a new property key path called <code>rating</code> for Task > form and Entity > Student using the Additional Property Key Path text field and the Add button as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-BCIJACJC">Figure 6-6</a></span>. See <span class="content_text"><a href="../InsideAssistant/InsideAssistant.html#//apple_ref/doc/uid/TP30001017-CH301-TPXREF45">“Additional Property Key Path Field”</a></span> for more information on what’s happening in this step.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIJACJC" title="Figure 6-6Add a property key for the form task"></a><p><strong>Figure 6-6&nbsp;&nbsp;</strong>Add a property key for the form task</p><img src = "../Art/addratingtoform.gif" alt = "Add a property key for the form task" width="460" height="465"></div></li><li class="li"><p>Since you’d like to see the rating displayed in the list view of a query window, you also need to add the additional property for the list task. Choose list in the Task pop-up menu and click Add, as shown in <span class="content_text">Figure 6-7</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIHCGIH" title="Figure 6-7Additional property key for list task"></a><p><strong>Figure 6-7&nbsp;&nbsp;</strong>Additional property key for list task</p><img src = "../Art/addratingtolist.gif" alt = "Additional property key for list task" width="458" height="466"></div></li><li class="li"><p>The new property will be associated (via an EOAssociation, see <span class="content_text"><a href="../BasicConcepts/JavaClientBasicConcepts.html#//apple_ref/doc/uid/TP30001017-CH299-TPXREF99">“Associations”</a></span>) with a method of the same name in a client-side business logic class for the entity (<code>businesslogic.client.Student</code> in this case). </p><p>To make this association, switch to the Widgets pane and choose Task > form and Entity > Student, then select rating in the Property Keys list. From the Widget Type pop-up menu, choose EOTextFieldController if it is not already chosen. Doing this binds the association aspect of the EOTextFieldController widget (rating) with the <code>rating</code> method, which you’ll define in a few steps.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF120" title="Figure 6-8Change the widget type to make the association."></a><p><strong>Figure 6-8&nbsp;&nbsp;</strong>Change the widget type to make the association.</p><img src = "../Art/formatratinginform.gif" alt = "Change the widget type to make the association." width="458" height="468"></div></li><li class="li"><p>Since the rating is calculated on the server side, the text field should be marked as not editable by the user. So, while in the Widgets pane, select Never in the Editability pop-up menu.</p></li><li class="li"><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_242"></a>Finally, you should apply a number formatter to the widget so the number displayed is more meaningful. Change the Format Class field to read <code>com.webobjects.foundation.NSNumberFormatter</code>. Formatters need a pattern, and since the rating is a decimal number, the Format Pattern field should be <code>#,##0.00</code> as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF120">Figure 6-8</a></span>. See the API reference documentation for NSNumberFormatter for more information on format patterns.</p></li><li class="li"><p>Since the rating also appears as a column in list views, switch the task to list and set the format options for the EOTableColumnController as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-BCIGGGFF">Figure 6-9</a></span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIGGGFF" title="Figure 6-9Change formatter for property in list view"></a><p><strong>Figure 6-9&nbsp;&nbsp;</strong>Change formatter for property in list view</p><img src = "../Art/formatratinginlist.gif" alt = "Change formatter for property in list view" width="460" height="465"></div></li><li class="li"><p>Save changes and quit the client and server applications.</p></li></ol><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF110" title="Add Custom Code"></a><h3>Add Custom Code</h3><p>You now need to add a method for the new property you added in Assistant. The new <code>rating</code> attribute in the Student entity is designed to aggregate ACT and SAT scores and GPAs into a numeric rating based on how each of those attributes is weighted. You need to add a method to perform the calculation, a method to invoke the calculation, and class constants to define the weighting.</p><p>The algorithm used to calculate the rating is “sensitive” business logic, so it should exist only on the server side. The client business logic class simply invokes the concrete implementations of the rating methods on the server side.</p><p>Add these class constants to the server-side <code>Student.java</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>private static final double ACT_WEIGHT = 0.30;<span></span></pre></td></tr><tr><td scope="row"><pre>private static final double SAT_WEIGHT = 0.30;<span></span></pre></td></tr><tr><td scope="row"><pre>private static final double GPA_WEIGHT = 0.40;<span></span></pre></td></tr></table></div><p>Add this method to the server-side <code>Student.java</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>public Number rating() {<span></span></pre></td></tr><tr><td scope="row"><pre>    float aggregate = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    float satTemp;<span></span></pre></td></tr><tr><td scope="row"><pre>    float actTemp;<span></span></pre></td></tr><tr><td scope="row"><pre>    float gpaTemp;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (sat() != null &amp;&amp; act() != null &amp;&amp; gpa() !=null) {<span></span></pre></td></tr><tr><td scope="row"><pre>        satTemp = sat().floatValue() / 1600;<span></span></pre></td></tr><tr><td scope="row"><pre>        actTemp = act().floatValue() / 36;<span></span></pre></td></tr><tr><td scope="row"><pre>        gpaTemp = gpa().floatValue() / 4;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        aggregate = (float)(((gpaTemp * GPA_WEIGHT) + (actTemp * ACT_WEIGHT)            + (satTemp * SAT_WEIGHT)) * 10);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return (new Float(aggregate));<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div><p>Add a method called <code>clientSideRequestRating</code> in the server-side <code>Student.java</code> file that invokes the <code>rating</code> method, as shown:</p><div class="codesample"><table><tr><td scope="row"><pre>public Number clientSideRequestRating() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return rating();<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Add this code to client-side <code>Student.java</code> file to invoke the remote method:</p><div class="codesample"><table><tr><td scope="row"><pre> public Number rating() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (Number)(invokeRemoteMethod("clientSideRequestRating", null,<span></span></pre></td></tr><tr><td scope="row"><pre>              null));<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div><p>In the last section, you bound the association aspect of the EOTextFieldController (rating) to a method called <code>rating</code> in the client-side business logic class. You’ve just defined this method, so now whenever the rating property needs a value, the <code>rating</code> method is invoked. It’s that easy—Java Client handles all the communication between the business logic and the user interface for you.</p><p>There is more going on behind the scenes, though. The <code>rating</code> in the client-side business logic class invokes a remote method called <code>clientSideRequestRating</code> in the server-side business logic class. This method in turn invokes a method called <code>rating</code>, which actually performs the calculation. </p><p>Rebuild and run the application. Make a new student record and see how the rating field is populated upon saving as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF128">Figure 6-10</a></span>. That figure is shown with a layout hint of Row (see <span class="content_text"><a href="../InsideAssistant/InsideAssistant.html#//apple_ref/doc/uid/TP30001017-CH301-TPXREF46">“Widgets Pane”</a></span> for more information).</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_69" title="Note"></a><p><strong>Note:</strong>&nbsp;Whenever <code>rating</code> is requested, a round trip to the server is made to perform the remote method invocation. To lessen network traffic, you should consider caching the value in the client-side enterprise object.</p></div><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF128" title="Figure 6-10The rating field in action"></a><p><strong>Figure 6-10&nbsp;&nbsp;</strong>The rating field in action</p><img src = "../Art/ratinginaction.gif" alt = "The rating field in action" width="245" height="330"></div><br/><p>To learn how to implement continuous change notification for the rating field, see <span class="content_text"><a href="../T5CommonCustRules/T5CommonCustRules.html#//apple_ref/doc/uid/TP30001017-CH312-BABFABFC">“Continuous Change Notification.”</a></span></p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF122" title="Validation"></a><h4>Validation</h4><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_243"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_244"></a><p>WebObjects provides some useful classes and methods to validate user input. You should validate the entered data for each of the three score fields. To do this, add the following code in the server-side <code>Student.java</code> class:</p><div class="codesample"><table><tr><td scope="row"><pre>public Number validateSat(Number score) throws NSValidation.ValidationException {<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((score.intValue() > 1600) || (score.intValue() &lt; 0)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        throw new NSValidation.ValidationException("Invalid SAT score");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return score;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public Number validateAct(Number score) throws NSValidation.ValidationException {<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((score.intValue() > 36) || (score.intValue() &lt; 0)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        throw new NSValidation.ValidationException("Invalid ACT score");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return score;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public Number validateGpa(Number score) throws NSValidation.ValidationException {<span></span></pre></td></tr><tr><td scope="row"><pre>    if ((score.floatValue() > 4.0) || (score.floatValue() &lt; 0.0)) {<span></span></pre></td></tr><tr><td scope="row"><pre>        throw new NSValidation.ValidationException("Invalid GPA");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else<span></span></pre></td></tr><tr><td scope="row"><pre>        return score;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>The code you added is rather trivial, but it demonstrates a particularly powerful feature of WebObjects—validation. The NSValidation class in the Foundation framework provides this functionality. By throwing a <code>NSValidation.ValidationException</code>, a method tells Enterprise Objects that the current object graph is not cleared to be saved to the database. </p><p>In this case, if one of the attributes fails to validate, the object graph is not cleared by NSValidation and the current record won’t be committed to the data store until a valid value is entered.</p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_245"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_246"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_247"></a>You were instructed to put all the validation methods in the server-side business logic class, but this is not necessary. In fact, it often makes more sense to validate some values on the client. This reduces network traffic (there is no round-trip to the server to perform the validation) and increases overall application performance. Experiment with this by moving one of the validation methods to the client-side business logic class.</p><p>Validation methods are of the form <code>validate</code><em>Attribute</em>. In this example, be sure that <code>validateGpa</code> is capitalized correctly—<code>validateGPA</code> will not invoke validation on the <code>gpa</code> attribute.</p><p>If you write validation methods, they are invoked in the framework by various classes and interfaces such as EOValidation, EODisplayGroup, and EOEditingContext. Validation is performed for these activities:</p><ul class="spaceabove"><li class="li"><p>updating the client-side distribution context (<code>validateForUpdate</code>)</p></li><li class="li"><p>saving to the database (<code>validateForSave</code>)</p></li><li class="li"><p>deleting from the database (<code>validateForDelete</code>)</p></li><li class="li"><p>inserting a new record (<code>validateForInsert</code>)</p></li><li class="li"><p>updating the server-side database context (<code>validateForUpdate</code>)</p></li></ul><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF123" title="Initial Values"></a><h4>Initial Values</h4><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_248"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_249"></a><p>When you create a new record, you might want to supply some default values for the fields in that record. Although none of the fields in the Student record really need a default value, you’ll override <code>awakeFromInsertion</code> in order to learn how to give a field a default value.</p><p>Add this code in the server-side <code>Student.java</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>public void awakeFromInsertion(EOEditingContext context) {<span></span></pre></td></tr><tr><td scope="row"><pre>        super.awakeFromInsertion(context);<span></span></pre></td></tr><tr><td scope="row"><pre>        if (gpa() == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            setGpa(new BigDecimal("0"));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        if (sat() == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            setSat(new BigDecimal("0"));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        if (act() == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            setAct(new BigDecimal("0"));<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        if (name() == null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            setName("");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div><p>Build and run the application and create a new student record. You’ll notice that some of the fields are populated in the new record as shown in <span class="content_text">Figure 6-11</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF124" title="Figure 6-11Initial values"></a><p><strong>Figure 6-11&nbsp;&nbsp;</strong>Initial values</p><img src = "../Art/initialvalues.gif" alt = "Initial values" width="244" height="327"></div><br/><p>Also try entering some invalid data to see how the validation you implemented works. If you enter an invalid score<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_250"></a>, you should get a validation exception message when saving, as shown in <span class="content_text">Figure 6-12</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF125" title="Figure 6-12Validation exception message"></a><p><strong>Figure 6-12&nbsp;&nbsp;</strong>Validation exception message</p><img src = "../Art/validationexception.gif" alt = "Validation exception message" width="259" height="313"></div><br/><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF19" title="Controller Hierarchy"></a><h2>Controller Hierarchy</h2><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_251"></a><p>Before you learn more about customizing Direct to Java Client applications, you should know what’s going on behind the scenes.</p><p>In nondirect Java Client applications, user interfaces are stored in Interface Builder nib files. In Direct to Java Client applications, user interfaces are dynamically generated by the EOGeneration<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_252"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_253"></a> layer, which produces XML descriptions of the controllers in a user interface. Each user interface element in a Direct to Java Client application is managed by a controller. Multiple controllers are organized in a controller hierarchy, which defines the complete functionality of the application.</p><p>There is an application-wide controller hierarchy with an EOApplication object at its root. Each window or modal dialog in an application is defined by a more granular controller hierarchy. The controller hierarchies for windows or modal dialogs are referred to as the application’s subcontrollers. Window controllers and modal dialog controllers have subcontrollers of their own such as text fields, table views, and checkboxes.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF20" title="Controllers"></a><h3>Controllers</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_254"></a><p>The objects in the controller hierarchy are instances of EOController subclasses. The EOController class defines basic controller behavior. Collectively, controllers are responsible for managing the controller hierarchy (which includes building, connecting, and traversing the hierarchy) and handling actions. Controllers define and know how to respond to the actions users can perform.</p><p>Fundamentally, controllers are your best friend. They save you from writing raw Swing or from needing to maintain user interfaces in Java. They allow you to define user interfaces in XML descriptions with a common set of tags that are mapped into Swing-specific user interface elements and characteristics. Controllers also save you from needing to interact with Enterprise Objects programmatically. They automatically construct qualifiers and fetch specifications, fetch data into editing contexts, and in general take care of all the heavy lifting required in an application that uses Enterprise Objects.</p><p>The EOController subclasses fall into the following categories:</p><ul class="spaceabove"><li class="li"><p><strong>Application-level controllers<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_255"></a></strong> define application-level functionality. They define actions such as Quit and Save. Additionally they provide document management support such as tracking documents with unsaved changes. An application-level controller (such as <code>EOApplication</code> or <code>EODynamicApplication</code>) is the root of an application’s controller hierarchy.</p></li><li class="li"><p><strong>User interface–level controllers<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_256"></a></strong> manage portions of an application’s user interface, such as windows (<code>EOWindowController</code>) and tab views (<code>EOTabViewController</code>). They determine the layout of their subcontrollers, resizing behavior, and so on.</p></li><li class="li"><p><strong>Entity-level controllers<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_257"></a></strong> specify the user interface for performing a particular task on an entity. Entity-level controllers determine the functionality for querying, listing, and editing objects. They include <code>EOQueryController</code> and <code>EOListController</code>.</p></li><li class="li"><p><strong>Property-level controllers<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_258"></a></strong> manage widgets for displaying properties. They provide widgets for entering text, displaying properties in a table, and so on. They include <code>EOTextFieldController</code> and <code>EOTableColumnController</code>.</p></li></ul><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF21" title="Creating the Controller Hierarchy"></a><h3>Creating the Controller Hierarchy</h3><p>The process for creating the controller hierarchy involves a <code>com.webobjects.eogeneration.EOControllerFactory</code> object, an application object, the rule system, and D2WComponent objects.</p><p>In a Direct to Java Client application, the client-side application object (<code>com.webobjects.eogeneration.EODynamicApplication</code> or a subclass of it) initializes the controller factory object. The controller factory, which lives on the client side, makes a request to the rule system on the server side for a particular controller or controller hierarchy. The rule system analyzes the application’s data models (<code>.eomodeld</code> files) and rule models (<code>.d2wmodel</code> files) and generates an XML description of the controller or controller hierarchy that the controller factory requested.</p><p>The rule system then sends the XML descriptions it generated back to the controller factory. The controller factory then builds a user interface based on the XML descriptions it receives (it parses the XML using a <code>com.webobjects.eoapplication.EOXMLUnarchiver</code> object) . </p><p>The EOXMLUnarchiver maps XML tags to EOController classes, as illustrated in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF30">Table 6-2</a></span>.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF30" title="Table 6-2A subset of the controllers available in Direct to Java Client "></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 6-2&nbsp;&nbsp;</strong>A subset of the controllers available in Direct to Java Client </caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>XML tag</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Controller class</p></th></tr><tr><td  scope="row"><p><code>MODALDIALOGCONTROLLER</code></p></td><td ><p>EOModalDialogController</p></td></tr><tr><td  scope="row"><p><code>ACTIONBUTTONSCONTROLLER</code></p></td><td ><p>EOActionButtonsController</p></td></tr><tr><td  scope="row"><p><code>QUERYCONTROLLER</code></p></td><td ><p>EOQueryController</p></td></tr><tr><td  scope="row"><p><code>TEXTFIELDCONTROLLER</code></p></td><td ><p>EOTextFieldController</p></td></tr><tr><td  scope="row"><p><code>LISTCONTROLLER</code></p></td><td ><p>EOListController</p></td></tr><tr><td  scope="row"><p><code>TABLECONTROLLER</code></p></td><td ><p>EOTableController</p></td></tr><tr><td  scope="row"><p><code>TABLECOLUMNCONTROLLER</code></p></td><td ><p>EOTableColumnController</p></td></tr></table></div><p>As an XML unarchiver creates the controller hierarchy, it configures the controllers according to the specified XML attribute values. For example, two of the XML attributes for EOTextField are <code>valueKey</code> and <code>isQueryWidget</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;TEXTFIELDCONTROLLER valueKey="name" isQueryWidget="true"/><span></span></pre></td></tr></table></div><p>These attributes correspond to the EOTextField methods <code>setValueKey</code> and <code>setIsQueryWidget</code>. The <code>valueKey="name"</code> attribute specifies that the text field controller corresponds to a property named “name.” The <code>isQueryWidget="true"</code> attribute specifies that the text field is used to get search criteria from the user and is not to display and edit a property’s value.</p><p>As users interact with the user interface, they may perform actions that require additional controllers. These requests are sent to the controller factory which communicates with the rule system on the server side, generates XML descriptions of controllers, and sends them back to the client.</p><p>For more information on the XML tags and attributes for controller classes<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_259"></a>, see <span class="content_text"><a href="../Appendix_A/XMLDescriptions.html#//apple_ref/doc/uid/TP30001017-CH323-TP1">“Controllers and Actions Reference.”</a></span></p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF135" title="Using Rules in the Rule System "></a><h2>Using Rules in the Rule System </h2><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_260"></a><p>As well as understanding the role of controllers in Direct to Java Client applications, you need to know a bit more about the rule system. The default rule system in Direct to Java Client applications includes over one hundred rules. You can customize these rules and write new rules, too. So you need to know both how to leverage the default rules in your application and how to write custom rules.</p><p>Every Java Client class that can exist as part of an XML description for Direct to Java Client user interfaces includes XML identifiers. These identifiers come in the form of a single XML tag and one or more XML attributes. </p><p>For instance, EOComponentController’s XML tag is <code>COMPONENTCONTROLLER</code>, and its XML attributes include <code>alignmentWidth</code>, <code>iconName</code>, and <code>verticallyResizable</code>. This book includes a complete list of Java Client classes that have XML tags and XML attributes in <span class="content_text"><a href="../Appendix_A/XMLDescriptions.html#//apple_ref/doc/uid/TP30001017-CH323-TP1">“Controllers and Actions Reference.”</a></span></p><p>For example, when using a Direct to Java Client application, you may want to change the behavior of the query window. It’s not uncommon to want to query for all records in a particular entity, and the dialog asking if you want to search for all records can become repetitive. To see if the query window has any options for controlling its behavior, you’d first consult its XML attributes as found in <span class="content_text"><a href="../Appendix_A/XMLDescriptions.html#//apple_ref/doc/uid/TP30001017-CH323-TP1">“Controllers and Actions Reference.”</a></span></p><p><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_261"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_262"></a>You’d find that the EOQueryController class includes an XML attribute called <code>runsConfirmDialogForEmptyQualifiers</code>. This attribute controls the confirmation dialog when you click Find in a query window without qualifying the search criteria. <code>runsConfirmDialogForEmptyQualifiers</code> is a Boolean attribute, so setting it to <code>false</code> disables the confirmation dialog. </p><p>You add this rule to your application’s <code>d2w.d2wmodel</code> file using Rule Editor<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_263"></a>. You add the <code>d2w.d2wmodel</code> file to a project by making a new file of type “Empty File,” naming it <code>d2w.d2wmodel</code> and associating it with the Application Server target. </p><p>Open your application’s <code>d2w.d2wmodel</code> file and add a rule with these attributes:</p><dl class="table-display"><dt>Left-Hand Side:</dt><dd><code>*true*</code></dd><dt>Key:</dt><dd><code>runsConfirmDialogForEmptyQualifiers</code></dd><dt>Value:</dt><dd><code>"false"</code></dd><dt>Priority:</dt><dd><code>50</code></dd></dl><p class="clear"></p><p>In this case, you don’t need to specify the qualifier since only one controller has the <code>runsConfirmDialogForEmptyQualifiers</code> value. If you want to disable the confirmation dialog just for a specific entity, you can add this argument to the left-hand side: <code>entity.name="&lt;entityName>"</code>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_70" title="Note"></a><p><strong>Note:</strong>&nbsp;Be careful about using this rule without specifying an entity. The confirmation dialog is intended to avoid unqualified fetches on entities with a large number of records. Disabling the confirmation dialog for all entities in an application runs the risk of severely degrading both your database’s performance and your application’s usability as users are more likely to invoke unqualified searches.</p></div><p>See <span class="content_text"><a href="../InsideTheRuleSystem/InsideTheRuleSystem.html#//apple_ref/doc/uid/TP30001017-CH306-TP1">“Inside the Rule System”</a></span> for an explanation of rule priorities and for more general information on the rule system. Also see <span class="content_text"><a href="../T5CommonCustRules/T5CommonCustRules.html#//apple_ref/doc/uid/TP30001017-CH312-TP1">“Common Rules”</a></span> for examples of custom rules.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF22" title="Additional Actions"></a><h2>Additional Actions</h2><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_264"></a><p>Adding actions to Direct to Java Client applications is rather easy. There are four recommended procedures:</p><ul class="ul"><li class="li"><p>Use Assistant to specify a new property with an EOActionController widget (for actions on enterprise objects; the action method is in a client-side business logic class).</p></li><li class="li"><p>Subclass a controller class and write a rule to use it in the application (the action method is in the subclass).</p></li><li class="li"><p>Write a custom controller class and include it in an XML description (for actions on user interface; the action method is in the custom controller class).</p></li><li class="li"><p>Edit XML by hand to include an EOActionController with an <code>actionKey</code> tag specifying the action method (for actions on enterprise objects; the action method is in the client-side business logic).</p></li></ul><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF136" title="Write the Action (Build a WOComponent)"></a><h3>Write the Action (Build a WOComponent)</h3><p>Before you take steps to customize the application to invoke a new action, you need to write the code for the action. The action you’ll add here sends the contents of a Student record to a specified email address. The code that constructs the email exists in your application’s <code>Session.java</code> class. Rather than send a plain text email, the email sent is a WebObjects component email. This means that you can use a dynamic WOComponent object to populate the contents of the email.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_71" title="Note"></a><p><strong>Note:</strong>&nbsp;You’ll better understand this part of the tutorial if you’re familiar with the concepts involved in an HTML WebObjects application. The book <em><a href="../../Web_Applications/index.html#//apple_ref/doc/uid/TP30001010" target="_top">WebObjects Web Applications Programming Guide</a></em> is a great place to start learning.</p></div><p>Follow these steps to make the new WOComponent:</p><ol class="ol"><li class="li"><p>Make a new WOComponent in Project Builder. Choose New File from the File menu and select Component from the WebObjects list. Name the component <code>Report</code> and add it the Application Server target.</p></li><li class="li"><p>Open the component in WebObjects Builder<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_265"></a> and add a new key called <code>student</code> of type <code>Student</code>, as shown in <span class="content_text">Figure 6-13</span>. Follow these steps:</p><ul class="ul"><li class="li"><p>Double-click <code>Report.wo</code> in Project Builder to open it in WebObjects Builder.</p></li><li class="li"><p>Choose Add Key from the Edit Source pop-up menu at the bottom of the window.</p></li></ul><p>Select the options to generate source code for an instance variable and a method setting the value.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHHGFJG" title="Figure 6-13New key of type Student in the Report component"></a><p><strong>Figure 6-13&nbsp;&nbsp;</strong>New key of type Student in the Report component</p><img src = "../Art/wobstudentkey.gif" alt = "New key of type Student in the Report component" width="265" height="297"></div></li><li class="li"><p>Add another new key called <code>activity</code> of type <code>Activity</code>, as shown in <span class="content_text">Figure 6-14</span>. Select the option to generate source code for an instance variable.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHHFEJA" title="Figure 6-14New key of type Activity in the Report component"></a><p><strong>Figure 6-14&nbsp;&nbsp;</strong>New key of type Activity in the Report component</p><img src = "../Art/activitykey.gif" alt = "New key of type Activity in the Report component" width="279" height="317"></div></li><li class="li"><p>Add dynamic elements for Student’s attributes. Add WOStrings for the <code>gpa</code>, <code>act</code>, <code>sat</code>, and <code>name</code> attributes as shown in <span class="content_text">Figure 6-15</span>. They are shown here in a table, but that is optional.</p><ul class="ul"><li class="li"><p>Choose WOString from the WebObjects menu.</p></li><li class="li"><p>Drag from an attribute in the student key (such as <code>student.name</code>) to the center of the WOString element to bind the attribute to the element’s <code>value</code> binding.</p></li><li class="li"><p>Repeat for all four elements.</p></li></ul><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHFJFHJ" title="Figure 6-15Dynamic elements for Student&acirc;&#128;&#153;s attributes"></a><p><strong>Figure 6-15&nbsp;&nbsp;</strong>Dynamic elements for Student’s attributes</p><img src = "../Art/studentinwob.gif" alt = "Dynamic elements for Student’s attributes" width="157" height="83"></div></li><li class="li"><p>Add dynamic elements for Student’s <code>activities</code> relationship. Add a WORepetition with <code>list = student.activities</code> and <code>item = activity</code>. Add WOStrings for <code>activity.name</code>, <code>activity.achievements</code>, and <code>activities.since</code> as shown in <span class="content_text">Figure 6-16</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHHJBJG" title="Figure 6-16WORepetition for Student&acirc;&#128;&#153;s activities"></a><p><strong>Figure 6-16&nbsp;&nbsp;</strong>WORepetition for Student’s activities</p><img src = "../Art/activitydynelements.gif" alt = "WORepetition for Student’s activities" width="216" height="80"></div></li><li class="li"><p>Add this method to <code>Session.java</code> to compose and send the message:</p><div class="codesample"><table><tr><td scope="row"><pre>public void clientSideRequestSendRecordViaEmail(EOEnterpriseObject record) {<span></span></pre></td></tr><tr><td scope="row"><pre>        String messageSubject, messageBody, message;<span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableArray recipients = new NSMutableArray();<span></span></pre></td></tr><tr><td scope="row"><pre>        recipients.addObject("person@foo.com");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Report report = new Report(context());<span></span></pre></td></tr><tr><td scope="row"><pre>        report.setStudent(record);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        messageSubject = "Student report for " + record.valueForKey("name");<span></span></pre></td></tr><tr><td scope="row"><pre>         message =               WOMailDelivery.sharedInstance().composeComponentEmail("sender@foo.com",               recipients, null, messageSubject, report, true);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>This method uses the <code>com.webobjects.appserver.WOMailDelivery</code> class to send an email message containing information from a student record. You’ll notice that the method is named <code>clientSideRequestSendRecordViaEmail</code> to conform to the default rules for remote method invocation.</p></li><li class="li"><p><em>This step is necessary only in WebObjects 5.0.x and 5.1.x.</em> Since the email is sent via remote method invocation, you need to provide a distribution layer delegate method in <code>Session.java</code> to allow the invocation. When the distribution layer starts up, it sets its delegate to the Session object, which allows you to override the methods defined in the EODistributionContext.Delegate class. </p><p>In <code>Session.java</code>, add an import statement for the <code>com.webobjects.eodistribution</code> package and then add the distribution layer delegate method:</p><div class="codesample"><table><tr><td scope="row"><pre>public boolean distributionContextShouldFollowKeyPath(EODistributionContext                   distributionContext, String path) {<span></span></pre></td></tr><tr><td scope="row"><pre>        return (path.equals("session"));<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	</li><li class="li"><p>You need to add a launch argument<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_266"></a> to the application representing the email server through which to send the message. Add <code>-WOSMTPHost</code> to your launch arguments with the name of a mail server on your network, as shown in <span class="content_text">Figure 6-17</span>. Refer to <span class="content_text"><a href="../BasicTutorial/BasicTutorial.html#//apple_ref/doc/uid/TP30001017-CH300-TPXREF23">“Add a Launch Argument”</a></span> if you’ve forgotten how to add a launch argument.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHFGDGJ" title="Figure 6-17Add launch argument for SMTP host"></a><p><strong>Figure 6-17&nbsp;&nbsp;</strong>Add launch argument for SMTP host</p><img src = "../Art/smtphostlauncharg.gif" alt = "Add launch argument for SMTP host" width="585" height="79"></div></li></ol><p>You can now add custom actions to invoke the email composition. How the <code>clientSideRequestSendRecordViaEmail</code> method in <code>Session.java</code> is invoked depends on how you add the custom action. The following four sections describe the possibilities, in order of recommendation.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF23" title="Use Assistant"></a><h3>Use Assistant</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_267"></a><p>Using Assistant is the easiest, fastest, but least flexible way to add an action to an application. Follow these steps:</p><ol class="ol"><li class="li"><p>Build and run the Admissions application and open Assistant.</p></li><li class="li"><p>Switch to the Properties pane and choose Question > window, Task > Form, and Entity > Student. Add a new property key called <code>sendRecordViaEmail</code> for Question=window, Task=form, Entity=Student. Do this using the Additional Property Key Path field. See <span class="content_text">Figure 6-18</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF131" title="Figure 6-18Add property key for new action"></a><p><strong>Figure 6-18&nbsp;&nbsp;</strong>Add property key for new action</p><img src = "../Art/addactionkey.gif" alt = "Add property key for new action" width="460" height="465"></div></li><li class="li"><p>Switch to the Widgets pane, choose Task > form, Entity > Student, and Property key > sendRecordViaEmail. In the Widget Type pop-up menu, choose EOActionController as shown in <span class="content_text">Figure 6-19</span>.</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF132" title="Figure 6-19Change the widget type of the new property key"></a><p><strong>Figure 6-19&nbsp;&nbsp;</strong>Change the widget type of the new property key</p><img src = "../Art/makeaction.gif" alt = "Change the widget type of the new property key" width="466" height="464"></div></li><li class="li"><p>Save the changes and restart the client application from Assistant and you’ll see a new button called Send Record Via Email in form windows for the Student entity as shown in <span class="content_text">Figure 6-20</span>. Since it’s an EOActionController defined in the Student entity, it invokes a method of the same name, <code>sendRecordViaEmail</code>, in the client-side business logic class for that entity (<code>businesslogic.client.Student</code> in this case).</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF126" title="Figure 6-20The new property key as an EOActionController"></a><p><strong>Figure 6-20&nbsp;&nbsp;</strong>The new property key as an EOActionController</p><img src = "../Art/actionviaassistant.gif" alt = "The new property key as an EOActionController" width="418" height="302"></div></li></ol><p>Make a new student record or open an existing record and click the new button. If you started the client application from the command line, you see an <code>IllegalArugmentException</code> is thrown, stating that the method <code>sendRecordViaEmail</code> can’t be found. (In Mac OS X, client applications started automatically by the <code>WOAutoOpenClientApplication</code> mechanism send exceptions to the console.) So, you need to add it to your client-side business logic class.</p><p>Add this method in the client-side <code>Student.java</code> file:</p><div class="codesample"><table><tr><td scope="row"><pre>public void sendRecordViaEmail() {<span></span></pre></td></tr><tr><td scope="row"><pre>        _distributedObjectStore().invokeRemoteMethodWithKeyPath(new<span></span></pre></td></tr><tr><td scope="row"><pre>           EOEditingContext(), "session", "clientSideRequestSendRecordViaEmail", new<span></span></pre></td></tr><tr><td scope="row"><pre>           Class[] {EOEnterpriseObject.class}, new Object[] {this}, true);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>This method invokes the method you added to your <code>Session.java</code> class. It sends the enterprise object from which the action originated (the <code>this</code> parameter) and pushes the state of the client-side editing context to the server-side editing context (the <code>true</code> parameter). See the API reference documentation for <code>invokeRemoteMethodWithKeyPath</code><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_268"></a> for detailed descriptions of each parameter.</p><p>In the code<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_269"></a> listing above, you’ll notice that the remote method invocation is made on an object returned from the method <code>_distributedObjectStore()</code>. You need to add this method to the client-side <code>Student.java</code> class:</p><div class="codesample"><table><tr><td scope="row"><pre>private EODistributedObjectStore _distributedObjectStore() {<span></span></pre></td></tr><tr><td scope="row"><pre>        EOObjectStore objectStore = EOEditingContext.defaultParentObjectStore();<span></span></pre></td></tr><tr><td scope="row"><pre>        if ((objectStore == null) || (!(objectStore instanceof EODistributedObjectStore)))<span></span></pre></td></tr><tr><td scope="row"><pre>       {<span></span></pre></td></tr><tr><td scope="row"><pre>         throw new IllegalStateException("Default parent object store needs to be an<span></span></pre></td></tr><tr><td scope="row"><pre>              EODistributedObjectStore");<span></span></pre></td></tr><tr><td scope="row"><pre>      }<span></span></pre></td></tr><tr><td scope="row"><pre>        return (EODistributedObjectStore)objectStore;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Client-side remote methods that are not invoked on business logic classes (on subclasses of EOCustomObject) are invoked on the client’s distributed object store. For instance, in an EOGenericRecord subclass, you can use the method <code>invokeRemoteMethod</code>(<code>String</code><em>methodName</em>, <code>Class[]</code><em>argumentTypes</em>, <code>Object[]</code><em>arguments</em>), which invokes a method named <em>methodName</em> in the server-side EOGenericRecord subclass of the same name.</p><p>But, if you want to invoke a remote method that is not in the server-side business logic class corresponding to the client-side business logic class from where the remote method invocation originates, you need to invoke the remote method on the client’s distributed object store, as the example above shows.</p><p>See the WebObjects API reference documentation for the <code>com.webobjects.eodistribution.client</code> package for more information on the distributed object store and the different varieties of remote method invocations. Also see <span class="content_text"><a href="../DistributionLayer/DistributionLayer.html#//apple_ref/doc/uid/TP30001017-CH302-TP1">“The Distribution Layer”</a></span>for an introduction to the distribution layer and remote method invocation.</p><p>Next, you need to add the import statement for the client-side EODistribution layer to the <code>Student.java</code> class:</p><div class="codesample"><table><tr><td scope="row"><pre>import com.webobjects.eodistribution.client.*;<span></span></pre></td></tr></table></div><p>Build and run the application, open a Student record, and click the Send Record Via Email button. If you added your email address to the recipients in the code you added to <code>Session.java</code>, you should see an email in your inbox with the information in the selected record.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF137" title="Extend a Controller Class"></a><h3>Extend a Controller Class</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_270"></a><p>Using Assistant to add an action may not provide you with the flexibility you need. Furthermore, the methods you added in the last section are not really appropriate in business logic classes. They are better suited to a dedicated controller class.</p><p>Extending a controller class and writing a rule to use it is the best way to provide custom actions in your application. It is much more flexible than just using Assistant and it’s much better than the next two options, which both require freezing XML. Anytime you freeze XML, you lose a lot of the dynamism of the rule system. This means, for instance, that you are not as able to use the rule system to localize your application or provide access controls via rules. Also, subclassing controller classes doesn’t incur the costs associated with writing completely custom controllers. </p><p>The dynamically generated user interfaces in Java Client rely on a core set of classes: EOFormController, EOQueryController, and EOListController. You can take real advantage of WebObjects’ excellent object-oriented design to extend these classes to provide custom behavior.</p><p>Add a new file to your application called <code>CustomFormController.java</code>. Add it to the Web Server target. Copy and paste the code for it, shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-TPXREF139">Listing 6-1</a></span>.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF139" title="Listing 6-1CustomFormController code"></a><p class="codesample"><strong>Listing 6-1&nbsp;&nbsp;</strong>CustomFormController code</p><div class="codesample"><table><tr><td scope="row"><pre>package admissions.client;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import javax.swing.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.awt.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eointerface.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eoapplication.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eogeneration.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eodistribution.client.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class CustomFormController extends EOFormController {<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public CustomFormController(EOXMLUnarchiver unarchiver) {<span></span></pre></td></tr><tr><td scope="row"><pre>        super(unarchiver);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    protected NSArray defaultActions() {<span></span></pre></td></tr><tr><td scope="row"><pre>        Icon icon = EOUserInterfaceParameters.localizedIcon("ActionIconOk");<span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableArray actions = new NSMutableArray();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        actions.addObject(EOAction.actionForControllerHierarchy("sendRecordViaEmail",<span></span></pre></td></tr><tr><td scope="row"><pre>            "Send Record Via Email", "Send Record Via Email", icon, null, null, 300, 50,<span></span></pre></td></tr><tr><td scope="row"><pre>            false));<span></span></pre></td></tr><tr><td scope="row"><pre>        return EOAction.mergedActions(actions, super.defaultActions());<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public boolean canPerformActionNamed(String actionName) {<span></span></pre></td></tr><tr><td scope="row"><pre>        return actionName.equals("sendRecordViaEmail") ||<span></span></pre></td></tr><tr><td scope="row"><pre>                 super.canPerformActionNamed(actionName);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public void sendRecordViaEmail() {<span></span></pre></td></tr><tr><td scope="row"><pre>        _distributedObjectStore().invokeRemoteMethodWithKeyPath(new EOEditingContext(),<span></span></pre></td></tr><tr><td scope="row"><pre>         "session","clientSideRequestSendRecordViaEmail", new Class[]<span></span></pre></td></tr><tr><td scope="row"><pre>         {EOEnterpriseObject.class}, new Object[] { selectedObject()}, true);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    private EODistributedObjectStore _distributedObjectStore() {<span></span></pre></td></tr><tr><td scope="row"><pre>        EOObjectStore objectStore = EOEditingContext.defaultParentObjectStore();<span></span></pre></td></tr><tr><td scope="row"><pre>        if ((objectStore == null) || (!(objectStore instanceof EODistributedObjectStore)))<span></span></pre></td></tr><tr><td scope="row"><pre>         {<span></span></pre></td></tr><tr><td scope="row"><pre>            throw new IllegalStateException("Default parent object store needs to be an<span></span></pre></td></tr><tr><td scope="row"><pre>              EODistributedObjectStore");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return (EODistributedObjectStore)objectStore;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>When you examine this code, you’ll notice that two of its methods are those you added in the last section. So you can remove both <code>sendRecordViaEmail</code> and <code>_distributedObjectStore</code> from the client-side <code>Student.java</code> class. The <code>defaultActions</code> method adds to the application’s actions and <code>canPerformActionNamed</code> authorizes the invocation of the <code>sendRecordViaEmail</code> method. </p><p>To use this class in form windows for the Student entity, you need to add a rule to the project’s <code>d2w.d2wmodel</code> file:</p><dl class="table-display"><dt>Left-Hand Side:</dt><dd><code> ((task='form') and (controllerType='entityController') and (entity.name='Student'))</code></dd><dt>Key:</dt><dd><code>className</code></dd><dt>Value:</dt><dd><code>"admissions.client.CustomFormController"</code></dd><dt>Priority:</dt><dd><code>50</code></dd></dl><p class="clear"></p><p>You add the <code>d2w.d2wmodel</code> file to a project by making a new file of type “Empty File,” naming it <code>d2w.d2wmodel</code>, and associating it with the Application Server target. Control-click the file after adding it to the project to display its contextual menu. Choose “Open with Finder” to open the file in Rule Editor<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_271"></a>. Then add the rule shown above.</p><p>Build and run the application and remove the action you added with Assistant (you can either go to the Direct to Java Client Assistant and move the action to the Other Property Keys list or find the rule in the <code>user.d2wmodel</code> file and delete it by hand). If successful, form windows for the Student entity should look like <span class="content_text">Figure 6-21</span>.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-CIHIHIJI" title="Figure 6-21Image form window with new buttons"></a><p><strong>Figure 6-21&nbsp;&nbsp;</strong>Image form window with new buttons</p><img src = "../Art/customactionwithcontroller.gif" alt = "Image form window with new buttons" width="348" height="328"></div><br/><p>Clicking the Send Record Via Email button should send an email with the current record’s information to the recipients you declared in the method in <code>Session.java</code>, which constructs and sends the email.</p><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF129" title="Additional Exercise"></a><h3>Additional Exercise</h3><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_272"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_273"></a><p>For the custom action that sends a record via email, you may find that hard-coding the email recipients is not ideal. Rather, you might want the flexibility of choosing the recipients on a per-record basis. By using the controller factory programmatically, this is actually quite simple.</p><p>First, following the Model-View-Controller paradigm<a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_274"></a>, you need to write a new class to display a dialog in which the user can select the email recipients. Although you could save writing a few lines of code by putting the controller factory invocation in the business logic class, this is bad design. Business logic classes (enterprise objects) should not include any user interface code. So, add a new client-side class called SelectEmail to your project :</p><div class="codesample"><table><tr><td scope="row"><pre>package admissions.client;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.foundation.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eocontrol.*;<span></span></pre></td></tr><tr><td scope="row"><pre>import com.webobjects.eogeneration.*;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>public class SelectEmail extends Object{<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public SelectEmail() {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    public NSArray selectEmailAddresses() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return           EOControllerFactory.sharedControllerFactory().selectWithEntityName          ("Email", true, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>The class is rather simple and contains a single method that invokes a method on the controller factory. This displays a selection dialog for the Email entity as shown in <span class="content_text"><a href="AdvancedTutorial.html#//apple_ref/doc/uid/TP30001017-CH303-BCIFDGAC">Figure 6-22</a></span>. </p><p>The second argument in the <code>selectWithEntityName</code> method (<code>true</code>) allows multiple selection in the select dialog so you can choose multiple email addresses. The method returns the objects that are selected in the selection dialog.</p><p>Before you see any email addresses in that dialog, however, you have to add an entity to your EOModel called “Email”, generate SQL for it, and add entries to it. Create a new entity and add to it two attributes:</p><ul class="spaceabove"><li class="li"><p><code>emailID</code>; column name <code>EMAIL_ID</code>; external type <code>int</code>; internal type <code>Integer</code>; mark as the primary key; don’t mark as either kind of class property</p></li><li class="li"><p><code>address</code>; column name <code>ADDRESS</code>; external type <code>char</code>; internal type <code>String</code>; mark as both a client-side and server-side class property</p></li></ul><p>When you generate SQL for the Email entity, select only Create Tables and Primary Key Constraints.</p><p>The Email entity is considered an Enumeration entity by the rule system, so you can add data to it by choosing Enumeration Window from the Tools menu in the client application.</p><p>Next, you need to modify the <code>sendRecordViaEmail</code> action method in <code>CustomFormController.java</code> as shown:</p><div class="codesample"><table><tr><td scope="row"><pre> public void sendRecordViaEmail() {<span></span></pre></td></tr><tr><td scope="row"><pre>        SelectEmail select = new SelectEmail();<span></span></pre></td></tr><tr><td scope="row"><pre>        NSArray globalIDs = select.selectEmailAddresses();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        _distributedObjectStore().invokeRemoteMethodWithKeyPath(new<span></span></pre></td></tr><tr><td scope="row"><pre>          EOEditingContext(),"session", "clientSideRequestSendRecordViaEmail", new<span></span></pre></td></tr><tr><td scope="row"><pre>          Class[] {EOEnterpriseObject.class, NSArray.class}, new Object[]<span></span></pre></td></tr><tr><td scope="row"><pre>          {selectedObject(), globalIDs}, true);<span></span></pre></td></tr><tr><td scope="row"><pre> }<span></span></pre></td></tr></table></div>	<p>These modifications to <code>CustomFormController.java</code> instantiate a new SelectEmail object and invoke the method to display the dialog that allows users to select the email addresses to send the current report to. </p><p>The remote method invocation now sends the selected email address (represented by the <code>globalIDs</code> object) and the report from which the <code>sendRecordViaEmail</code> action was invoked (represented by the objects returned from the <code>selectedObject()</code> method in the remote method invocation) to the method <code>clientSideRequestSendRecordViaEmail</code> in the <code>Session.java</code> class on the server.</p><p>Next, you need to modify the <code>clientSideRequestSendRecordViaEmail</code> method in the server-side <code>Session.java</code> class to accept the new <code>globalIDs</code> argument:</p><div class="codesample"><table><tr><td scope="row"><pre>public void clientSideRequestSendRecordViaEmail(EOEnterpriseObject record, NSArray                                                                       sendTo) {<span></span></pre></td></tr><tr><td scope="row"><pre>        String messageSubject, messageBody, message;<span></span></pre></td></tr><tr><td scope="row"><pre>        NSMutableArray recipients = new NSMutableArray();<span></span></pre></td></tr><tr><td scope="row"><pre>        //recipients.addObject("person@foo.com");<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        java.util.Enumeration e = sendTo.objectEnumerator();<span></span></pre></td></tr><tr><td scope="row"><pre>        while (e.hasMoreElements()) {<span></span></pre></td></tr><tr><td scope="row"><pre>            EOEnterpriseObject email =                defaultEditingContext().objectForGlobalID((EOGlobalID)e.nextElement());<span></span></pre></td></tr><tr><td scope="row"><pre>            String emailAddress = (String)email.valueForKey("email");<span></span></pre></td></tr><tr><td scope="row"><pre>            recipients.addObject(emailAddress);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        Report report = new Report(context());<span></span></pre></td></tr><tr><td scope="row"><pre>        report.setStudent(record);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        messageSubject = "Student report for " + record.valueForKey("name");<span></span></pre></td></tr><tr><td scope="row"><pre>        message =            WOMailDelivery.sharedInstance().composeComponentEmail("sender@foo.com",            recipients, null, messageSubject, report, true);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>	<p>Instead of statically setting the array recipients, the array is set dynamically to the email addresses passed in by the <code>sendTo</code> array.</p><p>Build and run the application. Open a student record and click Send Record Via Email. A dialog like that shown in <span class="content_text">Figure 6-22</span> should appear. Select some email addresses and click OK. Check your email to see if you are successful.</p><br/><div><a name="//apple_ref/doc/uid/TP30001017-CH303-BCIFDGAC" title="Figure 6-22Choose email recipients"></a><p><strong>Figure 6-22&nbsp;&nbsp;</strong>Choose email recipients</p><img src = "../Art/chooseemails.gif" alt = "Choose email recipients" width="374" height="316"></div><br/><a name="//apple_ref/doc/uid/TP30001017-CH303-TPXREF35" title="Debugging"></a><h2>Debugging</h2><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_275"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_276"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_277"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_278"></a><a name="//apple_ref/doc/uid/TP30001017-CH303-DontLinkElementID_279"></a><p>As you use more difficult customization techniques, you’ll need more debugging information. Direct to Java Client applications consist of much more than Java code. So, you need tools to help you debug the other main aspects: database access and the rule system. </p><p>You can see the SQL messages passed to the database by adding <code>-EOAdaptorDebugEnabled YES</code> to your launch arguments on the server application. By adding <code>-D2WTraceRuleFiringEnabled YES</code> to your launch arguments, you can see all the rule system rules and your custom rules as they are fired. </p><p>If those two flags don’t provide you with enough information, you can add <code>-NSDebugGroups -1</code> and <code>-NSDebugLevel 3</code> , which activate logging for the internal workings of WebObjects. Using <code>-NSDebugGroups -1</code> gives you debug logging information for all aspects of the system. By specifying specific debug groups, you can narrow down the amount of information logged. See the API reference for NSLog for more information on how to use NSLog.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../DistributionLayer/DistributionLayer.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../NonDirectJavaClient/NonDirectJavaClient.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/DesktopApplications/AdvancedTutorial/AdvancedTutorial.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/DesktopApplications/AdvancedTutorial/AdvancedTutorial.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/DesktopApplications/AdvancedTutorial/AdvancedTutorial.html%3Fid%3DTP30001017-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>