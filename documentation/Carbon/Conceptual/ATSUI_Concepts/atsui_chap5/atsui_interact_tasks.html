<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>ATSUI Programming Guide: Interactive Tasks: Supporting Carets and Highlighting Text</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Interactive Tasks: Supporting Carets and Highlighting Text"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000031" title="Interactive Tasks: Supporting Carets and Highlighting Text"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../atsui_chap1/atsui_intro.html#//apple_ref/doc/uid/TP30000027-TP1">ATSUI Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap4/atsui_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap6/atsui_adv_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000031-TP1" title="Interactive Tasks: Supporting Carets and Highlighting Text"></a><h1>Interactive Tasks: Supporting Carets and Highlighting Text</h1><p>This chapter provides information on how to support user interaction with the text your application draws onscreen. Handling the caret and highlighting text are discussed in the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-TPXREF144">“Positioning the Caret”</a></span> describes which functions to use to determine the insertion point and move the caret. </p></li><li class="li"><p><span class="content_text"><a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-TPXREF149">“Highlighting Selected Text ”</a></span> discusses how to draw highlighted text.</p></li></ul><p>Before you read this chapter, you should be familiar with the tasks described in Chapter 4, <span class="content_text"><a href="../atsui_chap4/atsui_tasks.html#//apple_ref/doc/uid/TP30000030-TP1">“Basic Tasks: Working With Objects and Drawing Text.”</a></span></p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-TPXREF144">Positioning the Caret</a>
				
			<br/>
			
        
			
			
				<a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-TPXREF149">Highlighting Selected Text</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000031-TPXREF144" title="Positioning the Caret"></a><h2>Positioning the Caret</h2><p>If you want users to interact with the text your application draws onscreen, you need to recognize and respond appropriately to mouse clicks and arrow-key presses. This section discusses two tasks your application must perform to position the caret in response to user actions:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-BCIBICCB">“Setting the Insertion Point”</a></span></p></li><li class="li"><p><span class="content_text"><a href="atsui_interact_tasks.html#//apple_ref/doc/uid/TP30000031-BCICBIBH">“Moving the Caret”</a></span></p></li></ul><p>Each of these tasks requires you to take into consideration whether the mouse click or arrow-key press occurs at a direction boundary and whether the glyph involved in caret movement forms a combining character.</p><p>Before you perform the tasks described in this section, you should be familiar with <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TPXREF152">“Caret Handling.”</a></span></p><a name="//apple_ref/doc/uid/TP30000031-BCIBICCB" title="Setting the Insertion Point"></a><h3>Setting the Insertion Point</h3><p>When the user clicks a location in onscreen text, your application must determine which caret position<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_998"></a> best reflects the user’s action. The ATSUI function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPositionToOffset" target="_top">ATSUPositionToOffset</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_999"></a> determines the position for you. When you use this function, ATSUI calculates whether the mouse click is closest to the trailing edge or the leading edge of the glyph and returns the appropriate caret position. For example, <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-BAJBIECG">Figure 1-26</a></span> shows the caret position associated with a mouse-down region in line of unidirectional text. </p><p>The caret position<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1000"></a> in a line of unidirectional text is fairly straightforward to determine. But suppose the user clicks between a direction boundary? In this case, the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPositionToOffset" target="_top">ATSUPositionToOffset</a></code> returns a value to indicate that a dual caret<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1001"></a> is appropriate and returns the two caret positions associated with the mouse-down event. One position specifies where your application should draw the high, or primary<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1002"></a>, caret while the second position specifies where your application should draw the low, or secondary<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1003"></a>, caret. <span class="content_text">Figure 4-1</span> shows the two caret positions returned when the insertion point is at the direction boundary associated with offset 3. The primary caret position indicates where Arabic text should be entered and the secondary caret position indicates where Roman text should be entered.</p><br/><div><a name="//apple_ref/doc/uid/TP30000031-BCICJABI" title="Figure 4-1Caret positions returned for an insertion point on a direction boundary "></a><p><strong>Figure 4-1&nbsp;&nbsp;</strong>Caret positions returned for an insertion point on a direction boundary </p><img src = "../art/caretposdirection.gif" alt = "Caret positions returned for an insertion point on a direction boundary" width="456" height="288"></div><br/><p>You need to perform the following steps to set the insertion point in response to a mouse click by a user:<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1004"></a></p><ol class="ol"><li class="li"><p>Obtain the location of the mouse-down event.</p></li><li class="li"><p>Convert the coordinates to local coordinates relative to the line origin.</p><p>You need to determine which line in the text is associated with the mouse-down event and then get the line origin.</p><p>The coordinates must be local to the line origin. For example, if the position of the mouse-down event in local coordinates is (100,250), you would subtract this value from the position of the origin of the line in the current graphics port. If the position of the origin of the line in the current graphics port is (10,250), then the relative position of the mouse-down event is (90,0).</p></li><li class="li"><p>Call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPositionToOffset" target="_top">ATSUPositionToOffset</a></code> to obtain the memory offset corresponding to the glyph edge nearest the mouse-down event. </p><p>You must pass this function the local coordinates relative to the line origin. </p><p>If the mouse-down event occurs at a direction boundary or within a glyph cluster, <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPositionToOffset" target="_top">ATSUPositionToOffset</a></code> produces two offsets. </p></li><li class="li"><p>Call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUOffsetToPosition" target="_top">ATSUOffsetToPosition</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1005"></a> to obtain the actual caret position for the mouse-down event.</p><p>You must pass this function the memory offset returned in the previous step. Pass two memory offsets if the mouse-down event occurs at a direction boundary or within a glyph cluster. </p><p>The function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUOffsetToPosition" target="_top">ATSUOffsetToPosition</a></code> returns an <code>ATSUCaret</code> structure that specifies the starting and ending pen locations for the caret. If it is a dual caret, the function returns the starting and ending pen locations for the high and low carets.</p></li><li class="li"><p>Draw the caret using the pen location returned by the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUOffsetToPosition" target="_top">ATSUOffsetToPosition</a></code> in the previous step.</p><p>It is the responsibility of your application to draw the caret. ATSUI does not draw carets; it only provides the pen locations for you to use.<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1006"></a></p></li></ol><a name="//apple_ref/doc/uid/TP30000031-BCICBIBH" title="Moving the Caret"></a><h3>Moving the Caret</h3><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1007"></a><p>For unidirectional text, when the user presses an arrow key to move the caret left or right across the text<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1008"></a>, your application should move the caret in the direction of the arrow key. If the document contains objects such as graphics or sound data embedded in the text, you should treat the embedded object as a single character.</p><p>You can use these functions to obtain the memory offset for an insertion point:</p><ul class="spaceabove"><li class="li"><p><code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUNextCursorPosition" target="_top">ATSUNextCursorPosition</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1009"></a> obtains the memory offset for an insertion point that follows the current insertion point in storage order. </p></li><li class="li"><p><code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPreviousCursorPosition" target="_top">ATSUPreviousCursorPosition</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1010"></a> obtains the memory offset for an insertion point that precedes the current insertion point in storage order.</p></li><li class="li"><p><code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSURightwardCursorPosition" target="_top">ATSURightwardCursorPosition</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1011"></a> obtains the memory offset for an insertion point to the right of the high caret position. </p></li><li class="li"><p><code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSULeftwardCursorPosition" target="_top">ATSULeftwardCursorPosition</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1012"></a> obtains the memory offset for an insertion point to the left of the high caret position. </p></li></ul><p>The functions <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUNextCursorPosition" target="_top">ATSUNextCursorPosition</a></code>, <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPreviousCursorPosition" target="_top">ATSUPreviousCursorPosition</a></code>, <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSURightwardCursorPosition" target="_top">ATSURightwardCursorPosition</a></code>, and <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSULeftwardCursorPosition" target="_top">ATSULeftwardCursorPosition</a></code> can treat individual combining characters<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1013"></a> either as part of an indivisible larger unit (that is, a cluster) or as characters in their own right, depending on the caret movement type you specify when you call the function. You can also use the style attribute tag <code>kATSUNoLigatureSplitTag</code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1014"></a> to treat combining characters of ligatures as one or two text elements. </p><p>Once you have obtained the memory offset for an insertion point, you can call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUOffsetToPosition" target="_top">ATSUOffsetToPosition</a></code> to obtain the actual caret position. Then, you can draw the caret using the pen location returned by the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUOffsetToPosition" target="_top">ATSUOffsetToPosition</a></code>.</p><a name="//apple_ref/doc/uid/TP30000031-TPXREF149" title="Highlighting Selected Text "></a><h2>Highlighting Selected Text </h2><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1015"></a><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1016"></a><p>A user can select a range of text by positioning the pointer, pressing the mouse button, moving the mouse, and then releasing the mouse button. The <strong>anchor point</strong><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1017"></a> is the position in the text at which the user positions the pointer and presses the mouse button. The point at which the user releases the button is the <strong>active end</strong><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1018"></a> of the range. <span class="content_text">Figure 4-2</span> shows the anchor point and active end<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1019"></a> for a selection range. Note that a selection range can also be set programmatically by your application.</p><br/><div><a name="//apple_ref/doc/uid/TP30000031-TPXREF192" title="Figure 4-2The anchor point and active end of a selection range"></a><p><strong>Figure 4-2&nbsp;&nbsp;</strong>The anchor point and active end of a selection range</p><img src = "../art/anchorpoint.gif" alt = "The anchor point and active end of a selection range" width="166" height="111"></div><br/><p>Recall from <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-TP1">“Typography Concepts”</a></span> that characters in a selection range are always contiguous in memory, but their corresponding glyphs are not necessarily contiguous onscreen, as shown in <span class="content_text"><a href="../atsui_chap2/atsui_concepts.html#//apple_ref/doc/uid/TP30000028-BAJEFGEJ">Figure 1-25</a></span>.</p><p>Your application should highlight text in response to a user’s selection moves. To highlight text, you need to perform the following tasks:</p><ol class="ol"><li class="li"><p>Obtain the coordinates for the anchor point and the active end of a selection event.</p></li><li class="li"><p>Call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUPositionToOffset" target="_top">ATSUPositionToOffset</a></code> to obtain the memory offsets for the glyphs edges nearest the anchor point and the active end of the selection.</p></li><li class="li"><p>Calculate the length of the area to highlight.</p><p>You need to calculate the absolute value of the length.</p></li><li class="li"><p>Call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUHighlightText" target="_top">ATSUHighlightText</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1020"></a> to render a highlighted range of text.</p><p>ATSUI automatically produces discontinuous highlighting if necessary.</p><p>To draw a highlighted range of text that spans more than one line, you should call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUHighlightText" target="_top">ATSUHighlightText</a></code> for each line, even if the lines are in the same text layout object.</p></li></ol><p>If you need to remove highlighting from previously highlighted text, call the function <code><a href="../../../Reference/ATSUI_Reference/Reference/reference.html#//apple_ref/doc/c_ref/ATSUUnhighlightText" target="_top">ATSUUnhighlightText</a></code><a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1021"></a>.<a name="//apple_ref/doc/uid/TP30000031-DontLinkElementID_1022"></a></p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../atsui_chap4/atsui_tasks.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../atsui_chap6/atsui_adv_tasks.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-07-10<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap5/atsui_interact_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap5/atsui_interact_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ATSUI_Concepts/atsui_chap5/atsui_interact_tasks.html%3Fid%3DTP30000984-2.6&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>