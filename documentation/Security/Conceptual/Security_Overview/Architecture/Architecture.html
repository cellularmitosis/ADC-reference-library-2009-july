<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Security Overview: Security Architecture</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Security Architecture"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000976-CH202" title="Security Architecture"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000434" target="_top">Security</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP30000976-CH201-TPXREF101">Security Overview</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Concepts/Concepts.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF101" title="Security Architecture"></a><h1>Security Architecture</h1><p>This chapter describes the components of security services on Mac OS X (in the following section) and iPhone OS (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-SW3">“iPhone OS”</a></span>). For each platform, the available security APIs are briefly described as well. For more extensive descriptions of the security APIs in each platform, see <span class="content_text"><a href="../Security_Services/Security_Services.html#//apple_ref/doc/uid/TP30000976-CH204-CHDDJIDG">“Security Services.”</a></span> </p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-SW6">Mac OS X</a>
				
			<br/>
			
        
			
			
				<a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-SW3">iPhone OS</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30000976-CH202-SW6" title="Mac OS X"></a><h2>Mac OS X</h2><p>Mac OS X security services are built on two open-source standards: BSD (Berkeley Software Distribution) and CDSA (Common Data Security Architecture<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_3"></a>). BSD<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_4"></a> is a form of the UNIX operating system and provides fundamental services, such as the basis for the Mac OS X file system, including file access permissions. CDSA<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_5"></a> provides a much wider array of security services, including finer-grained access permissions, authentication of users’ identities, encryption, and secure data storage. Although CDSA has its own standard application programming interface (API), it is complex and does not follow standard Macintosh programming conventions. Therefore, Mac OS X includes its own security APIs that call the CDSA API for you.</p><p>The Mac OS X security architecture is layered, with BSD on the bottom, CDSA in the middle, Mac OS X security APIs above that, and applications that call the security services at the top. <span class="content_text">Figure 1-1</span> illustrates this architecture.</p><br/><div><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDHIIJF" title="Figure 1-1Mac OS X security architecture overview"></a><p><strong>Figure 1-1&nbsp;&nbsp;</strong>Mac OS X security architecture overview</p><img src = "../art/layered_arch_simple.jpg" alt = "Mac OS X security architecture overview" ></div><br/><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF102" title="BSD and Mach"></a><h3>BSD and Mach</h3><p>The Mac OS X kernel—the heart of the operating system—is built from BSD<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_6"></a> and Mach<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_7"></a>. Among other things, <strong>BSD</strong> provides basic file system and networking services and implements a user and group identification scheme. BSD enforces access restrictions to files and system resources based on the user and group IDs. <strong>Mach</strong> provides memory management, thread control, hardware abstraction, and interprocess communication. Mach enforces access by controlling which tasks can send a message to a given Mach port, where a Mach port represents a task or some other Mach resource (see <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDCACCI">“Mach Port Rights”</a></span> for a discussion of Mach ports). BSD and Mach are both critical to enforcing local security; if you can break the security provided by one, you can break the other as well. </p><p>BSD security policies and Mach access permissions constitute an essential part of security in Mac OS X, but fall far short of all the capabilities that are needed. For example, although BSD can restrict access to a file to a particular user ID, it provides no facility for checking passwords or otherwise verifying that the person or process using that ID is who they claim to be. Similarly, once Mach has given the rights to one task to control another, it cannot restrict the data or features the controlling task can access.</p><p>It’s important to note that BSD and Mach access permissions are enforced by the operating system and therefore affect every process running in Mac OS X. In contrast, application-defined security policies must be enforced by those applications. The Mac OS X security APIs discussed in this document are available for that purpose.</p><p>For more information about the roles BSD and Mach play in Mac OS X, see <em><a href="../../../../MacOSX/Conceptual/OSX_Technology_Overview/index.html#//apple_ref/doc/uid/TP40001067" target="_top">Mac OS X Technology Overview</a></em>. For a more detailed description of Mach and BSD access permissions, see <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDCACCI">“Mach Port Rights”</a></span> and <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDCDCID">“BSD.”</a></span></p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDHEEDC" title="CDSA"></a><h3>CDSA</h3><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_8"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_9"></a><p><strong>CDSA</strong> is an Open Source security architecture adopted as a technical standard by the Open Group (<span class="content_text"><a href="http://www.opengroup.org/security/cdsa.htm" target="_blank">http://www.opengroup.org/security/cdsa.htm</a></span>). Apple has developed its own Open Source implementation of CDSA, available as part of Darwin at <span class="content_text"><a href="http://developer.apple.com/darwin/projects/security/" target="_top">http://developer.apple.com/darwin/projects/security/</a></span>. The core of CDSA is <strong>CSSM</strong> (Common Security Services Manager<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_10"></a>), a set of Open Source code modules that implement a public application programming interface called the CSSM API. CSSM provides APIs for cryptographic services (such as creation of cryptographic keys, encryption and decryption of data), certificate services (such as creation of digital certificates, reading and evaluation of digital certificates), secure storage of data, and other security services (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-CHDIHJBB">“Apple CDSA Plug-ins”</a></span> for a more complete list).</p><p>CSSM also defines an interface for plug-ins that implement security services for a particular operating system and hardware environment. The implementation on a given platform can optionally supply a middleware layer that provides an operating-system-specific API for applications. Whether such a layer is present or not, applications can call the CSSM API directly.</p><p>Mac OS X implements nearly all the standard features of CSSM, plus a set of middleware security services to provide a Mac OS X-standard interface for application programmers. In addition, to enhance the security of the most sensitive operations, the Mac OS X implementation runs a Security Server daemon as a separate process. The Security Server daemon launches another process, the Security Agent, which serves as the user interface for Security Server.</p><p><span class="content_text">Figure 1-2</span> illustrates the Mac OS X implementation of CDSA. The CDSA standard defines a four-layer architecture, with the top layer being the applications that use the CDSA security features. <span class="content_text">Figure 1-2</span> shows the first three layers: the CDSA plug-ins, CSSM, and the Mac OS X security APIs, which constitute the middleware layer referred to in the specification. The Mac OS X Authorization Services API, the Security Server daemon, and the Security Agent shown in the figure are technically outside of CDSA, but they are shown here for completeness because they constitute an integral part of the Mac OS X security architecture.</p><br/><div><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDDAHJG" title="Figure 1-2Mac OS X implementation of CDSA"></a><p><strong>Figure 1-2&nbsp;&nbsp;</strong>Mac OS X implementation of CDSA</p><img src = "../art/layered_arch_complete.jpg" alt = "Mac OS X implementation of CDSA" ></div><br/><p><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_11"></a>Security contexts (see <span class="content_text">Figure 1-2</span>) are data structures used by CSSM to assist applications in managing the many parameters used in security operations. The CSSM managers implement the standard CSSM API. (A fifth manager defined in the CDSA standard, called the Authorization Computation Services<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_12"></a> Manager, is not implemented in Mac OS X. Instead of using a CSSM API, Mac OS X Authorization Services calls the Security Server daemon directly.)</p><p>The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_13"></a>CDSA plug-ins shown in <span class="content_text">Figure 1-2</span> are those provided as part of Mac OS X. The CDSA specification allows any number of plug-ins. As long as a plug-in follows the rules for interfacing with the CSSM managers, it can implement any portion of the CDSA feature set, including a combination of features associated with two or more of the CSSM managers. (See <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-CHDEDICG">“AppleCSP/DL Module”</a></span> for an example of a multiservice CDSA plug-in.) The CDSA specification even allows for the expansion of CDSA by the addition of elective module managers and associated plug-ins. Plug-ins can call each other as well as being called by the CSSM managers—in fact, it is common for them to do so.</p><p>For an introduction to CDSA, see <em>CDSA Explained</em>, second edition, from the Open Group. The CDSA/CSSM technical standard is <em>Common Security: CDSA and CSSM</em>, version 2 (with corrigenda), also from the Open Group.</p><p>As long as you use the Mac OS X security APIs, you don’t have to worry about the details of the Mac OS X CDSA implementation. However, because a call to the CSSM API allows you to specify the plug-in module to which you want to direct your request, if you want to call CSSM directly you should have some understanding of the Mac OS X CDSA plug-ins.<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_14"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_15"></a></p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDIHJBB" title="Apple CDSA Plug-ins"></a><h3>Apple CDSA Plug-ins</h3><p>The Mac OS X implementation of CDSA includes five <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_16"></a>CDSA plug-ins (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-CHDDAHJG">Figure 1-2</a></span>):</p><ul class="spaceabove"><li class="li"><p>AppleCSP cryptographic service provider</p></li><li class="li"><p>AppleFileDL data storage library</p></li><li class="li"><p>AppleCSP/DL encrypted data storage provider</p></li><li class="li"><p>AppleX509CL certificate library</p></li><li class="li"><p>AppleX509TP trust policy library</p></li></ul><p>This section briefly describes the purpose and function of each of these modules. (See <span class="content_text"><a href="../Glossary/Glossary.html#//apple_ref/doc/uid/TP30000976-CH206-CHDDCGFE">“Glossary”</a></span> for explanations of any unfamiliar terms.)</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF103" title="AppleCSP Module"></a><h4>AppleCSP Module</h4><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_17"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_18"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_19"></a><p>All secure communications and authentication protocols are based on keys and encryption. The Apple cryptographic service provider (AppleCSP) is a basic plug-in module used by several of the security services for creating cryptographic keys and encrypting or decrypting data. Digital signatures also use the AppleCSP module to create message digests used to create and verify the signature. A CSP can use any number of algorithms.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF104" title="AppleFileDL Module"></a><h4>AppleFileDL Module</h4><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_20"></a><p>A data storage library<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_21"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_22"></a> (DL) module provides persistent <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_23"></a><strong>secure storage</strong>; that is, storage of encrypted data on disk or another medium that persists when the power is turned off. The CDSA standard allows a DL module to use any sort of database or other data store. Keeping things simple, the AppleFileDL module stores its data in files in the Mac OS X file system. It provides lower-level services used by the AppleCSP/DL plug-in for storing secrets on the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_24"></a><strong>keychain</strong>, Apple’s database used to store encrypted passwords, private keys, and other secrets.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDEDICG" title="AppleCSP/DL Module"></a><h4>AppleCSP/DL Module</h4><p>The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_25"></a>AppleCSP/DL plug-in is a multifunction module that combines cryptographic service and data storage functions to implement the Apple keychain<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_26"></a>, used for storage of passwords, keys, and other secrets. The AppleCSP/DL module calls the AppleFileDL module to perform file I/O, and the Security Server daemon to encrypt and decrypt secrets.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF105" title="AppleX509CL Module"></a><h4>AppleX509CL Module</h4><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_27"></a><p>A <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_28"></a>certificate library (CL) module<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_29"></a> performs operations on digital certificates. Digital certificates are used to establish or confirm the identity of an entity such as a website or the sender of a digitally signed message. They do so by using a <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_30"></a>digital signature to ensure that only the identified entity could have provided the certificate (see <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDBIGCE">“Digital Certificates”</a></span>). A CL module performs such functions as creating new certificates (in memory), creating certificate revocation lists (that indicate which certificates are no longer valid), verifying the digital signature contained in a certificate, and extracting information from a certificate. CL modules do not store persistent copies of certificates. Rather, a DL module is used for that purpose.</p><p>The AppleX509CL plug-in performs these functions for certificates<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_31"></a> that conform to the X.509 standard promulgated by the International Telecommunication Union (ITU). The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_32"></a>X.509 ITU standard is widely used on the Internet and throughout the information technology industry for designing secure applications based on a <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_33"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_34"></a><strong>public key infrastructure</strong> (the set of hardware, software, people, policies, and procedures needed to create and manage digital certificates that are based on public key cryptography). See <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDFFFCC">“Asymmetric Keys”</a></span> for more information on public keys.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDEEDBE" title="AppleX509TP Module"></a><h4>AppleX509TP Module</h4><p>A <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_35"></a>digital certificate has a level of trust associated with it, based on attributes of the certificate. A <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_36"></a>trust policy is a set of rules that specify the actions that can be taken given a specific level of trust. In other words, the purpose of establishing a level of trust for a certificate is to answer the question “Should I trust this certificate for this action?”</p><p>The issuer of a digital certificate adds a digital signature to the certificate to ensure that the certificate has not been altered and to verify the identity of the issuer. In general, a digital signature is verified through the use of another certificate. Consequently, each certificate is typically part of a chain of certificates that ends with a <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_37"></a><strong>root certificate</strong>, which can be verified without recourse to another certificate (see <span class="content_text"><a href="../Concepts/Concepts.html#//apple_ref/doc/uid/TP30000976-CH203-CHDBIGCE">“Digital Certificates”</a></span>). </p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000976-CH202-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;The set of root certificates stored and maintained by Mac OS X is in a system keychain at /System/Library/Keychains/X509Anchors. You can browse these keychains in the Keychain Access utility (by using the File > Add Keychain menu item to add them to your list of keychains) to see what they contain and how the certificate chains are constructed.</p></div><p>A <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_38"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_39"></a>trust policy (TP) plug-in performs two main functions: it assembles the chain of certificates needed to verify a given certificate, and it determines the level of trust that can be accorded the certificate.</p><p>The AppleX509TP module performs these functions on X.509 certificates, using trust policies established by Apple. <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_40"></a></p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF106" title="Security Server Daemon"></a><h3>Security Server Daemon</h3><p>The Mac OS X security implementation includes a daemon, called the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_41"></a>Security Server, and a separate process, called the Security Agent, that is used by the Security Server for a user interface. This section briefly describes their roles.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDGJJHH" title="Security Server"></a><h4>Security Server</h4><p>The <strong>Security Server</strong> is a daemon running in Mac OS X that implements several security protocols, such as encryption, decryption, and authorization computation. The use of the Security Server to perform actions with cryptographic keys enables the security implementation to maintain the keys in a separate address space from the client application, keeping them more secure. The Security Server also provides an interface in which developers use references to keys rather than using the keys directly. With this architecture, if Apple introduces a new technology, such as security smart cards, existing applications that use the Mac OS X security APIs automatically work with it.</p><p>Because Authorization Services performs functions not provided by the CDSA specification, the Authorization Services API interfaces directly with the Security Server rather than going through CDSA. The Security Server hosts authorization plug-ins that it can load as needed. This feature, like the use of key references, makes it possible to add new technologies without requiring applications to modify their code. In fact, because the Security Server handles its own communication with the user (through the Security Agent), application developers don’t have to worry about writing new user interface code to support new authentication technologies, such as fingerprint readers or iris scanners.</p><p>The Security Server has no public API. Instead, Authorization Services communicates directly with the Security Server and Keychain Services communicates with it indirectly (through the AppleCSP/DL plug-in module). In turn, the Security Server calls the AppleCSP plug-in module to perform cryptography. The Security Server uses the Security Agent to communicate with the user through dialogs and other user interface elements.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF107" title="Security Agent"></a><h4>Security Agent</h4><p>The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_42"></a><strong>Security Agent</strong> is a separate process that deals with all of the security-related user interface for the Security Server. For example, when the Security Server requires the user to authenticate, the Security Agent opens a dialog requesting a user name and password. If Apple introduced an authentication smart card reader for Macintosh computers, a new Security Server plug-in and modifications to the Security Agent would enable the Security Agent to prompt the user to insert their card instead of entering their user name and password. The application developer would not have to do a thing to get this new behavior.</p><p>The Security Agent runs with restricted permissions so that the user must be physically present, using the graphical user interface, in order to be authenticated. The graphical user interface elements can’t be used through a command-line interface such as the Terminal application or a secure shell (ssh) remote session. This restriction makes it much more difficult for a malicious user to breach an application’s security.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDIFBEH" title="CSSM Services"></a><h3>CSSM Services</h3><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_43"></a><p>Although the Mac OS X security APIs provide all the capabilities you are ever likely to need for developing secure applications, nearly all the standard CSSM APIs are also available for your use. This section briefly describes the functions provided by each CSSM service. For details, see <em>Common Security: CDSA and CSSM</em>, version 2 (with corrigenda), from the Open Group (<span class="content_text"><a href="http://www.opengroup.org/security/cdsa.htm" target="_blank">http://www.opengroup.org/security/cdsa.htm</a></span>).</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF108" title="Cryptographic Services"></a><h4>Cryptographic Services</h4><p>Cryptographic Services in CSSM provides functions to perform the following tasks:</p><ul class="spaceabove"><li class="li"><p>Encrypting and decrypting text and data</p></li><li class="li"><p>Creating and verifying digital signatures</p></li><li class="li"><p>Creating a cryptographic hash (used for message digests and other purposes)</p></li><li class="li"><p>Generating symmetric and asymmetric pairs of cryptographic keys</p></li><li class="li"><p>Generating pseudorandom numbers</p></li><li class="li"><p>Controlling access to the CSP for creation of keys</p></li></ul><p>To see exactly which security protocols and algorithms are supported by Apple’s CSP implementation, see the documentation provided with the Open Source security code, which you can download at <span class="content_text"><a href="http://developer.apple.com/darwin/projects/security/" target="_top">http://developer.apple.com/darwin/projects/security/</a></span>, and the Security Release Notes in the latest Xcode Tools from Apple.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF109" title="Data Store Services"></a><h4>Data Store Services</h4><p>CSSM Data Store Services provides an API for storing and retrieving data that is independent of the type of storage used. If there is more than one DL module installed, the caller can query Data Store Services to learn the capabilities of each and select which one to use in a particular call. The Apple implementation of Data Store Services supports any standard CDSA DL plug-in module. The AppleFileDL Data Storage Library and AppleCSP/DL Encrypted Data Storage module both implement functions called by Data Store Services. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF110" title="Certificate Services"></a><h4>Certificate Services</h4><p>Certificate Services as specified by CDSA performs the following functions:</p><ul class="spaceabove"><li class="li"><p>Verifies the signatures on certificates and certificate revocation lists</p></li><li class="li"><p>Creates certificates and certificate revocation lists</p></li><li class="li"><p>Signs certificates and certificate revocation lists</p></li><li class="li"><p>Extracts values of fields from certificates and certificate revocation lists</p></li><li class="li"><p>Searches certificate revocation lists for specified certificates</p></li></ul><p>Apple’s implementation of Certificate Services supports all of the CL API functions in the CDSA/CSSM specification. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF111" title="Trust Policy Services"></a><h4>Trust Policy Services</h4><p>The Mac OS X implementation of CSSM Trust Policy Services provides functions to verify certificates, to determine what attributes they contain and therefore the level of trust they can be given, and to construct a chain of related certificates. It does not implement other trust policy functions in the CSSM standard. Documentation for the CSSM trust policy functions supported by Apple’s TP implementation can be found with the Open Source security code, which you can download at <span class="content_text"><a href="http://developer.apple.com/darwin/projects/security/" target="_top">http://developer.apple.com/darwin/projects/security/</a></span>.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF112" title="Authorization Computation Services"></a><h4>Authorization Computation Services</h4><p>Apple’s implementation of CSSM does not include the Authorization Computation Services defined in the CDSA standard. Instead, the Authorization Services API calls the Security Server daemon directly (see <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-CHDDAHJG">Figure 1-2</a></span>).<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_44"></a></p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF113" title="Mac OS X Security APIs"></a><h3>Mac OS X Security APIs</h3><p>In the context of CDSA, the Mac OS X security APIs constitute a middleware layer between the CSSM APIs and applications that use CDSA (<span class="content_text">Figure 1-3</span>). This section discusses how each of the Mac OS X security APIs fits into the overall security architecture. See <span class="content_text"><a href="../Security_Services/Security_Services.html#//apple_ref/doc/uid/TP30000976-CH204-CHDDJIDG">“Security Services”</a></span> for a more detailed description of each API.</p><br/><div><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDBFJAJ" title="Figure 1-3Mac OS X security APIs"></a><p><strong>Figure 1-3&nbsp;&nbsp;</strong>Mac OS X security APIs</p><img src = "../art/above_cdsa.jpg" alt = "Mac OS X security APIs" ></div><br/><a name="//apple_ref/doc/uid/TP30000976-CH202-CHDIHBJH" title="Keychains"></a><h4>Keychains</h4><p>The keychain is used to store passwords, keys, certificates, and other secrets. Its implementation therefore requires both cryptographic functions (to encrypt and decrypt secrets) and data storage functions (to store the secrets and related data in files). To achieve these aims, Keychain Services calls the CSSM API, which calls the AppleCSP/DL CDSA plug-in module. The AppleCSP/DL module in turn calls the AppleFileDL module to perform file I/O, and the Security Server daemon to encrypt and decrypt secrets.</p><p>Keychain Manager is maintained only for compatibility with older versions of Mac OS X (v10.1 and earlier). For newer versions of Mac OS X (starting with Mac OS X v10.2), Keychain Manager calls Keychain Services rather than calling CSSM directly. Because Keychain Services is more efficient and offers more features than Keychain Manager, any new code should be written to use Keychain Services. For more information on the differences between these two APIs, see <span class="content_text"><a href="../Security_Services/Security_Services.html#//apple_ref/doc/uid/TP30000976-CH204-CHDDJIHA">“Keychain Manager and Keychain Services.”</a></span></p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF114" title="Secure Transport"></a><h4>Secure Transport</h4><p><strong>Secure Transport</strong> is used to implement the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_45"></a><strong>Secure Sockets Layer</strong> (<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_46"></a><strong>SSL</strong>) and <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_47"></a><strong>Transport Layer Security</strong> (<a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_48"></a><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_49"></a><strong>TLS</strong>) protocols, which provide secure communications over a TCP/IP connection such as the Internet. These protocols use encryption and certificate exchange to prevent eavesdropping and message tampering. Secure Transport calls CSSM to manage certificates and keys and to encrypt and decrypt data.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW1" title="CFNetwork"></a><h4>CFNetwork</h4><p><strong>CFNetwork</strong> is an API that provides network services. It provides a higher-level interface than Secure Transport that can be used by applications to create and maintain secure data streams and to add authentication information to a message. CFNetwork calls Secure Transport to set up a secure connection. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW2" title="URL Loading System"></a><h4>URL Loading System</h4><p><strong>URL Loading System</strong> is another high-level transport API. In contrast to CFNetwork, it is used to access the contents of URLs rather than to maintain a data stream. Because URL Loading System works with secure https:// URLs, it can be used for secure transport of data. URL Loading System is built on top of CFNetwork. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF115" title="Certificate, Key, and Trust Services"></a><h4>Certificate, Key, and Trust Services</h4><p>The <strong>Certificate, Key, and Trust Services</strong> API includes functions to:</p><ul class="spaceabove"><li class="li"><p>Create, manage, and read certificates</p></li><li class="li"><p>Add certificates to a keychain</p></li><li class="li"><p>Create encryption keys</p></li><li class="li"><p>Manage trust policies</p></li></ul><p>To carry out all these services, the API calls a variety of CSSM functions, ultimately using the services of all of the CSSM managers discussed in <span class="content_text"><a href="Architecture.html#//apple_ref/doc/uid/TP30000976-CH202-CHDIFBEH">“CSSM Services.”</a></span></p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF116" title="Authorization Services"></a><h4>Authorization Services</h4><p><strong>Authorization Services</strong> gives applications control over access to specific operations within the application. For example, a directory application that can be started by any user can use Authorization Services to restrict access for modifying directory items to administrators. In contrast, BSD provides access permission only to an entire file or application. Authentication Services calls the Security Server daemon directly. In turn, the Security Server calls specific CDSA plug-ins as needed.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF117" title="Security Objective-C API"></a><h4>Security Objective-C API</h4><p>The <strong>Security Objective-C API</strong> is provided for the convenience of Cocoa programmers. It provides a set of Objective-C methods that are wrappers for the Authentication Services functions. In addition, it provides classes that display security-related UI elements, such as the contents of certificates, interfaces to create keychains and change keychain settings, and others. Depending on the class in use, this API calls Authorization Services; Certificate, Key, and Trust Services; or Keychain Services. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-TPXREF118" title="Movie Toolbox Access Keys"></a><h4>Movie Toolbox Access Keys</h4><p><strong>Movie Toolbox Access Keys</strong> is a QuickTime API that can be used to add password protection to QuickTime data. QuickTime implements its own mechanism for storing and verifying passwords. QuickTime does not call Authorization Services or any CSSM functions.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW3" title="iPhone OS"></a><h2>iPhone OS</h2><p><span class="content_text">Figure 1-4</span> illustrates the architecture of the iPhone OS and shows the location of the security services. The iPhone OS security APIs are located in the Core Services layer of the operating system and are based on services in the Core OS (kernel) layer of the operating system. Applications on the iPhone call the security services APIs directly rather than going through the Cocoa Touch or Media layers. Networking applications can also access secure networking functions through the CFNetwork API, which is also located in the Core Services layer.</p><br/><div><a name="//apple_ref/doc/uid/TP30000976-CH202-SW4" title="Figure 1-4iPhone OS security architecture overview"></a><p><strong>Figure 1-4&nbsp;&nbsp;</strong>iPhone OS security architecture overview</p><img src = "../art/iphone_security_architecture.jpg" alt = "Layered iPhone architecture showing security services as part of core services above core OS and below applications" ></div><br/><a name="//apple_ref/doc/uid/TP30000976-CH202-SW8" title="Security Server Daemon"></a><h3>Security Server Daemon</h3><p>The iPhone OS security implementation includes a daemon called the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_50"></a><strong>Security Server</strong> that implements several security protocols, such as access to keychain items and root certificate trust management.</p><p>The Security Server has no public API. Instead, applications use the Keychain Services API and the Certificate, Key, and Trust services API, which in turn communicate with the Security Server. Because, unlike the Mac OS X security services, the iPhone OS security services do not provide an authentication interface, there is no need for the Security Server to have a user interface.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW9" title="iPhone&Acirc;&nbsp;OS Security APIs"></a><h3>iPhone OS Security APIs</h3><p>The iPhone OS security APIs are based on services in the Core Services layer, including the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_51"></a>Common Crypto library in the <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_52"></a>libSystem dynamic library (<span class="content_text">Figure 1-5</span>). This section discusses how each of the iPhone OS security APIs fits into the overall security architecture. See <span class="content_text"><a href="../Security_Services/Security_Services.html#//apple_ref/doc/uid/TP30000976-CH204-CHDDJIDG">“Security Services”</a></span> for a more detailed description of each API. For more information about the Common Crypto library, see the manual page for CC_crypto(3cc) in <em><!--a target="_top" -->iPhone OS Manual Pages<!--/a--></em>.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP30000976-CH202-SW14" title="OpenSSL Note"></a><p><strong>OpenSSL Note:</strong>&nbsp;Although Mac OS X includes a low-level command-line interface to the OpenSSL open-source cryptography toolkit, this interface is not available on the iPhone OS. For iPhone OS development, use the CFNetwork API for secure networking and the Certificate, Key, and Trust Services API for cryptographic services. </p></div><br/><div><a name="//apple_ref/doc/uid/TP30000976-CH202-SW5" title="Figure 1-5iPhone OS security APIs"></a><p><strong>Figure 1-5&nbsp;&nbsp;</strong>iPhone OS security APIs</p><img src = "../art/iphone_sec_arch_detail.jpg" alt = "Mac OS X security APIs" ></div><br/><a name="//apple_ref/doc/uid/TP30000976-CH202-SW10" title="Keychain"></a><h4>Keychain</h4><p>The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_53"></a><strong>keychain</strong> is used to store passwords, keys, certificates, and other secrets. Its implementation therefore requires both cryptographic functions (to encrypt and decrypt secrets) and data storage functions (to store the secrets and related data in files). To achieve these aims, Keychain Services calls the Common Crypto dynamic library.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW11" title="CFNetwork"></a><h4>CFNetwork</h4><p><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_54"></a><strong>CFNetwork</strong> is a high-level API that can be used by applications to create and maintain secure data streams and to add authentication information to a message. CFNetwork calls underlying security services to set up a secure connection. </p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW12" title="Certificate, Key, and Trust Services"></a><h4>Certificate, Key, and Trust Services</h4><p>The <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_55"></a><strong>Certificate, Key, and Trust Services</strong> API includes functions to:</p><ul class="spaceabove"><li class="li"><p>Create, manage, and read certificates</p></li><li class="li"><p>Add certificates to a keychain</p></li><li class="li"><p>Create encryption keys</p></li><li class="li"><p>Encrypt and decrypt data</p></li><li class="li"><p>Sign data and verify signatures</p></li><li class="li"><p>Manage trust policies</p></li></ul><p>To carry out all these services, the API calls the Common Crypto dynamic library and other Core OS–level services.</p><a name="//apple_ref/doc/uid/TP30000976-CH202-SW13" title="Randomization Services"></a><h4>Randomization Services</h4><p><a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_56"></a><strong>Randomization Services</strong> provides cryptographically secure <strong>pseudorandom numbers</strong>. Pseudorandom numbers are generated by a computer algorithm (and are therefore not truly random), but the algorithm is not discernible from the sequence. To generate these numbers, Randomization Services calls a <a name="//apple_ref/doc/uid/TP30000976-CH202-DontLinkElementID_57"></a>random-number generator in the Core OS layer.</p>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Concepts/Concepts.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Security/Conceptual/Security_Overview/Architecture/Architecture.html%3Fid%3DTP30000976-3.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Security/Conceptual/Security_Overview/Architecture/Architecture.html%3Fid%3DTP30000976-3.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Security/Conceptual/Security_Overview/Architecture/Architecture.html%3Fid%3DTP30000976-3.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>