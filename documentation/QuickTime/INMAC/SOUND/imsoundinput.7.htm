<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Recording Sounds Directly From a Device (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound Manager</I><P>| <A target="doc" HREF="imsoundinput.6.htm">Previous</A> | <A target="doc" HREF="imsoundinput.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundinput.htm">Chapter top</A> | <A target="doc" HREF="imsoundinput.6.htm">Section top</A> | <A target="doc" HREF="imsoundinput.8.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=604"> </A>Recording Sounds Directly From a Device</H1><P CLASS="T0.Text0"><A NAME="pgfId=605"> </A><A NAME="marker=542"> </A><A NAME="marker=323"> </A><A NAME="marker=70"> </A>The Sound Input Manager provides a number of routines that you can use for low-level control over the recording process (such as the ability to intercept sound input data at interrupt time). You can open a sound input device and read data from it by calling these low-level Sound Input Manager routines. Several of those routines access information through a <B CLASS="bold">sound input parameter block,</B> which is defined by the <TT CLASS="cv">SPB</TT> data type:<A NAME="marker=72"> </A></P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=13500"> </A>TYPE SPB =<BR>RECORD<BR>&nbsp;&nbsp;&nbsp;&nbsp;inRefNum:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{reference number of input device}<BR>&nbsp;&nbsp;&nbsp;&nbsp;count:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of bytes to record}<BR>&nbsp;&nbsp;&nbsp;&nbsp;milliseconds:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of milliseconds to record}<BR>&nbsp;&nbsp;&nbsp;&nbsp;bufferLength:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{length of buffer to record into}<BR>&nbsp;&nbsp;&nbsp;&nbsp;bufferPtr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ptr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pointer to buffer to record into}<BR>&nbsp;&nbsp;&nbsp;&nbsp;completionRoutine:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcPtr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pointer to a completion routine}<BR>&nbsp;&nbsp;&nbsp;&nbsp;interruptRoutine:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcPtr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{pointer to an interrupt routine}<BR>&nbsp;&nbsp;&nbsp;&nbsp;userLong:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{for application's use}<BR>&nbsp;&nbsp;&nbsp;&nbsp;error:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{error returned after recording}<BR>&nbsp;&nbsp;&nbsp;&nbsp;unused1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{reserved}<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=1102"> </A><A NAME="marker=5371"> </A>The <TT CLASS="cv">inRefNum</TT> field indicates the reference number of the sound input device from which the recording is to occur. You can obtain the reference number of the default sound input device by using the <TT CLASS="cv">SPBOpenDevice</TT> function.</P><P CLASS="T1.Text1"><A NAME="pgfId=1117"> </A>The <TT CLASS="cv">count</TT>, <TT CLASS="cv">milliseconds</TT>, and <TT CLASS="cv">bufferLength</TT> fields jointly determine the length of recording. The <TT CLASS="cv">count</TT> field indicates the number of bytes to record; the <TT CLASS="cv">milliseconds</TT> field indicates the number of milliseconds to record; and the <TT CLASS="cv">bufferLength</TT> field indicates the length in bytes of the buffer into which the recorded sound data is to be placed. If the <TT CLASS="cv">count</TT> and <TT CLASS="cv">milliseconds</TT> fields are not equivalent, then the field which specifies the longer recording time is used. If the buffer specified by the <TT CLASS="cv">bufferLength</TT> field is shorter than this recording time, then the recording time is truncated so that the recorded data can fit into the buffer specified by the <TT CLASS="cv">bufferPtr</TT> field. The Sound Input&nbsp;Manager provides two functions, <TT CLASS="cv">SPBMilliSecondsToBytes</TT> and <TT CLASS="cv">SPBBytesToMilliSeconds</TT>, that allow you to convert between byte and millisecond&nbsp;values.<A NAME="marker=317"> </A><A NAME="marker=79"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=1395"> </A>After recording finishes, the <TT CLASS="cv">count</TT> and <TT CLASS="cv">milliseconds</TT> fields indicate the number of bytes and milliseconds actually recorded.</P><P CLASS="T1.Text1"><A NAME="pgfId=1118"> </A>The <TT CLASS="cv">completionRoutine</TT> and <TT CLASS="cv">interruptRoutine</TT> fields allow your application to&nbsp;define a sound input completion routine and a sound input interrupt routine, respectively. More information on these routines is provided later in this section.<A NAME="marker=318"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=1119"> </A>The <TT CLASS="cv">userLong</TT> field contains a long integer that is provided for your application's own use. You can use this field, for instance, to pass a handle to an application-defined structure to the sound input completion or interrupt routine. Or, you can use this field to&nbsp;store the value of your application's A5 register, so that your sound input completion or interrupt routine can access your application's global variables. For more information on&nbsp;preserving the value of the A5 register, see the discussion of the <TT CLASS="cv">SetA5</TT> and <TT CLASS="cv">SetCurrentA5</TT> functions in the chapter &quot;Memory Management Utilities&quot; in <I CLASS="italics">Inside&nbsp;Macintosh: Memory</I>.</P><P CLASS="T1.Text1"><A NAME="pgfId=607"> </A>The <TT CLASS="cv">error</TT> field describes any errors that occur during the recording. This field contains a value greater than 0 while recording unless an error occurs, in which case it contains a value less than 0 that indicates an operating system error. Your application can poll this field to check on the status of an asynchronous recording. If recording terminates without an error, this field contains 0.</P><P CLASS="T1.Text1"><A NAME="pgfId=622"> </A><A target="doc" HREF="imsoundinput.7.htm#14131" CLASS="XRef">Listing&nbsp;42</A> shows how to set up a sound parameter block and record synchronously using the <TT CLASS="cv">SPBRecord</TT> function. This procedure takes one parameter, a handle to a block of memory in which the recorded sound data is to be stored. It is assumed that the block&nbsp;of memory is large enough to hold the sound to be recorded.<A NAME="marker=101"> </A></P><P CLASS="L.Listing"><A NAME="pgfId=623"> </A>Listing&nbsp;42 <A NAME="14131"> </A>Recording directly from a sound input device</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=13504"> </A>PROCEDURE MyRecordSnd (mySndH: Handle);<BR>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;kAsync = TRUE;<BR>&nbsp;&nbsp;&nbsp;&nbsp;kMiddleC = 60;<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySPB:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SPB;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a sound input parameter block}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myInRefNum:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{device reference number}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myBuffSize:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{size of buffer to record into}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myHeadrLen:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{length of sound header}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myNumChans:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of channels}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySampSize:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{size of a sample}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySampRate:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fixed;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{sample rate}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myCompType:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSType;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{compression type}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;{Open the default input device for reading and writing.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr := SPBOpenDevice('', siWritePermission, myInRefNum);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;IF myErr = noErr THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Get current settings of sound input device.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyGetDeviceSettings(myInRefNum, myNumChans, mySampRate, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mySampSize, myCompType);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Set up handle to contain the 'snd&nbsp;' resource header.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SetupSndHeader(mySndH, myNumChans, mySampRate,mySampSize,  <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCompType, kMiddleC, 0, myHeadrLen);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Leave room in buffer for the sound resource header.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myBuffSize := GetHandleSize(mySndH) - myHeadrLen;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Lock down the sound handle until the recording is over.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HLockHi(mySndH);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Set up the sound input parameter block.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WITH mySPB do<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inRefNum := myInRefNum;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{input device reference number}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count := myBuffSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{number of bytes to record}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;milliseconds := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{no milliseconds}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferLength := myBuffSize;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{length of buffer}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bufferPtr := Ptr(ORD4(mySndH^) + myHeadrLen);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{put data after 'snd&nbsp;' header}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;completionRoutine := NIL;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{no completion routine}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interruptRoutine := NIL;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{no interrupt routine}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userLong := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{no user data}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error := noErr;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{clear error field}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unused1 := 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{clear reserved field}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END;<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Record synchronously through the open sound input device.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SPBRecord(@mySPB, NOT kAsync);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HUnlock(mySndH);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{unlock the handle}<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Indicate the number of bytes actually recorded.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SetupSndHeader(mySndH, myNumChans, mySampRate, mySampSize, <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCompType, kMiddleC, mySPB.count,<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myHeadrLen);<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{Close the input device.}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := SPBCloseDevice(myInRefNum);<BR>&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=626"> </A><A NAME="marker=5377"> </A>The <TT CLASS="cv">MyRecordSnd</TT> procedure defined in <A target="doc" HREF="imsoundinput.7.htm#14131" CLASS="XRef">Listing&nbsp;42</A> opens the default sound input device by using the <TT CLASS="cv">SPBOpenDevice</TT> function. You can specify one of two values for the <TT CLASS="cv">permission</TT> parameter of <TT CLASS="cv">SPBOpenDevice</TT>:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=13508"> </A>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;siReadPermission&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;&nbsp;&nbsp;&nbsp;&nbsp;{open device for reading}<BR>&nbsp;&nbsp;&nbsp;&nbsp;siWritePermission&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 1;&nbsp;&nbsp;&nbsp;&nbsp;{open device for reading/writing}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=628"> </A><A NAME="marker=5383"> </A>You must open a device for both reading and writing if you intend to use the <TT CLASS="cv">SPBSetDeviceInfo</TT> function or the <TT CLASS="cv">SPBRecord</TT> function. If <TT CLASS="cv">SPBOpenDevice</TT> successfully opens the specified device for reading and writing, <TT CLASS="cv">MyRecordSnd</TT> calls the&nbsp;<TT CLASS="cv">MyGetDeviceSettings</TT> procedure (defined in <A target="doc" HREF="imsoundinput.a.htm#29990" CLASS="XRef">Listing&nbsp;44</A>). That procedure calls the Sound Input Manager function <TT CLASS="cv">SPBGetDeviceInfo</TT> (explained in <A target="doc" HREF="imsoundinput.a.htm#20620" CLASS="XRef">&quot;Getting and Setting Sound Input Device Information&quot;</A>) to determine the current number of channels, sample rate, sample size, and compression type in use by the device.<A NAME="marker=119"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=629"> </A>This information is then passed to the <TT CLASS="cv">SetupSndHeader</TT> function, which sets up the handle <TT CLASS="cv">mySndH</TT> with a sound header describing the current device settings. After doing this, <TT CLASS="cv">MyRecordSnd</TT> sets up a sound input parameter block and calls the <TT CLASS="cv">SPBRecord</TT> function to record a sound. Note that the handle must be locked during the recording because the parameter block contains a pointer to the input buffer. After the recording is done, <TT CLASS="cv">MyRecordSnd</TT> once again calls the <TT CLASS="cv">SetupSndHeader</TT> function to fill in the actual number of bytes recorded.<A NAME="marker=120"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=631"> </A>If the <TT CLASS="cv">MyRecordSnd</TT> procedure defined in <A target="doc" HREF="imsoundinput.7.htm#14131" CLASS="XRef">Listing&nbsp;42</A> executes successfully, the handle <TT CLASS="cv">mySndH</TT> points to a resource of type <TT CLASS="cv">'snd&nbsp;'</TT>. Your application can then synchronously play the recorded sound, for example, by executing the following line of code:<A NAME="marker=124"> </A></P><CODE CLASS="Cv.Code"><A NAME="pgfId=13512"> </A>myErr := SndPlay(NIL, mySndH, FALSE);<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=1132"> </A>For more information on playing sounds your application has recorded, see the chapter &quot;Sound Manager&quot; in this book.<A NAME="marker=71"> </A><A NAME="marker=327"> </A><A NAME="marker=543"> </A></P><H2 CLASS="H3.Heading3TOC"><A target="doc" HREF="imsoundinput.8.htm#pgfId=636" CLASS="Hypertext">Defining a Sound Input Completion Routine</A></H2><H2 CLASS="H3.Heading3TOC"><A target="doc" HREF="imsoundinput.9.htm#pgfId=642" CLASS="Hypertext">Defining a Sound Input Interrupt Routine</A></H2><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound Manager</I><P>| <A target="doc" HREF="imsoundinput.6.htm">Previous</A> | <A target="doc" HREF="imsoundinput.1.htm">Chapter contents</A> | <A target="doc" HREF="imsoundinput.htm">Chapter top</A> | <A target="doc" HREF="imsoundinput.6.htm">Section top</A> | <A target="doc" HREF="imsoundinput.8.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV></DIV><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>