<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>About the List Manager (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING208></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-207.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-209.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-202.html"><B>Chapter 4 - List Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING208-0></A>
<H1><A NAME=MARKER-9-99></A>About the List Manager</H1>
 The List Manager uses a list record to keep track of information about a list. In most cases your application can get or set the information in a list record using List Manager routines. When necessary, your application can examine fields of the list record directly.<P>
 Each cell in a list can be described by a data structure of type <CODE>Cell</CODE>:<A NAME=MARKER-2-100></A><P>
<PRE>
TYPE Cell         = Point;
</PRE>
 The <CODE>Cell</CODE> data type has the same structure as the <CODE>Point</CODE> data type; however, the fields (horizontal and vertical coordinates) of a cell record have different meaning. The horizontal coordinate of a cell specifies its column number, and the vertical coordinate of a cell specifies the cell's row number. Note, however, that the first cell in a list is defined to be cell (0,0). So a cell with coordinates (3,4) is in the fourth column and fifth row. Thus you can visually identify a cell's coordinates using the formula (<I>column</I>-1, <I>row</I>-1). <BR><A HREF=#MARKER-9-102>Figure 4-17</A> illustrates a list in which each cell item's text is set to the coordinates of <BR>the cell.<A NAME=MARKER-2-229></A><P>
<B>Figure 4-17  <A NAME=MARKER-9-102></A>Coordinates of cells</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/LM-S-17.jpg">
 A list record is defined by the <CODE>ListRect</CODE> data type.<P>
<PRE>
TYPE ListRec   =
RECORD
   rView:      Rect;             {list's display rectangle}
   port:       GrafPtr;          {list's graphics port}
   indent:     Point;            {indent distance for drawing}
   cellSize:   Point;            {size in pixels of a cell}
   visible:    Rect;             {boundary of visible cells}
   vScroll:    ControlHandle;    {vertical scroll bar}
   hScroll:    ControlHandle;    {horizontal scroll bar}
   selFlags:   SignedByte;       {selection flags}
   lActive:    Boolean;          {TRUE if list is active}
   lReserved:  SignedByte;       {reserved}
   listFlags:  SignedByte;       {automatic scrolling flags}
   clikTime:   LongInt;          {TickCount at time of last click}
   clikLoc:    Point;            {position of last click}
   mouseLoc:   Point;            {current mouse location}
   lClikLoop:  Ptr;              {routine called by LClick}
   lastClick:  Cell;             {last cell clicked}
   refCon:     LongInt;          {for application use}
   listDefProc:                  {list definition procedure}
               Handle;           
   userHandle: Handle;           {for application use}
   dataBounds: Rect;             {boundary of cells allocated}
   cells:      DataHandle;       {cell data}
   maxIndex:   Integer;          {used internally}
   cellArray:                    {offsets to data}
               ARRAY[1..1] OF Integer; 
END;
   ListPtr     = ^ListRec;       {pointer to a list record}
   ListHandle  = ^ListPtr;       {handle to a list record}
</PRE>
 The only fields of a list record that you need to be familiar with are the <CODE>rView</CODE>, <CODE>port</CODE>, <CODE>cellSize</CODE>, <CODE>visible</CODE>, and <CODE>dataBounds</CODE> fields.<P>
 The <CODE>rView</CODE> field specifies the rectangle in which the list's visible rectangle is located, in local coordinates of the graphics port specified by the <CODE>port</CODE> field. Note that the list's visible rectangle does not include the area needed for the list's scroll bars. The width of a vertical scroll bar (which equals the height of a horizontal scroll bar) is 15 pixels.<A NAME=MARKER-2-30></A><A NAME=MARKER-2-54></A><A NAME=MARKER-2-55></A><P>
 The <CODE>cellSize</CODE> field specifies the size in pixels of each cell in the list. Usually, you let the List Manager automatically calculate the dimensions of a cell. It determines the default vertical size of a cell by adding the ascent, descent, and leading of the port's font. (This is 16 pixels for 12-point Chicago, for example.) For best results, you should make the height of your application's list equal to a multiple of this height. The List Manager determines the default horizontal size of a cell by dividing the width of the list's visible rectangle by the number of columns in the list.<A NAME=MARKER-2-125></A><A NAME=MARKER-2-371></A><P>
 The <CODE>visible</CODE> field specifies which cells in a list are visible within the area specified by the <CODE>rView</CODE> field. The List Manager sets the <CODE>left</CODE> and <CODE>top</CODE> fields of <CODE>visible</CODE> to the coordinates of the first visible cell; however, the List Manager sets the <CODE>right</CODE> and <CODE>bottom</CODE> fields so that each is 1 greater than the horizontal and vertical coordinates of the last visible cell. For example, if a list contains 4 columns and 10 rows but only the first 2 columns and the first 5 rows are visible (that is, the last visible cell has coordinates (1,4)), the List Manager sets the <CODE>visible</CODE> field to (0,0,2,5).<P>
 The List Manager sets the <CODE>visible</CODE> field using this method so that you can test whether a cell is visible within a list by calling QuickDraw's <CODE>PtInRect</CODE> function with a given cell and the contents of this field. Also, this allows your application to compute the number of visible rows, for example, by subtracting the <CODE>top</CODE> field of <CODE>visible</CODE> from <CODE>bottom</CODE>.<A NAME=MARKER-2-78></A><A NAME=MARKER-2-62></A> <A NAME=MARKER-2-3></A><P>
 The <CODE>dataBounds</CODE> field (located near the end of the list record) specifies the total cell dimensions of the list, including cells that are not visible. It works much like the <CODE>visible</CODE> field; that is, its <CODE>right</CODE> and <CODE>bottom</CODE> fields are each 1 greater than the horizontal and vertical coordinates of the last cell in the list. For example, if a list contains 4 columns and 10 rows (that is, the last cell in the list has coordinates (3,9)), the List Manager sets the <CODE>dataBounds</CODE> field to (0,0,4,10).<A NAME=MARKER-2-111></A><A NAME=MARKER-2-112></A><P>
 Your application seldom needs to access the remaining fields of the list record, although they are described here for your quick reference.<P>
 The <CODE>indent</CODE> field indicates the location, relative to the top-left corner of a cell, at which drawing should begin. For example, the default list definition procedure sets the vertical coordinate of this field to near the bottom of the cell, so that characters drawn with QuickDraw's <CODE>DrawText</CODE> procedure appear in the cell. <A NAME=MARKER-2-64></A> <A NAME=MARKER-2-114></A><P>
 The <CODE>vScroll</CODE> and <CODE>hScroll</CODE> fields are handles to the vertical and horizontal scroll bars associated with a list. You can determine which scroll bars a list contains by checking whether these fields are <CODE>NIL</CODE>.<A NAME=MARKER-2-115></A><A NAME=MARKER-21-146></A><P>
 The <CODE>lActive</CODE> field is <CODE>TRUE</CODE> if a list is active or <CODE>FALSE</CODE> if it is inactive. You should not change the value in this field directly, but should use the <CODE>LActivate</CODE> procedure to activate or inactivate a list.<A NAME=MARKER-2-5></A><P>
 The <CODE>selFlags</CODE> field specifies the algorithm that the List Manager uses to select cells in response to a click in a list. This field is described in more detail in <A HREF=MoreToolbox-214.html#MARKER-9-198>"Customizing Cell Highlighting" on page 4-29</A>.<A NAME=MARKER-2-6></A><P>
 The <CODE>listFlags</CODE> field indicates whether automatic vertical and horizontal scrolling is enabled. If automatic scrolling is enabled, then a list scrolls when the user clicks a cell but then drags the cursor out of the rectangle specified by the <CODE>rView</CODE> field. For example, if a user drags the cursor below this field, the list scrolls downward. By default, the List Manager enables vertical automatic scrolling if your list has a vertical scroll bar; it enables horizontal scrolling if your list has a horizontal scroll bar. Your application can disable or enable automatic scrolling by using the following bit values:<A NAME=MARKER-2-406></A><P>
<PRE>
CONST lDoVAutoScroll = 2;  {allows vertical autoscrolling}
      lDoHAutoScroll = 1;  {allows horizontal autoscrolling}
</PRE>
 The <CODE>clikTime</CODE> and <CODE>clikLoc</CODE> fields indicate the time at which the user last clicked the mouse and the local coordinates of the click. The <CODE>lastClick</CODE> field (located later in the list record) indicates the cell coordinates of the last click. You can access the value in the <CODE>lastClick</CODE> field via the <CODE>LLastClick</CODE> function. If your application depends on the accuracy of the values in these fields, and if your application treats keyboard selection of list items identically to mouse selection of list items, then it should update the values of these fields after highlighting a cell in response to a keyboard event. (In particular, this is necessary if your application implements the anchor algorithm for extending cell selections with the arrow keys.)<A NAME=MARKER-2-4></A><A NAME=MARKER-2-3></A><A NAME=MARKER-2-2></A><A NAME=MARKER-2-1></A><A NAME=MARKER-2-124></A><P>
 The <CODE>mouseLoc</CODE> field indicates the current location of the cursor in local coordinates<BR>(<CODE>v</CODE>, <CODE>h</CODE>). Ordinarily, you should use the Event Manager's <CODE>GetMouse</CODE> procedure to obtain this information, but this field may be more convenient to access from within a click-loop procedure (explained next).<A NAME=MARKER-2-5></A><P>
 The <CODE>lClikLoop</CODE> field usually contains <CODE>NIL</CODE>, but your application may place a pointer to a custom click-loop procedure in this field. A click-loop procedure manages the <BR>selection of list items and the scrolling of a list in response to a mouse click in the visible rectangle of a list. It is unlikely that your application will need to define its own click-loop procedures, because the List Manager's <CODE>LClick</CODE> function provides a <BR>default click-loop procedure that uses a robust algorithm to respond to mouse clicks. Your application needs to use a custom click-loop procedure only if it needs to perform some special processing while the user drags the cursor after clicking in a list. For more information on click-loop procedures, see <A HREF=MoreToolbox-266.html#MARKER-9-412>"Click-Loop Procedures" on page 4-90</A>.<A NAME=MARKER-2-337></A><A NAME=MARKER-2-342></A><A NAME=MARKER-9-225></A><A NAME=MARKER-2-6></A><P>
 The <CODE>refCon</CODE> and <CODE>userHandle</CODE> fields are for your application's use. You might, for example, use the <CODE>refCon</CODE> field to store the value of the A5 register, or to keep track of whether a list should be outlined. Typically, an application uses the <CODE>userHandle</CODE> field to store a handle to some additional storage associated with a list, but you can use the field in any way that is convenient for your application.<A NAME=MARKER-9-22></A><A NAME=MARKER-2-81></A><P>
 The <CODE>listDefProc</CODE> field contains a handle to the code used by the list definition procedure.<A NAME=MARKER-2-92></A><P>
 <A NAME=MARKER-2-94></A>The <CODE>cells</CODE> field contains a handle to data that stores the list contents. The handle is declared like this:<P>
<PRE>
TYPE  DataArray      = PACKED ARRAY[0..32000] OF Char;
      DataPtr        = ^DataArray;
      DataHandle     = ^DataPtr;
</PRE>
 Because of the way the <CODE>cells</CODE> field is defined, no list can contain more than 32,000 bytes of data. The List Manager slows down considerably when a list approaches this size, and the List Manager may fail if you attempt to store more data than this in a list.<A NAME=MARKER-2-95></A><P>
 The List Manager uses the <CODE>cellArray</CODE> field to store offsets to data in the relocatable block specified by the <CODE>cells</CODE> field. <A NAME=MARKER-2-135></A><P>
 Your application will never need to access the <CODE>lReserved</CODE> and <CODE>maxIndex</CODE> fields.<P>
<DL>
<DT><B>WARNING</B>
<DD>Your application should not change the <CODE>cells</CODE> field directly or access the information in the <CODE>cellArray</CODE> field directly. The List Manager provides routines that you can use to manipulate the information in a list.<EM></EM><A NAME=MARKER-2-37></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-207.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-209.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
