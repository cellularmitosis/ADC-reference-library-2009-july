<!-- legacy work start --><!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"        "http://www.w3.org/TR/html4/loose.dtd"><!-- legacy work end --><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Recording a Sound Resource (deprecated)</title><!-- legacy work start -->        <META NAME="Generator" CONTENT="manual">        <META http-equiv="content-type" CONTENT="text/html;charset=utf-8">        <META NAME = "Copyright" CONTENT="Copyright 2007 Apple Inc. All Rights Reserved.">        <META NAME="IndexTitle" CONTENT="Sound Input Manager (Not Recommended)">        <meta name="xcode-display" content="render">        <LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css"> <!-- before submitting, globally replace ".." with "developer.apple.com" -->        <script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script><!-- legacy work end --></HEAD><BODY BGCOLOR="#ffffff"><!-- start of header --><!--#include virtual="/includes/framesetheader" --><!-- end of header --><!-- path goes here --><!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imintrosound.e.htm">Previous</A> | <A target="doc" HREF="imintrosound.1.htm">Chapter contents</A> | <A target="doc" HREF="imintrosound.htm">Chapter top</A> | <A target="doc" HREF="imintrosound.a.htm">Section top</A> | <A target="doc" HREF="imintrosound.10.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><H1 CLASS="H2.Heading2"><A NAME="pgfId=710"> </A><A NAME="40200"> </A>Recording a Sound Resource<A NAME="marker=243"> </A><A NAME="marker=281"> </A><A NAME="marker=302"> </A></H1><P CLASS="T0.Text0"><A NAME="pgfId=775"> </A>You can record sounds from the current input device by using the <TT CLASS="cv">SndRecord</TT> function. The <TT CLASS="cv">SndRecord</TT> function presents the sound recording dialog box. When calling <TT CLASS="cv">SndRecord</TT>, you need to provide a handle to a block of memory where the incoming data should be stored. If you pass the address of a <TT CLASS="cv">NIL</TT> handle, however, the Sound Input Manager allocates a large block of space in your application heap and resizes it when the recording stops. <A target="doc" HREF="imintrosound.f.htm#25762" CLASS="XRef">Listing 0-4</A> illustrates how to call <TT CLASS="cv">SndRecord</TT>.</P><P CLASS="L.Listing"><A NAME="pgfId=776"> </A>Listing&nbsp;4 <A NAME="25762"> </A>Recording through the sound recording dialog box</P><CODE CLASS="Cv.Code"><A NAME="pgfId=4427"> </A>PROCEDURE MyRecordThruDialog (VAR mySndHandle: Handle);<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR>&nbsp;&nbsp;&nbsp;&nbsp;myCorner:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyGetTopLeftCorner(myCorner);<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndHandle := NIL;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{use default memory allocation}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr := SndRecord(NIL, myCorner, siBestQuality, mySndHandle);<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF (myErr &lt;&gt; noErr) AND (myErr &lt;&gt; userCanceledErr) THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoError(myErr);<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=778"> </A><A NAME="marker=4429"> </A>If the user cancels sound recording, then the <TT CLASS="cv">SndRecord</TT> function returns the result code <TT CLASS="cv">userCanceledErr</TT>. The <TT CLASS="cv">MyRecordThruDialog</TT> procedure defined in <A target="doc" HREF="imintrosound.f.htm#25762" CLASS="XRef">Listing 0-4</A> returns a <TT CLASS="cv">NIL</TT> sound handle if the user cancels recording.</P><P CLASS="T1.Text1"><A NAME="pgfId=792"> </A>If you pass a sound handle that is not <TT CLASS="cv">NIL</TT> as the fourth parameter to the <TT CLASS="cv">SndRecord</TT> function, the Sound Input Manager derives the maximum time of recording from the amount of space reserved by that handle. The handle is resized on completion of the recording.</P><P CLASS="T1.Text1"><A NAME="pgfId=779"> </A>The first parameter in the call to <TT CLASS="cv">SndRecord</TT> is the address of a filter procedure that&nbsp;determines how user actions in the dialog box are filtered. In <A target="doc" HREF="imintrosound.f.htm#25762" CLASS="XRef">Listing 0-4</A>, no filter&nbsp;procedure is desired, so the parameter is specified as <TT CLASS="cv">NIL</TT>. For information on&nbsp;filter&nbsp;procedures, see the chapter &quot;Dialog Manager&quot; in <I CLASS="italics">Inside Macintosh: Macintosh&nbsp;Toolbox&nbsp;Essentials</I>.<A NAME="marker=291"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=798"> </A>The second parameter in the call to <TT CLASS="cv">SndRecord</TT> is the desired location (in global coordinates) of the upper-left corner of the dialog box. For example, the Sound control panel displays the dialog box near the control panel. Your application might place the dialog box elsewhere (for example in the standard alert position on the main screen). For&nbsp;more information on centering dialog boxes, see the chapter &quot;Dialog Manager&quot; in <I CLASS="italics">Inside&nbsp;Macintosh: Macintosh Toolbox Essentials</I>.</P><P CLASS="T1.Text1"><A NAME="pgfId=797"> </A>The third parameter in the call to <TT CLASS="cv">SndRecord</TT> specifies the quality of the recording. Currently three values are supported:</P><CODE CLASS="Cv.Code"><A NAME="pgfId=4433"> </A>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;siBestQuality&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'best';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{the best quality available}<BR>&nbsp;&nbsp;&nbsp;&nbsp;siBetterQuality&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'betr';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a quality better than good}<BR>&nbsp;&nbsp;&nbsp;&nbsp;siGoodQuality&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 'good';&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a good quality}<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=781"> </A><A NAME="marker=4435"> </A>The precise meanings of these constants are defined by the current sound-input device driver. The constant <TT CLASS="cv">siBestQuality</TT> indicates that you want the highest quality recorded sound, usually at the expense of increased storage space (possibly because no compression is performed on the sound data). The constant <TT CLASS="cv">siGoodQuality</TT> indicates that you are willing to sacrifice audio quality if necessary to minimize the amount of storage space required (typically this means that 6:1 compression is performed on the sound data). For most voice recording, you should specify <TT CLASS="cv">siGoodQuality</TT>. The constant <TT CLASS="cv">siBetterQuality</TT> defines a quality and storage space combination that is between those provided by the other two constants.<A NAME="marker=259"> </A></P><P CLASS="T1.Text1"><A NAME="pgfId=782"> </A>You could play the sound recorded using the <TT CLASS="cv">MyRecordThruDialog</TT> procedure defined in <A target="doc" HREF="imintrosound.f.htm#25762" CLASS="XRef">Listing 0-4</A> by calling <TT CLASS="cv">SndPlay</TT> and passing it the sound handle <TT CLASS="cv">mySndHandle</TT>. That handle refers to some data in memory that has the structure of an <TT CLASS="cv">'snd&nbsp;'</TT> resource, but it is not a handle to an existing resource. To save the recorded data as a resource, you can use the Resource Manager. <A target="doc" HREF="imintrosound.f.htm#17721" CLASS="XRef">Listing 0-5</A> calls the <TT CLASS="cv">MyRecordThruDialog</TT> procedure and then uses the Resource Manager to save the recorded data as a resource in an open resource file.</P><P CLASS="L.Listing"><A NAME="pgfId=787"> </A>Listing&nbsp;5 <A NAME="17721"> </A>Recording a sound resource</P><CODE CLASS="CvF.CodeFull"><A NAME="pgfId=4439"> </A>PROCEDURE MyRecordSndResource (resFileRefNum: Integer);<BR>CONST<BR>&nbsp;&nbsp;&nbsp;&nbsp;kMinSysSndRes = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{lowest reserved 'snd ' resource ID}<BR>&nbsp;&nbsp;&nbsp;&nbsp;kMaxSysSndRes = 8191;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{highest reserved ID}<BR>VAR<BR>&nbsp;&nbsp;&nbsp;&nbsp;myPrevResFile:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{current resource file}<BR>&nbsp;&nbsp;&nbsp;&nbsp;mySndHandle:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handle;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{handle to resource data}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myResID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LongInt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ID of resource}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myResName:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Str255;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{name of resource}<BR>&nbsp;&nbsp;&nbsp;&nbsp;myErr:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSErr;<BR>BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;myPrevResFile := CurResFile;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{remember current resource file}<BR>&nbsp;&nbsp;&nbsp;&nbsp;UseResFile(resFileRefNum);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{temporarily switch resource files}<BR>&nbsp;&nbsp;&nbsp;&nbsp;MyRecordThruDialog(mySndHandle);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{record via standard interface}<BR>&nbsp;&nbsp;&nbsp;&nbsp;IF mySndHandle &lt;&gt; NIL THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;BEGIN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{recording finished successfully}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REPEAT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{find acceptable resource ID number}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myResID := Unique1ID('snd ');<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNTIL (myResID &lt; kMinSysSndRes) OR (myResID &gt; kMaxSysSndRes);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyGetSoundName(myResName);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{get name for sound resource}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{add resource to file}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddResource(mySndHandle, 'snd ', myResID, myResName);<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := ResError;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF myErr = noErr THEN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BEGIN<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UpdateResFile(resFileRefNum);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{update resource file}<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myErr := ResError;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IF myErr &lt;&gt; noErr THEN <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DoError(myErr);<BR>&nbsp;&nbsp;&nbsp;&nbsp;END;<BR>&nbsp;&nbsp;&nbsp;&nbsp;UseResFile(myPrevResFile);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{restore previous resource file}<BR>END;<BR></CODE><P CLASS="T1.Text1"><A NAME="pgfId=788"> </A><A NAME="marker=4441"> </A>The <TT CLASS="cv">MyRecordSndResource</TT> procedure defined in <A target="doc" HREF="imintrosound.f.htm#17721" CLASS="XRef">Listing 0-5</A> takes as a parameter the reference number of an open resource file to which you wish to record. The procedure makes that resource file the current resource file and, after recording, reverts to what was previously the active resource file. Note that you should not record to your application's resource fork, because applications that write to their own resource forks cannot be used by multiple users at once over a network. For more information on reference numbers for resource files, see the chapter &quot;Resource Manager&quot; in <I CLASS="italics">Inside Macintosh: More&nbsp;Macintosh Toolbox</I>.</P><P CLASS="T1.Text1"><A NAME="pgfId=791"> </A>The <TT CLASS="cv">MyRecordSndResource</TT> procedure first presents the sound recording dialog box by calling the <TT CLASS="cv">MyRecordThruDialog</TT> procedure defined in <A target="doc" HREF="imintrosound.f.htm#25762" CLASS="XRef">Listing 0-4</A>. If&nbsp;that procedure returns a valid sound handle, <TT CLASS="cv">MyRecordSndResource</TT> finds an acceptable resource ID for the resource file and then calls a procedure that returns a name for the resource (perhaps by presenting a dialog box that asks the user to name the sound). Finally, <TT CLASS="cv">MyRecordSndResource</TT> adds the resource to the specified resource file and updates that file by calling the Resource Manager procedure <TT CLASS="cv">UpdateResFile</TT>.<A NAME="marker=284"> </A></P><hr>&#169; 1999 Apple Computer, Inc.<!-- QTnavbar start --><P><I>Inside Macintosh: Sound</I><P>| <A target="doc" HREF="imintrosound.e.htm">Previous</A> | <A target="doc" HREF="imintrosound.1.htm">Chapter contents</A> | <A target="doc" HREF="imintrosound.htm">Chapter top</A> | <A target="doc" HREF="imintrosound.a.htm">Section top</A> | <A target="doc" HREF="imintrosound.10.htm">Next</a> | <!-- QTnavbar end --><!-- legacy work start --><script type="text/javascript"> placeWatermark()</script><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox" style="position: relative;"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b><i>Sound Input Manager</i> is deprecated as of Mac OS X v10.5. For new audio development in Mac OS X, use Core Audio. See the <a href="http://developer.apple.com/referencelibrary/MusicAudio/" target="_top">Audio</a> page in the ADC Reference Library.</p></div></div></div><!-- legacy work end --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></BODY></HTML>