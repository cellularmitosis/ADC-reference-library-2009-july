<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note OV02: Checking for Specific Functionality</title><meta name="keywords" content="Mac OS 8 SysEnvirons NGetTrapAddress trap availability specific functionality"><meta name="Description" content="Technical Note OV02: This Technical Note explains how tocheck at run time to see if a specific functionality is available.Examples are provided which utilize SysEnvirons and trapaddresses to determine the availability of certain features.">                                                                              <meta name="categories" content="Overview"><meta name="week-posted" content="Aug 31, 1987 - Sep 4, 1987"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002600" title="Checking for Specific Functionality"></a><A NAME="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note OV02</div>
<div id="pageheadsub">Checking for Specific Functionality</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">					<A HREF="#Section1">Introduction</A><BR><BR>					<A HREF="#Section2">Using SysEnvirons</A><BR><BR>					<A HREF="#Section3">Checking for Specific Functionality</A><BR><BR>					<A HREF="#References">References</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This technical note explains how to check at run time to see if specific functionality, such as the "new" TextEdit, is present.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Sep 01 1997]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content -->          <P><A NAME=Section1></A></P><h2>Introduction</h2><p>Applications should strive to be compatible across all Macintoshes, but thereare times when an application must have knowledge about the machine that it is running on.  The new trap, <code>SysEnvirons</code>, will give an application most of the information that it requires (what hardware, what version of system software...).</p><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>Using SysEnvirons</h2><p>In most cases, if you examine why you want to test for the existence of aspecific trap, you will find that there is an alternative method, for example:</p><p><i>I need to see if the "new" TextEdit calls are available.</i></p><p>Call <code>SysEnvirons</code> and check to see that <code>SysEnvRec.machineType &gt;=0</code> (128K ROMs or newer) and that we are running System 4.1 or later (System4.1 and later support the new TextEdit on 128K and greater ROM machines - we cancheck this by just seeing if the <code>SysEnvirons</code> trap exists, if we get an<code>envNotPresent</code> error, we know it doesn't).  In Pascal:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>CONST    CurrentVersion = 1;  {Current version of SysEnvirons}VAR    newTextAvail    : BOOLEAN;    theWorld    : SysEnvRec;BEGIN{This code checks to see if System 4.1 or later is running by callingSysEnvirons. If SysEnvirons returns an envNotPresent error, we know thatwe are running a system prior to 4.1, so we know we don't have the newTextEdit. If SysEnvirons doesn't return envNotPresent, we check machinetype to make sure we aren't running on 64K ROMs (note: we assume that envMachUnknowndoesn't have 64K ROMs when we check machineType &gt;= 0)}    IF SysEnvirons(CurrentVersion,theWorld) = envNotPresent THEN        newTextAvail:= FALSE    ELSE        newTextAvail:= (theWorld.machineType &gt;= 0);END;</pre>	</TD></TR></TABLE></CENTER><h3>In C:</h3><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>/* Current version of SysEnvirons */#define     CurrentVersion    1{    Boolean     newTextAvail;    SysEnvRec     theWorld;/*    see comment in the above Pascal*/if (SysEnvirons(CurrentVersion,&amp;theWorld) == envNotPresent) newTextAvail = false;    else        newTextAvail = (theWorld.machineType &gt;= 0);}</pre>	</TD></TR></TABLE></CENTER><p>I need to see if <code>PopUpMenuSelect</code> is implemented.</p><p>The same answer as above applies here, since the "new" Menu Manager calls areonly implemented in System 4.1 on 128K or larger ROM machines (and, as we foundabove, <code>PopUpMenuSelect</code> has the same trap number as <code>Rename</code>, socalling <code>NGetTrapAddress</code> won't work on 64K ROMs).</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>Checking for Specific Functionality</h2><p>There are rare times when you may feel that it is necessary to test forspecific functionality.  In order to allow for testing of specific trap functionality, there is anofficial unimplemented trap.  This trap (<code>$A89F</code>) is unimplemented on all Macintoshes.  To test to see if a particular trap that you wish to use is implemented, you can compare its address with the address of the unimplemented trap. Here are two fragments that show how to check to see if <code>Shutdown</code> is implemented.  First, Pascal:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>CONST  ShutDownTrapNum    = $95;{trap number of Shutdown}  UnImplTrapNum    = $9F;{trap number of &quot;unimplemented trap&quot;}VAR  ShutdownIsImplemented   : BOOLEAN;  {is Shutdown implemented}BEGIN{Is Shutdown implemented?}       ShutdownIsImplemented := NGetTrapAddress(ShutDownTrapNum,ToolTrap) &lt;&gt;       NGetTrapAddress(UnImplTrapNum,ToolTrap);END;</pre>	</TD></TR></TABLE></CENTER><p>Here's a C fragment:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>/*trap number of Shutdown*/#define     ShutDownTrapNum    0x95/*trap number of &quot;unimplemented trap&quot;*/#define     UnImplTrapNum     0x9F{    Boolean ShutdownIsImplemented;      /*Is Shutdown implemented?*/       ShutdownIsImplemented =    NGetTrapAddress(ShutDownTrapNum,ToolTrap) !=       NGetTrapAddress(UnImplTrapNum,ToolTrap);}</pre>	</TD></TR></TABLE></CENTER><p><code>NGetTrapAddress</code> is used because it ensures that you will get the correcttrap in case there is a <code>ToolTrap</code> and an <code>OSTrap</code> with the same number.  Please note that calling <code>NGetTrapAddress</code> does not cause compatibility problems with 64K ROMS.  When run on those ROMs, it just becomes a <code>GetTrapAddress</code> call.  You have to be careful on64K ROMs--you can't test for <code>PopUpMenuSelect</code> (<code>$A80B</code>), for example, because ithas the same trap number as <code>Rename</code>(<code>$A00B</code>).  The 64K ROM didn't really differentiate between <code>ToolTraps</code> and <code>OSTraps</code> (there was <b>no</b> overlap in trap numbers).  So, if you wanted to test for <code>PopUpMenuSelect</code>, you would need to first check to make sure you weren't running on 64K ROMs (see below).</p><p>You can get the trap number of the trap you wish to test for from <i>InsideMacintosh</i> (Appendix C of Volumes I-III and Appendix B of Volume IV).  You can tell if the trap is an <code>OSTrap</code> or a <code>ToolTrap</code> by checking to see if bit 11 in the trap word is set, that is, traps like <code>$A8xx</code> (or <code>$A9xx</code> or <code>$AAxx</code>) that have the "8" component set, are<code>ToolTraps</code> and traps that don't (<code>$A0xx</code>) are <code>OSTraps</code>. The trap number that you pass to <code>NGetTrapAddress</code> for <code>ToolTraps</code> is the low 10 bits of the trap word (the trap number for <code>PopUpMenuSelect[$A80B]</code> is <code>$00B). </code>The trap number that you pass to <code>NGetTrapAddress</code> for <code>OSTraps</code> is the low 8 bits of the trap word (the trap number for <code>MoveHHi[$A064]</code> is <code>$064</code>).</p><p><code>Shutdown </code>(<code>$A895</code>) is just an example of a trap that we might needto check before calling.  Most applications won't call <code>ShutDown</code>, so this is just an example of how to do the testing.</p> <P><A HREF="#top">Back to top</A></P> <a name="References"></a><h2>References</h2><p>Operating System Utilities</p><p>Assembly Language</p><p><A HREF = "ov_16.html">M.OV.GestaltSysenvirons</a></p> <P><A HREF="#top">Back to top</A></P>         <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ov_02.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ov/ov_02.html%3Fid%3DDTS10002600-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ov/ov_02.html%3Fid%3DDTS10002600-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ov/ov_02.html%3Fid%3DDTS10002600-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>