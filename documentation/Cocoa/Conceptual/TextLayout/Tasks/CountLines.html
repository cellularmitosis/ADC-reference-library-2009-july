<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Text Layout Programming Guide for Cocoa: Counting Lines of Text</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Counting Lines of Text"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001810" title="Counting Lines of Text"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000416" target="_top">Cocoa</a> &gt; <a href="../../../TextFonts-date.html#//apple_ref/doc/uid/TP30000440-TP30000416-TP30000461" target="_top">Text &amp; Fonts</a> &gt; <a href="../index.html" target="_top">Text Layout Programming Guide for Cocoa</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="StringHeight.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Articles/TextTables.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/20001810-CJBGBIBB" title="Counting Lines of Text"></a><hr /><H1>Counting Lines of Text</H1><p><a name="//apple_ref/doc/uid/20001810-DontLinkElementID_108"></a>This task shows how to count the number of lines in a block of text programmatically. Lines can be defined by hard linebreak characters in the text string, or they can be lines generated by the text layout mechanism when it wraps the text to fit into a text container.</p><p>Lines of text defined by hard linebreak<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_109"></a> characters, such as carriage return and newline, are considered to be paragraphs<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_110"></a> by the text system. That is, the text layout engine generates line fragments sized to fit into a text container until it reaches a hard linebreak character, so the last fragment is typically shorter than the container width. However, if lines are laid out into a text container wider than the longest glyph run between hard linebreak characters, then each paragraph is a single line.</p><p>To count the number of hard linebreak characters in a text string, you can use the <code>NSString</code> methods <code>getLineStart:end:contentsEnd:forRange:<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_111"></a></code> and <code>lineRangeForRange:<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_112"></a></code>. These methods take a character range as input and return the lines that contain that range. They define lines as character ranges ending in carriage return, newline, carriage return and newline together (in that order, often called CRLF), and the Unicode<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_113"></a> characters for line separator and paragraph separator. For example, the code in <span class="content_text">Listing 1</span> puts into <code>numberOfLines</code> the number of lines in an <code>NSString</code> variable <code>string</code>.</p><a name="//apple_ref/doc/uid/20001810-53954-BAJJFIAB" title="Listing 1Counting hard line breaks"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001810-53954" title="Listing 1Counting hard line breaks"></a><strong>Listing 1&nbsp;&nbsp;</strong>Counting hard line breaks</p><div class="codesample"><table><tr><td scope="row"><pre>NSString *string;<span></span></pre></td></tr><tr><td scope="row"><pre>unsigned numberOfLines, index, stringLength = [string length];<span></span></pre></td></tr><tr><td scope="row"><pre>for (index = 0, numberOfLines = 0; index &lt; stringLength; numberOfLines++)<span></span></pre></td></tr><tr><td scope="row"><pre>    index = NSMaxRange([string lineRangeForRange:NSMakeRange(index, 0)]);<span></span></pre></td></tr></table></div><p>This compact code fragment begins by making a range containing only the first character in string. The <code>lineRangeForRange:<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_114"></a></code> method returns the line containing that character as a range that includes the hard linebreak character (or characters). The <code>NSMaxRange</code> function returns the index of the first character in the next line, which is the value assigned to <code>index</code>. The <code>numberOfLines</code> variable increments, and the <code>for</code> loop repeats, until <code>index</code> is greater than the length of <code>string</code>, at which point <code>numberOfLines</code> contains the number of lines in <code>string</code>, as defined by hard linebreak characters.</p><p>To count the lines generated by the text layout mechanism when it wraps the text to fit into a text container, you can get the information from the layout manager, as shown in <span class="content_text">Listing 2</span>.</p><a name="//apple_ref/doc/uid/20001810-53984-BAJGBAGG" title="Listing 2Counting lines of wrapped text"></a><p class="codesample"><a name="//apple_ref/doc/uid/20001810-53984" title="Listing 2Counting lines of wrapped text"></a><strong>Listing 2&nbsp;&nbsp;</strong>Counting lines of wrapped text</p><div class="codesample"><table><tr><td scope="row"><pre>NSLayoutManager *layoutManager = [textView layoutManager];<span></span></pre></td></tr><tr><td scope="row"><pre>unsigned numberOfLines, index, numberOfGlyphs =<span></span></pre></td></tr><tr><td scope="row"><pre>        [layoutManager numberOfGlyphs];<span></span></pre></td></tr><tr><td scope="row"><pre>NSRange lineRange;<span></span></pre></td></tr><tr><td scope="row"><pre>for (numberOfLines = 0, index = 0; index &lt; numberOfGlyphs; numberOfLines++){<span></span></pre></td></tr><tr><td scope="row"><pre>    (void) [layoutManager lineFragmentRectForGlyphAtIndex:index<span></span></pre></td></tr><tr><td scope="row"><pre>            effectiveRange:&amp;lineRange];<span></span></pre></td></tr><tr><td scope="row"><pre>    index = NSMaxRange(lineRange);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>This code assumes you have a reference to a text view configured with a layout manager, text storage, and text container. The text view returns a reference to the layout manager, which then returns the number of glyphs for all the characters in its associated text storage, performing glyph generation if necessary. The <code>for</code> loop then begins laying out the text and counting the resulting line fragments. The <code>NSLayoutManager</code> method <code>lineFragmentRectForGlyphAtIndex:effectiveRange:<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_115"></a></code> forces layout of the line containing the glyph at the index passed to it. The method returns the rectangle occupied by the line fragment (here ignored) and, by reference, the range of the glyphs in the line after layout. After the method calculates a line, the <code><a href="../../../Reference/Foundation/Miscellaneous/Foundation_Functions/Reference/reference.html#//apple_ref/doc/c_ref/NSMaxRange" target="_top">NSMaxRange</a></code><a name="//apple_ref/doc/uid/20001810-DontLinkElementID_116"></a>function returns the index one greater than the maximum value in the range, that is, the index of the first glyph in the next line. The <code>numberOfLines</code> variable increments, and the <code>for</code> loop repeats, until <code>index</code> is greater than the number of glyphs in the text, at which point <code>numberOfLines</code> contains the number of lines resulting from the layout process, as defined by word wrapping.</p><p>This strategy causes layout of the entire text contained in the text storage object and calculates the number of lines required to lay it out, regardless of the number of text containers filled or text views required to display it. To obtain the number of lines in a single page (which is modeled by a text container), you would use the <code>NSLayoutManager</code> method <code>glyphRangeForTextContainer:<a name="//apple_ref/doc/uid/20001810-DontLinkElementID_117"></a></code> and restrict the line-counting <code>for</code> loop to that range, rather than the <code>{0, numberOfGlyphs}</code> range, which includes all of the text.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="StringHeight.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Articles/TextTables.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2003, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Cocoa/Conceptual/TextLayout/Tasks/CountLines.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Cocoa/Conceptual/TextLayout/Tasks/CountLines.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Cocoa/Conceptual/TextLayout/Tasks/CountLines.html%3Fid%3D10000158i-3.4&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
