<HTML>	<HEAD>		<META HTTP-EQUIV="content-type" CONTENT="text/html;charset=iso-8859-1">		<META NAME="generator" CONTENT="GoLive CyberStudio">		<script language="JavaScript" src="frametest.js"></script><TITLE>ATA_DrvrRegister</TITLE>	</HEAD>	<BODY BGCOLOR="#ffffff"><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><table border="0" cellpadding="0" cellspacing="2" width="432">		<tr>	<td scope="row"><font face="Geneva,Helvetica,Arial" size="1">	<b>PATH<img src="../../../images/space.gif" width="6" height="12"></b>	<a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a --> 	<b>&gt;</b> <a href="../../devicemgrs.html">Device Managers and Drivers</a>	<b>&gt;</b> <a href="../ata.html" target="_top">ATA Devices</a>	<b>&gt;</b> ATA Device Software Guide		</font></td>	</tr>	</table><br><!-- end of path --><P><A HREF="ATA.2a.html"><img src="images/up.gif" border="0"></A> <A HREF="ATA.33.html"><img src="images/previous.gif" border="0"></A> <A HREF="ATA.35.html"><img src="images/next.gif" border="0"></A> <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></a></div><!-- end top navigation --><hr>		<A NAME="pgfId=1194"></A><H3>ATA_DrvrRegister</H3>		<P CLASS="T0.Text0"><A NAME="pgfId=1195"></A>The <TT CLASS="cv">ATA_DrvrRegister</TT> function registers the driver reference number passed in for		the selected drive. The function doesn't check for the existence		of another driver. Any active driver that controls one or more		devices through the ATA Manager must register with the manager		to insure proper operation and notification of events. The first		driver to register for the device gets the device. All subsequent		registrations for the device are rejected. <A NAME="marker=1196"></A><A NAME="marker=1197"></A></P>		<P CLASS="T1.Text1"><A NAME="pgfId=1198"></A>The manager function code for the <TT CLASS="cv">ATA_DrvrRegister</TT> function is $85. </P>		<P CLASS="T1.Text1"><A NAME="pgfId=1199"></A>The parameter block associated with <TT CLASS="cv">ataPBVers</TT> of 1 is defined below:</P>		<P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=14523"></A><TABLE>			<TR>				<TD COLSPAN="2" VALIGN="TOP"><TT>typedef</TT></TD>				<TD VALIGN="TOP" WIDTH="100"><TT>struct</TT></TD>				<TD VALIGN="TOP" WIDTH="200"><TT>/* Driver registration */<BR>				/* structure for ataPBVers 1 */</TT></TD>			</TR>			<TR>				<TD COLSPAN="4">{</TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>ataPBHdr</TT></TD>				<TD WIDTH="100" VALIGN="TOP"></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* ataPBHdr parameter block */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>drvrRefNum;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Driver reference number */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>UInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>FlagReserved;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Reserved (should be zero)*/</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>UInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>deviceNextID;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Not used */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>Reserved[21];</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Reserved */</TT></TD>			</TR>			<TR>				<TD COLSPAN="4">} ataDrvrRegister;</TD>			</TR>		</TABLE>		</CODE></P>		<H4>Field descriptions</H4>		<DL COMPACT>			<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14525"></A><TT CLASS="cv">ataPBHdr</TT> 			<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1210"></A>See the definition of the <TT CLASS="cv"><A HREF="ATA.26.html" CLASS="XRef">ataPBHdr</TT> parameter block</A>.			<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14534"></A><TT CLASS="cv">drvrRefNum</TT> 			<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1211"></A>This field specifies the driver reference number to be registered.			This value must be less than 0 to be valid. 			<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14543"></A><TT CLASS="cv">FlagReserved</TT> 			<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1212"></A>Reserved.			<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14552"></A><TT CLASS="cv">deviceNextID</TT> 			<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1213"></A>Not used by this function.			<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14561"></A><TT CLASS="cv">Reserved[21]</TT> 			<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1214"></A>This field is reserved. To ensure future compatibility, all reserved			fields should be set to 0.		</DL>		<P CLASS="T1.Text1"><A NAME="pgfId=1215"></A>The parameter block associated with <TT CLASS="cv">ataPBVers</TT> of 2 or greater is defined below:</P>		<P><CODE CLASS="RD.RoutineDeclare"><A NAME="pgfId=14572"></A><TABLE>			<TR>				<TD COLSPAN="2" VALIGN="TOP"><TT>typedef</TT></TD>				<TD VALIGN="TOP" WIDTH="100"><TT>struct</TT></TD>				<TD VALIGN="TOP" WIDTH="200"><TT>/* Driver registration */<BR>				/* structure for ataPBVers 2 */<BR>				/* or greater */<BR>				</TT></TD>			</TR>			<TR>				<TD COLSPAN="4">{</TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>ataPBHdr</TT></TD>				<TD WIDTH="100" VALIGN="TOP"></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* ataPBHdr parameter block */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>drvrRefNum;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Driver reference number */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>UInt16drvr</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>Flags;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Driver flags, set to 0 */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>UInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>deviceNextID;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Not used */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>Reserved;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Reserved (should be 0) */</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>ProcPtr</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>ataEHandlerPtr;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Event handler routine */<BR>				/* pointer */<BR>				</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt32</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>drvrContext;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Value to pass in with */<BR>				/* event handler */ <BR>				</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>UInt32</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>ataEventMask;</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* --&gt; Masks of various events */<BR>				/* for event handlers */<BR>				</TT></TD>			</TR>			<TR>				<TD WIDTH="20" VALIGN="TOP"></TD>				<TD WIDTH="75" VALIGN="TOP"><TT>SInt16</TT></TD>				<TD WIDTH="100" VALIGN="TOP"><TT>Reserved[14];</TT></TD>				<TD WIDTH="200" VALIGN="TOP"><TT>/* Reserved */</TT></TD>			</TR>			<TR>				<TD COLSPAN="4"><TT>} ataDrvrRegister;</TT></TD>			</TR>		</TABLE>		</CODE></P>		<P CLASS="T1.Text1"><A NAME="pgfId=1235"></A>The version 2 parameter block also allows another type of registration;		&quot;notify-all&quot; driver registration. The &quot;notify-all&quot; driver registration		is identified by a value of -1 in the <TT CLASS="cv">deviceID</TT> field of the header and bit 0 of <TT CLASS="cv">drvrFlags</TT> set to 0. The &quot;notify-all&quot; driver registration is used if notification		of all device insertions is desired. Registered default drivers		are called if no media driver is found on the media. Typically,		an INIT driver registers as a &quot;notify-all&quot; driver. The single		driver may register as a &quot;notify-all&quot; driver, and then later,		register for one or more devices on the bus.</P>		<BLOCKQUOTE>			<P>			<DIV><A NAME="pgfId=14574"></A><B>Note</B><BR>				<A NAME="pgfId=1236"></A>All PCMCIA/ATA and notify-all device drivers must register using				the parameter block version 2 and utilize the event handling capability				in order to insure proper operation. See the description of the				<TT CLASS="cv">ataEHandlerPtr</TT>, <TT CLASS="cv">driverContent</TT>, and <TT CLASS="cv">ataEventMask</TT> fields for additional information related to event handling.</P>			</BLOCKQUOTE>			<H4><BR>			Field descriptions</H4>			<DL COMPACT>				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14576"></A><TT CLASS="cv">ataPBHdr</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1240"></A>See the definition of the <TT CLASS="cv"><A HREF="ATA.26.html" CLASS="XRef">ataPBHdr</TT> parameter block</A>.				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14585"></A><TT CLASS="cv">drvrRefNum</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1241"></A>This field specifies the driver reference number to be registered.				This value must be less than 0 to be valid. 				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14594"></A><TT CLASS="cv">drvrFlags</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1242"></A>No bit definition has been defined for the field. This field shall				be set to 0 in order to insure compatibility in the future. 				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14603"></A><TT CLASS="cv">deviceNextID</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1243"></A>Not used by this function.				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14612"></A><TT CLASS="cv">Reserved</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1244"></A>Reserved.				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14621"></A><TT CLASS="cv">ataEHandlerPtr</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1245"></A>A pointer to event handler routine for the driver. This routine				is called whenever an event happens, and the mask bit for the				particular event is set in the <TT CLASS="cv">ataEventMask</TT> field. 				<DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=1246"></A>The calling convention for the event handler is as follows:				<DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=1247"></A><TT CLASS="cv"><BR>				pascal SInt16 (ataEHandlerPtr) (ATAEventRec*);</TT> 				<DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=1248"></A><BR>				where <TT CLASS="cv">ATAEventRec</TT> is defined as follows:				<DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=1249"></A><TT CLASS="cv"><TABLE>					<TR>						<TD COLSPAN="2"><TT>typedef</TT></TD>						<TD WIDTH="100">struct</TD>						<TD WIDTH="200"></TD>					</TR>					<TR>						<TD COLSPAN="4">{ </TD>					</TR>					<TR>						<TD WIDTH="20"></TD>						<TD WIDTH="75"><TT>UInt16</TT></TD>						<TD WIDTH="100">evenCode;</TD>						<TD WIDTH="200">/* ATA event code */ </TD>					</TR>					<TR>						<TD WIDTH="20"></TD>						<TD WIDTH="75"><TT>UInt16</TT></TD>						<TD WIDTH="100"><TT>phyDrvRef;</TT></TD>						<TD WIDTH="200"><TT>/* ID associated with */<BR>						/* the event */</TT></TD>					</TR>					<TR>						<TD WIDTH="20"></TD>						<TD WIDTH="75"><TT>SInt32</TT></TD>						<TD WIDTH="100"><TT>drvrContext;</TT></TD>						<TD WIDTH="200"><TT>/* Context passed in by */ <BR>						/* the driver */</TT></TD>					</TR>					<TR>						<TD COLSPAN="4">} ATAEventRec;</TD>					</TR>				</TABLE>				<BR>				<BR>				</TT>				<DT CLASS="DT.DefinitionTerm"><TT CLASS="cv"><A NAME="pgfId=14656"></A>drvrContext</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1250"></A>A value to be passed in when the event handler is called. This				value is loaded in the <TT CLASS="cv">ATAEventRec</TT> before calling the event handler.				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14665"></A><TT CLASS="cv">ataEventMask</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1251"></A>The mask defined in this field is used to indicate whether the				event handler should be called or not, based on the event. The				event handler is only called if the mask for the event has been				set (1). If the mask is not set (0) for an event, the ATA Manager				takes no action. The following masks have been defined:				<DD CLASS="DD.DefinitionDefCont"><A NAME="pgfId=1252"></A><TABLE BORDER="1" CELLPADDING="2" CELLSPACING="2" WIDTH="439">					<TR ALIGN="LEFT" VALIGN="TOP">						<TD ALIGN="LEFT" VALIGN="TOP">						Bits						</TD>						<TD>						Event mask						</TD>					</TR>					<TR>						<TD>						0x00						</TD>						<TD ALIGN="LEFT" VALIGN="TOP">						Null event					</TD>					</TR>					<TR>						<TD>						0x01						</TD>						<TD ALIGN="LEFT" VALIGN="TOP">						Online event - indicates an ATA or ATAPI device is available for							use. This event occurs when a new device is connected to the bus							or when a previously unavailable deviec becomes available again,							such as after a system wakeup when power is restored to the device.							If the device has a registered driver, only that driver will be							notified of the event. Otherwise, each registered default driver							will be notified until a driver responds with a noErr to the event.							For a newly connected device, the driver loaded from the device							media has priority. Device drivers should keep track of whether							or not the device coming online is a newly connected device or							one that is currently offline, but connected. A device should							be considered connected until a device removed event (0x03) for							the device occurs.						</TD>					</TR>					<TR>						<TD>						0x02						</TD>						<TD>						Offline event - a device has gone offline. This event notifies							the registered driver of an ATA or ATAPI device that the device							is offline and unavailable for use. The device is however still							connected to the bus and the state is considered to be temporary.							This event is sent at system sleep when the power is removed from							the device. The event is curretly sent only when the ATA Manager							receives a PM_SUSPEND event from the PC Card Manager. Drivers							receiving offline events should maintain control of the device							but deny access to the device from its clients. When the device							is available again, an Online event is received, it may be necessary							to reconfigure the device.						</TD>					</TR>					<TR>						<TD>						0x03					</TD>						<TD>						Device removed event - a device has been removed. This event notifies							the registered driver of an ATA or ATAPI device that the device							has been removed. The removal may be either controlled, such as							a software eject, or uncontrolled, such as a forced removal by							the user. The device may have been online or offline before the							removal. If the device was online before the removal, an offline							event is not generated, since the removal implies that an offline							condition had to occur.						</TD>					</TR>					<TR>						<TD>						0x04					</TD>						<TD>						Reset event - a device has been reset. This event notifies the							registered driver of an ATA or ATAPI device that the device has							been reset. The device may need to be reconfigured by the driver							before it can be used again. This event is for use with multiple							devices on one bus, such as a ATA master/slave configuration.							The Apple ATA implementation doesn't currently support multiple							devices on a bus, therefore this event is not used. However, it							is recommended that drivers support this event to ensure future							compatibility when the event is implemented.						</TD>					</TR>					<TR>						<TD>					0x05						</TD>						<TD>						Offline request event - a request to put the device offline has							been detected. This event is now obsolete. The funtion of this							event was similar to a sleep request event. However, the current							PC Card Manager allows only for an event like a sleep demand event,							which does not permit rejection by the client.						</TD>					</TR>					<TR>						<TD>						0x06						</TD>						<TD>						Eject request event - a request to eject a device has been detected.							This event notifies the driver of an ATA or ATAPI device that							a request has been made to eject the device. If the response to							the request is 0, the device is ejected and a subsequent Device							Removed event (0x03) will be generated. The Eject request event							acts as a protection mechanism to alert drivers of a pending ejecttion.							A driver will generally want to reject the request unless they							actually initiated it, since the ejection removes the device from							the bus.						</TD>					</TR>					<TR>						<TD>						0x07					</TD>						<TD>						Configuration update event - the system configuration has changed							(more devices)					</TD>					</TR>					<TR>						<TD>						0x08-0x1F						</TD>						<TD>						Reserved						</TD>					</TR>				</TABLE>				<DD>            &nbsp;				<DT CLASS="DT.DefinitionTerm"><A NAME="pgfId=14889"></A><TT CLASS="cv">Reserved[21]</TT> 				<DD CLASS="DD.DefinitionDef"><A NAME="pgfId=1253"></A>This field is reserved. To ensure future compatibility, all reserved				fields should be set to 0.			</DL>			<H5 CLASS="RSb.RoutineSbhd">			<DIV><A NAME="pgfId=1254"></A>RESULT CODES</H5>				<P CLASS="T0.Text0"><A NAME="pgfId=1258"></A>See <A HREF="ATA.3a.html#37212" CLASS="XRef">Table&nbsp;A-1</A> for possible result codes returned by the ATA Manager.</P>				<P>			</DIV>			<HR>			&copy; 1999 Apple Computer, Inc. </P>			<P><A HREF="ATA.2a.html"><img src="images/up.gif" border="0"></A> <A HREF="ATA.33.html"><img src="images/previous.gif" border="0"></A> <A HREF="ATA.35.html"><img src="images/next.gif" border="0"></A>  <!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!-- document.write(frameLink);//--></script></a><!-- end Show/Hide frames --></P><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer -->		</BODY>	</HTML>