<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"            "http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="Stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN2018: Importing animated GIFs</title><meta name="keywords" content="Animated GIF, GraphicsImportGetImageCount, Importing, CanQuickTimeOpenFile,CanQuickTimeOpenDataRef"><meta name="Description" content="Technical Note TN2018: This technote describes how to tellif a GIF file or dataref contains more than one frame, andwhy GraphicsImportGetImageCount will return a value of 1even when a GIF is animated."><meta name="categories" content="QuickTime"><meta name="week-posted" content="Apr 16, 2001 - Apr 20, 2001"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10003057" title="Importing animated GIFs"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/QuickTime/index.html">QuickTime</a> &gt; <a href="../../technicalnotes/QuickTime/idxImportExport-date.html">Import & Export</a> &gt; </p><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN2018</div>
<div id="pageheadsub">Importing animated GIFs</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left">         <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><A HREF="#Overview">Overview</A><BR><BR><A HREF="#QuickTime5">New for QuickTime 5</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                 <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left>            <!-- begin_intro_text --><P id = "introtext">This technote describes how to tell if a GIF file or dataref contains more than one frame, and why <code>GraphicsImportGetImageCount</code> will return a value of <code>1</code> even when a GIF is animated. It also introduces two new QuickTime 5 APIs - <code>CanQuickTimeOpenFile</code> and <code>CanQuickTimeOpenDataRef</code>, which are used to ask QuickTime if a file or dataref can be opened as a Movie or using a Graphics Importer.</p><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Apr 17 2001]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR>          <!-- begin_content -->          <P><A NAME=Overview></A></P>         <H2>Overview</H2>                  <P>The GIF Graphics Importer will only display the first frame of animated GIF, so calling the GIF Graphics Importers <code>GraphicsImportGetImageCount</code> function will return a value of <code>1</code>.</p><P>Graphics Importers generally don't know about time, or how to combine key frames and difference frames. In addition, displaying the difference frames of an animation is generally not going to look very good without first drawing all the previous frames.</p><P>The Movie Toolbox, on the other hand, knows about time, and how to handle frame-differenced animations. Therefore, to draw the other frames in an animated GIF, import the GIF as a Movie.</p><P>To find out if a GIF file contains more than one frame, first open the GIF as a Movie, then count the frames in the video track. If there are multiple frames/samples treat it like a Movie; if there is only one frame/sample, the GIF is a single still image and the GIF Graphics Importer can be used instead.</p><P><code>GetAnimatedGIFMovieFromFile</code> (see <a href="#listing1">Listing 1</a>) opens a file by using <code>NewMovieFromFile</code>, then counts the frames. It will return a valid inactive Movie if the opened GIF is animated, or <code>NULL</code> if it's a single image, in which case the caller can use a Graphics Importer.</p><P>Opening a GIF file as a Movie works faster if you don't pass the <code>newMovieActive</code> flag to <code>NewMovieFromFile</code>. If you decide to use the Movie after all (because it is an animated GIF), make the Movie active by calling <code>SetMovieActive</code>.</p><P><a href="#listing2">Listing 2</a> illustrates an alternate implementation of <code>GetAnimatedGIFMovieFromFile</code>. It creates a alias data reference then calls <code>GetAnimatedGIFMovieFromDataRef</code> (see Listing 3). Handling data references add the ability to open animated GIFs from memory and URLs.</p><P><a href="#listing3">Listing 3</a> shows how <code>GetAnimatedGIFMovieFromDataRef</code> performs the same task as listing 1 but using data references.</p><P><a href="#listing4">Listing 4</a> gives an example of how <code>CreateGIFHandleDataReference</code> creates a handle data reference with an added <code>'GIFf'</code> file type extension. If you have a GIF image in memory, this function can be used to easily create a handle data reference before calling <code>GetAnimatedGIFMovieFromDataRef</code>. Remember to dispose of the data reference handle when you're done with it.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>In reality there's nothing specific to GIFs in the code listings except for the creation of the data reference in listing 4, they are named <code>GetAnimatedGIFMovie</code> only for the sake of this discussion.</P></TD></TR></TABLE></CENTER><BR>         <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=QuickTime5></A></P>         <H2>New for QuickTime 5</H2>         QuickTime 5 has added a couple of new APIs that can be used to determine whether a file or data reference can be opened as a Movie, using a Graphics Importer, or both.<code>CanQuickTimeOpenFile</code> determines whether the file, or a given file type, could be opened using a graphics importer or opened as a movie.<BR><BR><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr CanQuickTimeOpenFile(FSSpecPtr     fileSpec,                           OSType        fileType,                           OSType        fileNameExtension,                           Boolean *     outCanOpenWithGraphicsImporter,                           Boolean *     outCanOpenAsMovie,                           Boolean *     outPreferGraphicsImporter,                           UInt32        inFlags);</pre>	</TD></TR></TABLE></CENTER><p><code>CanQuickTimeOpenDataRef</code> is similar to <code>CanQuickTimeOpenFile</code> except that it uses a data reference instead of a file.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr CanQuickTimeOpenDataRef(Handle      dataRef,                              OSType      dataRefType,                              Boolean *   outCanOpenWithGraphicsImporter,                              Boolean *   outCanOpenAsMovie,                              Boolean *   outPreferGraphicsImporter,                              UInt32      inFlags);</pre>	</TD></TR></TABLE></CENTER><p>Pass in <code>NULL</code> for parameters you don't particularly care about.</p><p>The <code>inFlags</code> parameter specifies flags that modify the Importer search behavior.  They are:</p> 					  <ul>	<li><code>kQTDontUseDataToFindImporter</code> - Don't use data in the file, speeds up the search but will cause QuickTime to report that it can not open files which aren't identified by a recognized file type or file name suffix.<BR><BR></li>	<li><code>kQTDontLookForMovieImporterIfGraphicsImporterFound</code> - Stop the search as soon as one way to open the file is found. Use this flag if you want to know whether a file can be opened with a graphics importer or as a movie, but you don't care which.<BR><BR></li>	<li><code>kQTAllowOpeningStillImagesAsMovies</code> - Consider opening still images as movies. When set, files that can be opened using a graphics importer will automatically be reported as being able to be opened as movies.<BR><BR></li>	<li><code>kQTAllowImportersThatWouldCreateNewFile</code> - Include importers which create new files. When clear includes only importers which can import in place without needing to create new files.<BR><BR></li>	<li><code>kQTAllowAggressiveImporters</code> - Set to include movie importers for file types like PICT and TEXT that aren't traditionally thought of as movies.<BR><BR></li></ul><p>For more information regarding the new <code>CanQuickTimeOpenFile/DataRef</code> calls, see the QuickTime 5 Developer Delta Documentation.</p><a name="listing1"></a><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// return a movie if the GIF is animated, NULL otherwiseMovie GetAnimatedGIFMovieFromAFile(const FSSpec *inFile){    Movie    theMovie = NULL;    short    theRefNum = 0;    long    theNumberOfSamples = 0;    OSErr     err = noErr;    err = OpenMovieFile(inFile, &amp;theRefNum, fsRdPerm);    if (err) goto done;    err = NewMovieFromFile(&amp;theMovie, theRefNum, NULL, NULL, 0, NULL);    CloseMovieFile(theRefNum);    if (err || NULL == theMovie) goto done;    theNumberOfSamples =            GetMediaSampleCount(GetTrackMedia(GetMovieIndTrack(theMovie, 1)));    if (theNumberOfSamples == 1 ) {        DisposeMovie(theMovie);        theMovie = NULL;    }done:    return theMovie;}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 1.</b> <code>GetAnimatedGIFMovieFromFile</code>.</p>	</TD></TR></TABLE></CENTER><BR><a name="listing2"></a><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// return a movie if the GIF is animated, NULL otherwiseMovie GetAnimatedGIFMovieFromFile(const FSSpec *inFile){    Movie         theMovie = NULL;    AliasHandle theAlias = NULL;    OSErr         err = noErr;    err = QTNewAlias(inFile, &amp;theAlias, true);    if (err) goto done;    theMovie = GetAnimatedGIFMovieFromDataRef((Handle)theAlias, rAliasType);    DisposeHandle((Handle)theAlias);done:    return theMovie;}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 2.</b> <code>GetAnimatedGIFMovieFromFile</code> (using an alias data reference).</p>	</TD></TR></TABLE></CENTER><BR><a name="listing3"></a><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// return a movie if the GIF is animated, NULL otherwiseMovie GetAnimatedGIFMovieFromDataRef(Handle inDataRef, OSType inDataRefType){    Movie    theMovie = NULL;    long    theNumberOfSamples = 0;    OSErr    err = noErr;    if (NULL == inDataRef) goto done;    err = NewMovieFromDataRef(&amp;theMovie, 0, NULL, inDataRef, inDataRefType);    if (err || NULL == theMovie ) goto done;    theNumberOfSamples =            GetMediaSampleCount(GetTrackMedia(GetMovieIndTrack(theMovie, 1)));    if (theNumberOfSamples == 1 ) {        DisposeMovie(theMovie);        theMovie = NULL;    }done:    return theMovie;}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 3.</b> <code>GetAnimatedGIFMovieFromDataRef</code>.</p>	</TD></TR></TABLE></CENTER><BR><a name="listing4"></a><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>// create a dataRef handle with a 'GIFf' file type extensionHandle CreateGIFHandleDataReference(Handle inData){    Handle    theDataRef = NULL;    long    theFileTypeAtom[3] = {0};    OSErr     err = noErr;    // create a data reference handle for our data    err = PtrToHand(&amp;inData, &amp;theDataRef, sizeof(Handle));    if (err) goto done;    // no file name    err = PtrAndHand(&quot;\p&quot;, theDataRef, 1);    if (err) goto done;    // add the 'GIFf' 'ftyp' atom dataRef extension    theFileTypeAtom[0] = EndianU32_NtoB(sizeof(long) * 3);    theFileTypeAtom[1] = EndianU32_NtoB(kDataRefExtensionMacOSFileType);    theFileTypeAtom[2] = EndianU32_NtoB(kQTFileTypeGIF);    err = PtrAndHand(theFileTypeAtom, theDataRef, sizeof(long) * 3);done:    if (theDataRef &amp;&amp; err) {        DisposeHandle(theDataRef);        theDataRef = NULL;    }    return theDataRef;}</pre>	</TD></TR><TR>	<td align="left"><P><b>Listing 4.</b> <code>CreateGIFHandleDataReference</code>.</p>	</TD></TR></TABLE></CENTER><BR>         <P><A HREF="#top">Back to top</A></P>                                    <P><A NAME=Downloads></A></P>         <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (48K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn2018.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn2018.html%3Fid%3DDTS10003057-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn2018.html%3Fid%3DDTS10003057-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn2018.html%3Fid%3DDTS10003057-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>