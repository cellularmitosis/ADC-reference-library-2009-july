<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Universal Binary Programming Guidelines, Second Edition: Rosetta</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Rosetta"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002217-CH210" title="Rosetta"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index-date.html#//apple_ref/doc/uid/TP30000440-TP30000471" target="_top">Mac OS X</a> &gt; <a href="../universal_binary_intro/universal_binary_intro.html#//apple_ref/doc/uid/TP40002217-CH204-TPXREF101">Universal Binary Programming Guidelines, Second Edition</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_vector/universal_binary_vector.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_matrix_a/universal_binary_matrix_a.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40002217-CH210-TPXREF101" title="Rosetta"></a><h1>Rosetta</h1><p>Rosetta is a translation process that runs a PowerPC binary on an Intel-based Macintosh computer—it allows applications to run as nonnative binaries. Many, but not all, applications can run translated. Applications that run translated will never run as fast as they run as a native binary because the translation process itself incurs a processing cost.</p>
<p>How compatible your application is with Rosetta depends on the type of application it is. An application such as a word processor that has a lot of user interaction and low computational needs is quite compatible. An application that requires a moderate amount of user interaction and has some high computational needs or that uses OpenGL is most likely also quite compatible. One that has intense computing needs isn’t compatible. This includes applications that need to repeatedly compute fast Fourier transforms (FFTs), that compute complex models for 3-D modeling, or that compute ray tracing.</p>
<p>To the user, Rosetta is transparent. Unlike Classic, when the user launches an application, there aren’t any visual cues to indicate that the application is translated. The user may perceive that the application is slow to start up or that the performance is slower than it is on a PowerPC-based Macintosh. The user can discover whether an application has only a PowerPC binary by looking at the Finder information for the application. (See <span class="content_text"><a href="../universal_binary_compiling/universal_binary_build.html#//apple_ref/doc/uid/TP40002217-CH206-240184">“Determining Whether a Binary Is Universal.”</a></span>)</p>
<p>This appendix discusses the sorts of applications that can run translated, describes how Rosetta works, points out special considerations for translated applications, shows how to force an application to run translated using Rosetta, describes how to programmatically detect whether an application is running nonnatively, and provides troubleshooting information if your application won’t run translated but you think that it should.</p>


<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-BCICICJH">What Can Be Translated?</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-235833">How It Works</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-236785">Special Considerations</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-BAJDHEDD">Forcing an Application to Run Translated</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-241017">Preventing an Application from Opening Using Rosetta</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-BAJEBJJF">Programmatically Detecting a Translated Application</a>
				
			<br/>
			
        
			
			
				<a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-235927">Troubleshooting</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002217-CH210-236747" title="What Can Be Translated?"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BCICICJH" title="What Can Be Translated?"></a><h2>What Can Be Translated?</h2>
<p>Rosetta is designed to translate currently shipping applications that run on a PowerPC with a G3 or G4 processor and that are built for Mac OS X. That includes CFM as well as Mach-O PowerPC applications.</p>
<p>Rosetta does <em>not</em> run the following:</p>
<ul class="ul"><li class="li"><p>Applications built for any version of the Mac OS earlier than Mac OS X —that means Mac OS 9, Mac OS 8, Mac OS 7, and so forth</p></li>
<li class="li"><p>The Classic environment</p></li>
<li class="li"><p>Screen savers written for the PowerPC architecture</p></li>
<li class="li"><p>Code that inserts preferences in the System Preferences pane</p></li>
<li class="li"><p>Applications that require a G5 processor</p></li>
<li class="li"><p>Applications that depend on one or more PowerPC-only kernel extensions</p></li>
<li class="li"><p>Kernel extensions</p></li>
<li class="li"><p> Java applications with JNI libraries</p></li>
<li class="li"><p> Java applets in applications that Rosetta can translate; that means a web browser that Rosetta can run translated will not be able to load Java applets.</p></li></ul>
<p>Rosetta does not support precise exceptions. Any application that relies on register states being accurate in exception handlers or signal handlers will not function properly running with Rosetta.</p>
<p>For more information on the limitations of Java applications using Rosetta, see <span class="content_text"><a href="../universal_binary_tips/universal_binary_tips.html#//apple_ref/doc/uid/TP40002217-CH239-296312">“Java Applications”</a></span> and <em>Technical Q &amp;A QA1295, Java on Intel-based Macintosh Computers</em>, which is in the <span class="content_text"><a href="../../../../../technicalqas/Java/index-title.html" target="_top">ADC Reference Library</a></span>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-235833" title="How It Works"></a><h2>How It Works</h2>
<p>When an application launches on an Intel-based Macintosh computer, the kernel detects whether the application has a native binary. If the binary is not native, the kernel launches the binary using Rosetta. If the application is one of those that can be translated, it launches and runs, although not as fast as it would as a native binary. Behind the scenes, Rosetta translates and executes the PowerPC binary code.</p>
<p>Rosetta runs in the same thread of control as the application. When Rosetta starts an application, it translates a block of application code and executes that block. As Rosetta encounters a call to a routine that it has not yet translated, it translates the needed routine and continues the execution. The result is a smooth and continual transitioning between translation and execution. In essence, Rosetta and your application work together in a kind of symbiotic relationship.</p>
<p>Rosetta optimizes translated code to deliver the best possible performance on the nonnative architecture. It uses a large translation buffer, and it caches code for reuse. Code that gets reused repeatedly in your application benefits the most because it needs to be translated only once. The system uses the cached translation, which is faster than translating the code again.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-236785" title="Special Considerations"></a><h2>Special Considerations</h2>
<p>Rosetta must run the entire process when it translates. This has implications for applications that use third-party plug-ins or any other component that must be loaded at the time your application launches. All parts (application, plug-ins, or other components needed at launch time) must run either nonnatively or natively. For example, if your application is built as a universal binary, but it uses a plug-in that has only a PowerPC binary, then your application needs to run nonnatively on an Intel-based Macintosh computer to use the nonnative plug in.</p>
<p>Rosetta takes endian issues into account when it translates your application. Multibyte data that moves between your application and any system process is automatically handled for you—you don’t need to concern yourself with the endian format of the data.</p>
<p>The following kinds of multibyte data can have endian issues if the data moves between:</p>
<ul class="ul"><li class="li"><p>Your translated application and a native process that’s not a system process</p></li>
<li class="li"><p>A custom pasteboard provided by your translated application and a custom pasteboard provided by a native application</p></li>
<li class="li"><p>Data files or caches provided by your translated application and a native application</p></li></ul>
<p>You might encounter this scenario while developing a universal binary. For example, if you’ve created a universal binary for a server process that your application relies on, and then test that process by running your application as a PowerPC binary, the endian format of the data passed from the server to your application would be wrong. You encounter the same problem if you create a universal binary for your application, but have not yet done so for a server process needed by the application.</p>
<p>Structures that the system defines and that are written using system routines will work correctly. But consider the code in <span class="content_text">Listing A-1</span>.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-238078" title="Listing A-1A structure whose endian format depends on the architecture"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJFFHCA" title="Listing A-1A structure whose endian format depends on the architecture"></a><p class="codesample"><strong>Listing A-1&nbsp;&nbsp;</strong>A structure whose endian format depends on the architecture</p>
<div class="codesample"><table><tr><td scope="row"><pre>typedef struct<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int x;<span></span></pre></td></tr><tr><td scope="row"><pre>    int y;<span></span></pre></td></tr><tr><td scope="row"><pre>} data_t<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>void savefile(data_t data, int filehandle)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>  write(filehandle, &amp;data, sizeof(data));<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>When run using Rosetta, the application will write a big-endian structure; <em>x</em> and <em>y</em> are both written as big-endian integers. When the application runs natively on an Intel-based Macintosh, it will write out a little-endian structure; <em>x</em> and <em>y</em> are written as little-endian integers. It is up to you to define data formats on disk to be of a canonical endian format. Endian-specific data formats are fine as long as any application that reads or write the data understands what the endian format of the data is and treats the data appropriately.</p>
<p>Keep in mind that private frameworks and plug-ins can also encounter these sorts of endian issues. If a private framework creates a cache or data file, and the framework is a universal binary, then it will try to access the cache from both native and PPC processes. The framework either needs to account for the endian format of the cache when reading or writing data or needs to have two separate caches.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-236978" title="Forcing an Application to Run Translated"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJDHEDD" title="Forcing an Application to Run Translated"></a><h2>Forcing an Application to Run Translated</h2>
<p>Assuming that the application meets the criteria described in <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-236747">“What Can Be Translated?,”</a></span> applications that have only a PowerPC binary automatically run as translated on an Intel-based Macintosh. For testing purposes, there are several ways that you can force applications that have a universal binary to launch as a PowerPC binary on an Intel-based Macintosh:</p>
<ul class="ul"><li class="li"><p>For applications, <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-240406">“Make a Setting in the Info Window”</a></span></p></li>
<li class="li"><p>For command-line tools <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-240453">“Use Terminal”</a></span></p></li>
<li class="li"><p>For an application that you are writing, <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-240495">“Modify the Property List”</a></span></p></li>
<li class="li"><p>Programmatically, <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-240562">“Use the sysctlbyname Function”</a></span></p></li></ul>
<p>Each of these methods is described in this section.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-240406" title="Make a Setting in the Info Window"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJCBEGD" title="Make a Setting in the Info Window"></a><h3>Make a Setting in the Info Window</h3>
<p>You can manually set which binary to execute on an Intel-based Macintosh computer by selecting the “Open using Rosetta” option in the Info window of the application. To set the option, click the application icon, then press Command-I to open the Info window. Make the setting, as shown in <span class="content_text">Figure A-1</span>.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40002217-CH210-240435" title="Figure A-1The Info window for the Calculator application"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BCIGJEDF" title="Figure A-1The Info window for the Calculator application"></a><p><strong>Figure A-1&nbsp;&nbsp;</strong>The Info window for the Calculator application</p><img src = "../art/force_nn.gif" alt = "The Info window for the Calculator application" width="236" height="415"></div><br/>
<a name="//apple_ref/doc/uid/TP40002217-CH210-240453" title="Use Terminal"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJDIJFA" title="Use Terminal"></a><h3>Use Terminal</h3>
<p>You can force a command-line tool to run translated by entering the following in Terminal:</p>
<div class="codesample"><table><tr><td scope="row"><pre>ditto -arch ppc &lt;toolname> /tmp/toolname<span></span></pre></td></tr><tr><td scope="row"><pre>/tmp/toolname<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH210-240495" title="Modify the Property List"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJJCJCI" title="Modify the Property List"></a><h3>Modify the Property List</h3>
<p>You can set the default setting for the “Open using Rosetta” option by adding the following key to the <code>Info.plist</code> of your application bundle:</p>
<div class="codesample"><table><tr><td scope="row"><pre>&lt;key>LSPrefersPPC&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;true/><span></span></pre></td></tr></table></div>
<p>This key informs the system that the application should launch as a PowerPC binary and causes the “Open using Rosetta” checkbox to be selected. You might find this useful if you ship an application that has plug-ins that are not native at the time of shipping.</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-240562" title="Use the sysctlbyname Function"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJDJCJA" title="Use the sysctlbyname Function"></a><h3>Use the sysctlbyname Function</h3>
<p>The <code>exec_affinity</code> routine in <span class="content_text">Listing A-2</span> controls the preferred CPU type for sublaunched processes. You might find this routine useful if you are using <code>fork</code> and <code>exec</code> to launch applications from your application. </p>
<p>The routine calls the <code><!--a-->sysctlbyname<!--/a--></code> function with the <code>"sysctl.proc_exec_affinity"</code> string, passing a constant that specifies the CPU type. Pass <code>CPU_TYPE_POWERPC</code> to launch the PPC executable in a universal binary. (For information on <code>sysctlbyname</code> see <em><a href="../../../../Darwin/Reference/ManPages/index.html#//apple_ref/doc/uid/TP40000894" target="_top">Mac OS X Man Pages</a></em>.)</p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-240595" title="Listing A-2A routine that controls the preferred CPU type for sublaunched processes"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJJAHIC" title="Listing A-2A routine that controls the preferred CPU type for sublaunched processes"></a><p class="codesample"><strong>Listing A-2&nbsp;&nbsp;</strong>A routine that controls the preferred CPU type for sublaunched processes</p>
<div class="codesample"><table><tr><td scope="row"><pre>cpu_type_t exec_affinity (cpu_type_t new_cputype)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    cpu_type_t ret;<span></span></pre></td></tr><tr><td scope="row"><pre>    cpu_type_t *newp = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    size_t sz = sizeof (cpu_type_t);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (new_cputype != 0)<span></span></pre></td></tr><tr><td scope="row"><pre>        newp = &amp;new_cputype;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     if (sysctlbyname("sysctl.proc_exec_affinity",<span></span></pre></td></tr><tr><td scope="row"><pre>            &amp;ret, &amp;sz, newp, newp ? sizeof(cpu_type_t) :  0) == -1) {<span></span></pre></td></tr><tr><td scope="row"><pre>        fprintf(stderr, "exec_affinity: sysctlbyname failed:  %s\n",<span></span></pre></td></tr><tr><td scope="row"><pre>                strerror(errno));<span></span></pre></td></tr><tr><td scope="row"><pre>        return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return ret;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH210-241017" title="Preventing an Application from Opening Using Rosetta"></a><h2>Preventing an Application from Opening Using Rosetta</h2>
<p>To prevent an application from opening using Rosetta, add the following key to the <code>Info.plist</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>&lt;key>LSRequiresNativeExecution&lt;/key><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;true/><span></span></pre></td></tr></table></div>
<a name="//apple_ref/doc/uid/TP40002217-CH210-239589" title="Programmatically Detecting a Translated Application "></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJEBJJF" title="Programmatically Detecting a Translated Application "></a><h2>Programmatically Detecting a Translated Application </h2>
<p>Some developers may want to determine programmatically whether an application is running using Rosetta. For example, a developer writing device interface code may need to determine whether the user client is using the same endian format as the kernel.</p>
<p><span class="content_text">Listing A-3</span> is a utility routine that can call  the <code>sysctlbyname</code> function on a process ID (<code>pid</code>). If you pass a process ID of <code>0</code> to the routine, it performs the call on the current process. Otherwise it performs the call on the process specified by the <code>pid</code> value that you pass. (For information on <code>sysctlbyname</code> see <em><a href="../../../../Darwin/Reference/ManPages/index.html#//apple_ref/doc/uid/TP40000894" target="_top">Mac OS X Man Pages</a></em>.) </p>
<a name="//apple_ref/doc/uid/TP40002217-CH210-239631" title="Listing A-3A utility routine for calling the sysctlbyname function"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJGJHEI" title="Listing A-3A utility routine for calling the sysctlbyname function"></a><p class="codesample"><strong>Listing A-3&nbsp;&nbsp;</strong>A utility routine for calling the <code>sysctlbyname</code> function</p>
<div class="codesample"><table><tr><td scope="row"><pre>static int sysctlbyname_with_pid (const char *name, pid_t pid,<span></span></pre></td></tr><tr><td scope="row"><pre>                            void *oldp, size_t *oldlenp,<span></span></pre></td></tr><tr><td scope="row"><pre>                            void *newp, size_t newlen)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (pid == 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (sysctlbyname(name, oldp, oldlenp, newp, newlen) == -1)  {<span></span></pre></td></tr><tr><td scope="row"><pre>            fprintf(stderr, "sysctlbyname_with_pid(0): sysctlbyname  failed:"<span></span></pre></td></tr><tr><td scope="row"><pre>                     "%s\n", strerror(errno));<span></span></pre></td></tr><tr><td scope="row"><pre>            return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        int mib[CTL_MAXNAME+1];<span></span></pre></td></tr><tr><td scope="row"><pre>        size_t len = CTL_MAXNAME;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (sysctlnametomib(name, mib, &amp;len) == -1) {<span></span></pre></td></tr><tr><td scope="row"><pre>            fprintf(stderr, "sysctlbyname_with_pid: sysctlnametomib  failed:"<span></span></pre></td></tr><tr><td scope="row"><pre>                     "%s\n", strerror(errno));<span></span></pre></td></tr><tr><td scope="row"><pre>            return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        mib[len] = pid;<span></span></pre></td></tr><tr><td scope="row"><pre>        len++;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (sysctl(mib, len, oldp, oldlenp, newp, newlen) == -1)  {<span></span></pre></td></tr><tr><td scope="row"><pre>            fprintf(stderr, "sysctlbyname_with_pid: sysctl  failed:"<span></span></pre></td></tr><tr><td scope="row"><pre>                    "%s\n", strerror(errno));<span></span></pre></td></tr><tr><td scope="row"><pre>            return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return 0;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>
<p>The <code>is_pid_native</code> routine shown in <span class="content_text"><a href="universal_binary_exec_a.html#//apple_ref/doc/uid/TP40002217-CH210-239259">Listing A-4</a></span> calls the <code>sysctlbyname_with_pid</code> routine, passing the string <code>"sysctl.proc_native"</code>. The <code>is_pid_native</code> routine determines whether the specified process is running natively or translated. The routine returns:</p><ul class="ul"><li class="li"><p><code>0</code>  if the process is running translated using Rosetta</p></li><li class="li"><p><code>1</code> if the process is running natively on a PowerPC- or Intel-based Macintosh</p></li><li class="li"><p><code>–1</code>  if an unexpected error occurs</p></li></ul>
<a name="//apple_ref/doc/uid/TP40002217-CH210-239259" title="Listing A-4A routine that determines whether a process is running natively or translated"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJCFFCA" title="Listing A-4A routine that determines whether a process is running natively or translated"></a><p class="codesample"><strong>Listing A-4&nbsp;&nbsp;</strong>A routine that determines whether a process is running natively or translated</p>
<div class="codesample"><table><tr><td scope="row"><pre>int is_pid_native (pid_t pid)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    int ret = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    size_t sz = sizeof(ret);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if (sysctlbyname_with_pid("sysctl.proc_native", pid,<span></span></pre></td></tr><tr><td scope="row"><pre>                &amp;ret, &amp;sz, NULL, 0) == -1) {<span></span></pre></td></tr><tr><td scope="row"><pre>         if (errno == ENOENT) {<span></span></pre></td></tr><tr><td scope="row"><pre>            return 1;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        fprintf(stderr, "is_pid_native: sysctlbyname_with_pid  failed:"<span></span></pre></td></tr><tr><td scope="row"><pre>                "%s\n", strerror(errno));<span></span></pre></td></tr><tr><td scope="row"><pre>        return -1;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return ret;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH210-SW1" title="Note"></a><p><strong>Note:</strong>&nbsp;On Mac OS X v10.4, the <code>proc_native</code> call fails if the current user doesn't own the process being checked.</p></div>
<a name="//apple_ref/doc/uid/TP40002217-CH210-235927" title="Troubleshooting"></a><h2>Troubleshooting</h2>
<p>If you are convinced that your application falls into the category of those that should be able to run using Rosetta but it doesn’t run or it has unexpected behavior, you can follow the procedure in this section to debug your application. This procedure works only for PowerPC binaries—not for a universal binary—and is the only way you can debug a PowerPC binary on an Intel-based Macintosh. Xcode debugging does not work for translated applications.</p>
<p>To debug a PowerPC binary on an Intel-based Macintosh, follow these steps:</p>
<ol class="ol"><li class="li"><p>Open Terminal.</p></li>
<li class="li"><p>Enter the following two lines:</p><p>For <code>tcsh</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>setenv OAH_GDB YES<span></span></pre></td></tr><tr><td scope="row"><pre>/&lt;path>/&lt;your_application>.app/Contents/MacOS/&lt;your_application><span></span></pre></td></tr></table></div><p>For <code>bash</code>:</p>
<div class="codesample"><table><tr><td scope="row"><pre>export OAH_GDB=YES<span></span></pre></td></tr><tr><td scope="row"><pre>/&lt;path>/&lt;your_application>.app/Contents/MacOS/&lt;your_application><span></span></pre></td></tr></table></div><p>You’ll see the Rosetta process launch and wait for a port connection (<span class="content_text">Figure A-2</span>).</p><div class="item_figure"><a name="//apple_ref/doc/uid/TP40002217-CH210-237368" title="Figure A-2Rosetta listens for a port connection"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BAJFJFBF" title="Figure A-2Rosetta listens for a port connection"></a>
<p><strong>Figure A-2&nbsp;&nbsp;</strong>Rosetta listens for a port connection</p>
<img src = "../art/listen.jpg" alt = "Rosetta listens for a port connection" ></div></li>
<li class="li"><p>Open a second terminal window and  start up GDB with the following command:</p><div class="codesample"><table><tr><td scope="row"><pre>gdb --oah<span></span></pre></td></tr></table></div><p>Using GDB on an Intel-based Macintosh computer is just like using GDB on a PowerPC Macintosh.</p></li>
<li class="li"><p>Attach your application. </p><div class="codesample"><table><tr><td scope="row"><pre>attach &lt;your_application><span></span></pre></td></tr></table></div></li>
<li class="li"><p>Press Tab.</p><p>GDB automatically appends the process ID (<code>pid</code>) to your application name. </p></li>
<li class="li"><p>Press Return.</p></li>
<li class="li"><p>Type <code>c</code> to execute your application.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH210-SW2" title="Important"></a><p><strong>Important:</strong>&nbsp;Do not type <code>run</code>. Typing <code>run</code> will not execute your code. It will leave your application in a state that requires you to start over from the first step.</p></div></li></ol>
<p><span class="content_text">Figure A-3</span> shows the commands for initiating a debugging session for a PowerPC binary. After you start the session, you can debug in much the same way as you would debug a native process except that you can’t call functions—either explicitly or implicitly—from within GDB. For example, you can’t inspect CF objects by calling <code><a href="../../../../CoreFoundation/Reference/CFTypeRef/Reference/reference.html#//apple_ref/doc/c_ref/CFShow" target="_top">CFShow</a></code>.</p>
<p>Keep in mind that symbol files aren’t loaded at the start of the debugging session. They are loaded after your application is up and running. This means that any breakpoints you set are “pending breakpoints” until the executable and libraries are loaded.</p>
<br/><div><a name="//apple_ref/doc/uid/TP40002217-CH210-236694" title="Figure A-3Terminal windows with the commands for debugging a PowerPC binary on an Intel-based Macintosh computer"></a><a name="//apple_ref/doc/uid/TP40002217-CH210-BCIIHJFE" title="Figure A-3Terminal windows with the commands for debugging a PowerPC binary on an Intel-based Macintosh computer"></a><p><strong>Figure A-3&nbsp;&nbsp;</strong>Terminal windows with the commands for debugging a PowerPC binary on an Intel-based Macintosh computer</p>
<img src = "../art/debug_ppc.jpg" alt = "Terminal windows with the commands for debugging a PowerPC binary on an Intel-based Macintosh computer" ></div><br/><div class="notebox"><a name="//apple_ref/doc/uid/TP40002217-CH210-SW3" title="Note"></a><p><strong>Note:</strong>&nbsp;Debugging Rosetta applications from within either CodeWarrior or Xcode is not supported.</p></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../universal_binary_vector/universal_binary_vector.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../universal_binary_matrix_a/universal_binary_matrix_a.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2005, 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_exec_a/universal_binary_exec_a.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_exec_a/universal_binary_exec_a.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/MacOSX/Conceptual/universal_binary/universal_binary_exec_a/universal_binary_exec_a.html%3Fid%3DTP40002217-6.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>