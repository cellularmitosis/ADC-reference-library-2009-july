<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> NewWorld Components</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.26.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.34.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.36.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H2.Heading2"><A NAME="pgfId=3387"> </A>NewWorld Components</H1><P CLASS="T1.Text1"><A NAME="pgfId=4032"> </A>The three main areas of change, which can be thought of as new components, in the NewWorld architecture are the bootROM, the Mac OS ROM bootinfo file, and the changes in Mac OS system software. Before the NewWorld architecture, the Macintosh ROM contained all of the hardware-specific initialization code, the Mac OS--specific start-up code, and the Toolbox functions. The NewWorld architecture breaks up that monolithic Macintosh ROM into several pieces that are located in two places:</P><UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3389"> </A>The bootROM is a physical part of the specific implementation of current Macintosh computers. It contains these pieces:</LI><UL><LI CLASS="B2.Bullet2"><A NAME="pgfId=3390"> </A>POST (Power-on Self Test), startup code without Mac OS--specific code</LI><LI CLASS="B2.Bullet2"><A NAME="pgfId=3393"> </A>Open Firmware</LI><LI CLASS="B2.Bullet2"><A NAME="pgfId=3394"> </A>RTAS (Runtime Abstraction Services)</LI><LI CLASS="B2.Bullet2"><A NAME="pgfId=3395"> </A>Mac OS drivers (of type 'ndrv' and 'nlib') for logic board I/O controllers and devices needed at boot time</LI></UL><LI CLASS="B1.Bullet1"><A NAME="pgfId=3396"> </A>The Mac OS ROM image file is kept in the System Folder of the startup volume. It contains these pieces:</LI><UL><LI CLASS="B2.Bullet2"><A NAME="pgfId=3397"> </A>Mac OS--specific Open Firmware code and required bootinfo components</LI><LI CLASS="B2.Bullet2"><A NAME="pgfId=3398"> </A>Open Firmware--specific Mac OS code that takes care of transferring control from Open Firmware to the Mac OS ROM and system boot services </LI><LI CLASS="B2.Bullet2"><A NAME="pgfId=3399"> </A>a Mac OS ROM image, including among other things, the Macintosh Toolbox code</LI></UL></UL><P CLASS="T1.Text1"><A NAME="pgfId=3400"> </A>Other operating systems may also use the bootROM and a bootinfo file, but the contents of the bootinfo file are specific to the operating system that boots after logic board and hardware initialization by the code in the bootROM. The contents of the Mac OS ROM bootinfo file listed above are specific to Mac OS implementations. </P><P CLASS="T1.Text1"><A NAME="pgfId=3401"> </A>The bootinfo file exists on the boot device and has a localizable name. Identification information that leads to the file's path is stored in the Open Firmware config variables in NVRAM. The search algorithm for a usable bootinfo file parallels the search mechanism across SCSI, ATA, and other interfaces used in the older Mac OS start-up implementations. The path is specified in a string that looks similar to this: </P><P CLASS="T1.Text1"><A NAME="pgfId=3863"> </A><TT CLASS="cv">/pci/mac-io@10/ide@20000/disk@0:5,\System%20Folder\:tbxi</TT> </P><P CLASS="T1.Text1"><A NAME="pgfId=3864"> </A>The elements that make up the node portion of the path, everything up to <TT CLASS="cv">disk@0:</TT>, are defined in Section 3.2.2.1 &quot;Node Names&quot; in the IEEE 1275 specification. The remaining elements in the path string are file specific. </P><P CLASS="T1.Text1"><A NAME="pgfId=3876"> </A>By default, the bootinfo file is located by using the blessed folder directory ID <TT CLASS="cv">dirID</TT> in the master directory block, and then searching for a file with a file type of <TT CLASS="cv">'tbxi'</TT>. Searching by file type is done to allow localization of the filename. The name of the nonlocalized bootinfo file is currently Mac OS ROM. This name may change in the future. </P><P CLASS="T1.Text1"><A NAME="pgfId=3404"> </A>In order for a mass storage drive to be bootable, Open Firmware needs methods for accessing the device at the block level. The Open Firmware <TT CLASS="cv">deblocker</TT> and <TT CLASS="cv">disk-label</TT> packages are useful for providing boot-time services. For standard built-in devices, such as SCSI and ATA, methods are supplied by Open Firmware. For plug-in expansion cards, such as PCI cards, the Open Firmware methods must be supplied in the expansion ROM for the card and must follow the rules defined by the PCI Open Firmware binding specification. See <A HREF="PCI_BOOK.6a.html#16082" CLASS="XRef">Sample FCode Drivers</A> for a basic example of an FCode block device driver. </P><P CLASS="T1.Text1"><A NAME="pgfId=3408"> </A>Some versions of the Mac OS ROM bootinfo file also contain what has traditionally been part of an enabler. This is only to reduce the number of files in the System Folder, and Open Firmware does not use the enabler components in any way.</P><P CLASS="T1.Text1"><A NAME="pgfId=4196"> </A>A bootinfo file contains Open Firmware script, a description, information for individual operating systems, icons, and other information. A bootinfo file can be extended to contain non--Open Firmware information, which in the case of the Mac OS, is the addition of the Macintosh Toolbox and other code specifically for use by the Mac OS.</P><DIV><blockquote><p CLASS="NoteHead"><b><A NAME="pgfId=14441"> </A>Note</b></p><P CLASS="Note"><A NAME="pgfId=3409"> </A>The PowerPC Microprocessor Common Hardware Reference Platform (CHRP) System binding to: IEEE Std 1275-1994: Standard for Boot (Initialization, Configuration) Firmware document provides additional information about how a bootinfo file is used. However, it is not the reference specification for the bootinfo file currently in use on the Macintosh platform. </P></blockquote></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.26.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.34.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.36.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>