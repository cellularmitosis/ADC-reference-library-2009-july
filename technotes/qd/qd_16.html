<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note QD16: 8*24 GC QuickDraw and Deaccelerated CopyBits</title><meta name="keywords" content="Mac OS 8 _CopyBits 8*24 GC QuickDraw performance costs loss"><meta name="Description" content="Technical Note QD16: This Technical Note discusses (providesa list plus short description of) conditions that may cause_CopyBits to slow down when QuickDraw acceleration is onvia the Apple 8*24 GC Display Card.">                                       <meta name="categories" content="QuickDraw"><meta name="week-posted" content="Jan 28, 1991 - Feb 1, 1991"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002729" title="8*24 GC QuickDraw and Deaccelerated CopyBits"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/GraphicsImaging/idxHardwareDrivers-date.html" target="_blank">Graphics & Imaging > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QD16</div>
<div id="pageheadsub">8*24 GC QuickDraw and Deaccelerated CopyBits</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">_CopyBits Conforms To The Same Scheme, Except...</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This Technical Note discusses conditions that may cause <code>_CopyBits</code> to slow down when QuickDraw acceleration is onvia the Apple 8*24 GC Display Card.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Feb 01 1991]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><H2>Introduction</h2><p>When a drawing call is issued, GC IPC (Interprocess Communication) takescontrol of the call and passes it to GC QuickDraw.  After the normal port setup (which involves caching the port parameters if this is the first drawingcall after the port was set), GC QuickDraw returns control to the applicationthrough the IPC and performs, in parallel, the drawing to its own monitor aswell as any other monitors that may be affected by  the operation.  Theapplication then continues its execution, probably issuing more drawing callsthat get executed in the same asynchronous manner.</p><p>The result of this mode of operation is improved performance, since theapplication gets control back immediately after issuing the call and the GCQuickDraw moves video data to its own video buffer as well as that of othercards in a more rapid manner by using block transfers and without requiring anyaction by the main processor.</p><a id="Section2"></a><P><A HREF="#top">Back to top</A></p><H2>_CopyBits Conforms To The Same Scheme, Except...</h2><p><code>_CopyBits</code> conforms to the same operational scheme, but there are some instances in which GC QuickDraw cannot perform the call in parallel; in thiscases it is even possible to suffer a performance loss, since the whole callmay have to be completed before control is given back to the application and GC QuickDraw has to make calls and access data across the NuBus.</p><p>The_situations that compromise GC QuickDraw parallel operation are as follows:</p><ul>	<li>When the destination device has a <code>SearchProc</code> installed and the source color environment is different from the destination environment.</li></ul><p>QuickDraw calls a <code>SearchProc</code> whenever the source and destination havedifferent depths and when two indexed pixel maps have different color tables,even though their depths may be identical.  When GC acceleration is enabled,these conditions cause the following two types of behavior, dependent upon thesource pixel map:</p><ul>	<li>If the source is an indexed pixel map, then GC QuickDraw executes the part of the setup that involves calling the <code>SearchProc</code>, returns control to the main processor, then completes the call in parallel.  The act of calling the <code>SearchProc</code> before returning control makes the call slower than when no <code>SearchProc</code> is involved, since parallel operation does not occur throughout the whole call.</li>	<li>If the source is a direct RGB pixel map, then GC QuickDraw has to call the <code>SearchProc</code> for every pixel that is drawn, and the application does not regain control until after the call to <code>_CopyBits</code> has been completed.</li>	<li>When the source or destination is offscreen and not created using a <code>GWorld</code>.</li></ul><p>GC QuickDraw has no way to detect when an application is going to manipulate apixel map it has created in memory, so if it has to draw to or copy from such a<code>PixMap</code>, GC QuickDraw has to complete the operation before returningcontrol to the application.</p><p>This behavior is contrary to the case when using a <code>GWorld</code> foroffscreen environments, since in the case of a <code>GWorld</code>, GC QuickDraw isalerted by the call to <code>_GetPixBaseAddr</code> that the application is gettingready to directly change the pixels.  This is the reason why it is so importantthat applications call <code>_GetPixBaseAddr</code> <b>every</b> time they areabout to manipulate a <code>GWorld</code> pixel map directly.</p><ul>	<li>When the source <code>PixMap</code> has a color table that uses indexes that refer to a palette.</li></ul><p>QuickDraw now allows a color table to have indexes that point to entries inthe palette associated with the destination window; when bit 14 in the<code>ctFlags</code> field is set, the value fields in the color table are treatedas palette entries.  When such a <code>PixMap</code> is the source for<code>_CopyBits</code>, then GC QuickDraw has to make a number of calls to thePalette Manager as part of the setup before returning control and completingthe call.</p><p>This case is similar to that of a indexed pixel map when a <code>SearchProc</code>is involved; therefore, it only implies a partial loss of parallelism; it isgood to keep in mind that this case can only occur when the source<code>PixMap</code> is indexed.</p><P><A HREF="#top">Back to top</A></p><a id="References"></a><h2>References</h2><P><i>Inside Macintosh</i>, Volumes V &amp; VI, Color QuickDraw</p><P><i>develop</i>, "Macintosh Display Card 8*24 GC:  The Naked Truth," July 1990</p><P>Technical Note #275, <A HREF = "qd_01.html">32-Bit QuickDraw:  Version 1.2 Features</a></p><P>Developer Notes for the Macintosh Display Cards 4*8, 8*24 and 8*24 GC</p><p>NuBus is a trademark of Texas Instruments.</p> <a name="Downloads"></a>         <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (52K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qd_16.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qd/qd_16.html%3Fid%3DDTS10002729-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qd/qd_16.html%3Fid%3DDTS10002729-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qd/qd_16.html%3Fid%3DDTS10002729-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>