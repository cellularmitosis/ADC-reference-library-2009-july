<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>XML-RPC and SOAP Programming Guide: Making Remote Procedure Calls From Scripts</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Making Remote Procedure Calls From Scripts"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/20001723" title="Making Remote Procedure Calls From Scripts"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../../ScriptingAutomation/index.html#//apple_ref/doc/uid/TP30000440-TP40005948" target="_top">Scripting &amp; Automation</a> &gt; <a href="../../../../ScriptingAutomation/InternetWeb-date.html#//apple_ref/doc/uid/TP30000440-TP40005948-TP30000526" target="_top">Internet &amp; Web</a> &gt; <a href="../chapter1/soapXMLRPC_intro.html#//apple_ref/doc/uid/20001722-DontLinkElementID_1">XML-RPC and SOAP Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../chapter2/soapXMLRPC_about.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../chapter4/soapXMLRPC_apps.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/20001723-DontLinkElementID_13" title="Making Remote Procedure Calls From Scripts"></a><h1><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-TPXREF101" title="Making Remote Procedure Calls From Scripts"></a>Making Remote Procedure Calls From Scripts</h1><p>Starting with Mac OS X version 10.1, the Apple Event Manager provides support for using the XML-RPC and SOAP protocols to make remote procedure calls from AppleScript scripts and from applications. This chapter provides sample scripts that show how to make remote procedure calls from scripts.</p><p>This chapter assumes you are familiar with the material in <span class="content_text"><a href="../chapter1/soapXMLRPC_intro.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001722-TPXREF101">“Introduction to XML-RPC and SOAP Programming Guide.”</a></span> To test any of the scripts shown in this chapter, you must have an Internet connection.</p><div class="warningbox"><img src="../../../../Resources/Images/icon_warning.gif" alt="!" width="20" height="20" border="0" class="warningicon" /><a name="//apple_ref/doc/uid/20001723-DontLinkElementID_14" title="Warning:"></a><p><strong>Warning:</strong>&nbsp;The script examples in this chapter may not work because the web services they rely on may no longer be available. You can find additional script samples that make use of web services at <code>/Library/Scripts/Internet Services</code>. For example, the <code>Stock Quote</code> script uses a web service to look up the price for a stock specified by its symbol, while the <code>Current Temperature by Zipcode</code> script looks up the temperature for a specified Zip code.</p><p></p><div class="clear"></div></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJGDBGC">Scripting an XML-RPC Call</a>
				
			<br/>
			
        
			
			
				<a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJBFJBD">Scripting a SOAP Request</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJGDBGC" title="Scripting an XML-RPC Call"></a><h2>Scripting an XML-RPC Call</h2><p>To make an XML-RPC request from a script, you use the AppleScript term <code>call xmlrpc</code>. The syntax for this term is described in <span class="content_text"><a href="../chapter2/soapXMLRPC_about.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001721-BAJCBCBJ">“XML-RPC Script Statements.”</a></span> You can find available XML-RPC services at sites such as XMethods at <span class="content_text"><a href="http://www.xmethods.net/" target="_blank">http://www.xmethods.net/</a></span>. There you can also find information about the parameters and return values for remote procedure calls to these services.</p><p><span class="content_text"><a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJIDFHA">Listing 3-1</a></span> shows a script that prompts a user for text, makes an XML-RPC request to an Internet server to check the spelling for that text, prompts the user to correct any words that may have been misspelled, and displays the final text.</p><a name="//apple_ref/doc/uid/20001723-DontLinkElementID_15" title="Listing 2-1A script that makes an XML-RPC request to check the spelling of a text phrase."></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJIDFHA" title="Listing 2-1A script that makes an XML-RPC request to check the spelling of a text phrase."></a><strong>Listing 2-1&nbsp;&nbsp;</strong>A script that makes an XML-RPC request to check the spelling of a text phrase.</p><div class="codesample"><table><tr><td scope="row"><pre>---- Main script ----------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>-- Supply default text to spell check.<span></span></pre></td></tr><tr><td scope="row"><pre>set spellCheckText to "My frst naem is John"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>----Query user for different text to check.<span></span></pre></td></tr><tr><td scope="row"><pre>set dialogResult to display dialog ¬<span></span></pre></td></tr><tr><td scope="row"><pre>    "Enter a phrase to spell check:" default answer spellCheckText<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if button returned of dialogResult is "OK" then<span></span></pre></td></tr><tr><td scope="row"><pre>    set spellCheckText to text returned of dialogResult<span></span></pre></td></tr><tr><td scope="row"><pre>    -- Call spellCheck handler.<span></span></pre></td></tr><tr><td scope="row"><pre>    set resultList to spellCheck(spellCheckText)<span></span></pre></td></tr><tr><td scope="row"><pre>    (*<span></span></pre></td></tr><tr><td scope="row"><pre>    The returned data looks something like this:<span></span></pre></td></tr><tr><td scope="row"><pre>        {{suggestions:{"fast", "fest", "first", "fist", "Forst",<span></span></pre></td></tr><tr><td scope="row"><pre>        "frat", "fret", "frist", "frit", "frost", "frot", "fust"},<span></span></pre></td></tr><tr><td scope="row"><pre>        location:4, |word|:"frst"}, {suggestions:{"haem", "na em",<span></span></pre></td></tr><tr><td scope="row"><pre>        "na-em", "naam", "nae", "nae m", "nae-m", "nael", "Naim",<span></span></pre></td></tr><tr><td scope="row"><pre>        "nam", "name", "neem"}, location:9, |word|:"naem"}}<span></span></pre></td></tr><tr><td scope="row"><pre>    *)<span></span></pre></td></tr><tr><td scope="row"><pre>    -- Make list of words to spellcheck.<span></span></pre></td></tr><tr><td scope="row"><pre>    set wordList to every word of spellCheckText<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    -- Give user chance to correct each misspelled word.<span></span></pre></td></tr><tr><td scope="row"><pre>    repeat with eachItem in resultList<span></span></pre></td></tr><tr><td scope="row"><pre>        set newWord to choose from list suggestions of eachItem ¬<span></span></pre></td></tr><tr><td scope="row"><pre>            with prompt "You misspelled \"" &amp; |word| of eachItem &amp; ¬<span></span></pre></td></tr><tr><td scope="row"><pre>            "\"" without multiple selections allowed<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        -- If user selected a corrected word, insert it into list<span></span></pre></td></tr><tr><td scope="row"><pre>        if (newWord as string) is not equal to "false" then<span></span></pre></td></tr><tr><td scope="row"><pre>            set wordIndex to ¬<span></span></pre></td></tr><tr><td scope="row"><pre>                findIt(every word of spellCheckText, location of eachItem)<span></span></pre></td></tr><tr><td scope="row"><pre>            copy newWord to item wordIndex of wordList<span></span></pre></td></tr><tr><td scope="row"><pre>        end if<span></span></pre></td></tr><tr><td scope="row"><pre>    end repeat<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    -- Display corrected text.<span></span></pre></td></tr><tr><td scope="row"><pre>    set spellCheckText to ""<span></span></pre></td></tr><tr><td scope="row"><pre>    repeat with oneWord in wordList<span></span></pre></td></tr><tr><td scope="row"><pre>        set spellCheckText to spellCheckText &amp; oneWord &amp; " "<span></span></pre></td></tr><tr><td scope="row"><pre>    end repeat<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    display dialog "Corrected text: " &amp; spellCheckText<span></span></pre></td></tr><tr><td scope="row"><pre>end if<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- spellCheck handler ------------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>-- This handler makes the remote procedure call.<span></span></pre></td></tr><tr><td scope="row"><pre>on spellCheck(sentence)<span></span></pre></td></tr><tr><td scope="row"><pre>    tell application "http://www.stuffeddog.com/speller/speller-rpc.cgi"<span></span></pre></td></tr><tr><td scope="row"><pre>        return call xmlrpc {method name:"speller.spellCheck", ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        parameters:sentence}<span></span></pre></td></tr><tr><td scope="row"><pre>    end tell<span></span></pre></td></tr><tr><td scope="row"><pre>end spellCheck<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- findIt handler ------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>-- The "textList" parameter is a list of the words in the original text.<span></span></pre></td></tr><tr><td scope="row"><pre>-- The "index" parameter is the character index of a misspelled word.<span></span></pre></td></tr><tr><td scope="row"><pre>-- This handler returns the word at that index.<span></span></pre></td></tr><tr><td scope="row"><pre>-- For example, the misspelled word at character index four is "frst".<span></span></pre></td></tr><tr><td scope="row"><pre>--      Its word index is 2 (the 2nd word in the original text).<span></span></pre></td></tr><tr><td scope="row"><pre>on findIt(textList, index)<span></span></pre></td></tr><tr><td scope="row"><pre>    set curLength to 0<span></span></pre></td></tr><tr><td scope="row"><pre>    set ixWord to 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    repeat with oneWord in textList<span></span></pre></td></tr><tr><td scope="row"><pre>        set curLength to curLength + (length of oneWord) + 1<span></span></pre></td></tr><tr><td scope="row"><pre>        if curLength ≥ index then<span></span></pre></td></tr><tr><td scope="row"><pre>            exit repeat<span></span></pre></td></tr><tr><td scope="row"><pre>        end if<span></span></pre></td></tr><tr><td scope="row"><pre>        set ixWord to ixWord + 1<span></span></pre></td></tr><tr><td scope="row"><pre>    end repeat<span></span></pre></td></tr><tr><td scope="row"><pre>    log ixWord<span></span></pre></td></tr><tr><td scope="row"><pre>    return ixWord<span></span></pre></td></tr><tr><td scope="row"><pre>end findIt<span></span></pre></td></tr></table></div><p>This script has a main section and two handlers. In the main section, it performs the following actions:</p><ol class="ol"><li class="li"><p>It sets a default text string to be checked.</p></li><li class="li"><p>It displays a dialog that prompts the user to enter different text.</p></li><li class="li"><p>If the user accepts the dialog, it calls the <code>spellCheck</code> handler to check the spelling. That handler, described below, contains the only script statements needed to make a remote procedure call to a spell-checking server.</p><p>The handler returns a list that contains, for each misspelled word, a list of suggested corrections, the character location of the word in the text, and the misspelled word itself. The returned list looks something like this:</p><div class="codesample"><table><tr><td scope="row"><pre>The returned data looks something like this:<span></span></pre></td></tr><tr><td scope="row"><pre>        {{suggestions:{"fast", "fest", "first", "fist", "Forst",<span></span></pre></td></tr><tr><td scope="row"><pre>        "frat", "fret", "frist", "frit", "frost", "frot", "fust"},<span></span></pre></td></tr><tr><td scope="row"><pre>        location:4, |word|:"frst"}, {suggestions:{"haem", "na em",<span></span></pre></td></tr><tr><td scope="row"><pre>        "na-em", "naam", "nae", "nae m", "nae-m", "nael", "Naim",<span></span></pre></td></tr><tr><td scope="row"><pre>        "nam", "name", "neem"}, location:9, |word|:"naem"}}<span></span></pre></td></tr></table></div><p>Note that this is not the raw data returned from the remote procedure call. Rather, the Apple Event Manager has interpreted the XML returned by the procedure call and built an Apple event to encapsulate it. This list of records is the result. Because <code>word</code> is a reserved word in AppleScript, it is enclosed in vertical bars (<code>|word|</code>) when used as an identifier (in this case as a label in a record).</p></li><li class="li"><p>For each word (if any) in the returned list of misspelled words, it lets the user choose a correction (using the standard scripting addition <code>choose from list</code>).</p><p>It then calls the <code>findIt</code> handler to find the location of the misspelled word in the text phrase and replaces it with the user choice.</p></li><li class="li"><p>It displays the corrected text (possibly the same as the original text, if no corrections were made).</p></li></ol><p>The <code>spellCheck</code> handler contains the one and only statement in the script that makes a remote procedure call. It performs the following operations:</p><ol class="ol"><li class="li"><p>It uses a Tell statement to identify the location of the remote XML-RPC server (<code>http://www.stuffeddog.com/speller/speller-rpc.cgi</code>).</p></li><li class="li"><p>It uses the AppleScript term <code>call xmlrpc</code> to make the remote procedure call, specifying the method name (<code>speller.spellCheck</code>) and passing the specified text for the single parameter.</p></li><li class="li"><p>It returns the result of the remote procedure call. That consists of a list that contains, for each misspelled word, a list of suggested corrections, the location of the word in the text, and the misspelled word itself.</p></li></ol><p>Note that AppleScript, working through the Apple Event Manager, did all the work of formatting the <code>call xmlrpc</code> script statement into proper XML, opening a connection to the specified server, sending the message, waiting for a reply, formatting the returned XML into an Apple event, and returning the event.</p><p>The <code>findIt</code> handler merely returns the word position in the original text of the word that corresponds to the passed character index of a misspelled word (returned by the remote procedure handler). For example, the character index of the first misspelled word (<code>frst</code>) is 4. That word is the second word in the original text, so <code>findit</code> would return the value 2.</p><p>For a script that shows a more flexible type of handler and includes error handling, see <span class="content_text"><a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJDDAAI">Listing 3-3</a></span>.</p><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJBFJBD" title="Scripting a SOAP Request"></a><h2>Scripting a SOAP Request</h2><p>To make a SOAP request from a script, you use the AppleScript term <code>call soap</code>. The syntax for these calls is described in <span class="content_text"><a href="../chapter2/soapXMLRPC_about.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001721-BAJGHDCH">“SOAP Script Statements.”</a></span> You can find available SOAP services at sites such as XMethods at <span class="content_text"><a href="http://www.xmethods.net/" target="_blank">http://www.xmethods.net/</a></span>. There you can also find information about the parameters and return values for SOAP requests to these services.</p><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-TPXREF147" title="A Simple Translation Script"></a><h3>A Simple Translation Script</h3><p><span class="content_text"><a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJGADIC">Listing 3-2</a></span> shows a script that prompts a user for text, makes a SOAP request to an Internet server to translate that text to French, and displays the translated text.</p><a name="//apple_ref/doc/uid/20001723-DontLinkElementID_16" title="Listing 2-2A simple script that calls a SOAP translation server."></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJGADIC" title="Listing 2-2A simple script that calls a SOAP translation server."></a><strong>Listing 2-2&nbsp;&nbsp;</strong>A simple script that calls a SOAP translation server.</p><div class="codesample"><table><tr><td scope="row"><pre>---- Main script ----------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>-- Supply default text to translate.<span></span></pre></td></tr><tr><td scope="row"><pre>set defaultText to "The spirit is willing but the mind is weak"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>--Display dialog and let user type different text to translate.<span></span></pre></td></tr><tr><td scope="row"><pre>display dialog "Enter the text to translate into French:" ¬<span></span></pre></td></tr><tr><td scope="row"><pre>    default answer defaultText<span></span></pre></td></tr><tr><td scope="row"><pre>set this_text to the text returned of the result<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- Call translation handler<span></span></pre></td></tr><tr><td scope="row"><pre>set the new_text to translate("en_fr", this_text)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>--Show translated text and allow user to copy it to Clipboard.<span></span></pre></td></tr><tr><td scope="row"><pre>display dialog new_text buttons {"Clipboard", "OK"} default button 2<span></span></pre></td></tr><tr><td scope="row"><pre>if the button returned of the result is "Clipboard" then<span></span></pre></td></tr><tr><td scope="row"><pre>    set the clipboard to new_text<span></span></pre></td></tr><tr><td scope="row"><pre>end if<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- translate handler ------------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>-- This handler makes the SOAP request.<span></span></pre></td></tr><tr><td scope="row"><pre>on translate(direction, theText)<span></span></pre></td></tr><tr><td scope="row"><pre>    tell application "http://services.xmethods.net:80/perl/soaplite.cgi"<span></span></pre></td></tr><tr><td scope="row"><pre>        return call soap {method name:"BabelFish", ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        method namespace uri:"urn:xmethodsBabelFish", ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        parameters:{translationmode:direction as string, ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        sourcedata:theText as string}, ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        SOAPAction:"urn:xmethodsBabelFish#BabelFish"}<span></span></pre></td></tr><tr><td scope="row"><pre>    end tell<span></span></pre></td></tr><tr><td scope="row"><pre>end translate<span></span></pre></td></tr></table></div><p>This script starts has a main section and one handler to make the translation SOAP request. In the main section, it performs the following actions:</p><ol class="ol"><li class="li"><p>It sets a default text string to be translated from English to French.</p></li><li class="li"><p>It displays a dialog that prompts the user to enter different text.</p></li><li class="li"><p>It calls the <code>translate</code> handler to translate the text. That handler, described below, contains the only script statements needed to make a SOAP request to a translation server.</p><p>The handler returns the translated text.</p></li><li class="li"><p>It displays the translated text and allows the user to copy it to the Clipboard.</p></li></ol><p>The <code>translate</code> handler contains the one and only statement in the script that makes a SOAP request. It performs the following operations:</p><ol class="ol"><li class="li"><p>It uses a Tell statement to identify the location of the remote SOAP server (<code>http://services.xmethods.net:80/perl/soaplite.cgi</code>).</p></li><li class="li"><p>It uses the AppleScript term <code>call soap</code> to make the SOAP request. You can obtain certain values you need to make a SOAP request from the service itself. In this example, the call includes the following:</p><ul class="ul"><li class="li"><p><code>method name:"BabelFish"</code> specifies the required method name</p></li><li class="li"><p><code>method namespace uri:"urn:xmethodsBabelFish"</code> specifies the required method namespace URI</p></li><li class="li"><p><code>parameters:{translationmode:direction as string, sourcedata:theText as string}</code> specifies the parameter names and the values to pass for those parameters; a method may have no parameters</p></li><li class="li"><p><code>SOAPAction:"urn:xmethodsBabelFish#BabelFish"</code> specifies the required SOAPAction value </p></li></ul></li><li class="li"><p>It returns the result of the SOAP request. That consists of a text string that contains the translated text.</p></li></ol><p>Note that AppleScript, working through the Apple Event Manager, did all the work of formatting the <code>call soap</code> script statement into proper XML, opening a connection to the specified server, sending the message, waiting for a reply, formatting the returned XML into an Apple event, and returning the event.</p><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-TPXREF148" title="A More Complex Translation Script"></a><h3>A More Complex Translation Script</h3><p>The script in <span class="content_text"><a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJDDAAI">Listing 3-3</a></span> performs the same task as the script in <span class="content_text"><a href="soapXMLRPC_scripts.html#//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJGADIC">Listing 3-2</a></span>, translating an English phrase to French. However, it is more flexible and sophisticated in several ways:</p><ol class="ol"><li class="li"><p>It turns the translation handler into a flexible SOAP request routine that can call different SOAP servers and different methods depending on the parameters passed to it.</p></li><li class="li"><p>It uses error handling in the SOAP request handler and sets a boolean parameter value so that the caller can check for success. The main script checks that parameter and displays an error message if the SOAP request was unsuccessful.</p></li><li class="li"><p>The main script also shows how to use a <code>try</code> block to handle errors. In this case, it checks for errors while displaying a dialog: for any returned error number except -128 (the user cancelled), it beeps.</p></li><li class="li"><p>It defines property values to make the script more readable and easier to modify.</p></li></ol><a name="//apple_ref/doc/uid/20001723-DontLinkElementID_17" title="Listing 2-3A more detailed script that calls a SOAP translation server."></a><p class="codesample"><a name="//apple_ref/doc/uid/TP30001126-//apple_ref/doc/uid/20001723-BAJDDAAI" title="Listing 2-3A more detailed script that calls a SOAP translation server."></a><strong>Listing 2-3&nbsp;&nbsp;</strong>A more detailed script that calls a SOAP translation server.</p><div class="codesample"><table><tr><td scope="row"><pre>-- Use properties to store default values.<span></span></pre></td></tr><tr><td scope="row"><pre>property SOAP_app : "http://services.xmethods.net:80/perl/soaplite.cgi"<span></span></pre></td></tr><tr><td scope="row"><pre>property method_name : "BabelFish"<span></span></pre></td></tr><tr><td scope="row"><pre>property method_namespace_URI : "urn:xmethodsBabelFish"<span></span></pre></td></tr><tr><td scope="row"><pre>property SOAP_action : "urn:xmethodsBabelFish#BabelFish"<span></span></pre></td></tr><tr><td scope="row"><pre>property English_to_French : "en_fr"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>---- Main script ----------------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>--Query user for text to translate.<span></span></pre></td></tr><tr><td scope="row"><pre>set this_text to "Hello my friend!"<span></span></pre></td></tr><tr><td scope="row"><pre>repeat<span></span></pre></td></tr><tr><td scope="row"><pre>    try<span></span></pre></td></tr><tr><td scope="row"><pre>        display dialog ¬<span></span></pre></td></tr><tr><td scope="row"><pre>            "Enter the text to translate into French:" ¬<span></span></pre></td></tr><tr><td scope="row"><pre>            default answer this_text<span></span></pre></td></tr><tr><td scope="row"><pre>        set this_text to the text returned of the result<span></span></pre></td></tr><tr><td scope="row"><pre>        if this_text is not "" then<span></span></pre></td></tr><tr><td scope="row"><pre>            set this_text to this_text as string<span></span></pre></td></tr><tr><td scope="row"><pre>            exit repeat<span></span></pre></td></tr><tr><td scope="row"><pre>        end if<span></span></pre></td></tr><tr><td scope="row"><pre>    on error number error_number<span></span></pre></td></tr><tr><td scope="row"><pre>        -- Don't show error if user just cancelled.<span></span></pre></td></tr><tr><td scope="row"><pre>        if the error_number is -128 then error number -128<span></span></pre></td></tr><tr><td scope="row"><pre>        beep<span></span></pre></td></tr><tr><td scope="row"><pre>    end try<span></span></pre></td></tr><tr><td scope="row"><pre>end repeat<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- Create the parameter record.<span></span></pre></td></tr><tr><td scope="row"><pre>set the method_parameters to {translationmode:English_to_French, ¬<span></span></pre></td></tr><tr><td scope="row"><pre>     sourcedata:this_text}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- Call the SOAP handler.<span></span></pre></td></tr><tr><td scope="row"><pre>copy my SOAP_call(SOAP_app, method_name, ¬<span></span></pre></td></tr><tr><td scope="row"><pre>    method_namespace_URI, method_parameters, SOAP_action) ¬<span></span></pre></td></tr><tr><td scope="row"><pre>    to {call_indicator, call_result}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- Check for error return from SOAP handler.<span></span></pre></td></tr><tr><td scope="row"><pre>if the call_indicator is false then<span></span></pre></td></tr><tr><td scope="row"><pre>    beep<span></span></pre></td></tr><tr><td scope="row"><pre>    display dialog "An error occurred." &amp; return &amp; return ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        &amp; call_result buttons {"Cancel"} default button 1<span></span></pre></td></tr><tr><td scope="row"><pre>else<span></span></pre></td></tr><tr><td scope="row"><pre>    --Show translated text and allow user to copy it to Clipboard.<span></span></pre></td></tr><tr><td scope="row"><pre>    display dialog call_result buttons {"Clipboard", "OK"} ¬<span></span></pre></td></tr><tr><td scope="row"><pre>        default button 2<span></span></pre></td></tr><tr><td scope="row"><pre>    if the button returned of the result is "Clipboard" then<span></span></pre></td></tr><tr><td scope="row"><pre>        set the clipboard to the call_result<span></span></pre></td></tr><tr><td scope="row"><pre>    end if<span></span></pre></td></tr><tr><td scope="row"><pre>end if<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>-- SOAP translation handler ------------------------------<span></span></pre></td></tr><tr><td scope="row"><pre>on SOAP_call(SOAP_app, method_name, ¬<span></span></pre></td></tr><tr><td scope="row"><pre>    method_namespace_URI, method_parameters, SOAP_action)<span></span></pre></td></tr><tr><td scope="row"><pre>    try<span></span></pre></td></tr><tr><td scope="row"><pre>        using terms from application "http://www.apple.com/placebo"<span></span></pre></td></tr><tr><td scope="row"><pre>            tell application SOAP_app<span></span></pre></td></tr><tr><td scope="row"><pre>                set this_result to call soap ¬<span></span></pre></td></tr><tr><td scope="row"><pre>                    {method name:method_name ¬<span></span></pre></td></tr><tr><td scope="row"><pre>                        , method namespace uri:method_namespace_URI ¬<span></span></pre></td></tr><tr><td scope="row"><pre>                        , parameters:method_parameters ¬<span></span></pre></td></tr><tr><td scope="row"><pre>                        , SOAPAction:SOAP_action}<span></span></pre></td></tr><tr><td scope="row"><pre>            end tell<span></span></pre></td></tr><tr><td scope="row"><pre>        end using terms from<span></span></pre></td></tr><tr><td scope="row"><pre>        return {true, this_result}<span></span></pre></td></tr><tr><td scope="row"><pre>    on error error_message<span></span></pre></td></tr><tr><td scope="row"><pre>        return {false, error_message}<span></span></pre></td></tr><tr><td scope="row"><pre>    end try<span></span></pre></td></tr><tr><td scope="row"><pre>end SOAP_call<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../chapter2/soapXMLRPC_about.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../chapter4/soapXMLRPC_apps.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2001, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-03-03<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleScript/Conceptual/soapXMLRPC/chapter3/soapXMLRPC_scripts.html%3Fid%3DTP30001126-2.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleScript/Conceptual/soapXMLRPC/chapter3/soapXMLRPC_scripts.html%3Fid%3DTP30001126-2.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleScript/Conceptual/soapXMLRPC/chapter3/soapXMLRPC_scripts.html%3Fid%3DTP30001126-2.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>