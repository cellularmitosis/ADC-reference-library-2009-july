<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Dashboard Programming Topics: Accessing Command Line Utilities</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Accessing Command Line Utilities"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40003050" title="Accessing Command Line Utilities"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000418" target="_top">Apple Applications</a> &gt; <a href="../../../Dashboard-date.html#//apple_ref/doc/uid/TP30000440-TP30000418-TP40001366" target="_top">Dashboard</a> &gt; <a href="../index.html" target="_top">Dashboard Programming Topics</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="ExternalAccess.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="WidgetPlugin.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40003050-SW1" title="Accessing Command Line Utilities"></a><hr /><H1>Accessing Command Line Utilities</H1><p>Dashboard provides you with a method for using command-line utilities and scripts within your widget. With this capability you can use any standard utilities included with the system or any utilities or scripts you include within your widget.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_75" title="Note"></a><p><strong>Note:</strong>&nbsp;Before reading this chapter, read <span class="content_text"><a href="AccessKeys.html#//apple_ref/doc/uid/TP40003048-SW2">“Specifying Access Keys”</a></span> to learn more about the widget access keys.</p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="CommandLine.html#//apple_ref/doc/uid/TP40003050-DontLinkElementID_19">The System Method</a>
				
			<br/>
			
        
			
			
				<a href="CommandLine.html#//apple_ref/doc/uid/TP40003050-DontLinkElementID_20">Synchronous Operation</a>
				
			<br/>
			
        
			
			
				<a href="CommandLine.html#//apple_ref/doc/uid/TP40003050-SW2">Asynchronous Operation</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_19" title="The System Method"></a><h2>The System Method</h2><p>Running a command-line utility or script within your widget requires you to use the <code>widget.system()</code> method. The method is defined as:</p><div class="codesample"><table><tr><td scope="row"><pre>widget.system("command", handler)<span></span></pre></td></tr></table></div><p>The parameters of the <code>widget.system()</code> method are:</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_76" title="Table 18widget.system() parameters"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 18&nbsp;&nbsp;</strong><code>widget.system()</code> parameters</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Parameter</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Example</p></th></tr><tr><td  scope="row"><p><code>command</code></p></td><td ><p>A string that specifies a command-line utility; may contain parameters and flags.</p></td><td ><p>"<code>/bin/ls -l -a</code>"</p></td></tr><tr><td  scope="row"><p><code>handler</code></p></td><td ><p>A function called when the command-line utility finishes execution; toggles execution of the command between synchronous and asynchronous modes. If specified, the handler needs to accept an argument.</p></td><td ><p><code>systemHandler</code></p></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_77" title="Note"></a><p><strong>Note:</strong>&nbsp;When specifying the command, always include the full path to the command or the path to the command relative to the root level of the widget. If you are unsure what the path is, the command <code>which</code> can tell it to you. </p>Also, don't rely on non-standard enviroment variables, custom search paths, and Terminal preferences when passing a command to <code>widget.system()</code>.</p></div><p>Depending on what you pass into the handler parameter, your call to <code>widget.system()</code> will operate in one of two modes: synchronous or asynchronous.</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_20" title="Synchronous Operation"></a><h2>Synchronous Operation</h2><p>Using <code>widget.system()</code> synchronously means that you are going to hold up the execution of your widget until you get the results of the command you are running. You want to use them this way when working with commands that provide output once and execute in a short period of time.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_78" title="Note"></a><p><strong>Note:</strong>&nbsp;Using <code>widget.system()</code> synchronously is recommended only for development and debugging purposes. Do not deliver a widget that uses <code>widget.system()</code> synchronously; instead, use <code>widget.system()</code> asynchronously, discussed in <span class="content_text"><a href="CommandLine.html#//apple_ref/doc/uid/TP40003050-SW2">“Asynchronous Operation,”</a></span> when delivering a shipping widget.</p></div><p>An example of this would be if you wanted to run the command <code>id</code> from within your widget:</p><div class="codesample"><table><tr><td scope="row"><pre>widget.system("/usr/bin/id -un", null);<span></span></pre></td></tr></table></div><p>The first argument specifies the command you want to run; here, you’re running <code>id</code> with the flag -<code>un</code>. You have not specified an event handler for this command, so all execution in your widget halts until this command is finished.</p><p>Running <code>id</code> as shown above executes the command, but any output is lost since you don’t specify that you want that information. To get its output, specify the <code>outputString</code> property and save it in a variable:</p><div class="codesample"><table><tr><td scope="row"><pre>var output = widget.system("/usr/bin/id -un", null).outputString;<span></span></pre></td></tr></table></div><p>You can get either the output string, the error string, or the command’s output status when using <code>widget.system()</code> synchronously:</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_79" title="Table 19widget.system() properties during synchronous usage"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 19&nbsp;&nbsp;</strong><code>widget.system()</code> properties during synchronous usage</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Usage</p></th></tr><tr><td  scope="row"><p><code>outputString</code></p></td><td ><p>The output of the command, as placed on <code>stdout</code>.</p></td><td ><p><code>var output = widget.system("id -un", null).outputString;</code></p></td></tr><tr><td  scope="row"><p><code>errorString</code></p></td><td ><p>The output of the command, as placed on <code>stderr</code>.</p></td><td ><p><code>var error = widget.system("id -un", null).errorString;</code></p></td></tr><tr><td  scope="row"><p><code>status</code></p></td><td ><p>The exit status of the command.</p></td><td ><p><code>var status = widget.system("id -un", null).status;</code></p></td></tr></table></div><a name="//apple_ref/doc/uid/TP40003050-SW2" title="Asynchronous Operation"></a><h2>Asynchronous Operation</h2><p>Providing a handler as the second argument of <code>widget.system()</code> runs the command in asynchronous mode. This means that execution within your widget continues while the command is executing. The handler that you specify is called when the command is finished and needs to accept a single object as a parameter. That object contains the last output of the command as it finishes execution. You can retrieve these properties from it:</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_80" title="Table 20widget.system() end handler parameter object properties"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 20&nbsp;&nbsp;</strong><code>widget.system()</code> end handler parameter object properties</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Property</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Definition</p></th></tr><tr><td  scope="row"><p><code>object.outputString</code></p></td><td ><p>The last output of the command, as placed on <code>stdout</code>.</p></td></tr><tr><td  scope="row"><p>object.<code>errorString</code></p></td><td ><p>The last output of the command, as placed on <code>stderr</code>.</p></td></tr><tr><td  scope="row"><p><code>object.status</code></p></td><td ><p>The exit status of the command.</p></td></tr></table></div><p>Because the command is running asynchronously, it may be necessary to interact with the command during its execution. Using <code>widget.system()</code> asynchronously returns an object that you can use for further interaction with the command:</p><div class="codesample"><table><tr><td scope="row"><pre>var myCommand = widget.system("/sbin/ping foo.bar", endHandler);<span></span></pre></td></tr></table></div><p>The object returned (and saved in <code>myCommand</code>) responds to a number of methods and has various properties:</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_81" title="Table 21widget.system() properties and methods available during asynchronous usage"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 21&nbsp;&nbsp;</strong><code>widget.system()</code> properties and methods available during asynchronous usage</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Option</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Purpose</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>myCommand.outputString</code></p></td><td ><p>Property</p></td><td ><p>The current string written to <code>stdout</code> (standard output) by the command.</p></td></tr><tr><td  scope="row"><p><code>myCommand.errorString</code></p></td><td ><p>Property</p></td><td ><p>The current string written to <code>stderr</code> (standard error output) by the command.</p></td></tr><tr><td  scope="row"><p><code>myCommand.status</code></p></td><td ><p>Property</p></td><td ><p>The command’s exit status, as defined by the command.</p></td></tr><tr><td  scope="row"><p><code>myCommand.onreadoutput</code></p></td><td ><p>Event Handler</p></td><td ><p>A function called whenever the command writes to <code>stdout</code>. The handler must accept a single argument; when called, the argument contains the current string placed on <code>stdout</code>.</p></td></tr><tr><td  scope="row"><p><code>myCommand.onreaderror</code></p></td><td ><p>Event Handler</p></td><td ><p>A function called whenever the command writes to <code>stderr</code>. The handler must accept a single argument; when called, the argument contains the current string placed on <code>stderr</code>.</p></td></tr><tr><td  scope="row"><p><code>myCommand.cancel()</code></p></td><td ><p>Method</p></td><td ><p>Cancels the execution of the command.</p></td></tr><tr><td  scope="row"><p><code>myCommand.write(string)</code></p></td><td ><p>Method</p></td><td ><p>Writes a string to <code>stdin</code> (standard input).</p></td></tr><tr><td  scope="row"><p><code>myCommand.close()</code></p></td><td ><p>Method</p></td><td ><p>Closes <code>stdin</code> (<code>EOF</code>).</p></td></tr></table></div><p>For instance, to run the command <code>ping</code> and be notified every time it writes something to <code>stdout</code>, use this code:</p><div class="codesample"><table><tr><td scope="row"><pre>var myCommand = widget.system("/sbin/ping foo.bar", endHandler);<span></span></pre></td></tr><tr><td scope="row"><pre>myCommand.onreadoutput = outputHandler;<span></span></pre></td></tr></table></div><p>Alternatively, you can use:</p><div class="codesample"><table><tr><td scope="row"><pre>widget.system("/sbin/ping foo.bar", endHandler).onreadoutput = outputHandler;<span></span></pre></td></tr></table></div><p>Your <code>onreadoutput</code> handler should accept an argument. When it is called, it is passed a string that has the most recent string placed on <code>stdout</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>function outputHandler(currentStringOnStdout){    // Code that does something with the command’s current output like...<span></span></pre></td></tr><tr><td scope="row"><pre>    document.getElementById("element").innerText = currentStringOnStdout;}<span></span></pre></td></tr></table></div><p>Commands such as <code>ping</code> run indefinitely, so you probably want to end its execution at some point. Use the <code>cancel()</code> method on the object that you receive from <code>widget.system()</code> to do this:</p><div class="codesample"><table><tr><td scope="row"><pre>myCommand.cancel();<span></span></pre></td></tr></table></div><p>Other commands, such as <code>bc</code>, require input at some point in their execution. To write to standard input (where these commands expect their input), use the <code>write()</code> method:</p><div class="codesample"><table><tr><td scope="row"><pre>myCommand.write("8*5");<span></span></pre></td></tr></table></div><p>To close these commands properly (using the end-of-file, or <code>EOF</code>, signal), use <code>close()</code>:</p><div class="codesample"><table><tr><td scope="row"><pre>myCommand.close();<span></span></pre></td></tr></table></div><p>Don’t forget that in order for this command to run asynchronously, you need to provide an event handler for the end of execution. This handler is passed the same object that is created when you first use <code>widget.system()</code>. That means that you can get the command’s status code or, if you didn’t use the <code>onreadoutput</code> or <code>onreaderror</code> handlers, you can obtain the command’s complete output to <code>stdout</code> or <code>stderr</code>, respectively.</p><a name="//apple_ref/doc/uid/TP40003050-DontLinkElementID_21" title="Sample Code"></a><h3>Sample Code</h3><p><img src = "../Art/voices2.gif" alt = "The Voices Widget" width="228" height="265"></p><p>The Voices sample widget (available in the <em><a href="../../../../../samplecode/Voices/index.html#//apple_ref/doc/uid/DTS10003699" target="_top">Voices</a></em> sample project) uses <code>widget.system()</code> asynchronously. When Voices is first opened, it introduces itself:</p><div class="codesample"><table><tr><td scope="row"><pre>function setup()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if(window.widget) {<span></span></pre></td></tr><tr><td scope="row"><pre>        currentlyBeingSpoken = widget.system("/usr/bin/osascript -e 'say \"Welcome to Voices!\" using \"Fred\"'" , doneSpeaking);<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>By specifying a handler for when the command is finished executing, the command runs asynchronously. A global variable, <code>currentlyBeingSpoken</code>, is assigned the command object so that commands can be issued to it during its execution, if needed. The <code>doneSpeaking()</code> function, called when the command is done, sets <code>currentlyBeingSpoken</code> to <code>NULL</code>.</p><p>Later, when a user inputs a phrase to be spoken, this code is called:</p><div class="codesample"><table><tr><td scope="row"><pre>if(window.widget) {<span></span></pre></td></tr><tr><td scope="row"><pre>    if(currentlyBeingSpoken != null) {<span></span></pre></td></tr><tr><td scope="row"><pre>        currentlyBeingSpoken.cancel();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    currentlyBeingSpoken = widget.system("/usr/bin/osascript -e 'say \"" + textToSpeak + "\" using \"" + chosenVoice + "\"'" , done);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Here <code>currentlyBeingSpoken</code> is checked to see if a command is already in execution. If so, the <code>cancel()</code> method is called on it to stop it and then a new command is issued. The <code>done()</code> function performs some user interface housekeeping and then calls <code>doneSpeaking()</code> to set <code>currentlyBeingSpoken</code> to <code>NULL</code>.</p><p>Voices also has each voice introduce itself when it is selected in a menu. This code follows a similar logic as the previous sample:</p><div class="codesample"><table><tr><td scope="row"><pre>function voiceChanged(elem)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var chosenVoice = elem.options[elem.selectedIndex].value;<span></span></pre></td></tr><tr><td scope="row"><pre>    document.getElementById("voiceMenuText").innerText = chosenVoice;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if(window.widget) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if(currentlyBeingSpoken != null) {<span></span></pre></td></tr><tr><td scope="row"><pre>            currentlyBeingSpoken.cancel();<span></span></pre></td></tr><tr><td scope="row"><pre>            done();<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        currentlyBeingSpoken = widget.system(<span></span></pre></td></tr><tr><td scope="row"><pre>                    "/usr/bin/osascript -e 'say \"Hi, I`m " +<span></span></pre></td></tr><tr><td scope="row"><pre>                    chosenVoice + ".\" using \"" +<span></span></pre></td></tr><tr><td scope="row"><pre>                    chosenVoice + "\"'" ,<span></span></pre></td></tr><tr><td scope="row"><pre>                    doneSpeaking<span></span></pre></td></tr><tr><td scope="row"><pre>                    );<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="ExternalAccess.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="WidgetPlugin.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2009 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2009-02-04<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/CommandLine.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/CommandLine.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/CommandLine.html%3Fid%3DTP40002837-2.3&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
