<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>CharToPixel(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING173></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-172.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-174.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-126.html"><B>Chapter 3 - QuickDraw Text</B></A> / <A HREF="Text-143.html"><B>QuickDraw Text Reference</B></A><BR><DL><DD><A HREF="Text-147.html"><B>Routines</B></A> / <A HREF="Text-171.html"><B>Determining the Caret Position, and Selecting and Highlighting Text</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING173-0></A>
<H3><A NAME=MARKER-9-356></A>CharToPixel</H3>
 The <A NAME=MARKER-9-375></A><CODE>CharToPixel</CODE> function returns the screen pixel width from the left edge of a text segment to the glyph of the character whose byte offset you specify.<P>
<PRE>
FUNCTION CharToPixel (textBuf: Ptr; textLen: LongInt; 
                      slop: Fixed; offset: LongInt; 
                      direction: Integer; 
                      styleRunPosition: JustStyleCode;
                      numer: Point; denom: Point): Integer;
</PRE>
<DL>
<DT><CODE>textBuf</CODE>
<DD> A pointer to the beginning of the text segment.
<DT><CODE>textLen</CODE>
<DD> The length in bytes of the entire text segment pointed to by <CODE>textBuf</CODE>. The <CODE>CharToPixel</CODE> function requires the context of the complete text in order to determine the correct value.
<DT><CODE>slop</CODE>
<DD> The amount of slop for the text to be drawn. A positive value extends the text segment; a negative value condenses the text segment.
<DT><CODE>offset</CODE>
<DD> The offset from <CODE>textBuf</CODE> to the character within the text segment whose display pixel location is to be measured. For 2-byte script systems, if the character whose position is to be measured is 2 bytes long, this is the offset of the first byte.
<DT><CODE>direction</CODE>
<DD> This parameter specifies whether <CODE>CharToPixel</CODE> is to return the caret position for a character with a direction of left-to-right or right-to-left. A direction value of <CODE>hilite</CODE> indicates that <CODE>CharToPixel</CODE> is to use the caret position for the character direction that matches the primary line direction as specified by the <CODE>SysDirection</CODE> global variable.
<DT><CODE>styleRunPosition</CODE>
<DD> The position on the line of this style run. The style run can be the only one on the line, the leftmost on the line, the rightmost on the line, or one between two other style runs.
<DT><CODE>numer</CODE>
<DD> A point giving the numerator for the horizontal and vertical <BR>scaling factors.
<DT><CODE>denom</CODE>
<DD> A point giving the denominator for the horizontal and vertical <BR>scaling factors.
</DL>
<A NAME=HEADING173-11></A>
<H5>DESCRIPTION</H5>
 You use <CODE>CharToPixel</CODE> to find the onscreen pixel location at which to draw a caret and to identify the selection points for highlighting. The <CODE>CharToPixel</CODE> function returns the horizontal distance in pixels from the start of the range of text beginning with the byte offset at <CODE>textBuf</CODE> to the glyph corresponding to the character whose byte offset is specified by the <CODE>offset</CODE> parameter. The pixel location is relative to the beginning of the text segment, not the left margin of the display line. To get the actual display line pixel location of the glyph relative to the left margin, you add the pixel value that <CODE>CharToPixel</CODE> returns to the pixel location at the end of the previous style run (on the left) in display order. In other words, you need to know the length of the text in pixels on the display line up to the beginning of the range of text that you call <CODE>CharToPixel</CODE> for, and then you add in the screen pixel width that <CODE>CharToPixel</CODE> returns.<P>
 You specify a value for <CODE>textLen</CODE> that is equal to the entire visible part of the style run on a line and includes trailing spaces if and only if they are displayed. They may not be displayed, for example, for the last style run in memory order, which is part of the line. Do not confuse the <CODE>textLen</CODE> parameter with the <CODE>offset</CODE>, which is the byte offset of the character within the text segment whose pixel location <CODE>CharToPixel</CODE> is to return.<P>
 If you use <CODE>CharToPixel</CODE> to get a caret position to mark the insertion point, you specify a value of <CODE>leftCaret</CODE> or <CODE>rightCaret</CODE> for the <CODE>direction</CODE> parameter. You can use the value of the <CODE>PixelToChar</CODE> <CODE>leadingEdge</CODE> flag to determine the <CODE>direction</CODE> parameter value.<P>
 If the <CODE>leadingEdge</CODE> flag is <CODE>FALSE</CODE>, you base the value of the <CODE>direction</CODE> parameter on the direction of the character at the byte offset in memory that precedes the one that <CODE>PixelToChar</CODE> returns; if <CODE>leadingEdge</CODE> is <CODE>TRUE</CODE>, you base the value of the direction parameter on the direction of the character at the byte offset that <CODE>PixelToChar</CODE> returns. If there isn't a character at the byte offset, you base the value of the <CODE>direction</CODE> parameter on the primary line direction as determined by the <CODE>SysDirection</CODE> <BR>global variable.<P>
 You can use the following constants to specify a value for <CODE>direction</CODE>.
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Constant<TH>Value<TH>Meaning<TR>
<TD><A NAME=MARKER-9-310></A>leftCaret<TD>0<TD>Place caret for left-to-right text direction.<TR>
<TD><A NAME=MARKER-2-279></A>rightCaret<TD>-1<TD>Place caret for right-to-left text direction.<TR>
<TD><A NAME=MARKER-9-311></A>hilite<TD>1<TD>Specifies that the caret position should be determined according to the primary line direction, based on the value of <CODE>SysDirection</CODE>.</TABLE>
<P>
 For more information about the scaling factors, see <A HREF=Text-147.html#MARKER-9-256>"The numer and denom Parameters" on page 3-64</A>. See <A HREF=Text-147.html#MARKER-9-255>"The styleRunPosition Parameter" on page 3-63</A> for a description of the <CODE>styleRunPosition</CODE> parameter and the values it takes. See <A HREF=Text-147.html#MARKER-9-254>"The slop Parameter" on page 3-63</A> for more information about the <CODE>slop</CODE> parameter.<P>
<DL>
<DT><B>Note</B>
<DD>Be sure to pass the same values for <CODE>styleRunPosition</CODE> and the scaling factors (<CODE>numer</CODE> and <CODE>denom</CODE>) to <CODE>CharToPixel</CODE> that you pass to any of the other justification routines for this style run.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 For more information about <CODE>CharToPixel</CODE> see <A HREF=Text-140.html#MARKER-9-200>"Drawing Carets and Highlighting" on page 3-46</A>.<P>
<A NAME=HEADING173-20></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 The <CODE>CharToPixel</CODE> function works with text in all script systems. For 1-byte contextual script systems, <CODE>CharToPixel</CODE> calculates the widths of any ligatures, reversals, and compound characters that need to be drawn.<P>
 Note that <CODE>textLen</CODE> is the number of <I>bytes</I> to be drawn, not the number of characters. Because 2-byte script systems also include characters consisting of only one byte, do not simply multiply the number of characters by 2 to determine this value; you must determine and specify the correct number of bytes.<P>
 The <CODE>CharToPixel</CODE> function may move memory; do not call this procedure at <BR>interrupt time.<A NAME=MARKER-2-358></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-172.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-174.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
