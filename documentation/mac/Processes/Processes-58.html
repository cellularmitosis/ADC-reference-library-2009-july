<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Using the Time Manager (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING58></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-57.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-59.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-53.html"><B>Chapter 3 - Time Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING58-0></A>
<H1>Using the Time Manager</H1>
 The Time Manager is automatically initialized when the system starts up. At that time, the queue of Time Manager task records is empty. The Operating System, applications, and other software components may place records into the queue. Because the delay time for a given task can be as small as 20 microseconds, you need to install an element into the Time Manager queue before actually issuing a request to execute it at some future time. You place elements into the queue by calling the <CODE>InsTime</CODE> procedure or (if you need the fixed-frequency services of the extended Time Manager) the <CODE>InsXTime</CODE> procedure. To activate the request, call <CODE>PrimeTime</CODE>. The Time Manager then marks the specified task record as active by setting the high-order bit in the <CODE>qType</CODE> field of that record.<A NAME=MARKER-9-110></A><A NAME=MARKER-2-5></A><P>
 The <CODE>tmAddr</CODE> field of the Time Manager task record contains the address of a task. The Time Manager calls this task when the time delay specified by a previous call to <CODE>PrimeTime</CODE> has elapsed. The task can perform any desired actions, as long as it does not call the Memory Manager (either directly or indirectly) and does not depend on the validity of handles to unlocked blocks. <P>
<DL>
<DT><B>Note</B>
<DD>If the routine specified in the Time Manager task record is located in your application's heap, then your application must still be active when the specified delay elapses, or the application should call <CODE>RmvTime</CODE> before it terminates. Otherwise, the Time Manager does not know that the address of that routine is not valid when the routine is called. The Time Manager then attempts to call the task, but with a stale pointer. If you want to let the application terminate after it has installed and activated a Time Manager task record, load the routine into the system heap.<B></B>  <B>&#183;</B>
</DL>
 There are two ways for an active queue element to become inactive. First, the specified time delay can elapse, in which case the routine pointed to by the <CODE>tmAddr</CODE> field is called. Second, your application can call the <CODE>RmvTime</CODE> procedure, in which case the amount of time remaining before the delay would have elapsed (the unused time) is reported in the <CODE>tmCount</CODE> field of the task record. This feature allows you to use the Time Manager to compute elapsed times (see the section <A HREF=Processes-62.html#MARKER-9-109>"Computing Elapsed Time" on page 3-14</A>), which is useful for obtaining performance measurements. Calling <CODE>RmvTime</CODE> removes an element from the queue whether or not that task is active when <CODE>RmvTime</CODE> is called.<P>
 To use the Time Manager for periodic execution of a task, simply have the routine pointed to by <CODE>tmAddr</CODE> call <CODE>PrimeTime</CODE> again. This technique is illustrated in the section <A HREF=Processes-61.html#MARKER-9-100>"Performing Periodic Tasks" on page 3-13</A>. Similarly, you can execute a Time Manager task a specific number of times by keeping a count of the number of times the task has been called. In cases where the task needs access to your application's global variables (such as a count variable), make sure that the A5 register points to your application's global variables when the task is executed and that A5 is restored to its original value when your task exits. A technique for this purpose is illustrated in <A HREF=Processes-60.html#MARKER-9-76>"Using Application Global Variables in Tasks" on page 3-11</A>.<P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DL>
<DT><A HREF="Processes-59.html#HEADING59-0">Installing and Activating Tasks</A>
<DD>
<DT><A HREF="Processes-60.html#HEADING60-0">Using Application Global Variables in Tasks</A>
<DD>
<DT><A HREF="Processes-61.html#HEADING61-0">Performing Periodic Tasks</A>
<DD>
<DT><A HREF="Processes-62.html#HEADING62-0">Computing Elapsed Time</A>
<DD>
</DL>
</DL>
</B>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-57.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-59.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
