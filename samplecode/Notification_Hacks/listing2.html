<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Notification Hacks - /GestaltTalk/GestaltTalkCommands.c</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../samplecode/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; <A HREF="javascript:location.replace('index.html');">Notification Hacks</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Carbon/idxHumanInterfaceToolbox-date.html" target="_blank">Carbon > Human Interface Toolbox</a></li>
	</ul>
</div>




</div></div></div>

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Notification Hacks</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/GestaltTalk/GestaltTalkCommands.c</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/GestaltTalk/GestaltTalk.h</option>
<option value="listing2.html">/GestaltTalk/GestaltTalkCommands.c</option>
<option value="listing3.html">/GestaltTalk/GestaltTalkSelector.c</option>
<option value="listing4.html">/NotificationMon.ƒ/Headers/Event.h</option>
<option value="listing5.html">/NotificationMon.ƒ/Headers/Menu.h</option>
<option value="listing6.html">/NotificationMon.ƒ/Headers/NotificationMon.h</option>
<option value="listing7.html">/NotificationMon.ƒ/Source/AboutBox.c</option>
<option value="listing8.html">/NotificationMon.ƒ/Source/AEvents.c</option>
<option value="listing9.html">/NotificationMon.ƒ/Source/DialogUtil.c</option>
<option value="listing10.html">/NotificationMon.ƒ/Source/Drawing.c</option>
<option value="listing11.html">/NotificationMon.ƒ/Source/errorDebug.c</option>
<option value="listing12.html">/NotificationMon.ƒ/Source/Event.c</option>
<option value="listing13.html">/NotificationMon.ƒ/Source/InitMac.c</option>
<option value="listing14.html">/NotificationMon.ƒ/Source/main.c</option>
<option value="listing15.html">/NotificationMon.ƒ/Source/Menu.c</option>
<option value="listing16.html">/NotificationMon.ƒ/Source/NotificationMon.c</option>
<option value="listing17.html">/NotificationMon.ƒ/Source/NotificationPrefs.c</option>
<option value="listing18.html">/NotificationMon.ƒ/Source/NotificationReset.c</option>
<option value="listing19.html">/NotificationMon.ƒ/Source/NotificationUtil.c</option>
<option value="listing20.html">/NotificationMon.ƒ/Source/NotificationWindow.c</option>
<option value="listing21.html">/NotificationMon.ƒ/Source/Printing.c</option>
<option value="listing22.html">/NotificationMon.ƒ/Source/PrintLoop.c</option>
<option value="listing23.html">/NotificationMon.ƒ/Source/ScrollBar.c</option>
<option value="listing24.html">/NotificationMon.ƒ/Source/ScrollBar.h</option>
<option value="listing25.html">/NotificationTrash.ƒ/NotificationTrash.c</option>
<option value="listing26.html">/NotificationTrash.ƒ/ShowInitIcon.c</option>
<option value="listing27.html">/PoliteNotification.ƒ/NMInstallPatch.c</option>
<option value="listing28.html">/PoliteNotification.ƒ/ShowInitIcon.c</option></select>
				</p>
				</form>
				<p><strong><a href="Notification_Hacks.zip">Download Sample</a></strong> (&#147;Notification_Hacks.zip&#148;, 31.4K)<BR>
<strong><a href="Notification_Hacks.dmg">Download Sample</a></strong> (&#147;Notification_Hacks.dmg&#148;, 84.6K)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">/*  GestaltTalkCommands  -------------------  By Brigham Stevens  Apple Computer DTS*/#include &lt;GestaltTalk.h&gt;/*  initialize everything - call first */static OSErr GestaltTalkInit(GestaltTalkPB *gpb);/* returns the number of bytes in buffer */static OSErr GestaltTalkStatus(GestaltTalkPB *gpb);/* read some bytes from the buffer */static OSErr GestaltTalkRead(GestaltTalkPB *gpb);/* write some bytes to the buffer */static OSErr GestaltTalkWrite(GestaltTalkPB *gpb);/* If an application registers, then an init can wake it up at the 'right times' */static OSErr GestaltTalkRegister(GestaltTalkPB *gpb);/* call before your app quits so the init will not try to wake you */static OSErr GestaltTalkUnregister(GestaltTalkPB *gpb);/* Used to get the PSN of the registerd application (pointer to it in data) */static OSErr GestaltTalkGetRegisteredApp(GestaltTalkPB *gpb);/* This function gets the address of the gestalt talk buffer and stores   the returned pointer in gtData   Then future GestaltTalk calls will be faster becuase they will not  use Gestalt to get the address of the buffer */static OSErr GestaltTalkUserInit(GestaltTalkPB *gpb);/*  This function gets the address of the gestalt talk buffer*/static OSErr GetGestaltTalkBuffer(gtp *g);#ifdef BUILD_INIT  pascal OSErr GestaltTalkGestalt(long selector, long *response);#endif/*  This is the main entry point to GestaltTalk  All of the other routines should be access by filling  out the gestaltTalk parameter block and calling this*/OSErr GestaltTalk(GestaltTalkPB *gpb){  OSErr  err = 0;    switch(gpb-&gt;command) {#ifdef BUILD_INIT    case ginit:      err = GestaltTalkInit(gpb);              break;#endif    case gstatus:    err = GestaltTalkStatus(gpb);              break;    case gread:      err = GestaltTalkRead(gpb);              break;    case gwrite:    err = GestaltTalkWrite(gpb);              break;    case gregister:    err = GestaltTalkRegister(gpb);              break;    case gunregister:  err = GestaltTalkUnregister(gpb);              break;    case ggetapp:    err = GestaltTalkGetRegisteredApp(gpb);              break;    case guserinit:    err = GestaltTalkUserInit(gpb);              break;    default:      return paramErr;  }    return err;}#ifdef BUILD_INITstatic OSErr GestaltTalkInit(GestaltTalkPB *gpb){  gtp    g;  OSErr  err = 0;    err = GetGestaltTalkBuffer(&amp;g);  if(err)  {    DebugStr(&quot;\p GestaltTalkInit - GetGestaltTalkBuffer failed.&quot;);    goto bail;  }  g-&gt;dataBuffer = NewPtrSysClear(bufferSize);  if(!g-&gt;dataBuffer) {    err = MemError();    DebugStr(&quot;\p GestaltTalkInit - NewPtrSysClear failed.&quot;);    goto bail;  }    g-&gt;buffCount = 0;bail:  return err;}#endif/*  gets the number of bytes in the buffer in datalength*/OSErr GestaltTalkStatus(GestaltTalkPB *gpb){  short   err = 0;    gtp    g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    gpb-&gt;datalength = g-&gt;buffCount;bail:    return err;}OSErr GestaltTalkRead(GestaltTalkPB *gpb){  short   err = 0;  gtp    g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    if(!g-&gt;buffCount) {    gpb-&gt;datalength = 0;    goto bail;  }  if(gpb-&gt;datalength &lt; g-&gt;buffCount) {    err = readErr;    BlockMove(g-&gt;dataBuffer, gpb-&gt;data, gpb-&gt;datalength);  } else if (gpb-&gt;datalength &gt; g-&gt;buffCount)    err = eofErr;  BlockMove(g-&gt;dataBuffer, gpb-&gt;data, g-&gt;buffCount);  gpb-&gt;datalength = g-&gt;buffCount;/*    right now this only supports one entry *//*    next version supports multiple entries */  g-&gt;buffCount = 0;bail:    return err;}OSErr GestaltTalkWrite(GestaltTalkPB *gpb){  short   err = 0;  gtp    g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    if(!gpb-&gt;datalength) {    err = paramErr;    goto bail;  }  if(gpb-&gt;datalength &gt; bufferSize) {    err = writErr;    BlockMove(gpb-&gt;data,g-&gt;dataBuffer,bufferSize);    g-&gt;buffCount = bufferSize;    gpb-&gt;datalength = bufferSize;  } else {    BlockMove(gpb-&gt;data,g-&gt;dataBuffer,gpb-&gt;datalength);    g-&gt;buffCount = gpb-&gt;datalength;  }    bail:  return err;}/*  If an appliation registers it's PSN with GestaltTalk  then the PoliteNotification init will wake up the application  so it can fetch the notification message from the buffers.*//* can be called from an interrtupt */OSErr GestaltTalkRegister(GestaltTalkPB *gpb){  short  err = 0;  gtp    g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    g-&gt;appPSN = *(ProcessSerialNumber*)gpb-&gt;data;  g-&gt;appRegistered = 0x01;  bail:  return err;}/*  can be called from an interrtupt  */OSErr GestaltTalkUnregister(GestaltTalkPB *gpb){  short        err = 0;  gtp          g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    g-&gt;appRegistered = false;  bail:    return err;}OSErr GestaltTalkGetRegisteredApp(GestaltTalkPB *gpb){  short  err = 0;  gtp    g;    if(gpb-&gt;gtData)    g = gpb-&gt;gtData;  else {    err = GetGestaltTalkBuffer(&amp;g);    if(err)  goto bail;  }    if(!g-&gt;appRegistered) {    err = paramErr;    goto bail;  }  gpb-&gt;data = &amp;g-&gt;appPSN;  gpb-&gt;datalength = sizeof(ProcessSerialNumber);  bail:    return err;}/*  This procedure returns the address of the GTalk buffer*/static OSErr GestaltTalkUserInit(GestaltTalkPB *gpb){  short   err = 0;  gtp    g;    err = GetGestaltTalkBuffer(&amp;g);  gpb-&gt;gtData = g;    bail:    return err;}OSErr GetGestaltTalkBuffer(gtp *g){  OSErr  err = 0;    #ifdef BUILD_INIT    return GestaltTalkGestalt(gestaltTalkSelector, (long*)g);  #endif    #ifdef BUILD_USER  asm {      move.l  #gestaltTalkSelector,d0      _Gestalt      move.l  g,a1      move.l  a0,(a1)    }  #endif}</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Notification_Hacks/listing2.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Notification_Hacks/listing2.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Notification_Hacks/listing2.html%3Fid%3DDTS10000194-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>