<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Accessing a Task Record at Interrupt Time (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING83></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-82.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-84.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-74.html"><B>Chapter 4 - Vertical Retrace Manager</B></A> / <A HREF="Processes-81.html"><B>Using the Vertical Retrace Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING83-0></A>
<H2><A NAME=MARKER-9-91></A>Accessing a Task Record at Interrupt Time<A NAME=MARKER-2-92></A></H2>
 <A NAME=MARKER-2-93></A>A repetitive VBL task must access its task record so that it can reset the <CODE>vblCount</CODE> field. As explained in <A HREF=Processes-78.html#MARKER-9-51>"The VBL Task Record" on page 4-6</A>, the Vertical Retrace Manager decrements the <CODE>vblCount</CODE> field during each interrupt and executes the task when that field reaches 0. The task is removed from its queue if the value of the <CODE>vblCount</CODE> field is left at 0.<P>
 When the Vertical Retrace Manager executes the VBL task, it places the address of the VBL task record into t<DFN>he A0 reg</DFN>ister. <A HREF=#MARKER-9-96>Listing 4-4</A> defines an inline function that moves this value<DFN> onto the stack</DFN>.<A NAME=MARKER-2-5></A><A NAME=MARKER-2-95></A><P>
<DL>
<DT><B>Note</B>
<DD>You should call the inline function in <A HREF=#MARKER-9-96>Listing 4-4</A> only from a VBL task. It will not work if called from your main program. In addition, the call to this function should be the first line of your VBL task, because other processing might chang<DFN>e the value in A0</DFN>.<B></B>  <B>&#183;</B>
</DL>
<B>Listing 4-4  <A NAME=MARKER-9-96></A>Finding the address of the task record from within a VBL task</B><P>
<PRE>
FUNCTION GetVBLRec: LongInt;
      INLINE $2E88;              {MOVE.L A0,(SP)}
</PRE>
 The <CODE>GetVBLRec</CODE> function defined in <A HREF=#MARKER-9-96>Listing 4-4</A> returns a long integer specifying the address of the task record. Now that you can access the task record, you can easily reset the value of the <CODE>vblCount</CODE> field. <A HREF=#MARKER-9-97>Listing 4-5</A> provides an example of a generic VBL task that accesses the task record and resets the <CODE>vblCount</CODE> field.<P>
<B>Listing 4-5  <A NAME=MARKER-9-97></A>Resetting a VBL task so that it executes again</B><P>
<PRE>
PROCEDURE DoVBL;
CONST
   kInterval = 6;                   {frequency in interrupts}
TYPE
   VBLTaskPtr = ^VBLTask;           {pointer to a VBLTask record}
VAR
   taskPtr: VBLTaskPtr;
BEGIN
   taskPtr := VBLTaskPtr(GetVBLRec);{get address of task record}

   {Put task-specific code here.}

   taskPtr^.vblCount := kInterval;  {reset vblCount}
END;
</PRE>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-82.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-84.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
