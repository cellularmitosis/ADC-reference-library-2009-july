<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Terminating an Application (IM: Pr)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING27></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Processes-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="Processes-2.html"><B>Processes</B></A><BR><DD><A HREF="Processes-21.html"><B>Chapter 2 - Process Manager</B></A> / <A HREF="Processes-23.html"><B>Using the Process Manager </B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING27-0></A>
<H2><A NAME=MARKER-9-79></A>Terminating an Application</H2>
 <A NAME=MARKER-2-19></A><A NAME=MARKER-2-106></A><A NAME=MARKER-2-112></A>The Process Manager automatically terminates a process when the process either exits its main routine or encounters a fatal error condition (such as an attempt to divide by 0). When a process terminates, the Process Manager takes care of any required cleanup operations; these include removing the process from the list of open processes and releasing the memory occupied by the application partition (as well as any temporary memory the process still holds). If necessary, the Process Manager sends an Application Died event to the process that launched the one about to terminate.<P>
 Your application can also terminate itself directly by calling the <CODE>ExitToShell</CODE> procedure. In general, you need to call <CODE>ExitToShell</CODE> only if you want to terminate your application without having it return from its main routine. This might be useful when your initialization code detects that some essential system capability is not available (for instance, when the computer running a stereo sound-editing application does not support stereo sound playback). <A HREF=#MARKER-9-85>Listing 2-3</A> shows one way to exit gracefully in this situation.<A NAME=MARKER-2-28></A><P>
<B>Listing 2-3  <A NAME=MARKER-9-85></A>Terminating an application</B><P>
<PRE>
PROCEDURE CheckForStereoSound;
VAR
   myErr:      OSErr;            {result code from Gestalt}
   myFeature:  LongInt;          {features bit flags from Gestalt}
   myString:   Str255;           {text of alert message}
   myItem:     Integer;          {item returned by StopAlert}
CONST
   kAlertBoxID    = 128;         {resource ID of alert template}
   kAlertStrings  = 128;         {resource ID of alert strings}
   kNoStereoAlert = 5;           {index of No Stereo alert text}
BEGIN
   myErr := Gestalt(gestaltSoundAttr, myFeature);
   IF myErr = noErr THEN
      IF BTst(myFeature, gestaltStereoCapability) = FALSE THEN
         BEGIN
            GetIndString(myString, kAlertStrings, kNoStereoAlert);
            ParamText(myString, '', '', '');
            myItem := StopAlert(kAlertBoxID, NIL);
            ExitToShell;         {exit the application}
         END
   ELSE
      DoError(myErr);
END;
</PRE>
 The procedure <CODE>CheckForStereoSound</CODE> defined in <A HREF=#MARKER-9-85>Listing 2-3</A> checks whether the computer supports stereo sound playback. If not, <CODE>CheckForStereoSound</CODE> notifies the user by displaying an alert box and terminates the application by calling <CODE>ExitToShell</CODE>.<P>
<DL>
<DT><B>Note</B>
<DD>The <CODE>ExitToShell</CODE> procedure is the only means of terminating a process. It is always called during process termination, whether by your application itself, the Process Manager, or some other process.<B></B>  <B>&#183;</B>
</DL>
 If your application launches another application that terminates, either normally or as the result of an error, the Process Manager can notify your application by sending it an Application Died event. To request this notification, you must set the <CODE>acceptAppDied</CODE> flag in your application's <CODE>'SIZE'</CODE> resource. (For a complete description of the <CODE>'SIZE'</CODE> resource, see the chapter "Event Manager" in Inside Macintosh: Macintosh Toolbox Essentials.)<A NAME=MARKER-2-43></A><A NAME=MARKER-9-24></A><A NAME=MARKER-9-31></A><A NAME=MARKER-21-33></A><A NAME=MARKER-2-175></A><A NAME=MARKER-2-161></A>
<TABLE BORDER="0"  CELLPADDING=3><TH align=left colspan=2>Application Died--inform that an application has terminated<TR>
<TD>Event ID<TD>kAEApplicationDied<A NAME=MARKER-9-26></A><A NAME=MARKER-2-13></A><TR>
<TD><nobr><B>Required parameters</B></nobr><TD>&nbsp;<TR>
<TD>Keyword<TD>keyErrorNumber<TR>
<TD>Descriptor type<TD>typeLongInteger<TR>
<TD>Data<TD>A sign-extended <CODE>OSErr</CODE> value. A value of <CODE>noErr</CODE> indicates normal termination; any other value indicates that the application terminated because of an error. <TR>
<TD>Keyword<TD>keyProcessSerialNumber<A NAME=MARKER-2-5></A><A NAME=MARKER-2-57></A><TR>
<TD>Descriptor type<TD>typeProcessSerialNumber<TR>
<TD>Data<TD>The process serial number of the application that terminated.<TR>
<TD><B>Requested action</B><TD>None. This Apple event is sent only to provide information.</TABLE>
<P>
 The Process Manager gets the value of the <CODE>keyErrorNumber</CODE> parameter from the system global variable <CODE>DSErrCode</CODE>. This value can be set either by the application before it terminates or by the Operating System (when the application terminates as the result of a hardware exception or other problem).<A NAME=MARKER-2-60></A><A NAME=MARKER-2-129></A><A NAME=MARKER-2-33></A><P>
</BLOCKQUOTE><P>
<HR>
<center>
<A HREF="Processes-26.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Processes-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Processes-171.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Processes-28.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Processes-3.html">&copy; Apple Computer, Inc.</A><br>17 JUN 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
