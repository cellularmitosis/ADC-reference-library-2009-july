<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebKit DOM Programming Topics: Using Drag and Drop From JavaScript</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Using Drag and Drop From JavaScript"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/30001233" title="Using Drag and Drop From JavaScript"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000418" target="_top">Apple Applications</a> &gt; <a href="../../../Safari-date.html#//apple_ref/doc/uid/TP30000440-TP30000418-TP30001042" target="_top">Safari</a> &gt; <a href="../index.html" target="_top">WebKit DOM Programming Topics</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CopyAndPaste.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Articles/XHR.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/30001233-BAJGJJAH" title="Using Drag and Drop From JavaScript"></a><hr /><H1>Using Drag and Drop From JavaScript</H1><p>Safari, Dashboard, and WebKit-based applications include support for customizing the behavior of drag and drop operations within your HTML pages.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-178904">Introduction to JavaScript Drag and Drop</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-178587">Adding Handlers to Elements</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-178644">Making an Element Draggable</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-177119-CJBEGDCH">Manipulating Dragged Data</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-177206-CJBHJGID">Changing Drag Effects</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-177395">Changing the Appearance of Dragged Elements</a>
				
			<br/>
			
        
			
			
				<a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-SW1">Cross-Browser Compatibility</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/30001233-178904" title="Introduction to JavaScript Drag and Drop"></a><h2>Introduction to JavaScript Drag and Drop</h2><p>Support for Drag and Drop operations is implemented in JavaScript and may be applied to individual elements of your HTML page. For drag operations, an element can handle the following JavaScript events:</p><ul class="ul"><li class="li"><p><code>ondragstart</code></p></li><li class="li"><p><code>ondrag</code></p></li><li class="li"><p><code>ondragend</code></p></li></ul><p>The <code>ondragstart</code> event initiates the drag operation. You can provide a handler for this event to initiate or cancel drag operations selectively. To cancel a drag operation, call the <code>cancelDefault</code> method of the event object. To handle an event, assign a value to the <code>effectAllowed</code> property and put the data for the drag in the <code>dataTransfer</code> object, which you can get from the event object. See <span class="content_text"><a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-177206">“Changing Drag Effects”</a></span> for information on the <code>effectAllowed</code> property. See <span class="content_text"><a href="DragAndDrop.html#//apple_ref/doc/uid/30001233-177119">“Manipulating Dragged Data”</a></span> for information on handling the drag data.</p><p>Once a drag is under way, the <code>ondrag</code> event is fired continuously at the element to give it a chance to perform any tasks it wants to while the drag is in progress. Upon completion of the operation, the element receives the <code>ondragend</code> event and reports whether the drag was successful.</p><p>While a drag is in progress, events are sent to elements that are potential drop targets for the contents being dragged. Those elements can handle the following events: </p><ul class="ul"><li class="li"><p><code>ondragenter</code></p></li><li class="li"><p><code>ondragover</code></p></li><li class="li"><p><code>ondragleave</code></p></li><li class="li"><p><code>ondrop</code></p></li></ul><p>The <code>ondragenter</code> and <code>ondragleave</code> events let the element know when the user’s mouse enters or leaves the boundaries of the element. You can use these events to change the cursor or provide feedback as to whether a drop can occur on an element. The <code>ondragover</code> event is sent continuously while the mouse is over the element to give it a chance to perform any needed tasks. If the user releases the mouse button, the element receives an <code>ondrop</code> event, which gives it a chance to incorporate the dropped content.</p><p>If you implement handlers for the <code>ondragenter</code> and <code>ondragover</code> events, you should call the <code>preventDefault</code> method of the event object. This method takes no parameters and notifies WebKit that your handler will act as the receiver of any incoming data. If you do not call this method, WebKit receives the data and incorporates it for you. You do not need to call <code>preventDefault</code> if you simply want to be notified when the events occur. </p><a name="//apple_ref/doc/uid/30001233-178587" title="Adding Handlers to Elements"></a><h2>Adding Handlers to Elements</h2><p>You can add handlers for drag and drop events to any element in a web page. When a drag or drop operation occurs, WebKit looks for the appropriate handler on the element that is the focus of the operation. If that element does not define a handler, WebKit walks up the list of parent elements until it finds one that does. If no element defines a handler, WebKit applies the default behavior. To demonstrate this process, suppose you have the following basic HTML in a web page:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;body ondragstart="BodyDragHandler()"<span></span></pre></td></tr><tr><td scope="row"><pre>        ondragend="BodyDragEndHandler()"><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;span ondragstart="SpanDragHandler()">Drag this text.&lt;/span><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/body><span></span></pre></td></tr></table></div><p>If a user initiates a drag operation on the text in the <code>span</code> tag, WebKit calls <code>SpanDragHandler</code> to handle the event. When the drag operation finishes, WebKit calls the <code>BodyDragEndHandler</code> to handle the event. </p><a name="//apple_ref/doc/uid/30001233-178644" title="Making an Element Draggable"></a><h2>Making an Element Draggable</h2><p>WebKit provides automatic support to let users drag common items, such as images, links, and selected text. You can extend this support to include specific elements on an HTML page. For example, you could mark a particular <code>div</code> or <code>span</code> tag as draggable. </p><p>To mark an arbitrary element as draggable, add the <code>-khtml-user-drag</code> attribute to the style definition of the element. Because it is a cascading style sheet (CSS) attribute, you can include it as part of a style definition or as an inline style attribute on the element tag. The values for this attribute are listed in <span class="content_text">Table 1</span>. </p><a name="//apple_ref/doc/uid/30001233-177042-CJBGFJAB" title="Table 1Values for -khtml-user-drag attribute"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/30001233-177042" title="Table 1Values for -khtml-user-drag attribute"></a><strong>Table 1&nbsp;&nbsp;</strong>Values for -khtml-user-drag attribute</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>none</code></p></td><td ><p>Do not allow this element to be dragged.</p></td></tr><tr><td  scope="row"><p><code>element</code></p></td><td ><p>Allow this element to be dragged.</p></td></tr><tr><td  scope="row"><p><code>auto</code></p></td><td ><p>Use the default logic for determining whether the element should be dragged. (Images, links, and text selections can be dragged but all others cannot.) This is the default value.</p></td></tr></table></div><p>The following example shows how you might use this attribute in a <code>span</code> tag to permit the dragging of the entire tag. When the user clicks on the <code>span</code> text, WebKit identifies the span as being draggable and initiates the drag operation.</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;span style="color:rgb(22,255,22); -khtml-user-drag:element;">draggable text&lt;/span><span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/30001233-177119" title="Manipulating Dragged Data"></a><a name="//apple_ref/doc/uid/30001233-177119-CJBEGDCH" title="Manipulating Dragged Data"></a><h2>Manipulating Dragged Data</h2><p>When an event occurs, your handler uses the <code>dataTransfer</code> object attached to the event to get and set the clipboard data. This object defines the <code>clearData</code>, <code>getData</code>, and <code>setData</code> methods to allow you to clear, get, and set the data on the dragging pasteboard. </p><div class="notebox"><a name="//apple_ref/doc/uid/30001233-SW2" title="Note"></a><p><strong>Note:</strong>&nbsp;For security purposes, the <code>getData</code> method can be called only from within the <code>ondrop</code> event handler. </p></div><p>Unlike many other browsers, the WebKit drag-and-drop implementation supports data types beyond those that are found in HTML documents. When you call either <code>getData</code> or <code>setData</code>, you specify the MIME type of the target data. For types it recognizes, WebKit maps the type to a known pasteboard type. However, you can also specify MIME types that correspond to any custom data formats your application understands. For most drag-and-drop operations, you will probably want to work with simple data types, such as plain text or a list of URIs. </p><p>Like applications, WebKit supports the ability to post the same data to the pasteboard in multiple formats. To add another format, you simply call the <code>setData</code> method with a different MIME type and a string of data that conforms to that type. </p><p>To get a list of types currently available on the pasteboard, you can use the <code>types</code> property of the <code>dataTransfer</code> object. This property contains an array of strings with the MIME types of the available data.</p><a name="//apple_ref/doc/uid/30001233-177206" title="Changing Drag Effects"></a><a name="//apple_ref/doc/uid/30001233-177206-CJBHJGID" title="Changing Drag Effects"></a><h2>Changing Drag Effects</h2><p>When dragging content from one place to another, it might not always make sense to move that content permanently to the destination. You might want to copy the data or create a link between the source and destination documents instead. To handle these situations, you can use the <code>effectAllowed</code> and <code>dropEffect</code> properties of the <code>dataTransfer</code> object to specify how you want data to be handled. </p><p>The <code>effectAllowed</code> property tells WebKit what types of operation the source element supports. You would typically set this property in your <code>ondragstart</code> event handler. The value for this property is a string, whose value can be one of those listed in <span class="content_text">Table 2</span>.:</p><a name="//apple_ref/doc/uid/30001233-177247-CJBBCEAH" title="Table 2Options for dragging and dropping an element"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><a name="//apple_ref/doc/uid/30001233-177247" title="Table 2Options for dragging and dropping an element"></a><strong>Table 2&nbsp;&nbsp;</strong>Options for dragging and dropping an element</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Value</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Description</p></th></tr><tr><td  scope="row"><p><code>none</code></p></td><td ><p>No drag operations are allowed on the element.</p></td></tr><tr><td  scope="row"><p><code>copy</code></p></td><td ><p>The contents of the element should be copied to the destination only.</p></td></tr><tr><td  scope="row"><p><code>link</code></p></td><td ><p>The contents of the element should be shared with the drop destination using a link back to the original. </p></td></tr><tr><td  scope="row"><p><code>move</code></p></td><td ><p>The element should be moved to the destination only. </p></td></tr><tr><td  scope="row"><p><code>copyLink</code></p></td><td ><p>The element can be copied or linked. </p></td></tr><tr><td  scope="row"><p><code>copyMove</code></p></td><td ><p>The element can be copied or moved. This is the default value. </p></td></tr><tr><td  scope="row"><p><code>linkMove</code></p></td><td ><p>The element can be linked or moved.</p></td></tr><tr><td  scope="row"><p><code>all</code></p></td><td ><p>The element can be copied, moved, or linked.</p></td></tr></table></div><p>The <code>dropEffect</code> property specifies the single operation supported by the drop target (<code>copy</code>, <code>move</code>, <code>link</code>, or <code>none</code>). When an element receives an <code>ondragenter</code> event, you should set the value of this property to one of those values, preferably one that is also listed in the <code>effectAllowed</code> property. If you do not specify a value for this property, WebKit chooses one based on the available operations (as specified in <code>effectAllowed</code>). Copy operations have priority over move operations, which have priority over link operations.</p><p>When these properties are set by the source and target elements, WebKit displays feedback to the user about what type of operation will occur if the dragged element is dropped. For example, if the dragged element supports all operations but the drop target only supports copy operations, WebKit displays feedback indicating a copy operation would occur. </p><a name="//apple_ref/doc/uid/30001233-177395" title="Changing the Appearance of Dragged Elements"></a><h2>Changing the Appearance of Dragged Elements</h2><p>During a drag operation, WebKit provides feedback to the user by displaying an image of the dragged content under the mouse. The default image used by WebKit is a snapshot of the element being dragged, but you can change this image to suit your needs. </p><a name="//apple_ref/doc/uid/30001233-177408" title="Changing the Snapshot With CSS"></a><h3>Changing the Snapshot With CSS</h3><p>The simplest way to change the drag-image appearance is to use cascading style sheet entries for draggable elements. WebKit defines the <code>-khtml-drag</code> pseudoclass, which you can use to modify the style definitions for a particular class during a drag operation. To use this pseudoclass, create a new empty style-sheet class entry with the name of the class you want to modify, followed by a a colon and the string <code>-khtml-drag</code>. In the style definition of this new class, change or add attributes to specify the differences in appearance between the original element and the element while it is being dragged. </p><p>The following example shows the style-sheet definition for an element. During normal display, the appearance of the element is determined by the style-sheet definition of the <code>divSrc4</code> class. When the element is dragged, WebKit changes the background color to match the color specified in the <code>divSrc4:-khtml-drag</code> pseudoclass. </p><div class="codesample"><table><tr><td scope="row"><pre>#divSrc4 {<span></span></pre></td></tr><tr><td scope="row"><pre>    display:inline-block;<span></span></pre></td></tr><tr><td scope="row"><pre>    margin:6;<span></span></pre></td></tr><tr><td scope="row"><pre>    position:relative;<span></span></pre></td></tr><tr><td scope="row"><pre>    top:20px;<span></span></pre></td></tr><tr><td scope="row"><pre>    width:100px;<span></span></pre></td></tr><tr><td scope="row"><pre>    height:50px;<span></span></pre></td></tr><tr><td scope="row"><pre>    background-color:rgb(202,232,255);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#divSrc4:-khtml-drag {<span></span></pre></td></tr><tr><td scope="row"><pre>    background-color:rgb(255,255,154)<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/30001233-177516" title="Specifying a Custom Drag Image"></a><h3>Specifying a Custom Drag Image</h3><p>Another way to change the drag image for an element is to specify a custom image. When a drag operation begins, you can use the <code>setDragImage</code> method of the <code>dataTransfer</code> object. This method has the following definition:</p><div class="codesample"><table><tr><td scope="row"><pre>function setDragImage(image, x, y)<span></span></pre></td></tr></table></div><p>The <code>image</code> parameter can contain either a JavaScript Image object or another element. If you specify an Image object, WebKit uses that image as the drag image for the element. If you specify an element, WebKit takes a snapshot of the element you specify (including its child elements) and uses that snapshot as the drag image instead.</p><p>The <code>x</code> and <code>y</code> parameters of <code>setDragImage</code> specify the point of the image that should be placed directly under the mouse. This value is typically the location of the mouse click that initiated the drag, with respect to the upper-left corner of the element being manipulated.</p><p>Unfortunately, obtaining this information in a cross-browser fashion is easier said than done. There is no standard way to determine the position of the mouse relative to the document because different browsers implement the standard event values in subtly incompatible ways.</p><p>For the purposes of Safari and WebKit, <code>clientX</code> and <code>clientY</code> are document relative, as are <code>pageX</code> and <code>pageY</code> (which are thus always equal to <code>clientX</code> and <code>clientY</code>). For other browsers, Evolt.org has an article that describes how to obtain the mouse position in a cross-browser fashion, including sample code, at <span class="content_text"><a href="http://evolt.org/article/Mission_Impossible_mouse_position/17/23335/index.html" target="_blank">http://evolt.org/article/Mission_Impossible_mouse_position/17/23335/index.html</a></span>.</p><p>Obtaining the position of the element under the mouse is somewhat easier. QuirksMode has a page (with code samples) on the subject at <span class="content_text"><a href="http://www.quirksmode.org/js/findpos.html" target="_blank">http://www.quirksmode.org/js/findpos.html</a></span>.</p><a name="//apple_ref/doc/uid/30001233-SW1" title="Cross-Browser Compatibility"></a><h2>Cross-Browser Compatibility</h2><p>The drag-and-drop functionality built into WebKit and Safari works similarly to support in Microsoft Internet Explorer. The functionality built into FireFox and other Gecko-based browsers is very different, however.</p><p>In currently released versions of FireFox, this form of drag and drop is not generally supported from ordinary webpages (signed XUL applications notwithstanding) because you cannot register a drop target without loading an XPCOM component. Thus, with the exception of dropping things onto text areas (which are already drop targets), drag and drop must be emulated on this browser using mouse event handlers such as <code>onmouseup</code>.</p><p>As a result of differences in browser support, most web developers who need drag-and-drop support use libraries that mask browser differences. Some of these include the <span class="content_text"><a href="http://www.dojotoolkit.org/" target="_blank">Dojo Tookit</a></span>, <span class="content_text"><a href="http://youngpup.net/projects/dom-drag/" target="_blank">DOM-Drag</a></span>, <span class="content_text"><a href="http://tool-man.org/" target="_blank">ToolMan</a></span>, <span class="content_text"><a href="http://openrico.org/" target="_blank">Rico</a></span>, and others.</p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="CopyAndPaste.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Articles/XHR.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-10-15<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/DragAndDrop.html%3Fid%3DTP40001483-4.1&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/DragAndDrop.html%3Fid%3DTP40001483-4.1&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleApplications/Conceptual/SafariJSProgTopics/Tasks/DragAndDrop.html%3Fid%3DTP40001483-4.1&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
