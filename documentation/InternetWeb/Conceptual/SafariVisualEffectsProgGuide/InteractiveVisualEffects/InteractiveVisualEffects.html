<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Safari Visual Effects Guide: Interactive Visual Effects</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Interactive Visual Effects"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40008032-CH3" title="Interactive Visual Effects"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40008032-CH1-SW1">Safari Visual Effects Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Transforms/Transforms.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40008032-CH3-SW1" title="Interactive Visual Effects"></a><h1>Interactive Visual Effects</h1><div class="notebox"><a name="//apple_ref/doc/uid/TP40008032-CH3-SW11" title="Note"></a><p><strong>Note:</strong>&nbsp;JavaScript visual effects and DOM touch events used in this chapter are available on iPhone OS only.</p></div><p>You can use visual effects in combination with DOM mouse and touch events to create interactive web applications—applications that allow the user to manipulate objects on the screen with the mouse or finger. The first step to building interactive web applications is to register for user events—specifically, register for mouse, touch, and gesture events. Next, you implement the event handlers to apply the desired visual effects. This article contains three step-by-step examples that show you how to combine event handling with visual effects. Each example uses different types of events and visual effects. For example, you can implement web applications that allow the user to manipulate a 2D graphics object using multi-touch gestures.</p>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW2">Using Click or Tap to Trigger a Transition Effect</a>
				
			<br/>
			
        
			
			
				<a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW3">Using Touch to Drag Elements</a>
				
			<br/>
			
        
			
			
				<a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW8">Using Gestures to Translate, Scale, and Rotate Elements</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40008032-CH3-SW2" title="Using Click or Tap to Trigger a Transition Effect"></a><h2>Using Click or Tap to Trigger a Transition Effect</h2><p>In this example, the user can click an element using the mouse or tap an element using a finger on an iPhone OS-based device to change the size of an element. The element is a box that increases in width by a multiple of <code>1.5</code> when tapped using a transition effect as illustrated in <span class="content_text">Figure 1</span>. </p><br/><div><a name="//apple_ref/doc/uid/TP40008032-CH3-SW9" title="Figure 1Click box to enlarge"></a><p><strong>Figure 1&nbsp;&nbsp;</strong>Click box to enlarge</p><img src = "../Art/click_box.jpg" alt = "Click box to grow application" ></div><br/><p>Follow these steps to implement this example:</p><ol class="ol"><li class="li"><p>Create an element for the user to manipulate.</p><p>This CSS fragment creates a box element and uses the <code>-webkit-transition-...</code> properties to create a smooth transition when the width of the box changes:</p><div class="codesample"><table><tr><td scope="row"><pre>div#box<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    background-color: blue;<span></span></pre></td></tr><tr><td scope="row"><pre>    display: block;<span></span></pre></td></tr><tr><td scope="row"><pre>    position: absolute;<span></span></pre></td></tr><tr><td scope="row"><pre>    width: 50;<span></span></pre></td></tr><tr><td scope="row"><pre>    height: 50;<span></span></pre></td></tr><tr><td scope="row"><pre>    -webkit-transition-property: width;<span></span></pre></td></tr><tr><td scope="row"><pre>    -webkit-transition-duration: 0.5s;<span></span></pre></td></tr><tr><td scope="row"><pre>    -webkit-transition-timing-function: default;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Register for input events.</p><p>The following HTML registers an <code>onclick</code> event  handler, <code>grow()</code>, for the box element:</p><div class="codesample"><table><tr><td scope="row"><pre>&lt;body><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;div id="box" onclick="grow();">&lt;/div><span></span></pre></td></tr><tr><td scope="row"><pre>    &lt;h1>Click box to grow&lt;/h1><span></span></pre></td></tr><tr><td scope="row"><pre>&lt;/body><span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the event handlers.</p><p>The following <code>grow()</code> JavaScript method sets the width of the box, which triggers the transition effect in step 1:</p><div class="codesample"><table><tr><td scope="row"><pre>function grow() {<span></span></pre></td></tr><tr><td scope="row"><pre>    box = document.getElementById( "box" );<span></span></pre></td></tr><tr><td scope="row"><pre>    var old_width = box.offsetWidth;<span></span></pre></td></tr><tr><td scope="row"><pre>    box.style.width = old_width * 1.5;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40008032-CH3-SW3" title="Using Touch to Drag Elements"></a><h2>Using Touch to Drag Elements</h2><p>In this example, the user can touch a box to drag it around the screen. The high-level steps are the same as before. You create an element to manipulate, register event handlers, and implement event handlers. However, in this example, touch events and transforms are used, and most of the application is written in JavaScript.</p><br/><div><a name="//apple_ref/doc/uid/TP40008032-CH3-SW12" title="Figure 2Drag box application"></a><p><strong>Figure 2&nbsp;&nbsp;</strong>Drag box application</p><img src = "../Art/drag_box.jpg" alt = "Drag box application" ></div><br/><a name="//apple_ref/doc/uid/TP40008032-CH3-SW4" title="Create an Element to Manipulate"></a><h3>Create an Element to Manipulate</h3><p>Follow these steps to create a simple box that can be dragged across the screen.</p><ol class="ol"><li class="li"><p>Implement the element creation method in JavaScript.</p><p>This <code>Box</code> creation method sets the initial position of the box and registers a handler for the <code>touchstart</code> event.</p><div class="codesample"><table><tr><td scope="row"><pre>function Box(inElement)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var self = this;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.element = inElement;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = '0,0';<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('touchstart', function(e) { return self.onTouchStart(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Next create <code>Box.prototype</code> to contain additional methods for getting and setting the position of the box.</p><div class="codesample"><table><tr><td scope="row"><pre>Box.prototype = {<span></span></pre></td></tr><tr><td scope="row"><pre>...<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a <code>position()</code> get method as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>get position()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return this._position;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li><li class="li"><p>Add a <code>position()</code> set method to set the transform using the <code>-webkit-transform</code> CSS property.</p><div class="codesample"><table><tr><td scope="row"><pre>// position strings are "x,y" with no units<span></span></pre></td></tr><tr><td scope="row"><pre>set position(pos)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    this._position = pos;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    var components = pos.split(',')<span></span></pre></td></tr><tr><td scope="row"><pre>    var x = components[0];<span></span></pre></td></tr><tr><td scope="row"><pre>    var y = components[1];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    const kUseTransform = true;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (kUseTransform) {<span></span></pre></td></tr><tr><td scope="row"><pre>        this.element.style.webkitTransform = 'translate(' + x + 'px, ' + y + 'px)';<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    else {<span></span></pre></td></tr><tr><td scope="row"><pre>        this.element.style.left = x + 'px';<span></span></pre></td></tr><tr><td scope="row"><pre>        this.element.style.top = y + 'px';<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40008032-CH3-SW5" title="Note"></a><p><strong>Note:</strong>&nbsp;Visual effects properties follow the same conventions as other CSS properties you set in JavaScript. Therefore, setting <code>this.element.style.webkitTransform</code> in JavaScript is the same as setting the <code>-webkit-transform</code> property in CSS.</p></div></li><li class="li"><p>Add <code>x()</code> and <code>y()</code> get and set methods to support the <code>position()</code> get and set methods above.</p><div class="codesample"><table><tr><td scope="row"><pre>// position strings are "x,y" with no units<span></span></pre></td></tr><tr><td scope="row"><pre>get x()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return parseInt(this._position.split(',')[0]);<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>set x(inX)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var comps = this._position.split(',');<span></span></pre></td></tr><tr><td scope="row"><pre>    comps[0] = inX;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = comps.join(',');<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>get y()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    return parseInt(this._position.split(',')[1]);<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>set y(inY)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var comps = this._position.split(',');<span></span></pre></td></tr><tr><td scope="row"><pre>    comps[1] = inY;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = comps.join(',');<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li><li class="li"><p>Now, add a <code>loaded()</code> function that creates the box element:</p><div class="codesample"><table><tr><td scope="row"><pre>function loaded()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    new Box(document.getElementById('main-box'));<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Add this line of code to invoke the <code>loaded()</code> method when the application launches:</p><div class="codesample"><table><tr><td scope="row"><pre>window.addEventListener('load', loaded, true);<span></span></pre></td></tr></table></div></li><li class="li"><p>Finally, set the appearance of the box using CSS as follows:</p><div class="codesample"><table><tr><td scope="row"><pre>.box {<span></span></pre></td></tr><tr><td scope="row"><pre>    position: absolute;<span></span></pre></td></tr><tr><td scope="row"><pre>    height: 150px;<span></span></pre></td></tr><tr><td scope="row"><pre>    width: 150px;<span></span></pre></td></tr><tr><td scope="row"><pre>    background-color: green;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>.box:active {<span></span></pre></td></tr><tr><td scope="row"><pre>    background-color: orange;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li></ol><div class="notebox"><a name="//apple_ref/doc/uid/TP40008032-CH3-SW13" title="Note"></a><p><strong>Note:</strong>&nbsp;Elements have to be clickable to receive touch events. Read <span class="content_text"><!--a target="_top" -->“Making Elements Clickable”<!--/a--></span> in <em><!--a  -->Safari Web Content Guide for iPhone OS<!--/a--></em> for how to make a nonclickable element clickable.</p></div><a name="//apple_ref/doc/uid/TP40008032-CH3-SW6" title="Register and Implement Event Handlers"></a><h3>Register and Implement Event Handlers</h3><p>The bulk of the work in dragging the box is implemented in the touch event handlers. The touch events are instances of the <code><!--a target="_top" -->TouchEvent<!--/a--></code> class. This example registers for all three types of touch events: <code>touchstart</code>, <code>touchmove</code>, and <code>touchend</code> events. It tracks single touches, not gestures, to implement dragging. Read <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW8">“Using Gestures to Translate, Scale, and Rotate Elements”</a></span> for how to handle gesture events.</p><ol class="ol"><li class="li"><p>First implement the <code>onTouchStart()</code> event handler to start tracking touch events.</p><p>The <code>onTouchStart()</code> method was registered as an event handler in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW10">“Create the Element to Manipulate.”</a></span> This method first checks to see that there is only one touch, not multiple touches. It then stores the current position and registers for <code>touchmove</code> and <code>touchend</code> events.</p><div class="codesample"><table><tr><td scope="row"><pre>onTouchStart: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Start tracking when the first finger comes down in this element<span></span></pre></td></tr><tr><td scope="row"><pre>    if (e.targetTouches.length != 1)<span></span></pre></td></tr><tr><td scope="row"><pre>        return false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.startX = e.targetTouches[0].clientX;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.startY = e.targetTouches[0].clientY;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    var self = this;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('touchmove', function(e) { return self.onTouchMove(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('touchend', function(e) { return self.onTouchEnd(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li><li class="li"><p>Next implement the <code>onTouchMove()</code> event handler to move the element. The <code>position()</code> set method, implemented in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW10">“Create the Element to Manipulate,”</a></span> uses the <code>-webkit-transform</code> CSS property to translate the element.</p><div class="codesample"><table><tr><td scope="row"><pre>onTouchMove: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Prevent the browser from doing its default thing (scroll, zoom)<span></span></pre></td></tr><tr><td scope="row"><pre>    e.preventDefault();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Don't track motion when multiple touches are down in this element (that's a gesture)<span></span></pre></td></tr><tr><td scope="row"><pre>    if (e.targetTouches.length != 1)<span></span></pre></td></tr><tr><td scope="row"><pre>        return false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    var leftDelta = e.targetTouches[0].clientX - this.startX;<span></span></pre></td></tr><tr><td scope="row"><pre>    var topDelta = e.targetTouches[0].clientY - this.startY;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    var newLeft = (this.x) + leftDelta;<span></span></pre></td></tr><tr><td scope="row"><pre>    var newTop = (this.y) + topDelta;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = newLeft + ',' + newTop;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.startX = e.targetTouches[0].clientX;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.startY = e.targetTouches[0].clientY;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40008032-CH3-SW7" title="Note"></a><p><strong>Note:</strong>&nbsp;Use the <code>preventDefault()</code> method to disable the browser default behavior. For example, Safari on iPhone might attempt to scroll or zoom when the user touches and moves a finger on the screen.</p></div></li><li class="li"><p>Finally implement the <code>onTouchEnd()</code> event handler to remove the <code>touchmove</code> and <code>touchend</code> event handlers.</p><p>This method is invoked after the last touch leaves the screen, so you no longer need to observe <code>touchmove</code> and <code>touchend</code> events until the next <code>touchstart</code> event.</p><div class="codesample"><table><tr><td scope="row"><pre>onTouchEnd: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Prevent the browser from doing its default thing (scroll, zoom)<span></span></pre></td></tr><tr><td scope="row"><pre>    e.preventDefault();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Stop tracking when the last finger is removed from this element<span></span></pre></td></tr><tr><td scope="row"><pre>    if (e.targetTouches.length > 0)<span></span></pre></td></tr><tr><td scope="row"><pre>        return false;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.removeEventListener('touchmove', function(e) { return self.onTouchMove(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.removeEventListener('touchend', function(e) { return self.onTouchEnd(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li></ol><a name="//apple_ref/doc/uid/TP40008032-CH3-SW8" title="Using Gestures to Translate, Scale, and Rotate Elements"></a><h2>Using Gestures to Translate, Scale, and Rotate Elements</h2><p>Gesture events are high-level events that encapsulate the lower-level touch events—they are instances of the <code><!--a target="_top" -->GestureEvent<!--/a--></code> class. Gesture and touch events can occur at the same time. Your application has the choice of handling touch events, gesture events, or both. The advantage of gesture events is that the location and angle of the fingers are already calculated when the events arrive. Thus gesture events support pinch open to zoom in, pinch close to zoom out, and pivoting to rotate elements. You simply apply the event location, scale, and rotation values to your element.</p><p>The steps in this example are similar to implementing the draggable box in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW3">“Using Touch to Drag Elements.”</a></span> Instead of just dragging the box, the user can also pinch open and close to scale it and pivot to rotate it. To do this, you simply extend the example to handle gesture events for scaling and rotating. In summary, you create the element to manipulate, register for touch and gesture events, and implement handlers that translate, scale, and rotate the element.</p><a name="//apple_ref/doc/uid/TP40008032-CH3-SW10" title="Create the Element to Manipulate"></a><h3>Create the Element to Manipulate</h3><p>Follow these steps to create a simple box that can be translated, scaled, and rotated.</p><ol class="ol"><li class="li"><p>Implement the element creation method in JavaScript.</p><p>This <code>Box</code> creation method sets the initial position, scale, and rotation of the box and registers handlers for the <code>touchstart</code> and <code>gesturestart</code> events.</p><div class="codesample"><table><tr><td scope="row"><pre>function Box(inElement)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    var self = this;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.element = inElement;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.scale = 1.0;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.rotation = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = '0,0';<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('touchstart', function(e) { return self.onTouchStart(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('gesturestart', function(e) { return self.onGestureStart(e) }, false);<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div></li><li class="li"><p>Follow steps 2 through 8 in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW4">“Create an Element to Manipulate”</a></span> to create a box prototype, add the <code>position()</code> accessors and associated support methods, and create the box.</p></li></ol><a name="//apple_ref/doc/uid/TP40008032-CH3-SW14" title="Register and Implement Event Handlers"></a><h3>Register and Implement Event Handlers</h3><p>The bulk of the work in this application is in the touch and gesture event handlers. This example builds on the example in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW3">“Using Touch to Drag Elements”</a></span> by handling gesture events, too. The touch events are used to implement dragging as before and the gesture events are used to implement translating, scaling, and rotating.</p><ol class="ol"><li class="li"><p>First implement the <code>onTouchStart()</code>, <code>onTouchMove()</code>, and <code>onTouchEnd()</code> event handlers by following step 1 through 3 in <span class="content_text"><a href="InteractiveVisualEffects.html#//apple_ref/doc/uid/TP40008032-CH3-SW6">“Register and Implement Event Handlers”</a></span> to allow single-finger dragging.</p></li><li class="li"><p>Next, implement the <code>onGestureStart()</code> event handler to begin tracking gesture events for translating, scaling, and rotating.</p><p>This method registers the other gesture event handlers, <code>onGestureChange()</code> and <code>onGestureEnd()</code>, for the <code>gesturechange</code> and <code>gestureend</code> events.</p><div class="codesample"><table><tr><td scope="row"><pre>onGestureStart: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Prevent the browser from doing its default thing (scroll, zoom)<span></span></pre></td></tr><tr><td scope="row"><pre>    e.preventDefault();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    var self = this;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('gesturechange', function(e) { return self.onGestureChange(e) }, true);<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.addEventListener('gestureend', function(e) { return self.onGestureEnd(e) }, true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code>onGestureChange()</code> event handler to translate, scale, and rotate the element.</p><p>This method sets the element’s scale and rotation to the <code><!--a target="_top" -->GestureEvent<!--/a--></code> object’s precomputed scale and rotation values. You do not need to compute the distance between multiple fingers or the change in angle to scale and rotate the element.</p><div class="codesample"><table><tr><td scope="row"><pre>onGestureChange: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Prevent the browser from doing its default thing (scroll, zoom)<span></span></pre></td></tr><tr><td scope="row"><pre>    e.preventDefault();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    // Only interpret gestures when tracking one object.  Otherwise, interpret raw touch events<span></span></pre></td></tr><tr><td scope="row"><pre>    // to move the tracked objects.<span></span></pre></td></tr><tr><td scope="row"><pre>    this.scale = e.scale;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.rotation = e.rotation;<span></span></pre></td></tr><tr><td scope="row"><pre>    this.position = this.position;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li><li class="li"><p>Implement the <code>onGestureEnd()</code> event handler to remove the handlers for the <code>gesturechange</code> and <code>gestureend</code> events.</p><div class="codesample"><table><tr><td scope="row"><pre>onGestureEnd: function(e)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    // Prevent the browser from doing its default thing (scroll, zoom)<span></span></pre></td></tr><tr><td scope="row"><pre>    e.preventDefault();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.removeEventListener('gesturechange', this.gestureChangeHandler, true);<span></span></pre></td></tr><tr><td scope="row"><pre>    this.element.removeEventListener('gestureend', this.gestureEndHandler, true);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return false;<span></span></pre></td></tr><tr><td scope="row"><pre>},<span></span></pre></td></tr></table></div></li></ol>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Transforms/Transforms.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../RevisionHistory.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-11-19<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/InternetWeb/Conceptual/SafariVisualEffectsProgGuide/InteractiveVisualEffects/InteractiveVisualEffects.html%3Fid%3DTP40008032-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/InternetWeb/Conceptual/SafariVisualEffectsProgGuide/InteractiveVisualEffects/InteractiveVisualEffects.html%3Fid%3DTP40008032-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/InternetWeb/Conceptual/SafariVisualEffectsProgGuide/InteractiveVisualEffects/InteractiveVisualEffects.html%3Fid%3DTP40008032-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>