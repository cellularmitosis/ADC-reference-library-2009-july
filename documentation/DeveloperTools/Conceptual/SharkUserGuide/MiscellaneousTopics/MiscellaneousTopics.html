<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shark User Guide: Miscellaneous Topics</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Miscellaneous Topics"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005233-CH14" title="Miscellaneous Topics"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000436" target="_top">Tools</a> &gt; <a href="../../../Performance-date.html#//apple_ref/doc/uid/TP30000440-TP30000436-TP30000901" target="_top">Performance</a> &gt; <a href="../Introduction/Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_6">Shark User Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../CommandReference/CommandReference.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../IntelCorePMCTablesAppendix/IntelCorePMCTablesAppendix.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005233-CH14-SW3" title="Miscellaneous Topics"></a><h1>Miscellaneous Topics</h1>
<!-- This template is being used for both PDF and HTML. -->

    
    <h4>In this section:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="MiscellaneousTopics.html#//apple_ref/doc/uid/TP40005233-CH14-SW2">Code Analysis with the G5 (PPC970) Model</a>
				
			<br/>
			
        
			
			
				<a href="MiscellaneousTopics.html#//apple_ref/doc/uid/TP40005233-CH14-SW5">Supervisor Space Sampling Guidelines</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005233-CH14-SW2" title="Code Analysis with the G5 (PPC970) Model"></a><h2>Code Analysis with the G5 (PPC970) Model</h2><p>Shark offers several features designed to help the programmer understand instruction execution behavior on the G5 (PPC970). From the <em>Advanced Settings</em> drawer’s <em>Assembly Browser</em> tab, you can set the <em>Assembly Browser</em> to display an estimate of G5 dispatch group formations, using the check box near item #1 in <span class="content_text">Figure B-1</span>. After this is checked, the assembly display around item #2 has dark lines added to indicate breaks between instruction dispatch groups. If you look closely, you will see that all of Shark’s samples generally fall on the first or last instructions of dispatch groups, due to the way program counters are captured by Shark on the G5 processor. A key factor in optimizing performance on the G5 is maximizing dispatch group sizes. A detailed explanation of G5 dispatch group formation rules is beyond the scope of this document, but Shark accurately models the CPU behavior as much as possible using static analysis. See the PowerPC970 User Manual (see the <span class="content_text"><a href="http://www.ibm.com/chips/techlib/techlib.nsf/products/PowerPC_970_and_970FX_Microprocessors" target="_blank">PowerPC 970 documentation</a></span>) for a complete description of dispatch groups.</p><p>Functional unit utilization and dispatch slot utilization are two more features that Shark offers to visualize G5 execution behavior. When the user selects Show G5 (PPC970) <em>Details Drawer</em> in the <em>Advanced Settings</em> drawer (at #1 in <span class="content_text">Figure B-1</span>), the user will see the <em>G5 Resource Utilization</em> drawer. The <em>Functional Unit Utilization</em> chart and table (item #3) provide visual feedback to the programmer about how effectively instructions are spread among the various functional units within the G5. Similarly, the number of dispatch groups and instructions flowing into each G5 dispatch slot are shown in the <em>Dispatch Slot Utilization</em> chart and table (item #4). Please note that the data in the <em>G5 Resource Utilization</em> drawer is based on the currently selected instructions in the Code Table, or on the entire code sequence if nothing is selected. The user can specify a subset of instructions within the current <em>Code Table</em>, and the <em>G5 Resource Utilization</em> charts and tables will update dynamically. </p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH14-SW1" title="Figure B-1PPC970 Resource Modeling"></a><p><strong>Figure B-1&nbsp;&nbsp;</strong>PPC970 Resource Modeling</p><img src = "../Art/G5AsmBrowserSmall.jpg" alt = "PPC970 Resource Modeling" ></div><br/><a name="//apple_ref/doc/uid/TP40005233-CH14-SW5" title="Supervisor Space Sampling Guidelines"></a><h2>Supervisor Space Sampling Guidelines</h2><p>Supervisor space samples come from either the Mach kernel or kernel extensions. If you are a driver writer or simply interested in the workings of the Mac OS X kernel, you may encounter inconsistent results between timer sampling and event sampling when profiling code that executes with interrupts disabled. For example, consider the PowerPC-specific virtual memory (VM) page-zeroing code in the kernel. When profiled with timer sampling, Shark displays the output shown in <span class="content_text">Figure B-2</span>. Because <code>pmap_zero_page()</code> disables interrupts, any timer interrupts that occur in it are not serviced until interrupts are reenabled in <code>ml_restore()</code>. It is for this reason that all of the timer samples appear to come from the isync instruction at <code>0x96da8</code> (see <span class="content_text">Figure B-2</span>).</p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH14-SW6" title="Figure B-2Timer Sampling in the Kernel"></a><p><strong>Figure B-2&nbsp;&nbsp;</strong>Timer Sampling in the Kernel</p><img src = "../Art/figure7-2.jpg" alt = "Timer Sampling in the Kernel" ></div><br/><p>A more accurate picture of the kernel behavior can be seen with event sampling (<span class="content_text">Figure B-3</span>). This is because CPU event sampling reads the SIAR (sampled instruction address register) rather than the originating PC when the performance monitor interrupt is serviced. Whenever a CPU performance monitor interrupt (PMI) occurs, the SIAR register is set to the currently executing PC (program counter) . As in the timer sampling case, the PMI is not actually serviced until interrupts are reenabled. </p><br/><div><a name="//apple_ref/doc/uid/TP40005233-CH14-SW7" title="Figure B-3CPU PMI Sampling in the Kernel"></a><p><strong>Figure B-3&nbsp;&nbsp;</strong>CPU PMI Sampling in the Kernel</p><img src = "../Art/Figure8-3.jpg" alt = "CPU PMI Sampling in the Kernel" ></div><br/>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../CommandReference/CommandReference.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../IntelCorePMCTablesAppendix/IntelCorePMCTablesAppendix.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-04-14<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/MiscellaneousTopics/MiscellaneousTopics.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/MiscellaneousTopics/MiscellaneousTopics.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/MiscellaneousTopics/MiscellaneousTopics.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>