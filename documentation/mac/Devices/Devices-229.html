<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the ADB Manager(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING229></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-228.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-230.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-203.html"><B>Chapter 5 - ADB Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING229-0></A>
<H1>Summary of the ADB Manager</H1>
<A NAME=HEADING229-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING229-2></A>
<H3>Data Types</H3>
<PRE>
TYPE ADBDataBlock = 
   PACKED RECORD
      devType:          SignedByte;    {device handler ID}
      origADBAddr:      SignedByte;    {default ADB address}
      dbServiceRtPtr:   Ptr;           {pointer to device handler}
      dbDataAreaAddr:   Ptr;           {pointer to data area}
   END;
   ADBDBlkPtr = ^ADBDataBlock;
TYPE ADBSetInfoBlock = 
   RECORD
      siServiceRtPtr:   Ptr;           {pointer to device handler}
      siDataAreaAddr:   Ptr;           {pointer to data area}
   END;
   ADBSInfoPtr = ^ADBSetInfoBlock;
TYPE ADBOpBlock =
   RECORD
      dataBuffPtr:      Ptr;           {address of data buffer}
      opServiceRtPtr:   Ptr;           {pointer to device handler}
      opDataAreaPtr:    Ptr;           {pointer to optional data area}
   END;
   ADBOpBPtr = ^ADBOpBlock;
   ADBAddress = SignedByte;
</PRE>
<A NAME=HEADING229-7></A>
<H3>ADB Manager Routines</H3>
<A NAME=HEADING229-8></A>
<H4>Initializing the ADB Manager</H4>
<PRE>
PROCEDURE ADBReInit;
</PRE>
<A NAME=HEADING229-10></A>
<H4>Communicating Through the ADB</H4>
<PRE>
FUNCTION ADBOp     (data: Ptr; compRout: ProcPtr; buffer: Ptr; 
                    commandNum: Integer): OSErr;
</PRE>
<A NAME=HEADING229-12></A>
<H4>Getting ADB Device Information</H4>
<PRE>
FUNCTION CountADBs:Integer;
FUNCTION GetIndADB  (VAR info: ADBDataBlock; 
                     devTableIndex: Integer): ADBAddress;
FUNCTION GetADBInfo (VAR info: ADBDataBlock; 
                     adbAddr: ADBAddress): OSErr;
</PRE>
<A NAME=HEADING229-16></A>
<H4>Setting ADB Device Information</H4>
<PRE>
FUNCTION SetADBInfo (VAR info: ADBSetInfoBlock; 
                     adbAddr: ADBAddress): OSErr;
</PRE>
<A NAME=HEADING229-18></A>
<H3>Application-Defined Routines</H3>
<PRE>
PROCEDURE MyDeviceHandler;
PROCEDURE MyCompletionRoutine;
</PRE>
<A NAME=HEADING229-21></A>
<H2>C Summary</H2>
<A NAME=HEADING229-22></A>
<H3>Data Types</H3>
<PRE>
typedef char ADBAddress;
struct ADBDataBlock {
   char        devType;                /*device type*/
   char        origADBAddr;            /*original ADB address*/
   Ptr         dbServiceRtPtr;         /*pointer to device handler*/
   Ptr         dbDataAreaAdd;          /*pointer to data area*/
};
typedef struct ADBDataBlock ADBDataBlock;
typedef ADBDataBlock *ADBDBlkPtr;
struct ADBSetInfoBlock {
   Ptr         siServiceRtPtr;         /*pointer to device handler*/
   Ptr         siDataAreaAddr;         /*pointer to data area*/
};
typedef struct ADBSetInfoBlock ADBSetInfoBlock;
typedef ADBSetInfoBlock *ADBSInfoPtr;
struct ADBOpBlock {
   Ptr         dataBuffPtr;            /*address of data buffer*/
   Ptr         opServiceRtPtr;         /*pointer to device handler*/
   Ptr         opDataAreaPtr;          /*pointer to optional data area*/
};
typedef struct ADBOpBlock ADBOpBlock;
typedef ADBOpBlock *ADBOpBPtr;
</PRE>
<A NAME=HEADING229-27></A>
<H3>ADB Manager Functions</H3>
<A NAME=HEADING229-28></A>
<H4>Initializing the ADB Manager</H4>
<PRE>
pascal void ADBReInit(void);
</PRE>
<A NAME=HEADING229-30></A>
<H4>Communicating Through the ADB</H4>
<PRE>
pascal OSErr ADBOp  (Ptr data, ProcPtr compRout, Ptr buffer, 
                     short commandNum);
</PRE>
<A NAME=HEADING229-32></A>
<H4>Getting ADB Device Information</H4>
<PRE>
pascal short CountADBs   (void);
pascal ADBAddress GetIndADB
                         (ADBDataBlock *info, short devTableIndex);
pascal OSErr GetADBInfo  (ADBDataBlock *info, ADBAddress adbAddr);
</PRE>
<A NAME=HEADING229-37></A>
<H4>Setting ADB Device Information</H4>
<PRE>
pascal OSErr SetADBInfo  (ADBSetInfoBlock *info, ADBAddress adbAddr);
</PRE>
<A NAME=HEADING229-39></A>
<H3>Application-Defined Functions</H3>
<PRE>
pascal void MyDeviceHandler     (void);
pascal void MyCompletionRoutine (void);
</PRE>
<A NAME=HEADING229-42></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING229-43></A>
<H3>Data Structures</H3>
<A NAME=HEADING229-44></A>
<H4>ADB Data Block
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>devType<TD>byte<TD>device type<TR>
<TD>1<TD>origADBAddr<TD>byte<TD>original ADB address<TR>
<TD>2<TD>dbServiceRtPtr<TD>long<TD>pointer to completion routine<TR>
<TD>6<TD>dbDataAreaAddr<TD>long<TD>pointer to data area </TABLE>
</H4>
<A NAME=HEADING229-45></A>
<H4>ADB Information Block
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>siServiceRtPtr<TD>long<TD>pointer to completion routine<TR>
<TD>4<TD>siDataAreaAddr<TD>long<TD>pointer to data area </TABLE>
</H4>
<A NAME=HEADING229-46></A>
<H4>ADB Operation Block
<TABLE BORDER="0" CELLPADDING=3><TD>0<TD>dataBuffPtr<TD>long<TD>address of data buffer<TR>
<TD>4<TD>opServiceRtPtr<TD>long<TD>pointer to completion routine<TR>
<TD>8<TD>opDataAreaPtr<TD>long<TD>pointer optional data area </TABLE>
</H4>
<A NAME=HEADING229-47></A>
<H3>Trap Macros</H3>
<A NAME=HEADING229-48></A>
<H4>Trap Macro Names
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Pascal name<TH>Trap macro name<TR>
<TD>ADBReInit<TD>_ADBReInit<TR>
<TD>ADBOp<TD>_ADBOp<TR>
<TD>CountADBs<TD>_CountADBs<TR>
<TD>GetIndADB<TD>_GetIndADB<TR>
<TD>GetADBInfo<TD>_GetADBInfo<TR>
<TD>SetADBInfo<TD>_SetADBInfo</TABLE>
</H4>
<A NAME=HEADING229-49></A>
<H3>Global Variables
<TABLE BORDER="0" CELLPADDING=3><TD>JADBProc<TD>long<TD>Pointer to <CODE>ADBReInit</CODE> preprocessing/postprocessing routine.<TR>
<TD>KbdLast<TD>byte<TD>ADB address of the keyboard last used.<TR>
<TD>KbdType<TD>byte<TD>Keyboard type of the keyboard last used.</TABLE>
</H3>
<A NAME=HEADING229-50></A>
<H2>Result Codes<A NAME=MARKER-2-294></A>
<TABLE BORDER="0" CELLPADDING=3><TD><CODE>noErr</CODE><TD>0<TD>No error<TR>
<TD><CODE>errADBop</CODE><TD>-1<TD>Unsuccessful completion</TABLE>
<A NAME=MARKER-2-231></A><A NAME=MARKER-2-232></A></H2>
</BLOCKQUOTE><P>

<HR>
<center>
<A HREF="Devices-228.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-230.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
