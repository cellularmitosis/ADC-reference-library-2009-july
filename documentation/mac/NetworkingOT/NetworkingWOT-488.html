<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Options Negotiation Rules</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING488></A>
<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->

<!-- Main Body -->

<CENTER>
<P>
<A HREF="NetworkingWOT-487.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-489.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html"><B>Inside Macintosh:</B></A> <A HREF="NetworkingWOT-2.html"><B>Networking With Open Transport </B></A> / <A HREF="NetworkingWOT-81.html"><B>Part 2 - Open Transport Reference</B></A><BR><DD><A HREF="NetworkingWOT-485.html"><B>Appendix D - XTI Option Summary</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING488-0></A>
<H1><A NAME=MARKER-9-16></A>Options Negotiation Rules</H1>
 This section describes the rules governing option negotiation and the error conditions that might occur during this process. Unless stated otherwise, these rules apply to all functions that allow you to specify option values.<P>
 A basic rule to keep in mind is that options change only as the result of successful negotiations or partly successful negotiations. If you use any function except the <CODE>OTOptionManagement</CODE> function, the changes last for the duration of that function invocation. Option values are not changed by a change in the state of an endpoint. Once you change an option value permanently, there is no function that you can call to restore an option to its previous value, unless that previous value is the default value.<A NAME=MARKER-13-17></A><P>
<A NAME=HEADING488-3></A>
<H2>Negotiating Multiple Options</H2>
 You can use one function to negotiate several options by placing the options in the options buffer passed to the function. If one of the options is ignored or rejected for any reason, the outcome depends on the function you use to set options.<A NAME=MARKER-13-18></A><P>
<UL>
<P><P><LI>If you use the <CODE>OTOptionManagement</CODE> function, the function returns the result of negotiating each option in the <CODE>status</CODE> field of each option. The failure of one or more options does not cause the function to fail.
<P><P><LI>The <CODE>OTConnect</CODE>, <CODE>OTAccept</CODE>, <CODE>OTSndUdata</CODE>, or <CODE>OTSndURequest</CODE> functions might succeed or fail, depending on the implementation and on the error condition. Options that are not supported are generally ignored; they do not cause a function to fail or a connection to abort. However, if the endpoint provider is unable to negotiate options that are absolute requirements or options that are read-only, these functions will fail.<P>
If option negotiation causes one of these functions to fail, it is possible that some options were successfully negotiated before the failure. However, it is not possible to determine which of the options caused the failure. Those options that were successfully negotiated retain their new values. There is no undo mechanism.<P>
</UL>
 If you specify the same option more than once, the endpoint provider does not check for duplicate occurrences of the same option. It simply processes the options one after another. However, the endpoint provider might negotiate options in any order; therefore, it is not safe to make any assumptions that a later occurrence of an option will override an earlier occurrence.<P>
<A NAME=HEADING488-9></A>
<H2><A NAME=MARKER-9-19></A>Initiating an Option Negotiation</H2>
 <A NAME=MARKER-13-20></A>You initiate an option negotiation by calling the <CODE>OTOptionManagement</CODE> function with the flag <CODE>T_NEGOTIATE</CODE> set or by calling the <CODE>OTConnect</CODE>, <CODE>OTSndUData</CODE>, or <CODE>OTSndURequest</CODE> function and specifying an options buffer length that is greater than 0. You can specify values for some or all of the options supported by an endpoint. The endpoint provider takes values for options that you do not specify explicitly in the options buffer from the endpoint's internal options buffer. This buffer contains the endpoint's current option values; these could be default values, values that you specified when you configured the provider, or values resulting from a previous negotiation.<P>
 If the endpoint supports an option, the possible outcome of option negotiation depends on whether the option is an absolute requirement, as described in the next two sections. If the endpoint does not support the option, the <CODE>OTOptionManagement</CODE> function reports <CODE>T_NOTSUPPORT</CODE> in the <CODE>status</CODE> field. The <CODE>OTConnect</CODE>, <CODE>OTSndUData</CODE>, or <CODE>OTSndURequest</CODE> functions ignore the option. <P>
<A NAME=HEADING488-12></A>
<H2>Options That Are Absolute Requirements</H2>
 If the option is an absolute requirement, the result of the negotiation depends on whether the negotiated value is the same as the requested value. If it is, the <CODE>status</CODE> field in the <CODE>TOption</CODE> structure describing the option is set to <CODE>T_SUCCESS</CODE> when the function returns. If the negotiated value is not the same as the requested value, the result depends on the function used to negotiate the option:<A NAME=MARKER-13-21></A><P>
<UL>
<P><P><LI>The <CODE>OTOptionManagement</CODE> function returns successfully, but the returned option has its <CODE>status</CODE> field set to <CODE>T_FAILURE</CODE>.
<P><P><LI>A call to the <CODE>OTConnect</CODE> function fails. If the call is synchronous, the function returns with the <CODE>kOTLookErr</CODE> result. If the call is asynchronous, the endpoint provider issues a <CODE>T_DISCONNECT</CODE> event to let you know that the connection has been rejected.
<P><P><LI>The <CODE>OTSndUData</CODE> function fails with the <CODE>kOTLookErr</CODE> result; or if it returns successfully, the endpoint provider issues a <CODE>T_UDERR</CODE> event to indicate that the datagram was not sent.<P>
</UL>
<A NAME=HEADING488-17></A>
<H2>Options That Are Not Absolute Requirements</H2>
 If the requested option is not an absolute requirement, the result of the negotiation depends on whether the negotiated value is the same as the requested value. If it is, the endpoint provider sets the <CODE>status</CODE> field of the <CODE>TOption</CODE> structure describing the option to <CODE>T_SUCCESS</CODE>. If the negotiated value is different than the proposed value, the endpoint provider sets the <CODE>status</CODE> field of the <CODE>TOption</CODE> structure describing the options to <CODE>T_PARTSUCCESS</CODE>. If the option is not supported, the <CODE>status</CODE> field is set to <CODE>T_NOTSUPPORT</CODE>.<P>
<A NAME=HEADING488-19></A>
<H2>Conflicting Option Values</H2>
 It is possible that a requested option value conflicts with the value of another option that is proposed with the same call to the function or with a value that is currently set. The endpoint provider might not detect these conflicts immediately, and later they might lead to unpredictable results. If the endpoint provider detects conflicts at negotiation time, the conflicts are resolved according to the rules stated above. <A NAME=MARKER-13-22></A><P>
 An endpoint provider usually detects conflicts at the time it establishes a connection or sends a datagram. Consequently, if you use the <CODE>OTOptionManagement</CODE> function to set options, you might not become aware that there is a problem due to conflicting options until the options are actually exercised during connection establishment or data transmission.<P>
<A NAME=HEADING488-22></A>
<H2><A NAME=MARKER-9-23></A>Privileged or Read-Only Options</H2>
 A protocol implementation can define options to be privileged or read-only. These two categories are not necessarily separate. A privileged option might be inaccessible or read-only for nonprivileged clients. An option might be read-only for all clients or solely for nonprivileged clients. Here are two general guidelines to keep in mind:<A NAME=MARKER-13-24></A><P>
<UL>
<P><P><LI>A client must be privileged to be able to change a privileged option.<P>
In the Mac OS implementation of Open Transport, there are no privileged options.
<P><P><LI>A client cannot usually change the value of a read-only option. <P>
An option might be read-only in some endpoint states but not in others. For example, the ISO quality-of-service options are negotiable in the <CODE>T_IDLE</CODE> and <CODE>T_INCON</CODE> states, and read-only in all other states except <CODE>T_UNINIT</CODE>. Consult the documentation provided for the protocol you are using to determine whether an endpoint's state affects the status of read-only options.<P>
</UL>
 If you request negotiation of a privileged option using the <CODE>OTOptionManagement</CODE> function, the function returns successfully with the <CODE>status</CODE> field of the privileged option set to <CODE>T_NOTSUPPORT</CODE>. If you use the <CODE>OTConnect</CODE>, <CODE>OTAccept</CODE>, <CODE>OTSndUData</CODE>, or <CODE>OTSndURequest</CODE> functions, the option is ignored--that is, the function result is not affected by the fact that the options are not supported.<P>
 If you request negotiation of a read-only option using the <CODE>OTOptionManagement</CODE> function, the function returns with the <CODE>status</CODE> field of the read-only option set to <CODE>T_READONLY</CODE>. If you use any other function to change a read-only option, the results vary with the function used:<P>
<UL>
<P><P><LI>The <CODE>OTAccept</CODE> or <CODE>OTConnect</CODE> functions fail with the <CODE>kOTAccessErr</CODE> result, or the connection establishment aborts and the endpoint provider issues a <CODE>T_DISCONNECT</CODE> event. If the connection aborts, a synchronous call to <CODE>OTConnect</CODE> fails with the <CODE>KOTLookErr</CODE> result. Timing and the protocol implementation determine whether the <CODE>OTAccept</CODE> function succeeds or fails with the <CODE>kOTLookErr</CODE> result.
<P><P><LI>The <CODE>OTSndUData</CODE> function might return the <CODE>kOTLookErr</CODE> result or return successfully, but the endpoint provider issues a <CODE>T_UDERR</CODE> event to indicate that it did not send the datagram.<P>
</UL>
<A NAME=HEADING488-32></A>
<H2>Error Conditions</H2>
 Option negotiation might be affected if you try to negotiate an illegal option, a privileged or read-only option, an unsupported option, or an option for an unsupported protocol (level). The results of attempting to negotiate privileged or read-only options are described in <A HREF=#MARKER-9-23>"Privileged or Read-Only Options"</A>. This section explains the outcome of negotiating illegal options and describes other problems that might arise during option negotiation.<A NAME=MARKER-13-25></A><P>
 An option is illegal in these cases:<P>
<UL>
<P><P><LI>It is the last option in an options buffer, and the length specified in the <CODE>TOption.len</CODE> field exceeds the remaining size of the options buffer. (The length of the option includes the option header as well as the option value. See <A HREF=NetworkingWOT-38.html#MARKER-9-32>Figure 7-2</A> for information about the format of option information in an options buffer.) <A NAME=MARKER-13-26></A>
<P><P><LI>The option value does not fall within the range of legal values for the option. The range of option values that are valid for a protocol implementation are given in the documentation provided for the protocol.<P>
</UL>
 If you specify an illegal option, the following error conditions result, depending on the function you used:<P>
<UL>
<P><P><LI>The <CODE>OTOptionManagement</CODE> function returns with the <CODE>kOTBadOptionErr</CODE> result. 
<P><P><LI>Either the <CODE>OTAccept</CODE> or <CODE>OTConnect</CODE> function fails with a <CODE>kOTBadOptionErr</CODE> result, or the connection establishment aborts, depending upon the implementation and the time the illegal option is detected. If the connection aborts, the endpoint provider issues a <CODE>T_DISCONNECT</CODE> event. If <CODE>OTConnect</CODE> is executing synchronously, it fails with the <CODE>kOTLookErr</CODE> result. The <CODE>OTAccept</CODE> function either succeeds, or fails with the <CODE>kOTLookErr</CODE> result, depending on the implementation.
<P><P><LI>The <CODE>OTSndUData</CODE> function fails with the <CODE>kOTBadOptionErr</CODE> result, or it returns successfully, but the endpoint provider issues a <CODE>T_UDERR</CODE> event to indicate that it did not sent the datagram.<P>
</UL>
 If the options buffer you pass to a function contains multiple options and one of them is illegal, the function fails as described. However, if you used the <CODE>OTOptionManagement</CODE> function to set options, it is possible that some or all of the legal options in the buffer were successfully negotiated. You can check the current status for the endpoint by calling the <CODE>OTOptionManagement</CODE> function with the <CODE>T_CURRENT</CODE> flag set.<P>
 The <CODE>OTOptionManagement</CODE> function fails with the <CODE>kOTBadOptionErr</CODE> result if you specify an unknown value for the option protocol level. Using any other function to specify an unknown option level does not cause the function to fail, but results in the option being ignored.<P>
 Specifying an option name that is unknown or unsupported by the endpoint does not cause a function to fail. The <CODE>OTOptionManagement</CODE> function returns <CODE>T_NOTSUPPORT</CODE> in the <CODE>status</CODE> field for the option; the other endpoint functions ignore the unknown options.<P>
<A NAME=HEADING488-44></A>
<H2>Allowing the Endpoint Provider to Select an Option Value</H2>
 You can specify that an endpoint provider selects an appropriate option value by setting the endpoint's value field to the constant <A NAME=MARKER-13-27></A><CODE>T_UNSPEC</CODE>. This is especially useful in complex options such as ISO throughput where the option value has an internal structure.<A NAME=MARKER-13-28></A><P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-3">Negotiating Multiple Options</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-9">Initiating an Option Negotiation</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-12">Options That Are Absolute Requirements</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-17">Options That Are Not Absolute Requirements</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-19">Conflicting Option Values</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-22">Privileged or Read-Only Options</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-32">Error Conditions</A>
<DD>
<DT><A HREF="NetworkingWOT-488.html#HEADING488-44">Allowing the Endpoint Provider to Select an Option Value</A>
<DD>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="NetworkingWOT-487.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NetworkingWOT-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NetworkingWOT-491.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A>  <A HREF="NetworkingWOT-489.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="NetworkingWOT-4.html">&copy; Apple Computer, Inc.</A><br>15 JAN 1998<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
