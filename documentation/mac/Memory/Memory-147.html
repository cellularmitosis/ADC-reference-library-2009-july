<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>MyGrowZone (IM: M)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING147></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Memory-146.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-148.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Memory-2.html"><B>Memory</B></A> / <BR><DD><A HREF="Memory-56.html"><B>Chapter 2 - Memory Manager</B></A> / <A HREF="Memory-60.html"><B>Memory Manager Reference</B></A><BR><DL><DD><A HREF="Memory-145.html"><B>Application-Defined Routines</B></A> / <A HREF="Memory-146.html"><B>Grow-Zone Functions</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING147-0></A>
<H3>MyGrowZone</H3>
 A grow-zone function should have the following form:<P>
<PRE>
FUNCTION MyGrowZone (cbNeeded: Size): LongInt;
</PRE>
<DL>
<DT><CODE>cbNeeded</CODE>
<DD> The physical size, in bytes, of the needed block, including the block header. The grow-zone function should attempt to create a free block of at least this size.
</DL>
<A NAME=HEADING147-4></A>
<H5>DESCRIPTION</H5>
 Whenever the Memory Manager has exhausted all available means of creating space within your application heap--including purging, compacting, and (if possible) expanding the heap--it calls your application-defined grow-zone function. The grow-zone function can do whatever is necessary to create free space in the heap. Typically, a grow-zone function marks some unneeded blocks as purgeable or releases an emergency memory reserve maintained by your application.<P>
 The grow-zone function should return a nonzero value equal to the number of bytes of memory it has freed, or zero if it is unable to free any. When the function returns a nonzero value, the Memory Manager once again purges and compacts the heap zone and tries to reallocate memory. If there is still insufficient memory, the Memory Manager calls the grow-zone function again (but only if the function returned a nonzero value the previous time it was called). This mechanism allows your grow-zone function to release just a little bit of memory at a time. If the amount it releases at any time is not enough, the Memory Manager calls it again and gives it the opportunity to take more drastic measures.<P>
 The Memory Manager might designate a particular relocatable block in the heap as protected; your grow-zone function should not move or purge that block. You can determine which block, if any, the Memory Manager has protected by calling the <CODE>GZSaveHnd</CODE> function in your grow-zone function.<A NAME=MARKER-2-228></A><P>
 Remember that a grow-zone function is called while the Memory Manager is attempting to allocate memory. As a result, your grow-zone function should not allocate memory itself or perform any other actions that might indirectly cause memory to be allocated (such as calling routines in unloaded code segments or displaying dialog boxes).<P>
 You install a grow-zone function by passing its address to the <CODE>InitZone</CODE> procedure when you create a new heap zone or by calling the <CODE>SetGrowZone</CODE> procedure at any other time.<A NAME=MARKER-2-208></A><A NAME=MARKER-2-516></A><P>
<A NAME=HEADING147-10></A>
<H5>SPECIAL CONSIDERATIONS</H5>
 Your grow-zone function might be called at a time when the system is attempting to allocate memory and the value in the A5 register is not correct. If your function accesses your application's A5 world or makes any trap calls, you need to set up and later restore the A5 register by calling <CODE>SetCurrentA5</CODE> and <CODE>SetA5</CODE>. See the chapter "Memory Management Utilities" in this book for a description of these two functions.<A NAME=MARKER-2-517></A><A NAME=MARKER-2-518></A><A NAME=MARKER-2-519></A><A NAME=MARKER-2-520></A><P>
 Because of the optimizations performed by some compilers, the actual work of the grow-zone function and the setting and restoring of the A5 register might have to be placed in separate procedures.<P>
<A NAME=HEADING147-13></A>
<H5>SEE ALSO</H5>
 See the chapter "Introduction to Memory Management" in this book for a definition of a sample grow-zone function.<A NAME=MARKER-2-521></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Memory-146.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Memory-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Memory-202.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Memory-148.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Memory-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
