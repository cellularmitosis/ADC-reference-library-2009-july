<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Saving and Restoring the Floating-Point Environment(IM:PN)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING155></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="PPCNumerics-154.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="PPCNumerics-156.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="PPCNumerics-2.html"><B>PowerPC Numerics </B></A> / <A HREF="PPCNumerics-144.html"><B>Part 3 - Numerics in PowerPC Assembly Language</B></A><BR><DD><A HREF="PPCNumerics-150.html"><B>Chapter 12 - Assembly-Language Environmental Controls</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING155-0></A>
<H1>Saving and Restoring the Floating-Point Environment</H1>
 <A NAME=MARKER-2-64></A><A NAME=MARKER-2-48></A>To save and restore the state of the entire floating-point environment, use the <CODE>mffs</CODE> and <CODE>mtfsf</CODE> instructions. <P>
 The <CODE>mffs</CODE> instruction saves the FPSCR to a floating-point register. It has the form<P>
<PRE>
mffs   DST 
</PRE>
 where <I>DST</I> is the floating-point register into which the FPSCR should be copied. For example, the instruction<P>
<PRE>
mffs  f0
</PRE>
 saves the current state of the FPSCR register in bits 32 through 63 of floating-point register F0. Bits 0 through 31 of register F0 are set to 1's.<P>
 To restore a floating-point environment that you have previously saved, use the <CODE>mtfsf</CODE> instruction. This instruction copies a 4-bit field from a floating-point register into an FPSCR field. It has the form<P>
<PRE>
mtfsf     DST, SRC 
</PRE>
 where <I>DST</I> is a 4-bit FPSCR field and <I>SRC</I> is the floating-point register from which the field should be copied. The instruction assumes that the last half of the floating-point register <I>SRC</I> contains an FPSCR value. Thus, if you specify<P>
<PRE>
mtfsf    3,f0
</PRE>
 bits 44 through 47 of register F0 are copied into FPSCR field 3, bits 12 through 15. <BR><A HREF=#MARKER-9-66>Figure 12-3</A> shows how the FPSCR fields map to a floating-point register.<P>
<B>Figure 12-3  <A NAME=MARKER-9-66></A><I>SRC</I> and <I>DST</I> fields for <CODE>mtfsf</CODE> instruction</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/PPCN-L-22.jpg"><P>
 <A HREF=#MARKER-9-67>Listing 12-3</A> saves the floating-point environment and then restores it.<P>
<B>Listing 12-3  <A NAME=MARKER-9-67></A>Saving and restoring the floating-point environment</B><P>
<PRE>
mffs		f10			# FPSCR copied into register f10

# other floating-point computations occur here

mtfsf		0,f10			# restore bits 0 and 3
mtfsf		1,f10			# restore bits 4 through 7
mtfsf		2,f10			# restore bits 8 through 11
mtfsf		3,f10			# restore bits 12 through 15
mtfsf		4,f10			# restore bits 16 through 19
mtfsf		5,f10			# restore bits 20 through 23
mtfsf		6,f10			# restore bits 24 through 27
mtfsf		7,f10			# restore bits 28 through 31
					# entire FPSCR now restored<A NAME=MARKER-2-68></A><A NAME=MARKER-2-69></A><A NAME=MARKER-2-70></A><A NAME=MARKER-2-71></A><A NAME=MARKER-2-72></A>
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="PPCNumerics-154.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="PPCNumerics-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="PPCNumerics-192.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="PPCNumerics-156.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="PPCNumerics-3.html">&copy; Apple Computer, Inc.</A><br>13 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
