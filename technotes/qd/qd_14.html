<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note QD14: QuickDraw's Internal Picture Definition</title><meta name="keywords" content="Mac OS 8 QuickDraw internal picture definition opcodes 1.0"><meta name="Description" content="Technical Note QD14: This Technical Note describes the internalformat of the QuickDraw picture data structure. The informationgiven here only applies to QuickDraw picture format version1.0 (which is always created by Macintoshes without ColorQuickDraw). Technical Note also provides a list of the opcodesused in the picture data structure.">                                       <meta name="categories" content="QuickDraw"><meta name="week-posted" content="Apr 1, 1985 - Apr 5, 1985"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002727" title="QuickDraw's Internal Picture Definition"></a><a name="top"></A><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxGraphicsImaging-date.html">Graphics & Imaging</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/GraphicsImaging/index.html" target="_blank">Reference Library > Graphics & Imaging</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note QD14</div>
<div id="pageheadsub">QuickDraw's Internal Picture Definition</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext"><A HREF="#Section1">Introduction</A><BR><BR><A HREF="#Section2">Terms</A><BR><BR><A HREF="#Section3">Notes</A><BR><BR><A HREF="#References">References</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><p id="introtext">This technical note describes the internal format of the QuickDraw picture datastructure. This revision corrects some errors in the opcode descriptions andprovides some examples.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Apr 01 1985]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name=Section1></A><h2>Introduction</h2><p>This technical note describes the internal definition of the QuickDraw picture.The information given here only applies to QuickDraw picture format version 1.0(which is always created by Macintoshes without Color QuickDraw). Pictureformat version 2.0 is documented in the Color QuickDraw chapter of <i>InsideMacintosh</i>. This information should not be used to write your own picturebottleneck procedures; if we add new objects to the picture definition, yourprogram will not be able to operate on pictures created using standardQuickDraw. Your program will not know the size of the new objects and will,therefore, not be able to proceed past the new objects. (What this ultimatelymeans is that you can't process a new picture with an old bottleneck proc.)</p><P><A HREF="#top">Back to top</A></p><a name="Section2"></a><H2>Terms</h2><p>An <i>opcode</i><b> </b>is a number that <code>DrawPicture</code> uses to determinewhat object to draw or what <i>mode</i><b> </b>to change for subsequent drawing. The following list gives the opcode, the name of the object (or mode),the associated data, and the total size of the opcode and data. To betterinterpret the sizes, please refer to page I-91 of the Using Assembly Languagechapter of <i>Inside Macintosh</i>. For types not described there, here is aquick list:</p><p>opcode byte</p><p>mode word</p><p>point 4 bytes</p><p>0..255    byte</p><p>-128..127 signed byte</p><p>rect    8 bytes</p><p>poly    10+ bytes (starts with word size for poly (incl. size word)</p><p>region 10+ bytes (starts with word size for region (incl. size word)</p><p>fixed point long</p><p>pattern 8 bytes</p><p>rowbytes    word (always even)</p><p>bit data    rowbytes * (bounds.bottom - bounds.top) bytes</p><p>Each picture definition begins with a <code>picsize</code> (<code>word</code>), then a<code>picframe</code> (<code>rect</code>), and then the picture definition, whichconsists of a combination of the following opcodes:</p><P align=center><img src="images/qd_14_001.gif" alt="Table 1" width=432 height=579></p><P align=center><img src="images/qd_14_002.gif" alt="Table 2" width=456 height=628></p><P align=center><img src="images/qd_14_003.gif" alt="Table 3" width=432 height=155></p><P><A HREF="#top">Back to top</A></p><a name="Section3"></a><H2>Notes</h2><p>Rounded-corner rectangles use the setting of the ovSize point (see opcode $0B, above).</p><p><code>OpenPicture</code> and <code>DrawPicture</code> set up a default set of portcharacteristics when they start. When drawing occurs, if the user's settingsdon't match the defaults, mode opcodes are generated. This is why there isusually a <code>clipRgn</code> code after the <code>picVersion</code>: the default clipregion is an empty rectangle.</p><p>The only savings that the "same" opcodes achieve under the currentimplementation is for rectangles. <code>DrawPicture</code> keeps track of the lastrectangle used and if a "same" opcode is encountered that requests a rectangle,the last rect. will be used (and no rectangle will appear in the opcode's data).</p><p>This last section contains some Pascal program fragments that generatepictures. Each section starts out with the picture itself (yes, they're dull)followed by the code to create and draw it, and concludes with a commented hexdump of the picture.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    {variables used in all examples}    VAR        err:     OSErr;        ph:      PicHandle;        h:       Handle;        r:       Rect;        smallr:  Rect;        orgr:    Rect;        pstate:  PenState; {are they in the Rose Bowl, or the state pen?}</pre>	</TD></TR></TABLE></CENTER><P align=center><img src="images/qd_14_004.gif" alt="qd_142.gif" width=128 height=165></p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>I.    {Rounded-corner rectangle}    SetRect(r, 20, 10, 120, 175);    ClipRect(myWindow^.portRect);    ph := OpenPicture(r);    FrameRoundRect (r, 5, 4); {r,width,height}    ClosePicture;    DrawPicture(ph, r);'PICT' (1)  0026 {size}  000A 0014 00AF 0078 {picFrame}    1101 {version 1}  01 000A 0000 0000 00FA 0190 {clipRgn -- 10 byte region}    0B 0004 0005 {ovSize point}  40 000A 0014 00AF 0078 {frameRRect    rectangle}    FF {fin}</pre>	</TD></TR></TABLE></CENTER><P align=center><img src="images/qd_14_005.gif" alt="qd_143.gif" width=128 height=165></p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>II.    {Overpainted arc}    GetPenState(pstate); {save}    SetRect(r, 20, 10, 120, 175);    ClipRect(myWindow^.portRect);    ph := OpenPicture(r);    PaintArc(r, 3, 45); {r,startangle,endangle}    PenPat(gray);    PenMode(patXor); {turn the black to gray}    PaintArc(r, 3, 45); {r,startangle,endangle}    ClosePicture;    SetPenState(pstate); {restore}    DrawPicture(ph, r);data 'PICT' (2)  0036 {size}  000A 0014 00AF 0078 {picFrame}    1101 {version 1}  01 000A 0000 0000 00FA 0190 {clipRgn -- 10 byte region}    61 000A 0014 00AF 0078 0003 002D {paintArc rectangle,startangle,endangle}    08 000A {pnMode patXor -- note that the pnMode comes before the pnPat}    09 AA55 AA55 AA55 AA55 {pnPat gray}    69 0003 002D {paintSameArc startangle,endangle}    FF {fin}</pre>	</TD></TR></TABLE></CENTER>    <P align=center><img src="images/qd_14_006.gif" alt="qd_144.gif" width=128 height=177></p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>III.    {CopyBits nopack, norgn, nowoman, nocry}    GetPenState(pstate);    SetRect(r, 20, 10, 120, 175);    SetRect(smallr, 20, 10, 25, 15);    SetRect(orgr, 0, 0, 30, 20);    ClipRect(myWindow^.portRect);    ph := OpenPicture(r);    PaintRect(r);    CopyBits (myWindow^.portBits, myWindow^.portBits,                 smallr, orgr, notSrcXor, NIL);    {note: result BitMap is 8 bits wide instead of the 5 specified by     smallr}    ClosePicture;    SetPenState(pstate); {restore the port's original pen state}    DrawPicture(ph, r);data 'PICT' (3)  0048 {size}  000A 0014 00AF 0078 {picFrame}    1101 {version 1}  01 000A 0000 0000 00FA 0190 {clipRgn -- 10 byte region}    31 000A 0014 00AF 0078 {paintRect rectangle}    90 0002 000A 0014 000F 001C {BitsRect rowbytes bounds (note that bounds    is wider than smallr)}    000A 0014 000F 0019 {srcRect}    0000 0000 0014 001E {dstRect}    00 06 {mode=notSrcXor}    0000 0000 0000 0000 0000 {5 rows of empty bitmap (we copied from a                                still-blank window)}    FF {fin}</pre>	</TD></TR></TABLE></CENTER>         <P><A HREF="#top">Back to top</A></p><a name="References"></a><h2>References</h2><P>QuickDraw</p><P>Color QuickDraw</p><P>Using Assembly Language</p><P>Technical Note #59--<A HREF = "qd_11.html">Pictures and Clip Regions</a></p>         <a name="Downloads"></a>         <P><A HREF="#top">Back to top</A></p><H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (408K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/qd_14.pdf">Download</A></P>               </TD>            </TR>                    </TABLE>         <BR></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/qd/qd_14.html%3Fid%3DDTS10002727-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/qd/qd_14.html%3Fid%3DDTS10002727-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/qd/qd_14.html%3Fid%3DDTS10002727-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>