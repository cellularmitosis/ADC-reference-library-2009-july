<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Translating Files (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING419></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-418.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-420.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-402.html"><B>Chapter 7 - Translation Manager</B></A> / <A HREF="MoreToolbox-414.html"><B>Writing a Translation Extension</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING419-0></A>
<H2>Translating Files</H2>
 <A NAME=MARKER-2-139></A>If your translation extension identifies a document as one that it can translate and the user chooses to use your translation extension, your extension is called with the <CODE>kTranslateTranslateFile</CODE> request code to translate the document. The <CODE>TranslateEntry</CODE> extension (shown in <A HREF=MoreToolbox-416.html#MARKER-9-149>Listing 7-5 on page 7-25</A>) dispatches to its <CODE>DoTranslateFile</CODE> function when it receives this request code. <A HREF=#MARKER-9-174>Listing 7-8</A> shows the skeleton of a <CODE>DoTranslateFile</CODE> function.<P>
<B>Listing 7-8  <A NAME=MARKER-9-174></A>Translating a document<A NAME=MARKER-2-175></A></B><P>
<PRE>
FUNCTION DoTranslateFile (self: ComponentInstance; 
                           refNum: TranslationRefNum; 
                           srcDoc: FSSpec; 
                           srcType: FileType; 
                           srcTypeHint: LongInt; 
                           dstDoc: FSSpec; 
                           dstType: FileType; 
                           dstTypeHint: LongInt): ComponentResult;
VAR
      myAdvert:      Handle;
      myResFile:     Integer;
      myResult:      OSErr;
CONST
   rProgressAdvertismentResID       = 150;
BEGIN
   myResFile := OpenComponentResFile(Component(self));
   IF myResFile &lt;&gt; -1 THEN
   BEGIN
      {get advertisement}
      myAdvert := Get1Resource('PICT', rProgressAdvertismentResID);
      DetachResource(myAdvert);
      {display progress dialog box and show advertisement}
      myResult := SetTranslationAdvertisement(refNum, PicHandle(myAdvert));
      myResult := CloseComponentResFile(myResFile);
   END;
   {now call your routine to translate the file}
   DoTranslateFile := MyDoTranslation
                                 (refNum, srcDoc, srcType, dstDoc, dstType);
   DisposeHandle(myAdvert);
END;
</PRE>
 By the time the <CODE>DoTranslateFile</CODE> routine is called, the file specified by the <CODE>dstDoc</CODE> parameter already exists. The destination file has a data fork; it also has a resource fork if the <CODE>flags</CODE> field in the appropriate destination file type specification (in your extension's file translation list) has the <CODE>taDstDocNeedsResourceFork</CODE> bit set. Your extension should open the destination file and fill it with the translated data.<A NAME=MARKER-2-176></A><P>
 In <A HREF=#MARKER-9-174>Listing 7-8</A>, the <CODE>DoTranslateFile</CODE> function calls the <CODE>SetTranslationAdvertisement</CODE> function<A NAME=MARKER-2-177></A> to install an advertisement in the progress dialog box. The routine that does the actual data translation (<CODE>MyDoTranslation</CODE>) should periodically call <CODE>UpdateTranslationProgress<A NAME=MARKER-2-178></A></CODE> to update the progress bar in the dialog box.<A NAME=MARKER-2-179></A><A NAME=MARKER-2-355></A><A NAME=MARKER-2-181></A><P>
 If an error occurs during the translation, you should make sure to close any files you might have opened (for instance, the destination file's data fork and resource fork), do any other necessary cleaning up, and then return a nonzero result code through your component selector dispatcher. When Macintosh Easy Open receives a nonzero result code, it automatically deletes the destination file.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-418.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-420.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
