<HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><script language="JavaScript" src="frametest.js"></script><TITLE> Replacing Graphics Drivers</TITLE></HEAD><BODY BGCOLOR="#ffffff"><DIV><a name="top"></a><!-- start of banner --><!--#include virtual="/includes/framesetheader" --><!-- end of banner --><!-- start of path --><font face="Geneva,Helvetica,Arial" size="1"><b><br>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Documentation</a> &gt; <!-- a href="" target="_top" -->Hardware<!-- /a -->  <b>&gt; </b><a href="../../devicemgrs.html" target="_top">Device Managers and Drivers</a> <b>&gt; </b><a href="../pci_srvcs.html" target="_top">PCI Card Services</a> <b>&gt; </b>Designing PCI Cards and Drivers for Power Macintosh Computers</font><br><br><!-- end of path --><A HREF="PCI_BOOK.1d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.217.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.219.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><HR></DIV><H1 CLASS="H1.Heading1"><A NAME="pgfId=4035"> </A><A NAME="34572"> </A>Replacing Graphics Drivers</H1><P CLASS="T1.Text1"><A NAME="pgfId=4036"> </A>Mac&nbsp;OS is able to replace the ROM-based PCI graphics driver. You can use this feature to fix a bug or add additional functionality that was not found in the ROM-based driver. This section details several guidelines for replacing the driver. Prerequisite information is contained in <A HREF="PCI_BOOK.8d.html#25819" CLASS="XRef">Driver Replacement</A>.</P><DIV><blockquote><H4 CLASS="NoteHead"><A NAME="pgfId=16971"> </A>Note</H4><P CLASS="Note"><A NAME="pgfId=4040"> </A>Replacing a graphics driver may disrupt the user's experience if the screen flashes or is redrawn. The following discussion suggests ways to prevent or control this. </P></blockquote><P CLASS="T1.Text1"><A NAME="pgfId=4044"> </A>Starting with version 1.1 of the System Enabler, Mac&nbsp;OS issues a <TT CLASS="cv">kSupersededCommand</TT> to the outgoing driver and a <TT CLASS="cv">kReplaceCommand</TT> to the new driver. Note that a driver that gets the <TT CLASS="cv">kSupersededCommand</TT> will not get a <TT CLASS="cv">kFinalizeCommand</TT>. Similarly, the driver getting the <TT CLASS="cv">kReplaceCommand</TT> will not get the <TT CLASS="cv">kInitializeCommand</TT>.</P><P CLASS="T1.Text1"><A NAME="pgfId=4045"> </A>To implement these new calls, the ROM-based driver must support the <TT CLASS="cv">kSuperseded</TT> command. In the call's implementation, the driver must place in the Name Registry any information that will be needed by the new driver. It should not reset the video hardware (for example, by turning the video sync signals off).</P><P CLASS="T1.Text1"><A NAME="pgfId=4046"> </A>A <TT CLASS="cv">kCloseCommand</TT> will always be issued before <TT CLASS="cv">kFinalizeCommand</TT> or <TT CLASS="cv">kSupersedeCommand</TT>. When this command is received, the driver should turn off all interrupts and remove all VSL services. When responding to <TT CLASS="cv">kFinalizeCommand</TT> and <TT CLASS="cv">kSupersededCommand</TT>, it should remove the interrupt services.</P><P CLASS="T1.Text1"><A NAME="pgfId=4047"> </A>The new driver needs to support the <TT CLASS="cv">kReplaceCommand</TT>. After reading the state information from the Name Registry (which the old driver put there), it must make sure that all the current information is correctly initialized in the hardware. When responding to the <TT CLASS="cv">kReplaceCommand</TT> it should not reprogram the hardware, because this might make the display flash.</P><P CLASS="T1.Text1"><A NAME="pgfId=4048"> </A>The <TT CLASS="cv">kReplaceCommand</TT> routine can ask Mac&nbsp;OS to redraw the screen by creating a property named <TT CLASS="cv">needFullInit</TT> in the device node of the Name Registry. On finding that property, the Mac&nbsp;OS will redraw the screen and then delete the property. Redrawing the screen might be required if the new driver needed to change a parameter in the hardware (such as <TT CLASS="cv">rowBytes</TT>) that is reflected in the OS data structures.</P></DIV><HR>&#169 1999 Apple Computer, Inc. &#150 (Last Updated 26 March 99)<P><A HREF="PCI_BOOK.1d4.html"><img src="images/up.gif" border="0" width="36" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.217.html"><img src="images/previous.gif" border="0" width="66" height="16"></A><nobr>&nbsp;</nobr><A HREF="PCI_BOOK.219.html"><img src="images/next.gif" border="0" width="49" height="16"></A><!-- insert Show/Hide frames --><a href="javascript:testFrame()"><script><!--document.write(frameLink);//--></script><!-- end Show/Hide frames --></A><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>