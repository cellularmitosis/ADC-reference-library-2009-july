<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Text Services Manager(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING482></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-481.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-483.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-409.html"><B>Chapter 7 - Text Services Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING482-0></A>
<H1>Summary of the Text Services Manager</H1>
<A NAME=HEADING482-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING482-2></A>
<H3>Constants</H3>
<PRE>
CONST

   kTSMVersion = 1;              {Version of Text Services Manager}
   kTextService = 'tsvc';        {Component type for component description}
   kInputMethodService = 'inpm'; {Component subtype for component desc.}
   
   bTakeActiveEvent = 15;        {Bit set if component takes activate events}
   bScriptMask = $00007F00;                                    {Bits 8 - 14}
   bLanguageMask = $000000FF;                                  {Bits 0 - 7}
   bScriptLanguageMask = ScriptMask + bLanguageMask;           {Bits 0 - 14}
{Hilite styles}
   kCaretPosition = 1;           {specify caret position}
   kRawText = 2;                 {specify range of raw text}
   kSelectedRawText = 3;         {specify range of selected raw text}
   kConvertedText = 4;           {specify range of converted text}
   kSelectedConvertedText = 5;   {specify range of selected converted text}
{Apple Event constants}

   kTextServiceClass = kTextService;   {Event class}
   kUpdateActiveInputArea = 'updt';    {Update active inline area}
   kPos2Offset = 'p2st';               {Convert global coordinates to }
                                       { character position}
   kOffset2Pos = 'st2p';               {Convert character position to }
                                       { global coordinate}
   kShowHideInputWindow = 'shiw';      {show or hide the input window}
   {Event keywords}
   keyAETSMDocumentRefcon = 'refc'; {TSM document refcon}

   keyAEServerInstance = 'srvi'; {Server instance}
   keyAETheData = 'kdat';        {typeText}
   keyAEScriptTag = 'sclg';      {Script tag}
   keyAEFixLength = 'fixl';
   keyAEHiliteRange = 'hrng';    {Hilite range array}
   keyAEUpdateRange = 'udng';    {Update range array}
   keyAEClauseOffsets = 'clau';  {Clause offsets array}
   keyAECurrentPoint = 'cpos';   {Current point}
   keyAEDragging = 'bool';       {Dragging flag}
   keyAEOffset = 'ofst';         {Offset}
   keyAERegionClass = 'rgnc';    {Region class}
   keyAEPoint = 'gpos';          {Current point}
   keyAEBufferSize = 'buff';     {Buffer size to get the text}
   keyAERequestedType = 'rtyp';  {Requested text type}
   keyAEMoveView = 'mvvw';       {Move view flag}
   keyAELength = 'leng';         {Length}
   keyAENextBody = 'nxbd';       {Next or previous body}
{optional keywords for Offset2Pos}
   keyAETextFont = 'ktxf';
   keyAETextPointSize = 'ktps';
   keyAETextLineHeight = 'ktlh';
   keyAETextLineAscent = 'ktas';
   keyAEAngle = 'kang';
{optional keyword for Pos2Offset}
   keyAELeftSide = 'klef';       {type Boolean}
{optional keyword for kShowHideInputWindow}
   keyAEShowHideInputWindow = 'shiw';  {type Boolean}
{keyword for PinRange}
   keyAEPinRange = 'pnrg';
{Desc type ...}
   typeComponentInstance = 'cmpi';  {component instance}
   typeTextRange = 'txrn';          {text range}
   typeTextRangeArray = 'tray';     {text range array}
   typeOffsetArray = 'ofay';        {offset array}
   typeIntlWritingCode = 'intl';    {script code}
   typeQDPoint = 'QDpt';            {QuickDraw point}
   typeAEText = 'tTXT';             {Apple event text}
   typeText = 'TEXT';               {plain text}
{Apple event descriptor type constants}
   kTSMOutsideOfBody = 1;
   kTSMInsideOfBody = 2;
   kTSMInsideOfActiveInputArea = 3;
   
   kNextBody = 1;
   kPreviousBody = 2;
   
{Apple event error constants}
   errOffsetInvalid = -1800;
   errOffsetIsOutsideOfView = -1801;
   errTopOfDocument = -1810;
   errTopOfBody = -1811;
   errEndOfDocument = -1812;
   errEndOfBody = -1813;
</PRE>
<A NAME=HEADING482-13></A>
<H3>Data Types</H3>
<PRE>
TYPE TextRange = 
   RECORD
      fStart:        LongInt;
      fEnd:          LongInt;
      fHiliteStyle:  Integer;
   END;
   TextRangePtr = ^TextRange;
   TextRangeHandle = ^TextRangePtr;
   TextRangeArray = 
   RECORD
      fNumOfRanges:  Integer;
      fRange:        ARRAY [0..0] of TextRange;
   END;
   TextRangeArrayPtr = ^TextRangeArray;
   TextRangeArrayHandle = ^TextRangeArrayPtr;
   OffsetArray = 
   RECORD
      fNumOfOffsets: Integer;
      fOffset:       ARRAY [0..0] of LongInt;
   END;
   OffsetArrayPtr = ^OffsetArray;
   OffsetArrayHandle = ^OffsetArrayPtr;
   TextServiceInfo = 
   RECORD
      fComponent: Component;
      fItemName:  Str255;
   END;
   TextServicesInfoPtr = ^TextServiceInfo;
   TextServiceList = 
   RECORD
      fTextServiceCount:   Integer;
      fServices:           ARRAY [0..0] of TextServiceInfo;
   END;
   TextServiceListPtr = ^TextServiceList;
   TextServiceListHandle = ^TextServiceListPtr;
   ScriptLanguageRecord = 
   RECORD
      fScript:    ScriptCode;
      fLanguage:  LangCode;
   END;
   ScriptLanguageSupport = 
   RECORD
      fScriptLanguageCount:   Integer;
      fScriptLanguageArray:   ARRAY [0..0] of ScriptLanguageRecord;
   END;
   ScriptLanguageSupportPtr = ^ScriptLanguageSupport;
   ScriptLanguageSupportHandle = ^ScriptLanguageSupportPtr;
   InterfaceTypeList = ARRAY [0..0] of OSType;
   TSMDocumentID = Ptr;
</PRE>
<A NAME=HEADING482-23></A>
<H3>Text Services Manager Routines for Client Applications</H3>
<A NAME=HEADING482-24></A>
<H4>Initializing and Closing as a TSM-Aware Application</H4>
<PRE>
FUNCTION InitTSMAwareApplication     : OSErr;
FUNCTION CloseTSMAwareApplication    : OSErr;
</PRE>
<A NAME=HEADING482-27></A>
<H4>Creating and Activating TSM Documents</H4>
<PRE>
FUNCTION NewTSMDocument          (numOfInterface: Integer; 
                                  VAR supportedInterfaceTypes: InterfaceTypeList; 
                                  VAR idocID: TSMDocumentID; 
                                  refCon: LongInt): OSErr;
FUNCTION ActivateTSMDocument
                                 (idocID: TSMDocumentID): OSErr;
FUNCTION DeactivateTSMDocument
                                 (idocID: TSMDocumentID): OSErr;
FUNCTION DeleteTSMDocument       (idocID: TSMDocumentID): OSErr;
</PRE>
<A NAME=HEADING482-34></A>
<H4>Passing Events to Text Service Components</H4>
<PRE>
FUNCTION TSMEvent                (VAR event: EventRecord): Boolean;
</PRE>
<A NAME=HEADING482-36></A>
<H4>Passing Menu Selections and Cursor Setting</H4>
<PRE>
FUNCTION TSMMenuSelect           (menuResult: LongInt): Boolean;
FUNCTION SetTSMCursor            (mousePos: Point): Boolean;
</PRE>
<A NAME=HEADING482-39></A>
<H4>Confirming Active Input in a TSM Document</H4>
<PRE>
FUNCTION FixTSMDocument          (idocID: TSMDocumentID): OSErr;
</PRE>
<A NAME=HEADING482-41></A>
<H4>Making Text Services Available to the User</H4>
<PRE>
FUNCTION GetServiceList          (numOfInterfaceTypes: Integer; 
                                  supportedInterfaceTypes: InterfaceTypeList; 
                                  VAR serviceInfo: TextServiceListHandle; 
                                  VAR seedValue: LongInt): OSErr;
FUNCTION OpenTextService         (idocID: TSMDocumentID; aComponent: Component; 
                                  VAR aComponentInstance: ComponentInstance): 
                                  OSErr;
FUNCTION CloseTextService        (idocID: TSMDocumentID; aComponentInstance: 
                                  ComponentInstance): OSErr;
</PRE>
<A NAME=HEADING482-45></A>
<H4>Requesting a Floating Input Window</H4>
<PRE>
FUNCTION UseInputWindow          (idocID: TSMDocumentID; useWindow: Boolean): 
OSErr;
</PRE>
<A NAME=HEADING482-47></A>
<H4>Associating Scripts and Languages With Components</H4>
<PRE>
FUNCTION SetDefaultInputMethod
                                 (ts: Component; 
                                  VAR slRecord: ScriptLanguageRecord): OSErr;
FUNCTION GetDefaultInputMethod
                                 (VAR ts: Component; 
                                  VAR slRecord: ScriptLanguageRecord): OSErr;
FUNCTION SetTextServiceLanguage
                                 (VAR slRecord: ScriptLanguageRecord): OSErr;
FUNCTION GetTextServiceLanguage
                                 (VAR slRecord: ScriptLanguageRecord): OSErr;
</PRE>
<A NAME=HEADING482-56></A>
<H3>Text Services Manager Routines for Components</H3>
<A NAME=HEADING482-57></A>
<H4>Sending Apple Events to a Client Application</H4>
<PRE>
FUNCTION SendAEFromTSMComponent
                                 (VAR theAppleEvent: AppleEvent; 
                                  VAR reply: AppleEvent; sendMode: AESendMode; sendPriority: AESendPriority; 
                                  timeOutInTicks: LongInt; 
                                  idleProc: IdleProcPtr; 
                                  filterProc: EventFilterProcPtr): OSErr;
</PRE>
<A NAME=HEADING482-60></A>
<H4>Opening Floating Utility Windows</H4>
<PRE>
FUNCTION NewServiceWindow        (wStorage: Ptr; boundsRect: Rect; 
                                  title: Str255; visible: Boolean; 
                                  theProc: Integer; behind: WindowPtr; 
                                  goAwayFlag: Boolean; ts: ComponentInstance; 
                                  VAR window: WindowPtr): OSErr;
FUNCTION CloseServiceWindow      (window: WindowPtr): OSErr;
FUNCTION GetFrontServiceWindow
                                 (VAR window: WindowPtr): OSErr;
FUNCTION FindServiceWindow       (thePoint: Point; VAR theWindow: WindowPtr): 
                                  Integer;
</PRE>
<A NAME=HEADING482-66></A>
<H3>Text Service Component Routines</H3>
<A NAME=HEADING482-67></A>
<H4>Providing a Text Service</H4>
<PRE>
FUNCTION InitiateTextService
                                 (ts: ComponentInstance): ComponentResult;
FUNCTION ActivateTextService
                                 (ts: ComponentInstance): ComponentResult;
FUNCTION DeactivateTextService
                                 (ts: ComponentInstance): ComponentResult;
FUNCTION HidePaletteWindows      (ts: ComponentInstance): ComponentResult;
FUNCTION TerminateTextService
                                 (ts: ComponentInstance): ComponentResult;
</PRE>
<A NAME=HEADING482-77></A>
<H4>Responding to Events and Updating the Cursor and Menu</H4>
<PRE>
FUNCTION TextServiceEvent        (ts: ComponentInstance; numOfEvents: Integer; 
                                  VAR event: EventRecord): ComponentResult;
FUNCTION TextServiceMenuSelect
                                 (ts: ComponentInstance; serviceMenu: MenuHandle; item: Integer): ComponentResult;
FUNCTION SetTextServiceCursor 
                                 (ts: ComponentInstance; mousePos: Point): ComponentResult;
FUNCTION GetTextServiceMenu      (ts: ComponentInstance; 
                                  VAR serviceMenu: MenuHandle): ComponentResult;
</PRE>
<A NAME=HEADING482-84></A>
<H4>Confirming Active Input in a TSM Document</H4>
<PRE>
FUNCTION FixTextService          (ts: ComponentInstance): ComponentResult;
</PRE>
<A NAME=HEADING482-86></A>
<H4>Identifying the Supported Scripts and Languages</H4>
<PRE>
FUNCTION GetScriptLanguageSupport
                                 (ts: ComponentInstance; VAR scriptHandle: ScriptLanguageSupportHandle): ComponentResult;
</PRE>
<A NAME=HEADING482-89></A>
<H2>C Summary</H2>
<A NAME=HEADING482-90></A>
<H3>Constants</H3>
<PRE>
#define  kTSMVersion          1              /* Version of the 
                                                Text Services Manager */
#define  kTextService         'tsvc'         /* component type for 
                                                the component description */
#define  kInputMethodService  'inpm'         /* component subtype for 
                                                the component description */
#define  bTakeActiveEvent     15             /* bit set if the component
                                                 takes active event */
#define  bScriptMask          0x00007F00     /* bit 8 - 14 */
#define  bLanguageMask        0x000000FF     /* bit 0 - 7  */
#define  bScriptLanguageMask  bScriptMask+bLanguageMask     /* bit 0 - 14  */
/* Hilite styles ... */
typedef enum {
   kCaretPosition          =  1,    /* specify caret position */
   kRawText                =  2,    /* specify range of raw text */
   kSelectedRawText        =  3,    /* specify range of selected raw text */
   kConvertedText          =  4,    /* specify range of converted text */
   kSelectedConvertedText  =  5     /* specify range of selected 
                                       converted text */
} HiliteStyleType;
/* Apple Event constants ... */

/* Event class ... */
#define     kTextServiceClass       kTextService

/* event ID ... */
#define     kUpdateActiveInputArea  'updt'   /* update active Inline area */
#define     kPos2Offset             'p2st'   /* converting global coordinates 
                                                to char position */
#define     kOffset2Pos             'st2p'   /* converting char position 
                                                to global coordinates */
#define     kShowHideInputWindow    'shiw'   /* show or hide bottomline 
                                                input window */
/* Event keywords ... */
#define  keyTSMDocumentRefcon    'refc'      /* TSM document refcon */
#define  keyAEServerInstance     'srvi'      /* component instance */
#define  keyAETheData            'kdat'      /* typeText */
#define  keyAEScriptTag          'sclg'      /* script tag */
#define  keyAEFixLength          'fixl'      /* fix len ?? */
#define  keyAEHiliteRange        'hrng'      /* hilite range array */
#define  keyAEUpdateRange        'udng'      /* update range array */
#define  keyAEClauseOffsets      'clau'      /* Clause Offsets array */
#define  keyAECurrentPoint       'cpos'      /* current point */
#define  keyAEDragging           'bool'      /* dragging flag */
#define  keyAEOffset             'ofst'      /* offset */
#define  keyAERegionClass        'rgnc'      /* region class */
#define  keyAEPoint              'gpos'      /* current point */
#define  keyAEBufferSize         'buff'      /* buffer size to get text */
#define  keyAERequestedType      'rtyp'      /* requested text type */
#define  keyAEMoveView           'mvvw'      /* move view flag */
#define  keyAELength             'leng'      /* length */
#define  keyAENextBody           'nxbd'      /* next or previous body */
/* optional keyword for UpdateActiveInputArea */
#define  keyAEPinRange           'pnrg'
/* optional keywords for Offset2Pos */
#define  keyAETextFont           'ktxf'
#define  keyAETextPointSize      'ktps'
#define  keyAETextLineHeight     'ktlh'
#define  keyAETextLineAscent     'ktas'
#define  keyAEAngle              'kang'
/* optional keywords for Pos2Offset */
#define  keyAELeadingEdge        'klef'
/* Apple event descriptor type ... */
#define  typeComponentInstance   'cmpi'      /* server instance */
#define  typeTextRange           'txrn'      /* text range record */
#define  typeTextRangeArray      'tray'      /* text range array */
#define  typeOffsetArray         'ofay'      /* offset array */
#define  typeIntlWritingCode     'intl'      /* script code */
#define  typeQDPoint             'QDpt'      /* QuickDraw Point */
#define  typeAEText              'tTXT'      /* Apple Event text */
#define  typeText                'TEXT'      /* Plain text */
#define  typeFixed               'fixd'      /* Fixed number 16.16 */
/* Apple event descriptor type constants */
typedef enum {
   kTSMOutsideOfBody             = 1,
   kTSMInsideOfBody              = 2,
   kTSMInsideOfActiveInputArea   = 3
} AERegionClassType;
typedef enum {
   kNextBody                     = 1,
   kPreviousBody                 = 2
} AENextBodyType;
/* Apple Event error definitions */
typedef enum {
   errOffsetInvalid           = -1800,
   errOffsetIsOutsideOfView   = -1801,
   errTopOfDocument           = -1810,
   errTopOfBody               = -1811,
   errEndOfDocument           = -1812,
   errEndOfBody               = -1813
} AppleEventErrorType;
</PRE>
<A NAME=HEADING482-103></A>
<H3>Data Types</H3>
<PRE>
struct TextRange {                  /* typeTextRange  'txrn' */
   long  fStart;
   long  fEnd;
   short fHiliteStyle;
};
typedef struct TextRange      TextRange;
typedef        TextRange      *TextRangePtr;
typedef        TextRangePtr   *TextRangeHandle;
struct TextRangeArray {          /* typeTextRangeArray   'txra' */
   short       fNumOfRanges;     /* specify the size of the fRange array */
   TextRange   fRange[1];        /* when fNumOfRanges &gt; 1, the size of this 
                                    array has to be calculated */
};
typedef struct TextRangeArray    TextRangeArray;
typedef        TextRangeArray    *TextRangeArrayPtr;
typedef        TextRangeArrayPtr *TextRangeArrayHandle;
struct OffsetArray {             /* typeOffsetArray'offa' */
   short fNumOfOffsets;          /* specify the size of the fOffset array */
   long  fOffset[1];             /* when fNumOfOffsets &gt; 1, the size of 
                                    this array has to be calculated */
};
typedef struct OffsetArray    OffsetArray;
typedef        OffsetArray    *OffsetArrayPtr;
typedef        OffsetArrayPtr *OffsetArrayHandle;
/* extract Script/Language code from Component flag ... */
#define  mGetScriptCode(cdRec)   ((ScriptCode)  (cdRec.componentFlags &amp; 
                                                      bScriptMask) &gt;&gt; 8)
#define  mGetLanguageCode(cdRec) ((LangCode)    cdRec.componentFlags &amp; 
                                                         bLanguageMask)
typedef  void  *TSMDocumentID;
/* text service component information list */
struct TextServiceInfo {
   Component   fComponent;
   Str255      fItemName;
};
typedef struct TextServiceInfo   TextServiceInfo;
typedef        TextServiceInfo   *TextServiceInfoPtr;
/*text service component list*/
struct TextServiceList {
   short             fTextServiceCount;   /* number of entries in the 
                                             'fServices' array */
   TextServiceInfo   fServices[1];        /* Note: array of 'TextServiceInfo' 
                                             records follows */
};
typedef struct TextServiceList      TextServiceList;
typedef        TextServiceList      *TextServiceListPtr; 
typedef        TextServiceListPtr   *TextServiceListHandle; 
/*script and language record*/
struct ScriptLanguageRecord {
   ScriptCode  fScript;
   LangCode    fLanguage;
};
typedef struct ScriptLanguageRecord ScriptLanguageRecord;
/*script and language support record*/
struct ScriptLanguageSupport {
 short                  fScriptLanguageCount; /* number of entries in the 
                                                'fScriptLanguageArray' 
                                                array */
 ScriptLanguageRecord   fScriptLanguageArray[1]; /* Note: array of 
                                                   'ScriptLanguageRecord' 
                                                   records follows */
};
typedef struct ScriptLanguageSupport      ScriptLanguageSupport;
typedef        ScriptLanguageSupport      *ScriptLanguageSupportPtr; 
typedef        ScriptLanguageSupportPtr   *ScriptLanguageSupportHandle; 
</PRE>
<A NAME=HEADING482-113></A>
<H3>Text Services Manager Routines for Client Applications</H3>
<A NAME=HEADING482-114></A>
<H4>Initializing and Closing as a TSM-Aware Application</H4>
<PRE>
pascal OSErr InitTSMAwareApplication  ();
pascal OSErr CloseTSMAwareApplication (); 
</PRE>
<A NAME=HEADING482-117></A>
<H4>Creating and Activating TSM Documents</H4>
<PRE>
pascal OSErr NewTSMDocument           (short numOfInterface, 
                                       OSType supportedInterfaceTypes[], 
                                       TSMDocumentID *idocID, long refCon);
pascal OSErr ActivateTSMDocument
                                      (TSMDocumentID idocID);
pascal OSErr DeactivateTSMDocument
                                      (TSMDocumentID idocID);
pascal OSErr DeleteTSMDocument
                                      (TSMDocumentID idocID);
</PRE>
<A NAME=HEADING482-125></A>
<H4>Passing Events to Text Service Components</H4>
<PRE>
pascal Boolean TSMEvent               (EventRecord *event); 
</PRE>
<A NAME=HEADING482-127></A>
<H4>Passing Menu Selections and Cursor Setting</H4>
<PRE>
pascal Boolean TSMMenuSelect          (long menuResult); 
pascal Boolean SetTSMCursor           (Point mousePos);
</PRE>
<A NAME=HEADING482-130></A>
<H4>Confirming Active Input in a TSM Document</H4>
<PRE>
pascal OSErr FixTSMDocument           (TSMDocumentID idocID);
</PRE>
<A NAME=HEADING482-132></A>
<H4>Making Text Services Available to the User</H4>
<PRE>
pascal OSErr GetServiceList           (short numOfInterfaceTypes, 
                                       OSType supportedInterfaceTypes[], 
                                       TextServiceListHandle *serviceInfo, 
                                       long *seedValue);
pascal OSErr OpenTextService
                                      (TSMDocumentID idocID, Component aComponent,
                                       ComponentInstance *aComponentInstance);
pascal OSErr CloseTextService
                                      (TSMDocumentID idocID, 
                                       ComponentInstance aComponentInstance)
</PRE>
<A NAME=HEADING482-138></A>
<H4>Requesting a Floating Input Window</H4>
<PRE>
pascal OSErr UseInputWindow           (TSMDocumentID idocID, Boolean useWindow);
</PRE>
<A NAME=HEADING482-140></A>
<H4>Associating Scripts and Languages With Components</H4>
<PRE>
pascal OSErr SetDefaultInputMethod
                                      (Component  ts, 
                                       ScriptLanguageRecord *slRecordPtr);
pascal OSErr GetDefaultInputMethod
                                      (Component *ts, 
                                       ScriptLanguageRecord *slRecordPtr);
pascal OSErr SetTextServiceLanguage 
                                      (ScriptLanguageRecord *slRecordPtr);
pascal OSErr GetTextServiceLanguage
                                      (ScriptLanguageRecord *slRecordPtr);
</PRE>
<A NAME=HEADING482-149></A>
<H3>Text Services Manager Routines for Components</H3>
<A NAME=HEADING482-150></A>
<H4>Sending Apple Events to a Client Application</H4>
<PRE>
pascal OSErr SendAEFromTSMComponent
                                      (AppleEvent *theAppleEvent, 
                                       AppleEvent *reply, AESendMode sendMode,
                                       AESendPriority sendPriority,
                                       long timeOutInTicks, IdleProcPtr idleProc,
                                       EventFilterProcPtr filterProc);
</PRE>
<A NAME=HEADING482-153></A>
<H4>Opening Floating Utility Windows</H4>
<PRE>
pascal OSErr NewServiceWindow
                                      (void *wStorage, const Rect *boundsRect,
                                       ConstStr255Param title, Boolean visible,
                                       short theProc, WindowPtr behind,
                                       Boolean goAwayFlag, ComponentInstance ts,
                                       WindowPtr *window);
pascal OSErr CloseServiceWindow
                                      (WindowPtr window);
pascal OSErr GetFrontServiceWindow
                                      (WindowPtr *window);
pascal short FindServiceWindow
                                      (Point thePoint, WindowPtr *theWindow);
</PRE>
<A NAME=HEADING482-162></A>
<H3>Text Service Component Routines</H3>
<A NAME=HEADING482-163></A>
<H4>Providing a Text Service</H4>
<PRE>
pascal ComponentResult InitiateTextService
                                      (ComponentInstance ts);
pascal ComponentResult ActivateTextService
                                      (ComponentInstance ts);
pascal ComponentResult DeactivateTextService 
                                      (ComponentInstance ts);
pascal ComponentResult HidePaletteWindows 
                                      (ComponentInstance ts);
pascal ComponentResult TerminateTextService 
                                      (ComponentInstance ts);
</PRE>
<A NAME=HEADING482-174></A>
<H4>Responding to Events and Updating the Cursor and Menu</H4>
<PRE>
pascal ComponentResult TextServiceEvent
                                      (ComponentInstance ts, 
                                       short numOfEvents, EventRecord *event)
pascal ComponentResult TextServiceMenuSelect
                                      (ComponentInstance ts, 
                                       MenuHandle serviceMenu, short item);
pascal ComponentResult SetTextServiceCursor
                                      (ComponentInstance ts, Point mousePos);
pascal ComponentResult GetTextServiceMenu
                                      (ComponentInstance ts, MenuHandle *serviceMenu);
</PRE>
<A NAME=HEADING482-183></A>
<H4>Confirming Active Input in a TSM Document</H4>
<PRE>
pascal ComponentResult FixTextService
                                      (ComponentInstance ts);
</PRE>
<A NAME=HEADING482-186></A>
<H4>Identifying the Supported Scripts and Languages</H4>
<PRE>
pascal ComponentResult GetScriptLanguageSupport
                                      (ComponentInstance ts,
                                       ScriptLanguageSupportHandle *scriptHdl);
</PRE>
<A NAME=HEADING482-189></A>
<H2>Assembly-Language Summary</H2>
<A NAME=HEADING482-190></A>
<H3>Trap Macros</H3>
<A NAME=HEADING482-191></A>
<H4>Trap Macro Names for Text Services Manager Routines
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Pascal name<TH>Trap macro name<TR>
<TD>NewTSMDocument<TD>_NewTSMDocument<TR>
<TD>DeleteTSMDocument<TD>_DeleteTSMDocument<TR>
<TD>ActivateTSMDocument<TD>_ActivateTSMDocument<TR>
<TD>DeactivateTSMDocument<TD>_DeactivateTSMDocument<TR>
<TD>TSMEvent<TD>_TSMEvent<TR>
<TD>TSMMenuSelect<TD>_TSMMenuSelect<TR>
<TD>SetTSMCursor<TD>_SetTSMCursor<TR>
<TD>FixTSMDocument<TD>_FixTSMDocument<TR>
<TD>GetServiceList<TD>_GetServiceList<TR>
<TD>OpenTextService<TD>_OpenTextService<TR>
<TD>CloseTextService<TD>_CloseTextService<TR>
<TD>SendAEFromTSMComponent<TD>_SendAEFromTSMComponent<TR>
<TD>SetDefaultInputMethod<TD>_SetDefaultInputMethod<TR>
<TD>GetDefaultInputMethod<TD>_GetDefaultInputMethod<TR>
<TD>SetTextServiceLanguage<TD>_SetTextServiceLanguage<TR>
<TD>GetTextServiceLanguage<TD>_GetTextServiceLanguage<TR>
<TD>UseInputWindow<TD>_UseInputWindow<TR>
<TD>NewServiceWindow<TD>_NewServiceWindow<TR>
<TD>CloseServiceWindow<TD>_CloseServiceWindow<TR>
<TD>GetFrontServiceWindow<TD>_GetFrontServiceWindow<TR>
<TD>InitTSMAwareApplication<TD>_InitTSMAwareApplication<TR>
<TD>CloseTSMAwareApplication<TD>_CloseTSMAwareApplication<TR>
<TD>FindServiceWindow<TD>_FindServiceWindow</TABLE>
</H4>
<A NAME=HEADING482-192></A>
<H4></H4>
<A NAME=HEADING482-193></A>
<H4>Trap Macro Names for Text Service Component Routines
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Pascal name<TH>Trap macro name<TR>
<TD>GetScriptLanguageSupport<TD>_GetScriptLanguageSupport<TR>
<TD>InitiateTextService<TD>_InitiateTextService<TR>
<TD>TerminateTextService<TD>_TerminateTextService<TR>
<TD>ActivateTextService<TD>_ActivateTextService<TR>
<TD>DeactivateTextService<TD>_DeactivateTextService<TR>
<TD>TextServiceEvent<TD>_TextServiceEvent<TR>
<TD>GetTextServiceMenu<TD>_GetTextServiceMenu<TR>
<TD>TextServiceMenuSelect<TD>_TextServiceMenuSelect<TR>
<TD>FixTextService<TD>_FixTextService<TR>
<TD>SetTextServiceCursor<TD>_SetTextServiceCursor<TR>
<TD>HidePaletteWindows<TD>_HidePaletteWindows</TABLE>
</H4>
<A NAME=HEADING482-194></A>
<H2>Result Codes
<TABLE BORDER="0" CELLPADDING=3><TD>tsmComponentNoErr<TD>0<TD>Component result: no error<TR>
<TD>tsmUnsupScriptLanguageErr<TD>-2500<TD>Specified script and language are not supported<TR>
<TD>tsmInputMethodNotFoundErr<TD>-2501<TD>Specified input method cannot be found<TR>
<TD>tsmNotAnAppErr<TD>-2502<TD>The caller was not an application<TR>
<TD>tsmAlreadyRegisteredErr<TD>-2503<TD>The caller is already TSM-initialized<TR>
<TD>tsmNeverRegisteredErr<TD>-2504<TD>The caller is not TSM-aware<TR>
<TD>tsmInvalidDocIDErr<TD>-2505<TD>Invalid TSM document ID<TR>
<TD>tsmTSMDocBusyErr<TD>-2506<TD>Document is still active<TR>
<TD>tsmDocNotActiveErr<TD>-2507<TD>Document is not active<TR>
<TD>tsmNoOpenTSErr<TD>-2508<TD>There is no open text service component<TR>
<TD>tsmCantOpenComponentErr<TD>-2509<TD>Can't open the component<TR>
<TD>tsmTextServiceNotFoundErr<TD>-2510<TD>No text service component found<TR>
<TD>tsmDocumentOpenErr<TD>-2511<TD>There are open documents<TR>
<TD>tsmUseInputWindowErr<TD>-2512<TD>An input window is being used<TR>
<TD>tsmTSHasNoMenuErr<TD>-2513<TD>The text service component has no menu<TR>
<TD>tsmTSNotOpenErr<TD>-2514<TD>Text service component is not open<TR>
<TD>tsmComponentAlreadyOpenErr<TD>-2515<TD>Text service component already open for document<TR>
<TD>tsmInputMethodIsOldErr<TD>-2516<TD>The default input method is old-style<TR>
<TD>tsmScriptHasNoIMErr<TD>-2517<TD>Script has no (or old) input method<TR>
<TD>tsmUnsupportedTypeErr<TD>-2518<TD>Unsupported interface type<TR>
<TD>tsmUnknownErr<TD>-2519<TD>Any other error<A NAME=MARKER-2-54></A></TABLE>
</H2>
 <P>

</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-481.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-483.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
