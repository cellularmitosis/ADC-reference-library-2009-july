<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Refreshing Data by Refetching from the Database or Invalidating an Object</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.34.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.36.html"><img src="next.gif" border="0" alt="Next"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="16428"> </A>Refreshing Data by Refetching from the Database or Invalidating an Object</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to get the most current values for an object by either refreshing during a fetch or invalidating an object.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=606104"> </A>Enterprise Objects Framework (EOF) automatically caches the raw dictionary of values and unique objects that are fetched from the database. The raw dictionary is cached in a set of snapshots based on a GlobalID derived from the primary keys of the database rows. All peer EOEditingContexts share this common cache of snapshots. Each EOEditingContext stores its own unique object instance for a given GlobalID. Whenever the common snapshots change, an EOObjectsChangedInStore notification is posted and all associated EOEditingContexts attempt to reconcile themselves with the new snapshot.</P><P CLASS="Body"><A NAME="pgfId=606105"> </A>When an EOEditingContext fetches a row, it creates one unique object within the EditingContext based on the GlobalID. This &quot;uniquing&quot; process enables EOF to return the same object during a future fetch. Uniquing is an important part of EOF, because having multiple instances of the same object in the same editing context is not desirable.</P><P CLASS="Body"><A NAME="pgfId=606106"> </A>When a peer editing context such as another session's <TT CLASS="Code">defaultEditingContext</TT> fires a fault to a GlobalID that has already been fetched, the last fetched data (in the snapshot cache) is used as the source instead of a real database fetch. A new object is then instantiated and uniqued in this peer editing context. </P><P CLASS="Body"><A NAME="pgfId=606107"> </A>The default behavior for fetching and uniquing an object involves comparing a newly fetched row's primary keys to the previously fetched snapshot. If a snapshot already exists with the same primary keys, EOF will completely ignore the fetched row and just use the previous snapshot. </P><P CLASS="Body"><A NAME="pgfId=606108"> </A>This appears to be undesirable since the new fetch might have updated data. However, if the default was to always update the objects to the latest fetched data, your objects might be updated at unknown and invalid times. </P><P CLASS="Body"><A NAME="pgfId=606109"> </A>The following are two ways that an instantiated object can be refreshed with the latest database values:</P><UL><LI CLASS="Bulleted"><A NAME="pgfId=606110"> </A>	The object (row) is returned from a new fetch that specifically requests refreshing.</LI><LI CLASS="Bulleted"><A NAME="pgfId=606111"> </A>	The editing context for the object is asked to invalidate the object, which releases the snapshot for this object and turns all instances back to a faults.</LI></UL><P CLASS="Warning"><A NAME="pgfId=611754"> </A><DIV><IMG SRC="ProgrammingTopics-11.gif"></DIV>Warning	Refreshing an object will not refresh its relationships. Only its data and flattened<BR>	attributes will be refreshed. <DIV><IMG SRC="ProgrammingTopics-11.gif"></DIV></P><DIV><H3 CLASS="Heading2"><A NAME="pgfId=611755"> </A>Refreshing Data with a FetchSpecification</H3><P CLASS="Body"><A NAME="pgfId=606114"> </A>EOFetchSpecification's <TT CLASS="Code">setRefreshesRefetchedObjects</TT> method can be used to override the default behavior and force an update to the snapshot and, consequently, an update to all previously fetched objects.</P><P CLASS="Body"><A NAME="pgfId=613902"> </A>The following code shows how to set up an EOFetchSpecification to refresh the objects it fetches.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=613905"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=613907"> </A>EOEditingContext ec=session().defaultEditingContext();<A NAME="pgfId=613909"> </A>EOFetchSpecification fs=new EOFetchSpecification<A NAME="pgfId=613957"> </A>    (&quot;Movie&quot;, qual, null);<A NAME="pgfId=613911"> </A>fs.setRefreshesRefetchedObjects(true);<A NAME="pgfId=613913"> </A>movies=ec.objectsWithFetchSpecification(fs);</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=613916"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=613918"> </A>EOEditingContext *ec=[[self session] defaultEditingContext];<A NAME="pgfId=613920"> </A>EOFetchSpecification *fs=[EOFetchSpecification<A NAME="pgfId=613958"> </A>    fetchSpecificationWithEntityName: @&quot;Movie&quot; <A NAME="pgfId=613959"> </A>    qualifier:nil sortOrderings: nil];<A NAME="pgfId=613922"> </A>[fs setRefreshesRefetchedObjects:YES];<A NAME="pgfId=613924"> </A>movies =[ec objectsWithFetchSpecification: fs];</PRE><P CLASS="Body"><A NAME="pgfId=613956"> </A></P></DIV></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=613925"> </A>Refreshing Data by Invalidating the Object</H3><P CLASS="Body"><A NAME="pgfId=613926"> </A>EOF can be forced to invalidate an object, which removes the object's snapshot from the cache and converts the object back into a fault. As soon as a message is sent to the fault, the most recent data will be refetched from the database and the fault will be converted back into the appropriate object with the data. See the programming topic <A HREF="ProgrammingTopics.36.html#33427" CLASS="XRef">Invalidating Objects</A> for a discussion on how to invalidate objects.</P></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=613935"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606146"> </A><A HREF="ProgrammingTopics.36.html#33427" CLASS="XRef">Invalidating Objects</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=606147"> </A>EOEditingContext class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI><LI CLASS="Bulleted"><A NAME="pgfId=606148"> </A>EOFetchSpecification class specification in the <EM CLASS="Emphasis">Enterprise Objects Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606150"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606151"> </A>	How do I force a fetch and update my existing objects?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606152"> </A>	Why does my object still have old values even after a refetch?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606153"> </A>	How can I force an object to update its values?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606154"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606155"> </A>Refetch</LI><LI CLASS="Bulleted"><A NAME="pgfId=606156"> </A>Invalidate</LI><LI CLASS="Bulleted"><A NAME="pgfId=606157"> </A>Update</LI><LI CLASS="Bulleted"><A NAME="pgfId=606158"> </A>Snapshot</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606159"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606160"> </A>23 July, 1998. David Scheck. First Draft.</P><P CLASS="Body"><A NAME="pgfId=613839"> </A>19 November, 1998. Clif Liu. Second Draft.</P></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.34.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.36.html"><img src="next.gif" border="0" alt="Next"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>