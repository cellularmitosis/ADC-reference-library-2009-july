<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Searching for Profiles in the ColorSync(TM) Profiles Folder</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING71></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACI-70.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-72.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACI-2.html"><B>Advanced Color Imaging on the Mac OS</B></A> / <BR><DD><A HREF="ACI-55.html"><B>Chapter 4 - Developing ColorSync-Supportive Applications</B></A> / <A HREF="ACI-60.html"><B>Developing Your ColorSync-Supportive Application</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING71-0></A>
<H2><A NAME=MARKER-9-127></A>Searching for Profiles in the ColorSync(TM) Profiles Folder</H2>
 <A NAME=MARKER-2-128></A>Your application can use the ColorSync Manager search functions to obtain a list identifying profiles in the <A NAME=MARKER-2-129></A>ColorSync(TM) Profiles folder that meet specifications you supply in a search record. For example, you can use these <A NAME=MARKER-2-130></A>functions to find all profiles for printers that meet certain criteria defined in the profile. Your application can walk through the result listing that identifies these profiles and obtain the name and script code of each profile corresponding to a specific index in the list. Your application can then display a selection menu showing the names of the profiles to your user. <A HREF=#MARKER-9-141>Listing 4-11</A> shows sample code that takes an approach similar to one this example describes. <P>
<DL>
<DT><B>Note</B>
<DD>You can also search the ColorSync(TM) Profiles folder for profiles that match a profile identifier. For more information, see <A HREF=ACI-77.html#MARKER-9-178>"Searching for a Profile That Matches a Profile Identifier" (page 4-75)</A>, and the <CODE>CMProfileIdentifierFolderSearch</CODE> function in <I>Advanced Color Imaging Reference</I>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The <A NAME=MARKER-11-139></A>MyProfileSearch function, shown in <A HREF=#MARKER-9-141>Listing 4-11</A>, defines values for the search specification record fields, including the search mask, and assigns those values to the record's fields after initializing the search result. Then <A NAME=MARKER-11-139></A>MyProfileSearch calls the CMNewProfileSearch function to search the ColorSync(TM) Profiles folder for profiles that meet the search specification requirements. The CMNewProfileSearch function returns a one-based count of the profiles matching the search specification and a reference to the search result list of the matching profiles. <P>
 Next, the <A NAME=MARKER-11-139></A>MyProfileSearch function calls the <CODE>CMSearchGetIndProfile</CODE> function to obtain a reference to a specific profile corresponding to a specific index in the search result list. Passing the profile reference returned by the <CODE>CMSearchGetIndProfile</CODE> function as the <CODE>foundProf</CODE> parameter, <A NAME=MARKER-11-139></A>MyProfileSearch calls the <CODE>CMGetScriptProfileDescription</CODE> function to obtain the profile name and script code. <P>
 Finally, the <A NAME=MARKER-11-139></A><A NAME=MARKER-2-140></A>MyProfileSearch function cleans up, calling the <CODE>CMCloseProfile</CODE> function to close the profile and the <CODE>CMDisposeProfileSearch</CODE> function to dispose of the search result list. <P>
<B>Listing 4-11  <A NAME=MARKER-9-141></A>Searching for specific profiles in the ColorSync(TM) Profiles folder</B><P>
<PRE>
#define kSearchMask(cmMatchProfileCMMType + cmMatchProfileClass + cmMatchAttributes)
void MyProfileSearch (void)
{
   CMError        cmErr;
   CMProfileRef   foundProf;
   Str255         profName;
   ScriptCode     profScript;
   CMSearchRecord searchSpec;
   CMProfileSearchRefsearchResult;
   unsigned long  searchCount;
   unsigned long  i;
   /* init for error handling */
   searchResult = NULL;
   /* specify search for Apple default CMM printer profiles for transparent media */
   searchSpec.CMMType = kDefaultCMMSignature;/* profile uses default CMM */
   searchSpec.profileClass = cmOutputClass;/* printer profiles */
   searchSpec.deviceAttributes[0]= 0x00000000;/* no deviceAttributes[0] bits set */
   searchSpec.deviceAttributes[1] = cmReflectiveTransparentMask;
                                    /* transparent media */
   searchSpec.searchMask = kSearchMask;
   searchSpec.filter= NULL;      /* filter proc is not used */
   cmErr = CMNewProfileSearch(&amp;searchSpec, NULL, &amp;searchCount, &amp;searchResult);
   if (cmErr == noErr)
   {
      for (i = 1; i &lt;= searchCount; i++)
      {
         if (CMSearchGetIndProfile(searchResult, i, &amp;foundProf) != noErr)
         {
            break;
         }

         cmErr = CMGetScriptProfileDescription(foundProf, profName, &amp;profScript);
         if (cmErr == noErr)
         {
            /* assume profile name ScriptCode is smRoman */
            (void) printf(&quot;%s\n&quot;, p2cstr(profName));
         }

         (void) CMCloseProfile(foundProf);
      }
   }
   if (searchResult != NULL)
   {
      CMDisposeProfileSearch(searchResult);
   }
}
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACI-70.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACI-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACI-122.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACI-72.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACI-3.html">&copy; Apple Computer, Inc.</A><br>13 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 
