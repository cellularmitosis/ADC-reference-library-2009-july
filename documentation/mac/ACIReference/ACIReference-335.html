<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>MyCMMUnflattenProfile(IM: ACI Ref)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING335></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="ACIReference-334.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-336.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="ACIReference-2.html"><B>Advanced Color Imaging Reference</B></A> / <BR><DD><A HREF="ACIReference-314.html"><B>Chapter 4 - ColorSync Manager Reference for Color Management Modules</B></A> / <A HREF="ACIReference-322.html"><B>Optional CMM-Defined Functions</B></A><BR><DL><DD><A HREF="ACIReference-308.html"><B></B></A> / <A HREF="ACIReference-317.html"><B></B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING335-0></A>
<H3><A NAME=MARKER-9-80></A>MyCMMUnflattenProfile</H3>
 Handles the <CODE>kCMMUnflattenProfile</CODE> request by creating a uniquely named file in the temporary items folder to store the profile data.<P>
 A CMM <A NAME=MARKER-2-81></A>may respond to the <CODE>kCMMUnflattenProfile</CODE> request code, but it is not required to do so. Most CMMs can rely on the default Apple CMM to handle this request code adequately. The ColorSync Manager sends this request code to your CMM on behalf of an application or device driver that called the <CODE>CMUnflattenProfile</CODE> function. The ColorSync Manager dispatches this request to the Component Manager, which calls your CMM to service the request. A CMM that handles the <CODE>kCMMUnflattenProfile</CODE> request code typically responds by calling a CMM-defined function (for example, <A NAME=MARKER-11-82></A><CODE>MyCMMUnflattenProfile</CODE>). <P>
 The MyCMMUnflattenProfile function is a color management module-defined subroutine.<P>
<PRE>
pascal CMError MyCMMUnflattenProfile (
ComponentInstance CMSession,
FSSpec *resultFileSpec,
CMFlattenUPP proc, 
void *refCon); 
</PRE>
<DL>
<DT><CODE>CMSession</CODE>
<DD> A handle to your CMM's storage for the instance of your component associated with the calling application or device driver.
<DT><CODE>resultFileSpec</CODE>
<DD> A pointer to a file specification for the profile file. This is a temporary file specification. You must create this temporary file, which is returned to the calling application or device driver. The calling application or driver is responsible for disposing of the file when finished with it. 
<DT><CODE>proc</CODE>
<DD> A pointer to a function supplied by the calling application or device driver to perform the low-level data transfer. Your <CODE>MyCMMFlattenProfile</CODE> function calls this function repeatedly as necessary until all the profile data is transferred. 
<DT><CODE>refCon</CODE>
<DD> A reference constant containing data specified by the calling application program. 
<DT><I>function result</I>
<DD> A result code of type CMError. See <A HREF=ACIReference-313.html#MARKER-9-479>"Result Codes" (page 3-172)</A> for a list of ColorSync-specific result codes.
</DL>
<A NAME=HEADING335-10></A>
<H5>DISCUSSION</H5>
 Only in rare circumstances should a custom CMM need to support this request code. The process of unflattening a profile is complex, and the default Apple CMM handles this process adequately for most cases. A custom CMM might respond to this request code if the CMM provides special services such as profile data encryption or compression, for example. Read the rest of this description if your CMM handles this request code.<P>
 Your <CODE>MyCMMUnflattenProfile</CODE> function must create a file with a unique name in which to store the profile data. (You should create this file in the temporary items folder.) The ColorSync Manager returns the temporary file specification to the calling application or device driver.<P>
 To obtain the profile data, your <CODE>MyCMMUnflattenProfile</CODE> function calls the <CODE>MyColorSyncDataTransfer</CODE> function supplied by the calling application or device driver. Here is the prototype for the <CODE>MyColorSyncDataTransfer</CODE> function pointed to by the <CODE>proc</CODE> parameter:<P>
<PRE>
pascal OSErr MyColorSyncDataTransfer (
                  long command,
                  long *size, 
                  void *data,
                  void *refCon); 
</PRE>
 Before calling the <CODE>MyColorSyncDataTransfer</CODE> function, your <CODE>MyCMMUnflattenProfile</CODE> function must allocate a buffer to hold the profile data returned to you from the <CODE>MyColorSyncDataTransfer</CODE> function in the <CODE>data</CODE> parameter. <P>
 Your <CODE>MyCMMUnflattenProfile</CODE> function communicates with the <CODE>MyColorSyncDataTransfer</CODE> function using a command parameter to identify the operation to perform. Your function should call the <CODE>MyColorSyncDataTransfer</CODE> function first with the <CODE>openReadSpool </CODE>command to direct the<CODE> MyColorSyncDataTransfer</CODE> function to begin the process of transferring data. Following this, you should call the <CODE>MyColorSyncDataTransfer</CODE> function with the <CODE>readSpool</CODE> command as often as necessary until the <CODE>MyColorSyncDataTransfer</CODE> function has passed your function all the profile data from the graphics file. After you have received all the profile data, your function should call the <CODE>MyColorSyncDataTransfer</CODE> function with the <CODE>closeSpool</CODE> command.<P>
 Each time you call the <CODE>MyColorSyncDataTransfer</CODE> function, you should pass it a pointer to the <CODE>data</CODE> buffer you created, the size in bytes of the profile data to return to you in the buffer, and the reference constant passed to you from the calling application. <P>
 On return, the <CODE>MyColorSyncDataTransfer</CODE> function passes to you the profile data that your function must write to the temporary file that you created for the new profile file. The <CODE>MyColorSyncDataTransfer</CODE> function will not always transfer the number of bytes of profile data you requested. Therefore, the <CODE>MyColorSyncDataTransfer</CODE> function returns in the <CODE>size</CODE> parameter the number of bytes of profile data it actually returned in the <CODE>data</CODE> buffer. <P>
 The profile file you create is returned to the calling application or device driver in the <CODE>resultFileSpec</CODE> parameter. Your <CODE>MyCMMUnflattenProfile</CODE> function must identify the profile size and maintain a counter tracking the amount of data transferred to you and the amount of remaining data to determine when to call the <CODE>MyColorSyncDataTransfer</CODE> function with the <CODE>closeSpool</CODE> command. To determine the profile size, your function can obtain the profile header, which specifies the size. <P>
 The calling application or device driver uses the reference constant to pass information to the <CODE>MyColorSyncDataTransfer</CODE> function that the function requires to transfer the data.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="ACIReference-334.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="ACIReference-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="ACIReference-371.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="ACIReference-336.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="ACIReference-3.html">&copy; Apple Computer, Inc.</A><br>11 NOV 1996<P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML> 

