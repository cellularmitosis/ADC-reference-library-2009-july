<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Moving Text In and Out of Edit Records(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING52></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-51.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-53.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-40.html"><B>Chapter 2 - TextEdit</B></A> / <A HREF="Text-49.html"><B>Using TextEdit</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING52-0></A>
<H2><A NAME=MARKER-9-227></A>Moving Text In and Out of Edit Records</H2>
 This section describes how to cut, copy, and paste text, and insert and delete it. Because TextEdit manages the varying character attribute information associated with multistyled text, you use separate routines for monostyled and multistyled text <BR>to perform some of these tasks; this section explains those differences. If your application supports both monostyled and multistyled text, you need to handle these cases separately.<P>
<A NAME=HEADING52-2></A>
<H3>Using TextEdit to Cut, Copy, and Paste Text</H3>
 You can use TextEdit to cut, copy, and paste text within a single edit record, between edit records, or across applications, and to handle menu commands that let the user perform these actions. You use the <A NAME=MARKER-2-228></A><CODE>TECut</CODE> and <A NAME=MARKER-2-307></A><CODE>TECopy</CODE> procedures to cut and copy both monostyled and multistyled text. To paste monostyled text, you use the <CODE>TEPaste</CODE> procedure. To paste multistyled text, you use the <CODE>TEStylePaste</CODE> procedure. To move monostyled text across applications or between an application and a desk accessory, you use the <CODE>TEFromScrap</CODE> and <CODE>TEToScrap</CODE> functions. This section describes how to use these routines and what they do.<P>
<DL>
<DT><B>Note</B>
<DD>This section and those that follow do not describe how to create menus and their commands. For guidelines and a complete discussion of how to create and manage the menus in your application, see the chapter "The Menu Manager" in <I><A HREF="../Toolbox/Toolbox-2.html">Inside Macintosh: Macintosh Toolbox Essentials</A></I>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The <CODE>TECut</CODE> procedure <A NAME=MARKER-9-220></A>removes and transfers the <A NAME=MARKER-2-98></A>selected text. The <CODE>TECopy</CODE> procedure <A NAME=MARKER-9-63></A>copies the selected text, leaving the original text intact. <A NAME=MARKER-9-5></A>To implement cut-and-paste or copy-and-paste services, you can couple either of these calls with <A NAME=MARKER-2-131></A><CODE>TEPaste</CODE> <A NAME=MARKER-2-138></A>or <CODE>TEStylePaste</CODE> to overlay a text selection or insert the text to be pasted at an insertion point.<P>
 To cut, copy, and paste text within the same edit record or between two edit records within the same application, you do not need to write the text to and from the desk scrap, although this is always done automatically for multistyled text. However, to carry text across applications or between an application and a desk accessory, whether the text is multistyled or monostyled, you must write it to and from the desk scrap.<P>
 For monostyled text, <CODE>TECut</CODE> and <CODE>TECopy</CODE> write the text to the private scrap only. The <CODE>TEPaste</CODE> procedure pastes the monostyled text from the private scrap to the edit record. To determine the length of the text to be pasted, you can call the <CODE>TEGetScrapLength</CODE> function which returns the size in bytes of the text in the private scrap, or you can check the value of the global variable<A NAME=MARKER-2-225></A> <CODE>TEScrapLength</CODE>.<P>
 To move monostyled text across applications or between an application and a desk accessory, you need to use the <CODE>TEFromScrap</CODE> and <CODE>TEToScrap</CODE> functions, which write text to and from the desk scrap.<A NAME=MARKER-9-399></A><P>
 For multistyled text, <CODE>TECut</CODE> and <CODE>TECopy</CODE> always write both the text and its associated character attribute information to the Scrap Manager's desk scrap under scrap types <CODE>'TEXT'</CODE> and <CODE>'styl'</CODE>. For more information, see the chapter "Scrap Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<P>
 The <CODE>TEStylePaste</CODE> procedure reads both the text and its attributes back from the desk scrap and writes the multistyled text into the edit record's text buffer at the current selection range or insertion point.<P>
 You can use these procedures to move multistyled text across two applications or between an application and a desk accessory; you don't need to call <CODE>TEFromScrap</CODE> and <CODE>TEToScrap</CODE> for multistyled text. To either copy or move the text selection from the text buffer to the desk scrap, <CODE>TECut</CODE> and <CODE>TECopy</CODE> write the text to the private scrap and to the Scrap Manager's desk scrap. To copy or move the attributes along with the text, <CODE>TECut</CODE> and <CODE>TECopy</CODE> write the character attribute information stored in the style table to both the <A NAME=MARKER-2-159></A>style scrap and the Scrap Manager's <A NAME=MARKER-2-158></A>desk scrap. <A HREF=#MARKER-9-240>Figure 2-9</A> shows what happens when you cut multistyled text using <CODE>TECut</CODE>.<P>
<B>Figure 2-9  <A NAME=MARKER-9-240></A>Cutting text from a multistyled edit record</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/TE_L-28.jpg">
 The <CODE>TEStylePaste</CODE> procedure either pastes the text from the desk scrap at the insertion point or replaces the current selection range with the text to be pasted. Along with the text, <CODE>TEStylePaste</CODE> writes the character attribute information to the style record's style table and applies it to the inserted text.<P>
 For multistyled text, text is pasted from the desk scrap. Therefore, before you call <CODE>TEStylePaste</CODE>, use the Scrap Manager's <CODE>GetScrap</CODE> procedure to check the size of the text (<CODE>'TEXT'</CODE> data) to be pasted.<P>
 To calculate the amount of memory required for the style scrap before you cut or copy multistyled text, you can use the information returned by the <CODE>TENumStyles</CODE> function. This function returns the number of attribute changes contained in a range of text. Since the style scrap is linear in structure, with one element for each attribute change, you can multiply the number returned by <A NAME=MARKER-9-50></A><CODE>TENumStyles</CODE> by <CODE>SizeOf(ScrpSTElement)</CODE> and add 2 to get the number of bytes needed.<P>
 <A HREF=#MARKER-9-242>Listing 2-8</A> shows a sample application-defined procedure that handles cut, copy, and paste menu commands. Before the application pastes the multistyled text into the edit record's text at the current selection range, it calls the Scrap Manager's <CODE>GetScrap</CODE> function to get the size of the text to be pasted. The code adds the returned value to the size of the text in the edit record, subtracts the size of the selection range, then compares the result against the maximum length of the edit record text to make sure that pasting the text won't exceed it. (To get the selection range length, the code calls the application-defined function <CODE>MyGetTESelLength</CODE>, as shown in <A HREF=Text-51.html#MARKER-9-223>Listing 2-7 on page 2-35</A>.)<P>
 To avoid copying the data when you want only the length of the text returned, pass a value of <CODE>NIL</CODE> for the <CODE>hDest</CODE> parameter to <CODE>GetScrap</CODE>. For more information about <CODE>GetScrap</CODE>, see the chapter "Scrap Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<P>
<B>Listing 2-8  <A NAME=MARKER-9-242></A>Handling Cut, Copy, and Paste commands on an Edit menu</B><P>
<PRE>
PROCEDURE MyHandleEditMenu (myWindow: WindowPtr; menuItem: Integer);
CONST
   kMaxTELength = 32000;
   kTESlop  = 1024;
      {kTESlop provides some extra security when preflighting edit commands.}
VAR
   myData:           MyDocRecHnd;      {handle to a document record}
   myTERec:          TEHandle;         {handle to TextEdit record}
   myErr:            OSErr;
   offset:           LONGINT;
   aHandle:          Handle;
   oldSize, newSize: LONGINT;
   saveErr:          OSErr;
BEGIN
   myData   := MyDocRecHnd(GetWrefCon(myWindow));  {get window's data record}
   IF myData = NIL THEN
      exit(MyDoContentClick);
   myTERec  := myData^^.editRec;                   {get TERec}
   IF myTERec = NIL THEN
      Exit(MyDoContentClick);
   CASE menuItem OF
      iCut: 
         BEGIN
            IF ZeroScrap = noErr THEN 
               BEGIN
                  PurgeSpace(total, contig);
                  IF MyGetTESelLength(myTERec) + kTESlop &gt;
                   contig THEN
                     MyAlertUser(eNoSpaceCut)
                  ELSE 
                     TECut(myTERec);
               END; 
         END;
      iCopy: 
         BEGIN
            IF ZeroScrap = noErr THEN 
               TECopy(myTERec);
         END; 
      iPaste: 
         BEGIN
            IF GetScrap(NIL, 'TEXT', offset) + 
               (myTERec^^.teLength - MyGetTESelLength(myTERec)) &gt; 
               kMaxTELength 
            THEN
               MyAlertUser(eExceedPaste)
            ELSE 
               BEGIN
                  aHandle := Handle(TEGetText(myTERec));
                  oldSize := GetHandleSize(aHandle);
                  newSize := oldSize + GetScrap + kTESlop
                  SetHandleSize(aHandle, newSize);
                     {see if handle can be resized}
                  saveErr := MemError;
                  SetHandleSize(aHandle, oldSize);
                  IF saveErr &lt;&gt; noErr THEN
                     MyAlertUser(eNoSpacePaste)
                  ELSE
                     TEStylePaste(myTERec);
               END;
            END; 
         END;
      END;
</PRE>
<A NAME=HEADING52-22></A>
<H3>Inserting and Deleting Text</H3>
 You can use TextEdit <A NAME=MARKER-2-241></A>routines to delete and insert text. You use <CODE>TEInsert</CODE> <A NAME=MARKER-2-390></A>to insert monostyled text into the edit record's text buffer if the current selection range is an insertion point. If the current selection range is a range of text, <CODE>TEInsert</CODE> replaces it with the text to be inserted. You use<A NAME=MARKER-2-394></A> <CODE>TEStyleInsert</CODE> to <A NAME=MARKER-2-395></A>insert multistyled text in the same way; however, the text <I>and</I> its associated character attribute information are inserted.<A NAME=MARKER-2-397></A><P>
 To delete text, your application calls the same routine whether the text is multistyled or monostyled. The <A NAME=MARKER-2-296></A><CODE>TEDelete</CODE> procedure removes the text of the current selection range. When the text is multistyled, <CODE>TEDelete</CODE> saves the character attributes in the null scrap to be applied to characters that the user might enter following the deletion. After each editing procedure, TextEdit redraws the text if necessary from the insertion point to the end of the text.<P>
 You can handle a Clear command using <CODE>TEDelete</CODE>; you call <CODE>TEDelete</CODE> with the handle to the edit record containing the text you want to eliminate. The <CODE>TEDelete</CODE> procedure removes the selected text without transferring it to the scrap.<P>
<PRE>
iClear:
   TEDelete(myTERec);
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-51.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-53.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
