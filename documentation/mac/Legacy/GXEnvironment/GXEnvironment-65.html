<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Creating a Graphics Client and Its Graphics Client Heap(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING65></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-64.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-66.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-59.html"><B>Chapter 2 - QuickDraw GX Memory Management</B></A> / <A HREF="GXEnvironment-64.html"><B>Using Graphics Clients and Graphics Client Heaps</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING65-0></A>
<H2><A NAME=MARKER-9-29></A>Creating a Graphics Client and Its Graphics Client Heap</H2>
 <A NAME=MARKER-8-23></A><A NAME=MARKER-2-60></A><A NAME=MARKER-2-57></A>Either QuickDraw GX or you can create a new graphics client and its heap. This section discusses how you can control these tasks.<P>
<A NAME=HEADING65-2></A>
<H3>Implicit Creation</H3>
 <A NAME=MARKER-2-214></A><A NAME=MARKER-2-11></A><A NAME=MARKER-2-85></A>If your application does not explicitly create a graphics client or a graphics client heap, QuickDraw GX creates them for you when needed. QuickDraw GX calls the <CODE>GXNewGraphicsClient</CODE> and the <CODE>GXEnterGraphics</CODE> functions when the first function call is made in your application that requires a graphics client heap. Almost all QuickDraw GX functions require a graphics client heap. The few exceptions are listed in the section <A HREF=GXEnvironment-71.html#MARKER-9-94>"Functions That Do Not Require a Graphics Client or Heap" beginning on page 2-14</A>. <P>
 When QuickDraw GX calls the <CODE>GXNewGraphicsClient</CODE> function, it selects the starting memory location for the heap and creates a graphics client to provide the bookkeeping for the heap. When QuickDraw GX calls the <CODE>GXEnterGraphics</CODE> function, it uses the memory location and heap size stored in the graphics client to create the new heap.<P>
 QuickDraw GX looks for a resource of type <CODE>'gasz'</CODE> with an ID of 0 and uses the first long word of that resource as the number of bytes to be allocated to the graphics client heap. If your application does not provide this resource, <A NAME=MARKER-2-51></A>QuickDraw GX version 1.0 uses a <B>default memory size</B> value of 600 KB. For additional information, see the description of the <CODE>GXNewGraphicsClient</CODE> routine beginning on <A HREF=GXEnvironment-80.html#MARKER-9-124>page 2-19</A>.<P>
 A <CODE>'gasz'</CODE> resource can only provide one graphics client heap size in a single application. QuickDraw GX uses this size for every graphics client with a <CODE>memoryLength</CODE> parameter of zero. <A HREF=#MARKER-9-37>Listing 2-1</A> shows how to create a type '<CODE>gasz</CODE>' resource for a 512 KB graphics client heap.<P>
<B>Listing 2-1  <A NAME=MARKER-9-37></A>Creating a <CODE>'gasz'</CODE> resource</B><P>
<PRE>
resource 'gasz' (0) {
    0x00080000        /* 512KB graphics client heap */
};
</PRE>
 The <CODE>GXNewGraphicsClient</CODE> function is described on <A HREF=GXEnvironment-80.html#MARKER-9-124>page 2-19</A><CODE>.</CODE> The <CODE>GXEnterGraphics</CODE> function is described on <A HREF=GXEnvironment-83.html#MARKER-9-134>page 2-22</A>.<A NAME=MARKER-2-186></A><A NAME=MARKER-2-49></A><A NAME=MARKER-2-40></A><P>
<A NAME=HEADING65-10></A>
<H3><A NAME=MARKER-9-41></A>Explicit Creation</H3>
 <A NAME=MARKER-2-21></A>If you want to specify the characteristics of the graphics client heap, you can use the <CODE>GXNewGraphicsClient</CODE> function explicitly to create a graphics client. <P>
 The <CODE>GXNewGraphicsClient</CODE> function has parameters that specify the heap's starting memory location, <B>memory size</B> in bytes, and whether or not QuickDraw GX is permitted to later increase the heap's size by allocating additional memory blocks. The graphics client stores the data passed by the <CODE>GXNewGraphicsClient</CODE> function, but does not allocate memory to the heap. This requires the <CODE>GXEnterGraphics</CODE> function call.<P>
 Most applications should allow QuickDraw GX to select the memory starting location by passing <CODE>nil</CODE> for the <CODE>memoryStart</CODE> parameter. If you need to specify the memory starting location, see the section <A HREF=GXEnvironment-72.html#MARKER-9-98>"Specifying the Starting Location of a Graphics Client" beginning on page 2-14</A>.<P>
 If you pass zero for the <CODE>memoryLength</CODE> parameter, QuickDraw GX looks for a <A NAME=MARKER-2-43></A>resource of type <CODE>'gasz'</CODE> with an ID of 0 and uses the first long word of that resource as the heap size (the number of bytes to allocate). If your application does not provide this resource, QuickDraw GX version 1.0 uses a default size of 600 KB. Alternatively, you can specify the requested heap size in bytes. To determine how many bytes to specify for your graphics client heap, see the next section. The '<CODE>gasz</CODE>' resource is described in the previous section. <P>
 If you pass zero for the attribute parameter, QuickDraw GX can later add additional memory blocks to the heap when more memory is required. If the <CODE>attribute</CODE> parameter has value 1, indicating the <CODE>gxStaticHeapConstant</CODE> constant, QuickDraw GX cannot add more memory blocks to the graphics client heap allocated. <P>
 Once a graphics client is created, you use the <A NAME=MARKER-2-81></A><CODE>GXEnterGraphics</CODE> function to allocate memory for its heap. If you don't explicitly make the call, QuickDraw GX implicitly calls the <CODE>GXEnterGraphics</CODE> function for you when it executes the next function that requires a graphics client heap. Almost all QuickDraw GX functions require a graphics client heap. The exceptions are given in the section <A HREF=GXEnvironment-71.html#MARKER-9-94>"Functions That Do Not Require a Graphics Client or Heap" beginning on page 2-14</A>.<P>
 <A HREF=#MARKER-9-45>Listing 2-2</A> shows how to explicitly create a graphics client and allocate 10 KB of memory for its heap. Since the <CODE>attribute</CODE> parameter is 0, QuickDraw GX performs its default behavior to add <B>memory blocks</B> to the graphics client heap created, as required. For example, additional memory may be required as your application creates new objects. You should allocate your graphics client at the beginning of your application and poll for errors to ensure that the graphics client is allocated.<P>
<B>Listing 2-2  <A NAME=MARKER-9-45></A>Explicitly creating a graphics client and its heap</B><P>
<PRE>
gxGraphicsClient  newClient;
long              graphicsHeapSizeRequested = 50K; // 50K GX heap

newClient = GXNewGraphicsClient(nil, graphicsHeapSizeRequested 
                                 * 1024,OL );

   // After we attempted to create the graphics client, we need to 
   // determine if the call succeeded. If the call did not (as in 
   // the case for all GX functions), "newClient" will be nil. If
   // it is, we alert the user to the problem, Otherwise, we will
   // attempt to allocate the GX heap.

if ( newClient ) {
   GXEnterGraphiccs();
   // Calling GXEnterGraphics allocates the memory within the GX
   // heap. The call would fail only if there is not enough
   // memory. In this case, the graphics error posted is -27999
   // (out of memory). At this point, we have not installed an 
   // error handler, so we check for the error number
   // corresponding to the out-of-memory error.
if ( GXGetGraphicsError( nil ) == -27999 ) {

   // Because we cannot allocate the requested size for our GX
   // heap, we need to throw away the client we created and alert
   // the user that there is not enough memory to continue.

   GXDisposeGraphicsClient( newClient);

   &gt;&gt; application code to alert user and shut down app

} else {
   // Application error code to tell the user there is not enough 
   // memory to create the graphics client. No error is
   // posted from GX because a graphics client does not
   // exist. The only reason you would not be able to create
   // a graphics client is if there is not enough memory.

   &gt;&gt; application code to alert user and shut down app
</PRE>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-64.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-66.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
