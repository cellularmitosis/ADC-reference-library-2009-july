<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Using Validation Functions(IM: XU)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING155></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="GXEnvironment-154.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-156.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="GXEnvironment-2.html"><B>QuickDraw GX Environment and Utilities</B></A> / <BR><DD><A HREF="GXEnvironment-145.html"><B>Chapter 4 - QuickDraw GX Debugging</B></A> / <A HREF="GXEnvironment-153.html"><B>Using QuickDraw GX Debugging</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING155-0></A>
<H2><A NAME=MARKER-9-74></A>Using Validation Functions</H2>
 <A NAME=MARKER-2-49></A>QuickDraw GX provides validation functions that check the function parameters of all allocated objects. You can validate the public functions that you use in your application or choose to validate the internal QuickDraw GX functions. <A NAME=MARKER-2-162></A><P>
 Type validation is the simplest level of validation. QuickDraw GX provides successively more complicated levels of validation when you also check structures and internal caches. The various validation modes and validation levels are described in the section <A HREF=GXEnvironment-151.html#MARKER-9-33>"Validation Functions" beginning on page 4-6</A>.<P>
<A NAME=HEADING155-3></A>
<H3><A NAME=MARKER-9-77></A>Controlling Validation</H3>
 You can use the <A NAME=MARKER-9-1></A><CODE>GXSetValidation</CODE> function to control the validation of public and private functions used by your application. You control validation by using the <CODE>GXSetValidation</CODE> function to set validation level flags for the <CODE>gxValidationLevel</CODE> parameter. <A NAME=MARKER-9-35></A><A NAME=MARKER-2-179></A><A NAME=MARKER-9-19></A><A NAME=MARKER-9-130></A><A NAME=MARKER-2-83></A><A NAME=MARKER-9-124></A><A NAME=MARKER-2-85></A><P>
<PRE>
void GXSetValidation(gxValidationLevel, level);
</PRE>
 You set one flag from the modes in <A HREF=#MARKER-9-3>Table 4-8</A>, one flag from the options in <A HREF=#MARKER-9-5>Table 4-9</A>, and one or more flags from <A HREF=#MARKER-9-4>Table 4-10</A>. The validation modes and levels are defined in the gxValidationLevel enumeration that appears in the section <A HREF=GXEnvironment-159.html#MARKER-9-133>"Drawing Errors" beginning on page 4-29</A>. The <CODE>GXSetValidation</CODE> function is described on <A HREF=GXEnvironment-165.html#MARKER-9-155>page 4-34</A><P>
 Once you set the <CODE>gxValidationLevel</CODE> parameter, you can use the <A NAME=MARKER-9-98></A><CODE>GXGetValidation</CODE> function to return the current <CODE>gxValidationLevel</CODE> parameter. <P>
 The three validation mode options are validation off, public validation, and internal validation. You may choose only one of these validation options. <A HREF=#MARKER-9-3>Table 4-8</A> summarizes the public and internal validation mode options.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-3></A><B>Table 4-8 Validation modes</B> </CAPTION>
<TH>Constant<TH>Value<TH>Explanation<TR>
<TD>gxNoValidation<TD>0x00<TD>Turns off QuickDraw GX validation. <TR>
<TD>gxPublicValidation<TD>0x01<TD>Performs validation whenever your application uses a public function. <TR>
<TD>gxInternalValidation<TD>0x02<TD>Performs validation whenever your application uses a public function or an internal function. </TABLE>
<P>
 The validation mode flags allow you to selectively turn validation options on and off. You should experience reduction in performance only when validation is on. In the non-debugging version, validation is not operational. However, it is best just to turn validation off by setting the parameter of the <A NAME=MARKER-9-111></A><CODE>GXSetValidation</CODE> function to <CODE>gxNoValidation</CODE>.<P>
 If you activate either public validation or internal validation mode, then you must also specify either type validation, structure validation, or all object validation. You may choose only one option. <A HREF=#MARKER-9-5>Table 4-9</A> summarizes the type, structure, and object validation level options.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-5></A><B>Table 4-9 Validation levels</B> </CAPTION>
<TH>Constant<TH>Value<TH>Explanation<TR>
<TD>gxTypeValidation<TD>0x00<TD>Validates object types of function parameters.<TR>
<TD>gxStructureValidation<TD>0x10<TD>Validates object structures, caches and function parameters. <TR>
<TD>gxAllObjectValidation<TD>0x20<TD>Validates object types, structures, and all internal caches built for all objects. </TABLE>
<P>
<A NAME=HEADING155-11></A>
<H4>Type Validation</H4>
 You can select the <CODE>gxTypeValidation</CODE> level to check the type passed to all objects.  The type validation errors are listed in the section "Debugging Version" in the chapter "Errors, Warnings, and Notices."<P>
 The simplest and most commonly used <CODE>gxValidationLevel</CODE> parameter value combination is of the <CODE>gxPublicValidation</CODE> and <CODE>gxTypeValidation</CODE> options: <P>
<PRE>
GXSetValidation(gxPublicValidation | gxTypeValidation);
</PRE>
 This combination of options causes QuickDraw GX to verify that the objects used by all public functions your application calls are the correct type. For example, if you call the <CODE><A NAME=MARKER-2-88></A>GXDrawShape</CODE> function and pass it a style, the <A NAME=MARKER-9-8></A><CODE>GXSetValidation</CODE> function posts a <CODE>shape_wrong_type</CODE> error. <P>
 If you want to check the type of all objects that your application passes to both public and internal functions, you can use the <CODE>gxInternalValidation</CODE> option plus the <CODE>gxTypeValidation</CODE> option for the <CODE>gxValidationLevel</CODE> parameter:<P>
<PRE>
GXSetValidation(gxInternalValidation | gxTypeValidation);
</PRE>
 This is useful only for detecting GX internal errors.<P>
<A NAME=HEADING155-19></A>
<H4>Structure Validation</H4>
 You can set the <CODE>gxStructureValidation</CODE> validation parameter to check the type and structure for all objects. The structure validation errors are listed in the section "Debugging Version" in the chapter "Errors, Warnings, and Notices."<P>
 If you want to check the type of all objects and structure your application passes to public functions, you can use the <CODE>gxPublicValidation</CODE> and <CODE>gxStructureValidation</CODE> options for the <CODE>gxValidationLevel</CODE> parameter:<P>
<PRE>
GXSetValidation(gxPublicValidation | gxStructureValidation);
</PRE>
 If you want to check the type of all objects and the structure your application passes to public and internal functions, you can use the <CODE>gxInternalValidation</CODE> and <CODE>gxStructureValidation</CODE> options for the <CODE>gxValidationLevel</CODE> parameter:<P>
<PRE>
GXSetValidation(gxInternalValidation | gxStructureValidation);
</PRE>
 This is useful only for detecting internal GX errors.<P>
 The <CODE>gxStructureValidation</CODE> option might generate validation errors that are not part of the public interface. For example, these options may post a <CODE>shape_cache_wrong_type</CODE> error. This suggests only that the application erroneously changed the internal information that identifies a specific shape cache or an internal GX error occured. The correct shape and the correct value for a shape cache are private. The <CODE>bad_private_flags</CODE> error means that the application corrupted the flags internal to some structure. This is a private structure and QuickDraw GX provides no additional information for these posted errors. However it is useful for a developer to report the circumstances that produced these errors so that Apple Computer, Inc. can investigate them.<P>
<A NAME=HEADING155-27></A>
<H4>All Object Validation</H4>
 You can use the <CODE>gxAllObjectValidation</CODE> validation level to check the type, structure, and internal caches built for all objects. In addition, it checks objects written to disk and the file structure itself to see if they are corrupt. The all object validation errors are listed in the section "Debugging Version" in the chapter "Errors, Warnings, and Notices." <P>
 If an application has an error that randomly writes to some portion of memory, the error can corrupt one object as easily as another. As a result, it is necessary to check all objects to detect this type of error. If a random write occurs in a free memory block or the value is already in the shape type, QuickDraw GX doesn't detect it. Again, this validation allows the developer to discriminate between QuickDraw GX and application problems.<P>
 If you want to check the type of all objects, the structure, and the internal caches for all objects each time public functions are called by your application, you can use the <CODE>gxPublicValidation</CODE> and <CODE>gxAllObjectValidation</CODE> options for the <CODE>gxValidationLevel</CODE> parameter:<P>
<PRE>
GXSetValidation(gxPublicValidation | gxAllObjectValidation);
</PRE>
 As an alternative to using the <CODE>gxAllObjectValidation</CODE> options for the <CODE>gxValidationLevel</CODE> parameter of the <CODE>GXSetValidation</CODE> function, you can use the <CODE>GXValidateAll</CODE> function, described in the section <A HREF=#MARKER-9-96>"Validating Objects" beginning on page 4-20</A>. The <CODE>GXValidateAll</CODE> function is described on <A HREF=GXEnvironment-180.html#MARKER-9-201>page 4-43</A>.<P>
<A NAME=HEADING155-33></A>
<H4>Memory Validation</H4>
 Once you pick a validation mode and a validation level, you can then also choose to include or not include memory validation options. Memory validation does not post validation errors. If QuickDraw GX detects a memory validation problem, it drops you into Macsbug or the debugging utility that is installed on your system. <P>
 <A HREF=#MARKER-9-4>Table 4-10</A> summarizes the memory validation options, all of which are associated with QuickDraw GX private data structures.
<TABLE BORDER="0" CELLPADDING=3>
<CAPTION><A NAME=MARKER-9-4></A><B>Table 4-10 Memory validation options</B> </CAPTION>
<TH>Constant<TH>Value<TH>Explanation<TR>
<TD>gxNoMemoryManagerValidation<TD>0x0000<TD>Turns off memory validation.<TR>
<TD>gxApBlockValidation<TD>0x0100<TD>Enables additional error checking on application blocks passed as parameters to internal memory routines.<TR>
<TD>gxFontBlockValidation<TD>0x0200<TD>Enables additional error checking on system blocks, often font caches, passed as parameters to internal memory routines.<TR>
<TD>gxApHeapValidation<TD>0x0400<TD>Checks all objects in a heap for validity each time an internal memory routine is called.<TR>
<TD>gxFontHeapValidation<TD>0x0800<TD>Checks all font objects in a heap for validity each time an internal memory routine is called.<TR>
<TD>gxCheckApHeapValidation<TD>0x1000<TD>When used with <CODE>gxInternalValidation</CODE>, checks the application heap on every internal function call.<P>When used with <CODE>gxPublicValidation</CODE>, checks the application heap on every public function call.<TR>
<TD>gxCheckFontHeapValidation<TD>0x2000<TD>When used with <CODE>gxInternalValidation</CODE>, checks the font heap on every internal function call.<P>When used with <CODE>gxPublicValidation</CODE>, checks the font heap on every public function call.</TABLE>
<P>
 If you want to check the type of all objects that your application passes to public functions and also check the application heap on every public call, you can use the <CODE>gxPublicValidation</CODE> option plus the <CODE>gxTypeValidation</CODE> option plus the gxCheckApHeapValidation option for the <CODE>gxValidationLevel</CODE> parameter:<P>
<PRE>
GXSetValidation(gxPublicValidation | gxTypeValidation |
                gxCheckApHeapValidation);
</PRE>
<DL>
<DT><B>WARNING</B>
<DD>If the gxApHeapValidation or gxFontHeapValidation flag is enabled and the platform that it is running on locates the graphics memory below the bottom 14 megabytes of memory, then the addresses on the stack and master pointers that refer to QuickDraw GX objects will be scrambled. This is a method of finding internal errors that may lead to unexpected erroneous behavior. For example, if the application has a path type shape and one <CODE>long</CODE> parameter of the path data happens to exactly equal the address of a graphics object, then QuickDraw GX might scramble the one <CODE>long</CODE> of path data and the path may draw one point off of the screen. This is expected behavior. These functions can scramble addresses without knowing that the addresses are really points on a path. Since these two validation types produce these apparent bugs, an application cannot use the <CODE>gxApHeapValidation</CODE> and <CODE>gxFontHeapValidation</CODE> options to ensure that QuickDraw GX has no internal bugs. These validation types are useful in tracking down bugs related to QuickDraw GX memory management.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 For additional information about using QuickDraw GX memory, see the chapter "QuickDraw GX Memory Management."<P>
 The <CODE>GXSetValidation</CODE> function is described on <A HREF=GXEnvironment-165.html#MARKER-9-155>page 4-34</A>. The <CODE>GXGetValidation</CODE> function is described on <A HREF=GXEnvironment-166.html#MARKER-9-158>page 4-35</A>.<A NAME=MARKER-2-13></A> <A NAME=MARKER-2-91></A><A NAME=MARKER-9-8></A><A NAME=MARKER-2-83></A><A NAME=MARKER-2-15></A><A NAME=MARKER-2-105></A><P>
<A NAME=HEADING155-41></A>
<H3><A NAME=MARKER-9-96></A>Validating Objects</H3>
 <A NAME=MARKER-8-108></A>QuickDraw GX also provides separate functions that validate the parameters passed to specific objects, their structures, and any internal caches built for specific objects. <P>
 You can use the <A NAME=MARKER-2-159></A><CODE>GXValidateAll</CODE> function to check the type, structure, and internal caches built for all objects. This is an alternative to using the <A NAME=MARKER-9-7></A><CODE>GXSetValidation</CODE> function with the <CODE>gxInternalValidation</CODE> and <CODE>gxAllObjectValidation</CODE> options selected, as described in the section <A HREF=#MARKER-9-74>"Using Validation Functions" beginning on page 4-15</A>.<P>
 The following functions validate specific objects:<P>
<UL>
<LI><CODE><A NAME=MARKER-2-23></A></CODE>The <CODE>GXValidateColorSet</CODE> function checks parameters for the color space, color-value array, owner count, and tag list properties for the specified color set object. The <CODE>GXValidateColorSet</CODE> function is described on <A HREF=GXEnvironment-173.html#MARKER-9-178>page 4-38</A>.
<LI><CODE><A NAME=MARKER-2-24></A></CODE>The <CODE>GXValidateColorProfile</CODE> function checks the specified color profile object. The <CODE>GXValidateColorProfile</CODE> function is described on <A HREF=GXEnvironment-174.html#MARKER-9-181>page 4-39</A>.
<LI><CODE><A NAME=MARKER-2-232></A></CODE>The <CODE>GXValidateGraphicsClient</CODE> function checks all properties of a specified graphics client object. The <CODE>GXValidateGraphicsClient</CODE> function is described on <A HREF=GXEnvironment-179.html#MARKER-9-196>page 4-42</A>.
<LI><CODE><A NAME=MARKER-8-118></A></CODE>The <CODE>GXValidateInk</CODE> function checks parameters for the color, transfer mode, attributes, owner count, and tag list properties for a specified ink object. The <CODE>GXValidateInk</CODE> function is described on <A HREF=GXEnvironment-171.html#MARKER-9-172>page 4-37</A>.
<LI><CODE><A NAME=MARKER-9-117></A></CODE>The <CODE>GXValidateShape</CODE> function checks parameters for the type, geometry, fill, style, ink, transform, attributes, owner count, and tag list properties for a specified shape object. The <CODE>GXValidateShape</CODE> function is described on <A HREF=GXEnvironment-312.html#MARKER-9-3>page 4-36</A>.
<LI><CODE><A NAME=MARKER-2-52></A></CODE>The <CODE>GXValidateStyle</CODE> function checks parameters for the pen size, cap, join, dash, pattern, curve error, attributes, text face, text size, justification, font variations, platform, text attributes properties, run controls, run features array, glyph substitutions array, kerning adjustments, priority justification override, and glyph justification overrides array properties for the specified style object. The <CODE>GXValidateStyle</CODE> function is described on <A HREF=GXEnvironment-170.html#MARKER-9-169>page 4-36</A>.
<LI><CODE><A NAME=MARKER-9-73></A></CODE>The <CODE>GXValidateTag</CODE> function checks the parameters for the tag type, size, contents, and owner count properties for a specified tag object. The <CODE>GXValidateTag</CODE> function is described on <A HREF=GXEnvironment-175.html#MARKER-9-184>page 4-39</A>.
<LI><CODE><A NAME=MARKER-8-120></A></CODE>The <CODE>GXValidateTransform</CODE> function checks the parameters for the clip, mapping, view port list, hit-test parameters, attributes, owner count, and tag list properties for a specified transform object. The <CODE>GXValidateTransform</CODE> function is described on <A HREF=GXEnvironment-172.html#MARKER-9-175>page 4-38</A>.
<LI><CODE><A NAME=MARKER-2-74></A></CODE>The <CODE>GXValidateViewDevice</CODE> function checks parameters for the clip, mapping, bitmap, attributes, and tag list properties for a specified view device object. The <CODE>GXValidateViewDevice</CODE> function is described on <A HREF=GXEnvironment-176.html#MARKER-9-187>page 4-40</A>.
<LI><CODE><A NAME=MARKER-9-39></A></CODE>The <CODE>GXValidateViewPort</CODE> function checks parameters for the clip, mapping, dither, halftone, parent view port, child view port list, view device, attributes, owner count, and tag list properties for all view port objects. The <CODE>GXValidateViewPort</CODE> function is described on <A HREF=GXEnvironment-177.html#MARKER-9-190>page 4-40</A>.
<LI><CODE><A NAME=MARKER-2-193></A></CODE>The <CODE>GXValidateViewGroup</CODE> function checks parameters for the clip, mapping, dither, halftone, parent view port, child view port list, view device, attributes, owner count, and tag list properties of the view port object and the clip, mapping, bitmap, attributes, and tag list properties of the view device object. The <CODE>GXValidateViewGroup</CODE> function is described on <A HREF=GXEnvironment-178.html#MARKER-9-193>page 4-41</A>.<A NAME=MARKER-2-118></A><P>
</UL>
<A NAME=HEADING155-56></A>
<H3><A NAME=MARKER-9-112></A>Analyzing the Cause of Validation Errors</H3>
 <A NAME=MARKER-9-243></A><A NAME=MARKER-2-248></A>You can use the <CODE>GXGetValidationError</CODE> function to determine the function and parameter that caused the last validation error. This function works like other QuickDraw GX functions that return variable-length data. There are three steps:<P>
<OL>
<LI>Call the function to determine the length of data that will be returned. If no validation error is posted, a 0 is returned.
<LI>Allocate memory to store the data that will be returned.
<LI>Call the function a second time to obtain pointers to the function, parameter name, and parameter number that caused the validation error.<P>
</OL>
 <A HREF=#MARKER-9-116>Listing 4-1</A> gives an example of using the <CODE>GXGetValidationError</CODE> function to obtain the function and parameter that caused the last validation error. The <CODE>GXGetValidationError</CODE> function is described on <A HREF=GXEnvironment-167.html#MARKER-9-161>page 4-35</A>.<A NAME=MARKER-2-275></A><P>
<B>Listing 4-1  <A NAME=MARKER-9-116></A>Determining the function and parameter that caused the last validation error</B><P>
<PRE>
static void DisplayErrorMessage(gxGraphicsError errorID, 
long context)
{
   char buffer[255];
   void * graphicsObject;
   long argNum;

   if (GXGetValidationError(buffer, &amp;thing, &amp;argNum)) {
      GXValidationError(buffer, nil, nil);
      printf("gxValidationError: %ld (routine: %s) ",
         errorID, buffer);
      printf("(argument[%ld]: 0x081x)\n",argNum, graphicsObject);
   } else
      printf("gxGraphicsError: 0x%081x\n", errorID);
}
</PRE>
<A NAME=HEADING155-64></A>
<H3><A NAME=MARKER-9-117></A>Distinguishing Between Application Bugs and QuickDraw GX Bugs</H3>
 <A NAME=MARKER-2-260></A>All QuickDraw GX functions have been extensively tested prior to shipment. However, during your application debugging process, you may find anomalous behavior that you attribute to QuickDraw GX private functions. <P>
 Validation checking allows you to distinguish between your application bugs and QuickDraw GX bugs. If QuickDraw GX posts validation errors when internal validation is set, but not when public validation is set, it is possible that you have found an error in the QuickDraw GX internal private code. Please contact Apple Developer Technical Support and provide a detailed report of the bug encountered. For more information concerning public and internal validation modes, see the section <A HREF=#MARKER-9-77>"Controlling Validation" beginning on page 4-15</A>.<A NAME=MARKER-2-265></A><P>
<A NAME=HEADING155-67></A>
<H3>Detecting Corrupted Objects</H3>
 <A NAME=MARKER-9-190></A>Normally, there is no way for an application using the public interface to corrupt the content of an object. If an error occurs with structure validation and not with type validation, either the error is a QuickDraw GX error or the application has corrupted memory. The most probable method of corrupting memory is by calling the <CODE>GXGetShapeStructure</CODE> function and altering the content directly or by writing randomly into memory. For more information concerning type and structure validation levels, see the section <A HREF=#MARKER-9-77>"Controlling Validation" beginning on page 4-15</A>.<A NAME=MARKER-2-221></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="GXEnvironment-154.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="GXEnvironment-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="GXEnvironment-445.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="GXEnvironment-156.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="GXEnvironment-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
