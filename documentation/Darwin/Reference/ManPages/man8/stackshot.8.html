<html><head><title>Mac OS X
 Manual Page For stackshot(8)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/8/stackshot" title="Mac OS X
 Manual Page for stackshot(8)"><!-- headerDoc=man; indexgroup=Section 8; uid="//apple_ref/doc/man/8/stackshot"; name=stackshot(8) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
stackshot(1)              BSD General Commands Manual             <!-- a -->stackshot(1)<!-- /a -->

<b>NAME</b>
     <b>stackshot</b> -- capture user and kernel space stack traces, using a kernel stack trace facility

<b>SYNOPSIS</b>
     <b>stackshot</b> [<b>-D</b>] [<b>-i</b>] [<b>-f</b> <u>path</u>] [<b>-n</b> <u>number</u>] [<b>-p</b> <u>pid</u>] [<b>-B</b> <u>size</u>]

<b>DESCRIPTION</b>
     The <b>stackshot</b> daemon is used to capture stack traces for each thread on the system; this includes both
     user space and kernel stacks. The resulting view of the system is consistent.  Stack pages that are
     paged out are not captured--this caveat does not apply to kernel space stacks, which are wired. The
     stack snapshot is triggered upon pressing a special key chord; this is currently Control-Option-Com-<font color="#ffffff" class="whiteout">mand-Shift-Period&nbsp;Control-Option-Command-Shift-Period</font>
     mand-Shift-Period

     The daemon also triggers a stack snapshot upon reception of the SIGINFO signal.

     The following options are available:

     <b>-D</b>       Turn on debugging.

     <b>-i</b>       Do an immediate snapshot, and exit.

     <b>-f</b> <u>path</u>  Output the log information to the specified path.  This supercedes any preference configura-<font color="#ffffff" class="whiteout">tion&nbsp;configuration</font>
              tion (see below).

     <b>-n</b> <u>number</u>
              Limit the number of snapshots taken; the default is 1.

     <b>-p</b> <u>pid</u>   Log the stack information for the specified process-ID only.

     <b>-B</b> <u>size</u>  Specify the size of the trace buffer; the default is 52 kilobytes.

     <b>-t</b>       Attempt symbolication. Currently, this starts up a separate symbolicator thread, and signals
              that thread to begin symbolication using <a href="../man1/atos.1.html#//apple_ref/doc/man/1/atos">atos(1)</a> when a snapshot is triggered. The current
              implementation may take several seconds to perform the address-symbol translations, depending
              on the state of the system. The symbolicated trace file is appended to:
              <u>/Library/Logs/stackshot-syms.log.</u>

<b>SYMBOLICATION</b>
     Symbolication (as with the -t option, or the symstacks.rb script described below) is performed against
     the currently executing process images, which may have been either fully or partially stripped of
     debugging symbols. Additionally, kernel stacks are symbolicated against /mach_kernel, which typically
     has all local and debugging symbols stripped (as with "strip -S -x"). In either case, symbol matching
     may not always be accurate.  If in doubt, you may run the unstripped executable images, or symbolicate
     the trace file directly against the unstripped images using an alternate mechanism, such as gdb. The
     symstacks.rb script (see below) can take a "-k" argument, which specifies the location of an alternate
     kernel image to symbolicate with--this can be an unstripped kernel image. When filing bug reports, it
     is best to include both the trace file ("stackshot.log") and the symbolicated trace ("stackshot-<font color="#ffffff" class="whiteout">syms.log").&nbsp;("stackshotsyms.log").</font>
     syms.log").

<b>NOTES</b>
     The <b>stackshot</b> daemon is intended to be run by the <a href="launchd.8.html#//apple_ref/doc/man/8/launchd">launchd(8)</a> super-daemon.  It reads configuration
     information from <u>~root/Library/Preferences/com.apple.stackshot.plist</u>.  The keys it looks for are

     Trace File    Specifies the file to use.  The default is <u>/Library/Logs/stackshot.log</u>.

     Trace Server  A dictionary containing ``Host'' (as a string) and ``Port'' (as an integer) keys, for a
                   server.  If both a file and server are specified, <b>stackshot</b> will attempt to use both.
                   The server is expected to do nothing other than accept a connection, accept a stream of
                   data, and write it to a file of its choosing.

     Buffer Size   Specifies the size of the trace buffer.

<b>FILES</b>
     ~root/Library/Preferences/com.apple.stackshot.plist
                             Preference file used for configuration information.
     /System/Library/LaunchDaemons/com.apple.stackshot.plist
                             Configuration file used by <a href="launchd.8.html#//apple_ref/doc/man/8/launchd">launchd(8)</a>.
     /usr/sbin/symstacks.rb  <a href="../man1/ruby.1.html#//apple_ref/doc/man/1/ruby">ruby(1)</a> script to process the output of <b>stackshot</b> and turn symbol addresses
                             into symbol names. It reads a <b>stackshot</b> trace file from standard input or a
                             file specified with "-f" , and writes the symbolicated version to standard out-<font color="#ffffff" class="whiteout">put,&nbsp;output,</font>
                             put, or to a file specified with "-w". See caveats above regarding accuracy of
                             symbolication against stripped images. The "-k" argument to the script can
                             specify the location of a kernel image, which will be used for symbolication.
                             The "-s" argument forces the script to symbolicate kernel stacks alone, which
                             can be useful in conjunction with the "-k" argument to symbolicate kernel
                             stacks on systems which differ from the one which generated the trace file.
                             Note that symbolication is performed against currently running process images,
                             so the script must be executed on the same (or identical) system for accuracy,
                             and any processes of interest must be currently executing.

<b>SEE</b> <b>ALSO</b>
     <a href="launchd.8.html#//apple_ref/doc/man/8/launchd">launchd(8)</a>

<b>BUGS</b>
     Certain types of deadlocks (especially driver/kernel level deadlocks) may prevent triggering <b>stackshot</b>
     when the hot-key combination is pressed.

     Depending upon the type of deadlock, there may be issues accessing the filesystem and/or network, pre-<font color="#ffffff" class="whiteout">venting&nbsp;preventing</font>
     venting publication of the data once the traces are gathered.

     The daemon makes a minimal effort to ensure that the log file has space allocated, and does no process-<font color="#ffffff" class="whiteout">ing&nbsp;processing</font>
     ing afterwards. The aforementioned <a href="../man1/ruby.1.html#//apple_ref/doc/man/1/ruby">ruby(1)</a> script can be used to translate addresses to symbols. It is
     up to the user to examine the file (and perhaps send it off to someone for debugging) afterwards.

     The symbolication is not perfect, and may benefit from human scrutiny or post-processing.

Darwin                           April 2, 2008                          Darwin
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man8/stackshot.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man8/stackshot.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man8/stackshot.8.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
