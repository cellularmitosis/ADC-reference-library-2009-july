<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Handling Apple Events Sent by the Edition Manager(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING120></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-119.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-121.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-116.html"><B>Handling Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING120-0></A>
<H2><A NAME=MARKER-9-295></A><A NAME=MARKER-21-296></A>Handling Apple Events Sent by the Edition Manager</H2>
 <A NAME=MARKER-2-112></A>If your application provides publish and subscribe capabilities, it should handle the Apple events sent by the Edition Manager in addition to the required Apple events. Your application should also handle the Create Publisher event, which is described in the <A HREF=#MARKER-9-301>"Handling the Create Publisher Event"</A> section on <A HREF=#MARKER-9-301>page 4-22</A>.<P>
 The Edition Manager sends your application Apple events to communicate information about the publishers and subscribers in your application's documents. Specifically, the Edition Manager uses Apple events to notify your application <P>
<UL>
<LI>when the information in an edition is updated
<LI>when your application needs to write the data from a publisher to an edition
<LI>when your application should locate a particular publisher and scroll through the document to that location<P>
</UL>
<A NAME=HEADING120-6></A>
<H3>The Section Read, Section Write, and Section Scroll Events</H3>
 The following descriptions identify the three Apple events sent by the Edition Manager--Section Read, Section Write, and Section Scroll--and the actions they tell applications to perform.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=3>Section Read--read information into the specified section<A NAME=MARKER-2-265></A>  <TR>
<TD colspan=2>Event class<TD>SectionEventMsgClass<A NAME=MARKER-2-23></A><A NAME=MARKER-2-24></A><TR>
<TD colspan=2>Event ID<TD>SectionReadMsgID<A NAME=MARKER-2-25></A><A NAME=MARKER-2-90></A><TR>
<TD colspan=2>Required parameter<TD>&nbsp;<TR>
<TD>&nbsp;<TD>Keyword:<TD>keyDirectObject<TR>
<TD>&nbsp;<TD>Descriptor type:<TD>typeSectionH<TR>
<TD>&nbsp;<TD>Data:<TD>A handle to the section record of the subscriber whose edition contains updated information<TR>
<TD colspan=2>Requested action<TD>Update the subscriber with the new information from the edition.</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=3>Section Write--write the specified section to an edition<A NAME=MARKER-2-128></A><A NAME=MARKER-2-134></A><TR>
<TD colspan=2>Event class<TD>SectionEventMsgClass<TR>
<TD colspan=2>Event ID<TD>SectionWriteMsgID<A NAME=MARKER-21-118></A><A NAME=MARKER-21-458></A><TR>
<TD colspan=2>Required parameter<TD>&nbsp;<TR>
<TD>&nbsp;<TD>Keyword:<TD>keyDirectObject<TR>
<TD>&nbsp;<TD>Descriptor type:<TD>typeSectionH<TR>
<TD>&nbsp;<TD>Data:<TD>A handle to the section record of the publisher<TR>
<TD colspan=2>Requested action<TD>Write the publisher's data to its edition.</TABLE>

<TABLE BORDER="0" CELLPADDING=3><TH colspan=3>Section Scroll--scroll through the document to the specified section<A NAME=MARKER-2-120></A><TR>
<TD colspan=2>Event class<TD>SectionEventMsgClass<TR>
<TD colspan=2>Event ID<TD>SectionScrollMsgID<A NAME=MARKER-2-100></A><A NAME=MARKER-2-30></A><TR>
<TD colspan=2>Required parameter<TD>&nbsp;<TR>
<TD>&nbsp;<TD>Keyword:<TD>keyDirectObject<TR>
<TD>&nbsp;<TD>Descriptor type:<TD>typeSectionH<TR>
<TD>&nbsp;<TD>Data:<TD>A handle to the section record of the publisher to scroll to<TR>
<TD colspan=2>Requested action<TD>Scroll through the document to the publisher identified by the specified section record. </TABLE>
<P>
 See the chapter "Edition Manager" in this book for details on how your application should respond to these events.<A NAME=MARKER-2-230></A><A NAME=MARKER-2-133></A><A NAME=MARKER-2-134></A><P>
<A NAME=HEADING120-9></A>
<H3><A NAME=MARKER-9-301></A><A NAME=MARKER-21-302></A>Handling the Create Publisher Event</H3>
 <A NAME=MARKER-21-103></A>If your application supports publish and subscribe capabilities, it should also handle the Create Publisher event.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=3>Create Publisher--create a publisher<TR>
<TD colspan=2>Event class<TD>kAEMiscStdSuite<A NAME=MARKER-21-130></A><TR>
<TD colspan=2>Event ID<TD>kAECreatePublisher<A NAME=MARKER-2-245></A><TR>
<TD colspan=2>Required parameter<TD>None<TR>
<TD colspan=2>Optional parameter<TD>&nbsp;<TR>
<TD>&nbsp;<TD>Keyword:<TD>keyDirectObject<TR>
<TD>&nbsp;<TD>Descriptor type:<TD>typeObjectSpecifier<A NAME=MARKER-2-33></A><A NAME=MARKER-2-219></A><TR>
<TD>&nbsp;<TD>Data:<TD>An object specifier record that specifies the Apple event object or objects to publish. If this parameter is omitted, publish the current selection.<TR>
<TD colspan=2>Optional parameter<TD>&nbsp;<TR>
<TD>&nbsp;<TD>Keyword:<TD>keyAEEditionFileLoc<TR>
<TD>&nbsp;<TD>Descriptor type:<TD>typeAlias<TR>
<TD>&nbsp;<TD>Data:<TD>An alias record that contains the location of the edition container to create. If this parameter is omitted, use the default edition container.<TR>
<TD colspan=2>Requested action<TD>Create a publisher for the specified data using the specified location for the edition container. If the data isn't specified, publish the current selection. If the location of the edition isn't specified, use the default location.</TABLE>
 <A NAME=MARKER-2-304></A> <A NAME=MARKER-2-305></A> <A NAME=MARKER-21-126></A><P>
 When your application receives the Create Publisher event, it should create a publisher and write the publisher's data to an edition. The data of the publisher, and the location and name of the edition, are defined by the Apple event. If the Create Publisher event includes a <CODE>keyDirectObject</CODE> parameter, then your application should publish the data contained in the parameter. If the <CODE>keyDirectObject</CODE> parameter is missing, then your application should publish the current selection. If the document doesn't have a current selection, your handler for the event should return a nonzero result code.<P>
 If the Create Publisher event includes a <CODE>keyAEEditionFileLoc</CODE> parameter, your application should use the location and name contained in the parameter as the default location and name of the edition. If the <CODE>keyAEEditionFileLoc</CODE> parameter is missing, your application should use the default location and name your application normally uses to specify the edition container.<A NAME=MARKER-2-324></A><A NAME=MARKER-2-142></A><P>
 <A HREF=#MARKER-9-309>Listing 4-9</A> shows a handler for the Create Publisher event. This handler checks for the <CODE>keyDirectObject</CODE> parameter and the <CODE>keyAEEditionFileLoc</CODE> parameter. If either of these is not specified, the handler uses default values. The handler uses the application-defined function <CODE>DoNewPublisher</CODE> to create the publisher and its edition, create a section record, and update other data structures associated with the document. See the chapter "Edition Manager" in this book for an example of the <CODE>DoNewPublisher</CODE> function.<P>
<B>Listing 4-9  <A NAME=MARKER-9-309></A><A NAME=MARKER-21-310></A>A handler for the Create Publisher event<A NAME=MARKER-2-242></A></B><P>
<PRE>
FUNCTION MyHandleCreatePublisherEvent (theAppleEvent,
                                       reply: AppleEvent; 
                                       handlerRefcon: LongInt)
                                       : OSErr;
VAR   
   myErr:                  OSErr;
   returnedType:           DescType;
   thePublisherDataDesc:   AEDesc;
   actualSize:             LongInt;
   promptForDialog:        Boolean;
   thisDocument:           MyDocumentInfoPtr;
   preview:                Handle; 
   previewFormat:          FormatType; 
   defaultLocation:        EditionContainerSpec;
BEGIN
   MyGetDocumentPtr(thisDocument);
   myErr := AEGetParamDesc(theAppleEvent, keyDirectObject, 
                           typeObjectSpecifier, 
                           thePublisherDataDesc);
   CASE myErr OF
      errAEDescNotFound: 
      BEGIN
         {use the current selection as the publisher and set up }
         { info for later when DoNewPublisher displays preview}
         preview := MyGetPreviewForSelection(thisDocument);
         previewFormat := 'TEXT';
      END;
      noErr: 
         {use the data in keyDirectObject parameter as the }
         { publisher (which is returned in the }
         { thePublisherDataDesc variable), and set up info for }
         { later when DoNewPublisher displays preview}
         MySetInfoForPreview(thePublisherDataDesc, thisDocument, 
                             preview, previewFormat);
      OTHERWISE
      BEGIN
         MyHandleCreatePublisherEvent := myErr;
         Exit(MyHandleCreatePublisherEvent);
      END; 
   END;
   myErr := AEDisposeDesc(thePublisherDataDesc);

   myErr := AEGetParamPtr(theAppleEvent, keyAEEditionFileLoc, 
                         typeFSS, returnedType, 
                         @defaultLocation.theFile,
                         SizeOf(FSSpec), actualSize);
   CASE myErr OF
      errAEDescNotFound: 
         {use the default location as the edition container}
            myErr := MyGetDefaultEditionSpec(thisDocument, 
                                             defaultLocation);
      noErr: 
      BEGIN             {the keyAEEditionFileLoc parameter }
                        { contains a default location}
         defaultLocation.thePart := kPartsNotUsed;
         defaultLocation.theFileScript := smSystemScript;
      END;
      OTHERWISE
      BEGIN
         MyHandleCreatePublisherEvent := myErr;
         Exit(MyHandleCreatePublisherEvent);
      END; 
   END;
   myErr := MyGotRequiredParams(theAppleEvent);
   IF myErr &lt;&gt; noErr THEN
   BEGIN
      MyHandleCreatePublisherEvent := myErr;
      Exit(MyHandleCreatePublisherEvent);
   END;
   myErr := AEInteractWithUser(kAEDefaultTimeout, gMyNotifyRecPtr, 
                                 @MyIdleFunction);
   IF myErr = noErr THEN promptForDialog := TRUE
                    ELSE promptForDialog := FALSE;
   myErr := DoNewPublisher(thisDocument, promptForDialog, 
                           preview, previewFormat, 
                           defaultLocation);
   {add keyErrorNumber and keyErrorString parameters if desired}
END;
</PRE>
 Note that the MyHandleCreatePublisherEvent handler in <A HREF=#MARKER-9-309>Listing 4-9</A> uses the <CODE>AEInteractWithUser</CODE> function to determine whether user interaction is allowed. If so, the handler sets the <CODE>promptForDialog</CODE> variable to <CODE>TRUE</CODE>, indicating that the <CODE>DoNewPublisher</CODE> function should display the publisher dialog box. If not, <BR>the handler sets the <CODE>promptForDialog</CODE> variable to <CODE>FALSE</CODE>, and the <CODE>DoNewPublisher</CODE> function does not prompt the user for the location or name of the edition. For more information about <CODE>AEInteractWithUser</CODE>, see <A HREF=IAC-126.html#MARKER-9-408>"Interacting With the User,"</A> which begins on <A HREF=IAC-126.html#MARKER-9-408>page 4-47</A>. <A NAME=MARKER-2-312></A> <A NAME=MARKER-2-313></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-119.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-121.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
