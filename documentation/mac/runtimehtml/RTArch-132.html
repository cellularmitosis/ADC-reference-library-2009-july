<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>Classic 68K Stack Structure and Calling Conventions</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING132></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="RTArch-131.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-133.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="RTArch-2.html"><B>Mac OS Runtime Architectures</B></A> / <BR><DD><A HREF="RTArch-130.html"><B>Chapter 11 - Classic 68K Runtime Conventions</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING132-0></A>
<H1><A NAME=MARKER-9-23></A>Classic 68K Stack Structure and Calling Conventions</H1>
 <A NAME=MARKER-2-24></A>T<A NAME=MARKER-2-25></A>he classic 68K runtime architecture uses a stack-based parameter-passing system, as shown in <A HREF=#MARKER-9-26>Figure 11-1</A>.<P>
<B>Figure 11-1  <A NAME=MARKER-9-26></A>A 68K stack frame before and after calling a routine</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/RUN-05.jpg"> <P>
 The stack grows from high-memory addresses towards low-memory addresses. The end that grows or shrinks is usually referred to the "top" of the stack, despite the fact that it is at the lower end of memory occupied by the stack. <P>
 The boundaries of the stack are defined by two pointers:<P>
<UL>
<LI><A NAME=MARKER-2-27></A>The stack pointer (SP), which points to the top of the stack and defines its current downward limit. Operations that push data onto the stack or pop data off of it do so by adjusting the value of the stack pointer. The classic 68K runtime architecture uses the <A NAME=MARKER-2-28></A>A7 register as the stack pointer. 
<LI><A NAME=MARKER-2-29></A>The frame pointer (FP), which points to the base in memory of the current <A NAME=MARKER-2-30></A>stack frame, the area of the stack used by a routine for its parameters, return address, local variables, and temporary storage. By keeping track of the frame pointer value, the operating system can find the beginning of the stack frame when it has to pop data off the stack. The classic 68K runtime architecture uses the A6 register as the frame pointer. <P>
</UL>
 <A NAME=MARKER-2-31></A>Para<A NAME=MARKER-2-32></A>meters passed by a routine are always placed on the stack above the frame pointer, while local variables are always placed below the frame pointer. Data passed onto the stack is always aligned to 2 bytes. If you pass a single-byte parameter (such as a single character), a padding byte is added by decrementing the stack pointer by 2 bytes instead of 1 (the padding byte is the most significant byte). <A NAME=MARKER-2-33></A><P>
 The classic 68K runtime environment supports many non-standard calling conventions. For example, C calling conventions can vary depending on the type of call (some system calls have their own conventions) and the development environment. However, in C you can specify Pascal conventions for a routine by using the<A NAME=MARKER-2-34></A> <CODE>pascal</CODE> keyword. Pascal calling conventions are standardized and supported in all 68K development environments. <P>
 For example, the routine declared in C as <P>
<PRE>
int mooFunc(UInt8, double);
</PRE>
 uses C calling conventions, while <P>
<PRE>
pascal int mooFunc(UInt8, double);
</PRE>
 uses Pascal calling conventions. <P>
<DL>
<DT><B>Note</B>
<DD>These parameter passing conventions are part of Apple's standard for procedural interfaces. Object-oriented languages may use different rules for their own method calls. For example, the conventions for C++ virtual function calls may be different from those for C functions.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DL>
<DT><A HREF="RTArch-133.html#HEADING133-0">Pascal Calling Conventions</A>
<DD>
<DT><A HREF="RTArch-134.html#HEADING134-0">SC Compiler C Calling Conventions </A>
<DD>
<DT><A HREF="RTArch-135.html#HEADING135-0">Register Preservation </A>
<DD>
</DL>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="RTArch-131.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="RTArch-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="RTArch-147.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="RTArch-133.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="RTArch-3.html">&copy; Apple Computer, Inc.</A><br>11 MARCH 1997<P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML> 
