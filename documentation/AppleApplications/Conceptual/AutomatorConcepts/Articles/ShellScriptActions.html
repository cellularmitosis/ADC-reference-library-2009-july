<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Automator Programming Guide: Creating Shell Script Actions</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Creating Shell Script Actions"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40002078" title="Creating Shell Script Actions"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000418" target="_top">Apple Applications</a> &gt; <a href="../../../Automator-date.html#//apple_ref/doc/uid/TP30000440-TP30000418-TP40001673" target="_top">Automator</a> &gt; <a href="../index.html" target="_top">Automator Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="ImplementObjCAction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="CreateConversionAction.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>
        
        
        <a name="//apple_ref/doc/uid/TP40002078-BCIBAEAC" title="Creating Shell Script Actions"></a><hr /><H1>Creating Shell Script Actions</H1><p><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_388"></a><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_389"></a>You can create actions for the Automator action that are based on scripting languages with a UNIX<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_390"></a> pedigree, including shell scripts, Perl<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_391"></a>, and Python<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_392"></a>. This article explains how to create such actions. </p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_22" title="Note"></a><p><strong>Note:</strong>&nbsp;Several of the steps in developing shell script actions, such as constructing the user interface, are the same as for other kinds of actions. This article describes only those aspects of shell script action programming that are different.</p>Shell script actions were first introduced in Xcode 2.1.</p></div>
<!-- This template is being used for both PDF and HTML. -->

    
    <!-- TopicBook.pm uses this template for its miniTOCs, but needs a different title. -->
    <h4>Contents:</h4>
    
    
    <p class="blockquote">
    
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-96839">The Run Shell Script Action</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-96877">Custom Shell Script Actions</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-96903">Creating the Shell Script Action Project</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-96929-BBCIGFGA">Composing the Action View</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-96955">Automator Properties for Shell Script Actions</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-98117-BCIGHJJC">Writing the Script</a>
				
			<br/>
			
        
			
			
				<a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-98705-BCIFFEGE">Debugging and Testing Shell Script Actions</a>
				
			<br/>
			
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40002078-96839" title="The Run Shell Script Action"></a><h2>The Run Shell Script Action</h2><p><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_393"></a>You can incorporate a shell script into an Automator workflow even without having to build an action bundle. The Run Shell Script action, as with the Run AppleScript action, is an action that lets you type and execute a script; in this case, however, it’s a shell script or a Python or Perl script. <span class="content_text">“The Run Shell Script action in a workflow”</span> shows the action in a workflow that searches recursively in a Fonts folder for fonts with a specific extension.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_23" title="Note"></a><p><strong>Note:</strong>&nbsp;The Run Shell Script action shown in <span class="content_text"><a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-SW1">Figure 1</a></span> is included in the Mac OS X 10.4.2 update. It is not available in earlier versions of Mac OS X 10.4 or in Xcode 2.1.</p></div><br/><div><a name="//apple_ref/doc/uid/TP40002078-SW1" title="Figure 1The Run Shell Script action in a workflow"></a><p><a name="//apple_ref/doc/uid/TP40002078-97078" title="Figure 1The Run Shell Script action in a workflow"></a><a name="//apple_ref/doc/uid/TP40002078-97078-BBCHDDJB" title="Figure 1The Run Shell Script action in a workflow"></a><strong>Figure 1&nbsp;&nbsp;</strong>The Run Shell Script action in a workflow</p><img src = "Art/run_shell_script.gif" alt = "The Run Shell Script action in a workflow" width="473" height="493"></div><br/><p>The Run Shell Script action in this simple example runs the <code>find</code> command in the <code>bash</code> shell. In the Shell pop-up menu you can select other shells (such as <code>csh</code> or <code>zsh</code>) or Python or Perl as your scripting environment. The “Pass input” pop-up menu lets you choose input in the form of standard input (<code>stdin</code>) or as shell arguments.</p><p>The Run Shell Script action is a useful tool, especially for rapid prototyping of scripts. But it has its limitations, especially when the workflow it’s in is made available to users. Users of the workflow (unless they are power users) may introduce errors into the script if they try to change options. And if you save the workflow as an application to eliminate the possibility of user error, the action becomes even more inflexible and hence less usable.</p><p>To make shell script–based actions for which users of a workflow can select options, you need to create a custom shell script action.<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_394"></a></p><a name="//apple_ref/doc/uid/TP40002078-96877" title="Custom Shell Script Actions"></a><h2>Custom Shell Script Actions</h2><p>Shell script actions are conceptually different from AppleScript and Objective-C actions in important ways. The primary difference concerns the way input and user choices are conveyed to the action.</p><p>Instead of an input parameter, input<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_395"></a> is piped into the action via standard input (or passed as command-line arguments) and piped out of it via standard output. In addition, an action’s input and output, instead of being a list or array object, is a single string; individual items in the string (such as paths) are separated from each other by newline characters. (The newline character is the default; you can change the separating character programmatically.) The type identifier for a shell script action’s <code>AMAccepts</code> and <code>AMProvides</code> properties is always <code>com.apple.cocoa.string.</code></p><p>Because shell script actions are limited to single type of data, they might not seem to work well with other actions that accept and provide incompatible data types. For example, how can a shell script action handle input from an action that deals in Address Book records? This is where conversion actions<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_396"></a> play an important role. Conversion actions convert between one type of data and another. Automator invisibly inserts the appropriate conversion action between actions with dissimilar types in a workflow—but only if the conversion action is available. Apple provides many conversion actions in <code>/System/Library/Automator</code> (the actions with extension <code>caction</code>), but these might not be suitable for your shell script action. You many want to consider creating your own conversion actions; see <span class="content_text"><a href="CreateConversionAction.html#//apple_ref/doc/uid/TP40001514-BBCJEAHI">“Creating a Conversion Action”</a></span> for the procedure. </p><p>The choices users make in the user interface of a shell script action are conveyed to the script as environment variables<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_397"></a>. These variables correspond to the keys specified for the Parameters object-controller instance in the nib file. When you are creating the user interface, you use these keys to establish bindings between controls on the user interface and the action’s parameters property. </p><p>A shell script in an action cannot directly display localized strings in, for example, error messages. However, a shell script action, which is a loadable bundle, can contain localized nib files and can localize its visible properties, such as the action name, application, and description. See <span class="content_text"><a href="DevelopAction.html#//apple_ref/doc/uid/TP40001511-98896">“Internationalizing the Action”</a></span> for details.</p><p>Shell script actions have no direct access to the methods of the Automator framework or, for that matter, any other framework. There is no way within the script to manually synchronize the user interface and the parameters property (<code>updateParameters</code> and <code>parametersUpdated</code> methods). Neither can you implement the <code>opened</code> and <code>activated</code> methods (or corresponding AppleScript routines) to perform initialization and synchronization tasks. However, your shell script action project can include an Objective-C helper class or an AppleScript utility script that implements these methods or routines. Shell scripts can also run the <code>osascript<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_398"></a></code> tool to execute individual AppleScript scripts.</p><a name="//apple_ref/doc/uid/TP40002078-96903" title="Creating the Shell Script Action Project"></a><h2>Creating the Shell Script Action Project</h2><p>To create an Xcode project for a shell script action<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_399"></a>, start by choosing New Project from the File menu. In the New Project assistant, select Shell Script Automator Action, as shown in <span class="content_text">Figure 2</span>, and click Next.</p><br/><div><a name="//apple_ref/doc/uid/TP40002078-97566-BBCHEGJH" title="Figure 2Selecting the Shell Script Automator Action template"></a><p><a name="//apple_ref/doc/uid/TP40002078-97566" title="Figure 2Selecting the Shell Script Automator Action template"></a><strong>Figure 2&nbsp;&nbsp;</strong>Selecting the Shell Script Automator Action template</p><img src = "Art/select_shellscript_proj.gif" alt = "Selecting the Shell Script Automator Action template" width="466" height="392"></div><br/><p>In the next assistant window, enter a project name and location and click Finish. For convenience, make the name of the project the same name you want the action to have; by default, the project name is assigned to the action name and the bundle identifier. </p><p>The project window of a shell script action displays most of the items that appear in the project windows of other action types (see <span class="content_text">Figure 3</span>). These items include the required frameworks, <code>main.nib</code>, <code>Info.plist</code>, and <code>InfoPlist.strings</code>. The sole difference from other projects is the <code>main.command<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_400"></a></code> file, which holds the script (shell, Perl, or Python) that you will write. </p><br/><div><a name="//apple_ref/doc/uid/TP40002078-97607-BBCDCDHI" title="Figure 3The project window of a shell script action"></a><p><a name="//apple_ref/doc/uid/TP40002078-97607" title="Figure 3The project window of a shell script action"></a><strong>Figure 3&nbsp;&nbsp;</strong>The project window of a shell script action</p><img src = "Art/shellscript_proj_win.gif" alt = "The project window of a shell script action" width="678" height="370"></div><br/><p>The <code>main.command</code> file in the template is initialized with a simple <code>cat</code> command to pipe the input from <code>stdin</code> to <code>stdout</code>.</p><p>Before you start working on the shell script action, become familiar with the guidelines for actions, which are documented in <span class="content_text"><a href="AMDesignGuidelines.html#//apple_ref/doc/uid/TP40001510-BAJDDJAB">“Design Guidelines for Actions.”</a></span></p><a name="//apple_ref/doc/uid/TP40002078-96929" title="Composing the Action View"></a><a name="//apple_ref/doc/uid/TP40002078-96929-BBCIGFGA" title="Composing the Action View"></a><h2>Composing the Action View</h2><p>Constructing the user interface of a shell script action is a procedure that is the same as for other kinds of actions. Read <span class="content_text"><a href="DevelopAction.html#//apple_ref/doc/uid/TP40001511-96877">“Constructing the User Interface”</a></span> to learn about the procedure.</p><p>Remember that the keys you supply for bindings in the Attributes pane of the NSObjectController inspector (the Parameters instance in Interface Builder) become the environment variables that you refer to in the script (<span class="content_text">Figure 4</span>). Through bindings, the settings of the various fields, buttons, and pop-up menus are converted into the values of these environment variables.</p><br/><div><a name="//apple_ref/doc/uid/TP40002078-97745-BBCJDFAC" title="Figure 4The parameter keys in the NSObjectController inspector"></a><p><a name="//apple_ref/doc/uid/TP40002078-97745" title="Figure 4The parameter keys in the NSObjectController inspector"></a><strong>Figure 4&nbsp;&nbsp;</strong>The parameter keys in the NSObjectController inspector</p><img src = "Art/shellscript_action_keys.gif" alt = "The parameter keys in the NSObjectController inspector" width="260" height="402"></div><br/><p>If you are going to make the action available in multiple localizations, you must internationalize and localize the nib file; see <span class="content_text"><a href="DevelopAction.html#//apple_ref/doc/uid/TP40001511-98896">“Internationalizing the Action.”</a></span></p><a name="//apple_ref/doc/uid/TP40002078-96955" title="Automator Properties for Shell Script Actions"></a><h2>Automator Properties for Shell Script Actions</h2><p>The properties of shell script actions (in the <code>Info.plist</code> file) are little different than the properties of AppleScript and Objective-C actions. The differences are the following:</p><ul class="ul"><li class="li"><p>The <code>AMAccepts</code> and <code>AMProvides</code> properties take UTI identifiers of <code>com.apple.cocoa.string</code> only. </p></li><li class="li"><p>The <code>AMApplication</code>, <code>AMCategory</code>, and <code>AMIconName</code> properties are preset with the value “Terminal” in the project template. You can either keep this value or change it to something else, such as “TextEdit”.</p></li></ul><p>You set all other Automator and regular bundle properties the same as in other kinds of actions. See <span class="content_text"><a href="DevelopAction.html#//apple_ref/doc/uid/TP40001511-102207">“Specifying Action Properties”</a></span> for more information.</p><a name="//apple_ref/doc/uid/TP40002078-98117" title="Writing the Script"></a><a name="//apple_ref/doc/uid/TP40002078-98117-BCIGHJJC" title="Writing the Script"></a><h2>Writing the Script</h2><p>When you write a shell script or a Perl or Python script for an action, you do nothing different from what you normally would, except for two things:</p><ul class="ul"><li class="li"><p>You learn about the choices users have made in the action’s user interface through environment variables.</p></li><li class="li"><p>Input to the script is implicitly standard input; you handle it (usually) as lines—that is, a list of newline-terminated strings.</p></li></ul><p>The parameters of an action are the settings users have made in the controls and text fields of the action’s user interface. Actions are implemented to hold them as values in a dictionary. You access these values through keys that you specify when you establish the bindings of the action. In AppleScript and Objective-C actions the parameters dictionary is passed into the action, and the code in each case directly obtains a setting value using one of the bindings keys. Because the only thing passed into a shell script action is standard input, you must obtain the settings in another way. When a shell script action is run in a workflow, the AMShellScriptAction class converts the items in the parameters dictionary into environment variables; the name of each environment variable is a bindings key. <span class="content_text">Listing 1</span> shows how you access the environment-variable values in a script.</p><a name="//apple_ref/doc/uid/TP40002078-98133-BBCGBBEH" title="Listing 1A sample shell script for an action"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40002078-98133" title="Listing 1A sample shell script for an action"></a><strong>Listing 1&nbsp;&nbsp;</strong>A sample shell script for an action</p><div class="codesample"><table><tr><td scope="row"><pre>PATH=/bin:/usr/bin:/sbin:/usr/sbin export PATH<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>case "$sortDirection" in<span></span></pre></td></tr><tr><td scope="row"><pre>0)  dir=        ;;<span></span></pre></td></tr><tr><td scope="row"><pre>1)  dir="-r     ";;<span></span></pre></td></tr><tr><td scope="row"><pre>esac<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>case "$sortStyle" in<span></span></pre></td></tr><tr><td scope="row"><pre>0)  s=  ;;<span></span></pre></td></tr><tr><td scope="row"><pre>1)  s="-n       ";;<span></span></pre></td></tr><tr><td scope="row"><pre>esac<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># note when you use "-k", the first column is 1, not 0<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>sort $dir $s -k $sortColumn<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>exit 0<span></span></pre></td></tr></table></div><p>This shell script makes sure the <code>PATH</code> environment variable is properly set. It then interprets two environment variables in case statements and sets arguments of the <code>sort</code> command accordingly. It then executes the sort command, using the value of a third environment variable as the final command-line argument.</p><p>Some commands in shell scripts, such as <code>sort</code> in the above example, are designed to handle multiple lines of input at once. Other commands can only handle one line of input at a time. For these commands, input must be handled in a loop, such as the following:</p><div class="codesample"><table><tr><td scope="row"><pre>while read line; do<span></span></pre></td></tr><tr><td scope="row"><pre>    cp "$line" /tmp<span></span></pre></td></tr><tr><td scope="row"><pre>    echo $line<span></span></pre></td></tr><tr><td scope="row"><pre>done<span></span></pre></td></tr></table></div><p>Perl scripts and Python scripts have to follow the same general guidelines as shell scripts. <span class="content_text">Listing 2</span> shows an example of such a Perl script, which filters text based on parameters such as range of lines and range of fields.</p><a name="//apple_ref/doc/uid/TP40002078-98688-BCIIDDEI" title="Listing 2A Perl script for an action"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40002078-98688" title="Listing 2A Perl script for an action"></a><strong>Listing 2&nbsp;&nbsp;</strong>A Perl script for an action</p><div class="codesample"><table><tr><td scope="row"><pre>#!/usr/bin/env perl<span></span></pre></td></tr><tr><td scope="row"><pre># Filter Text by Position<span></span></pre></td></tr><tr><td scope="row"><pre># Pick out particular lines and fields of the input text.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Grab values we care about from the UI and make sure they're integers<span></span></pre></td></tr><tr><td scope="row"><pre>$line1 = $ENV{'firstLine'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre>$line2 = $ENV{'lastLine'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre>$f1 = $ENV{'firstField'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre>$f2 = $ENV{'lastField'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre>$sepnum = $ENV{'fieldSeparator'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre>$outputSepNum = $ENV{'outputSeparator'} + 0;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Figure out the right regex for our separator.  (whitespace, blank, tab, colon, characters)<span></span></pre></td></tr><tr><td scope="row"><pre># Later we will split the input lines on this pattern.  Splitting on "" conveniently breaks<span></span></pre></td></tr><tr><td scope="row"><pre># the line apart on character positions.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@regexes = ( "\\s+", " ", "\t",  ":", "" );<span></span></pre></td></tr><tr><td scope="row"><pre>$regex = $regexes[ $sepnum ];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># And what output separator to use  (blank, tab, colon, nothing)<span></span></pre></td></tr><tr><td scope="row"><pre>@oseps = ( " ", "\t", ":", "" );<span></span></pre></td></tr><tr><td scope="row"><pre>$osep = $oseps[ $outputSepNum ];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Grab all our input<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@lines = &lt;>;<span></span></pre></td></tr><tr><td scope="row"><pre>$linecount = $#lines + 1;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Adjust line numbers. 0 = last line, -1 = 2nd last, etc.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>if ( $line1 &lt;= 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    $line1 = $linecount - $line1;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>if ( $line2 &lt;= 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    $line2 = $linecount - $line2;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># And get them in the right order.<span></span></pre></td></tr><tr><td scope="row"><pre>if ( $line1 > $line2 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    $x = $line1; $line1 = $line2; $line2 = $x;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Output the desired lines<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>for ( $l = $line1 ; $l &lt;= $line2; $l++ ) {<span></span></pre></td></tr><tr><td scope="row"><pre>    # note we are counting the first line as 1<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    $line = $lines[$l - 1];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    if ( $f1 == 1 &amp;&amp; $f2 == 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>        print $line;<span></span></pre></td></tr><tr><td scope="row"><pre>    } else {<span></span></pre></td></tr><tr><td scope="row"><pre>        @fields = split($regex, $line);<span></span></pre></td></tr><tr><td scope="row"><pre>        $fieldcount = $#fields + 1;<span></span></pre></td></tr><tr><td scope="row"><pre>        # Adjust field numbers. 0  = last field, -1 = 2nd last, etc<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( $f1 &lt;= 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            $f1 = $fieldcount - $f1;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( $f2 &lt;= 0 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            $f2 = $fieldcount - $f2;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        # Get fields in right order too<span></span></pre></td></tr><tr><td scope="row"><pre>        if ( $f1 > $f2 ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            $x = $f1; $f1 = $f2; $f2  = $x;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        undef @out;<span></span></pre></td></tr><tr><td scope="row"><pre>        for ( $i = $f1; $i &lt;= $f2; $i++ ) {<span></span></pre></td></tr><tr><td scope="row"><pre>            push( @out, $fields[ $i - 1 ]);<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        # Output the desired fields joined by the desired output separator.<span></span></pre></td></tr><tr><td scope="row"><pre>        print join($osep, @out) . "\n";<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>exit(0);<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP40002078-98705" title="Debugging and Testing Shell Script Actions"></a><a name="//apple_ref/doc/uid/TP40002078-98705-BCIFFEGE" title="Debugging and Testing Shell Script Actions"></a><h2>Debugging and Testing Shell Script Actions</h2><p>For general advice for debugging actions, see <span class="content_text"><a href="DevelopAction.html#//apple_ref/doc/uid/TP40001511-103180">“Testing and Debugging Strategies.”</a></span></p><p>You cannot use <code>gdb</code> or any other debugger to debug shell script actions<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_401"></a>. However, you have a couple of alternatives to consider:</p><ul class="ul"><li class="li"><p>If your shell action exits with a non-zero status code, the workflow will stop and anything your action wrote to <code>stderr</code> will show up in the Automator log view.  For example, a simple, always-fail shell action might include these lines:</p><div class="codesample"><table><tr><td scope="row"><pre>echo This action always fails 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre>exit 1<span></span></pre></td></tr></table></div></li><li class="li"><p>Test your script by itself in the Terminal application. You can set environment variables to duplicate the variables that Automator would set. For example,</p><div class="codesample"><table><tr><td scope="row"><pre>$ sortDirection=1 sortStyle=0 ./main.command<span></span></pre></td></tr></table></div></li><li class="li"><p>Individual scripting languages might have their own debugging facilities. For instance, <code>bash</code> scripts can echo each line as it is about to be executed and can print the values of expanded variables in a script. If you add the following code to a script:</p><div class="codesample"><table><tr><td scope="row"><pre>set -xv<span></span></pre></td></tr></table></div><p>you can request <code>sh</code> and <code>bash</code> scripts to display a log of the commands that are actually executed. The log is written to the shell’s standard error stream (which is normally discarded by Automator).</p></li><li class="li"><p>Because only standard output is passed to the next action, so you might want to capture the log information in a separate file ( for example, <code>/tmp/myAction.log</code>) or, preferably in the console log, which is displayed by the Console application. If you add a line like the following to the script:</p><div class="codesample"><table><tr><td scope="row"><pre>exec 2>>/dev/console<span></span></pre></td></tr></table></div><p>the log information appears in the console log. As your action runs, you can view in Console every command your script is trying to execute.</p></li><li class="li"><p>You can also use the <code>printenv</code> command to show the value of all environment variables, which includes the values of action bindings.</p></li></ul><p><span class="content_text">Listing 3</span> shows the same sorting shell script in <span class="content_text"><a href="ShellScriptActions.html#//apple_ref/doc/uid/TP40002078-98133-BBCGBBEH">Listing 1</a></span> with debugging statements added.</p><a name="//apple_ref/doc/uid/TP40002078-99531-BBCDCJFI" title="Listing 3The sorting shell script for an action, with debugging statements"></a><p class="codesample"><a name="//apple_ref/doc/uid/TP40002078-99531" title="Listing 3The sorting shell script for an action, with debugging statements"></a><strong>Listing 3&nbsp;&nbsp;</strong>The sorting shell script for an action, with debugging statements</p><div class="codesample"><table><tr><td scope="row"><pre>PATH=/bin:/usr/bin:/sbin:/usr/sbin export PATH<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Turn on shell debugging, and arrange for our standard error stream<span></span></pre></td></tr><tr><td scope="row"><pre># to be redirected to the console device, where it will appear in Console.app's console log window<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>set -xv<span></span></pre></td></tr><tr><td scope="row"><pre>exec 2>/dev/console<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># We can have our own debug messages too; by adding 1>&amp;2 we are arranging for the<span></span></pre></td></tr><tr><td scope="row"><pre># output of this command to go to standard error (the console log) rather than standard out<span></span></pre></td></tr><tr><td scope="row"><pre># (which becomes the input to the next stage.)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo starting stage 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Check the value of all our environment variables - which will show us all our bindings<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>printenv 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>case "$sortDirection" in<span></span></pre></td></tr><tr><td scope="row"><pre>0)    dir=        ;;<span></span></pre></td></tr><tr><td scope="row"><pre>1)    dir="-r        ";;<span></span></pre></td></tr><tr><td scope="row"><pre>esac<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>case "$sortStyle" in<span></span></pre></td></tr><tr><td scope="row"><pre>1)    s="-n        ";;<span></span></pre></td></tr><tr><td scope="row"><pre>esac<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre># Note when you use "-k", the first column is 1, not 0<span></span></pre></td></tr><tr><td scope="row"><pre># Note that these debug statements go to standard error and thus to /tmp/log<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo About to sort input 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre>echo The command is:  sort $dir $s -k $sortColumn 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>sort $dir $s -k $sortColumn<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>echo All finished sorting 1>&amp;2<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>exit 0<span></span></pre></td></tr></table></div><p>Check the man page or other documentation for a scripting language to see what debugging facilities are available.<a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_402"></a><a name="//apple_ref/doc/uid/TP40002078-DontLinkElementID_403"></a></p>

        <br/><br/> 

        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="ImplementObjCAction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="CreateConversionAction.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2004, 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-12-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/AppleApplications/Conceptual/AutomatorConcepts/Articles/ShellScriptActions.html%3Fid%3DTP40001450-3.5&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/AppleApplications/Conceptual/AutomatorConcepts/Articles/ShellScriptActions.html%3Fid%3DTP40001450-3.5&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/AppleApplications/Conceptual/AutomatorConcepts/Articles/ShellScriptActions.html%3Fid%3DTP40001450-3.5&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>
