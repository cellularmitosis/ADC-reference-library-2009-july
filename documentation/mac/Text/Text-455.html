<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Converting Global Coordinates to Text Offsets(IM: Tx)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING455></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="Text-454.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-456.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Text-2.html"><B>Text</B></A> / <BR><DD><A HREF="Text-409.html"><B>Chapter 7 - Text Services Manager</B></A> / <A HREF="Text-425.html"><B>Text Services Manager Reference</B></A><BR><DL><DD><A HREF="Text-453.html"><B>Apple Event Handlers Supplied by Client Applications</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING455-0></A>
<H3>Converting Global Coordinates to Text Offsets</H3>
 The Position To Offset Apple event requests a client application to convert specified global coordinates to byte offsets in text. The text service component uses this Apple event for mouse tracking, in order to draw the caret, highlight text, or adjust the cursor appearance.
<TABLE BORDER="0" CELLPADDING=3><TH colspan=4><A NAME=MARKER-21-66></A>Position To Offset--Converting Global Coordinates to Text Offset (Continued)<TR>
<TD>Event class<TD>kTextServiceClass<TD>&nbsp;<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-45></A>Event ID<TD>kPos2Offset<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Requested action<TD colspan=3 rowspan=2>Convert global coordinates specified in the <CODE>keyAECurrentPoint</CODE> parameter to a byte offset. If the click is within the limits of the active input area, the offset is relative to the start of the active input area. Otherwise, the offset is relative to the start of the application's body text. The client application specifies the classification of the location of the offset in the <CODE>keyAERegionClass</CODE> return parameter.<TR>
<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TR>
<TD colspan=2>Required parameters<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Keyword:<TD colspan=2>keyAETSMDocumentRefcon<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeLongInteger<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A TSM document specifier (reference constant) supplied by the application in a prior call to the <CODE>NewTSMDocument</CODE> function <BR>(see <A HREF=Text-431.html#MARKER-9-231>page 7-50</A>). This value is associated with the TSM document affected by this event.<TR>
<TD colspan=4>Required parameters<TR>
<TD>Keyword:<TD>keyAEServerInstance<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeComponentInstance<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A component instance value created by a prior call to the Component Manager <CODE>OpenComponent</CODE> function. This value identifies the text service component.<TR>
<TD><A NAME=MARKER-2-112></A>Keyword:<TD>keyAECurrentPoint<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typePoint<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A point that contains the global coordinates that describe the current mouse position.<TR>
<TD colspan=2><B>Optional parameter</B><TD>&nbsp;<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-241></A>Keyword:<TD>keyAEdragging<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeBoolean<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A Boolean value that indicates whether the input method is currently tracking the mouse--that is, whether the user is dragging the current selection. If it is <CODE>TRUE</CODE>, the application should pin the cursor to the limits of the active input area (to avoid highlighting beyond the limits of the active input area).<TR>
<TD>Return parameters<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TR>
<TD><A NAME=MARKER-2-47></A>Keyword:<TD>keyAEOffset<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeLongInteger<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A byte offset that specifies the character corresponding to the current mouse position (<CODE>keyAECurrentPoint</CODE>). If the click is within the limits of the active input area, the offset is relative to the start of the active input area. Otherwise, the offset is relative to the start of the application's body text.<TR>
<TD><A NAME=MARKER-2-48></A>Keyword:<TD>keyAERegionClass<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeShortInteger<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>The classification of the position specified in the <CODE>keyAEOffset</CODE> parameter. Three constants define the classification:<TR>
<TD>&nbsp;<TD>Constant<TD>Value<TD>&nbsp;<TR>
<TD>&nbsp;<TD>kTSMOutsideOfBody<TD>1<TD>&nbsp;<TR>
<TD>&nbsp;<TD>kTSMInsideOfBody<TD>2<TD>&nbsp;<TR>
<TD>&nbsp;<TD>kTSMInsideOfActiveInputArea<TD>3<TD>&nbsp;<TR>
<TD>&nbsp;<TD colspan=3>A value of <CODE>kTSMOutsideOfBody</CODE> means that the offset is <BR>outside the application's body text. A value of <CODE>kTSMInsideOfBody</CODE> means that the offset is inside the body text. <CODE>kTSMInsideOfActiveInputArea</CODE> means that the offset is inside the active input area.<TR>
<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Return parameters<TD>&nbsp;<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Keyword:<TD>keyErrorNumber<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeShortInteger<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>Any errors that the application needs to return to the text service component. The application must pass Memory Manager, TextEdit, or other errors that it receives through to the component; otherwise, it should pass 0 (<CODE>noErr</CODE>).<TR>
<TD colspan=2>Optional return parameter<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Keyword:<TD>keyAELeadingEdge<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Descriptor type:<TD>typeBoolean<TD>&nbsp;<TD>&nbsp;<TR>
<TD>Data:<TD colspan=3>A Boolean value that is equivalent to the <CODE>leadingEdge</CODE> parameter <BR>of the QuickDraw <CODE>PixelToChar</CODE> function. It is <CODE>TRUE</CODE> if the specified point corresponds to the leading edge of the character whose offset is returned; it is <CODE>FALSE</CODE> if the specified point corresponds to the trailing edge of the character.</TABLE>
<P>
 For sample code that handles the Position To Offset Apple event, see <A HREF=Text-419.html#MARKER-9-166>Listing 7-8 on page 7-30</A>. <A NAME=MARKER-2-300></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Text-454.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Text-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Text-594.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Text-456.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Text-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
