<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Reading and Writing a Section(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING31></A>



<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-30.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-32.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-23.html"><B>Chapter 2 - Edition Manager</B></A> / <A HREF="IAC-26.html"><B>Using the Edition Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING31-0></A>
<H2><A NAME=MARKER-21-129></A>Reading and Writing a Section</H2>
 Your application writes publisher data to an edition. New publisher data replaces the previous contents of the edition, making the previous edition information irretrievable. Your application reads data from an edition for each subscriber within a document.<A NAME=MARKER-2-98></A><P>
 The following sections describe how to<P>
<UL>
<LI>use different formats to write to or read from an edition
<LI>open an edition to initiate writing or reading
<LI>set a format mark
<LI>write to or read from an edition
<LI>close an edition after successfully writing or reading data<P>
</UL>
<A NAME=HEADING31-8></A>
<H3><A NAME=MARKER-21-131></A>Formats in an Edition</H3>
 You can write data to an edition in several different formats. These formats are the same as scrap format types. Scrap format types are indicated by a four-character tag.<A NAME=MARKER-21-459></A><A NAME=MARKER-21-74></A><P>
 Typically, when a user copies data, you identify the scrap format types and then write the data to the scrap. With the Edition Manager, when a user decides to publish data, you identify the format types and then write the data to an edition. You can write multiple formats of the same data.<P>
 For an edition, you should write your preferred formats first. In general, to write data to an edition, your application should use either <CODE>'TEXT'</CODE> format or <CODE>'PICT'</CODE> format. This allows your application to share data with most other applications. To subscribe to an edition, your application should be able to read both <CODE>'TEXT'</CODE> and <CODE>'PICT'</CODE> files. In addition, your application can write any other private formats that you want to support.<P>
 Scrap format types are described in the chapter "Scrap Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<P>
 A few special formats are defined as constants.<P>
<PRE>
CONST kPublisherDocAliasFormat   = 'alis';{alias record from the }
                                          { edition to publisher}
      kPreviewFormat             = 'prvw';{'PICT' thumbnail }
                                          { sketch}
      kFormatListFormat          = 'fmts';{lists all available }
                                          { formats}
</PRE>
 The <CODE>kPublisherDocAliasFormat</CODE> (<CODE>'alis'</CODE>) format is written by the Edition Manager. It is an alias record from the edition to the publisher's document. Appended to the end of the alias is the section ID of the publisher, which the Edition Manager uses to distinguish between multiple publishers to a single edition. You should discourage users from making multiple copies of the same publisher. See <A HREF=IAC-525.html#MARKER-9-421>"Duplicating Publishers and Subscribers" on page 2-58</A> for detailed information.<P>
 In addition to writing a publisher's data to an edition in the <CODE>'TEXT'</CODE> format or <CODE>'PICT'</CODE> format, your application can also write data to an edition in the <CODE>kPreviewFormat</CODE> (<CODE>'prvw'</CODE>) format. If you provide a <CODE>'prvw'</CODE> format in an edition, the Edition Manager uses it to display a preview of the edition data in the preview area of the subscriber dialog box. The <CODE>'prvw'</CODE> format has the same format as a <CODE>'PICT'</CODE> file. To draw a preview in the <CODE>'prvw'</CODE> format, the Edition Manager calls <CODE>DrawPicture</CODE> with a rectangle of 120 by 120 pixels. (See <I>Inside Macintosh: Imaging</I> for more information about <CODE>DrawPicture</CODE>.) Your application should provide data in a <CODE>'prvw'</CODE> format so that the data displays well in a rectangle of this size. Your application can also use this preview to display subscriber data within a document (to save space).<P>
 If your application does not provide a preview in the <CODE>'prvw'</CODE> format for an edition, the Edition Manager attempts to provide a preview by using the edition's <CODE>'PICT'</CODE> format. To draw a preview in the <CODE>'PICT'</CODE> format, the Edition Manager examines the picture's bounding rectangle and calls <CODE>DrawPicture</CODE> with a rectangle that scales the picture proportionally and centers it in a 120-by-12-pixel area. <P>
 The <CODE>kFormatListFormat</CODE> (<CODE>'fmts'</CODE>) format is a virtual format that is read but never written. It is a list of all the formats and their lengths. Applications can use this format in place of the <CODE>EditionHasFormat</CODE> function (described in <A HREF=IAC-33.html#MARKER-9-213>"Choosing Which Edition Format to Read" on page 2-41</A>), which provides a procedural interface to determine which formats are available.<P>
 If your application can read two or more of the available formats, use <CODE>'fmts'</CODE> to determine the priority of these formats for a particular edition. The order of <CODE>'fmts'</CODE> reflects the order in which the formats were written.<P>
 The <CODE>FormatsAvailable</CODE> data type defines a record for the <CODE>'fmts'</CODE> format.<A NAME=MARKER-9-76></A><P>
<PRE>
TYPE FormatsAvailable = ARRAY[0..0] OF
   RECORD
      theType:    FormatType;    {format type for an edition}
      theLength:  LongInt;       {length of edition format }
                                 { type}
   END;
</PRE>
 For example, an edition container may have a format type <CODE>'TEXT'</CODE> of length 100, and a format type <CODE>'styl'</CODE> of length 32. A subscriber to this edition can open it and then read the format type <CODE>'fmts'</CODE> to list all available formats. In this example, it returns 16 bytes: <CODE>'TEXT'</CODE> $00000064 <CODE>'styl'</CODE> $00000020.<A NAME=MARKER-2-243></A><A NAME=MARKER-0-391></A><P>
<A NAME=HEADING31-23></A>
<H3><A NAME=MARKER-21-137></A>Opening an Edition</H3>
 For a publisher, use the <CODE>OpenNewEdition</CODE> function to initiate the writing of data to an edition. (Note that the edition container must already exist before you initiate writing; see <A HREF=IAC-32.html#MARKER-9-175>"Creating the Edition Container" beginning on page 2-32</A>.)<A NAME=MARKER-2-80></A><A NAME=MARKER-2-73></A><P>
<PRE>
err := OpenNewEdition(publisherSectionH, fdCreator,
                      publisherSectionDocument, refNum);
</PRE>
 The <CODE>publisherSectionH</CODE> parameter is the publisher section that you are writing to the edition. The <CODE>fdCreator</CODE> parameter is the Finder creator type of the new edition. (The edition container file already has a creator type; you can specify the same creator type or establish a new creator type for the edition.)<P>
 The <CODE>publisherSectionDocument</CODE> parameter specifies the document that contains the publisher. This parameter is used to create an alias from the edition to the publisher's document. If you pass <CODE>NIL</CODE> for <CODE>publisherSectionDocument</CODE>, an alias is not made in the edition file. The <CODE>refNum</CODE> parameter returns the reference number for the edition.<P>
 For a subscriber, use the <CODE>OpenEdition</CODE> function to initiate the reading of data from <BR>an edition.<A NAME=MARKER-2-370></A><P>
<PRE>
err := OpenEdition(subscriberSectionH, refNum);
</PRE>
 The <CODE>subscriberSectionH</CODE> parameter is a handle to the section record for a given section. The <CODE>refNum</CODE> parameter returns the reference number for the edition.<P>
 The user may rename or move the edition in the Finder. Before writing to or reading data from an edition, the Edition Manager verifies the name of the edition. This process is referred to as <I>synching</I> or synchronization. Synching ensures that the Edition Manager's existing edition names correspond to the Finder's existing edition names by updating the control block.<A NAME=MARKER-2-259></A><P>
<A NAME=HEADING31-32></A>
<H3><A NAME=MARKER-2-143></A>Format Marks</H3>
 Each format has its own mark. The mark indicates the next position of a read or write operation. Initially, a mark automatically defaults to 0. After reading or writing data, the format mark is set past the last position written to or read from. The mark is similar to the File Manager's current read or write position marker for a data fork. Any time that an edition is open (after calling the <CODE>OpenEdition</CODE> or the <CODE>OpenNewEdition</CODE> function), any of the marks for each format can be queried or set.<A NAME=MARKER-2-261></A> <P>
 To set the current mark for a section format to a new location, use the <CODE>SetEditionFormatMark</CODE> function.<A NAME=MARKER-2-262></A><P>
<PRE>
err := SetEditionFormatMark(whichEdition, whichFormat,
                            setMarkTo);
</PRE>
 To get the current mark for a format in an edition file, use the <CODE>GetEditionFormatMark</CODE> function.<A NAME=MARKER-2-263></A><P>
<PRE>
err := GetEditionFormatMark(whichEdition, whichFormat,
                            currentMark);
</PRE>
<A NAME=HEADING31-38></A>
<H3><A NAME=MARKER-9-146></A><A NAME=MARKER-21-147></A>Reading and Writing Edition Data</H3>
 The Edition Manager allows you to read or write data a few bytes at a time (as with a data fork of a Macintosh file) instead of in one block (as with the Scrap Manager). You can read sequentially by setting the mark to 0 and repeatedly calling read, or you can jump to a specific offset by setting the mark there. The Edition Manager also adds the capability to stream multiple formats by keeping a separate mark for each format. This allows you to write a few bytes of one format and then write a few bytes of another format, and so forth.<A NAME=MARKER-2-266></A><A NAME=MARKER-2-64></A><P>
 Once you have opened the edition container for a particular publisher, you can begin writing data to the edition. Use the <CODE>WriteEdition</CODE> function to write publisher data to an edition.<A NAME=MARKER-2-267></A><A NAME=MARKER-2-292></A><P>
<PRE>
err := WriteEdition(whichEdition, whichFormat, buffPtr, buffLen);
</PRE>
 The <CODE>WriteEdition</CODE> function writes the specified format (beginning at the current mark for that format type) from the buffer pointed to by the <CODE>buffPtr</CODE> parameter up to <CODE>buffLen</CODE> bytes. <P>
 After you open the edition container for a subscriber and determine which formats to read, use the <CODE>ReadEdition</CODE> function to read edition data.<A NAME=MARKER-21-293></A><P>
<PRE>
err := ReadEdition(whichEdition, whichFormat, buffPtr, buffLen);
</PRE>
 The <CODE>ReadEdition</CODE> function reads the data with the specified format (<CODE>whichFormat</CODE>) from the edition into the buffer. The <CODE>ReadEdition</CODE> function begins reading at the current mark for that format and continues to read up to <CODE>buffLen</CODE> bytes. The actual number of bytes read is returned in the <CODE>buffLen</CODE> parameter. Once the <CODE>buffLen</CODE> parameter returns a value smaller than the value you have specified, there is no additional data to read, and the <CODE>ReadEdition</CODE> function returns a <CODE>noErr</CODE> result code. <A NAME=MARKER-2-59></A><A NAME=MARKER-21-294></A><P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-2-296></A>The Translation Manager (if it is available) attempts implicit translation under certain circumstances. For instance, it does so when your application attempts to read from an edition a format type that is not in the edition. In this case, the Translation Manager attempts to translate the data into the requested format. For more information, see the chapter "Translation Manager" in <I><A HREF="../MoreToolbox/MoreToolbox-2.html">Inside Macintosh: More Macintosh Toolbox</A></I>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING31-47></A>
<H3><A NAME=MARKER-9-156></A><A NAME=MARKER-21-157></A>Closing an Edition</H3>
 When you are done writing to or reading data from an edition, call the <CODE>CloseEdition</CODE> function.<A NAME=MARKER-2-365></A><A NAME=MARKER-9-14></A><P>
<PRE>
err := CloseEdition(whichEdition, successful);
</PRE>
 Each time a user edits a publisher within a document, you must update the modification date in the section record (even if the data is not yet written). When the update mode is set to Manually, the user can compare the modification dates for a publisher and its edition in the publisher options dialog box. One modification date indicates when the publisher last wrote data to the edition, and the other modification date indicates when the publisher section was last edited.<P>
 If the <CODE>successful</CODE> parameter for a publisher is <CODE>TRUE</CODE>, the <CODE>CloseEdition</CODE> function makes the newly written data available to subscribers and sets the modification date in the <CODE>mdDate</CODE> field of the edition to correspond to the modification date of the publisher's section record. If the two dates differ, the Edition Manager sends a Section Read event to all current subscribers.<P>
 If the <CODE>successful</CODE> parameter for a subscriber is <CODE>TRUE</CODE>, the <CODE>CloseEdition</CODE> function sets the modification date of the subscriber's section record to correspond to the modification date of the edition.<P>
 If you cannot successfully read from or write data to an edition, set the <CODE>successful</CODE> parameter to <CODE>FALSE</CODE>. For a publisher, data is not written to the edition, but it should still be saved with the document that contains the section. When the document is next saved, data can then be written to the edition. See <A HREF=IAC-74.html#MARKER-9-445>"Closing an Edition After Reading or Writing" on page 2-88</A> for additional information on the <CODE>CloseEdition</CODE> function.<A NAME=MARKER-21-19></A><A NAME=MARKER-2-312></A><A NAME=MARKER-2-72></A><P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-30.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-32.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
