<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css">   <title>Technical Note TN1086: Power Management &amp; The Energy Saver API</title>    <meta name="keywords" content="Mac OS 8 energy saver services api extension ESRefreshSettings ESSavePreferences">    <meta name="Description" content="Technical Note TN1086: This Technical Note discusses howto communicate with the                                    Macintosh Energy Saver Extension through the Energy                                    Services API and is importantfor developers who wish                                    to access Mac OS power management features from their                                    applications. This Notealso includes the public interfaces for the                                    Energy Services API. "><meta name="categories" content="Hardware"><meta name="week-posted" content="Nov 25, 1996 - Dec 6, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002927" title="Power Management & The Energy Saver API"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxHardwareDrivers-date.html">Hardware & Drivers</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/HardwareDrivers/index.html" target="_blank">Reference Library > Hardware & Drivers</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1086</div>
<div id="pageheadsub">Power Management &amp; The Energy Saver API</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --> <table width="600" cellpadding="0" cellspacing="0" border="0">	<tr>		<td width=300 valign="top" align=left scope="row">			<table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>				</tr>				<tr bgcolor="#e6e6e6">					<td background="images/tnmenubody.gif" width=300 align=left>						<span id="menutitle">							CONTENTS                             <br>                            <br>						</span>					</td>				</tr>				<tr bgcolor="#e6e6e6">					<td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><p id="menutext"><A HREF = "#C1">Energy Saver Overview</A><BR><BR>                  <A HREF = "#C2">Energy Services Access</A><BR><BR>                  <A HREF = "#C5">Energy Services API</A><BR><BR>                     <A HREF = "#C6">The ESGlobals Structure</A><BR><BR>                        <A HREF = "#C10">ESLoadPreferences</A><BR><BR>                        <A HREF = "#C20">ESGetPreferences</A><BR><BR>                        <A HREF = "#C30">ESSetPreferences</A><BR><BR>                        <A HREF = "#C40">ESRefreshSettings</A><BR><BR>                        <A HREF = "#C50">ESSavePreferences</A><BR><BR>                        <A HREF = "#C60">ESAddNoteProc</A><BR><BR>                        <A HREF = "#C70">ESRemoveNoteProc</A><BR><BR>                        <A HREF = "#C75">Energy Saver Notification Function</A><BR><BR>                        <A HREF = "#C80">ESRestoreDefaults</A><BR><BR>                        <A HREF = "#C90">ESGetUnsavedFolder</A><BR><BR>                        <A HREF = "#C100">ESSetUnsavedFolder</A><BR><BR>                        <A HREF = "#C110">ESGetINITVersion</A><BR><BR>                  <A HREF = "#Summary">Summary</A><BR><BR>  <A HREF = "#References">References</a><BR><BR>    <A HREF="#Downloads">Downloadables</A></p>                  <!-- end_toc --> 								</td>				</tr>				<tr>					<td width=300 align=left scope="row">						<img src="images/tnmenubottom.gif" alt="" width=300 height=16>					</td>				</tr>			</table>		</td>		<td width=300 valign="top" align=left>			<!-- begin_intro_text -->        <P id = "introtext">In an effort to         provide a consistent method of controlling the various power         conservation hardware and software features implemented on         the Macintosh platform, Apple has         introduced the Energy Saver system.</P>          <P id = "introtext">         In addition to providing developers with a standard way to control          power management features such as display sleep/dimming, hard drive spindown,          idle shutdown or sleep, the Energy Services API also provides a consistent way          to synchronize the Human Interfaces for multiple concurrent applications          that need to access these features. </P>                  <P id = "introtext">This Note discusses how to communicate with the Macintosh          Energy Saver Extension through the Energy Services API and          is important for developers who wish to access Mac OS power          management features from their applications.</P>                  <P id = "introtext">This Note also includes the public interfaces for the Energy Services API.</P><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Dec 06 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_header_box --> <BR><BR><hr width=500 align=center>          <BR><BR> <!-- begin_content --><A NAME="C1"></A>              <H2>Energy Saver Overview</H2>                  <P>Energy Saver provides a consistent method of controlling         the various power conservation hardware and software          features implemented on the Macintosh platform.</P>                 <P>Although the features it supports vary depending on the        machines' capabilities, Energy Saver typically attempts to reduce power        consumption by controlling such operations as: </P>                  <UL>            <LI><B>Display Sleep/Dimming</B> -             by reducing the power requirements to the display monitor.</li>                        <LI><B>Hard Drive Spindown</B> -  by             reducing power by spinning down (removing power)             the hard disk drive spindle motor.</li>                        <LI><B>Idle Shutdown</B> -  by             programatically turning off power to the computer             without losing any data.</li>                        <LI><B>Idle Sleep</B> - Enter a reduced power requirement            state from which rapid recovery can be made when waking            up. Note that the sleep state differs according to the            hardware capabilities present in the machine.</li>                        <LI><B>Scheduled Startup/Shutdown</B> - Scheduled startup            is used to restart the system at a predetermined time.            When used in  conjunction             with scheduled shutdown, document autosave, and            bookmarking, these can offer a substantial savings in            energy requirements while providing a convenient means of            restarting the system.</li>                        <LI><B>Document AutoSave</B> - Document autosave provides            the means to automatically save open untitled or unsaved            documents at system shutdown time without requiring user            intervention or confirmation.</li>                        <LI><B>Wakeup Sound</B>- A user-configurable sound to be            played when the system is waking up from sleep mode. Since             the monitor is typically dimmed, the wake-up sound is            the only means of determining if the system is currently active.</li>         </UL>         <p>Even though the majority of action is handled by either the Mac OS PowerManager or various Macintosh power conservation hardware, the EnergySaver is the method used to provide the user with a mechanism fordetermining when and how the various actions are to occur.</p><p>The Energy Services API also provides a way to synchronize the HumanInterfaces for multiple concurrent applications that need to access thepower management features. </p>         <H3>Components of the Energy Saver</H3>                  <P>Energy Saver is actually composed of two separate         components: a system extension and a control panel.</P>                  <UL>            <LI><B>Control panel</B> - The control panel manipulates            the settings that are stored            in system memory and a preference file.</li>                        <LI><B>Energy Saver Extension</B> - The extension uses            the settings stored in the preference file to direct            desired energy-saving behavior.</li>         </UL>                  <P>Figure 1 provides an overview of          the Energy Saver components.</p>                  <P ALIGN=CENTER><img src="images/tn1086_001.gif" width=457 height=272 border=0 align=bottom alt=""><br>         <B>Figure 1</b>. Energy Saver Overview</P>                         <BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>                                    The Energy Saver control panel is not really a                  control panel. It is an application with a special                  signature of 'APPC', which, to the Finder in                  systems after Systems 7.5.2, is used to allow                  applications dropped on the System Folder to be                  automatically placed into the Control Panel.</P>                                    <P>This allows the developer to construct control                  panels in the same manner as an application but                   permits the Finder to do its auto-placement function.</P></TD></TR></TABLE></CENTER><BR><P><A HREF="#top">Back to top</A></p><A NAME="C2"></A>         <H2>Energy Services Access</H2>                  <P>Applications can safely use the same         mechanism to  manipulate the         Energy Saver preference file as the Energy Saver control         panel. This is accomplished through the Energy Services API.         The purpose of this API is to provide homogenous support for         high-level power management features that are not provided         by the Power Manager, as well as provide standardized         preference support for power manager functions that do not         have persistent PRAM settings.</P>                  <P>The Energy Saver Extension provides auto power on/off         features for all Macs with an Egret or Cuda         microcontrollers. In addition, it will manage preferences         for Screen dimming, Hard disk spin down, sleep mode, and         options for all these features. There are calls that can be         used to obtain and set the preferences, as well as calls to         activate the settings in the preferences passed.</P>                  <P>Whenever possible, application developers should use this          functionality instead of creating their own from scratch, at          least to the extent of updating the preferences, so that other          applications and control         panels will reflect user choices made in all applications.</p><P><A HREF="#top">Back to top</A></p><A NAME="C3"></A>         <H2>Determining If Your Mac Supports         the Energy Services API</H2>                 <P>The proper way to determine if a particular Macintosh model        supports the Energy Services API is to use the Gestalt function to        check for the <b>'wnkl'</b> selector, then check the response for non-nil         value. This will indicate that the Energy Services API is loaded.</p><A NAME="C4"></A>         <H3>Calling the Energy Services API</H3>             <P>    Once you have established the existence of the Energy Services Manager you can    access the energy services API via the  gestalt selector <code>'wnkl'</code> response value.     The response is a Handle to a data structure whose first field is a    pointer to the Main routine. The interface to this routine is:     </P>    <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    typedef pascal long (*ESRoutineCallPtr)(short selector, long parm1, long parm2);    </pre>	</TD></TR></TABLE></CENTER>    <p>    To facilitate developer usage, the <b><code>EnergyServPubLib.c</code></b>    and <b><code>EnergyServPub.h</code></b> files are provided with this    document and and should be used to access to the Energy Services API. </p>    <p>    Calling the <code>ESGetINITVersion</code> function from the    EnergyServPubLib is the recomended way to determine if the Energy    Services API is loaded and available. The interface code will perform    the proper safety checks.    </p>    <P><A HREF="#top">Back to top</A></p><A NAME="C5"></A>      <H2>Energy Services API</H2>     <A NAME="C6"></A>         <H3>The ESGlobals Structure</H3>                  <P>The Energy Saver Extension maintains a set of preferences            globals. These globals are defined in the <code>ESGlobals</code>            structure as follows: </P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>typedef struct {    short           version;                // data structure version (1)    long            EnergySaverFeatures;    // ES features (not used yet)// Idle Sleep &amp; ShutDown Timing    unsigned long   dimIdleTime;        // minutes before screen sleeps    unsigned long   spinDownIdleTime;   // minutes before HD spins down                                        //   desktops must be &gt;30    unsigned long   sleepIdleTime;      // minutes prior to system sleep    short           idleFlags;          // Idle time features supported                                        //  0001 = Enable dimIdleTime                                        //  0002 = Enable spinDownIdleTime                                        //  0008 = ShutDown instead of sleep                                        //  0010 = Never Spindown disk                                        //  0020 = Restart after powerfail    short           reserved1;    short           reserved2;// Schedule Sleep &amp; Shut Down//  These times are in minutes from midnight (actually 12: 00: 01 AM )//  these fileds are only used by the Energy Saver application HI.//  your application should use the SDxxxTime and  SWUxxxTime fields//  to maniupulate the shutdown and Wakeup time    unsigned long   mainWUTime;             // Time computer starts up    unsigned long   mainSDTime;             // Time computer shuts down// bit fields telling which day of the week Wakeup or Shutdown is enabled    short           WUFields;   //  Startup    short           SDFields;   //  Shutdown                                    // Monday    = 0x0001                                    // Tuesday   = 0x0002                                    // Wednesday = 0x0004                                    // Thursday  = 0x0008                                    // Friday    = 0x0010                                    // Saturday  = 0x0020                                    // Sunday    = 0x0040                                    // EveryDay  = 0x007F                                    // Enabled   = 0x0080// The following fields let you specify different times of the day// for startup and shutdown for each individual day.  If you are not// going to allow specific daily schedules. then set all WU's to// mainWUTime and all SD fields to mainSDTime.// Shutdown Time    unsigned long   SDMonTime;    unsigned long   SDTueTime;    unsigned long   SDWedTime;    unsigned long   SDThuTime;    unsigned long   SDFriTime;    unsigned long   SDSatTime;    unsigned long   SDSunTime;// Wakeup Time    unsigned long   WUMonTime;    unsigned long   WUTueTime;    unsigned long   WUWedTime;    unsigned long   WUThuTime;    unsigned long   WUFriTime;    unsigned long   WUSatTime;    unsigned long   WUSunTime;// Sleep Prefs Info stuff    short           reserved3;    short           WUSoundResID;       // ID of the 'snd ' to play on wakeup    short           reserved4;// Startup Prefs Info    short           reserved5;    short           AppFlags;           // Always set to 0 in new pref file.    short           NonComplianceFlag;  // Set if machine sleeps over 30 watts// Shutdown Prefs Info    short           SDIdleTime;    short           SDNotifyFlags;      // Notification Options                                        //  0020 = Notify on Shutdown                                        //  0001 =  Blinking icon                                        //  0002 =  Text message                                        //  0004 =  Play snd                                        //  0008 =  save files                                        //  8008 =  Dont save on sleep                                        //  0400 = Play snd on Wakeup                                        //  0800 = Wakeup on Ring detect                                        //  1000 = Blink pwr light (portables)                                        //  2000 = mute sounds when asleep    short           SDNotifyDelayTime;    short           SDSoundResID;// ID of the 'snd ' to play on Shutdown    short           reserved6;    short           reserved7;// Energy Saver General prefs info    long            reserved8;    Boolean         reserved9;} ESGlobals, *ESGlobalsPtr, **ESGlobalsHand;</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></p><A NAME="C10"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left"><H3>ESLoadPreferences</H3><BLOCKQUOTE>            <p><code>ESLoadPreferences</code> reloads the current settings fromthe preferences file and updates the Energy ServicesGlobals. It also returns a copy of the settings for your use.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESLoadPreferences(ESGlobalsPtr thePrefs);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>thePrefs</P>                  </TD><td valign=top align=left>                     <P>A pointer to the ESGlobals structure</p>                  </TD></TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>         <BLOCKQUOTE>            <p>File Read Errors, Memory Errors, ES Errors</p></BLOCKQUOTE>                  <H4>IMPORTANT</H4>         <BLOCKQUOTE>            <p>This is called by the Energy Saver Extension at system            startup time. Your application should never have            to make this call unless you intend to revert back to the            saved preference settings.</p>                        <P><CODE>ESLoadPreferences</CODE> will not update the            state of the machine. After             making this call, you need to call            <CODE>ESRefreshSettings()</CODE> in            order to make the read in settings take effect.</P></BLOCKQUOTE>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C20"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESGetPreferences</H3>         <BLOCKQUOTE>            <p><code>ESGetPreferences</code> returns a copy of            the current settings for your use. This is the normal            call an application will make to get the current user            settings for all the energy services information.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESGetPreferences(ESGlobalsPtr thePrefs);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>thePrefs</p>                  </TD><td valign=top align=left>                     <P>A pointer to the ESGlobals structure</p>                  </TD></TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>         <BLOCKQUOTE>            <p>Memory Errors, ES Errors</p></BLOCKQUOTE></TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C30"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESSetPreferences</H3>         <BLOCKQUOTE>            <p><code>ESSetPreferences</code> copies the passed settings            to the Energy Services globals.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESSetPreferences(ESGlobalsPtr thePrefs);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE><BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>thePrefs</p>                  </TD><td valign=top align=left>                    <P> A pointer to the ESGlobals structure</p>                  </TD>               </TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>         <BLOCKQUOTE>            Memory Errors, ES Errors</BLOCKQUOTE>                  <H4>IMPORTANT</H4>         <BLOCKQUOTE>            <p><code>ESSetPreferences</code> will NOT call the Power Manager to make            the settings effective, nor will it set new startup and            shutdown times. After making this call, you need to call            <CODE>ESRefreshSettings()</CODE> to cause the new settings to take effect.</p></BLOCKQUOTE>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C40"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESRefreshSettings</H3>         <BLOCKQUOTE>            <p><code>ESRefreshSettings</code> will cause the current settings to be            activated and will make all necessary power manager calls            to cause them to be active. In addition, it will install            whatever startup and shutdown tasks need to be installed            to act on the current set of notifications.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESRefreshSettings();</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>                  <H4>RESULT CODE</H4>         <BLOCKQUOTE>           <p> ES Errors</p></BLOCKQUOTE>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C50"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESSavePreferences</H3>         <BLOCKQUOTE>            <p><code>ESSavePreferences</code> performs three operations: it            calls <code>ESSetPreferences()</code> to            transfer the passed settings, then <code>ESRefreshSettings()</code> to            make them active, and lastly it             saves the settings out to the preferences file so they            remain consistent over boots. This is the normal call an            application will make when it wants to make a persistent            update to the Energy services settings.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESSavePreferences(ESGlobalsPtr thePrefs);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>thePrefs</p>                  </TD><td valign=top align=left>                     <P>A pointer to the ESGlobals structure</p>                  </TD></TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>         <BLOCKQUOTE>            File Errors, Memory Errors, ES Errors</BLOCKQUOTE>                 <H4>IMPORTANT</H4>         <BLOCKQUOTE>           <p> When specifying <b>snd</b> resources in the <code>WUSoundResID</code>             or <code>SDSoundResID</code> field of <code>ESGlobals</code> record,             you should ensure that those resources are in the current resource chain.             This is important because  <code>ESSavePreferences</code> will cause             them to be loaded, detached and copied into System Heap.</p></BLOCKQUOTE></TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C60"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESAddNoteProc</H3>         <BLOCKQUOTE>            <p>You can use the <CODE>ESAddNoteProc</CODE> to install an            Energy Saver notification response procedure. This            notfifier can be used to inform your application that the            energy saver prefs are being read or written.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESAddNoteProc(ESNotifyProcPtr theProc, long data);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>theProc</p>                  </TD><td valign=top align=left>                     <P>A pointer to a notification response procedure</p>                  </TD></TR>               <TR>                  <td width=100 align=left>                     <P></p>                  </TD><td align="left">                     <P></p>                  </TD></TR>               <TR>                  <td valign=top width=100 align=left>                     <P>data</p>                  </TD><td valign=top align=left>                     <P>A user defined ref to pass to the data procedure</p>                  </TD></TR>               </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            ES Errors         </p>                  <H4>SEE ALSO</H4>                  <p>            The Energy Saver Notification and <code>ESRemoveNoteProc</code> function.         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C70"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESRemoveNoteProc</H3>         <BLOCKQUOTE>            <p>You can use the <CODE>ESRemoveNoteProc</CODE> to remove            an Energy Saver notification response procedure.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESRemoveNoteProc(ESNotifyProcPtr theProc);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>theProc</p>                  </TD><td valign=top align=left>                     <P>A pointer to a notification response procedure</p>                  </TD></TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            ES Errors         </p>                  <H4>SEE ALSO</H4>                  <p>            The Energy Saver Notification and ESAddNoteProc function.         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C75"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>Energy Saver Notification Function</H3>         <BLOCKQUOTE>           <p> Once installed by the <CODE>ESAddNoteProc</CODE>            function, your notification procedure will be called when            any application attempts to access the ES prefs.</p>                        <P>The notifier will be called with the selector            <CODE>xNoteESDataReq</CODE> whenever the Energy Saver            prefs are being read but before the application is            returned to them.</P>                        <P>You are also called when someone copies new prefs to            the Energy Saver Extension with a            <CODE>xNoteNewESData</CODE> selector. You then get a            chance to change the data that they have copied Globals,            but you get to it before it is applied.</P>                        <P>This allows your application to dynamically update the            display of the ESGlobals or to filter data values.</P></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>pascal long MyESNotifyProc (short selector, ESGlobalsPtr theData);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>selector</p>                  </TD><td valign=top align=left>                     <P>A value indicating the type of activity that                     has occurred. See the description below for the                     meaning of this field.</p>                  </TD></TR>               <TR>                  <td width=100 align=left>                     <P></p>                  </TD><td align="left">                     <P></p>                  </TD></TR>               <TR>                  <td valign=top width=100 align=left>                     <P>thePrefs</p>                  </TD><td valign=top align=left>                     <P>A pointer to the ESGlobals structure</p>                  </TD></TR>               </TABLE></BLOCKQUOTE>                  <H4>DESCRIPTION</H4>         <BLOCKQUOTE>            <p>The valid types of activity are: </p>                        <TABLE BORDER=1 CELLPADDING=1>               <TR>                  <TH>                     <P>Value name</P>                  </TH><TH>                     <P>Value</P>                  </TH><TH>                     <P>Description</P>                  </TH></TR>               <TR>                  <td align="left">                     <P><CODE>xNoteNewESData</CODE></p>                  </TD><TD align="center" align="left">                     <P ALIGN=CENTER>1</p>                  </TD><td align="left">                     <P>New ESGlobals written out.</p>                  </TD></TR>               <TR>                  <td align="left">                     <P><CODE>xNoteESDataReq</CODE></p>                  </TD><TD align="center" align="left">                     <P>2</p>                  </TD><td align="left">                     <P>ESGlobals are being requested.</p>                  </TD></TR>            </TABLE>            </BLOCKQUOTE>                  </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C80"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESRestoreDefaults</H3>         <BLOCKQUOTE>            <p><CODE>ESRestoreDefaults</CODE> is used to restore the            system to the machine-dependent default settings as            stored in the extension resource data. Use this call            whenever you want to return the Energy Saver            back to the installed default settings.</p>                        <P>You also get a copy of the <code>ESGlobals</code> so that you can            see what those defaults are. Getting the <code>ESGlobals</code> is            convenient so that you can update your HI to reflect the            current machine state.</P>                        <P>One possible use for this is in response to a "Apple            Defaults" menu item.</P></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESRestoreDefaults(ESGlobalsPtr thePrefs);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     thePrefs                  </TD><td valign=top align=left>                     A pointer to the ESGlobals structure                  </TD></TR>               </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            Memory Errors, ES Errors         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C90"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESGetUnsavedFolder</H3>                  <p>            This call is used to retrieve the pathname of the Unsaved            Document folder used by the Autosave feature.         </p>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESGetUnsavedFolder(Ptr theString);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>theString</P>                  </TD><td valign=top align=left>                     <P>A pointer to a string into which the current                     pathname of the unsaved document folder will be copied.</P>                  </TD></TR>            </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            Memory Errors, ES Errors         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C100"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESSetUnsavedFolder</H3>         <BLOCKQUOTE>            <p>You can use the <CODE>ESSetUnsavedFolder</CODE> to set            the pathname of the Unsaved Document folder used by the            Autosave feature.</p></BLOCKQUOTE>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESSetUnsavedFolder(Ptr theString);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>theString</P>                  </TD><td valign=top align=left>                     <P>A pointer to a string which contains the                     pathname of the unsaved document folder to be used.</P>                  </TD></TR>               </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            Memory Errors, ES Errors         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="C110"></A><TABLE BORDER=0 CELLPADDING=1 WIDTH=498>   <TR>      <td align="left">         <H3>ESGetINITVersion</H3>                  <p>            This call is used to retrieve the current version number            of the installed Energy Saver extension file. Use this            call to verify that the correct version of the Energy Saver            extension is being used.         </p>                  <H4>PROTOTYPE</H4>                  <BLOCKQUOTE><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr ESGetINITVersion(Handle* theVers);</pre>	</TD></TR></TABLE></CENTER></BLOCKQUOTE>         <BLOCKQUOTE>            <TABLE BORDER=0 CELLPADDING=1>               <TR>                  <td valign=top width=100 align=left>                     <P>theVers</P>                  </TD><td valign=top align=left>                     <P>A pointer to the version structure</P>                  </TD></TR>               </TABLE></BLOCKQUOTE>                  <H4>RESULT CODE</H4>                  <p>            ES Errors         </p>      </TD></TR></TABLE><P><A HREF="#top">Back to top</A></p><A NAME="Summary"></A>         <H2>Summary</H2>                  <P>As the Macintosh platform continues to evolve, the Energy         Saver API provides a consistent method of monitoring and         controlling power management features. In addition, the         Energy Saver API also presents a few interesting opportunities          for third-party developer applications.</P>         <a name="References"></a><H2>References</H2>         <p><a href="../../documentation/mac/Devices/Devices-230#HEADING230-0"><CITE>Inside Macintosh: Devices, Chapter 6, Power Manager Reference</CITE></A></P><p><A HREF = "#6.html">Technote 1046: <CITE>Inside Macintosh: Devices, Power Manager</CITE> Addenda</A></p><p><A HREF = "tn1079.html">Technote 1079: Power Management &amp; Servers: Auto Restart From Power Failure</A></p><P><A HREF="#top">Back to top</A></p> <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="500">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (108K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1086.pdf">Download</A></P>               </TD></tr><TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/redbook.gif" width=20 height=20 align=bottom alt="Redbook gif"></P>               </TD>               <td align="left">                  <P>Binhexed version of the Energy Services API files (38K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="downloads/tn_1086.1.hqx">Download</A></P>               </TD>            </TR>  </table><BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></table></center><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1086.html%3Fid%3DDTS10002927-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1086.html%3Fid%3DDTS10002927-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1086.html%3Fid%3DDTS10002927-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>