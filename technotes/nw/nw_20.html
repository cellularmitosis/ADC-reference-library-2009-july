<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW20: PAP Status Buffer</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW20: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Oct 29, 1990 - Nov 2, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002562" title="PAP Status Buffer"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW20</div>
<div id="pageheadsub">PAP Status Buffer</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note shows the format of the ATP data part of Printer AccessProtocol (PAP) <code>OpenConnReply</code> and <code>Status</code> AppleTalk responsepackets. A PAP client returns this information in its implementation of the<code>PAPStatus</code> and <code>PAPOpen</code> calls. The status buffer format is shown for bothLaserWriter and ImageWriter (with the ImageWriter&nbsp;II/LQ LocalTalk Optioncard installed) printers.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Nov 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><P><code>OpenConnReply</code> and <code>Status</code> AppleTalk response packets contain up to260 bytes of data in the ATP data part of the packet. Implementations ofPAPStatus and PAPOpen calls typically return this information into anapplication supplied "status buffer." In a <code>Status</code> packet, the first 4bytes of the status buffer are unused. The first 4 bytes of an<code>OpenConnReply</code> packet's status buffer contain the ATP responding socketnumber, the flow quantum from the printer or print server, and a result code.So, in either packet format, the actual "status data" starts at offset $04 inthe status buffer.</p><p>The LaserWriter printer returns its status data in the form of a Pascal string.That string is usually something <i>almost</i> suitable to display on thescreen (for example, "status: idle" or "job: Fred; document: My LaserWriter ison fire; status: busy; source: AppleTalk"). The status text displayed in theLaserWriter Driver dialog boxes is a result of the information contained in thestatusString; it is not the statusString returned by <code>PAPStatus</code> or <code>PAPOpen</code>.Figures 1 and 2 show the format of the ATP data part of the <code>Status</code> and<code>OpenConnReply</code> packets returned by a LaserWriter.</p><P align=center><img src="images/nw_20_001.gif" alt="Figure 1. The Status Packet From a LaserWriter." width=416 height=171></p><P align=center><b>Figure 1</b>. The <code>Status</code> Packet From a LaserWriter<img src="images/nw_20_002.gif" alt="Figure 2. The OpenConnReply Packet From a LaserWriter." width=416 height=171></p><P align=center><b>Figure 2</b>. The <code>OpenConnReply</code> Packet From a LaserWriter</p><p>The ImageWriter II/LQ LocalTalk Option card does not return a status string.Instead, it returns a <code>statusBits</code> word where each bit within that wordhas a specific meaning. An application can interpret the <code>statusBits</code>word and generate an appropriate message to display. Figures 3, 4, and 5 showthe format of the ATP data part of the <code>Status</code> and<code>OpenConnReply</code> packets returned by the ImageWriter II/LQ LocalTalkOption card and the individual bit definitions of the <code>statusBits</code>word.</p><P align=center><img src="images/nw_20_003.gif" alt="Figure 3. The Status Packet Froman ImageWriter II/LQ LocalTalk Option Card" width=384 height=183></p><P align=center><b>Figure 3</b>. The <code>Status</code> Packet From an ImageWriter II/LQ LocalTalkOption Card</p><P align=center><img src="images/nw_20_004.gif" alt="Figure 4. The OpenConnReply Packet From an ImageWriter II/LQLocalTalk Option Card." width=384 height=183></p><P align=center><b>Figure 4</b>. The <code>OpenConnReply</code> Packet From an ImageWriter II/LQLocalTalk Option Card</p><P align=center><img src="images/nw_20_005.gif" alt="Figure 5. The statusBits Word Froman ImageWriter II/LQ LocalTalk Option Card." width=448 height=216></p><P align=center><b>Figure 5</b>. The <code>statusBits</code> Word From an ImageWriter II/LQ LocalTalk Option Card</p><p>There are two additional things to note when interpreting the<code>statusBits</code> word returned by an ImageWriter II/LQ LocalTalk Optioncard:</p><ul type="disc">	<li>If a sheet feeder is installed (bit 14 = 1), running out of paper results in a "Paper jam error" (bit 10 = 1) instead of a "Paper out error" (bit 13).</li>	<li>The ImageWriter II/LQ LocalTalk Option card has been known to randomly return all 1s in the high byte (bits 8-15) of the <code>statusBits</code> word. When this happens, the <code>statusBits</code> word is invalid and an application should repeat the <code>PAPStatus</code> call to get valid information.</li></ul><h3>The Information in This Note and PAP Client Implementations</h3><p>This Technical Note does not show how to make PAP calls - it only shows theformat of the ATP data parts of <code>OpenConnReply</code> and <code>Status</code>AppleTalk response packets as returned by LaserWriter and ImageWriter printers.This device-specific data is important to some developers, and that's why we'republishing it.</p><p>It's important that you realize the PAP client driver embedded in Apple'scurrent LaserWriter and ImageWriter printer drivers is unsupported by Apple.That PAP driver is unsupported because Apple engineering has always reservedthe right to change its implementation as well as its calling interface, andbecause it will not be present in the QuickDraw GX printer drivers. To rununder QuickDraw GX, applications using the PAP client driver embedded inApple's printer drivers must be revised to use another PAP client driver.</p><p>Apple supplies a PAP client driver that can be linked with your program. Youcan license that driver from Apple's Software Licensing department (AppleLink:SW.LICENSE). As an alternative to using our PAP client driver, you can writeyour own PAP client. This can be a time-consuming operation (depending on howversed you are with asynchronous AppleTalk programming), but it is also veryunlikely to break under future systems. Several developers have done it, and itis fairly straightforward. See the Printer Access Protocol (PAP) chapter of<i>Inside AppleTalk</i> for details.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P><i>Inside AppleTalk</i>, Second Edition, Chapter 10, "Printer AccessProtocol"</P><P><i>PostScript Language Reference Manual</i>, Appendix D, "AppleLaserWriter"</P><P><i>ImageWriter LQ Reference</i>, Appendix G, "Interface Specifications,Printer Status Register"</P><P>"Print Hints: Looking Ahead to QuickDraw GX" by Pete ("Luke") Alexander,<i>develop</i> Issue 13</P>                                     <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (244K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_20.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_20.html%3Fid%3DDTS10002562-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_20.html%3Fid%3DDTS10002562-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_20.html%3Fid%3DDTS10002562-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>