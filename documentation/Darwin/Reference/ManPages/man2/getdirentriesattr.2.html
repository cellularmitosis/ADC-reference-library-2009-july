<html><head><title>Mac OS X Developer Tools
 Manual Page For getdirentriesattr(2)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/2/getdirentriesattr" title="Mac OS X Developer Tools
 Manual Page for getdirentriesattr(2)"><!-- headerDoc=man; indexgroup=Section 2; uid="//apple_ref/doc/man/2/getdirentriesattr"; name=getdirentriesattr(2) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
GETDIRENTRIESATTR(2)        BSD System Calls Manual       GETDIRENTRIESATTR(2)

<b>NAME</b>
     <b>getdirentriesattr</b> -- get file system attributes for multiple directory entries

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;sys/attr.h&gt;</b>
     <b>#include</b> <b>&lt;unistd.h&gt;</b>

     <u>int</u>
     <b>getdirentriesattr</b>(<u>int</u> <u>fd</u>, <u>struct</u> <u>attrlist</u> <u>*</u> <u>attrList</u>, <u>void</u> <u>*</u> <u>attrBuf</u>, <u>size</u><b>_</b><u>t</u> <u>attrBufSize</u>,
         <u>unsigned</u> <u>long</u> <u>*</u> <u>count</u>, <u>unsigned</u> <u>long</u> <u>*</u> <u>basep</u>, <u>unsigned</u> <u>long</u> <u>*</u> <u>newState</u>, <u>unsigned</u> <u>long</u> <u>options</u>);

<b>DESCRIPTION</b>
     The <b>getdirentriesattr</b>() function reads directory entries and returns their attributes (that is, meta-<font color="#ffffff" class="whiteout">data).&nbsp;metadata).</font>
     data).  You can think of it as a combination of <a href="getdirentries.2.html#//apple_ref/doc/man/2/getdirentries">getdirentries(2)</a> and <a href="getattrlist.2.html#//apple_ref/doc/man/2/getattrlist">getattrlist(2)</a>.  The function
     reads directory entries from the directory referenced by the file descriptor <u>fd</u>.  Attributes of those
     directory entries are placed into the buffer specified by <u>attrBuf</u> and <u>attrBufSize</u>.  The <u>attrList</u> param-<font color="#ffffff" class="whiteout">eter&nbsp;parameter</font>
     eter determines what attributes are returned for each entry.  The <u>count</u> parameter contains the number
     of directory entries requested and returned.  The <u>basep</u> parameter returns the directory offset in a
     manner similar to <a href="getdirentries.2.html#//apple_ref/doc/man/2/getdirentries">getdirentries(2)</a>.  The <u>newState</u> parameter allows you to check whether the directory
     has been modified while you were reading it.  The <u>options</u> parameter lets you control specific aspects
     of the function's behaviour.

     The <b>getdirentriesattr</b>() function is only supported by certain volume format implementations.  For maxi-<font color="#ffffff" class="whiteout">mum&nbsp;maximum</font>
     mum compatibility, client programs should use high-level APIs (such as the Carbon File Manager) to
     access file system attributes.  These high-level APIs include logic to emulate file system attributes
     on volumes that don't support <b>getdirentriesattr</b>().

     The <u>fd</u> parameter must be a file descriptor that references a directory that you have opened for read-<font color="#ffffff" class="whiteout">ing.&nbsp;reading.</font>
     ing.

     The <u>attrList</u> parameter is a pointer to an <u>attrlist</u> structure.  You are responsible for filling out all
     fields of this structure before calling the function.  See the discussion of the <a href="getattrlist.2.html#//apple_ref/doc/man/2/getattrlist">getattrlist(2)</a> func-<font color="#ffffff" class="whiteout">tion&nbsp;function</font>
     tion for a detailed description of this structure.  To get an attribute you must set the corresponding
     bit in the appropriate <u>attrgroup</u><b>_</b><u>t</u> field of the <u>attrlist</u> structure.  You must not request volume
     attributes.

     The <u>attrBuf</u> and <u>attrBufSize</u> parameters specify a buffer into which the function places attribute val-<font color="#ffffff" class="whiteout">ues.&nbsp;values.</font>
     ues.  The attributes for any given directory entry are grouped together and packed in exactly the same
     way as they are returned from <a href="getattrlist.2.html#//apple_ref/doc/man/2/getattrlist">getattrlist(2)</a>.  These groups are then placed into the buffer, one after
     another.  As each group starts with a leading <u>unsigned</u> <u>long</u> that contains the overall length of the
     group, you can step from one group to the next by simply adding this length to your pointer.  The sam-<font color="#ffffff" class="whiteout">ple&nbsp;sample</font>
     ple code (below) shows how to do this.  The initial contents of this buffer are ignored.

     The <u>count</u> parameter points to a <u>unsigned</u> <u>long</u> variable.  You should initialise this variable to be the
     number of directory entries for which you wish to get attributes.  On return, this variable contains
     the number of directory entries whose attributes have been placed into the attribute buffer.  This may
     be smaller than the number that you requested.

     The <u>basep</u> parameter returns the offset of the last directory entry read, in a manner identical to
     <a href="getdirentries.2.html#//apple_ref/doc/man/2/getdirentries">getdirentries(2)</a>.  You can use this value to reset a directory iteration to a known position using
     <a href="lseek.2.html#//apple_ref/doc/man/2/lseek">lseek(2)</a>.  The initial value of the variable is ignored.

     The <u>newState</u> parameter returns a value that changes if the directory has been modified.  If you're
     iterating through the directory by making repeated calls to <b>getdirentriesattr</b>(), you can compare subse-<font color="#ffffff" class="whiteout">quent&nbsp;subsequent</font>
     quent values of <u>newState</u> to determine whether the directory has been modified (and thus restart your
     iteration at the beginning).  The initial value of the variable is ignored.

     The <u>options</u> parameter is a bit set that controls the behaviour of <b>getdirentriesattr</b>().  The following
     option bits are defined.

     FSOPT_NOINMEMUPDATE  This tells <b>getdirentriesattr</b>() to return the directory entries from disk rather
                          than taking the extra step of looking at data structures in-memory which may con-<font color="#ffffff" class="whiteout">tain&nbsp;contain</font>
                          tain changes that haven't been flushed to disk.

                          This option allowed for specific performance optimizations for specific clients on
                          older systems.  We currently recommend that clients not set this option and that
                          file system implementations ignore it.

     It is typical to ask for a combination of common, file, and directory attributes and then use the value
     of the ATTR_CMN_OBJTYPE attribute to parse the resulting attribute buffer.

<b>RETURN</b> <b>VALUES</b>
     Upon successful completion a value of 0 or 1 is returned.  The value 0 indicates that the routine com-<font color="#ffffff" class="whiteout">pleted&nbsp;completed</font>
     pleted successfully.  The value 1 indicates that the routine completed successfully and has returned
     the last entry in the directory.  On error, a value of -1 is returned and <u>errno</u> is set to indicate the
     error.

<b>COMPATIBILITY</b>
     Not all volumes support <b>getdirentriesattr</b>().  You can test whether a volume supports
     <b>getdirentriesattr</b>() by using <a href="getattrlist.2.html#//apple_ref/doc/man/2/getattrlist">getattrlist(2)</a> to get the volume capabilities attribute
     ATTR_VOL_CAPABILITIES, and then testing the VOL_CAP_INT_READDIRATTR flag.

     The <b>getdirentriesattr</b>() function has been undocumented for more than two years.  In that time a number
     of volume format implementations have been created without a proper specification for the behaviour of
     this routine.  You may encounter volume format implementations with slightly different behaviour than
     what is described here.  Your program is expected to be tolerant of this variant behaviour.

     If you're implementing a volume format that supports <b>getdirentriesattr</b>(), you should be careful to sup-<font color="#ffffff" class="whiteout">port&nbsp;support</font>
     port the behaviour specified by this document.

<b>ERRORS</b>
     <b>getdirentriesattr</b>() will fail if:

     [ENOTSUP]          The volume does not support <b>getdirentriesattr</b>().

     [EBADF]            <u>fd</u> is not a valid file descriptor for a directory open for reading.

     [EFAULT]           <u>attrList</u> or <u>attrBuf</u> points to an invalid address.

     [EINVAL]           The <u>bitmapcount</u> field of <u>attrList</u> is not ATTR_BIT_MAP_COUNT.

     [EINVAL]           You requested an invalid attribute.

     [EINVAL]           You requested volume attributes.

     [EINVAL]           The <u>options</u> parameter contains an invalid flag.

     [EIO]              An I/O error occurred while reading from or writing to the file system.

<b>EXAMPLES</b>
     The following code lists the contents of a directory using <b>getdirentriesattr</b>().  The listing includes
     the file type and creator for files.

     #include &lt;assert.h&gt;
     #include &lt;stdio.h&gt;
     #include &lt;stddef.h&gt;
     #include &lt;string.h&gt;
     #include &lt;sys/attr.h&gt;
     #include &lt;sys/errno.h&gt;
     #include &lt;unistd.h&gt;
     #include &lt;sys/vnode.h&gt;
     #include &lt;stdbool.h&gt;
     #include &lt;fcntl.h&gt;

     typedef struct attrlist attrlist_t;

     struct FInfoAttrBuf {
         unsigned long   length;
         attrreference_t name;
         fsobj_type_t    objType;
         char            finderInfo[32];
     };
     typedef struct FInfoAttrBuf FInfoAttrBuf;

     enum {
         kEntriesPerCall = 10
     };

     static int FInfoDemo(const char *dirPath)
     {
         int             err;
         int             junk;
         int             dirFD;
         attrlist_t      attrList;
         unsigned long   index;
         unsigned long   count;
         unsigned long   junkBaseP;
         bool            oldStateValid;
         unsigned long   oldState;
         unsigned long   newState;
         bool            done;
         FInfoAttrBuf *  thisEntry;
         char            attrBuf[kEntriesPerCall * (sizeof(FInfoAttrBuf) + 64)];

         // attrBuf is big enough for kEntriesPerCall entries, assuming that
         // the average name length is less than 64.

         memset(&amp;attrList, 0, sizeof(attrList));
         attrList.bitmapcount = ATTR_BIT_MAP_COUNT;
         attrList.commonattr  =    ATTR_CMN_NAME
                                 | ATTR_CMN_OBJTYPE
                                 | ATTR_CMN_FNDRINFO;

         err = 0;
         dirFD = open(dirPath, O_RDONLY, 0);
         if (dirFD &lt; 0) {
             err = errno;
         }
         if (err == 0) {
             oldStateValid = false;
             done = false;
             do {
                 count = kEntriesPerCall;

                 err = getdirentriesattr(
                     dirFD,
                     &amp;attrList,
                     &amp;attrBuf,
                     sizeof(attrBuf),
                     &amp;count,
                     &amp;junkBaseP,
                     &amp;newState,
                     0
                 );
                 if (err &lt; 0) {
                     err = errno;
                 } else {
                     done = err;
                     err = 0;
                 }

                 if (err == 0) {
                     if (oldStateValid) {
                         if (newState != oldState) {
                             printf("*** Directory has changed\n");
                             oldState = newState;
                         }
                     } else {
                         oldState = newState;
                         oldStateValid = true;
                     }

                     thisEntry = (FInfoAttrBuf *) attrBuf;

                     for (index = 0; index &lt; count; index++) {
                         switch (thisEntry-&gt;objType) {
                             case VREG:
                                 printf(
                                     "'%4.4s' '%4.4s' ",
                                     &amp;thisEntry-&gt;finderInfo[0],
                                     &amp;thisEntry-&gt;finderInfo[4]
                                 );
                                 break;
                             case VDIR:
                                 printf("directory     ");
                                 break;
                             default:
                                 printf(
                                     "objType = %-2d  ",
                                     thisEntry-&gt;objType
                                 );
                                 break;
                         }
                         printf(
                             "%s\n",
                             ((char *) &amp;thisEntry-&gt;name)
                                 + thisEntry-&gt;name.attr_dataoffset
                         );

                         // Advance to the next entry.

                         ((char *) thisEntry) += thisEntry-&gt;length;
                     }
                 }
             } while ( err == 0 &amp;&amp; ! done );
         }

         if (dirFD != -1) {
             junk = close(dirFD);
             assert(junk == 0);
         }

         return err;
     }

<b>SEE</b> <b>ALSO</b>
     <a href="getattrlist.2.html#//apple_ref/doc/man/2/getattrlist">getattrlist(2)</a>, <a href="getdirentries.2.html#//apple_ref/doc/man/2/getdirentries">getdirentries(2)</a>, <a href="lseek.2.html#//apple_ref/doc/man/2/lseek">lseek(2)</a>

<b>HISTORY</b>
     A <b>getdirentriesattr</b>() function call appeared in Darwin 1.3.1 (Mac OS X version 10.0).

Darwin                         December 15, 2003                        Darwin
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man2/getdirentriesattr.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man2/getdirentriesattr.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man2/getdirentriesattr.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
