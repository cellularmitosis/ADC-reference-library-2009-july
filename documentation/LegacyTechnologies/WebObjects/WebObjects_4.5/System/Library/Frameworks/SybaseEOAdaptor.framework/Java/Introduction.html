<HTML>		<HEAD>		<TITLE>					</TITLE>		</HEAD>	<body bgcolor="#ffffff"><!--start of banner --><!-- #include virtual="/techpubs/navbar" --><!-- end of banner --><!--start of path --><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b> <a href="../../../../../../index.html" target="_top">Documentation</a> <b>&gt;</b> <a href="../../../../../webobjects.html" target="_top">WebObjects 4.5</a> <b>&gt;</b>SybaseEOAdaptor Reference</font><br><br><!--end of path --><a href="SybaseEOAdaptorTOC.html"><img src="../../../../../images/up.gif" border="0" alt="Table of Contents"></a> <br><h1><FONT COLOR=\"#000066\">SybaseEOAdaptorFramework</FONT></h1><br><blockquote><b>Package: </b>com.apple.yellow.sybaseeoadaptor</blockquote><HR SIZE=4><br><h2>Introduction</h2><p>The SybaseEOAdaptor framework is a set of classes that allowyour programs to connect to a Sybase server. These classes provideSybase-specific method implementations for the EOAccess framework's EOAdaptor,EOAdaptorChannel, EOAdaptorContext, and EOSQLExpression abstractclasses.</p><p>The following table lists the classes in the SybaseEOAdaptorFramework and provides a brief description of each class.</p><br><table border = \"1\"><tr><td scope="row"><b>Class</b></td><td><b>Description</b></td></tr><tr><td scope="row">SybaseAdaptor</td><td>Representsa single connection to a Sybase database server, and is responsiblefor keeping login and model information, performing Sybase-specificformatting of SQL expressions, and reporting errors. </td></tr><tr><td scope="row">SybaseChannel</td><td>Representsan independent communication channel to the database server itsSybaseAdaptor is connected to.</td></tr><tr><td scope="row">SybaseContext</td><td>Representsa single transaction scope on the database server to which its adaptorobject is connected.</td></tr><tr><td scope="row">SybaseSQLExpression</td><td>Defineshow to build SQL statements for SybaseChannels.</td></tr></table><br><br><a name = "BICEAJIE"><h2>The Connection Dictionary</h2></a><p>The connection dictionary contains items needed to connectto a Sybase server, such as the server name and database (it'scommon to omit the user name and password from the connection dictionary,and prompt users to enter those values in a login panel). The keysof this dictionary identify the information the server expects,and the values of those keys are the values that the adaptor useswhen trying to connect to the server.</p><p>The Sybase adaptor defines string constants for use as connectiondictionary keys:</p><ul><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBBJGJA">HOSTNAME</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBIAEHF">DATABASENAME</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBIIDEA">USERNAME</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBDICFH">PASSWORD</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBDGJBE">LC_ALL_KEY</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBEJFJJ">ENCRYPTPASSWORD</a></li><li> <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBBIIDI">PRIMITIVE_TYPE_MAP</a></li></ul><p>The last three keys are optional. The <code>ENCRYPTPASSWORD</code> keyprovides support for Sybase password encryption. A value for the <code>LC_ALL_KEY</code> declaresto the Sybase server the character set being used by the client(such as eucjis, ascii7, or iso_1). For a complete list of typesavailable for this field, see your Sybase documentation. The <code>PRIMITIVE_TYPE_MAP</code> entrydescribes the mapping of user-defined data types to their base Sybasetype (such as varchar or datetime). For more information on user-defineddata types, see  <a frame= "conv" href="#BCEBBICG">"Data Type Mapping" </a>.</p><p>To add any of these optional keys and appropriate values toyour connection dictionary, you can manually edit your model file.For example:</p><blockquote><pre>connectionDictionary = {databaseName = People;     hostName = "";     LC_ALL = eucjis;    password = "";     primitiveTypeMap = {id = varchar; ssn = char(9); };    sybasePasswordEncryption = YES;    userName = "";}; </pre></blockquote><br><p>Subsequently changing the connection dictionary in your modelfile using the Set Adaptor Info command in EOModeler has no effecton these keys and their values-they are preserved unless you editthe file to remove them. Alternatively you can add the optionalkeys to a model's connection dictionary programmatically.</p><p>The default character set for non-Japanese systems is iso_1(that is, ISO Latin 1), while the default character set for Japanesesystems is eucjis. You only need to add the LC_ALL key to your connection dictionaryif you are using a character set other than your system's default.</p><p>See the  <a frame= "conv" href="Classes/SybaseAdaptor.html#CDBGEGJC">SybaseAdaptor</a> class specificationfor more information on the connection dictionary key constants.</p><br><h2>Error Handling</h2><p>SybaseAdaptor, SybaseContext, and SybaseChannel can raiseexceptions due to programming errors that result in invalid argumentvalues or internal inconsistencies. In addition, messages, errors,and failure status returned from the Sybase SQL Server and clientlibraries can also result in EOGeneralAdaptorExceptions. When anexception results from a callback to the CS_CLIENTMSG_CB (SybaseClientMessage callback) or the CS_SERVERMSG_CB (Sybase ServerMessagecallback), all of the information passed into this routine is availablein the userInfo dictionary contained by the exception. When an exceptionis raised in response to a Sybase ClientMessage callback, you canget the information provided by the client library as follows:</p><blockquote><pre>clientMsgDict =    localException().userInfo().objectForKey("sybaseClientMessageDictionary");</pre></blockquote><br><p>The <code>clientMsgDict</code> containsthe following keys which have values corresponding to those sentin the callback function that raised the exception: <code>msgstring</code>, <code>osstring</code>, <code>sqlstate</code>, <code>severity</code>, <code>msgnumber</code>, <code>osnumber</code>, <code>status</code>.</p><p>Similarly, when the exception is raised in response to a SybaseServerMessage callback, you can get the information provided bythe server as follows:</p><blockquote><pre>svrMsgDict = localException().userInfo().objectForKey("sybaseServerMessageDictionary");</pre></blockquote><br><p>The <code>svrMsgDict</code> containsthe following keys which have values corresponding to those sentin the callback function that raised the exception: <code>text</code>, <code>svrname</code>, <code>proc</code>, <code>sqlstate</code>, <code>msgnumber</code>, <code>state</code>, <code>severity</code>, <code>line</code>, <code>status</code>.</p><br><h2>Locking</h2><p>All adaptors use the database server's native locking facilitiesto lock rows on the server. The Sybase adaptor locks a row by usingthe HOLDLOCK keyword in SELECT statements. This occurs when:</p><ul><li>You send the adaptor channel a <b>selectAttributes</b> messagewith true specified as the value for the lock keyword.</li><li>You explicitly lock an object's row with the EODatabaseContext's <b>lockObjectWithGlobalID</b> message.</li><li>You set pessimistic locking at the database level and fetchobjects.</li></ul><p>The semantics of the HOLDLOCK keyword are such that when youlock a row other users can't update it, but it doesn't guaranteethat your update will succeed. This is because other users couldbe holding a lock on the same row. However, you can still read rowsthat are locked by other users.</p><br><a name = "BCEBBICG"><h2>Data Type Mapping</h2></a><p>Every adaptor provides a mapping between each server datatype (the <b>external</b> type) and the Java type (the <b>internal</b> type)to which a database value will be coerced when it's fetched fromthe database. The following table lists the mapping used by SybaseAdaptor.</p><br><table border = \"1\"><tr><td scope="row"><b>ExternalData Type</b></td><td><b>Internal Data Type</b></td></tr><tr><td scope="row"><code>binary</code></td><td>NSData</td></tr><tr><td scope="row"><code>bit</code></td><td>Number</td></tr><tr><td scope="row"><code>char</code></td><td>String</td></tr><tr><td scope="row"><code>datetime</code></td><td>NSGregorianDate</td></tr><tr><td scope="row"><code>datetimn</code></td><td>NSGregorianDate</td></tr><tr><td scope="row"><code>decimal</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>decimaln</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>float</code></td><td>Number</td></tr><tr><td scope="row"><code>floatn</code></td><td>Number</td></tr><tr><td scope="row"><code>image</code></td><td>NSData</td></tr><tr><td scope="row"><code>int</code></td><td>Number</td></tr><tr><td scope="row"><code>intn</code></td><td>Number</td></tr><tr><td scope="row"><code>money</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>moneyn</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>nchar</code></td><td>String</td></tr><tr><td scope="row"><code>numeric</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>numericn</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>nvarchar</code></td><td>String</td></tr><tr><td scope="row"><code>real</code></td><td>Number</td></tr><tr><td scope="row"><code>smalldatetime</code></td><td>NSGregorianDate</td></tr><tr><td scope="row"><code>smallint</code></td><td>Number</td></tr><tr><td scope="row"><code>smallmoney</code></td><td>BigDecimal</td></tr><tr><td scope="row"><code>sysname</code></td><td>String</td></tr><tr><td scope="row"><code>text</code></td><td>String</td></tr><tr><td scope="row"><code>timestamp</code></td><td>NSData</td></tr><tr><td scope="row"><code>tinyint</code></td><td>Number</td></tr><tr><td scope="row"><code>varbinary</code></td><td>NSData</td></tr><tr><td scope="row"><code>varchar</code></td><td>String</td></tr></table><br><p>In addition, SybaseAdaptor provides a mapping for user-defineddata types. For example, a custom data type <b>partnumber</b><em> </em>definedas <code>char(10)</code> is mappedto String-the Java type to which <b>partnumber</b>'s basedata type (<code>char</code>) is mapped.SybaseAdaptor's implementation of <b>describeModelWithTableNames</b> automaticallycreates mappings for user-defined data types and saves them in theconnection dictionary of the newly created model. Consequently,even models created with EOModeler automatically include informationabout custom data types.</p><p>Since information about custom types is stored in a model'sconnection dictionary, the type mapping methods- <a frame= "conv" href="Classes/SybaseAdaptor.html#//apple_ref/java/clm/SybaseAdaptor/externalToInternalTypeMap">externalToInternalTypeMap</a>, <b>internalTypeForExternalType</b>,and <b>isValidQualifierType</b>-use the modelargument if it is provided. If the model argument isn't provided,these methods don't have user-defined data type information availableto them.</p><br><h2>Prototype Attributes</h2><p>The SybaseEOAdaptor Framework provides the following set ofprototype attributes:</p><br><table border = \"1\"><tr><td scope="row"><b>Name</b></td><td><b>External Type</b></td><td><b>ValueClass Name</b></td><td><b>Other Attributes</b></td></tr><tr><td scope="row"><code>binaryID</code></td><td><code>varbinary</code></td><td>NSData</td><td><code>width= 12</code></td></tr><tr><td scope="row"><code>city</code></td><td><code>varchar</code></td><td>String</td><td><code>columnName= CITY</code><code>width = 50</code></td></tr><tr><td scope="row"><code>date</code></td><td><code>datetime</code></td><td>NSGregorianDate</td><td><code>columnName= ""</code></td></tr><tr><td scope="row"><code>longText</code></td><td><code>text</code></td><td>String</td><td>&nbsp;</td></tr><tr><td scope="row"><code>money</code></td><td><code>money</code></td><td>BigNumber</td><td><code>columnName= ""</code></td></tr><tr><td scope="row"><code>phoneNumber</code></td><td><code>varchar</code></td><td>String</td><td><code>columnName= PHONE</code><code>width = 20</code></td></tr><tr><td scope="row"><code>rawImage</code></td><td><code>image</code></td><td>NSData</td><td><code>columnName= RAW_IMAGE</code></td></tr><tr><td scope="row"><code>state</code></td><td><code>varchar</code></td><td>String</td><td><code>columnName= STATE</code><code>width = 2</code></td></tr><tr><td scope="row"><code>streetAddress</code></td><td><code>varchar</code></td><td>String</td><td><code>columnName= STREET_ADDRESS</code><code>width = 100</code></td></tr><tr><td scope="row"><code>tiffImage</code></td><td><code>image</code></td><td>NSImage</td><td><code>adaptorValueConversionMethodName=    TIFFRepresentation</code><code>columnName = PHOTO</code><code>valueFactoryMethodName =    "imageWithData:"</code></td></tr><tr><td scope="row"><code>uniqueID</code></td><td><code>int</code></td><td>Number</td><td><code>columnName= ""</code><code>valueType = i</code></td></tr><tr><td scope="row"><code>zipCode</code></td><td><code>varchar</code></td><td>String</td><td><code>columnName= ZIP</code><code>width = 10</code></td></tr></table><br><br><h2>Generating Primary Keys</h2><p>Each adaptor provides a database-specific implementation ofthe method <b>primaryKeyForNewRowWithEntity</b> forgenerating primary keys. The SybaseChannel's implementation usesa table named <code>eo_sequence_table</code> tokeep track of the next available primary key value for a given table.The table contains a row for each table for which the adaptor providesprimary key values. The statement used to create the <code>eo_sequence_table</code> is:</p><blockquote><pre>create table eo_sequence_table (    table_name varchar(32),    counter int null)</pre></blockquote><br><p>SybaseChannel uses a stored procedure named <code>eo_pk_for_table</code> toaccess and maintain the primary key counter in <code>eo_sequence_table</code>.The stored procedure is defined as follows:</p><blockquote><pre>create procedureeo_pk_for_table @tname varchar(32) asbegin    define @max int    update eo_sequence_table    set counter = counter + 1    where table_name = @tname    select counter    from eo_sequence_table    where table_name = @tnameend</pre></blockquote><br><p>The stored procedure increments the counter in the <code>eo_sequence_table</code> rowfor the specified table, selects the counter value, and returnsit. SybaseChannel executes this <code>eo_pk_for_table</code> storedprocedure from <b>primaryKeyForNewRowWithEntity</b> andreturns the stored procedure's return value.</p><p>To use SybaseChannel's database-specific primary key generationmechanism, be sure that your database accommodates the adaptor'sscheme. To modify your database so that it supports the adaptor'smechanism for generating primary keys, use EOModeler. For more informationon this topic, see <i>Enterprise Objects Framework Developer'sGuide</i>.</p><br><a href="SybaseEOAdaptorTOC.html"><img src="../../../../../images/up.gif" border="0" alt="Table of Contents"></a> </BODY></HTML>