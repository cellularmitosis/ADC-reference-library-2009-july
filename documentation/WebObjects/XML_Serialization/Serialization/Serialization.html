<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>WebObjects XML Serialization Guide: XML Serialization Essentials</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="XML Serialization Essentials"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP30000179" title="XML Serialization Essentials"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../InternetWeb/index.html#//apple_ref/doc/uid/TP30000440-TP30000469" target="_top">Internet &amp; Web</a> &gt; <a href="../../../InternetWeb/WebObjects-date.html#//apple_ref/doc/uid/TP30000440-TP30000469-TP30000592" target="_top">WebObjects</a> &gt; <a href="../AboutThisBook/AboutThisBook.html#//apple_ref/doc/uid/TP30000177-DontLinkElementID_4">WebObjects XML Serialization Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Serializing/Serializing.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP30000179-SW16" title="XML Serialization Essentials"></a><h1>XML Serialization Essentials</h1><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_72"></a>XML serialization is a great way for applications to maintain state, read and write configuration files, and transfer data between processes, applications, and enterprises over a network, including the Internet. Because XML documents are text-based, you can view and modify serialized data with a text editor.</p><p>Java's <a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_73"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_74"></a>binary serialization API (whose major classes are ObjectOutputStream and ObjectInputStream) provides an infrastructure that supports data serialization into binary form. Binary data, however, is not easily read by people nor appropriate for communication across disparate applications or systems.</p><p>WebObjects allows you serialize objects and data into XML documents using the API defined for binary serialization. The classes NSXMLOutputStream<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_75"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_76"></a> and NSXMLInputStream<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_77"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_78"></a> extend ObjectOutputStream and ObjectInputStream, respectively. These classes use the <strong>Java API for XML Processing (JAXP)</strong><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_79"></a>to communicate with the XML parser. See <span class="content_text"><a href="../Transformation/Transformation.html#//apple_ref/doc/uid/TP30000181-SW6">“XML Parsers and XSLT Processors”</a></span> for more information.</p><p>As in binary serialization, an NSXMLOutputStream object writes enough data to a stream for an NSXMLInputStream object to be able to reconstruct the object graph and data that the stream represents. This includes fully qualified class names, field names, and data types. This level of verbosity is adequate for serialization and deserialization by similar systems, but may not be appropriate for data transmission between companies, for example. <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW10">“Transforming an Array of Movies”</a></span> shows you how to transform the output of NSXMLOutputStream into a simpler XML document suitable for communication among business partners.</p><p>Most of this chapter is based on Sun's <em>Java Object Serialization Specification</em>,. If you are familiar with that document, you can just skim through the chapter. You should, however, read <span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW13">“Application Security,”</a></span> as it contains information on how to set up the security manager to allow WebObjects's serialization classes to work unrestricted.</p><p>This chapter contains the following sections:</p><ul class="ul"><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW1">“Serialization Process”</a></span> lists the steps you perform to serialize data.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW3">“Deserialization Process”</a></span> lists the steps you perform to deserialize data.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW5">“Secure Serialization”</a></span> explains how to exclude fields from the serialization process.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW8">“Validation of Deserialized Data”</a></span> briefly explains how to validate an object after it's deserialized.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW10">“Multiple Class Version Support”</a></span> lists issues to consider when you update a Serializable class to maintain compatibility with previous versions.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW12">“Serialization With Keys”</a></span> provides an overview of key-based serialization.</p></li><li class="li"><p><span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW13">“Application Security”</a></span> explains how to set up Sun's security manager to grant WebObjects classes permissions to allow them to perform XML serialization.</p></li></ul><a name="//apple_ref/doc/uid/TP30000179-SW1" title="Serialization Process"></a><h2>Serialization Process</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_80"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_81"></a>To serialize objects and data you perform the following steps:</p><ol class="ol"><li class="li"><p>Open an output stream of type <code>java.io.OutputStream</code> or a subclass of it.</p></li><li class="li"><p>Initialize an NSXMLOutputStream<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_82"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_83"></a> with the output stream.</p></li><li class="li"><p>Invoke the <code>writeObject</code> method to serialize objects or the appropriate <code>write</code> method to serialize primitive-type data (see the API documentation for the <code>java.io.DataOutput</code> interface for a list of primitive-data serialization methods).</p></li><li class="li"><p>Close the OutputStream and the NSXMLOutputStream.</p></li></ol><p><span class="content_text">Listing 2-1</span> shows an example of a method that serializes an object and an integer value.</p><a name="//apple_ref/doc/uid/TP30000179-SW2" title="Listing 2-1Example of a serialization method"></a><p class="codesample"><strong>Listing 2-1&nbsp;&nbsp;</strong>Example of a serialization method</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Serializes an object and an integer.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void serialize() {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Filename of the output file.<span></span></pre></td></tr><tr><td scope="row"><pre>    String filename = "/tmp/example.xml";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create a stream to the output file.<span></span></pre></td></tr><tr><td scope="row"><pre>        FileOutputStream output_stream = new FileOutputStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an XML-output stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLOutputStream xml_stream = new NSXMLOutputStream(output_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Write the data.<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream.writeObject("Hello, World!");<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream.writeInt(5);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the streams.<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream.flush(); // not really needed, but doesn't hurt<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream.close();<span></span></pre></td></tr><tr><td scope="row"><pre>        output_stream.close();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When an object is serialized, all the objects it refers to are also serialized. But this brings up the issue of cyclic references<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_84"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_85"></a> or multiple references to the same object. The problem is addressed by uniquely identifying each object as it is serialized. As each object is written to the output stream, its <code>id</code> attribute is set to a number that is unique within the XML document being generated. References to previously serialized objects use those objects' identification numbers instead of writing additional copies of them. This method is also used by object instances when referring to their class descriptions. See <span class="content_text"><a href="../Serializing/Serializing.html#//apple_ref/doc/uid/TP30000180-SW30">“Serializing Custom Objects to an XML Document”</a></span> for an example.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_86"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_87"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW3" title="Deserialization Process"></a><h2>Deserialization Process</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_88"></a>To deserialize data from an untransformed XML stream encoded with NSXMLOutputStream, you perform the following steps:</p><ol class="ol"><li class="li"><p>Open an input stream of type <code>java.lang.InputStream</code> or a subclass of it.</p></li><li class="li"><p>Initialize an NSXMLInputStream<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_89"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_90"></a> with the input stream.</p></li><li class="li"><p>Invoke the <code>readObject</code> method to deserialize objects or the appropriate <code>read</code> method to deserialize primitive-type data (see the API documentation for the <code>java.io.DataInput</code> interface for a list of primitive-data serialization methods).</p></li><li class="li"><p>Close the InputStream and the NSXMLInputStream.</p></li></ol><p><span class="content_text">Listing 2-2</span> shows an example of a method that deserializes an object and an integer value.</p><a name="//apple_ref/doc/uid/TP30000179-SW4" title="Listing 2-2Example of a deserialization method"></a><p class="codesample"><strong>Listing 2-2&nbsp;&nbsp;</strong>Example of a deserialization method</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Deserializes an object and an integer.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public void deserialize() {<span></span></pre></td></tr><tr><td scope="row"><pre>    // Filename of the input file.<span></span></pre></td></tr><tr><td scope="row"><pre>    String filename = "/tmp/example.xml";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    try {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Create a stream from the input file.<span></span></pre></td></tr><tr><td scope="row"><pre>        FileInputStream input_stream = new FileInputStream(filename);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Create an XML-input stream.<span></span></pre></td></tr><tr><td scope="row"><pre>        NSXMLInputStream xml_stream = new NSXMLInputStream(input_stream);<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Read the data.<span></span></pre></td></tr><tr><td scope="row"><pre>        String theString = xml_stream.readObject();<span></span></pre></td></tr><tr><td scope="row"><pre>        int theInt = xml_stream.readInt();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        // Close the streams.<span></span></pre></td></tr><tr><td scope="row"><pre>        xml_stream.close();<span></span></pre></td></tr><tr><td scope="row"><pre>        output_stream.close();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (IOException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (FileNotFoundException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    catch (ClassNotFoundException e) {<span></span></pre></td></tr><tr><td scope="row"><pre>        e.printStackTrace();<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>When you deserialize an object, the original object graph is recreated by restoring the values of nontransient and nonstatic fields. Objects referred to in the original object graph are restored recursively. After deserializing an object with transient or static fields, you must set those fields to the appropriate values. See <span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW8">“Validation of Deserialized Data”</a></span> and <span class="content_text"><a href="Serialization.html#//apple_ref/doc/uid/TP30000179-SW5">“Secure Serialization”</a></span> for more information.</p><p>You may want to have the parser validate<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_91"></a> source documents before deserializing objects; this is helpful in debugging and when transferring data across a network, such as an intranet or the Internet. However, you incur a performance penalty when the parser validates the documents it processes. To turn on parser validation, set the <code>NSXMLValidation</code> system property<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_92"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_93"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_94"></a> to <code>true</code>. As a general rule, you should turn on validation during application development and turn it off in deployed applications.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_95"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW5" title="Secure Serialization"></a><h2>Secure Serialization</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_96"></a>When you deserialize an object, its private state is restored. To protect sensitive data you may have to remove certain fields from the serialization and deserialization processes. You can accomplish this in two ways:</p><ul class="ul"><li class="li"><p>Define fields whose data you want to protect as <code>private transient</code> or <code>static</code>.</p></li><li class="li"><p>Implement <code>writeObject</code> and <code>readObject</code> in the class you want to protect and serialize nonsensitive fields only.</p></li></ul><p>To prevent serialization, a class must not implement the <code>java.io.Serializable</code> or <code>java.io.Externalizable</code> interfaces. In subclasses of classes that implement those interfaces, you can throw a NotSerializableException<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_97"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_98"></a>. <span class="content_text">Listing 2-3</span> shows an example of a class with a transient field.</p><a name="//apple_ref/doc/uid/TP30000179-SW6" title="Listing 2-3Example of a secure class"></a><p class="codesample"><strong>Listing 2-3&nbsp;&nbsp;</strong>Example of a secure class</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Encapsulates secret data.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class Secret extends Object implements Serializable {<span></span></pre></td></tr><tr><td scope="row"><pre>    private transient String details;    // do not serialize<span></span></pre></td></tr><tr><td scope="row"><pre>    private int id;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*<span></span></pre></td></tr><tr><td scope="row"><pre>     * Creates a Secret object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param id            identification<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param details       sensitive information<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    Secret(int id, String details) {<span></span></pre></td></tr><tr><td scope="row"><pre>        super();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        this.id = id;<span></span></pre></td></tr><tr><td scope="row"><pre>        this.details = details;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets this secret's id.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return secret id.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public int id() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return this.id;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /*<span></span></pre></td></tr><tr><td scope="row"><pre>     * Gets this secret's details.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @return secret details.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public String details() {<span></span></pre></td></tr><tr><td scope="row"><pre>        return this.details;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_26" title="Note"></a><p><strong>Note:</strong>&nbsp; You should also define as transient fields that contain objects whose class does not implement Serializable or Externalizable.</p></div><p><span class="content_text">Listing 2-4</span> shows a class that extends a serializable class, but inhibits instances from being serialized or deserialized.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_99"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW7" title="Listing 2-4Example of a class that disallows serialization and deserialization by throwing NotSerializableException"></a><p class="codesample"><strong>Listing 2-4&nbsp;&nbsp;</strong>Example of a class that disallows serialization and deserialization by throwing NotSerializableException</p><div class="codesample"><table><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * This class must inhibit serialization and deserialization<span></span></pre></td></tr><tr><td scope="row"><pre> * of its instances.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class SuperSecret extends GeneralInfo {<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Prevents deserialization.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void readObject(ObjectInputStream stream) throws IOException,<span></span></pre></td></tr><tr><td scope="row"><pre>                    ClassNotFoundException {<span></span></pre></td></tr><tr><td scope="row"><pre>        throws new java.io.NotSerializableException("SuperSecret");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Prevents serialization.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void writeObject(ObjectOutputStream stream) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        throws new java.io.NotSerializableException("SuperSecret");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000179-SW8" title="Validation of Deserialized Data"></a><h2>Validation of Deserialized Data</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_100"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_101"></a>Sometimes, especially when deserializing objects with transient or static fields, you may want to validate an object before it is returned to the method that invoked <code>readObject</code>. To do that, you invoke the <code>registerValidation</code> method to tell the ObjectInputStream which object to notify when the deserialized object graph has been restored, but before <code>readObject</code> returns. The callback method is named <code>validateObject</code>. If the object's data is invalid, <code>validateObject</code> throws an InvalidObjectException<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_102"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_103"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_104"></a>. For more information, see the API documentation on <code>java.io.ObjectInputStream</code>, <code>java.io.ObjectInputValidation</code>, <code>java.io.InvalidObjectException</code>, and <code>com.webobjects.foundation.xml.NSXMLObjectInputStream</code>.</p><p><span class="content_text">Listing 2-5</span> shows an example of a class that validates the data of an object using <code>validateObject</code><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_105"></a>. In this case, the validation code is contained in the class of the object being deserialized, but this need not be the case. You may instead choose to have a validation class that contains all XML-document validation logic.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_106"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_107"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW9" title="Listing 2-5Example of a class that validates deserialized data"></a><p class="codesample"><strong>Listing 2-5&nbsp;&nbsp;</strong>Example of a class that validates deserialized data</p><div class="codesample"><table><tr><td scope="row"><pre>import java.io.InvalidObjectException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.IOException;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectInputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectInputValidation;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.ObjectOutputStream;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.io.Serializable;<span></span></pre></td></tr><tr><td scope="row"><pre>import java.sql.Timestamp;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/**<span></span></pre></td></tr><tr><td scope="row"><pre> * Manages movie information.<span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre>public class ValidMovie extends Object implements ObjectInputValidation, Serializable {<span></span></pre></td></tr><tr><td scope="row"><pre>    ...<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Serializes this object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param stream    object stream to serialize this object to<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void writeObject(ObjectOutputStream stream) throws IOException {<span></span></pre></td></tr><tr><td scope="row"><pre>        ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Deserializes this object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @param stream   object stream from which the serialized data<span></span></pre></td></tr><tr><td scope="row"><pre>     *                 is obtained<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    private void readObject(ObjectInputStream stream) throws IOException,<span></span></pre></td></tr><tr><td scope="row"><pre>                    ClassNotFoundException {<span></span></pre></td></tr><tr><td scope="row"><pre>        ...<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    /**<span></span></pre></td></tr><tr><td scope="row"><pre>     * Validates a deserialized ValidMovie object.<span></span></pre></td></tr><tr><td scope="row"><pre>     *<span></span></pre></td></tr><tr><td scope="row"><pre>     * @throws InvalidObjectException when the deserialized ValidMovie<span></span></pre></td></tr><tr><td scope="row"><pre>     *         is not valid.<span></span></pre></td></tr><tr><td scope="row"><pre>     */<span></span></pre></td></tr><tr><td scope="row"><pre>    public void validateObject() throws InvalidObjectException {<span></span></pre></td></tr><tr><td scope="row"><pre>        // Determine validity of this object.<span></span></pre></td></tr><tr><td scope="row"><pre>        boolean valid = someValidationMethod();<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>        if (!valid) {<span></span></pre></td></tr><tr><td scope="row"><pre>            throw new InvalidObjectException("Deserialized ValidMovie object contains invalid data.");<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000179-SW10" title="Multiple Class Version Support"></a><h2>Multiple Class Version Support</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_108"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_109"></a>Both binary serialization in Java and XML serialization in WebObjects allow you to support more than one version of the same class for serialization and deserialization.</p><p>When dealing with multiple versions of a class, you must keep the class's identity in mind. Classes are identified by their name and API. For versioning to succeed, you must ensure that the changes you make when creating a new version of a class are compatible with the previous version. In other words, the new class's API must be a superset of the API defined in the previous version.</p><p>You can address versioning by implementing and maintaining <code>writeObject</code> and <code>readObject</code> in a class. However, binary serialization and, by extension, XML serialization provide facilities for the automatic management of multiple versions of an evolving, serializable class. In particular, binary and XML serialization provide support for bidirectional communication between class versions. This means that a class can read data serialized by a newer version. It also allows a class to write a stream from which an instance of a previous version can be successfully created.</p><p>When a later version of a class adds fields to the class, you need to initialize only the added fields when deserializing data from a stream created with the previous version of the class. However, when the new version changes field usage and you need to map fields of the new version to fields of the old version or perform conversions on existing fields, you can take advantage of the ObjectStreamField class. See "Advanced Object Serialization," located at <span class="content_text"><a href="http://developer.java.sun.com/developer/technicalArticles/ALT/index.html" target="_blank">http://developer.java.sun.com/developer/technicalArticles/ALT/index.html</a></span> for details.</p><p><span class="content_text">Listing 2-1</span> lists compatible and incompatible changes for new class versions. It summarizes the information provided in Sun's <em>Java Object Serialization Specification</em>.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_110"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_111"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW11" title="Table 2-1Compatible and incompatible changes for new class versions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong>Table 2-1&nbsp;&nbsp;</strong>Compatible and incompatible changes for new class versions</caption><tr><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Change</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Compatible</p></th><th scope="col" align="left" style="font-weight: bold" bgcolor="#CCCCCC"><p>Incompatible</p></th></tr><tr><td  scope="row"><p>Adding fields, or changing a field from transient to nontransient or static to nonstatic.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Adding fields, or changing a field from transient to nontransient or static to nonstatic.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Adding classes or implementing <code>java.io.Serializable</code>.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Removing classes or removing <code>extends Serializable</code> from a class declaration.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Adding <code>writeObject</code> and <code>readObject</code> methods.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Removing <code>writeObject</code> and <code>readObject</code> methods.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Changing a field's access modifier.</p></td><td ><p>x</p></td><td ><p></p></td></tr><tr><td  scope="row"><p>Deleting fields.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Modifying the class hierarchy.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Changing a field from nontransient to transient or nonstatic to static.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Changing the type of a field.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Changing <code>writeObject</code> so that it no longer writes default field data.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Changing <code>readObject</code> so that it reads default field data when the previous version does not write default field data.</p></td><td ><p></p></td><td ><p>x</p></td></tr><tr><td  scope="row"><p>Changing a class from Serializable to Externalizable or from Externalizable to Serializable.</p></td><td ><p></p></td><td ><p>x</p></td></tr></table></div><a name="//apple_ref/doc/uid/TP30000179-SW12" title="Serialization With Keys"></a><h2>Serialization With Keys</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_112"></a>WebObjects XML serialization provides a useful feature: the ability to serialize objects and data with keys. To use this feature you add an additional argument to <code>writeObject</code> and <code>write</code> method invocations: the key, which is a String object.</p><p>Adding keys to your XML documents can help in performing useful transformations; that is, you can use the keys in the source document to create the elements in the target document. For example, the element <code>&lt;int>32&lt;/int></code> (created by executing <code>writeInt(32)</code>) provides no information about the integer 32. However, if you use <code>writeInt(32, "age")</code> to serialize the value, a transformation script can use the additional information about the datum to create the element <code>&lt;age>32&lt;/age></code>. See <span class="content_text"><a href="../Transforming/Transforming.html#//apple_ref/doc/uid/TP30000182-SW6">“Transforming Primitive-Type Values Using Keys”</a></span> for details.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_113"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW13" title="Application Security"></a><h2>Application Security</h2><p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_114"></a>Generally, security-minded environments run Sun's security manager to protect their systems from potentially damaging activities by malicious applications. The security manager is disabled by default. You activate the security manager by adding</p><div class="codesample"><table><tr><td scope="row"><pre>-Djava.security.manager<span></span></pre></td></tr></table></div><p>to the command line when launching the application manually or to the application project's <code>Properties</code> file, located in the Resources group. For more information on the security manager, see <em>Security in Java 2 SDK 1.2</em>, located at <span class="content_text"><a href="http://java.sun.com/docs/books/tutorial/index.html" target="_blank">http://java.sun.com/docs/books/tutorial/index.html</a></span>.</p><p>If you use the security manager, you must add the policy shown in <span class="content_text">Listing 2-6</span> for Mac OS X systems or <span class="content_text">Listing 2-7</span> for Windows systems to the policy file for XML serialization to work correctly in WebObjects applications. Pay special attention to the lines that deal with <code>java.net.SocketPermission</code>, as they are required when the NSXMLValidation property<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_115"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_116"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_117"></a><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_118"></a> is set to <code>true</code>.<a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_119"></a></p><a name="//apple_ref/doc/uid/TP30000179-SW14" title="Listing 2-6Security-manager policies required for XML serialization in WebObjects for Mac OS X"></a><p class="codesample"><strong>Listing 2-6&nbsp;&nbsp;</strong>Security-manager policies required for XML serialization in WebObjects for Mac OS X</p><div class="codesample"><table><tr><td scope="row"><pre>grant codeBase "file:/System/Library/Frameworks/JavaFoundation.framework/Resources/Java/javafoundation.jar"<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.SerializablePermission "enableSubclassImplementation";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.RuntimePermission "XMLSerializationAccess";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.RuntimePermission "accessDeclaredMembers";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.reflect.ReflectPermission "suppressAccessChecks";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// General permissions required to read configuration files, system properties, and so on.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.FilePermission "&lt;&lt;ALL FILES>>", "read";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.util.PropertyPermission "*", "read, write";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// If the NSXMLValidation property is set to true, uncoment the following line.<span></span></pre></td></tr><tr><td scope="row"><pre>// permission java.net.SocketPermission "www.w3.org", "connect, resolve";<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>grant codeBase "file:/System/Library/Frameworks/JavaXML.framework/Resources/Java/javaxml.jar"<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>// General permissions required to read configuration files, system properties, and so on.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.FilePermission "&lt;&lt;ALL FILES>>", "read, write";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Required by Xalan during transformation.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.util.PropertyPermission "user.dir", "read";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// If the NSXMLValidation property is set to true, uncoment the following line.<span></span></pre></td></tr><tr><td scope="row"><pre>// permission java.net.SocketPermission "www.w3.org", "connect, resolve";<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>	<a name="//apple_ref/doc/uid/TP30000179-SW15" title="Listing 2-7Security-manager policies required for XML serialization in WebObjects for Windows"></a><p class="codesample"><strong>Listing 2-7&nbsp;&nbsp;</strong>Security-manager policies required for XML serialization in WebObjects for Windows</p><a name="//apple_ref/doc/uid/TP30000179-DontLinkElementID_120"></a><div class="codesample"><table><tr><td scope="row"><pre>grant codeBase "C:/Apple/Library/Frameworks/JavaFoundation.framework/Resources/Java/javafoundation.jar"<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.SerializablePermission "enableSubclassImplementation";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.RuntimePermission "XMLSerializationAccess";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.reflect.ReflectPermission "suppressAccessChecks";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.lang.RuntimePermission "accessDeclaredMembers";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// General permissions required to read configuration files, system properties, and so on.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.FilePermission "&lt;&lt;ALL FILES>>", "read";<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.util.PropertyPermission "*", "read, write";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// If the NSXMLValidation property is set to true, uncoment the following line.<span></span></pre></td></tr><tr><td scope="row"><pre>// permission java.net.SocketPermission "www.w3.org", "connect, resolve";<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>grant codeBase "C:/Apple/Library/Frameworks/JavaXML.framework/Resources/Java/javaxml.jar"<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>// General permissions required to read configuration files, system properties, and so on.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.io.FilePermission "&lt;&lt;ALL FILES>>", "read, write";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// Required by Xalan during transformation.<span></span></pre></td></tr><tr><td scope="row"><pre>permission java.util.PropertyPermission "user.dir", "read";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// If the NSXMLValidation property is set to true, uncoment the following line.<span></span></pre></td></tr><tr><td scope="row"><pre>// permission java.net.SocketPermission "www.w3.org", "connect, resolve";<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></table></div>	

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../Introduction/Introduction.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../Serializing/Serializing.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2002, 2005 Apple Computer, Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2005-08-11<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/WebObjects/XML_Serialization/Serialization/Serialization.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/WebObjects/XML_Serialization/Serialization/Serialization.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/WebObjects/XML_Serialization/Serialization/Serialization.html%3Fid%3DTP40000976-2.2&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>