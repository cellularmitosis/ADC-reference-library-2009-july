<html><head><title>Mac OS X Developer Tools
 Manual Page For fcntl(2)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/2/fcntl" title="Mac OS X Developer Tools
 Manual Page for fcntl(2)"><!-- headerDoc=man; indexgroup=Section 2; uid="//apple_ref/doc/man/2/fcntl"; name=fcntl(2) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac&nbsp;OS&nbsp;X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="../man1/man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>

<p style='text-align:justify;'>This manual page is associated with the Mac&nbsp;OS&nbsp;X
developer tools.  The software or headers described may not be present on your
Mac&nbsp;OS&nbsp;X installation until you install the developer tools
package.  This package is available on your Mac&nbsp;OS&nbsp;X installation DVD,
and the latest versions can be downloaded from
<a href="http://developer.apple.com/tools/download/">developer.apple.com</a>.</p>

<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
FCNTL(2)                    BSD System Calls Manual                   FCNTL(2)

<b>NAME</b>
     <b>fcntl</b> -- file control

<b>SYNOPSIS</b>
     <b>#include</b> <b>&lt;fcntl.h&gt;</b>

     <u>int</u>
     <b>fcntl</b>(<u>int</u> <u>fildes</u>, <u>int</u> <u>cmd</u>, <u>...</u>);

<b>DESCRIPTION</b>
     <b>Fcntl</b>() provides for control over descriptors.  The argument <u>fildes</u> is a descriptor to be operated on
     by <u>cmd</u> as follows:

     F_DUPFD            Return a new descriptor as follows:

                            <b></b><b><u>oo</u></b>   Lowest numbered available descriptor greater than or equal to <u>arg</u>.
                            <b></b><b><u>oo</u></b>   Same object references as the original descriptor.
                            <b></b><b><u>oo</u></b>   New descriptor shares the same file offset if the object was a file.
                            <b></b><b><u>oo</u></b>   Same access mode (read, write or read/write).
                            <b></b><b><u>oo</u></b>   Same file status flags (i.e., both file descriptors share the same file sta-<font color="#ffffff" class="whiteout">tus&nbsp;status</font>
                                tus flags).
                            <b></b><b><u>oo</u></b>   The close-on-exec flag associated with the new file descriptor is set to
                                remain open across <!-- a -->execv(2)<!-- /a --> system calls.

     F_GETFD            Get the close-on-exec flag associated with the file descriptor <u>fildes</u>.  If the low-<font color="#ffffff" class="whiteout">order&nbsp;loworder</font>
                        order bit of the returned value is 0, the file will remain open across <b>exec</b>(), oth-<font color="#ffffff" class="whiteout">erwise&nbsp;otherwise</font>
                        erwise the file will be closed upon execution of <b>exec</b>() (<u>arg</u> is ignored).

     F_SETFD            Set the close-on-exec flag associated with <u>fildes</u> to the low order bit of <u>arg</u> (0 or
                        1 as above).

     F_GETFL            Get descriptor status flags, as described below (<u>arg</u> is ignored).

     F_SETFL            Set descriptor status flags to <u>arg</u>.

     F_GETOWN           Get the process ID or process group currently receiving SIGIO and SIGURG signals;
                        process groups are returned as negative values (<u>arg</u> is ignored).

     F_SETOWN           Set the process or process group to receive SIGIO and SIGURG signals; process groups
                        are specified by supplying <u>arg</u> as negative, otherwise <u>arg</u> is interpreted as a
                        process ID.

     F_GETPATH          Get the path of the file descriptor <u>Fildes</u>.  The argument must be a buffer of size
                        <b>MAXPATHLEN</b> or greater.

     F_PREALLOCATE      Preallocate file storage space.

     F_SETSIZE          Truncate a file without zeroing space.  The calling process must have root privi-<font color="#ffffff" class="whiteout">leges.&nbsp;privileges.</font>
                        leges.

     F_RDADVISE         Issue an advisory read async with no copy to user.

     F_RDAHEAD          Turn read ahead off/on.  A zero value in <u>arg</u> disables read ahead.  A non-zero value
                        in <u>arg</u> turns read ahead on.

     F_READBOOTSTRAP    Read bootstrap from disk.

     F_WRITEBOOTSTRAP   Write bootstrap on disk.  The calling process must have root privileges.

     F_NOCACHE          Turns data caching off/on. A non-zero value in <u>arg</u> turns data caching off.  A value
                        of zero in <u>arg</u> turns data caching on.

     F_LOG2PHYS         Get disk device information.  Currently this only includes the disk device address
                        that corresponds to the current file offset.

     F_FULLFSYNC        Does the same thing as <a href="fsync.2.html#//apple_ref/doc/man/2/fsync">fsync(2)</a> then asks the drive to flush all buffered data to
                        the permanent storage device (<u>arg</u> is ignored).  This is currently implemented on
                        HFS, MS-DOS (FAT), and Universal Disk Format (UDF) file systems.  The operation may
                        take quite a while to complete.  Certain FireWire drives have also been known to
                        ignore the request to flush their buffered data.

     The flags for the F_GETFL and F_SETFL commands are as follows:

           O_NONBLOCK   Non-blocking I/O; if no data is available to a read call, or if a write operation
                        would block, the read or write call returns -1 with the error EAGAIN.

           O_APPEND     Force each write to append at the end of file; corresponds to the O_APPEND flag of
                        <a href="open.2.html#//apple_ref/doc/man/2/open">open(2)</a>.

           O_ASYNC      Enable the SIGIO signal to be sent to the process group when I/O is possible, e.g.,
                        upon availability of data to be read.

     Several commands are available for doing advisory file locking; they all operate on the following
     structure:

             struct flock {
                 off_t       l_start;    /* starting offset */
                 off_t       l_len;      /* len = 0 means until end of file */
                 pid_t       l_pid;      /* lock owner */
                 short       l_type;     /* lock type: read/write, etc. */
                 short       l_whence;   /* type of l_start */
             };

     The commands available for advisory record locking are as follows:

     F_GETLK    Get the first lock that blocks the lock description pointed to by the third argument, <u>arg</u>,
                taken as a pointer to a <u>struct</u> <u>flock</u> (see above).  The information retrieved overwrites the
                information passed to <b>fcntl</b> in the <u>flock</u> structure.  If no lock is found that would prevent
                this lock from being created, the structure is left unchanged by this function call except
                for the lock type which is set to F_UNLCK.

     F_SETLK    Set or clear a file segment lock according to the lock description pointed to by the third
                argument, <u>arg</u>, taken as a pointer to a <u>struct</u> <u>flock</u> (see above).  F_SETLK is used to estab-<font color="#ffffff" class="whiteout">lish&nbsp;establish</font>
                lish shared (or read) locks (F_RDLCK) or exclusive (or write) locks, (F_WRLCK), as well as
                remove either type of lock (F_UNLCK).  If a shared or exclusive lock cannot be set, <b>fcntl</b>
                returns immediately with EACCES.

     F_SETLKW   This command is the same as F_SETLK except that if a shared or exclusive lock is blocked by
                other locks, the process waits until the request can be satisfied.  If a signal that is to
                be caught is received while <b>fcntl</b> is waiting for a region, the <b>fcntl</b> will be interrupted if
                the signal handler has not specified the SA_RESTART (see <a href="sigaction.2.html#//apple_ref/doc/man/2/sigaction">sigaction(2)</a>).

     When a shared lock has been set on a segment of a file, other processes can set shared locks on that
     segment or a portion of it.  A shared lock prevents any other process from setting an exclusive lock on
     any portion of the protected area.  A request for a shared lock fails if the file descriptor was not
     opened with read access.

     An exclusive lock prevents any other process from setting a shared lock or an exclusive lock on any
     portion of the protected area.  A request for an exclusive lock fails if the file was not opened with
     write access.

     The value of <u>l</u><b>_</b><u>whence</u> is SEEK_SET, SEEK_CUR, or SEEK_END to indicate that the relative offset, <u>l</u><b>_</b><u>start</u>
     bytes, will be measured from the start of the file, current position, or end of the file, respectively.
     The value of <u>l</u><b>_</b><u>len</u> is the number of consecutive bytes to be locked.  If <u>l</u><b>_</b><u>len</u> is negative, the result
     is undefined.  The <u>l</u><b>_</b><u>pid</u> field is only used with F_GETLK to return the process ID of the process hold-<font color="#ffffff" class="whiteout">ing&nbsp;holding</font>
     ing a blocking lock.  After a successful F_GETLK request, the value of <u>l</u><b>_</b><u>whence</u> is SEEK_SET.

     Locks may start and extend beyond the current end of a file, but may not start or extend before the
     beginning of the file.  A lock is set to extend to the largest possible value of the file offset for
     that file if <u>l</u><b>_</b><u>len</u> is set to zero. If <u>l</u><b>_</b><u>whence</u> and <u>l</u><b>_</b><u>start</u> point to the beginning of the file, and
     <u>l</u><b>_</b><u>len</u> is zero, the entire file is locked.  If an application wishes only to do entire file locking, the
     <a href="flock.2.html#//apple_ref/doc/man/2/flock">flock(2)</a> system call is much more efficient.

     There is at most one type of lock set for each byte in the file.  Before a successful return from an
     F_SETLK or an F_SETLKW request when the calling process has previously existing locks on bytes in the
     region specified by the request, the previous lock type for each byte in the specified region is
     replaced by the new lock type.  As specified above under the descriptions of shared locks and exclusive
     locks, an F_SETLK or an F_SETLKW request fails or blocks respectively when another process has existing
     locks on bytes in the specified region and the type of any of those locks conflicts with the type spec-<font color="#ffffff" class="whiteout">ified&nbsp;specified</font>
     ified in the request.

     This interface follows the completely stupid semantics of System V and IEEE Std 1003.1-1988
     (``POSIX.1'') that require that all locks associated with a file for a given process are removed when
     <u>any</u> file descriptor for that file is closed by that process.  This semantic means that applications
     must be aware of any files that a subroutine library may access.  For example if an application for
     updating the password file locks the password file database while making the update, and then calls
     <!-- a -->getpwname(3)<!-- /a --> to retrieve a record, the lock will be lost because <!-- a -->getpwname(3)<!-- /a --> opens, reads, and closes
     the password database.  The database close will release all locks that the process has associated with
     the database, even if the library routine never requested a lock on the database.  Another minor seman-<font color="#ffffff" class="whiteout">tic&nbsp;semantic</font>
     tic problem with this interface is that locks are not inherited by a child process created using the
     <a href="fork.2.html#//apple_ref/doc/man/2/fork">fork(2)</a> function.  The <a href="flock.2.html#//apple_ref/doc/man/2/flock">flock(2)</a> interface has much more rational last close semantics and allows locks
     to be inherited by child processes.  <!-- a -->Flock(2)<!-- /a --> is recommended for applications that want to ensure the
     integrity of their locks when using library routines or wish to pass locks to their children.  Note
     that <a href="flock.2.html#//apple_ref/doc/man/2/flock">flock(2)</a> and fcntl(2) locks may be safely used concurrently.

     All locks associated with a file for a given process are removed when the process terminates.

     A potential for deadlock occurs if a process controlling a locked region is put to sleep by attempting
     to lock the locked region of another process.  This implementation detects that sleeping until a locked
     region is unlocked would cause a deadlock and fails with an EDEADLK error.

     The F_PREALLOCATE command operates on the following structure:

             typedef struct fstore {
                 u_int32_t fst_flags;      /* IN: flags word */
                 int       fst_posmode;    /* IN: indicates offset field */
                 off_t     fst_offset;     /* IN: start of the region */
                 off_t     fst_length;     /* IN: size of the region */
                 off_t     fst_bytesalloc; /* OUT: number of bytes allocated */
             } fstore_t;

     The flags (fst_flags) for the F_PREALLOCATE command are as follows:

           F_ALLOCATECONTIG   Allocate contiguous space.

           F_ALLOCATEALL      Allocate all requested space or no space at all.

     The position modes (fst_posmode) for the F_PREALLOCATE command indicate how to use the offset field.
     The modes are as follows:

           F_PEOFPOSMODE   Allocate from the physical end of file.

           F_VOLPOSMODE    Allocate from the volume offset.

     The F_RDADVISE command operates on the following structure which holds information passed from the user
     to the system:

             struct radvisory {
                off_t   ra_offset;  /* offset into the file */
                int     ra_count;   /* size of the read     */
             };





     The F_READBOOTSTRAP and F_WRITEBOOTSTRAP commands operate on the following structure.

             typedef struct fbootstraptransfer {
                 off_t fbt_offset;       /* IN: offset to start read/write */
                 size_t fbt_length;      /* IN: number of bytes to transfer */
                 void *fbt_buffer;       /* IN: buffer to be read/written */
             } fbootstraptransfer_t;

     The F_LOG2PHYS command operates on the following structure.

             struct log2phys {
                 u_int32_t   l2p_flags;              /* unused so far */
                 off_t       l2p_contigbytes;        /* unused so far */
                 off_t       l2p_devoffset;      /* bytes into device */
             };

<b>RETURN</b> <b>VALUES</b>
     Upon successful completion, the value returned depends on <u>cmd</u> as follows:

           F_DUPFD    A new file descriptor.

           F_GETFD    Value of flag (only the low-order bit is defined).

           F_GETFL    Value of flags.

           F_GETOWN   Value of file descriptor owner.

           other      Value other than -1.

     Otherwise, a value of -1 is returned and <u>errno</u> is set to indicate the error.

<b>ERRORS</b>
     The <b>fcntl</b>() system call will fail if:

     [EACCES]           The argument <u>cmd</u> is F_SETLK, the type of lock <u>(l</u><b>_</b><u>type)</u> is a shared lock (F_RDLCK) or
                        exclusive lock (F_WRLCK), and the segment of a file to be locked is already exclu-<font color="#ffffff" class="whiteout">sive-locked&nbsp;exclusive-locked</font>
                        sive-locked by another process; or the type is an exclusive lock and some portion of
                        the segment of a file to be locked is already shared-locked or exclusive-locked by
                        another process.

                        The argument <u>cmd</u> is either F_SETSIZE or F_WRITEBOOTSTRAP and the calling process
                        does not have root privileges.

     [EBADF]            <u>Fildes</u> is not a valid open file descriptor.

                        The argument <u>cmd</u> is F_SETLK or F_SETLKW, the type of lock <u>(l</u><b>_</b><u>type)</u> is a shared lock
                        (F_RDLCK), and <u>fildes</u> is not a valid file descriptor open for reading.

                        The argument <u>cmd</u> is F_SETLK or F_SETLKW, the type of lock <u>(l</u><b>_</b><u>type)</u> is an exclusive
                        lock (F_WRLCK), and <u>fildes</u> is not a valid file descriptor open for writing.

                        The argument <u>cmd</u> is F_PREALLOCATE and the calling process does not have file write
                        permission.

                        The argument <u>cmd</u> is F_LOG2PHYS and <u>fildes</u> is not a valid file descriptor open for
                        reading.

     [EDEADLK]          The argument <u>cmd</u> is F_SETLKW, and a deadlock condition was detected.

     [EINTR]            The argument <u>cmd</u> is F_SETLKW, and the function was interrupted by a signal.

     [EINVAL]           <u>Cmd</u> is F_DUPFD and <u>arg</u> is negative or greater than the maximum allowable number (see
                        <a href="getdtablesize.2.html#//apple_ref/doc/man/2/getdtablesize">getdtablesize(2)</a>).

                        The argument <u>cmd</u> is F_GETLK, F_SETLK, or F_SETLKW and the data to which <u>arg</u> points
                        is not valid, or <u>fildes</u> refers to a file that does not support locking.

                        The argument <u>cmd</u> is F_PREALLOCATE and the <u>fst</u><b>_</b><u>posmode</u> is not a valid mode, or when
                        F_PEOFPOSMODE is set and <u>fst</u><b>_</b><u>offset</u> is a non-zero value, or when F_VOLPOSMODE is set
                        and <u>fst</u><b>_</b><u>offset</u> is a negative or zero value.

                        The argument <u>cmd</u> is either F_READBOOTSTRAP or F_WRITEBOOTSTRAP and the operation was
                        attempted on a non-HFS disk type.

     [EMFILE]           <u>Cmd</u> is F_DUPFD and the maximum allowed number of file descriptors are currently
                        open.

     [EMFILE]           The argument <u>cmd</u> is F_DUPED and the maximum number of file descriptors permitted for
                        the process are already in use, or no file descriptors greater than or equal to <u>arg</u>
                        are available.

     [ENOLCK]           The argument <u>cmd</u> is F_SETLK or F_SETLKW, and satisfying the lock or unlock request
                        would result in the number of locked regions in the system exceeding a system-<font color="#ffffff" class="whiteout">imposed&nbsp;systemimposed</font>
                        imposed limit.

     [EOVERFLOW]        A return value would overflow its representation.  For example, <u>cmd</u> is F_GETLK,
                        F_SETLK, or F_SETLKW and the smallest (or, if l_len is non-zero, the largest) offset
                        of a byte in the requested segment will not fit in an object of type off_t.

     [ESRCH]            <u>Cmd</u> is F_SETOWN and the process ID given as argument is not in use.

<b>SEE</b> <b>ALSO</b>
     <a href="close.2.html#//apple_ref/doc/man/2/close">close(2)</a>, <a href="execve.2.html#//apple_ref/doc/man/2/execve">execve(2)</a>, <a href="flock.2.html#//apple_ref/doc/man/2/flock">flock(2)</a>, <a href="getdtablesize.2.html#//apple_ref/doc/man/2/getdtablesize">getdtablesize(2)</a>, <a href="open.2.html#//apple_ref/doc/man/2/open">open(2)</a>, <!-- a -->sigaction(3)<!-- /a -->

<b>HISTORY</b>
     The <b>fcntl</b>() function call appeared in 4.2BSD.

4.2 Berkeley Distribution      January 12, 1994      4.2 Berkeley Distribution
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man2/fcntl.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man2/fcntl.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man2/fcntl.2.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
