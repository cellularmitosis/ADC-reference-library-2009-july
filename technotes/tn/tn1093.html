<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><!--Includes revisions to code listings--><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1093: QuickDraw GX 'rdip' Resources: The Number of the Beast</title>    <meta name="keywords" content="Mac OS 8 QuickDraw GX raster printer driver rdip resource">    <meta name="Description" content="Technical Note TN1093: The information in this Technote isstill relevant up to and including Mac OS 7.6 with QuickDrawGX 1.1.5. Apple no longer supports QuickDraw GX Printing.This Technical Note discusses the  	'rdip' resource, theplane flags in the 'rdip' and their influence  on other fields.This note also details how to patch the 'rdip' on the flyand how to render each plane in its entirety."> <meta name="categories" content="QuickDraw GX"><meta name="week-posted" content="Jan 27, 1997 - Feb 7, 1997"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002933" title="QuickDraw GX 'rdip' Resources: The Number of the Beast"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxMacOS9Earlier-date.html">Mac OS 9 & Earlier</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/index.html" target="_blank">Reference Library</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1093</div>
<div id="pageheadsub">QuickDraw GX 'rdip' Resources: The Number of the Beast</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                   <td background="images/tnmenubody.gif" width=300 align=left>                        <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc -->   <P id = "menutext"> <A HREF = "#Section1">The <CODE>'rdip'</CODE> Resource - What Can It Do?</a><BR><BR>    <A HREF = "#Section2">The Planes</a><BR><BR>    <A HREF = "#Section3">Patching the Raster Preferences on the Fly</a><BR><BR>    <A HREF = "#Section4">Printing Each Plane in its Entirety</a><BR><BR>    <A HREF = "#Summary">Summary</a> <BR><BR>    <A HREF="#References">References</A><BR><BR> <A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>		<td width=300 valign="top" align=left>	<!-- begin_intro_text --><P id = "introtext"> QuickDraw GX's     raster preferences (<CODE>'rdip'</CODE>) resource gives raster printerdriver developers a great deal of control over how an image is renderedfor a printer -- without having to write the renderer themselves.However, due to sparse documentation, many developers have becomeconfused as how to make best use of its features. This Technote: </p><UL TYPE=DISC>    <LI> <P id = "introtext"> discusses the plane flags in the <CODE>'rdip'</CODE>     and their influence on other fields </p></li>    <LI> <P id = "introtext"> how to patch the <CODE>'rdip'</CODE> on the fly </p> </li>    <LI> <P id = "introtext"> how to render each plane in its entirety</p> </li></UL><P id = "introtext">To get the best out of this Note, I would strongly suggest looking atthe <A HREF = "downloads/tn_1093.1.hqx">"<B>IW-Half-Dither</B>"</A> sample code. This can be found on the Developer CDseries: Tool Chest Edition or by clicking <A HREF = "downloads/tn_1093.1.hqx">here</A>.</P><P id = "introtext">This Note is primarily intended for QuickDraw GX raster printer driverdevelopers who wish to use the <CODE>'rdip'</CODE> resource in their printer drivers.It uses examples geared for CMYK printers.</P><BR><CENTER><TABLE BORDER=0 WIDTH=275><TR><td bgcolor="#E6E6E6" align=left><P id = introtext><B> Important for all Apple Printing and Graphics Developers:</B><BR>content</P><P id = introtext>        The information in this Technote is still relevant up to and including        <A HREF = "tn1090.html">Mac OS 7.6</A>        with QuickDraw GX 1.1.5. Beginning with the release of Mac OS 8.0,        however, Apple plans to deliver a system which incorporates QuickDraw GX        graphics and typography <B>only</B>. QuickDraw GX printer drivers and GX printing        extensions will <B>not</B> be supported in Mac OS 8.0 or in future Mac OS releases. Apple's        goal is to simplify the user experience of printing by unifying the Macintosh        graphic and printing architectures and standardizing on the classic Printing        Manager. </P>        </TD></TR></TABLE></CENTER><BR>    <!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 11 1997]</h3><!-- end_date -->                </TD>             </TR>          </TABLE> <!-- end_header_box --><BR><BR><hr width=500 align=center><BR><BR><!-- begin_content -->    <a name="Section1"></a>    <H2>The <CODE>'rdip'</CODE> Resource - What Can It Do?</h2>        <P>The 'Raster Preferences' or <CODE>'rdip'</CODE> resource allows you to control howQuickDraw GX renders an image for raster-based printers. It has flagswhich, when set up correctly, allow you to choose between a dithered ora halftone image. It can be used to control the internal renderingengine of QuickDraw GX.</P><P>The various parameters are described on <a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">pages 6-66 to 6-72</A> of <I>InsideMacintosh: QuickDraw GX Printing Extensions and Drivers</I>. This section in<I>Inside Macintosh</I> describes each of the parameters but does not reallyexplain how they interact with each other. A definition of the structureis shown below. It uses the names used by a related data structure -<CODE>gxRasterPrefsRec</CODE>.</P><P>The data structure initially looks quite complicated but can be brokendown into two sections: general setup information and planes. The valuesfor each plane information depend on whether you require halftoning ordithering. Planes can be considered to be each rendering generated byQuickDraw GX. In general, a dithered image can be created within 1plane, whereas a halftone image requires 4 planes. If you try to createa halftone image within 1 plane, black will not be handled correctly.The other advantage of four planes is that you can vary the angles.</P>    <H3>Definition</h3>        <P>    The raster preferences (<CODE>'rdip'</CODE>) resource,     of type <CODE>gxRasterPrefsType</CODE>,    controls the rendering options for a raster driver. This resource is    required for all raster printer drivers.    </P>        <P>    The structure of raster preferences resources is shown in the following table:     </P>    <TABLE BORDER=1>        <TR>        <td align="left"><B><CODE>'rdip'</CODE></B></TD>         <td align="left"><B>Type</B></TD>        </TR>        <TR><td align="left"><CODE>renderOptions</CODE></TD>        <td align="left">long containing <CODE>gxRasterRenderOptions</CODE></TD>        </TR>        <TR><td align="left"><CODE>hImageRes</CODE></TD>        <td align="left">Fixed</TD>        </TR>        <TR><td align="left"><CODE>vImageRes</CODE></TD>        <td align="left">Fixed</TD>        </TR>        <TR><td align="left"><CODE>minBandSize</CODE></TD>        <td align="left">short</TD>        </TR>        <TR><td align="left"><CODE>maxBandSize</CODE></TD>        <td align="left">short</TD>        </TR>        <TR><td align="left"><CODE>ramPercentage</CODE></TD>        <td align="left">Fixed</TD>        </TR>        <TR><td align="left"><CODE>ramSlop</CODE></TD>        <td align="left">long</TD>        </TR>        <TR><td align="left"><CODE>depth</CODE></TD>        <td align="left">short</TD>        </TR>        <TR>        <td align="left"><CODE>numPlanes</CODE></TD>        <td align="left">short</TD>        </TR>    </TABLE><H4>Plane setup array: </H4><TABLE BORDER="1">        <TR><td align="left"><CODE>planeOptions</CODE></TD>        <td align="left">long containing <CODE>gxRasterPlaneOptions</CODE></TD></TR>        <TR><td align="left"><CODE>angle</CODE></TD>        <td align="left">Fixed</TD></TR>        <TR><td align="left"><CODE>frequency</CODE></TD>        <td align="left">Fixed</TD></TR>        <TR><td align="left"><CODE>method</CODE></TD>        <td align="left"><CODE>gxDotType</CODE></TD></TR>        <TR><td align="left"><CODE>tinting</CODE></TD>        <td align="left"><CODE>gxTintType</CODE></TD></TR>        <TR><td align="left"><CODE>dotColor</CODE></TD>        <td align="left"><CODE>gxColor</CODE></TD></TR>        <TR><td align="left"><CODE>backgroundColor</CODE></TD>        <td align="left"><CODE>gxColor</CODE></TD></TR>        <TR><td align="left"><CODE>tintSpace</CODE></TD>        <td align="left"><CODE>gxColorSpace</CODE></TD></TR>        <TR><td align="left"><CODE>planeSpace</CODE></TD>        <td align="left"><CODE>gxColorSpace</CODE></TD></TR>        <TR><td align="left"><CODE>planeSet</CODE></TD>        <td align="left">Resource ID of the color set or a         <CODE>gxColorSet</CODE> in the data structure</TD></TR>        <TR><td align="left"><CODE>planeProfile</CODE></TD>        <td align="left">resource ID of the color profile or a         <CODE>gxColorProfile</CODE> in the data structure</TD></TR>    </TABLE>    <H3>General Setup Information (the top bit)</h3><UL TYPE=DISC>    <LI><B>renderOptions</B>: You can use this to control how rendering occurs. Ingeneral, use the default value, <CODE>gxDefaultRaster</CODE>. This will render theimage using the default options, resolve transfer modes and render allplanes at the same time. However, in some cases, this may not beappropriate.<P>You may need to render and print one plane in its entirety beforeprinting the next plane. In this case, use <CODE>gxOnePlaneAtATime</CODE>. You willalso need to supply one plane record for every plane you need to output.See the section <A HREF = "#Section4">Printing Each Plane in its Entirety</A> later in this Note for more details.</P><P>If your printer requires all the data to be sent to it, even blankareas, use <CODE>gxSendAllBands</CODE>.</P><P><CODE>gxDontResolveTransferModes</CODE> is used to stop GX resolving transfer modesbecause your 32-bit device can do it faster. More information abouttransfer modes can be found on <a href="../../documentation/mac/GXObjects/GXObjects-2.html">page 5-11</A> of <I>Inside Macintosh: QuickDrawGX Objects</I>. For most applications, you should let GX do this for you.</P><TABLE BORDER="1"><TR><td align="left"><B>Constant</B></TD><td align="left"><B>Value</B></TD></TR><TR><td align="left"><CODE>gxDefaultRaster</CODE></TD><td align="left">0</TD></TR><TR><td align="left"><CODE>gxDontResolveTransferModes</CODE></TD><td align="left">0x01</TD></TR><TR><td align="left"><CODE>gxRenderInReverse</CODE></TD><td align="left">0x02</TD></TR><TR><td align="left"><CODE>gxOnePlaneAtATime</CODE></TD><td align="left">0x04</TD></TR><TR><td align="left"><CODE>gxSendAllBands</CODE></TD><td align="left">0x08</TD></TR></TABLE><BR></li><LI><B>hImageRes, vImageRes</B>: These are fixed point numbers that representthe horizontal and vertical resolution of your raster device. Forexample, use <CODE>0x00900000</CODE> for a 144 dpi device.<BR><BR> </li><LI><B>minBandSize</B>: This is the minimum height in pixels of each band thatis generated.<BR><BR> </li><LI><B>maxBandSize</B>: This is the maximum height of pixels for each band thatis generated. If you give it a value of 0, a whole page can begenerated.<BR><BR> </li><LI><B>ramPercentage, ramSlop</B>: These two values are used in calculating howmuch temporary memory can be used. <CODE>RamSlop</CODE> is the minimum amount of freetemporary memory that you want to leave for other applications, theFinder and the system. <CODE>RamPercentage</CODE> is the proportion of what is leftthat you want to use up. The calculation is : <BR><BR><CODE>(( Free memory - ramSlop) * ramPercentage)</CODE><P>The result of this is then rounded to a multiple of the minimum bandsize. For instance, if you want to leave 100K of memory for otherapplications and then take up half of what is left, use the values<CODE>0x00008000</CODE> for <CODE>ramPercentage</CODE> and <CODE>0x00019000</CODE> for <CODE>ramSlop</CODE>. You need to setthese values so that your driver makes use of enough temporary memory inorder to render images at reasonable speed, but not so much that itcauses an impact on the system.</P> </li><LI><B>depth</B> : The number of pixels per plane for imaging.<BR><BR> </li><LI><B>numPlanes</B> : The number of planes following. Usually, this will containthe values 1 or 4. 1 for dithered and 4 for halftone renderings. </li></UL><P><A HREF="#top">Back to top</A></P><a name="Section2"></A><H2>The Planes</h2>    <H3>Plane Options</h3>        <P>For each plane that you are generating, you need to supply planeinformation. (This part of the resource is the same as <CODE>gxPlaneSetupRec</CODE>data structure.) Usually, you will need to generate 1 for dithered, or 4planes for halftone renderings.</P><UL><LI><B>planeOptions</B> : This takes the following values.<BR><BR> <TABLE BORDER="1"><TR>    <td align="left"><B>Constant</B></TD><td align="left"><B>Value</B></TD></TR><TR>    <td align="left"><CODE>gxDefaultOffscreen</CODE></TD><td align="left">0</TD></TR><TR>    <td align="left"><CODE>gxDontSetHalftone</CODE></TD><td align="left">1</TD></TR><TR>    <td align="left"><CODE>gxDotTypeIsDitherLevel</CODE></TD><td align="left">2</TD></TR></TABLE> </li></UL><P>The other values in each plane depend on whether you require a halftonedor dithered image.</P>    <H3>Plane Values for Dithering</h3>        <P>An example of the values used in dithered planes can be found on     <a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">    page 3-63</A> of <I>Inside Macintosh: QuickDraw GX Printing Extensions and Drivers</I>.Most of the fields are unused (and therefore ignored) for a ditheredimage. For general information on QuickDraw GX's dithering, see <a href="../../documentation/mac/GXObjects/GXObjects-2.html">pages 7-10 to 7-13</A> of <I>Inside Macintosh: QuickDraw GX Objects</I>.</P><UL TYPE=DISC>    <LI><B>planeOptions</B> : This should be set to 3 ( <CODE>gxDontSetHalftone</CODE> +<CODE>gxDotTypeIsDitherLevel</CODE> ). <CODE>gxDontSetHalftone</CODE> tells QuickDraw GX that youwant to create a dithered image and <CODE>gxDotTypeIsDitherLevel</CODE> tells it touse the method parameter in the planeHalftone for the dither level.<BR><BR></li>    <LI><B>planeHalftone</B> : This contains a <CODE>gxHalftone</CODE> data structure most ofwhich is not used when dithering. However if the <CODE>gxDotTypeIsDitherLevel</CODE>constant is used in the planeOptions, then the method value is used toset the dither level.<BR><BR><TABLE BORDER="1"><TR>    <td align="left"><B>angle</B></TD>    <td align="left">Unused (set to 0)</TD></TR><TR>    <td align="left"><B>frequency</B></TD>    <td align="left">Unused (set to 0)</TD></TR><TR>    <td align="left"><B>method</B></TD>    <td align="left">This is used for the dither level.</TD></TR> <TR>    <td align="left"><B>tinting</B></TD>    <td align="left">Unused (set to <CODE>gxLuminanceTint</CODE>)</TD></TR><TR>    <td align="left"><B>dotColor</B></TD>    <td align="left">Unused (set to <CODE>gxRGBSpace, gxNoProfile,     0x0000, 0x0000, 0x0000, 0x0000</CODE>)</TD></TR><TR>    <td align="left"><B>backgroundColor</B></TD>    <td align="left">Unused (set to <CODE>gxRGBSpace,     gxNoProfile, 0x0000, 0x0000, 0x0000, 0x0000</CODE>)</TD></TR><TR>    <td align="left"><B>tintSpace</B></TD>    <td align="left">Unused (set to <CODE>gxRGBSpace</CODE>)</TD></TR></TABLE><BR> </li>    <LI><B>planeSpace</B>: This is the color space of the plane. In general, set itto <CODE>gxIndexedSpace</CODE> and supply (in the next parameter) a resource ID fora color space or a color space if it is a structure.<BR><BR> </li>    <LI><B>planeSet</B>: Either a resource ID for a color space or a color spacestructure.<BR><BR> </li>    <LI><B>planeProfile</B>: The planes color profile. You can set this to<CODE>gxNoProfile</CODE> if there isn't one.<BR><BR> </li></UL>    <H3>Plane Values for Halftoning</h3>        <P>The following section deals with generating halftone images on a CMYKprinter.</P><P>To get this to work well, you need to render each of the 4 planesseparately. For general information on QuickDraw GX's halftoning, see<a href="../../documentation/mac/GXObjects/GXObjects-2.html">pages 7-13 to 7-17</A> of <I>Inside Macintosh: QuickDraw GX Objects</I>.</P><UL TYPE=DISC>    <LI><B>planeOptions</B>: This should be set to 0 ( <CODE>gxDefaultOffscreen</CODE> ). Theother two constants are used for dithering.<BR><BR> </li>    <LI><B>planeHalftone</B>: <BR><BR> <p><B>angle</B>: This gives the apparent direction of the dots in degrees.It is a fixed point value. For example, to give a 15 degree angle, use<CODE>0x000F0000</CODE><BR><BR><B>frequency</B>: This is the size of the font in cells per inch. It is afixed point value. For example, to set it to 45 cells per inch, use<CODE>0x002D0000</CODE></p><p><B>method</B>: This defines the shape of the dot.</p><TABLE BORDER="1"><TR>    <td align="left"><B>Constant</B></TD>    <td align="left"><B>Value</B></TD></TR><TR>    <td align="left"><CODE>gxRoundDot</CODE></TD>    <td align="left">1</TD></TR><TR>    <td align="left"><CODE>gxSpiralDot</CODE></TD>    <td align="left">2</TD></TR><TR>    <td align="left"><CODE>gxSquareDot</CODE></TD>    <td align="left">3</TD></TR><TR>    <td align="left"><CODE>gxLineDot</CODE></TD>    <td align="left">4</TD></TR><TR>    <td align="left"><CODE>gxEllipticDot</CODE></TD>    <td align="left">5</TD></TR><TR>    <td align="left"><CODE>gxTriangleDot</CODE></TD>    <td align="left">6</TD></TR><TR>    <td align="left"><CODE>gxDispersedDot</CODE></TD><td align="left">7</TD></TR></TABLE><BR>          <p><B>tinting</B>: This relates to the pass that you are on andfor CMYK give it the following values.</p><TABLE BORDER="1"><TR>    <td align="left"><B>Constant</B></TD> <td align="left"><B>Value</B></TD></TR><TR>    <td align="left"><CODE>gxComponent1Tint</CODE></TD>   <td align="left"> 4</TD>   <td align="left">For the Cyan Pass</TD></TR><TR>    <td align="left"><CODE>gxComponent2Tint</CODE></TD>    <td align="left">5</TD>   <td align="left">For the Magenta Pass</TD></TR><TR>    <td align="left"><CODE>gxComponent3Tint</CODE></TD>    <td align="left">6</TD>   <td align="left">For the Yellow Pass</TD></TR><TR>    <td align="left"><CODE>gxComponent4Tint</CODE></TD>    <td align="left">7</TD>   <td align="left">For the Black Pass</TD></TR></TABLE><BR>            <B>dotColor</B>: Set this to a black dot. Any other color causes the imageto be rendered incorrectly.<BR><P><CODE>gxRGBSpace, gxNoProfile, 0x0000, 0x0000, 0x0000, 0x0000</CODE></P><P><B>backgroundColor</B>: Set this to a white dot as the background color ofprinter's is usually white (the color of paper!) </P><P><CODE>gxRGBSpace, gxNoProfile, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF</CODE></P><P><B>tintSpace</B>: Set this to the planes color space. For CMYK, setit to <CODE>gxCMYKSpace</CODE>.</P></li>    <LI><B>planeSpace</B>: This is the original color space of plane. In the case ofhalftoning set it to <CODE>gxNoSpace</CODE>.<BR><BR> </li>    <LI><B>planeSet</B>: As no color space is needed, set it to nil.<BR><BR> </li>    <LI><B>planeProfile</B>: Set this to <CODE>gxNoProfile</CODE>. </li></UL><H3>Example <CODE>'rdip'</CODE> Resource for Halftoning on an ImageWriter II</h3>    <CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>resource gxRasterPrefsType (gxRasterPrefsID, sysheap, purgeable){    gxDefaultRaster,        // default options are fine    0x00900000, 0x00900000, // 144X144 dpi device    16,                     // min band size == 2 head heights    0,                      // max band size (0 is full page)    0x00008000,             // RAM percentage (50%)    100*1024,               // RAM slop (100K)    4,                      // 4 bit device        {// YELLOW plane.        gxDefaultOffscreen,     // Use default - halftoning.        0x000F0000,             // Angle = 15 degrees        0x002D0000,             // Freq = 45        gxRoundDot,             // RoundDot dithering        gxComponent3Tint,       // Extract yellow and dither it        gxRGBSpace, gxNoProfile, 0, 0, 0, 0,                                // DotColor == black        gxRGBSpace, gxNoProfile, 0xFFFF, 0xFFFF, 0xFFFF, 0,                                // Background color == white        gxCMYKSpace,            // Convert to gxCMYKSpace before halftoning.        gxNoSpace,              // No explicit color space        gxNoSet,                // No color set        gxNoProfile,            // No profile specified// MAGENTA plane.        gxDefaultOffscreen,     // Use default - halftoning.        0x00000000,             // Angle = 0 degrees        0x002D0000,             // Freq = 45        gxRoundDot,             // RoundDot dithering        gxComponent2Tint,       // extract magenta and dither it        gxRGBSpace, gxNoProfile, 0, 0, 0, 0,                                // dotColor == black        gxRGBSpace, gxNoProfile, 0xFFFF, 0xFFFF, 0xFFFF, 0,                                // background color == white        gxCMYKSpace,            // Convert to gxCMYKSpace before halftoning.        gxNoSpace,              // No explicit color space        gxNoSet,                // No color set        gxNoProfile,            // No profile specified// CYAN plane.        gxDefaultOffscreen,     // Use default - halftoning.        0x003C0000,             // Angle = 60 degrees        0x002D0000,             // Freq = 45        gxRoundDot,             // RoundDot dithering        gxComponent1Tint,       // Extract cyan and dither it        gxRGBSpace, gxNoProfile, 0, 0, 0, 0,                                // DotColor == black        gxRGBSpace, gxNoProfile, 0xFFFF, 0xFFFF, 0xFFFF, 0,                                // Background color == white        gxCMYKSpace,            // Convert to gxCMYKSpace before halftoning.        gxNoSpace,              // No explicit color space        gxNoSet,                // No color set        gxNoProfile,            // No profile specified// BLACK plane.        gxDefaultOffscreen,     //  Use default - halftoning.        0x002D0000,             // Angle = 45 degrees        0x002D0000,             // Freq = 45        gxRoundDot,             // RoundDot dithering        gxComponent4Tint,       // Extract black and dither it        gxRGBSpace, gxNoProfile, 0, 0, 0, 0,                                // DotColor == black        gxRGBSpace, gxNoProfile, 0xFFFF, 0xFFFF, 0xFFFF, 0,                                // Background color == white        gxCMYKSpace,            // Convert to gxCMYKSpace before halftoning.        gxNoSpace,              // No explicit color space        gxNoSet,                // No color set        gxNoProfile             // No profile specified        };};</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P>    <a name="Section3"></a>    <H2>Patching the Raster Preferences on the Fly</h2>            <P>You may wish to change the way a driver renders an image. For example, ahalftone image's angles may cause moire effects with the default anglesand frequencies; a slight change can fix this. However, it is notpossible to change how a GX driver renders by simply patching the<CODE>'rdip'</CODE>.</P><P>The way to do this is by overriding the universal image message,<CODE>GXSetupImageData</CODE>, and making changes to the data passed into it. Thismessage allows you to alter the rendering information about any kind ofprinter (raster, postscript or vector); therefore, the type of datapassed to it can vary depending on what type of driver it is. Also, itis worth noting that when it is called, the information has notnecessarily been read in. Therefore, the first thing your override mustdo is to forward the message so that the default values are read in. Inthe case of a raster driver, it is passed a <CODE>gxRasterImageDataHdl</CODE>. </P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr My_GXSetupImageData ( gxRasterImageDataHdl hImageData )    {    OSErr anErr;    anErr = Forward_GXSetupImageData ( hImageData );    nrequire ( anErr, Forward_GXSetupImageData );    //    // Do the patching here    //    // The general setup information (the top bit) can    // be accessed through :    //    //       (*hImageData)-&gt;theSetup.xxxxxxx    //    // each plane's information can be accessed through    //    //       (*hImageData)-&gt;theSetup.planeSetup[0].xxxxxxx    //    Forward_GXSetupImageData:    return anErr;    }</pre>	</TD></TR></TABLE></CENTER><P>It's possible to change many or just a few of the parameters, evenwhether the image is rendered halftoned or dithered. For an example ofthis, see the <A HREF = "downloads/tn_1093.1.hqx">"IW-Half-Dither"</A> sample code.</P><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><H2>Printing Each Plane in its Entirety</h2><P>Some printers require that each plane is rendered and printed one at atime (for instance, if it has one print-head which takes a long time tochange ink color).</P><P>One way of doing this is to use the <CODE>gxOnePlaneAtATime</CODE> option in therender options. This results in ALL the raster data being sent out forevery plane that you have specified. This can cause confusion. Forexample, if you have a <CODE>'rdip'</CODE> resource with 4 planes specified, then youmight expect the <CODE>GXRasterPackageBitmap()</CODE> message to be called 4 times.This doesn't appear to be the case; in fact, it will be called 16 times- once for each plane of the 4 planes.</P><P>There are several ways of getting round this. I've found the easiest wayis to filter out the unwanted planes from the <CODE>GXRasterPackageBitmap()</CODE>message. You have to set up a counter in a global structure that keepstrack of the plane that you are currently printing and also use the <CODE>gxSendAllBands</CODE> option in the render options.</P><P>We'll call the global structure <CODE>pGlobals</CODE> and the plane parameter currentplane. In the <CODE>GXRenderPage()</CODE> message, </P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr My_GXRenderPage ( gxFormat                theFormat,                        gxShape                 thePage,                        gxPageInfoRecord        *pageInfo,                        gxRasterImageDataHdl    imageInfo)    {......    pGlobals-&gt;currentPlane = 0;......    }</pre>	</TD></TR></TABLE></CENTER><P>This makes sure the current plane counter is set to 0 before each planeis rendered.</P><P>The plane counter is incremented in the <CODE>GXRasterPackageBitmap(</CODE>) message.It checks to see if we're at the top of the page and we're trying toprint the first band. If we are, then we need to change the head colorto the currentPlane color. Also, if we are not printing the first plane,then we might need to move the head back up to the top of the page.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>OSErr My_GXRasterPackageBitmap (    gxRasterPackageBitmapRec *pPackage,    Ptr         buffer,         // data goes here + bufferPos    unsigned long   *bufferPos, // how much of the buffer already                                // is full    gxRasterImageDataHdl    hImageData) // private image data    {    ......    ......        if (   (pPackage-&gt;startRaster == 0)            &amp;&amp; (pPackage-&gt;colorBand == 1 ) )        {            pGlobals-&gt;currentPlane++;    // Change the head color    // Also do stuff to move the head back if the current plane is &gt; 1        }    ......</pre>	</TD></TR></TABLE></CENTER><P>This override also needs to filter out the unwanted data. This can besimply done by not printing it.</P><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    // See if we need to print this color band        if ( pPackage-&gt;colorBand == pGlobals-&gt;currentPlane)        {    // Now send the raster information out to the printer    ......        }</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Summary"></a><H2>Summary</h2><P>The <CODE>'rdip'</CODE> resource can very useful to QuickDraw GX printer driverdevelopers because it allows you to control how your images are renderedwithout having to write the renderer for yourself. By its very flexiblenature, it is a very complicated data structure and often needs a smallamount of experimentation to achieve the desired effect. Hopefully, thisTechnote will encourage you to write drivers that support GXtechnologies to their fullest.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><H2>References</H2>    <p><a href="../../documentation/mac/GXPrintDrivers/GXPrintDrivers-2.html">    <I>Inside Macintosh: QuickDraw GX Printing Extensions and Drivers</I></A>.</p>    <p><a href="../../documentation/mac/GXPrinting/GXPrinting-2.html">    <I>Inside Macintosh: QuickDraw GX Printing</I></A>. </p>    <p><a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">    <I>Inside Macintosh: QuickDraw GX Environment and Utilities</I></A>.</p>    <p><I>Inside Macintosh: QuickDraw GX Graphics</I> -      <a href="../../documentation/macos8/Legacy/QuickDrawGX/quickdrawgx.html">    Page 5-30, Dithering and Halftoning Bitmaps</A>. </p>    <p><I>Inside Macintosh: QuickDraw GX Objects</I> -     <a href="../../documentation/mac/GXObjects/GXObjects-2.html">    Pages 7-10 to 7-13, Dithering and pages 7-13 to 7-17, Halftone</A>. </p>    <p>Developer CD Series: Mac OS SDK Edition: Development Kits (Disc I):     Interfaces and Libraries: Interfaces: RIncludes: GXPrintingResTypes.r. </p>    <p><I>IW-Half--Dither</I>, Dev. CD Tool Chest Edition : SampleCode: QuickDraw GX: IW-Half-Dither or by clicking <A HREF = "downloads/tn_1093.1.hqx">here.</A> </p>    <p> <CITE>The Bible</CITE>, Revelations, Chapter 13, Verse 18. </p>     <P><A HREF="#top">Back to top</A></P>                           <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" alt="acrobat" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (76K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1093.pdf">Download</A></P>               </TD>            </TR>            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/redbook.gif" alt="small red folder icon" width=20 height=20 align=bottom alt="Redbook gif"></P>               </TD>               <td align="left">                  <P> Binhexed ImageWriter Half-Dither sample code (202K)</P>               </TD>               <td width=60 align=left>                  <P> <A HREF = "downloads/tn_1093.1.hqx"> Download</A></P>               </TD>            </TR>         </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1093.html%3Fid%3DDTS10002933-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1093.html%3Fid%3DDTS10002933-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1093.html%3Fid%3DDTS10002933-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --><hr width=500 align=center></BODY></HTML> 