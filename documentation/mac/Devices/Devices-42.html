<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Writing and Installing Device Drivers(IM: D)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING42></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->




<!-- Main Body -->

<CENTER>
<P>
<A HREF="Devices-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="Devices-2.html"><B>Devices</B></A> / <BR><DD><A HREF="Devices-10.html"><B>Chapter 1 - Device Manager</B></A> / <A HREF="Devices-17.html"><B>Device Manager Reference</B></A><BR><DL><DD><A HREF="Devices-21.html"><B>Device Manager Functions</B></A></DL></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING42-0></A>
<H3><A NAME=MARKER-9-375></A>Writing and Installing Device Drivers</H3>
 The Device Manager includes a number of functions that provide low-level support for device drivers.<P>
 The <CODE>DriverInstall</CODE> and <CODE>DriverInstallReserveMem</CODE> functions create a device control entry and install it in the unit table. The <CODE>DriverInstallReserveMem</CODE> function is preferred because it allocates the device control entry as low as possible in the system heap. The <CODE>DriverRemove</CODE> function removes an existing device control entry.<P>
 The <CODE>GetDCtlEntry</CODE> function returns a handle to a driver's device control entry. <P>
 The <CODE>IODone</CODE> routine notifies the Device Manager that an I/O operation is done. Driver routines call <CODE>IODone</CODE> when the current request is completed and ready to be removed from the I/O queue.<P>
 The <CODE>Fetch</CODE> and <CODE>Stash</CODE> routines can be used to move characters into and out of data buffers. You pass a pointer to the device control entry in the A1 register to each of these three routines. The Device Manager uses the device control entry to locate the active request. If no such request exists, these routines generate system error <CODE>dsIOCoreErr</CODE>.<P>
 In the interest of speed, you invoke the <CODE>Fetch</CODE>, <CODE>Stash</CODE>, and <CODE>IODone</CODE> routines with jump vectors, stored in the global variables <CODE>JFetch</CODE>, <CODE>JStash</CODE>, and <CODE>JIODone</CODE>, rather than macros. You can use a jump vector by moving its address onto the stack and executing an <CODE>RTS</CODE> instruction. An example is:<P>
<PRE>
MOVE.L   JIODone,-(SP)
RTS
</PRE>
 The <CODE>Fetch</CODE> and <CODE>Stash</CODE> routines do not return a result code; if an error occurs, the System Error Handler is invoked. <P>
<HR>
<B>Subtopics</B>
<B><!-- TOC --><DL>
<DL>
<DT><A HREF="Devices-43.html#HEADING43-0">DriverInstall</A>
<DD>
<DT><A HREF="Devices-44.html#HEADING44-0">DriverInstallReserveMem</A>
<DD>
<DT><A HREF="Devices-45.html#HEADING45-0">DriverRemove</A>
<DD>
<DT><A HREF="Devices-46.html#HEADING46-0">GetDCtlEntry</A>
<DD>
<DT><A HREF="Devices-47.html#HEADING47-0">IODone</A>
<DD>
<DT><A HREF="Devices-48.html#HEADING48-0">Fetch</A>
<DD>
<DT><A HREF="Devices-49.html#HEADING49-0">Stash</A>
<DD>
</DL>
</DL>
</B>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="Devices-41.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="Devices-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="Devices-328.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="Devices-43.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="Devices-3.html">&copy; Apple Computer, Inc.</A><br>3 JUL 1996</center></font><P>
<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->
</BODY>
</HTML>  
