<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
   "http://www.w3.org/TR/1999/REC-html401-19991224/loose.dtd">
<html>
<head>

	<!-- BEGIN META TAG INFO -->
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="home" href="http://developer.apple.com/">
	<link rel="find" href="http://developer.apple.com/search/">
	<link rel="stylesheet" type="text/css" href="../../documentation/css/adcstyle.css" title="fonts">
	<script language="JavaScript" src="../../documentation/js/adc.js" type="text/javascript"></script>
	<!-- END META TAG INFO -->
	
	<!-- BEGIN TITLE -->
	<title>Custom_HIView_Tutorial - /0_Tutorial/Drag and Drop.html</title>
	<!-- END TITLE -->
<script language="JavaScript">
function JumpToNewPage() {
	window.location=document.scpopupmenu.gotop.value;
	return true;
}
</script>

</head>

<!-- BEGIN BODY OPEN -->
<body>
<!--END BODY OPEN -->

<!-- START CENTER OPEN -->
<center>
<!-- END CENTER OPEN -->

	<!-- BEGIN LOGO AND SEARCH -->
	<!--#include virtual="/includes/adcnavbar"-->
	<!-- END LOGO AND SEARCH -->
		
		
	<!-- START BREADCRUMB -->
	<div id="breadcrumb">
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td scope="row"><img width="340" height="10" src="images/1dot.gif" alt=""></td>
			<td><img width="340" height="10" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr valign="middle">
			<td align="left" colspan="2">
			<a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../samplecode/index.html">Sample Code</a> &gt; <a href="../../samplecode/Carbon/index.html">Carbon</a> &gt; <a href="../../samplecode/Carbon/idxHumanInterfaceToolbox-date.html">Human Interface Toolbox</a> &gt; <A HREF="javascript:location.replace('index.html');">Custom_HIView_Tutorial</A> &gt; 
			</td>
		</tr>
		<tr>
			<td colspan="2" scope="row"><img width="680" height="35" src="images/1dot.gif" alt=""></td>
		</tr>
	</table>
	</div>
	<!-- END BREADCRUMB -->

	

	<!-- START MAIN CONTENT -->
	
	<!-- START TITLE GRAPHIC AND INTRO-->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td><h1><div id="pagehead">Custom_HIView_Tutorial</div></h1></td>
		</tr>
	</table>
	<!-- END TITLE GRAPHIC AND INTRO -->
	<!-- START WIDE COLUMN -->
	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr align="left" valign="top">
			<td id="scdetails">
				<h2>/0_Tutorial/Drag and Drop.html</h2>
				<form name="scpopupmenu" onSubmit="return false;" method=post>
				<p><strong>View Source Code:</strong> 
					<select name="gotop" onChange="JumpToNewPage();" style="width:340px"><option selected value="ingnore">Select File</option>
<option value="listing1.html">/0_ Tutorial Start Here.html</option>
<option value="listing2.html">/0_Tutorial/Conclusion.html</option>
<option value="listing3.html">/0_Tutorial/Custom Cursor.html</option>
<option value="listing4.html">/0_Tutorial/Drag and Drop.html</option>
<option value="listing5.html">/0_Tutorial/Minimum Requirements.html</option>
<option value="listing6.html">/0_Tutorial/Skeleton Tester.html</option>
<option value="listing7.html">/0_Tutorial/Tracking.html</option>
<option value="listing8.html">/0_Tutorial/Value and State.html</option>
<option value="listing9.html">/1_Definition_Registration_Drawing/HICustomView.c</option>
<option value="listing10.html">/1_Definition_Registration_Drawing/HICustomView.h</option>
<option value="listing11.html">/1_Definition_Registration_Drawing/HICustomView_Tester.c</option>
<option value="listing12.html">/1_Definition_Registration_Drawing/HICustomView_Tester.h</option>
<option value="listing13.html">/1_Definition_Registration_Drawing/main.c</option>
<option value="listing14.html">/2_Value_State/HICustomView.c</option>
<option value="listing15.html">/2_Value_State/HICustomView.h</option>
<option value="listing16.html">/2_Value_State/HICustomView_Tester.c</option>
<option value="listing17.html">/2_Value_State/HICustomView_Tester.h</option>
<option value="listing18.html">/2_Value_State/main.c</option>
<option value="listing19.html">/3_Basic_Tracking/HICustomView.c</option>
<option value="listing20.html">/3_Basic_Tracking/HICustomView.h</option>
<option value="listing21.html">/3_Basic_Tracking/HICustomView_Tester.c</option>
<option value="listing22.html">/3_Basic_Tracking/HICustomView_Tester.h</option>
<option value="listing23.html">/3_Basic_Tracking/main.c</option>
<option value="listing24.html">/4_Custom_Tracking/HICustomView.c</option>
<option value="listing25.html">/4_Custom_Tracking/HICustomView.h</option>
<option value="listing26.html">/4_Custom_Tracking/HICustomView_Tester.c</option>
<option value="listing27.html">/4_Custom_Tracking/HICustomView_Tester.h</option>
<option value="listing28.html">/4_Custom_Tracking/main.c</option>
<option value="listing29.html">/5_Tracking_Area/HICustomView.c</option>
<option value="listing30.html">/5_Tracking_Area/HICustomView.h</option>
<option value="listing31.html">/5_Tracking_Area/HICustomView_Tester.c</option>
<option value="listing32.html">/5_Tracking_Area/HICustomView_Tester.h</option>
<option value="listing33.html">/5_Tracking_Area/main.c</option>
<option value="listing34.html">/6_Drag_and_Dropping/HICustomView.c</option>
<option value="listing35.html">/6_Drag_and_Dropping/HICustomView.h</option>
<option value="listing36.html">/6_Drag_and_Dropping/HICustomView_Tester.c</option>
<option value="listing37.html">/6_Drag_and_Dropping/HICustomView_Tester.h</option>
<option value="listing38.html">/6_Drag_and_Dropping/main.c</option></select>
				</p>
				</form>
				<p><strong><a href="Custom_HIView_Tutorial.zip">Download Sample</a></strong> (&#147;Custom_HIView_Tutorial.zip&#148;, 1012.9K)<BR>
<strong><a href="Custom_HIView_Tutorial.dmg">Download Sample</a></strong> (&#147;Custom_HIView_Tutorial.dmg&#148;, 1.24M)</p>
				<!--
				<p><strong><a href="#">Download Sample</a></strong> (&#147;filename.sit&#148;, 500K)</p>
				-->
			</td>
		</tr>
		<tr>
			<td scope="row"><img width="680" height="10" src="images/1dot.gif" alt=""><br>
			<img height="1" width="680" src="images/1dot_919699.gif" alt=""><br>
			<img width="680" height="20" src="images/1dot.gif" alt=""></td>
		</tr>
		<tr>
			<td scope="row">
	<!--googleon: index -->
<pre class="sourcecodebox">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;
        &quot;http://www.w3.org/MarkUp/Wilbur/HTML32.dtd&quot;&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
  &lt;title&gt;Drag and Drop&lt;/title&gt;
  &lt;meta name=&quot;generator&quot; content=&quot;BBEdit 8.2&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt;
&lt;!--
.mybox {
  background-color: #F7F7F7;
  margin: 4px;
  padding: 4px;
  border: 1px solid #999999;
}
--&gt;
&lt;!--
.mycodebox {
  background-color: #F1F5F9;
  margin: 4px;
  padding: 4px;
  border: 1px solid #999999;
}
--&gt;
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;
Tutorial: Writing a custom HIView
&lt;/h1&gt;

&lt;h2&gt;
E) Implementing support for drag-and-drop
&lt;/h2&gt;

&lt;p&gt;
The support for drag-and-drop is done by handling four events: kEventControlDragEnter, kEventControlDragWithin, kEventControlDragLeave, and kEventControlDragReceive.
&lt;/p&gt;

&lt;p&gt;
This is very straightforward and, as usual, after adding those four events to the event list that we register in GetHICustomViewClass, we add the four cases in the function Internal_HICustomViewHandler. We will also add two more fields to our private data as we did when we implemented the custom tracking:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
typedef struct
   {
   HIViewRef view;                             // our view

   Boolean trackOn;                            // tracking information
   HIPoint trackSpot;

   HIViewTrackingAreaRef trackRef;             // tracking area

   Boolean dragOn;                             // drag-and-drop information
   HIPoint dragSpot;
   }
HICustomViewData;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And slightly modify the kEventHIObjectInitialize handler to turn dragging on:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
case kEventHIObjectInitialize:
   {
   // always begin kEventHIObjectInitialize by calling through to the previous handler
   status = CallNextEventHandler(inHandlerCallRef, inEvent);
   require_noerr(status, InitializeExit);
   
   // if that succeeded, do our own initialization
   status = HIViewNewTrackingArea(myData-&gt;view, NULL, 0, &amp;myData-&gt;trackRef);
   require_noerr(status, InitializeExit);

   status = SetControlDragTrackingEnabled(myData-&gt;view, true);
   require_noerr(status, InitializeExit);

InitializeExit:
   break;
   }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
When implementing the kEventControlDragEnter handler, we must ensure the proper behavior by returning correctly the right value in the kEventParamControlWouldAcceptDrop parameter. The three other drag-related handlers will be called only if the kEventControlDragEnter handler returns a &lsquo;true&rsquo; value in that parameter and the handler itself returns a status of noErr. In real-life custom HIViews, you should test the contents of the drag pasteboard for a flavor that you can accept: if you find one then return &lsquo;true&rsquo; in the parameter kEventParamControlWouldAcceptDrop, &lsquo;false&rsquo; if not. In this example, to keep it simple, it accepts all drags and tests for the flavor (text) only in the kEventControlDragReceive handler.
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
case kEventControlDragEnter:
   {
   Boolean accept = true;
   status = SetEventParameter(inEvent, kEventParamControlWouldAcceptDrop, typeBoolean, sizeof(accept), &amp;accept);
   require_noerr(status, ControlDragEnterExit);
   
   myData-&gt;dragOn = true;

ControlDragEnterExit:
   break;
   }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
Look at the implementation of the three other handlers by using the project located in the folder &ldquo;6_Drag_and_Dropping&rdquo;.
&lt;/p&gt;

&lt;p&gt;
The last thing we have to do is to add the dragging spot drawing in our kEventControlDraw handler:
&lt;/p&gt;

&lt;div class=&quot;mycodebox&quot;&gt;&lt;pre&gt;
// if we're dragging then we also draw the drag spot and the focus ring
if (myData-&gt;dragOn)
   {
   bounds = CGRectInset(viewBounds, 2, 2);
   HIThemeDrawFocusRect(&amp;bounds, true, context, kHIThemeOrientationNormal);

   CGContextBeginPath(context);
   CGContextAddArc(context, myData-&gt;dragSpot.x, myData-&gt;dragSpot.y, 10, 0, 2 * pi, 1);
   CGContextClosePath(context);
   CGContextSetRGBFillColor(context, 0.7, 0.7, 0, 0.8);
   CGContextSetRGBStrokeColor(context, 0, 0.7, 0, 0.8);
   CGContextDrawPath(context, kCGPathFillStroke);
   }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And you will see the following dragging:
&lt;/p&gt;

&lt;img src=&quot;../0_Tutorial/Picture%206.png&quot; alt=&quot;&quot; width=&quot;534&quot; height=&quot;468&quot;&gt;

&lt;br&gt;
&lt;br&gt;

&lt;a href=&quot;../0_Tutorial/Conclusion.html&quot;&gt;Next Page
&lt;/a&gt;

&lt;br&gt;
&lt;br&gt;

&lt;a href=&quot;../0_Tutorial/Custom%20Cursor.html&quot;&gt;Previous Page
&lt;/a&gt;

&lt;br&gt;
&lt;br&gt;

&lt;a href=&quot;../0_%20Tutorial%20Start%20Here.html&quot;&gt;Return to Main Page
&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre>
	<!--googleoff: index -->
			</td>
		</tr>
	</table>
	<!-- END WIDE COLUMN -->

	<!-- END MAIN CONTENT -->
		<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/samplecode/Custom_HIView_Tutorial/listing4.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/samplecode/Custom_HIView_Tutorial/listing4.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/samplecode/Custom_HIView_Tutorial/listing4.html%3Fid%3DDTS10003657-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<!-- START BOTTOM APPLE NAVIGATION -->
	<!--#include virtual="/includes/footer"-->
	<!-- END BOTTOM APPLE NAVIGATION -->

<!-- START CENTER CLOSE -->
</center>
<!-- END CENTER CLOSE -->

</body>
</html>