<html><head><title>Mac OS X
 Manual Page For shark(1)</title>
<style type="text/css"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { font-size: 1px; background: #ffffff; color: #ffffff; } --></style>
<style type="text/css" media="print, aural, braille, embossed, projection, tty"><!-- @import "../../../../adcstyle.css"; .char {background: #ffffff; color:#0000ff;}.comment {background:#ffffff; color:#236e25}.function {background:#ffffff; color:#000000;}.keyword {background:#ffffff; color:#761550;}.number {background: #ffffff; color:#0000ff;}.param {background:#ffffff; color:#000000;}.preprocessor {background:#ffffff; color:#236e25}.string {background: #ffffff; color:#891315;}.template {background:#ffffff; color:#761550;}.type {background:#ffffff; color:#761550;}.var {background:#ffffff; color:#000000;} pre.manpages {font-size: 10pt;} .graybox { border-top: 1px solid #919699; border-left: 1px solid #919699; margin-bottom: 10px; } .graybox th { padding: 4px 8px 4px 8px; background: #E2E2E2; font-size: 12px; font-weight: bold; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .graybox td { padding: 8px; font-size: 12px; text-align: left; vertical-align: top; border-bottom: 1px solid #919699; border-right: 1px solid #919699; } .whiteout { display: none; } --></style>
</head><body bgcolor="white">
<a name="//apple_ref/doc/man/1/shark" title="Mac OS X
 Manual Page for shark(1)"><!-- headerDoc=man; indexgroup=Section 1; uid="//apple_ref/doc/man/1/shark"; name=shark(1) --></a>
<!--#include virtual="/includes/framesetheader"-->
<table width=600><tr><td scope="row">
<!-- begin breadcrumb insert request --><font face="Geneva,Helvetica,Arial" size="1">
 <a target="_top" href="http://developer.apple.com">ADC Home</a> <b>&gt;</b> <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> <b>&gt;</b> <a href="../../../../../reference/index.html#//apple_ref/doc/uid/TP30001281" target="_top">Reference</a> <b>&gt;</b> <!-- a href="" target="_top" -->Mac OS X<!-- /a --> <b>&gt;</b> <a href="../index.html#//apple_ref/doc/framework/manpages" target="_top">Mac OS X Man Pages</a></font>
<!-- end breadcrumb insert request -->
<p>&nbsp;</p>
</td></tr></table>
<!-- end of header -->
<table border="0"  cellpadding="2" cellspacing="2" width="630pt"><tr><td valign="top" height="12" colspan="5" scope="row">
<p style='text-align:justify;'>This document is a Mac OS X manual page.  Manual pages are a command-line technology
for providing documentation.  You can view these manual pages locally using the
<a href="man.1.html#//apple_ref/doc/man/1/man">man(1)</a> command.
These manual pages come from many different sources, and thus, have a variety of writing
styles.</p>
<p style='text-align:justify;'>For more information about the manual page format, see the manual page for 
<a href="../man5/manpages.5.html#//apple_ref/doc/man/5/manpages">manpages(5)</a>.</p>
</td></tr></table>
<hr />
<table border="0"  cellpadding="2" cellspacing="2" width="300"><tr><td valign="top" height="12" colspan="5" scope="row"><pre class="manpages"><tt>
SHARK4(1)                 BSD General Commands Manual                <!-- a -->SHARK4(1)<!-- /a -->

<b>NAME</b>
     <b>shark</b> -- creates *.mshark profiles of system or process behavior for viewing with Shark.app.

<b>SYNOPSIS</b>
     <b>shark</b> [<b>-1</b>] [<b>-a</b> <u>process</u>] [<b>-b</b>] [<b>-c</b> <u>index</u>] [<b>-d</b> <u>path</u>] [<b>-e</b>] [<b>-f</b> <u>file</u>] [<b>-G</b>] [<b>-g</b>] [<b>-i</b>] [<b>-I</b> <u>interval</u>] [<b>-l</b>] [<b>-L</b>]
           [<b>-m</b> <u>file</u>] [<b>-N</b>] [<b>-o</b> <u>basename</u>] [<b>-q</b>] [<b>-r</b>] [<b>-S</b> <u>limit</u>] [<b>-t</b>] [<b>-T</b> <u>limit</u>] [<b>-u</b>] [<b>-x</b>] <u>[executable</u>
           <u>[args...]]</u>

<b>DESCRIPTION</b>
     <b>shark</b> helps you tune and understand your code for optimal performance.  At the simplest level, <b>shark</b>
     profiles the system to see how time is being spent. It can also produce profiles of hardware and soft-<font color="#ffffff" class="whiteout">ware&nbsp;software</font>
     ware performance events such as cache misses, virtual memory activity, instruction dependency stalls,
     system traces, and other types of profiles.  Using these profiles, you can focus your optimization
     efforts on performance-critical code.

     <b>shark</b> creates a profile of execution behavior by periodically interrupting each processor in the system
     and sampling the currently running process, thread and instruction address. Along with this contextual
     information, <b>shark</b> records the values of the available hardware and software performance counters.
     Each performance counter is capable of counting a wide variety of performance events. In the case of
     processor and memory controller counters, these include detailed, low-level information that is other-<font color="#ffffff" class="whiteout">wise&nbsp;otherwise</font>
     wise impossible to know without a simulator.

     The profiles generated by <b>shark</b> are statistical in nature; they give a representative view of what was
     running on the system during a sampling session. Samples can include all of the processes running on
     the system from both user and supervisor code.

     Sampling is controlled by:

     Immediately (-i option) - sampling begins immediately and ends when either the current max sample limit
     is reached or the launched/attached target process exits

     Hotkey - option-esc to start/stop sampling, ctrl-esc to quit (available only to the currently logged in
     user)

     Remote - (-r option) - There are several ways to toggle profiling when <b>shark</b> is in 'remote' mode. 1: A
     CHUD remote client program can be instrumented with calls to: chudStartRemotePerfMonitor()/chudStopRe-<font color="#ffffff" class="whiteout">motePerfMonitor()&nbsp;chudStartRemotePerfMonitor()/chudStopRemotePerfMonitor()</font>
     motePerfMonitor() to start/stop sampling. 2: The utility <a href="chudRemoteCtrl.1.html#//apple_ref/doc/man/1/chudRemoteCtrl">chudRemoteCtrl(1)</a> can be used on the command
     line of a terminal to start or stop the collection of performance monitor samples. 3: The UNIX signals
     SIGUSR1 and SIGUSR2 can be sent to <b>shark</b> via its process id (pid) number, to start or stop performance
     monitoring. Sending the SIGUSR1 signal toggles the start and stop of sampling.  Sending a SIGUSR2 stops
     sampling and causes a session file to be generated if need be.  When you are using <b>shark</b> over a remote
     shell (rlogin, telnet, ssh, etc.) connection, you will need to run <b>shark</b> and the <a href="chudRemoteCtrl.1.html#//apple_ref/doc/man/1/chudRemoteCtrl">chudRemoteCtrl(1)</a>
     utility in the same session (remote shell). The UNIX signal method is the most reliable.  And it works
     from a separate shell logged into the same account as the shell running <b>shark</b> In fact the <a href="chudRemoteCtrl.1.html#//apple_ref/doc/man/1/chudRemoteCtrl">chudRemoteC</a>-<font color="#ffffff" class="whiteout">trl(1)&nbsp;chudRemoteCtrl(1)</font>
     <a href="chudRemoteCtrl.1.html#//apple_ref/doc/man/1/chudRemoteCtrl">trl(1)</a> utility can send the appropriate UNIX signals to <b>shark</b> from a separate shell. But the most
     direct way to send UNIX signals is by using the <a href="kill.1.html#//apple_ref/doc/man/1/kill">kill(1)</a> utility:

         for example: % kill -s USR1 &lt;pid&gt;

         % chudRemoteCtrl -s &lt;session_name&gt; -k&lt;pid&gt;

         will start sampling using SIGUSR1; and

         % chudRemoteCtrl -e -k&lt;pid&gt;

         will stop sampling using SIGUSR2, which also creates the session file (if any).

     Profiling over a remote shell works very well if you have <b>shark</b> launch an executable that has been
     instrumented with the CHUD functions. Typical instrumentation might look like:

     //add the header file

     #include &lt;CHUD/CHUD.h&gt;

     //then in the main...

     chudInitialize();

     chudAcquireRemoteAccess();

     //just before the code to be profiled

     chudStartRemotePerfMonitor("some run label");

     //just after the code to be profiled

     chudStopRemotePerfMonitor();

     //before the program exits:

     chudReleaseRemoteAccess();

     Network Sharing (-N option) - a message is sent to the <b>shark</b> program, from another computer on the net-<font color="#ffffff" class="whiteout">work,&nbsp;network,</font>
     work, to toggle profiling. Typically, one system, on the network, is running Shark.app.  The Shark.app
     program will have been configured to manage other profiling "service" programs.  <b>shark</b> is a profiling
     service program when the '-N' option is given on the command line.  In network sharing mode <b>shark</b> can
     still be triggered by signals and by hotkeys on the local host.  The sessions generated by <b>shark</b> will
     be cached and delivered to the controlling Shark application when the Shark application requests the
     session file, or as soon as it is available, if the Shark application requests automatic delivery of
     sessions from the profiling services. One <b>shark</b> program can be run on each of many systems on the net-<font color="#ffffff" class="whiteout">work.&nbsp;network.</font>
     work.  One system running Shark.app can control profiling on all of the systems running <b>shark</b> simulta-<font color="#ffffff" class="whiteout">neously.&nbsp;simultaneously.</font>
     neously.

<b>OPTIONS</b>
     <b>-a</b> <u>process</u>  Attach to a currently running process with the specified name or PID.  If a process is not
                 given, <b>shark</b> can also optionally launch a new process from a specified executable.  If nei-<font color="#ffffff" class="whiteout">ther&nbsp;neither</font>
                 ther -a process or an executable is specified, <b>shark</b> will wait for further input (either a
                 the start/stop hotkey, option-esc, or a CHUD remote monitoring start message if remote mon-<font color="#ffffff" class="whiteout">itoring&nbsp;monitoring</font>
                 itoring is enabled).

     <b>-r</b>          Enable remote monitoring mode. In this mode <b>shark</b> waits for a CHUD remote client program to
                 call chudStartRemotePerfMonitor()/chudStopRemotePerfMonitor() to start and stop sampling.
                 (see above for more details on this option)

     <b>-i</b>          Begin sampling immediately, exiting after a session has been taken.

     <b>-I</b> <u>interval</u>
                 Change the per-sample time interval to this value. Enter the value as a number followed by
                 a suffix: for example 5m would set the per-sample time interval to 5 milliseconds.  50u
                 would change the per-sample time limit to 50 microseconds. 5s would change the per-sample
                 time limit to 5 seconds.

     <b>-S</b> <u>limit</u>    Change the sample limit to this &lt;limit&gt; number of samples.

     <b>-T</b> <u>limit</u>    Change the maximum time limit to this value. Enter the value as a number followed by a suf-<font color="#ffffff" class="whiteout">fix:&nbsp;suffix:</font>
                 fix: for example 500m would set the time limit to 500 milliseconds.  500000u would change
                 the time limit to 500000 microseconds. 22s would change the sampling time limit to 22 sec-<font color="#ffffff" class="whiteout">onds.&nbsp;seconds.</font>
                 onds.

     <b>-1</b>          Sample only the target process (specified through -a process or the launched executable).

     <b>-x</b>          Ignore task will exit notifications. Normally <b>shark</b> will be notified whenever a process
                 (task) exits while it is sampling.  This allows for all relevant symbol and other informa-<font color="#ffffff" class="whiteout">tion&nbsp;information</font>
                 tion required for later analysis to be gathered before allowing the exiting task to com-<font color="#ffffff" class="whiteout">plete&nbsp;complete</font>
                 plete exiting.  The processing that occurs during a task exit notification can cause gaps
                 in the resulting profile.

     <b>-b</b>          Enable batch mode. By default, <b>shark</b> will exit after recording a single *.mshark session
                 file.  This option allows you to record multiple sessions without exiting <b>shark</b>.

     <b>-q</b>          Quiet mode. Runs silently (no output to terminal) unless an error is encountered.

     <b>-o</b> <u>basename</u>
                 Sets the basic file name used for *.mshark session files.  By default this is "session",
                 which generates session files named session_{x}.mshark in the current working directory.
                 The 'basename' can contain relative path information, or absolute path information if the
                 '-d' option is not specified on the command line.  <b>shark</b> will honor the file path specified
                 before the basename, provided ALL the directories in the path exist already. No directories
                 are created by <b>shark</b>.

     <b>-d</b> <u>path</u>     Sets the directory file path name used for *.mshark session files. By default this is not
                 set to anything. So <b>shark</b> generates session files in the current working directory. No
                 directories are created by <b>shark</b>.  NOTE: If a directory path is set with this option, then
                 including a slash (/) as the first component of the basename argument (to the '-o' option,
                 above) will generate a fatal error.

     <b>-G</b>          Create a brief textual report from each analysis module that is active in the profiling
                 config.  If an analysis module does not support plain text reporting a "&lt;NO REPORT AVAIL-
                 ABLE&gt;" message is printed.  The text report will have the same name as the session except
                 the extension will be "...-report.txt" instead of ".mshark"

     <b>-g</b> <u>session</u> <u>file</u> <!-- a --><u>name(s)</u><!-- /a --><u></u>
                 Create a brief textual report from any analysis modules that are active in each session
                 file named on the command line.  If an analysis module does not support plain text report-<font color="#ffffff" class="whiteout">ing&nbsp;reporting</font>
                 ing a "&lt;NO REPORT AVAILABLE&gt;" message is put in the report.  The text report will have the
                 same name as the related session file except the extension will be "...-report.txt" instead
                 of ".mshark"

     <b>-t</b> <u>[session</u> <u>file</u> <!-- a --><u>name(s)</u><!-- /a --><u>]</u>
                 Create a text output file representing the complete analysis from the session for each
                 analysis module active in the session.  Note that not every analysis module supports full-<font color="#ffffff" class="whiteout">text&nbsp;fulltext</font>
                 text output. If a module does not support full-text output, the phrase:

                 &lt;FULL-TEXT FORMAT NOT AVAILABLE&gt; appears in the text file for that module.  The full-text
                 output file will have the same name as the session except the extension will be
                 "...-full.txt" instead of ".mshark".

                 Session file names are optional; if omitted, full text reports will be generated for each
                 session you take.  If included, no session will be taken - instead, text reports will be
                 generated from the given session file names.

                 The '-t' option and the '-G' option can both be used at the same time, since they create
                 different filenames.

     <b>-u</b>          Identify processes by name (the default behavior is to identify processes by PID).

     <b>-l</b>          Lists the available sampling configurations and exits. New sampling configurations can be
                 created with Shark.app (the GUI version of <b>shark</b> ).  <b>shark</b> looks for user configurations in
                 ~/Library/Application Support/Shark/Configs.

     <b>-L</b>          Similar to -l option, but adds detailed description of each configuration.

     <b>-c</b> <u>index</u>    Specifies the index of the sampling configuration to be used.

     <b>-m</b> <u>file</u>     Specifies the path to a <b>shark</b> sampling config (*.cfg) file to be used.

     <b>-f</b> <u>file</u>     Specifies the path to an executable, or (MachO) object file to be statically analyzed. This
                 file is used in conjunction with a <b>shark</b> -Static Analysis- config file. The config file
                 must be specified with the '-c' or '-m' options.

     <b>-N</b>          Enables Network Sharing mode in the <b>shark</b> program. Enabling network sharing does not dis-<font color="#ffffff" class="whiteout">able&nbsp;disable</font>
                 able any of the other methods for starting and stopping profiling.

     <b>-e</b>          List the current settings of search-path environment variables used by <b>shark</b> to locate var-<font color="#ffffff" class="whiteout">ious&nbsp;various</font>
                 ious types of files during session processing.  There are currently three environment vari-<font color="#ffffff" class="whiteout">ables:&nbsp;variables:</font>
                 ables: SHARK_SEARCH_PATH_KEXT_FILES, SHARK_SEARCH_PATH_PATCH_FILES, and
                 SHARK_SEARCH_PATH_SOURCE_FILES.  <b>shark</b> will search the colon delimited lists of file paths
                 for Kernel Extensions, Patch Files, and Source Files, respectively.  NOTE: Even if no
                 search paths are specified for Kernel Extensions (SHARK_SEARCH_PATH_KEXT_FILES) some paths
                 will be listed; <b>shark</b> adds to these paths automatically.

<b>BUGS</b>
     Please send your comments, suggestions and bug reports to: perftools-feedback@group.apple.com

<b>SEE</b> <b>ALSO</b>
     <a href="chudRemoteCtrl.1.html#//apple_ref/doc/man/1/chudRemoteCtrl">chudRemoteCtrl(1)</a>, <a href="kill.1.html#//apple_ref/doc/man/1/kill">kill(1)</a>, /Library/Documentation/Applications/Shark/SharkUserGuide.pdf

                                 April 2, 2008
</tt></pre>
</td></tr></table>
	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Darwin/Reference/ManPages/man1/shark.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Darwin/Reference/ManPages/man1/shark.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Darwin/Reference/ManPages/man1/shark.1.html%3Fid%3DTP40000894-7.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</body></html>
