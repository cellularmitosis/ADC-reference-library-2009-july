<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Image Capture Applications Programming Guide: How to Write an Image Capture Application</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="How to Write an Image Capture Application"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005196-CH4" title="How to Write an Image Capture Application"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000420" target="_top">Carbon</a> &gt; <a href="../../../GraphicsImaging-date.html#//apple_ref/doc/uid/TP30000440-TP30000420-TP30000450" target="_top">Graphics &amp; Imaging</a> &gt; <a href="../01Introduction/01Introduction.html#//apple_ref/doc/uid/TP40005196-CH1-DontLinkElementID_23">Image Capture Applications Programming Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../02Overview/02Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../WorkingwiththeSDKandHeaderFiles/WorkingwiththeSDKandHeaderFiles.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005196-CH4-SW1" title="How to Write an Image Capture Application"></a><h1>How to Write an Image Capture Application</h1><p>You can write a complete image capture application using a small subset of the image capture API.</p><p>For most applications, these six function calls will be all you really need:</p><ul class="simple"><li><p><code><!--a-->ICAGetDeviceList<!--/a--></code></p></li><li><p><code><!--a-->ICARegisterForEventNotification<!--/a--></code></p></li><li><p><code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code></p></li><li><p><code><!--a-->ICAOpenSession<!--/a--></code></p></li><li><p><code><!--a-->ICAObjectDownLoadFile<!--/a--></code></p></li><li><p><code><!--a-->ICACloseSession<!--/a--></code></p></li></ul><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_8" title="An Image Capture Application in Seven Steps"></a><h2>An Image Capture Application in Seven Steps</h2><p>You can write an image capture application in seven steps.</p><ol class="ol"><li class="li"><p>Get the device object list by calling <code><!--a-->ICAGetDeviceList<!--/a--></code>.</p></li><li class="li"><p>Call <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code> to get the properties of the attached devices.</p></li><li class="li"><p>Register for notifications on the devices you are interested in using <code><!--a-->ICARegisteForEventNotification<!--/a--></code>. </p></li><li class="li"><p>Open a session on a specific device by calling <code><!--a-->ICAOpenSession<!--/a--></code>. </p></li><li class="li"><p>Call <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code> again for the device you are interested in, then for each object of interest.</p></li><li class="li"><p> Call <code><!--a-->ICAObjectDownLoadFile<!--/a--></code> to get each object that you want. </p></li><li class="li"><p>When you are done, call <code><!--a-->ICACloseSession<!--/a--></code>.</p></li></ol><p>This is all you generally need to download images from an attached camera on a USB or FireWire port.</p><p>To support more ambitious applications, the Image Capture API includes a device browser that you can invoke to scan for other available devices, such as TCP/IP networked cameras or scanners implementing Bonjour, or devices connected to other networked computers that you can attach indirectly. These devices do not appear in the ICA device list until they are attached through the device browser.</p><p>The Image Capture Architecture also includes an application, <code>Image Capture.app</code>. In addition to serving as an example application that can download and display images and work with scanners, it allows users to choose what application to launch when a camera is attached or a button is pressed on a scanner. Your end-user documentation should direct users to the Image Capture application in order to make your own application the default when a device is attached or a button is pressed.</p><p>Be aware that all of the functions in the Image Capture Architecture API can be called either synchronously or asynchronously. That means that you can either wait while the function executes or pass-in a completion function that will be called when the function completes. Setting up a completion function requires a bit more work, but it is highly recommended, as some of the functions can take a long time to complete. Executing these functions asynchronously does not block the user interface.</p><p>The rest of this section goes over the steps in more detail. Each step includes a code snippet that shows how to set up the call asynchronously.</p><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_9" title="Getting Started"></a><h3>Getting Started</h3><p>The first step in writing an image capture application is to download the Image Capture SDK (<span class="content_text"><a href="http://developer.apple.com/sdk/" target="_top">http://developer.apple.com/sdk/</a></span>). This SDK includes sample code, debugging tools, and example applications and modules for both Cocoa and Carbon developers. The image capture sdk includes a Tools folder, in which you can find an application named <code>ICAAPITest</code>. Using this application, you can execute and of the commands documented in this guide. You can also use the application to generate cut-and-paste code in C or objective C, synchronously or asynchronously, for use in your application.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_26" title="Note"></a><p><strong>Note:</strong>&nbsp;Be sure to attach an image capture device, such as a camera, to your host computer before using the <code>ICAAPITest</code> application. Many of the functions will return null or an error if there are no attached devices.</p></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_10" title="Getting the Device List Object"></a><h3>Getting the Device List Object</h3><p>The first step in an Image Capture application is obtaining a device list object—an object that contains a list of all the connected image capture devices. The following code snippet shows how to call <code><!--a-->ICAGetDeviceList<!--/a--></code> asynchronously. </p><div class="codesample"><table><tr><td scope="row"><pre>// -------------------------------------------------------- getDeviceListCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void getDeviceListCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICAGetDeviceListPB * pbPtr = (ICAGetDeviceListPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // pbPtr->object   // ICAObject<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// ---------------------------------------------------------------- getDeviceList<span></span></pre></td></tr><tr><td scope="row"><pre>void getDeviceList ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICAGetDeviceListPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICAGetDeviceList(&amp;pb, getDeviceListCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p><code><!--a-->ICAGetDeviceList<!--/a--></code> returns a device list object, which is simply an ID code.</p><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_11" title="Getting the Device List Dictionary"></a><h3>Getting the Device List Dictionary</h3><p>Once you have a device list object, you obtain the properties of the devices using the <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code> function.</p><p>First, call <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code>, passing in the device list object ID. The code snippet below shows how to make the call asynchronously.</p><div class="codesample"><table><tr><td scope="row"><pre>// ----------------------------------------- copyObjectPropertyDictionaryCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectPropertyDictionaryCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectPropertyDictionaryPB * pbPtr = (ICACopyObjectPropertyDictionaryPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // pbPtr->theDict   // CFDictionaryRef *<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// ------------------------------------------------- copyObjectPropertyDictionary<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectPropertyDictionary ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectPropertyDictionaryPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.object = &lt;#ICAObject object#>; //device list ID<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICACopyObjectPropertyDictionary(&amp;pb, copyObjectPropertyDictionaryCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p>This returns a dictionary that includes all the attached devices and some of their properties, such as device name and type. For example, if a camera or memory card reader is attached to the USB port, it will show up as a device in the dictionary. The code snippet below shows an example of the dictionary returned when the device list consists of a single camera attached to the USB port. The object ID of the device is the <code>icao</code> property.</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    devices = (<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            IORegPath = "IOService:/MacRISC4PE/ht@0,f2000000/AppleMacRiscHT/pci@8/IOPCI2PCIBridge/usb@B,1/AppleUSBOHCI/CameraCo DigiSnap ZZ0 Digital Camera@2b100000/IOUSBInterface@0";<span></span></pre></td></tr><tr><td scope="row"><pre>            arch = ppc;<span></span></pre></td></tr><tr><td scope="row"><pre>            clients = ();<span></span></pre></td></tr><tr><td scope="row"><pre>            "device module" = "/System/Library/Image Capture/Devices/PTPCamera.app";<span></span></pre></td></tr><tr><td scope="row"><pre>            "device type" = camera;<span></span></pre></td></tr><tr><td scope="row"><pre>            file = 1668117089;<span></span></pre></td></tr><tr><td scope="row"><pre>            icao = 1815C00;<span></span></pre></td></tr><tr><td scope="row"><pre>            idProduct = 1427;<span></span></pre></td></tr><tr><td scope="row"><pre>            idVendor = 1034;<span></span></pre></td></tr><tr><td scope="row"><pre>            ifil = "ZZO Digital Camera"; ]<span></span></pre></td></tr><tr><td scope="row"><pre>            locationID = 722468864;<span></span></pre></td></tr><tr><td scope="row"><pre>            remote = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>            thuP = 3573472;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>Notice that the dictionary contains the device type (“camera”) and the USB vendor and product ID. It also contains an object ID for each device, shown here in the <code>icao</code> field.</p><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_12" title="Notifications"></a><h3>Notifications</h3><p>If you want your application to be notified when a device is added or removed, you should register for notifications. This allows you to detect a camera being unplugged, for example, or a new memory card being inserted into a card reader. The function call to register for notifications is <code><!--a-->ICARegisterForEventNotification<!--/a--></code>. You can register for all devices, of for a specific device, using the <code>icao</code> of the device from the device list dictionary. The following code snippet shows how to make the call asynchronously.</p><div class="codesample"><table><tr><td scope="row"><pre>// -------------------------------------------- registerEventNotificationCallback<span></span></pre></td></tr><tr><td scope="row"><pre>/* This function is called to notify the client of events for which the client has registered interest */<span></span></pre></td></tr><tr><td scope="row"><pre>static void notificationCallback( CFStringRef notificationType, CFDictionaryRef notificationDictionary )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    /* handle notifications here */<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>/* This function is used if ICARegisterForEventNotification() called asynchronously. */<span></span></pre></td></tr><tr><td scope="row"><pre>void registerForEventNotificationCallback( ICAHeader* pbHeader )<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICARegisterForEventNotificationPB * pbPtr = (ICARegisterEventNotificationPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // no return value(s)<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>/* Sample code snippet to illustrate the use of ICARegisterForEventNotification() */<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr registerForNotifications()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr                              err = noErr;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICARegisterForEventNotificationPB  pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    CFStringRef                        notificationsOfInterest[]  = {<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeDeviceRemoved,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeDeviceInfoChanged,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeDeviceWasReset,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeCaptureComplete,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeTransactionCanceled,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeStoreAdded,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeStoreRemoved,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeStoreFull,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeStoreInfoChanged,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeObjectAdded,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeObjectRemoved,<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                      kICANotificationTypeObjectInfoChanged<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                    };<span></span></pre></td></tr><tr><td scope="row"><pre>    CFMutableArrayRef  array = CFArrayCreate( kCFAllocatorDefault, (const void**)&amp;notificationsOfInterest, 12, &amp;kCFTypeArrayCallBacks );<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.header.refcon    = (long)self;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.objectOfInterest = &lt;#ICAObject object#><span></span></pre></td></tr><tr><td scope="row"><pre>/* valid values are 0, device list object, or device object. 0 gets notifications related to any object. */<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.eventsOfInterest = (CFArrayRef)array;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.notificationProc = notificationCallback;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.options          = NULL;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICARegisterForEventNotification( &amp;pb, registerForEventNotificationCallback );<span></span></pre></td></tr><tr><td scope="row"><pre>    CFRelease( array );<span></span></pre></td></tr><tr><td scope="row"><pre>    return err;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><div class="notebox"><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_27" title="Note"></a><p><strong>Note:</strong>&nbsp;Be sure to use the <code><!--a-->ICARegisterForEventNotification<!--/a--></code> function, not the older, deprecated <code><!--a-->ICARegisterEventNotification<!--/a--></code> function. The names are confusingly similar.</p></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_13" title="Opening an ICA Session"></a><h3>Opening an ICA Session</h3><p>It is strongly recommended that you open an ICA session before accessing a device. The following code listing shows how to open an ICA session asynchronously. Pass in the ID of the device you are going to access, as returned in the device list dictionary.</p><div class="codesample"><table><tr><td scope="row"><pre>// ---------------------------------------------------------- openSessionCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void openSessionCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICAOpenSessionPB * pbPtr = (ICAOpenSessionPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>   if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>   {<span></span></pre></td></tr><tr><td scope="row"><pre>       // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>   } else<span></span></pre></td></tr><tr><td scope="row"><pre>   {<span></span></pre></td></tr><tr><td scope="row"><pre>       // pbPtr->sessionID   // UInt32<span></span></pre></td></tr><tr><td scope="row"><pre>   }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// ------------------------------------------------------------------ openSession<span></span></pre></td></tr><tr><td scope="row"><pre>void openSession ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICAOpenSessionPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    pb.deviceObject = &lt;#ICAObject deviceObject#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICAOpenSession(&amp;pb, openSessionCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_14" title="Getting the Object Dictionaries"></a><h3>Getting the Object Dictionaries</h3><p>Choose a device you are interested in from the returned dictionary, and call <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code> a second time, this time passing in the object ID of the device you are interested in. The code is identical to the call to obtain the device list dictionary, but this time you would pass the <code>icao</code> of the camera, phone, or scanner, rather than the object ID of the device list.</p><div class="codesample"><table><tr><td scope="row"><pre>// ----------------------------------------- copyObjectPropertyDictionaryCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectPropertyDictionaryCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectPropertyDictionaryPB * pbPtr = (ICACopyObjectPropertyDictionaryPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // pbPtr->theDict   // CFDictionaryRef *<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>// ------------------------------------------------- copyObjectPropertyDictionary<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectPropertyDictionary ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectPropertyDictionaryPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.object = 1815C00; //device object ID<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICACopyObjectPropertyDictionary(&amp;pb, copyObjectPropertyDictionaryCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p>This returns a dictionary that includes all the interesting objects (such as images, movies, audio files, and directories) associated with the device, along with some information about the objects. For example, if you choose a camera, all the images in the camera's memory card are listed, along with their type (such as JPEG, TIFF, or RAW) and date of capture. The code snippet below shows an example dictionary of an attached camera with two JPEG images. </p><p>The dictionary has two main sections. The first section, denoted “<code>data =</code>,“ is a flattened view of the contents of the object, including only files that you are likely to want: images, movies, and audio files. The second section, denoted “<code>tree =</code>,“ is a complete listing of the object’s contents, including directory structures and all files on the device, including non-media files. For most applications, the first section provides all the information you need without requiring you to parse directories or extraneous files.</p><div class="notebox"><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_28" title="Note"></a><p><strong>Note:</strong>&nbsp;Some of the properties have immediately identifiable names, such as <code>isiz</code> or <code>lock</code>, while other properties have numeric names, such as the EXIF tag number associated with an image property. The meaning of the properties with numeric designators can be found in the header file.</p></div><div class="codesample"><table><tr><td scope="row"><pre>{     IORegPath = "IOService:/MacRISC4PE/ht@0,f2000000/AppleMacRiscHT/pci@8/IOPCI2PCIBridge/usb@B,1/AppleUSBOHCI/CameraCo Digicam ZZ0 Digital Camera@2b100000/IOUSBInterface@0";<span></span></pre></td></tr><tr><td scope="row"><pre>    arch = ppc;<span></span></pre></td></tr><tr><td scope="row"><pre>    capa = (1684368433, 1935895659, 1919118443);<span></span></pre></td></tr><tr><td scope="row"><pre>    clients = ("/Volumes/ImageCapture_Tiger_SDK/Tools/ICAAPITest.app");<span></span></pre></td></tr><tr><td scope="row"><pre>    data = (<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            0100 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>            0101 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>            9003 = "2007:05:04 23:17:04";<span></span></pre></td></tr><tr><td scope="row"><pre>            9004 = "2007:05:04 23:17:04";<span></span></pre></td></tr><tr><td scope="row"><pre>            datP = 3576096;<span></span></pre></td></tr><tr><td scope="row"><pre>            file = 1768776039;<span></span></pre></td></tr><tr><td scope="row"><pre>            icao = 3211104;<span></span></pre></td></tr><tr><td scope="row"><pre>            ifil = "100_4150.JPG";<span></span></pre></td></tr><tr><td scope="row"><pre>            isiz = 2402504;<span></span></pre></td></tr><tr><td scope="row"><pre>            lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            thuP = 3381488;<span></span></pre></td></tr><tr><td scope="row"><pre>            tsiz = 49166;<span></span></pre></td></tr><tr><td scope="row"><pre>        },<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            0100 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>            0101 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>            9003 = "2007:05:04 23:17:24";<span></span></pre></td></tr><tr><td scope="row"><pre>            9004 = "2007:05:04 23:17:24";<span></span></pre></td></tr><tr><td scope="row"><pre>            datP = 3205008;<span></span></pre></td></tr><tr><td scope="row"><pre>            file = 1768776039;<span></span></pre></td></tr><tr><td scope="row"><pre>            icao = 3205184;<span></span></pre></td></tr><tr><td scope="row"><pre>            ifil = "100_4151.JPG";<span></span></pre></td></tr><tr><td scope="row"><pre>            isiz = 2263052;<span></span></pre></td></tr><tr><td scope="row"><pre>            lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            thuP = 3379680;<span></span></pre></td></tr><tr><td scope="row"><pre>            tsiz = 49166;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre>    "device module" = "/System/Library/Image Capture/Devices/PTPCamera.app";<span></span></pre></td></tr><tr><td scope="row"><pre>    "device properties" = {"battery level" = 100; "date time" = 20070508T050800; };<span></span></pre></td></tr><tr><td scope="row"><pre>    file = 1668117089;<span></span></pre></td></tr><tr><td scope="row"><pre>    icao = 25254912;<span></span></pre></td></tr><tr><td scope="row"><pre>    idProduct = 1427;<span></span></pre></td></tr><tr><td scope="row"><pre>    idVendor = 1034;<span></span></pre></td></tr><tr><td scope="row"><pre>    ifil = "ZZ0 Digital Camera";<span></span></pre></td></tr><tr><td scope="row"><pre>    locationID = 722468864;<span></span></pre></td></tr><tr><td scope="row"><pre>    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    thuP = 3194592;<span></span></pre></td></tr><tr><td scope="row"><pre>    tree = (<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            datP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            file = 1684632165;<span></span></pre></td></tr><tr><td scope="row"><pre>            icao = 3190416;<span></span></pre></td></tr><tr><td scope="row"><pre>            ifil = 0x00010001;<span></span></pre></td></tr><tr><td scope="row"><pre>            isiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            thuP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            tree = (<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    datP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    file = 1684632165;<span></span></pre></td></tr><tr><td scope="row"><pre>                    icao = 3237280;<span></span></pre></td></tr><tr><td scope="row"><pre>                    ifil = DCIM;<span></span></pre></td></tr><tr><td scope="row"><pre>                    isiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    thuP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    tree = (<span></span></pre></td></tr><tr><td scope="row"><pre>                        {<span></span></pre></td></tr><tr><td scope="row"><pre>                            datP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                            file = 1684632165;<span></span></pre></td></tr><tr><td scope="row"><pre>                            icao = 3190816;<span></span></pre></td></tr><tr><td scope="row"><pre>                            ifil = 100KP880;<span></span></pre></td></tr><tr><td scope="row"><pre>                            isiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                            lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                            raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                            thuP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                            tree = (<span></span></pre></td></tr><tr><td scope="row"><pre>                                {<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0100 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0101 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    9003 = "2007:05:04 23:17:04";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    9004 = "2007:05:04 23:17:04";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    datP = 3576096;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    file = 1768776039;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    icao = 3211104;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    ifil = "100_4150.JPG";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    isiz = 2402504;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    thuP = 3381488;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    tsiz = 49166;<span></span></pre></td></tr><tr><td scope="row"><pre>                                },<span></span></pre></td></tr><tr><td scope="row"><pre>                                {<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0100 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    0101 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    9003 = "2007:05:04 23:17:24";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    9004 = "2007:05:04 23:17:24";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    datP = 3205008;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    file = 1768776039;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    icao = 3205184;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    ifil = "100_4151.JPG";<span></span></pre></td></tr><tr><td scope="row"><pre>                                    isiz = 2263052;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    thuP = 3379680;<span></span></pre></td></tr><tr><td scope="row"><pre>                                    tsiz = 49166;<span></span></pre></td></tr><tr><td scope="row"><pre>                                }<span></span></pre></td></tr><tr><td scope="row"><pre>                            );<span></span></pre></td></tr><tr><td scope="row"><pre>                            tsiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                        }<span></span></pre></td></tr><tr><td scope="row"><pre>                    );<span></span></pre></td></tr><tr><td scope="row"><pre>                    tsiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            );<span></span></pre></td></tr><tr><td scope="row"><pre>            tsiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>        },<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            datP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            file = 1684632165;<span></span></pre></td></tr><tr><td scope="row"><pre>            icao = 3241360;<span></span></pre></td></tr><tr><td scope="row"><pre>            ifil = 0x00020001;<span></span></pre></td></tr><tr><td scope="row"><pre>            isiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            thuP = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>            tree = (<span></span></pre></td></tr><tr><td scope="row"><pre>                {<span></span></pre></td></tr><tr><td scope="row"><pre>                    datP = 3197888;<span></span></pre></td></tr><tr><td scope="row"><pre>                    file = 1869899877;<span></span></pre></td></tr><tr><td scope="row"><pre>                    icao = 3199792;<span></span></pre></td></tr><tr><td scope="row"><pre>                    ifil = "DCEMAIL.ABK";<span></span></pre></td></tr><tr><td scope="row"><pre>                    isiz = 118;<span></span></pre></td></tr><tr><td scope="row"><pre>                    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                    thuP = 3313728;<span></span></pre></td></tr><tr><td scope="row"><pre>                    tsiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>                }<span></span></pre></td></tr><tr><td scope="row"><pre>            );<span></span></pre></td></tr><tr><td scope="row"><pre>            tsiz = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    );<span></span></pre></td></tr><tr><td scope="row"><pre>    tsiz = 9229;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><p>At this point you can either download the objects of interest immediately or choose the object you are interested in and, once again, call <code><!--a-->ICACopyObjectPropertyDictionary<!--/a--></code>, this time passing in the object ID of the image (or movie, or audio file), which is returned in the <code>icao</code> field. The code for obtaining the dictionary is the same, but you pass in <code>icao</code> of the object instead of the device.</p><p>This returns a dictionary that includes all the metadata associated with the object, such as camera settings, height, width, data size, and a thumbnail. The snippet below shows the metadata that might be returned for a JPEG image. Again, some properties have immediately recognizable names, while others have numeric designators (typically EXIF tag numbers for image properties), whose meaning can be looked-up in the header file.</p><div class="codesample"><table><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    0100 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>    0101 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>    0102 = 8;<span></span></pre></td></tr><tr><td scope="row"><pre>    0112 = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    011A = 230;<span></span></pre></td></tr><tr><td scope="row"><pre>    829A = 0.06666667014360428;<span></span></pre></td></tr><tr><td scope="row"><pre>    829D = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>    8822 = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    8827 = (100);<span></span></pre></td></tr><tr><td scope="row"><pre>    9000 = 0221;<span></span></pre></td></tr><tr><td scope="row"><pre>    9003 = "2007:05:04 23:17:05";<span></span></pre></td></tr><tr><td scope="row"><pre>    9004 = "2007:05:04 23:17:05";<span></span></pre></td></tr><tr><td scope="row"><pre>    9201 = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>    9202 = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>    9204 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    9205 = 4;<span></span></pre></td></tr><tr><td scope="row"><pre>    9207 = 5;<span></span></pre></td></tr><tr><td scope="row"><pre>    9209 = 24;<span></span></pre></td></tr><tr><td scope="row"><pre>    920A = 16.79999923706055;<span></span></pre></td></tr><tr><td scope="row"><pre>    A000 = 0100;<span></span></pre></td></tr><tr><td scope="row"><pre>    A001 = 1;<span></span></pre></td></tr><tr><td scope="row"><pre>    A002 = 3264;<span></span></pre></td></tr><tr><td scope="row"><pre>    A003 = 2448;<span></span></pre></td></tr><tr><td scope="row"><pre>    A217 = 2;<span></span></pre></td></tr><tr><td scope="row"><pre>    A401 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    A402 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    A403 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    A406 = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    datP = 3199536;<span></span></pre></td></tr><tr><td scope="row"><pre>    file = 1768776039;<span></span></pre></td></tr><tr><td scope="row"><pre>    icao = 3350416;<span></span></pre></td></tr><tr><td scope="row"><pre>    ifil = "100_4150.JPG";<span></span></pre></td></tr><tr><td scope="row"><pre>    isiz = 2402504;<span></span></pre></td></tr><tr><td scope="row"><pre>    lock = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    raw = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    rawImage = 0;<span></span></pre></td></tr><tr><td scope="row"><pre>    thuP = 3205008;<span></span></pre></td></tr><tr><td scope="row"><pre>    tsiz = 49166;<span></span></pre></td></tr><tr><td scope="row"><pre>    "\U00a9mak" = "CameraCo";<span></span></pre></td></tr><tr><td scope="row"><pre>    "\U00a9mod" = "CameraCo ZZ0 DIGITAL CAMERA";<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_15" title="Getting the Object"></a><h3>Getting the Object</h3><p>The object dictionary provides the information you need to allocate a data buffer to download the object by calling <code><!--a-->ICAObjectDownloadFile<!--/a--></code>, passing in the object ID from the <code>icao</code> property. You can pass in flags to do things such as delete the file after download, change the date in the finder to the capture date of the file, and so on. The code snippet below illustrates a simple download which does none of these things. Use the <code>ICAAPITest</code> application to generate code snippets that set the available flags.</p><div class="codesample"><table><tr><td scope="row"><pre>// --------------------------------------------------------- downloadFileCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void downloadFileCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICADownloadFilePB * pbPtr = (ICADownloadFilePB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // pbPtr->fileFSRef   // FSRef *<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// ----------------------------------------------------------------- downloadFile<span></span></pre></td></tr><tr><td scope="row"><pre>void downloadFile ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICADownloadFilePB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.fileCreator   = &lt;#OSType fileCreator#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.fileType      = &lt;#OSType fileType#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.rotationAngle = &lt;#Fixed rotationAngle#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.object        = &lt;#ICAObject object#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.flags         = &lt;#UInt32 flags#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.dirFSRef      = &lt;#FSRef * dirFSRef#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICADownloadFile(&amp;pb, downloadFileCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><p>You may also wish to download the object thumbnail to display while the object itself downloads. To do this, call <code><!--a-->ICACopyObjectThumbnail<!--/a--></code>, passing in the object ID of the image, as shown in the following code snippet.</p><div class="codesample"><table><tr><td scope="row"><pre>// -------------------------------------------------- copyObjectThumbnailCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectThumbnailCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectThumbnailPB * pbPtr = (ICACopyObjectThumbnailPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // pbPtr->thumbnailData   // CFDataRef *<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// ---------------------------------------------------------- copyObjectThumbnail<span></span></pre></td></tr><tr><td scope="row"><pre>void copyObjectThumbnail ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACopyObjectThumbnailPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.thumbnailFormat = &lt;#OSType thumbnailFormat#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.object          = &lt;#ICAObject object#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICACopyObjectThumbnail(&amp;pb, copyObjectThumbnailCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_16" title="Closing the Session"></a><h3>Closing the Session</h3><p>When you are done accessing a device, and before your application terminates, you should close the ICA session. Closing the ICA session lets the image capture extension know that your application is no longer available to execute pending completion functions, or to receive notifications. Pass in the device ID as you did when opening the session.</p><div class="codesample"><table><tr><td scope="row"><pre>// --------------------------------------------------------- closeSessionCallback<span></span></pre></td></tr><tr><td scope="row"><pre>void closeSessionCallback (ICAHeader* pbHeader)<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACloseSessionPB * pbPtr = (ICACloseSessionPB *)pbHeader;<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != pbPtr->header.err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    } else<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // no return value(s)<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre>// ----------------------------------------------------------------- closeSession<span></span></pre></td></tr><tr><td scope="row"><pre>void closeSession ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>    ICACloseSessionPB pb = {};<span></span></pre></td></tr><tr><td scope="row"><pre>    pb.sessionID = &lt;#UInt32 sessionID#>;<span></span></pre></td></tr><tr><td scope="row"><pre>    err = ICACloseSession(&amp;pb, closeSessionCallback);<span></span></pre></td></tr><tr><td scope="row"><pre>    if (noErr != err)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        // handle error<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div><a name="//apple_ref/doc/uid/TP40005196-CH4-DontLinkElementID_17" title="Opening a Device Browser"></a><h3>Opening a Device Browser</h3><p>The device list object contains a list of attached devices. USB and FireWire devices attach when connected, but Bluetooth and TCP/IP network devices need to be attached by the user before they appear in the device list. To invoke a device browser that allows your end-user to browse for available devices and attach them, call <code><!--a-->ICAShowDeviceBrowser<!--/a--></code>, as shown in the code snippet below.</p><div class="codesample"><table><tr><td scope="row"><pre>// ------------------------------------------ show device browser<span></span></pre></td></tr><tr><td scope="row"><pre>void showDeviceBrowser ()<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>OSErr err;<span></span></pre></td></tr><tr><td scope="row"><pre>err = ICAShowDeviceBrowser( null );<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr></table></div>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <a href="../02Overview/02Overview.html">&lt; Previous Page</a><span style="margin-left: 8px"><a href="../WorkingwiththeSDKandHeaderFiles/WorkingwiththeSDKandHeaderFiles.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2007 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2007-05-16<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/Carbon/Conceptual/ImageCaptureServicesProgrammingGuide/03HowtoWriteanImageCaptureApplication/03HowtoWriteanImageCaptureApplication.html%3Fid%3DTP40005196-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/Carbon/Conceptual/ImageCaptureServicesProgrammingGuide/03HowtoWriteanImageCaptureApplication/03HowtoWriteanImageCaptureApplication.html%3Fid%3DTP40005196-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/Carbon/Conceptual/ImageCaptureServicesProgrammingGuide/03HowtoWriteanImageCaptureApplication/03HowtoWriteanImageCaptureApplication.html%3Fid%3DTP40005196-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>