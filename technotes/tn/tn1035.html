<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><HTML><!-- Template 03-24-01 --><HEAD><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note TN1035: QuickTime VR 1.0 Panorama Movie File Format</title>    <meta name="keywords" content="Mac OS 8 QuickTime VR Panorama movie file format hotspots">    <meta name="Description" content="Technical Note TN1035: This Technical Note s intended toprovide multimedia developers with the knowledge necessaryto create QuickTime VR 1.0 panorama movie files from theirown applications. Basically create a QuickTime VR panoramamovie from a set of panorama picts. Included is a discussionon hotspot tracks and the panorama track's sample descriptionis also provided.">                                       <meta name="categories" content="QuickTime VR"><meta name="week-posted" content="Apr 1, 1996 - Apr 5, 1996"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF"><a name="//apple_ref/doc/uid/DTS10002877" title="QuickTime VR 1.0 Panorama Movie File Format"></a><A NAME="top"></A><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxQuickTime-date.html">QuickTime</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/QuickTime/idxVirtualReality-date.html" target="_blank">QuickTime > Virtual Reality</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note TN1035</div>
<div id="pageheadsub">QuickTime VR 1.0 Panorama Movie File Format</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"> <!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr><td width=300 valign="top" align=left scope="row">    <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><span id="menutitle">    CONTENTS     <BR>    <BR></span>    </td></tr><tr bgcolor="#e6e6e6">    <td background="images/tnmenubody.gif" width=300 align=left><!-- begin_toc --><P id = "menutext"><A HREF = "#RTFToC1">About the Panorama Movie File Format</a><br><br><A HREF = "#RTFToC2">QuickTime VR Panorama Movie Authoring</a><br><br><A HREF = "#RTFToC3">Summary</a><br><br><A HREF = "#References">References</a><br><br><A HREF="#Downloads">Downloadables</A></P>   <!-- end_toc -->  </td></tr><tr>    <td width=300 align=left scope="row"><img src="images/tnmenubottom.gif" alt="" width=300 height=16>    </td></tr>    </table></td><td width=300 valign="top" align=left><!-- begin_intro_text -->  <P id = "introtext">This Technote is intended to provide multimedia developers with the knowledgenecessary to create QuickTime VR 1.0 panorama movie files from their ownapplications.</p><P id = "introtext">You should be thoroughly familiar with the QuickTime Movie Toolbox, asdocumented in <i>Inside Macintosh: QuickTime</i>. In particular, knowledge ofthe sections on creating a movie and working with media samples is essentialfor making use of the information in this document.</p><BR><CENTER><TABLE BORDER=0 WIDTH=275><TR><td bgcolor="#E6E6E6" align=left><P id = "introtext"><B>Note:</B><BR>Although this file format will be supported in future versions ofQuickTime VR, be aware that the panorama movie file format will changesignificantly in the next release.</P></TD></TR></TABLE></CENTER><BR><!-- end_intro_text --><!-- begin_date --><h3>&nbsp;Updated: [Feb 1 1996]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR> <!-- begin_content --><a name = "RTFToC1"></a><h2>About the Panorama Movie File Format</h2><p>The simplest panoramic movie is a single node movie that contains one videotrack and one panorama track. The video track, called the scene track inQuickTime VR, is inactive and is used by the panorama track as an image store.</p><p>In a single node movie the panorama track contains one media sample. In amultinode panorama, the panorama track contains one sample for each node in themovie. Data in each sample contain information about the panoramic image forthe particular node. The scene track contains the panoramic image, usuallymultiple samples comprising the diced frames of the panorama for a particularnode.</p><P>When the panorama needs to be imaged, the video samples are decompressed intoan offscreen buffer, reconstructing the original uncorrected panoramic image.Based on the current pan, tilt, and zoom angle, a portion of the uncorrectedimage is copied and partially corrected (1D correction) to another offscreenbuffer, whose size is the same as the display window. Then the contents of thatbuffer are copied to the screen, going through the final correction phase (2Dcorrection). If circumstances (such as a non-rectangular clipped view) do notallow writing directly to the screen, then a second offscreen correction bufferis used and the image is then copied to the screen. If the imaging update modeis set to partial or no correction, then the corresponding correction steps areskipped.</p><BR><P><A HREF="#top">Back to top</A></P><a name = "RTFToC2"></a><h2>QuickTime VR Panorama Movie Authoring</h2><P>To author a QuickTime VR panorama movie, you need to make extensive use of theQuickTime Movie Toolbox, including such calls as <code>CreateMovieFile</code>,<code>NewMovieTrack</code>, <code>NewTrackMedia</code>, <code>AddMediaSample</code>, <code>InsertMediaIntoTrack</code>, and manyother calls.</p><P>Two things to keep in mind: </p><ul><li>The QuickTime VR components must be registered when you are authoring aQuickTime VR movie. If the components are not registered, <code>NewTrackMedia</code> willfail when you try to create media for the panorama track.</li><li>QuickTime VR 1.0 requires that QuickTime 2.0 or greater be installed in yoursystem.</li></ul><h3>The Movie File</h3><P>A QuickTime VR panorama movie file is a QuickTime movie file. The onlydifference between a panorama movie file and a regular linear QuickTime moviefile is the type and usage of the tracks contained in the movie and the userdata attached to the movie. In particular, for the Macintosh, the file typeshould be set to <code>'MooV'</code>, and on Windows the file extension should be <i>.mov</i>. Thefile's creator type on the Macintosh should be <code>'vrod'</code>, which is the creatortype for the QTVRPlayer application.</p><P>Also, as with any QuickTime file that is intended to be played on bothplatforms, a data fork version of the file should be created using the<code>FlattenMovie</code> Movie Toolbox call with the <code>flattenAddMovieToDataFork</code> flag set.</p><h3>Movie Controller User Data</h3><P>When you create a new QuickTime VR panorama movie, you must add a special pieceof user data that identifies which movie controller to invoke for this movie.The movie controller type for QuickTime VR 1.0 panorama movies is <code>'STpn'</code>. Thisuser data is examined by the Movie Toolbox when <code>NewMovieController</code> is called.The following lines of code add the appropriate user data to a new movie: </p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    UserData uDat;    OSType controllerSubType = 'STpn';    uDat = GetMovieUserData(newMovie);    SetUserDataItem(uDat, &amp;controllerSubType,        sizeof(controllerSubType), 'ctyp', 1);</pre>	</TD></TR></TABLE></CENTER><h3>The Scene and Hot Spot Tracks</h3><P>The scene track contains the actual panoramic image for each node. It is astandard QuickTime video track. The panoramic image itself may have beencreated by the QuickTime VR stitcher tool, a graphics rendering application, ordirectly from a panoramic camera. In order to process the panorama mostefficiently, QuickTime VR expects the panoramic image to be rotated 90deg.counterclockwise. For disk access and memory efficiency, each full panorama isusually diced into smaller frames. Each diced frame is compressed and added tothe scene track as a new video sample. You can choose to use any imagecompressor you deem appropriate to the image; you must not, however, usetemporal compression (frame differencing).</p><P>You can optionally store a low-resolution version of the panoramic image in avideo track called the low-resolution scene track. If the low-resolution scenetrack exists and there is not enough memory to use the normal scene track, thenQuickTime VR uses the low-resolution scene track. The low-resolution trackcontains diced frames just like the higher resolution track, but thereconstructed panoramic image is half the height and half the width of thehigher resolution version. The number of diced frames for the low-resolutionscene track is usually half that of the scene track.</p><P>The hot-spot track is another optional video track that contains a parallelpanorama, with colored regions corresponding to hot spots in the scene track'spanorama. The hot spot panoramic image must be 8 bits deep. Each diced frame ofthe hot spot panoramic image must be compressed with a lossless compressor suchas QuickTime's Graphics compressor. The dimensions of the hot spot panoramicimage is usually the same as that of the scene track's panoramic image, but itis not required. The dimensions must, however, have the same aspect ratio asthe scene track's panoramic image.</p><P>As with the scene track, the panoramic images corresponding to the lowresolution scene track and the hot spot track must be rotated 90deg.counterclockwise.</p><h3>The Panorama Track</h3><P>The panorama track is a special type of QuickTime track specific to panoramamovies. Its media type is <code>'STpn'</code>. The panorama media's media info data containsgeneral scene and node location information.</p><P>Each sample in the panorama track corresponds to one node in the scene.Panorama track samples with similar characteristics share a sample descriptionof type <code>PanoramaDescription</code>. This data structure contains data that specifiesthe track IDs of the scene and hot spot tracks. It also contains informationabout how the panoramic image has been diced.</p><P>Each individual panorama track sample contains data about one node. Thisincludes default view angles, pan and zoom constraints, and hot spotinformation.</p><P>The format of the media info, panorama description, and panorama samples aredescribed in the following sections. Figure 1 illustrates how a scene track is created.</p><center><img src="images/tn1035_003.gif" alt="" width=462 height=679><P><b>Figure 1</b>. Creating the Scene Track</p></center><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>In the following data structure descriptions, here are the sizesof the standard Macintosh data types used: </P></TD></TR><TR><td bgcolor="#E6E6E6" align=left><pre>Type        bit sizelong            32unsigned long    32short            16unsigned short   16Fixed            32OSType            32Str31            256TimeValue        32Rect            64</pre></td></tr><TR><td bgcolor="#E6E6E6" align=left><P>The structures all use Macintosh 68K alignment. To ensure Mac 68K alignment,place this pragma statment in front of all data structures: </p></td></tr><TR><td bgcolor="#E6E6E6" align=left><pre>#pragma options align = mac68k</pre></td></tr></table></center><h4>The Media Info Data</h4><P>For a multinode panorama, general scene and node location information is storedin the panorama media handler's media info data structure, which is a chunk ofprivate data that QuickTime maintains for certain media handlers. You use the<code>MediaGetMediaInfo</code> call to add the information to the panorama track's media.Yes, that's Get, not Set. The call is named from the point of view of the mediahandler.</p><P><code>MediaGetMediaInfo</code> is defined in the header file MediaHandlers.h and documentedin the Derived Media Handler Components section of <i>Inside Macintosh: QuickTime Components</i>, although again, it is documented from the point ofview of the media handler implementor. You pass a handle to the <code>PanoMediaInfo</code>structure when you call <code>MediaGetMediaInfo</code>. QuickTime VR will make a copy of thedata. You are responsible for disposing of your copy of the handle.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct PanoMediaInfo {    long        size;        // the size of the entire media info    OSType        type;        // must be 'pInf'    Str31        name;        // the name of the scene    unsigned long    defNodeID;    // the node to display initially    Fixed        defZoom;    // the default zoom for all nodes    long        reserved;    // must be zero    short        pad;        // must be zero    short        numEntries;    // the number of nodes in the scene    IDTableEntry    idToTime[1];    // table mapping node IDs to movie time};struct IDTableEntry {    unsigned long    nodeID;    TimeValue    time;};</pre>	</TD></TR></TABLE></CENTER><P>The <code>idToTime</code> field maps node IDs to the movie time of the panorama samplecorresponding to the node. The table must be sorted in ascending order by nodeID. The node IDs are used to identify a particular node and are used by thelink hot spots when determining which node to jump to.</p><P>The following code snippet adds the media info for a two node scene with nodeIDs 6 and 9.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    PanoMediaInfo **mediaInfoH;    long numNodes = 2;    mediaInfoH = (PanoMediaInfo **) NewHandleClear(sizeof(PanoMediaInfo)            + (numNodes-1)*sizeof(IDTableEntry));    (*mediaInfoH )-&gt;size = GetHandleSize((Handle) mediaInfoH );    (*mediaInfoH )-&gt;type = 'pInf';    (*mediaInfoH )-&gt;defNodeID = 6;    (*mediaInfoH )-&gt;defZoom = 65L &lt;&lt; 16;    (*mediaInfoH )-&gt;numEntries = numNodes;    (*mediaInfoH )-&gt;idToTime[0].nodeID = 6;    (*mediaInfoH )-&gt;idToTime[0].time = 0;    (*mediaInfoH )-&gt;idToTime[1].nodeID = 9;    (*mediaInfoH )-&gt;idToTime[1].time = 7200;    MediaGetMediaInfo(panoMediaHandler, (Handle)mediaInfoH);                // Yes, that's Get, not Set!    DisposeHandle((Handle) mediaInfoH);</pre>	</TD></TR></TABLE></CENTER><h4>The Panorama Track's Sample Description</h4><P>The panorama track contains one sample for each node in the panorama. Thesample description for the panorama media contains information that is usuallyshared by many nodes. Many of the fields are reserved and should be set to thevalues indicated in the description that follows. Other fields indicateinformation about the source panorama image, such as its size and how it wasdiced. In the following description, typical values for a high resolutionpanorama file are given.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct PanoramaDescription {    long    size;            // total size of the PanoramaDescription    long    type;            // must be 'pano'    long    reserved1;        // must be zero    long    reserved2;        // must be zero    short    majorVersion;        // must be zero    short    minorVersion;        // must be zero    long    sceneTrackID;        // ID of video track that contains                      panoramic scene    long    loResSceneTrackID;    // ID of video track that contains low                      res panoramic scene    long    reserved3[6];        // must be zero    long    hotSpotTrackID;        // ID of video track that contains                      hotspot image    long    reserved4[9];        // must be zero    Fixed    hPanStart;        // horizontal pan range start angle                      (e.g. 0)    Fixed    hPanEnd;        // horizontal pan range end angle                      (e.g. 360)    Fixed    vPanTop;        // vertical pan range top angle                      (e.g. 42.5)    Fixed    vPanBottom;        // vertical pan range bottom angle                      (e.g. -42.5)    Fixed    minimumZoom;        // minimum zoom angle (e.g. 5; use 0 for                      default)    Fixed    maximumZoom;        // maximum zoom angle (e.g. 65; use 0                      for default)    // Info for highest res version of scene track    long    sceneSizeX;        // pixel width of the panorama (e.g. 768)    long    sceneSizeY;        // pixel height of the panorama (e.g.                      2496)    long    numFrames;        // number of diced frames (e.g. 24)    short    reserved5;        // must be zero    short    sceneNumFramesX;    // diced frames wide (e.g. 1)    short    sceneNumFramesY;    // diced frames high (e.g. 24)    short    sceneColorDepth;    // bit depth of the scene track (e.g. 32)    // Info for highest res version of hotSpot track    long    hotSpotSizeX;        // pixel width of the hot spot panorama                      (e.g. 768)    long    hotSpotSizeY;        // pixel height of the hot spot panorama                      (e.g. 2496)    short    reserved6;        // must be zero    short    hotSpotNumFramesX;    // diced frames wide (e.g. 1)    short    hotSpotNumFramesY;    // diced frames high (e.g. 24)    short    hotSpotColorDepth;    // must be 8};</pre>	</TD></TR></TABLE></CENTER><P>A value of 0 for a track ID indicates there is no corresponding track. The<code>sceneTrackID</code> field must refer to a valid scene track. The low-resolution scenetrack and hot spot track are optional. The pan and zoom range values are usedto indicate the extent of the panorama. A full wraparound panorama would have<code>hPanStart</code> and <code>hPanEnd</code> values of 0 and 360 (shifted left 16 since they are Fixedvalues). Partial panoramas will have different appropriate values. The <code>vPanTop</code>and <code>vPanBottom</code> angles define the vertical field of view, where 0 is thestraight-ahead view angle.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>hPan, vPan, and zoom angles will be called pan, tilt, and field ofview in future versions of QuickTime VR. </P></TD></TR></TABLE></CENTER><BR><P>You can specify a minimum and maximum zoom angle, or use 0 to get QuickTimeVR's default. It's a good idea to specify a minimum zoom angle so that you canprevent the user from zooming all the way until all you see is giant pixels.The general rules that govern the size values are that the height and width ofthe panorama should be set so that each can be divided into an even number ofwhole diced frames. The dimensions of the diced frames should be divisible by4. Since the panorama is stored rotated 90 degrees counterclockwise, the height is generally larger than the width.</p><h4>The Panorama Track Samples</h4><P>The samples in the panorama track contain information about the node, tables ofhot spot information, and a table of Pascal strings for storing names andcomments. The data in each sample is organized as atom data structures.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>This file format pre-dates the QuickTime 2.1 Atom Data routinesand is not compatible with them. </P></TD></TR></TABLE></CENTER><BR><P>Each atom has a header that consists of a 4-byte size followed by a 4-byte typefield. The atoms can appear in any order within the panorama sample data.</p><P>The panorama header atom (type <code>'pHdr'</code>) contains information about the nodeitself, such as its node ID, the default viewing angles, and panning andzooming constraints specific to this node. If there are no constraints specificto this node, then 0 should be used for the min and max values. The<code>nameStrOffset</code> and <code>commentStrOffset</code> fields (in this and other atoms) containoffsets into the string table atom.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct PanoSampleHeaderAtom {    long        size;    OSType        type;            // must be 'pHdr'    unsigned long    nodeID;            // corresponds to a node ID in the                          idToTime table above    Fixed        defHPan;        // default horizontal pan angle when                          displaying this node    Fixed        defVPan;        // default vertical pan angle when                          displaying this node    Fixed        defZoom;        // default zoom angle when displaying                          this node    // constraints for this node; use zero for default    Fixed        minHPan;    Fixed        minVPan;    Fixed        minZoom;    Fixed        maxHPan;    Fixed        maxVPan;    Fixed        maxZoom;    long        reserved1;        // must be zero    long        reserved2;        // must be zero    long        nameStrOffset;        // offset into string table atom    long        commentStrOffset;    // offset into string table atom};</pre>	</TD></TR></TABLE></CENTER><P>The string table atom (type <code>'strT'</code>) is a table of Pascal strings concatenatedtogether. The offset value for a particular string gives the offset into thetable of the length byte of the string (with length number of charactersfollowing). The offset value includes the size and type fields of the stringtable atom; thus the first string in the table would be at offset 8. An offsetvalue of 0 indicates there is no string in the table for this item.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct StringTableAtom {    long    size;    OSType    type;            // must be 'strT'    char    bunchOstrings[1];    // concatenated Pascal strings};</pre>	</TD></TR></TABLE></CENTER><P>The hot spot table atom lists all of the hot spots in the node. Each entry inthe table gives general information about the particular hot spot, such as thehot spot ID and type (<code>'link'</code>, <code>'navg'</code>, etc), its canonical or "best" viewingposition, bounding rectangle, and special cursor IDs. The hot spot IDcorresponds to the pixel value found in the hot spot track. The hot spot typesknown by QuickTime VR are <code>'link'</code> and <code>'navg'</code>. For <code>'link'</code> and <code>'navg'</code> hot spots,the typeData field is the ID of an entry in the <code>'link'</code> or <code>'navg'</code> tables. Forany other hot spot type, <code>typeData</code> is undefined. The cursor IDs are used tooverride the default hot spot cursors provided by QuickTime VR. They are usedwhen the mouse moves over or is clicked on the particular hot spot. The cursorIDs must be set to 0 if the default cursors are to be used.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct HotSpotTableAtom {    long        size;    OSType        type;        // must be 'pHot'    short        pad;        // must be zero    short        numHotSpots;    HotSpot        hotSpots[1];};struct HotSpot {    unsigned short    hotSpotID;    // the ID of this hot spot    short        reserved1;    // must be zero    OSType        type;        // the hot spot type (e.g. 'link',                      'navg', etc)    unsigned long    typeData;    // for link and navg, the ID in the link                      and navg table    // canonical view for this hot spot    Fixed        viewHPan;    Fixed        viewVPan;    Fixed        viewZoom;    Rect        hotSpotRect;    // bounding rectangle of the hot spot in                      the panorama    long        mouseOverCursorID;    long        mouseDownCursorID;    long        mouseUpCursorID;    long        reserved2;        // must be zero    long        nameStrOffset;        // offset into string table atom    long        commentStrOffset;    // offset into string table atom};</pre>	</TD></TR></TABLE></CENTER><P>The link table atom is what QuickTime VR uses to automatically jump from nodeto node when the user clicks on a link hot spot. The link table atom (type<code>'pLnk'</code>) lists all the links from this node to other nodes in the scene. Each link contains its link ID, which is the value referred to by the typeData fieldin the link hot spot atom. A link also contains the destination node id as wellas the viewing angles to use at the new node. If the <code>toZoom</code> field is set to 0,then the current zoom angle is maintained when jumping to the node.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct LinkTableAtom {    long        size;    OSType        type;            // must be 'pLnk'    short        pad;            // must be zero    short        numLinks;    PanoLink        links[1];};struct PanoLink {    unsigned short    linkID;            // ID referred to by the typeData                          field in the hot spot atom    short        reserved1;        // must be zero    long        reserved2;        // must be zero    long        reserved3;        // must be zero    unsigned long    toNodeID;        // the node id of the destination                          node    long        reserved4[3];        // must be zero    Fixed        toHPan;            // horizontal pan angle to set at                          the destination node    Fixed        toVPan;            // vertical pan angle to set at the                           destination node    Fixed        toZoom;            // zoom angle to set at the                          destination node    long        reserved5;        // must be zero    long        reserved6;        // must be zero    long        nameStrOffset;        // offset into string table atom    long        commentStrOffset;    // offset into string table atom};</pre>	</TD></TR></TABLE></CENTER><P>The <code>'navg'</code> table atom stores information about navigable objects that mayappear in the scene.</p><BR><CENTER><TABLE BORDER=0 WIDTH=550><TR><td bgcolor="#E6E6E6" align=left><P><B>Note:</B><BR>Navigable Object movies are called simply Object movies in futureversions of QuickTime VR; the term "navigable" is going away. </P></TD></TR></TABLE></CENTER><BR><P>QuickTime VR does not do any automatic linking to navigable object movies. The<code>'navg'</code> table atom is stored here so that applications can extract theinformation and use it to perform its own object movie transitions. Each entrycontains its object ID, which is the value referred to by the typeData field inthe <code>'navg'</code> hot spot atom. It also stores information that can be used by theNavigable Movie Controller. The <code>navgHPan</code>, <code>navgVPan</code>, and <code>navgZoom</code> fields specifythe orientation of the corresponding object movie that best represents theorientation of the object as it appears in the panoramic scene. The <code>zoomRect</code>field specifies a rectangle that can be used by the Navigable Movie Controlleras a starting point for a zoom-out transition effect. The <code>zoomRect</code> value is inthe coordinate system of the panorama. It is similar to the <code>hotSpotRect</code> fieldin the hot spot atom, but generally is a bit larger, since it represents theview of the object as seen in the object movie, rather than the tight boundingrectangle represented by the <code>hotSpotRect</code>. Also, the <code>zoomRect</code> field value needsto be converted to window coordinates (based on the current viewing angles)before it is passed to the Navigable Movie Controller.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>struct NavgTableAtom {    long        size;    OSType        type;            // must be 'pNav'    short        pad;            // must be zero    short        numObjects;    NavgObject    objects[1];        //  navigable objects};struct NavgObject {    unsigned short    objID;            // ID referred to by the typeData                          field in the hot spot atom    short        reserved1;        // must be zero    long        reserved2;        // must be zero    // Info for Navigable Movie Controller    Fixed        navgHPan;        // the object's orientation in the                          scene    Fixed        navgVPan;    Fixed        navgZoom;    Rect        zoomRect;        // starting rect for zoom out                          transition    long        reserved3;        // must be zero    long        nameStrOffset;        // offset into string table atom    long        commentStrOffset;    // offset into string table atom};</pre>	</TD></TR></TABLE></CENTER><h4>Track Layout</h4><P>Each sample in the panorama track corresponds to one node in the scene. Thetime base of the movie is used to locate the proper video samples in the scenetrack for a particular node. The video sample for the first diced frame of anode's panoramic image is located in the scene track at the same time as thecorresponding panorama sample. The duration of all of the video samplestogether for one node is the same as the duration of the corresponding panoramasample (Figures 2 &amp; 3).</p><center><img src="images/tn1035_004.gif" alt="" width=414 height=51><P><b>Figure 2</b>. Single Node Panorama File</p></center><center><img src="images/tn1035_005.gif" alt="" width=424 height=72><P><b>Figure 3</b>. Multinode Panorama File</p></center><P>The video samples corresponding to the low-resolution scene track, if oneexists, are also located at the same time and total duration as the panoramasample. Likewise, the hot spot track, if it exists, has its samples for aparticular node located at the same time and total duration as the panoramasample. (Figure 4).</p><center><img src="images/tn1035_006.gif" alt="" width=485 height=108><P><b>Figure 4</b>. Multinode Panorama File with Low-Res Scene Track and Hot Spot Track</p></center><P>In a panorama movie file the scene track, low-resolution scene track, and hotspot track are all disabled. Only the panorama track is enabled. The trackdimensions and track matrix of the panorama track determine the rectanglereturned by the <code>GetMovieBox</code> call.</p><BR><P><A HREF="#top">Back to top</A></P><a name = "RTFToC3"></a><h2>Summary</h2><P>This Technote has shown how you can create a QuickTime VR panorama movie from aset of panorama picts. Hotspots may be added to allow the user to jump betweenpanoramas, to pick QuickTime VR objects, or any user-defined hot spotpicking.</p><P>Authoring a multi-node panorama file with hot spots is a complex process. Makesure you verify the resulting file using QTVRPlayer.</p><BR><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><p><i>Inside Macintosh: QuickTime</i></p><p><i>Inside Macintosh: QuickTime Components</i></p><p><A HREF = "tn1036.html">Technote 1036, "QuickTime VR 1.0 Object Movie File Format"</a></p><BR><P><A HREF="#top">Back to top</A></P>          <A NAME=Downloads></A>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (488K).</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/tn1035.pdf">Download</A></P>               </TD>            </TR>         </TABLE>         <BR><BR><P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER>		<!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/tn/tn1035.html%3Fid%3DDTS10002877-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/tn/tn1035.html%3Fid%3DDTS10002877-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/tn/tn1035.html%3Fid%3DDTS10002877-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>