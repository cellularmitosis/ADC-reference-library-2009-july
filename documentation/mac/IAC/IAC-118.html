<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Installing Entries in the Apple Event Dispatch Tables(IM:IC)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING118></A>


<!-- Top of Header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- Bottom of Header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="IAC-117.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-119.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="IAC-2.html"><B>Interapplication Communication</B></A> / <BR><DD><A HREF="IAC-115.html"><B>Chapter 4 - Responding to Apple Events</B></A> / <A HREF="IAC-116.html"><B>Handling Apple Events</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING118-0></A>
<H2><A NAME=MARKER-9-233></A><A NAME=MARKER-21-234></A>Installing Entries in the Apple Event Dispatch Tables</H2>
 <A NAME=MARKER-2-92></A><A NAME=MARKER-2-336></A><A NAME=MARKER-2-54></A>When your application receives an Apple event, use the <CODE>AEProcessAppleEvent</CODE> function to retrieve the data buffer of the event and to route the Apple event to the appropriate Apple event handler in your application. Your application supplies an Apple event dispatch table to map the Apple events your application supports to the Apple event handlers provided by your application.<P>
 To install entries in your application's Apple event dispatch table, use the <CODE>AEInstallEventHandler</CODE> function. You usually install entries for all of the Apple events that your application accepts into your application's Apple event dispatch table. <P>
 To install an Apple event handler in your Apple event dispatch table, you must specify<P>
<UL>
<LI>the event class of the Apple event
<LI>the event ID of the Apple event
<LI>the address of the Apple event handler for the Apple event
<LI>a reference constant<P>
</UL>
 You provide this information to the <CODE>AEInstallEventHandler</CODE> function. In addition, you indicate whether the entry should be added to your application's Apple event dispatch table or to the system Apple event dispatch table. <P>
 The <B>system Apple event dispatch table</B> is a table in the system heap that contains system Apple event handlers--handlers that are available to all applications and processes running on the same computer. The handlers in your application's Apple event dispatch table are available only to your application. If <CODE>AEProcessAppleEvent</CODE> cannot find a handler for the Apple event in your application's Apple event dispatch table, it looks in the system Apple event dispatch table for a handler (see <BR><A HREF=#MARKER-9-253>"How Apple Event Dispatching Works" on page 4-9</A> for details). If it doesn't find a handler for the event, it returns the <CODE>errAEEventNotHandled</CODE> result code. <A NAME=MARKER-2-238></A><A NAME=MARKER-2-239></A><P>
 If you add a handler to the system Apple event dispatch table, the handler should reside in the system heap. If there was already an entry in the system Apple event dispatch table for the same event class and event ID, it is replaced unless you chain it to your system handler. See <A HREF=IAC-135.html#MARKER-9-463>"Creating and Managing the Apple Event Dispatch Tables" on page 4-62</A> for details.<P>
<A NAME=HEADING118-11></A>
<H3>Installing Entries for the Required Apple Events</H3>
 <A NAME=MARKER-0-240></A><A HREF=#MARKER-9-242>Listing 4-3</A> illustrates how to add entries for the required Apple events to your application's Apple event dispatch table.<A NAME=MARKER-21-188></A><P>
<B>Listing 4-3  <A NAME=MARKER-9-242></A><A NAME=MARKER-21-243></A>Adding entries for the required Apple events to an application's Apple event dispatch table</B><P>
<PRE>
myErr := AEInstallEventHandler(kCoreEventClass, 
                               kAEOpenApplication, 
                               @MyHandleOApp, 0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
myErr := AEInstallEventHandler(kCoreEventClass, 
                               kAEOpenDocuments, 
                               @MyHandleODoc,0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
myErr := AEInstallEventHandler(kCoreEventClass, 
                               kAEPrintDocuments, 
                               @MyHandlePDoc, 0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
myErr := AEInstallEventHandler(kCoreEventClass,
                               kAEQuitApplication,
                               @MyHandleQuit, 0, FALSE); 
IF myErr &lt;&gt; noErr THEN DoError(myErr);  
</PRE>
 The code in <A HREF=#MARKER-9-242>Listing 4-3</A> creates entries for all four required Apple events in the Apple event dispatch table. (For examples of handlers that correspond to these entries, see <A HREF=IAC-119.html#MARKER-9-262>"Handling the Required Apple Events,"</A> which begins on <A HREF=IAC-119.html#MARKER-9-262>page 4-11</A>.) The first entry creates an entry for the Open Application event. The entry indicates the event class and event ID of the Open Application event, supplies the address of the handler for that event, and specifies 0 as the reference constant. <P>
 The Apple Event Manager passes the reference constant to your handler each time your handler is called. Your application can use this reference constant for any purpose. If your application doesn't use the reference constant, use 0 as the value. <A NAME=MARKER-2-55></A><P>
 The last parameter to the <CODE>AEInstallEventHandler</CODE> function is a Boolean value that determines whether the entry is added to the system Apple event dispatch table or to your application's Apple event dispatch table. To add the entry to your application's Apple event dispatch table, use <CODE>FALSE</CODE> as the value of this parameter. If you specify <CODE>TRUE</CODE>, the entry is added to the system Apple event dispatch table. The code shown in <A HREF=#MARKER-9-242>Listing 4-3</A> adds entries to the application's Apple event dispatch table.<A NAME=MARKER-0-245></A><P>
<A NAME=HEADING118-18></A>
<H3>Installing Entries for Apple Events Sent by the Edition Manager</H3>
 <A NAME=MARKER-2-246></A>If your application supports the Edition Manager, you should also add entries to your application's Apple event dispatch table for the Apple events that your application receives from the Edition Manager. <A HREF=#MARKER-9-247>Listing 4-4</A> shows how to add these entries.<P>
<B>Listing 4-4  <A NAME=MARKER-9-247></A><A NAME=MARKER-21-248></A>Adding entries for Apple events sent by the Edition Manager to an application's Apple event dispatch table</B><P>
<PRE>
myErr := AEInstallEventHandler(sectionEventMsgClass, 
                               sectionReadMsgID, 
                               @MyHandleSectionReadEvent, 
                               0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
myErr := AEInstallEventHandler(sectionEventMsgClass, 
                               sectionWriteMsgID, 
                               @MyHandleSectionWriteEvent, 
                               0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
myErr := AEInstallEventHandler(sectionEventMsgClass, 
                               sectionScrollMsgID, 
                               @MyHandleSectionScrollEvent, 
                               0, FALSE);
IF myErr &lt;&gt; noErr THEN DoError(myErr);
</PRE>
 See <A HREF=IAC-120.html#MARKER-9-295>"Handling Apple Events Sent by the Edition Manager" on page 4-20</A> for the parameters associated with these events. See the chapter "Edition Manager" in this book for information on how your application should respond to the Apple events sent by the Edition Manager.<A NAME=MARKER-2-357></A><A NAME=MARKER-9-94></A><A NAME=MARKER-2-299></A> <A NAME=MARKER-2-8></A><P>
<A NAME=HEADING118-23></A>
<H3><A NAME=MARKER-9-253></A>How Apple Event Dispatching Works</H3>
 <A NAME=MARKER-2-354></A>In addition to the Apple event handler dispatch tables, applications can add entries to a <B>special handler dispatch table</B> in either the application heap or the system heap. These dispatch tables are used for various specialized handlers; for more information, see <A HREF=IAC-184.html#MARKER-9-599>"Creating and Managing the Special Handler Dispatch Tables,"</A> which begins on <A HREF=IAC-184.html#MARKER-9-599>page 4-99</A>. <P>
 When an application calls <CODE>AEProcessAppleEvent</CODE>, the function looks first in the application's special handler dispatch table for an entry that was installed with the constant <CODE>keyPreDispatch</CODE>. If the application's special handler dispatch table does not include such a handler or if the handler returns <CODE>errAEEventNotHandled</CODE>, the function looks in the application's Apple event dispatch table for an entry that matches the event class and event ID of the specified Apple event. <P>
 If the application's Apple event dispatch table does not include such a handler or if the handler returns <CODE>errAEEventNotHandled</CODE>, the <CODE>AEProcessAppleEvent</CODE> function looks in the system special handler dispatch table for an entry that was installed with the constant <CODE>keyPreDispatch</CODE>. If the system special handler dispatch table does not include such a handler or if the handler returns <CODE>errAEEventNotHandled</CODE>, the function looks in the system Apple event dispatch table for an entry that matches the event class and event ID of the specified Apple event. <P>
 If the system Apple event dispatch table does not include such a handler, the Apple Event Manager returns the result code <CODE>errAEEventNotHandled</CODE> to the server application and, if the client application is waiting for a reply, to the client application.<P>
<DL>
<DT><B>WARNING</B>
<DD><A NAME=MARKER-9-255></A>Before an application calls a system Apple event handler, system software has set up the A5 register for the calling application. For this reason, if you provide a system Apple event handler, it should never use A5 global variables or anything that depends on a particular context; otherwise, the application that calls the system handler may crash.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
 For any entry in your Apple event dispatch table, you can specify a wildcard value for the event class, event ID, or both. You specify a wildcard by supplying the <CODE>typeWildCard</CODE> constant when installing an entry into the Apple event dispatch table. A wildcard value matches all possible values. Wildcards make it possible to supply one Apple event handler that dispatches several related Apple events.<A NAME=MARKER-2-57></A> <A NAME=MARKER-2-467></A><P>
 For example, if you specify an entry with the <CODE>typeWildCard</CODE> event class and the <CODE>kAEOpenDocuments</CODE> event ID, the Apple Event Manager dispatches Apple events of any event class with an event ID of <CODE>kAEOpenDocuments</CODE> to the handler for that entry. <P>
 If you specify an entry with the <CODE>kCoreEventClass</CODE> event class and the <CODE>typeWildCard</CODE> event ID, the Apple Event Manager dispatches Apple events of the <CODE>kCoreEventClass</CODE> event class with any event ID to the handler for that entry. <P>
 If you specify an entry with the <CODE>typeWildCard</CODE> event class and the <CODE>typeWildCard</CODE> event ID, the Apple Event Manager dispatches all Apple events of any event class and any event ID to the handler for that entry.<A NAME=MARKER-2-59></A><A NAME=MARKER-2-383></A><P>
 If an Apple event dispatch table contains one entry for an event class and a specific event ID, and also contains another entry that is identical except that it specifies a wildcard value for either the event class or the event ID, the Apple Event Manager dispatches the more specific entry. For example, if an Apple event dispatch table includes one entry that specifies the event class as <CODE>kAECoreSuite</CODE> and the event ID as <CODE>kAEDelete</CODE>, and another entry that specifies the event class as <CODE>kAECoreSuite</CODE> and the event ID as <CODE>typeWildCard</CODE>, the Apple Event Manager will dispatch the Apple event handler associated with the entry that specifies the event ID as <CODE>kAEDelete</CODE>. <P>
<DL>
<DT><B>IMPORTANT</B>
<DD>If your application sends Apple events to itself using a <CODE>typeProcessSerialNumber</CODE> address descriptor record with the <CODE>lowLongOfPSN</CODE> field set to <CODE>kCurrentProcess</CODE>, the Apple Event Manager jumps directly to the appropriate Apple event handler without going through the normal event-processing sequence. For this reason, your application will not appear to run more slowly when it sends Apple events to itself. For more information, see <A HREF=IAC-199.html#MARKER-9-74>"Addressing an Apple Event for Direct Dispatching" on page 5-13</A>.<EM></EM><A NAME=MARKER-2-260></A> <A NAME=MARKER-2-67></A>  <IMG ALIGN = BOTTOM SRC = "graphics/triangle.gif">
</DL>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="IAC-117.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="IAC-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="IAC-529.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="IAC-119.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="IAC-3.html">&copy; Apple Computer, Inc.</A><br>7 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
