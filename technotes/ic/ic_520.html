<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"    "http://www.w3.org/TR/1998/REC-html40-19980424/loose.dtd"><HTML><head><LINK REL="stylesheet" HREF="adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="style.css" TYPE="text/css"><title>Technical Note IC520: Script Manager Q&amp;As</title><meta name="keywords" content="Mac OS 8 Script Manager String2Date Date2Secs FormatXToStr FormatX2Str truncating"><meta name="Description" content="Technical Note IC520: This Technical Note contains a collectionof archived Q&amp;As relating to the Script Manager--questionssent the Developer Support Center (DSC) along with answersfrom the DSC engineers. Archived Q&amp;As include: How String2Dateand Date2Sec convert dates with years less than or equalto 10; FormatX2Str strings; Code for truncating a multi-bytecharacter string; the values of character type and subtypewith the Macintosh Kanji system.">                                       <meta name="categories" content="Interapplication Communication"><meta name="week-posted" content="Oct 1, 1990 - Oct 5, 1990"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002519" title="Script Manager Q&As"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxTextFonts-date.html">Text & Fonts</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="http://developer.apple.com/referencelibrary/TextFonts/idxCarbon-date.html" target="_blank">Text & Fonts > Carbon</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note IC520</div>
<div id="pageheadsub">Script Manager Q&amp;As</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->										<p id="menutext">                  <A HREF="#Section1">String2Date and Date2Secs conversion surprises</A><BR><BR>                  <A HREF="#Section2">Using FormatXToStr and FormatStrToX with Pascal switches</A><BR><BR>                  <A HREF="#Section3">FormatX2Str strings</A><BR><BR><A HREF="#Section4">Code for truncating a multi-byte character string</A><BR><BR><A HREF="#Section5">Character type and subtype values within the Kanji system</A><BR><BR><A HREF="#Downloads">Downloadables</A></P>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note contains a collection of archived Q&amp;As relating to a specific topic--questions sent the Developer Support Center (DSC) along with answers from the DSC engineers. Current Q&amp;As can be found on the <a href="../../qa/index.html">Macintosh Technical Q&amp;As web site</a>.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Oct 01 1990]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR>          <!-- begin_content --><a name="Section1"></a><h2>String2Date and Date2Secs conversion surprises</h2><p>Date Written:  8/19/91</p><p>Last reviewed:  6/14/93</p><p>String2Date and Date2Secs treat all dates with the year 04 to 10 as 2004 to2010 instead of 1904 to 1910.</p><p>___</p><p>This is correct; the Script Manager treats two-digit years less than orequal to 10 as 20xx dates if the current year is between 1990 and 1999, inclusive. Basically, it just assumes that you're talking about 1-20 years in the future, rather than 80-100 years in the past. The same is true of two-digit 9x dates, when the current year is less than or equal to xx10. Thus, in 2003, the date returned when 3/7/94 is converted will be 1994, not 2094. This is all documented in "Worldwide Development: Guide to System Software".</p><a name="Section2"></a> <P><A HREF="#top">Back to top</A></P><h2>Using FormatXToStr and FormatStrToX with Pascal switches</h2><p>Date Written:  12/10/90</p><p>Last reviewed:  6/14/93</p><p>Why do the <code>FormatXToStr</code> and <code>FormatStrToX</code> Script Manager routines stop workingwhen I use the Pascal -MC68881 switch?</p><p>___</p><p>Regular SANE extended numbers are 10 bytes long while MC68881 extended numbersare 12 bytes long, and the extra two bytes are right in the middle of every68881 extended number. Appendix G "The SANE Library" in the MacintoshProgrammer's Workshop (MPW) Object Pascal version 3.1 manual goes into detailabout this. The <code>FormatX2Str</code> and <code>FormatStr2X</code> parse the extended number you passthem directly, and they can only parse 10-byte extended numbers. Fortunately,you can still use the -mc68881 option with these routines as long as youconvert any extended numbers to 80-bit extended numbers before passing them to<code>FormatX2Str</code> and <code>FormatStr2X</code>. The SANE.p unit has routines to do this calledX96toX80 and X80toX96 (incorrectly documented as X96to80 and X80to96 in the MPWObject Pascal manual). Because the extended80 and extended96 types aren'tequivalent to the extended type as far as Object Pascal is concerned, you haveto redeclare <code>FormatX2Str</code> and <code>FormatStr2X</code> to take these types. You can do thisas follows:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION FormatX2Str80 (x:             extended80;                        myCanonical:   NumFormatString;                        partsTable:    NumberParts;                        VAR outString:  Str255):  FormatStatus;    INLINE $2F3C,$8210,$FFE8,$A8B5;FUNCTION FormatStr2X80 (source:      Str255;                        myCanonical:  NumFormatString;                        partsTable:  NumberParts;                        VAR x:       extended80):  FormatStatus;    INLINE $2F3C,$8210,$FFE6,$A8B5;</pre>	</TD></TR></TABLE></CENTER><p>Call these routines instead of the originals. To call <code>FormatX2Str80</code>, all youhave to do is this:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>VAR   x:             extended80; {96-bit extended number}   myCanonical:   NumFormatString;   partsTable:    NumberParts;   outString:     Str255result := FormatX2Str80 (X96toX80 (x), myCanonical, partsTable, outString);</pre>	</TD></TR></TABLE></CENTER><p>Calling <code>FormatStr2X80</code> is just slightly more complicated because the extendednumber is passed by reference:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>VAR   x:           extended;   {96-bit extended number}   x80:         extended80; {80-bit extended number}   source:      Str255;   myCanonical:  NumFormatString;   partsTable:  NumberParts;x80 := X96toX80 (x);result := FormatStr2X80 (theString, realCanon, PartsTable, x80);x := X80toX96 (x80);</pre>	</TD></TR></TABLE></CENTER><p>You should find that these calls now work properly with the -mc68881 optionset. This of course means that you'll need two versions of the source code; onewith the calls to convert between 96-bit and 80-bit extended numbers for usewith the -mc68881 option and another one which just uses plain old 80-bitextended numbers for use when the -mc68881 option is turned off.</p><a name="Section3"></a> <P><A HREF="#top">Back to top</A></P><h2>FormatX2Str strings</h2><p>Date Written:  10/9/91</p><p>Last reviewed:  6/14/93</p><p>Using the Script Manager to convert numbers to strings and vice versa, in anylanguage, what's the best way to create the string to pass to FormatX2Str? Willstrings using the characters: "#" or "0" or "." or "," work no matter whatscript is currently running, and if not, what can I do?</p><p>___</p><p>The number format string and canonical number format string mechanisms that youuse with <code>FormatX2Str</code> and its kin is a strange design, for exactly the reasonthat you asked about. The number format string (the one with the characterssuch as "#" and "0") does not necessarily work right regardless of the currentscript. In fact, it doesn't even necessarily work right between localizedversions within one script system. The canonical number format string does workbetween localized systems and between script systems. The strange thing isthere's an easy way to store number format strings (usually in a 'STR 'resource), but no obvious way to store canonical number format strings. Here'swhat you can do when converting between numbers and strings:</p><p>When you convert a number format string to a canonical number format stringwith <code>Str2Format</code> on a U.S. system, it converts it from something like "###.###"to a canonical number format string that looks something like, "three digits, adecimal point, and three digits." On a German system, that same number formatstring would be converted to "three digits, a thousands separator, and threedigits."</p><p>What you can do to get around this is to save the canonical number formatstring in a resource instead of the number format string. The canonical stringstores things in a language- and script-independent way. Create this resourceby writing a trivial utility program that takes a number format string andcalls <code>Str2Format</code> to convert it into a canonical number format string, and thencopy this into a handle and save it as a resource of a custom type, like'NUMF'. In your real program, load the 'NUMF' resource, lock it, and then passthe dereferenced handle to <code>FormatX2Str</code> and <code>FormatStr2X</code>.</p><p>You can see this done in the ProcDoggie Process Manager sample from the 7.0Golden Master CD. Take a look at the <code>SetUpProcessInfoItems</code> procedure inUProcessGuts.inc1.p file. You'll see that the <code>'NUMF'</code> resource is loaded,locked, and then passed to <code>FormatX2Str</code>. The result is displayed in the ProcessInformation window.</p><p>If your program is localized by nonprogrammers, then you might want to providethe utility that converts a number format string to a canonical number formatstring resource just in case they have to change the entire format of thestring. Then they can install the new '<code>NUMF'</code> (or whatever you choose) resourceas part of the localization process.</p><a name="Section4"></a> <P><A HREF="#top">Back to top</A></P><h2>Code for truncating a multi-byte character string</h2><p>Date Written:  1/24/92</p><p>Last reviewed:  6/14/93</p><p>I create a Macintosh file name from another file name. Since I am addinginformation to the name, I must make sure that it is within the 31 charsmaximum allowed by the operating system. What I need is the equivalent of the<code>TruncText</code> command, except instead of dealing with pixel width, I want the widthto be number of characters (31). I can trunc myself, but I'd rather do a proper<code>smTruncMiddle</code> and have it nicely internationalized.</p><p>___</p><p>If you're going to be adding a set number of bytes to the end of a existingstring and you don't want the localized ellipsis (from the <code>'itl4'</code> resource)between the truncated string and your bytes, then you can use this routine:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>PROCEDURE TruncPString (VAR theString: Str255; maxLength: Integer);{ This procedure truncates a Pascal string to be of length maxLength or }{ shorter. It uses the Script Manager charByte function to make sure }{ the string is not broken in the middle of a multi-byte character. }  VAR    charType: Integer;  BEGIN    IF Length(theString) &gt; maxLength THEN      BEGIN        charType := CharByte(@theString[1], maxLength);        WHILE ((charType &lt; 0) OR (charType &gt; 1)) AND (maxLength &lt;&gt; 0) DO          BEGIN            maxLength := maxLength - 1;            charType := CharByte(@theString[1], maxLength);          END;        theString[0] := chr(maxLength);      END;  END;  </pre>	</TD></TR></TABLE></CENTER><p>If you want the localized ellipsis (from the <code>'itl4'</code> resource) between thetruncated string and your bytes, or you want the localized ellipsis in themiddle of the combined strings truncated to a specific length, then you can usethis routine:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>FUNCTION TruncPString (maxLength: Integer; VAR theString: Str255;truncWhere: TruncCode): Integer;{ This function truncates a Pascal String to be of length maxLength or }{ shorter. It uses the Script Manager TruncString function which adds }{ the correct tokenEllipsis to the middle or end of the string. See }{ Inside Macintosh Volume VI, pages 14-59 and14-60 for more info. }  VAR    found: Boolean;    first, midPoint, last: Integer;    tempString: Str255;    whatHappened: Integer;  BEGIN    found := FALSE;    first := 0;    last := TextWidth(@theString[1], 0, Length(theString));    IF Length(theString) &gt; maxLength THEN      BEGIN        WHILE (first &lt;= last) AND NOT found DO          BEGIN            tempString := theString; { tempString gets destroyed every }                                     { time through }            midPoint := (first + last) DIV 2;            whatHappened := TruncString(midPoint, tempString, truncWhere);            IF whatHappened &lt; smNotTruncated THEN              BEGIN { ERROR, bail out now }                TruncPString := whatHappened; { return error }                Exit(TruncPString);              END            ELSE IF Length(tempString) = maxLength THEN              found := TRUE            ELSE IF Length(tempString) &gt; maxLength THEN              last := midPoint - 1            ELSE              first := midPoint + 1;          END;        theString := tempString;        TruncPString := whatHappened; { will always be smTruncated }                                      { in this case }      END    ELSE      TruncPString := smNotTruncated; { the string wasn't too long }  END;</pre>	</TD></TR></TABLE></CENTER><a name="Section5"></a> <P><A HREF="#top">Back to top</A></P><h2>Character type and subtype values within the Kanji system</h2><p>Date Written:  11/17/89</p><p>Last reviewed:  12/17/90</p><p>What are the values of character type and subtype with the Macintosh Kanji system?</p><p>___</p><p>For Roman, these are the values of character type:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Punctuation         0    ASCII               1    European            7    </pre>	</TD></TR></TABLE></CENTER>    <p>For KanjiTalk, the values are the same as Roman, with the addition of:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Katakana            2    Hiragana            3    Kanji               4    Greek               5    Russian (Cyrillic)  6</pre>	</TD></TR></TABLE></CENTER>    <p>In Roman, the subtype field is interpreted as:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    Normal punctuation  0    Numeric             1    Symbols             2    Blanks              3</pre>	</TD></TR></TABLE></CENTER><p>The KanjiTalk subtype values are the same as Roman except if the character typeis Kanji, in which case the subtype field takes these values:</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>    JIS Level 1         0    JIS Level 2         1    JIS User Character  2    </pre>	</TD></TR></TABLE></CENTER>    <p>Finally, for KanjiTalk, the character direction field is replaced by the In-ROMfield. It is 1 if the character is in the ROM card and 0 otherwise.</p>         <P><A HREF="#top">Back to top</A></P>                  <P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (36K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/ic_520.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>                  <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/ic/ic_520.html%3Fid%3DDTS10002519-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/ic/ic_520.html%3Fid%3DDTS10002519-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/ic/ic_520.html%3Fid%3DDTS10002519-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>