<!-- Generated by Harlequin WebMaker 2.2.3 (23-Apr-1996)
LispWorks 3.2.2 -->
<HTML> <HEAD>
<TITLE>Summary of the Desktop Manager (IM: MTb)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING511></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MoreToolbox-510.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-512.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MoreToolbox-2.html"><B>More Macintosh Toolbox</B></A> / <BR><DD><A HREF="MoreToolbox-483.html"><B>Chapter 9 - Desktop Manager</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING511-0></A>
<H1><A NAME=MARKER-21-128></A>Summary of the Desktop Manager</H1>
<A NAME=HEADING511-1></A>
<H2>Pascal Summary</H2>
<A NAME=HEADING511-2></A>
<H3><A NAME=MARKER-21-136></A>Constants</H3>
<PRE>
CONST 
      {for mapping icons to ioIconType in the desktop database}
      kLargeIcon                    = 1;        {'ICN#'}
      kLarge4BitIcon                = 2;        {'icl4'}
      kLarge8BitIcon                = 3;        {'icl8'}
      kSmallIcon                    = 4;        {'ics#'}
      kSmall4BitIcon                = 5;        {'ics4'}
      kSmall8BitIcon                = 6;        {'ics8'}
      
      {for allocating storage for icon data in the desktop database}
      kLargeIconSize                = 256;      {'ICN#'}
      kLarge4BitIconSize            = 512;      {'icl4'}
      kLarge8BitIconSize            = 1024;     {'icl8'}
      kSmallIconSize                = 64;       {'ics#'}
      kSmall4BitIconSize            = 128;      {'ics4'}
      kSmall8BitIconSize            = 256;      {'ics8'}
</PRE>
<A NAME=HEADING511-4></A>
<H3><A NAME=MARKER-21-137></A>Data Types</H3>
<PRE>
TYPE  DTPBPtr = ^DTPBRec;
      DTPBRec =                     {parameter block for desktop database}
      RECORD
         qLink:            QElemPtr;      {next queue entry}
         qType:            Integer;       {queue type}
         ioTrap:           Integer;       {routine trap}
         ioCmdAddr:        Ptr;           {routine address}
         ioCompletion:     ProcPtr;       {completion routine}
         ioResult:         OSErr;         {result code}
         ioNamePtr:        StringPtr;     {file, directory, or volume name}
         ioVRefNum:        Integer;       {volume reference number}
         ioDTRefNum:       Integer;       {desktop database reference number}
         ioIndex:          Integer;       {index into icon list}
         ioTagInfo:        LongInt;       {tag information}
         ioDTBuffer:       Ptr;           {data buffer}
         ioDTReqCount:     LongInt;       {requested length of data}
         ioDTActCount:     LongInt;       {actual length of data}
         filler1:          SignedByte;    {unused}
         ioIconType:       SignedByte;    {icon type}
         filler2:          Integer;       {unused}
         ioDirID:          LongInt;       {parent directory ID}
         ioFileCreator:    OSType;        {file creator}
         ioFileType:       OSType;        {file type}
         ioFiller3:        LongInt;       {unused}
         ioDTLgLen:        LongInt;       {logical length of desktop }
                                          { database}
         ioDTPyLen:        LongInt;       {physical length of desktop }
                                          { database}
         ioFiller4:                       {unused}
                           ARRAY[1..14] OF Integer;
         ioAPPLParID:      LongInt        {parent directory ID of }
                                          { application}
      END;
      DTPBPtr = ^DTPBRec;                 {pointer to desktop }
                                          { parameter block}
</PRE>
<A NAME=HEADING511-6></A>
<H3><A NAME=MARKER-21-138></A>Routines</H3>
<A NAME=HEADING511-7></A>
<H4><A NAME=MARKER-21-139></A>Locating, Opening, and Closing the Desktop Database</H4>
<PRE>
FUNCTION PBDTGetPath       (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTOpenInform    (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTCloseDown     (paramBlock: DTPBPtr): OSErr;
</PRE>
<A NAME=HEADING511-11></A>
<H4><A NAME=MARKER-21-140></A>Reading the Desktop Database</H4>
<PRE>
FUNCTION PBDTGetIcon       (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTGetIconAsync  (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetIconSync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetIconInfo   (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTGetIconInfoAsync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetIconInfoSync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetAPPL       (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTGetAPPLAsync  (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetAPPLSync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetComment    (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTGetCommentAsync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetCommentSync
                           (paramBlock: DTPBPtr): OSErr;
</PRE>
<A NAME=HEADING511-28></A>
<H4>Adding to the Desktop Database</H4>
<PRE>
FUNCTION PBDTAddIcon       (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTAddIconAsync  (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTAddIconSync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTAddAPPL       (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTAddAPPLAsync  (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTAddAPPLSync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTSetComment    (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTSetCommentAsync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTSetCommentSync
                           (paramBlock: DTPBPtr): OSErr;
</PRE>
<A NAME=HEADING511-40></A>
<H4><A NAME=MARKER-21-141></A>Deleting Entries From the Desktop Database</H4>
<PRE>
FUNCTION PBDTRemoveAPPL    (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTRemoveAPPLAsync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTRemoveAPPLSync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTRemoveComment (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTRemoveCommentAsync
                           (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTRemoveCommentSync
                           (paramBlock: DTPBPtr): OSErr;
</PRE>
<A NAME=HEADING511-51></A>
<H4><A NAME=MARKER-21-142></A>Manipulating the Desktop Database Itself</H4>
<PRE>
FUNCTION PBDTFlush         (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTFlushAsync    (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTFlushSync     (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetInfo       (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTGetInfoAsync  (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTGetInfoSync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTReset         (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTResetAsync    (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTResetSync     (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTDelete        (paramBlock: DTPBPtr; async: Boolean): OSErr;
FUNCTION PBDTDeleteAsync   (paramBlock: DTPBPtr): OSErr;
FUNCTION PBDTDeleteSync    (paramBlock: DTPBPtr): OSErr;
</PRE>
<A NAME=HEADING511-64></A>
<H2>C Summary</H2>
<A NAME=HEADING511-65></A>
<H3><A NAME=MARKER-21-136></A>Constants</H3>
<PRE>
enum {
      /*for mapping icons to ioIconType in the desktop database*/
      kLargeIcon                    = 1,     /*'ICN#'*/
      kLarge4BitIcon                = 2,     /*'icl4'*/
      kLarge8BitIcon                = 3,     /*'icl8'*/
      kSmallIcon                    = 4,     /*'ics#'*/
      kSmall4BitIcon                = 5,     /*'ics4'*/
      kSmall8BitIcon                = 6,     /*'ics8'*/
      
      /*for allocating storage for icon data in the desktop database*/
      kLargeIconSize                = 256,   /*'ICN#'*/
      kLarge4BitIconSize            = 512,   /*'icl4'*/
      kLarge8BitIconSize            = 1024,  /*'icl8'*/
      kSmallIconSize                = 64,    /*'ics#'*/
      kSmall4BitIconSize            = 128,   /*'ics4'*/
      kSmall8BitIconSize            = 256    /*'ics8'*/
};
</PRE>
<A NAME=HEADING511-67></A>
<H3><A NAME=MARKER-21-137></A>Data Types</H3>
<PRE>
struct DTPBRec {           /*parameter block for desktop database*/ 
   ParamBlockHeader 
   short    ioDTRefNum;                      /*desktop refnum*/
   short    ioIndex;                         /*index into icon list*/
   long     ioTagInfo;                       /*tag information*/
   Ptr      ioDTBuffer;                      /*data buffer*/
   long     ioDTReqCount;                    /*requested length of data*/
   long     ioDTActCount;                    /*actual length of data*/
   char     ioFiller1;                       /*unused*/
   char     ioIconType;                      /*icon type*/
   short    ioFiller2;                       /*unused*/
   long     ioDirID;                         /*parent directory ID*/
   OSType   ioFileCreator;                   /*file creator*/
   OSType   ioFileType;                      /*file type*/
   long     ioFiller3;                       /*unused*/
   long     ioDTLgLen;                       /*logical length of */
                                             /* desktop database*/
   long     ioDTPyLen;                       /*physical length of desktop */
                                             /* database*/
   short    ioFiller4[14];                   /*unused*/
   long     ioAPPLParID;                     /*parent directory ID of */
                                             /* application*/
};
typedef struct DTPBRec DTPBRec;
typedef DTPBRec *DTPBPtr;
</PRE>
<A NAME=HEADING511-69></A>
<H3><A NAME=MARKER-21-138></A>Routines</H3>
<A NAME=HEADING511-70></A>
<H4><A NAME=MARKER-21-139></A>Locating, Opening, and Closing the Desktop Database</H4>
<PRE>
pascal OSErr PBDTGetPath     (DTPBPtr paramBlock);
pascal OSErr PBDTOpenInform
                             (DTPBPtr paramBlock);
pascal OSErr PBDTCloseDown   (DTPBPtr paramBlock);
</PRE>
<A NAME=HEADING511-75></A>
<H4><A NAME=MARKER-21-140></A>Reading the Desktop Database</H4>
<PRE>
pascal OSErr PBDTGetIcon     (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTGetIconAsync 
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetIconSync 
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetIconInfo
                             (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTGetIconInfoAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetIconInfoSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetAPPL     (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTGetAPPLAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetAPPLSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetComment
                             (DTPBPtr paramBlock, Boolean async); 
pascal OSErr PBDTGetCommentAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetCommentSync
                             (DTPBPtr paramBlock);
</PRE>
<A NAME=HEADING511-98></A>
<H4>Adding to the Desktop Database</H4>
<PRE>
pascal OSErr PBDTAddIcon     (DTPBPtr paramBlock, Boolean async); 
pascal OSErr PBDTAddIconAsync 
                             (DTPBPtr paramBlock);
pascal OSErr PBDTAddIconSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTAddAPPL     (DTPBPtr paramBlock, Boolean async); 
pascal OSErr PBDTAddAPPLAsync 
                             (DTPBPtr paramBlock);
pascal OSErr PBDTAddAPPLSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTSetComment
                             (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTSetCommentAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTSetCommentSync
                             (DTPBPtr paramBlock);
</PRE>
<A NAME=HEADING511-115></A>
<H4><A NAME=MARKER-21-141></A>Deleting Entries From the Desktop Database</H4>
<PRE>
pascal OSErr PBDTRemoveAPPL
                             (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTRemoveAPPLAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTRemoveAPPLSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTRemoveComment
                             (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTRemoveCommentAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTRemoveCommentSync
                             (DTPBPtr paramBlock);
</PRE>
<A NAME=HEADING511-128></A>
<H4><A NAME=MARKER-21-142></A>Manipulating the Desktop Database Itself</H4>
<PRE>
pascal OSErr PBDTFlush       (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTFlushAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTFlushSync   (DTPBPtr paramBlock);
pascal OSErr PBDTGetInfo     (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTGetInfoAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTGetInfoSync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTReset       (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTResetAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTResetSync   (DTPBPtr paramBlock);
pascal OSErr PBDTDelete      (DTPBPtr paramBlock, Boolean async);
pascal OSErr PBDTDeleteAsync
                             (DTPBPtr paramBlock);
pascal OSErr PBDTDeleteSync
                             (DTPBPtr paramBlock);
</PRE>
<A NAME=HEADING511-147></A>
<H2><A NAME=MARKER-9-143></A><A NAME=MARKER-21-144></A>Assembly-Language Summary</H2>
<A NAME=HEADING511-148></A>
<H3>Data Structures</H3>
<A NAME=HEADING511-149></A>
<H4><A NAME=MARKER-21-145></A>Desktop Parameter Block
<TABLE BORDER="0" CELLPADDING=3><TD>--><TD>12<TD>ioCompletion<TD>long<TD>completion routine<TR>
<TD>\xAE<TD>16<TD>ioResult<TD>word<TD>result code<TR>
<TD>--><TD>18<TD>ioNamePtr<TD>long<TD>pointer to file, directory, or volume name<TR>
<TD>--><TD>22<TD>ioVRefNum<TD>word<TD>volume reference number<TR>
<TD>\xA5<TD>24<TD>ioDTRefNum<TD>word<TD>desktop database reference number<TR>
<TD>--><TD>26<TD>ioIndex<TD>word<TD>index into icon list; or number of files in database<TR>
<TD>\xA5<TD>28<TD>ioTagInfo<TD>long<TD>tag information<TR>
<TD>--><TD>32<TD>ioDTBuffer<TD>long<TD>pointer to icon data<TR>
<TD>--><TD>36<TD>ioDTReqCount<TD>long<TD>requested size of icon data buffer<TR>
<TD>\xAE<TD>40<TD>ioDTActCount<TD>long<TD>actual size of icon definition<TR>
<TD>\xA5<TD>44<TD>ioIconType<TD>byte<TD>icon's type<TR>
<TD>\xA5<TD>48<TD>ioDirID<TD>long<TD>parent directory<TR>
<TD>--><TD>52<TD>ioFileCreator<TD>long<TD>file creator<TR>
<TD>\xA5<TD>56<TD>ioFileType<TD>long<TD>file type<TR>
<TD>\xAE<TD>64<TD>ioDTLgLen<TD>long<TD>logical length of database files<TR>
<TD>\xAE<TD>68<TD>ioDTPyLen<TD>long<TD>physical length of database files<TR>
<TD>\xAE<TD>100<TD>ioAPPLParID<TD>long<TD>application's parent directory</TABLE>
</H4>
<A NAME=HEADING511-150></A>
<H3>Trap Macros<A NAME=MARKER-21-146></A></H3>
<A NAME=HEADING511-151></A>
<H4>Trap Macros Requiring Routine Selectors</H4>
<PRE>
_HFSDispatch
</PRE>
<TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Selector<TH>Routine<TR>
<TD>$0020<TD>PBDTGetPath<TR>
<TD>$0021<TD>PBDTCloseDown<TR>
<TD>$0022<TD>PBDTAddIcon<TR>
<TD>$0023<TD>PBDTGetIcon<TR>
<TD>$0024<TD>PBDTGetIconInfo<TR>
<TD>$0025<TD>PBDTAddAPPL<TR>
<TD>$0026<TD>PBDTRemoveAPPL<TR>
<TD>$0027<TD>PBDTGetAPPL<TR>
<TD>$0028<TD>PBDTSetComment<TR>
<TD>$0029<TD>PBDTRemoveComment<TR>
<TD>$002A<TD>PBDTGetComment<TR>
<TD>$002B<TD>PBDTFlush<TR>
<TD>$002C<TD>PBDTReset<TR>
<TD>$002D<TD>PBDTGetInfo<TR>
<TD>$002E<TD>PBDTOpenInform<TR>
<TD>$002F<TD>PBDTDelete</TABLE>


<A NAME=HEADING511-153></A>
<H2>Result Codes</H2>
<TABLE BORDER="0" CELLPADDING=3><TD>noErr<TD>0<TD>No error<TR>
<TD>nsvErr<TD>-35<TD>No such volume<TR>
<TD>ioErr<TD>-36<TD>I/O error<TR>
<TD>fnfErr<TD>-43<TD>File or directory doesn't exist<TR>
<TD>wPrErr<TD>-44<TD>Volume is locked through hardware<TR>
<TD>vLckdErr<TD>-46<TD>Volume is locked through software<TR>
<TD>paramErr<TD>-50<TD>Parameter error; use <CODE>PBDTGetPath</CODE><TR>
<TD>rfNumErr<TD>-51<TD>Reference number invalid<TR>
<TD>extFSErr<TD>-58<TD>External file system--file system identifier is nonzero<TR>
<TD>desktopDamagedErr<TD>-1305<TD>The desktop database has become corrupted--the Finder will fix this, but if your application is not running with the Finder, use <CODE>PBDTReset</CODE> or <CODE>PBDTDelete</CODE><TR>
<TD>afpItemNotFound<TD>-5012<TD>Information not found<TR>
<TD>afpIconTypeError<TD>-5030<TD>Sizes of new icon and one it replaces don't match</TABLE>


</BLOCKQUOTE>
<HR>
<center>
<A HREF="MoreToolbox-510.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MoreToolbox-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MoreToolbox-513.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MoreToolbox-512.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MoreToolbox-3.html">&copy; Apple Computer, Inc.</A><br>6 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>   
