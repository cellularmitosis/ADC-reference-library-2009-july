<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> When to Revert or Undo in an Editing Context</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.36.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.38.html"><img src="next.gif" border="0" alt="Next"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="13786"> </A>When to Revert or Undo in an Editing Context</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes when and how to revert or undo changes made to the Enterprise Objects (EOs) using an EOEditingContext.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Description</H2><P CLASS="Body"><A NAME="pgfId=606105"> </A>EOF provides an object-based undo to allow the greatest flexibility for your user interface. You can redo, undo, or completely revert all changes you have made to your objects.</P><P CLASS="Body"><A NAME="pgfId=606106"> </A>With EOF 3.0, the undo manager becomes a new class, NSUndoManager, defined in the Foundation framework. NSUndoManager is a general-purpose recorder for undo and redo operations. NSUndoManager automatically groups all operations within a single cycle of the run loop, so that performing an undo will revert all changes that occurred during the loop. Each editing context in an application has its own private NSUndoManager.</P><P CLASS="Body"><A NAME="pgfId=606107"> </A>Every time an object is about to change, it invokes the <TT CLASS="Code">willChange</TT> message to notify its observers. The editing context receiving these notifications will record the undo operations accordingly. </P><P CLASS="Body"><A NAME="pgfId=606108"> </A>The EOEditingContext class provides the following methods to perform undo operations.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607941"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=607943"> </A>-(void)undo:(id)sender;<A NAME="pgfId=607945"> </A>-(void)redo:(id)sender;<A NAME="pgfId=607947"> </A>-(void)revert; </PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607953"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=607955"> </A>-(void) revert:(id) sender; // as a target action  method for Interface Builder</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607960"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607962"> </A>public native void undo ();<A NAME="pgfId=607964"> </A>public native void redo ();<A NAME="pgfId=607966"> </A>public native void revert ();</PRE><P CLASS="Body"><A NAME="pgfId=616026"> </A></P><P CLASS="Body"><A NAME="pgfId=606121"> </A>When you send the undo or redo messages to an editing context, they are forwarded to its undo manager. The <TT CLASS="Code">undo</TT> method closes the last open undo group and then applies all of the undo operations in that group (recording any undo operations as redo operations instead). The <TT CLASS="Code">redo</TT> method likewise applies all of the redo operations on the top redo group.</P><P CLASS="Body"><A NAME="pgfId=606122"> </A>Note that <TT CLASS="Code">undo</TT> is intended for undoing top-level groups, and should not be used for nested undo groups. If any unclosed nested undo groups are on the stack when <TT CLASS="Code">undo</TT> is invoked, an exception will be raised. To undo nested groups, you must explicitly close the group with an <TT CLASS="Code">endUndoGrouping</TT> message to the undo manager, then use <TT CLASS="Code">undoNestedGroup</TT> to undo it.</P><P CLASS="Body"><A NAME="pgfId=606123"> </A>While <TT CLASS="Code">undo</TT> only performs undoing of top-level groups, <TT CLASS="Code">revert</TT> is a more extensive <TT CLASS="Code">undo</TT>. The <TT CLASS="Code">revert</TT> method removes everything from the undo stack. It throws out all insertions and deletions and restores the updated objects to their last committed values.</P><P CLASS="Body"><A NAME="pgfId=607075"> </A>Note that <TT CLASS="Code">revert</TT> does not cause a refetch from the database. It also does not replay the entire undo stack. If you add your own operations to the undo stack, they may not be properly reverted. The <TT CLASS="Code">revert</TT> method also does not undo changes in display groups. Display groups that allow insertion and deletion of objects must be refetched whenever their editing context is reverted so that the user-interface display can be properly synchronized.</P><P CLASS="Body"><A NAME="pgfId=606125"> </A>Usually, you do not need to write any code, and can simply connect your user-interface widgets to the appropriate undo, redo, or revert operations using Interface Builder.</P><P CLASS="Warning"><A NAME="pgfId=606126"> </A><DIV><IMG SRC="ProgrammingTopics-12.gif"></DIV>Note	The EOJavaClient framework released in EOF 3.0 does not support undo.<DIV><IMG SRC="ProgrammingTopics-12.gif"></DIV></P></DIV><DIV><H3 CLASS="Heading2"><A NAME="pgfId=606127"> </A>Caveats</H3><P CLASS="Body"><A NAME="pgfId=606128"> </A>NSUndoManager does not retain the targets of undo operations. However, it does contain references to the targets of the undo operations since it needs them to send undo messages when undo is performed. </P><P CLASS="Body"><A NAME="pgfId=606129"> </A>Therefore, to avoid objects being leaked as your application runs, you should remember to clean the undo stack periodically.</P><P CLASS="Body"><A NAME="pgfId=606131"> </A>For example, you could clean the stack after a save operation with the following message, or wherever it is appropriate depending on your undo policy. Note that, from a database access perspective, it is not recommended to allow an undo past a prior save point.</P><PRE CLASS="Code"><A NAME="pgfId=606133"> </A>[[editingContext undoManager] forgetAllObjectsWithTarget: editingContext];</PRE></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606136"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606138"> </A><A HREF="ProgrammingTopics.36.html#33427" CLASS="XRef">Invalidating Objects</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616065"> </A>NSUndoManager class specification in the <EM CLASS="Emphasis">Foundation Framework Reference</EM></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606140"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606141"> </A>What are the differences between undo and revert?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606142"> </A>How do I use undo, redo, and revert?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606143"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606144"> </A>Undo</LI><LI CLASS="Bulleted"><A NAME="pgfId=606145"> </A>Redo</LI><LI CLASS="Bulleted"><A NAME="pgfId=606146"> </A>Revert</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606149"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606150"> </A>24 July, 1998. Mai Nguyen. First Draft.<BR>19 November, 1998. Clif Liu. Second Draft.</P><PRE CLASS="Code"><A NAME="pgfId=602450"> </A></PRE></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.36.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.38.html"><img src="next.gif" border="0" alt="Next"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>