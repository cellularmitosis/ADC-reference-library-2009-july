<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<title>Shark User Guide: Introduction</title>
	<meta id="Generator" name="Generator" content="Gutenberg"/>
	<meta id="GeneratorVersion" name="GeneratorVersion" content="v132"/>
	<meta http-equiv="content-type" content="text/html;charset=utf-8"/>
	<meta id="Copyright" name="Copyright" content="Copyright 2009 Apple Inc. All Rights Reserved."/>
	<meta id="IndexTitle" name="IndexTitle" content="Introduction"/>
	<meta id="xcode-display" name="xcode-display" content="render"/>
	<meta id="toc-file" name="toc-file" content="../toc.html"/>
	<meta id="RESOURCES" content="../../../../Resources" />
	
	<link rel="stylesheet" type="text/css" href="../../../../Resources/CSS/frameset_styles.css"/>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/prototype.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/lib/scriptaculous.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/page.js"></script>
	<script language="JavaScript" type="text/javascript" src="../../../../Resources/JavaScript/pedia.js"></script>
	<!--[if lte IE 6]>
		<style type="text/css">
			/*<![CDATA[*/ 
			html {overflow-x:auto; overflow-y:hidden;  }
			/*]]>*/
		</style>
	<![endif]-->
</head>    
<body bgcolor="#ffffff" onload="initialize_page();"><a name="//apple_ref/doc/uid/TP40005233-CH1" title="Introduction"></a>
    <noscript>
    <div id="tocMenu">
        <iframe id="toc_content" name="toc_content" SRC="../toc.html" width="210" height="100%" align="left" frameborder="0">This document set is best viewed in a browser that supports iFrames.</iframe>
    </div>
    </noscript>
    <div id="bodyText">
        <a name="top"></a>
        <div class="hideOnPrint hideInXcode">
        <!-- start of header -->
        <!--#include virtual="/includes/framesetheader" -->
        <!-- end of header -->
        </div>
        
        <!-- start of path -->
<div class="breadcrumb hideOnPrint hideInXcode"><a href="http://developer.apple.com/" target="_top">ADC Home</a> &gt; <a href="../../../../../referencelibrary/index.html#//apple_ref/doc/uid/TP30000943" target="_top">Reference Library</a> &gt; <a href="../../../../index.html#//apple_ref/doc/uid/TP30000440" target="_top">Guides</a> &gt; <a href="../../../index.html#//apple_ref/doc/uid/TP30000440-TP30000436" target="_top">Tools</a> &gt; <a href="../../../Performance-date.html#//apple_ref/doc/uid/TP30000440-TP30000436-TP30000901" target="_top">Performance</a> &gt; <a href="Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_6">Shark User Guide</a> &gt; </div><br class="hideInXcode"/><!-- end of path -->
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <!-- Previous button --><span style="margin-left: 8px"><a href="../GettingStartedwithShark/GettingStartedwithShark.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCUpperSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" hideText="Hide TOC" showText="Show TOC" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <hr />
        
        
        <a name="//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_6" title="Introduction"></a><h1>Introduction</h1>
<!-- This template is being used for both PDF and HTML. -->
<!-- TopicBook.pm currently relies on the element name bmini_toc. -->

    <h4>Contents:</h4>
    
    <p class="blockquote">

        
			
            
                <a href="Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_7">Overview</a>
                
            <br/>
            
        
			
            
                <a href="Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_1">Philosophy</a>
                
            <br/>
            
        
			
            
                <a href="Introduction.html#//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_2">Organization of This Document</a>
                
            <br/>
            
        

    </p><br/>

<a name="//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_7" title="Overview"></a><h2>Overview</h2><p>Shark is a tool for performance understanding and optimization. Why is it called “Shark?” Performance tuning requires a hunter’s mentality, and no animal is as pure in this quest as a shark. A shark is also an expert in his field — one who uses all potential resources to achieve his goals. The name “Shark” embodies the spirit and emotion you should have when tuning your code.</p><p>To help you analyze the performance of your code, Shark allows you to profile the entire system (kernel and drivers as well as applications). At the simplest level, Shark profiles the system while your code is running to see where time is being spent. It can also produce profiles of hardware and software performance events such as cache misses, virtual memory activity, memory allocations, function calls, or instruction dependency stalls. This information is an invaluable first step in your performance tuning effort so you can see which parts of your code or the system are the bottlenecks.</p><p>In addition to showing you where time is being spent, Shark can give you advice on how to improve your code. Shark is capable of identifying many common performance pitfalls and visually presents the costs of these problems to you.</p><a name="//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_1" title="Philosophy"></a><h2>Philosophy</h2><p>The first and most important step when optimizing your code is to determine what to optimize. In a program of moderate complexity, there can be thousands of different code paths. Optimizing all of them is normally impractical due to deadlines and limited programmer resources. There are also more subtle tradeoffs between optimized code and portability and maintenance that limit candidates for optimization. </p><p>Here are a few general guidelines for finding a good candidate for optimization:</p><ol class="ol"><li class="li"><p>It should be time-critical. This is generally any operation that is perceptibly slow; the user has to wait for the computer to finish doing something before continuing. Optimizing functionality that is already faster than the user can perceive is usually unnecessary.</p></li><li class="li"><p>It must be relevant. Optimizing functionality that is rarely used is usually counter-productive.</p></li><li class="li"><p>It shows up as a hot spot in a time profile. If there is no obvious hot spot in your code or you are spending a lot of time in system libraries, performance is more likely to improve through high-level improvements (architectural changes).</p></li></ol><p>Low-level optimizations typically focus on a single segment of code and make it a better match to the hardware and software systems it is being run on. Examples of low-level optimizations include using vector or cache hint instructions. High-level optimizations include algorithmic or other architectural changes to your program. Examples of high-level optimizations include data structure choice (for example, switching from a linked list to a hash-table) or replacing calls to computationally expensive functions with a cache or lookup table.</p><p>Remember, it is critical to profile <em>before</em> investing your time and effort in optimization. Sadly, many programmers invest prodigious amounts of effort optimizing what their intuition tells them is the performance-critical section of code only to realize <em>no performance improvement</em>. Profiling quickly reveals that bottlenecks often lie far from where programmers might assume they are. Using Shark, you can focus your optimization efforts on both algorithmic changes and tuning performance-critical code. Often, even small changes to a critical piece of code can yield large overall performance improvements.</p><p>By default, Shark creates a profile of execution behavior by periodically interrupting each processor in the system and sampling the currently running process, thread, and instruction address as well as the function callstack. Along with this contextual information, Shark can record the values of hardware and software performance counters. Each counter is capable of counting a wide variety of performance events. In the case of processor and memory controller counters, these include detailed, low-level information that is otherwise impossible to know without a simulator.
The overhead for sampling with Shark is extremely low because all sample collection takes place in the kernel and is based on hardware interrupts. A typical sample incurs an overhead on the order of 20μs. This overhead can be significantly larger if callstack recording is enabled and a virtual memory fault is incurred while saving the callstack. 
Time profiles generated by Shark are statistical in nature; they give a representative view of what was running on the system during a sampling session . Samples can include all of the processes running on the system from both user and supervisor code, or samples can be limited to a specific process or execution state.
Shark’s sampling period can be an arbitrary time interval (timer sampling). Shark also has the ability to use a performance event as the sampling trigger (event sampling). Using event sampling, it is possible to associate performance events such as cache misses or instruction stalls with the code that caused them. Additionally, Shark can generate exact profiles for specific function calls or memory allocations.</p><a name="//apple_ref/doc/uid/TP40005233-CH1-DontLinkElementID_2" title="Organization of This Document"></a><h2>Organization of This Document</h2><p>This manual is organized into four major sections, each consisting of two or three chapters, plus several appendices. Here is a brief “roadmap” to help you orient yourself:</p><ul class="ul"><li class="li"><p><strong>Getting Started with Shark</strong>— This introduction and <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW3">“Getting Started with Shark”</a></span> are designed to give you an overall introduction to Shark. After covering some basic philosophy here, <span class="content_text"><a href="../GettingStartedwithShark/GettingStartedwithShark.html#//apple_ref/doc/uid/TP40005233-CH2-SW3">“Getting Started with Shark”</a></span> describes basic ways to use Shark to sample your applications, features of the <em>Session</em> windows that open after you sample your applications, and the use of Shark’s global preferences.</p></li><li class="li"><p><strong>Profiling Configurations</strong>— Three chapters discuss Shark’s default <em>Configurations</em> — its methods of collecting samples from your system or applications — and presentation of the sampled results in <em>Session</em> windows. These chapters are probably the most important ones. <span class="content_text"><a href="../TimeProfiling/TimeProfiling.html#//apple_ref/doc/uid/TP40005233-CH3-SW1">“Time Profiling”</a></span> discusses <em>Time Profiling</em>, the most frequently used configuration, which gives a statistical profile of processor utilization. <em>System Tracing</em>, discussed in <span class="content_text"><a href="../SystemTracing/SystemTracing.html#//apple_ref/doc/uid/TP40005233-CH4-SW12">“System Tracing,”</a></span> provides an exact trace of user-kernel transitions, and is useful both to debug interactions between your program and the underlying system and to provide a “microscope” to examine multithreaded programming issues in detail. After the complete chapters devoted to these two configurations, the remainder are covered in <span class="content_text"><a href="../OtherProfilingandTracingTechniques/OtherProfilingandTracingTechniques.html#//apple_ref/doc/uid/TP40005233-CH6-SW17">“Other Profiling and Tracing Techniques.”</a></span> <em>Time Profile (All Thread States)</em> is a variant of <em>Time Profile</em> that also samples blocked threads, and as a result is a good way to get an overview of locking behavior in multithreaded applications. <em>Malloc Trace</em> allows you to examine memory allocation and deallocation activity in detail. Shark can apply <em>Static Analysis</em> to your application in order to quickly examine rarely-traversed code paths. Equivalents for <em>Time Profile</em>, <em>Malloc Trace</em>, and an exact <em>Call Trace</em>, all customized for use with Java applications, are also available. Finally, the chapter gives an overview of Shark’s extensive performance counter recording and analysis capabilities.</p></li><li class="li"><p><strong>Advanced Techniques</strong>— Shark’s basic techniques for sampling and analysis are sufficient for most purposes, but with complex applications you may need more sophisticated techniques. <span class="content_text"><a href="../SelectingExecutiontoSampleorTrace/SelectingExecutiontoSampleorTrace.html#//apple_ref/doc/uid/TP40005233-CH13-SW15">“Advanced Profiling Control”</a></span> covers ways to start and stop Shark’s sampling very precisely, allowing you to carefully control what is sampled, in advance. You can also learn how to control Shark remotely from other machines or even to control Shark running on iPhone OS devices attached to your machine in this chapter. <span class="content_text"><a href="../AdvancedProfileAnalysisandDataMining/AdvancedProfileAnalysisandDataMining.html#//apple_ref/doc/uid/TP40005233-CH7-SW2">“Advanced Session Management and Data Mining”</a></span> looks at Shark’s symbol management and <em>data mining</em> techniques, which are ways to very precisely select subsets of your samples for examination after they are taken.</p></li><li class="li"><p><strong>Custom Configurations</strong>— Shark is not just limited to its default configurations. If you want to save your own custom settings for a configuration or create a new one from scratch, then you will want to check out chapters <span class="content_text"><a href="../CustomConfigurations/CustomConfigurations.html#//apple_ref/doc/uid/TP40005233-CH8-SW1">“Custom Configurations”</a></span> and <span class="content_text"><a href="../AdvancedHardwareCounterConfiguration/AdvancedHardwareCounterConfiguration.html#//apple_ref/doc/uid/TP40005233-CH10-SW1">“Hardware Counter Configuration.”</a></span> The first describes how you may make adjustments to the existing configurations, while the latter covers the many options relating to the use of hardware performance counters. Because there are so many different possible combinations of performance counters, only a limited number of the possibilities are covered by the default configurations. Hence, this is likely to be the main area where the use of custom configurations will be necessary for typical Shark users.</p></li><li class="li"><p><strong>Appendices</strong>— The first appendix, <span class="content_text"><a href="../CommandReference/CommandReference.html#//apple_ref/doc/uid/TP40005233-CH11-SW1">“Command Reference,”</a></span> provides a brief reference to Shark’s menu commands. The second, <span class="content_text"><a href="../MiscellaneousTopics/MiscellaneousTopics.html#//apple_ref/doc/uid/TP40005233-CH14-SW3">“Miscellaneous Topics,”</a></span> describes several minor, miscellaneous options that do not really fit in anywhere else or are of interest only to a small minority of Shark users. The remainder of the appendices (<span class="content_text"><a href="../IntelCorePMCTablesAppendix/IntelCorePMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH22-SW1">“Intel Core Performance Counter Event List,”</a></span> <span class="content_text"><a href="../IntelCore2PMCTablesAppendix/IntelCore2PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH23-SW1">“Intel Core 2 Performance Counter Event List,”</a></span> <span class="content_text"><a href="../750PMCTablesAppendix/750PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH24-SW1">“PPC 750 (G3) Performance Counter Event List,”</a></span> <span class="content_text"><a href="../7400PMCTablesAppendix/7400PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH25-SW1">“PPC 7400 (G4) Performance Counter Event List,”</a></span> <span class="content_text"><a href="../7450PMCTablesAppendix/7450PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH26-SW1">“PPC 7450 (G4+) Performance Counter Event List,”</a></span> <span class="content_text"><a href="../970PMCTablesAppendix/970PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH27-SW1">“PPC 970 (G5) Performance Counter Event List,”</a></span> <span class="content_text"><a href="../U2PMCTablesAppendix/U2PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH28-SW1">“UniNorth-2 (U1.5/2) Performance Counter Event List,”</a></span> <span class="content_text"><a href="../U3PMCTablesAppendix/U3PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH29-SW1">“UniNorth-3 (U3) Performance Counter Event List,”</a></span> and <span class="content_text"><a href="../U4PMCTablesAppendix/U4PMCTablesAppendix.html#//apple_ref/doc/uid/TP40005233-CH30-SW1">“Kodiak (U4) Performance Counter Event List”</a></span>) provide a reference for the performance counters that you can measure with Shark.</p></li></ul>

        <br /><br /> 
        
        <div class="mini_nav_text" align="left">
        <span class="navButtons">
        <!-- Previous button --><span style="margin-left: 8px"><a href="../GettingStartedwithShark/GettingStartedwithShark.html">Next Page &gt;</a></span>
        </span>
        <span id="showHideTOCLowerSpan">
        <a href="#" onclick="showHideTOC();"><img src="../../../../Resources/Images/show_toc_icon.gif" width="15" height="14" border="0" style="margin-bottom: -2px;" alt="" /></a> <a href="#" onclick="showHideTOC();">Hide TOC</a>
        </span>
        </div>

        <br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> <!--#if expr="0=1" -->&#x00a9; 2008 Apple Inc. All Rights Reserved. &#40;<!--#endif -->Last updated: 2008-04-14<!--#if expr="0=1" -->&#041;<!--#endif --></p></div>

        
        <div class="hideOnPrint hideInXcode">
        <!-- start of footer -->
        	<table width="100%" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/Introduction/Introduction.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/Introduction/Introduction.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/documentation/DeveloperTools/Conceptual/SharkUserGuide/Introduction/Introduction.html%3Fid%3DTP40005233-2.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

        <!--#include virtual="/includes/framesetfooter" -->
        <!-- end of footer -->
        </div>
    </div>
</body>
</html>