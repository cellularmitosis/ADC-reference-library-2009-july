<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"			"http://www.w3.org/TR/REC-html40/loose.dtd"><html><head><LINK REL="stylesheet" HREF="../../adcstyle.css" TYPE="text/css"><LINK REL="stylesheet" HREF="../../style.css" TYPE="text/css"><title>Technical Note NW29: File Sharing Extension 7.6.1</title><meta name="keywords" content=""><meta name="Description" content="Technical Note NW29: ">    <meta name="categories" content="Networking"><meta name="week-posted" content="Jan 30, 1995 - Feb 3, 1995"><LINK REL="stylesheet" HREF="../../css/adcstyle.css" TYPE="text/css"><script language="JavaScript" type="text/javascript" src="../../js/adc.js"></script></HEAD><BODY BGCOLOR="#FFFFFF" TEXT="#000000"><a name="//apple_ref/doc/uid/DTS10002570" title="File Sharing Extension 7.6.1"></a><a name="top"></a><!-- top_of_header_marker_comment --><!-- begin_header_information --><!--#include virtual="/adcnavbar" --><p><a href="http://developer.apple.com/">ADC Home</a> &gt; <a href="../../referencelibrary/index.html">Reference Library</a> &gt; <a href="../../technicalnotes/index.html">Technical Notes</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/index.html">Legacy Documents</a> &gt; <a href="../../technicalnotes/LegacyTechnologies/idxNetworking-date.html">Networking</a> &gt; </p><div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;"><div class="legacybox"><h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../images/closebutton.png" width="14" height="14" border="0"  alt="close button"></a></span></h1>

<p><strong>Important: </strong>This document is part of the Legacy section of the ADC Reference Library. This information should not be used for new development.</p>

<div class="reflibtopic">
	<p>Current information on this Reference Library topic can be found here:</p>
	<ul>
				<li><a href="../../referencelibrary/Networking/index.html" target="_blank">Reference Library > Networking</a></li>
	</ul>
</div>




</div></div></div><!-- end_header_information --><!-- bottom_of_header_marker_comment --><!-- top_of_titles_marker_comment --><CENTER><table width="600" cellpadding="0" cellspacing="0" border="0">
<tr><td align="left" scope="row">
<h1>
<div id="pagehead">Technical Note NW29</div>
<div id="pageheadsub">File Sharing Extension 7.6.1</div>
</h1>
</td></tr></table></CENTER><!-- bottom_of_titles_marker_comment --><CENTER><TABLE BORDER=0 CELLSPACING=1 WIDTH=600><TR><td align="left"><!-- begin_header_box --><table width="600" cellpadding="0" cellspacing="0" border="0">    <tr>        <td width=300 valign="top" align=left scope="row">            <table border="0" width="300" cellpadding="0" cellspacing="0">			<tr>                        <td width=300 align=left> <img src="images/tnmenutop.gif" alt="" align="bottom" width=300 height=7></td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>                                         <span id="menutitle">                            CONTENTS                             <br>                            <br>                        </span>                    </td>                </tr>                <tr bgcolor="#e6e6e6">                    <td background="images/tnmenubody.gif" width=300 align=left>					<!-- begin_toc -->					<p id="menutext"><a href="#Introduction">Introduction</a><BR><BR><a href="#Section1">Identifying Enhanced Macintosh File Sharing</a><BR><BR><a href="#Section2">Server Control Calls Supported</a><BR><BR><a href="#Section3">What Volumes Are Shared?</a><BR><BR><a href="#Section4">New error code for PBUnmount</a><BR><BR><a href="#References">References</a><BR><BR><a href="#Downloads">Downloadables</a></p>                   <!-- end_toc -->                  </td>                </tr>                <tr>                    <td width=300 align=left scope="row">                        <img src="images/tnmenubottom.gif" alt="" width=300 height=16>                    </td>                </tr>            </table>        </td>        <td width=300 valign="top" align=left><!-- begin_intro_text --><P id = "introtext">This Technical Note documents the enhanced features of Macintosh File Sharingversion 7.6.1.</p><!-- end_intro_text --><!-- begin_date --><h3 align=center>[Feb 01 1995]</h3><!-- end_date -->                </TD>             </TR>          </TABLE>          <!-- end_table_box --> <BR><BR>          <hr width=500 align=center>          <BR><BR><!-- begin_content --><a name="Introduction"></a><h2>Introduction</h2><p>Macintosh File Sharing 7.6.1 supports a subset of the AppleShare File Server4.0.2 server features. This Technical Note tells how to identify Macintosh FileSharing 7.6.1, lists the server control calls supported by Macintosh FileSharing 7.6.1, documents behavior differences in the supported server controlcalls, documents the new rule File Sharing uses to determine what volumes toshare, and documents how to determine why a busy volume cannot be unmounted.All other documentation for the AppleShare and File Sharing API can be found inthe AppleShare API SDK (AppleShare 3.0 Developer's Kit) on the Mac OS SoftwareDeveloper's Kit CD-ROM. Macintosh File Sharing 7.6.1 is installed as part ofSystem 7.5 Update.</p><a name="Section1"></a><P><A HREF="#top">Back to top</A></P><h2>Identifying Enhanced Macintosh File Sharing</h2><p>Macintosh File Sharing 7.6.1 has the server type of <code>MFSType</code> ($0000) and has theserver version $003E. It can be identified using the server control callSCServerVersion as shown here.</p><CENTER><TABLE BORDER=0 CELLPADDING=5 WIDTH=550><TR>	<td bgcolor="#E6E6E6" align=left><pre>enum{    kNewFileSharingVersion = 0x3e  /* File Sharing 7.6.1's version number */};Boolean  HasEnhancedFileSharing(void){    SCParamBlockRec  scPB;    Boolean          result;    result = false;    /* Make sure the ServerDispatch trap (A094) is available */    if ( TrapAvailable(ServerDispatch) )    {        scPB.versionPB.scCode = SCServerVersion;        scPB.versionPB.scExtNamePtr = NULL;        if ( SyncServerDispatch(&amp;scPB) == noErr )        {            /* See if server is file sharing with */            /* a server version =&gt; kNewFileSharingVersion */            result = ( (scPB.versionPB.scServerType == MFSType) &amp;&amp;                       (scPB.versionPB.scServerVersion &gt;= kNewFileSharingVersion) )        }    }    return ( result );</pre>	</TD></TR></TABLE></CENTER><P><A HREF="#top">Back to top</A></P><a name="Section2"></a><h2>Server Control Calls Supported</h2><p>Macintosh File Sharing 7.6.1 supports the following server control calls:</p><ul type="disc">	<li><code>SCCancelShutDown</code></li>	<li><code>SCDisconnect</code></li>	<li><code>SCGetExpFldr</code></li>	<li><code>SCGetSetupInfo</code></li>	<li><code>SCPollServer</code></li>	<li><code>SCServerVersion</code></li>	<li><code>SCSetSetupInfo</code></li>	<li><code>SCShutDown</code></li>	<li><code>SCStartServer</code></li>	<li><code>SCSendMessage</code></li>	<li><code>SCGetServerStatus</code></li>	<li><code>SCDisconnectVolUsers</code></li>	<li><code>SCGetUserNameRec</code></li>	<li><code>SCGetUserMountInfo</code></li>	<li><code>SCSetCopyProtect</code></li>	<li><code>SCClrCopyProtect</code></li>	<li><code>SCWakeServer</code></li>	<li><code>SCSleepServer</code></li></ul><P>Macintosh File Sharing 7.6.1 does not support the following server controlcalls which are supported by AppleShare 3.0 and does not support any of theinternal server control calls used by AppleShare Pro or AppleShare 4.0:</p><ul type="disc">	<li><code>SCInstallServerEventProc</code></li>	<li><code>SCRemoveServerEventProc</code></li>	<li><code>SCGetServerEventProc</code></li></ul><p>Of the server control calls that are supported, some behave differently withMacintosh File Sharing 7.6.1 than they do on an AppleShare File Server. Thesections that follow explain those differences.</p><h3>SCDisconnect</h3><p>The SCDisconnect call does not send disconnect attention messages underMacintosh File Sharing. <code>SCDisconnect</code> was supported by older versions of FileSharing, but the <code>scFlags</code> and <code>scMessagePtr</code> fields in the parameter block wereignored. Some program failed to initialize those fields, so Macintosh FileSharing 7.6.1 must ignore them to prevent address and bus errors.</p><h3>SCGetSetupInfo</h3><p>The <code>SCGetSetupInfo</code> call now supports the <code>scMaxVolumes</code>, <code>scMaxExpFolders</code>, and<code>scCurMaxSession</code> fields in the parameter block, and in the setup informationrecord (<code>SetupInfoRec</code>), <code>SILoginMsg</code> is supported. However, the <code>SCGetSetupInfo</code>call still does not use the following fields of the setup information record:</p><ul type="disc">	<li><code>SIVolInfoLocation</code></li>	<li><code>SIVolInfoVisible</code></li>	<li><code>SIUserInfoLocation</code></li>	<li><code>SIUserInfoVisible</code></li>	<li><code>SIShutDownMins</code></li>	<li><code>SISpare</code></li></ul><h3>SCSetSetupInfo</h3><p>The <code>SCSetSetupInfo</code> call now supports the <code>SILoginMsg</code> in the setup informationrecord (<code>SetupInfoRec</code>). However, the <code>SCSetSetupInfo</code> call still does not use thefollowing fields of the setup information record:</p><ul type="disc">	<li><code>SIVolInfoLocation</code></li>	<li><code>SIVolInfoVisible</code></li>	<li><code>SIUserInfoLocation</code></li>	<li><code>SIUserInfoVisible</code></li>	<li><code>SIShutDownMins</code></li>	<li><code>SISpare</code></li></ul><h3>SCShutDown</h3><p>The <code>SCShutDown</code> call does not send shutdown attention messages under MacintoshFile Sharing. <code>SCShutDown</code> was supported by older versions of File Sharing, butthe <code>scFlags</code> and <code>scMessagePtr</code> fields in the parameter block were ignored. Someprogram failed to initialize those fields, so Macintosh File Sharing 7.6.1 mustignore them to prevent address and bus errors.</p><P><A HREF="#top">Back to top</A></P><a name="Section3"></a><h2>What Volumes Are Shared?</h2><h3>Audio CDs are Never Shared</h3><p>Because a shared Audio CD has never made sense, Macintosh File Sharing 7.6.1never shares Audio CDs. Audio CDs are identified by File Sharing by the filesystem ID of the Audio CD Access file system, $4A48.</p><h3>bDontShareIt Volume Attribute Bit</h3><p>Foreign file systems can now tell Macintosh File Sharing to never share theirvolumes by setting the <code>bDontShareIt</code> volume attribute bit (bit 21 in the<code>vMAttrib</code> field of <code>GetVolParmsInfoBuffer</code>) returned in response to a<code>PBHGetVolParms</code> request (<code>HFSDispatch</code>, selector $30). Network foreign filesystems should always set the <code>bDontShareIt</code> bit.</p><P><A HREF="#top">Back to top</A></P><a name="Section4"></a><h2>New error code for PBUnmount</h2><p>When you try to unmount a volume that has one or more files open,<code>PBUnmount</code> will fail because the volume is busy. In the past, the errorresult returned by <code>PBUnmount</code> when this happened was always<code>fBsyErr</code> (-47). To distinguish between the volume being busy becausefiles are open by the local user vs. remote users, Macintosh File Sharing 7.6.1now returns two error codes: <code>fBsyErr</code> if all files are open only by alocal user; <code>afpFileBusy</code> (-5010) if any files are open by remoteusers.</p><P><A HREF="#top">Back to top</A></P><a name="References"></a><h2>References</h2><P><i>Inside Macintosh: Files</i>, Chapter 2, PBHGetVolParms</p><P>Mac OS SDK CD-ROM, AppleShare API SDK (AppleShare 3.0 Developer's Kit),Server Control Calls and Server Event Handling</p><P>FL 35 - Determining Which File System Is Active</p>                                      <P><A HREF="#top">Back to top</A></P><P><A NAME=Downloads></A></P>                  <H2>Downloadables</H2>                  <TABLE BORDER=0 CELLPADDING=3 WIDTH="100%">            <TR>               <td width=50 align=left>                  <P ALIGN=center><img src="images/acrobatsmall.gif" width=22 height=23 align=middle alt="Acrobat gif"></P>               </TD>               <td align="left">                  <P>Acrobat version of this Note (56K)</P>               </TD>               <td width=60 align=left>                  <P><A HREF="pdf/nw_29.pdf">Download</A></P>               </TD>            </TR>                     </TABLE>         <BR>         <P><A HREF="#top">Back to top</A></P></TD></TR></TABLE></CENTER><!-- end_content --><!-- begin_footer_information -->	<table width="680" border="0" cellpadding="0" cellspacing="0">
		<tr>
			<td><div style="width: 100%; height: 1px; background-color: #919699; margin-top: 5px; margin-bottom: 15px"></div></td>
		</tr>
		<tr>
			<td align="center"><br/>
				<table border="0" cellpadding="0" cellspacing="0" class="graybox">
					<tr>
						<th>Did this document help you?</th>
					</tr>
					<tr>
						<td>
						    <div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=1&url=/technotes/nw/nw_29.html%3Fid%3DDTS10002570-1.0&media=dvd" target=_new>Yes</a>:  Tell us what works for you.</div>
							<div style="margin-bottom: 8px"><a href="http://developer.apple.com/feedback/?v=2&url=/technotes/nw/nw_29.html%3Fid%3DDTS10002570-1.0&media=dvd" target=_new>It&#8217;s good, but:</a> Report typos, inaccuracies, and so forth.</div>
							<div><a href="http://developer.apple.com/feedback/?v=3&url=/technotes/nw/nw_29.html%3Fid%3DDTS10002570-1.0&media=dvd" target=_new>It wasn&#8217;t helpful</a>: Tell us what would have helped.</div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
<!--#include virtual="/includes/footer"--><!-- end_footer_information --></BODY></HTML>