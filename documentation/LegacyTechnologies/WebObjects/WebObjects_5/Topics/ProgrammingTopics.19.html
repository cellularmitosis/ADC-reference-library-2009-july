<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML EXPERIMENTAL 970324//EN"><HTML><HEAD><META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter"><TITLE> Working with Unnormalized Tables</TITLE></HEAD><BODY bgcolor="#ffffff">		<!-- start of header -->		<!--#include virtual="/includes/framesetheader" -->		<!-- end of header --><!-- start of path --><table cellspacing=0 border=0 width=600 valign="left"><tr><td scope="row"><font face="Geneva,Helvetica,Arial" size="1"><b>PATH<spacer type="horizontal" size="5">&nbsp;</b><a href="../../index.html" target="_top">Documentation</a> <b>></b> <a href="../webobjects.html" target="_top">WebObjects</a></font></td></tr></table><br><!-- end of path --><DIV><a name="top"></a><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.18.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1a.html"><img src="next.gif" border="0" alt="Next"></A></DIV><H1 CLASS="TopictTitle"><A NAME="pgfId=606100"> </A><A NAME="19760"> </A>Working with Unnormalized Tables</H1><DIV><H2 CLASS="Synopsis"><A NAME="pgfId=606101"> </A>Synopsis</H2><P CLASS="Body"><A NAME="pgfId=606102"> </A>Describes how to set up an EOModel to work with a database with unnormalized tables.</P></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606103"> </A>Discussion</H2><P CLASS="Body"><A NAME="pgfId=612501"> </A>A normalized table contains no columns with duplicate data. Any column with duplicate data is replaced with a column of foreign keys into a new table containing unique data. For example, suppose you are creating a movie database. Every movie has a category such as &quot;action&quot;, &quot;drama&quot;, or &quot;comedy&quot;. An unnormalized Movies table may be designed with a category column containing string data. All comedies would contain the string &quot;comedy&quot; in the category column.</P><P CLASS="Body"><A NAME="pgfId=612606"> </A>This table can be normalized by creating a Category table having a unique set of category strings, the string &quot;comedy&quot; appearing exactly once in this table. Each movie in the Movie table now has a key to the row in the Category table corresponding to the movie's category. All comedies contain the key to the comedy row duplicated in the category column.</P><P CLASS="Body"><A NAME="pgfId=612599"> </A>Fetches on unnormalized tables don't require the extra joins to the unique tables and are consequently faster than fetches on normalized tables. However, they are harder to maintain. For example, every action movie must have the string &quot;action&quot; in the category column. If an action movie has the misspelled string &quot;actio&quot;, or the synonymous string &quot;adventure&quot; in the category column, an query for action movies will overlook this movie.</P><P CLASS="Body"><A NAME="pgfId=612709"> </A>Suppose you are working with the unnormalized Movies table where the category column contains string data, and you want to present the user with a pick list of all the movie categories. You can't just read all of the categories from the Category table because the database doesn't contain one. However, you can use EOF to pretend your database is normalized by creating extra entities to the same database tables. These extra entities have a subset of the database table's columns. EOF makes objects unique by entity and primary keys, so records fetched from these different entities are indeed different objects. The &quot;faked-out&quot; entities that are not complete records from the database table should be marked as read-only because it makes no sense to insert a sparse Movie record with only the Category set when attempting to create a new Category.</P><P CLASS="Body"><A NAME="pgfId=606105"> </A>The following steps in EOModeler simulate a Movies database with a Category table when the category data is actually embedded within the Movies table.</P><P CLASS="Numbered1"><A NAME="pgfId=606106"> </A>	Create a new read-only entity in the EOModeler called Category. </P><OL><LI CLASS="Numbered"><A NAME="pgfId=606107"> </A>	Set the new Category entity's table name to &quot;Movie.&quot;</LI><LI CLASS="Numbered"><A NAME="pgfId=606108"> </A>	Add one attribute called &quot;category&quot; to the Category entity.</LI><LI CLASS="Numbered"><A NAME="pgfId=606109"> </A>	Make the category attribute the primary key.</LI><LI CLASS="Numbered"><A NAME="pgfId=606110"> </A>	Create a to-many relationship from the Category entity to the Movie entity joined by the category attribute in each table. This allows to you get all the movies for a given category.</LI></OL><P CLASS="Body"><A NAME="pgfId=606111"> </A>When you fetch the Category entity, you must remember to invoke <TT CLASS="Code">setUsesDistinct:YES</TT> on the fetch specification. Otherwise, you will get duplicates since you are really just fetching one column from the Movie table.</P><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607928"> </A>Java Code</H4><PRE CLASS="Code"><A NAME="pgfId=607930"> </A>public NSArray fetchCategories() {<A NAME="pgfId=607932"> </A>    EOEditingContext ec=session().defaultEditingContext();<A NAME="pgfId=607934"> </A>    EOFetchSpecification fs=new EOFetchSpecification(&quot;Category&quot;, null, null);<A NAME="pgfId=607936"> </A>    fs.setUsesDistinct(true);<A NAME="pgfId=607938"> </A>    return ec.objectsWithFetchSpecification(fs);<A NAME="pgfId=607940"> </A>}</PRE></DIV><DIV><H4 CLASS="Code-Listing"><A NAME="pgfId=607945"> </A>Objective-C Code</H4><PRE CLASS="Code"><A NAME="pgfId=607947"> </A>- (NSArray *) fetchCategories {<A NAME="pgfId=607949"> </A>    EOEditingContext *ec=[[self session] defaultEditingContext];<A NAME="pgfId=607951"> </A>    EOFetchSpecification *fs=[EOFetchSpecification<A NAME="pgfId=614165"> </A>        fetchSpecificationWithEntityName: @&quot;Category&quot;<A NAME="pgfId=614174"> </A>        qualifier: nil sortOrderings: nil];<A NAME="pgfId=607953"> </A>    [fs setUsesDistinct: YES];<A NAME="pgfId=607955"> </A>    return [ec objectsWithFetchSpecification: fs];<A NAME="pgfId=607957"> </A>}</PRE></DIV></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=614207"> </A>See Also</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=614208"> </A><A HREF="ProgrammingTopics.1f.html#21824" CLASS="XRef">Fetching Distinct Results</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=614209"> </A><A HREF="ProgrammingTopics.1c.html#39919" CLASS="XRef">Creating Fetch Specifications Programmatically</A></LI><LI CLASS="Bulleted"><A NAME="pgfId=616946"> </A><A HREF="ProgrammingTopics.1a.html#15933" CLASS="XRef">Fetching with an Editing Context</A></LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=614210"> </A>Questions</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=606134"> </A>How do I set up an EOModel to be more normalized than the actual database?</LI><LI CLASS="Bulleted"><A NAME="pgfId=606135"> </A>How do I fetch pick lists when the rows are not normalized into a separate table?</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=607068"> </A>Keywords</H2><UL><LI CLASS="Bulleted"><A NAME="pgfId=607069"> </A>Unnormalized</LI><LI CLASS="Bulleted"><A NAME="pgfId=607070"> </A>Distinct</LI></UL></DIV><DIV><H2 CLASS="Heading1"><A NAME="pgfId=606143"> </A>Revision History</H2><P CLASS="Body"><A NAME="pgfId=606144"> </A>21 July, 1998. David Scheck. First Draft.<BR>19 November 1998. Clif Liu. Second Draft.</P></DIV><hr alt="">&#169 1999 Apple Computer, Inc.<P><A HREF="TopicsTOC.html"><img src="up.gif" border="0" alt="Up"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.18.html"><img src="previous.gif" border="0" alt="Previous"></A><nobr>&nbsp;</nobr><A HREF="ProgrammingTopics.1a.html"><img src="next.gif" border="0" alt="Next"></A><!-- start of footer --><!--#include file="footer" --><!-- end of footer --><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body><!-- start of footer --><!--#include virtual="/includes/framesetfooter" --><!-- end of footer --></body></HTML>