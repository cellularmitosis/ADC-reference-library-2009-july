<!-- Generated by Harlequin WebMaker 2.2.3 (30-Apr-1996)
Macintosh Common Lisp Version 3.0kp2p2 [AppGen 3.0b1kp2p2] -->
<HTML> <HEAD>
<TITLE>The Architecture of MacApp's Build System (MacApp PG)</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../../Resources/CSS/frameset_styles.css">
<script type="text/javascript" language="JavaScript" src="../../Resources/JavaScript/page.js"></script>
</head>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<div style="width:100%; position:fixed;"><div align="center" id="watermark" style="position: relative; margin-left:auto; margin-right:auto; z-index:20; width:500px;">
<div class="legacybox" style="position: relative;">
<h1>Legacy Document<span class=closebutton><a href="javascript:closeWatermark()"><img src="../../Resources/Images/closebutton.png" width="14" height="14" border="0" align="top" alt="close button"></a></span></h1><p><b>Important:</b>
The information in this document is obsolete and should not be used for new development.</p></div></div></div>


<A NAME=HEADING150></A>


<!-- start of header -->

<!--#include virtual="/includes/framesetheader" -->

<!-- end of header -->


<!-- Main Body -->

<CENTER>
<P>
<A HREF="MacAppProgGuide-149.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-151.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<FONT SIZE=-1><DL><DT><a href="../../macos8/mac8.html" onmouseover="window.status='Macintosh Documentation'; return true"><B>Inside Macintosh:</B></A> <A HREF="MacAppProgGuide-2.html"><B>Programmer's Guide to MacApp</B></A> / <A HREF="MacAppProgGuide-78.html"><B>Part 2 - Working With MacApp</B></A><BR><DD><A HREF="MacAppProgGuide-148.html"><B>Appendix A - Working With the MacApp  Build System</B></A></DL></FONT><P>
<HR>
<BLOCKQUOTE>
<A NAME=HEADING150-0></A>
<H1>The Architecture of MacApp's Build System</H1>
 For simple applications, you don't need to know much about MABuild's use of scripts, tools, and shell variables. The MABuild system offers rather sophisticated default behavior. But if you need to explore beyond the default behavior, knowledge of the MABuild system's architecture will become more important.<P>
<A NAME=HEADING150-2></A>
<H2><A NAME=MARKER-2-13></A>MABuild System Files</H2>
 This section lists files used by the MacApp build system.<P>
<DL>
<DT><B>Note</B>
<DD>A name enclosed in braces <CODE>{}</CODE> indicates a shell variable that will be expanded. One of MacApp's startup files that is described below, <CODE>1Startup</CODE>, uses shell variables to define default locations for many MacApp files. For example, <CODE>{MacApp}</CODE> indicates the root directory for all MacApp files on your hard disk. It might expand to <CODE>HD:MacApp:</CODE>. You can learn more about MPW shell variables in the <I>Macintosh Programmer's Workshop Reference</I>.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
<A NAME=HEADING150-5></A>
<H3>Startup Files</H3>
 The MABuild system uses the following files to initialize various MPW shell variables.<P>
<UL>
<LI><CODE>{MPW}UserStartupMacApp</CODE><P>
You move this file to your MPW shell directory or MPW <CODE>Startup Items</CODE> directory so that it will be executed when you launch MPW. The first time it is executed, this file asks you to locate your MacApp folder. It then saves the location in a file in the MPW shell directory called <CODE>MacApp_Folder</CODE>. Each time you launch MPW, the <CODE>UserStartupMacApp</CODE> file executes any file in the folder <CODE>{MacApp}Startup Items:</CODE>, thus automatically executing certain MacApp startup files that are listed below.
<LI><CODE>{MacApp}Startup Items:1Startup</CODE><P>
This startup file sets default values for a number of MacApp-related MPW shell variables, such as the version of MacApp to build and the location of MacApp source code. It also sets aliases for compatibility with earlier releases of MABuild. This file begins with the digit <CODE>1</CODE> so that it will be executed before any other files in the startup folder. If additional startup files need to be executed in a particular order, they should be named or numbered to achieve the correct ordering.<P>
The <CODE>1Startup</CODE> file also executes any scripts in the <CODE>{MacApp}</CODE> directory that begin with <CODE>Startup</CODE> (the bullet character is created by typing Option-8). This allows you to create personalized startup files that will not be overwritten by a new release of MacApp. For example, you could create a file named <CODE>StartupMyStartup</CODE> that contains additional variable definitions for your MacApp environment. However, you may prefer to place additional startup files in the <CODE>{MacApp}Startup Items:</CODE> folder.
<LI><CODE>{MacApp}Startup Items:Startup%</CODE><P>
This file sets an MPW shell variable, <CODE>MASeparateObjectsPrefix</CODE>, that is used to add a special character to the names of certain files and directories created during the MABuild process. A different character is used for different versions of MacApp to help identify the version of a library or application you are building.
<LI><CODE>{MacApp}Startup Items:StartupRamDisk</CODE><P>
Using a RAM disk can speed the build process significantly. This file looks for a RAM disk with the specified name and sets the shell variable <CODE>RAMDisk</CODE> to that name. It also sets shell variables to tell the build process to look on the RAM disk for certain specified files. For example, if you set the variable <CODE>CPlusScratch</CODE> to the name of the RAM disk, the C++ compiler will use the RAM disk for temporary files.<P>
The default name for the RAM disk is <CODE>RAM Disk:</CODE>. You can edit <CODE>StartupRamDisk</CODE> to specify the name of your RAM disk and to set variables indicating which files should go on your RAM disk.<P>
</UL>
<A NAME=HEADING150-17></A>
<H3>Dependencies and Definitions Files</H3>
 The following files provide definitions and dependencies for specific types of MacApp builds.<P>
<DL>
<DT><CODE>{Dependencies}Definitions_68K</CODE>
<DD> This file contains build definitions that are specific to building an application for a 68K-based Macintosh computer.
<DT><CODE>{Dependencies}Definitions_CFM68K</CODE>
<DD> This file contains build definitions that are specific to building an application that uses CFM-68K <A NAME=MARKER-2-14></A>(the 68K Macintosh version of the Power Macintosh Code Fragment Manager).
<DT><CODE>{Dependencies}Definitions_CFront</CODE>
<DD> This file contains build definitions that are specific to MPW C/C++ 68K library support.
<DT><CODE>{Dependencies}Definitions_Classic</CODE>
<DD> This file contains build definitions that are specific to classic 68K library support.
<DT><CODE>{Dependencies}Definitions_Common</CODE>
<DD> This file contains build definitions that are common to any kind of build, whether building noncode resources only, building a 68K application, or building a native application for a Power Macintosh computer.
<DT><CODE>{Dependencies}Definitions_MrC</CODE>
<DD> This file contains build definitions that are specific to MrC compiler support.
<DT><CODE>{Dependencies}Definitions_MW68K</CODE>
<DD> This file contains build definitions that are specific to Metrowerks CodeWarrior 68K library support.
<DT><CODE>{Dependencies}Definitions_MWPPC</CODE>
<DD> This file contains build definitions that are specific to Metrowerks CodeWarrior PPC library support (for Power Macintosh).
<DT><CODE>{Dependencies}Definitions_PPC</CODE>
<DD> This file contains build definitions that are specific to building an application for a Power Macintosh computer.
<DT><CODE>{Dependencies}Definitions_PPCC</CODE>
<DD> This file contains build definitions that are specific to PPCC compiler support.
<DT><CODE>{Dependencies}Definitions_SC</CODE>
<DD> This file contains build definitions that are specific to Symantec compiler support.
<DT><CODE>{Dependencies}Definitions_RSRC</CODE>
<DD> This file contains build definitions that are specific to building an application's noncode resources only.
<DT><CODE>{Dependencies}Dependencies_68K</CODE>
<DD> This file contains dependency definitions used in building an application for a 68K-based Macintosh computer.
<DT><CODE>{Dependencies}Dependencies_PPC</CODE>
<DD> This file contains dependency definitions used in building an application for a Power Macintosh computer.
<DT><CODE>{Dependencies}Dependencies_RSRC</CODE>
<DD> This file contains dependency definitions used in building an application's noncode resources only.
<DT><CODE>{Dependencies}Fast_Dependencies_68K</CODE>
<DD> This file contains dependency definitions that allow for very efficient 68K compilation using the Metrowerks CodeWarrior compiler.
<DT><CODE>{Dependencies}Fast_Dependencies_PPC</CODE>
<DD> This file contains dependency definitions that allow for very efficient Power Macintosh compilation using the Metrowerks CodeWarrior compiler.
</DL>
<A NAME=HEADING150-36></A>
<H3><A NAME=MARKER-2-15></A>Makefiles</H3>
 To help create your application, you create a makefile containing file dependencies and other information. (See <A HREF=MacAppProgGuide-152.html#MARKER-9-33>"Creating a Makefile," beginning on page 683</A>.) Your makefile is really a partial makefile, also called an MAMakefile (or MacApp Makefile). The MABuild system allows you to specify just the make information necessary for your own files, then combines it with other information to build your application. For convenience, we refer to both kinds of files as makefiles.<P>
 The following files contain information used in creating makefiles to control the build process.<P>
<DL>
<DT><CODE>{MALibraries}MacApp.Lib.MAMake</CODE>
<DD> This is the makefile that contains file dependencies and other information used in building the 68K version of the MacApp library.
<DT><CODE>{MALibraries}MacApp.lib.xcoff.MAMake</CODE>
<DD> This is the makefile that contains file dependencies and other information used in building the Power Macintosh version of the MacApp library.
<DT><CODE>{MACPlusExamples}Calc:Calc.MAMake</CODE>
<DD> This is the makefile for the Calc sample application. Other sample programs have similarly named makefiles.
<DT>
<DD> These makefiles provide good examples of the structure of an makefile. You can modify one of these files for use with your application.
</DL>
<A NAME=HEADING150-43></A>
<H3>Help File</H3>
 The following file provides help about the MABuild system.<P>
<DL>
<DT><CODE>{MacApp}MacApp.help</CODE>
<DD> This file contains help related to the MABuild system, including the options available for MABuild. You can examine this help file from MPW by typing the following line and pressing the Enter key:
<CODE>Help -f &quot;{MacApp}&quot;MacApp.Help MABuild</CODE><P>
</DL>
<A NAME=HEADING150-47></A>
<H3>Miscellaneous Build Files</H3>
 The following files provide miscellaneous services to the MABuild system.<P>
<DL>
<DT><CODE>{MATools}MABuild</CODE>
<DD> MABuild is actually an MPW script that is launched to start the MABuild process.
<DT><CODE>{MATools}MABuildTool</CODE>
<DD> This is an MPW tool that runs the build process.
<DT><CODE>{MALibraries}Defaults.r</CODE>
<DD> This is MacApp's default resource file, which contains resources needed to build your application.<A NAME=MARKER-2-16></A>
</DL>
<A NAME=HEADING150-52></A>
<H2>The MABuild Process</H2>
 The syntax for the MABuild command is<P>
<PRE>
MABuild YourApp [-option(s)]
</PRE>
<DL>
<DT><B>Note</B>
<DD>The brackets <CODE>[]</CODE> indicate that their contents are optional (the brackets themselves are not part of the actual syntax). For example, in the MABuild syntax line shown above, no options are required, but a target application name must be specified.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 The build process is summarized in <A HREF=#MARKER-9-17>Figure A-1 on page 671</A>. The flow of control is shown by the numbered gray arrows connecting the icons on the left side of the illustration. Inputs to the process are shown by solid arrows from the icons on the right side of the illustration.<P>
 The process starts when you type in your MPW worksheet an MABuild command line such as the following and press the Enter key:<P>
<PRE>
MABuild YourApp [-options]
</PRE>
 This is shown in step 1. The <CODE>MABuild</CODE> script adds the value of the <CODE>MABuildDefaults</CODE> shell variable to the command line and calls <CODE>MABuildTool</CODE> (step 2), which parses your command-line options and also uses some shell variable definitions.<B> </B>The output from <CODE>MABuildTool</CODE>--a group of MPW <CODE>Set</CODE> commands and other commands that execute the MPW Make tool and run Make's output--goes to a temporary text file the <CODE>MABuild</CODE> script creates, called <CODE>MABuildTool.Temp</CODE> (step 3).<P>
 When <CODE>MABuildTool</CODE> has finished creating <CODE>MABuildTool.Temp</CODE>, it returns to the <CODE>MABuild</CODE> script, which makes sure <CODE>MABuildTool.Temp</CODE> was created and then executes it (step 4). <CODE>MABuildTool.Temp</CODE> initializes the variables specified as options for the current build, and then calls <CODE>Make</CODE> (step 5). <P>
 <CODE>Make</CODE> creates its own temporary file, called <I>YourApp<CODE>.MakeIt</CODE></I>, which contains the commands that invoke the compiler and other tools necessary to build your program (step 6). <CODE>Make</CODE> is passed several partial makefiles, including <CODE>Definitions_Common</CODE>, <CODE>Definitions_68K</CODE> (<CODE>Definitions_PPC</CODE> if you're building a Power Macintosh version of your application), <CODE>Dependencies_68K</CODE> (<CODE>Dependencies_PPC</CODE> for a Power Macintosh version), and the application makefile you created (<I>YourApp<CODE>.MAMake</CODE></I>) to construct the file <I>YourApp<CODE>.MakeIt</CODE></I>.<P>
 Finally, the <CODE>MABuildTool.Temp</CODE> file executes <I>YourApp<CODE>.MakeIt</CODE></I> (step 7), which runs the specified tools (step 8) and creates your application (step 9). If the build process completes successfully, the resulting build folder contains the <I>YourApp<CODE>.MakeIt</CODE></I> file (for your reference), the object files (for future builds), a symbol file (if you built with debugging symbols), and your application (ready for testing).<P>
<B>Figure A-1  <A NAME=MARKER-9-17></A><A NAME=MARKER-2-18></A>The MacApp build process</B><P>
<IMG ALIGN = BOTTOM SRC = "graphics/MacApp_PG-L-050.gif"><P>
<A NAME=HEADING150-65></A>
<H2><A NAME=MARKER-9-19></A>Introduction to MABuild Options</H2>
 You don't usually need to be aware of all the behind-the-scenes calling of scripts and tools that goes on with MABuild. However, you should know that MABuild offers about 50 build options. If you don't specify options, default settings are provided.<P>
 The build system sets these defaults in several ways, and you can modify them in several ways as well. The MABuildTool has some built-in defaults, and it also checks certain global MPW shell variables, which are set in MacApp's <CODE>1Startup</CODE> file. These variables are described in the section <A HREF=MacAppProgGuide-152.html#MARKER-9-24>"Inputs You Provide to MABuild," beginning on page 675</A>.<P>
 If you wish to change the build system's default behavior, you can alter MacApp's <CODE>1Startup</CODE> file. You can also override the default behavior by specifying any or all of the MABuild options from the MPW command line. Options set on the command line override or extend the default behavior, whether it comes from MABuild's defaults or from shell variables set by MPW or by you. <P>
<DL>
<DT><B>Note</B>
<DD><A NAME=MARKER-9-20></A>For some options, such as specifying whether to include symbols, an option is either on or off. In those cases, the command-line option overrides default options. In other cases, such as specifying compiler options, more than one option may be specified. In those cases, command-line options are concatenated onto the defaults from the <CODE>{MABuildDefaults}</CODE> shell variable.<EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif">
</DL>
 If you prefer to choose your options from an interactive dialog box, there is an MPW Commando interface for MABuild. To use it, you type<P>
 <CODE>MABuild...</CODE> <P>
 in your MPW worksheet and press Enter. The ellipsis character (...) is produced by typing Option-semicolon. To find out more about MPW's Commando interface, consult the <I>Macintosh Programmer's Workshop Reference</I>.<P>
</BLOCKQUOTE>
<HR>
<center>
<A HREF="MacAppProgGuide-149.html"><IMG ALIGN = BOTTOM SRC = "prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="MacAppProgGuide-2.html"><IMG ALIGN = BOTTOM SRC = "content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="MacAppProgGuide-158.html"><IMG ALIGN = BOTTOM SRC = "index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="MacAppProgGuide-151.html"><IMG ALIGN = BOTTOM SRC = "next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P>
<center><font size=-1><A HREF="MacAppProgGuide-3.html">&copy; Apple Computer, Inc.</A><br>25 JUL 1996</center></font><P>

<!-- start of footer  -->

<!--#include virtual="/includes/framesetfooter" -->

<!-- end of footer -->


</BODY>
</HTML>  
